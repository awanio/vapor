get:
  summary: List all storage pools
  description: 'Returns a list of storage pools with optional filtering and pagination.


    **Filtering:**

    - `state`: Filter by pool state (active, inactive, all)

    - `type`: Filter by pool type (dir, logical, disk, netfs, etc.)


    **Pagination:**

    - `page`: Page number (default: 1)

    - `page_size`: Number of items per page (default: 50, max: 100)

    '
  tags:
  - Virtualization Storage
  security:
  - bearerAuth: []
  parameters:
  - name: state
    in: query
    required: false
    schema:
      type: string
      enum:
      - all
      - active
      - inactive
      default: all
    description: Filter by pool state
    example: active
  - name: type
    in: query
    required: false
    schema:
      type: string
      enum:
      - dir
      - logical
      - disk
      - netfs
      - iscsi
      - scsi
      - mpath
      - rbd
      - gluster
      - zfs
      - fs
    description: Filter by pool type
    example: dir
  - name: page
    in: query
    required: false
    schema:
      type: integer
      minimum: 1
      default: 1
    description: Page number for pagination
  - name: page_size
    in: query
    required: false
    schema:
      type: integer
      minimum: 1
      maximum: 100
      default: 50
    description: Number of items per page
  responses:
    '200':
      description: A list of storage pools with pagination information
      content:
        application/json:
          schema:
            type: object
            properties:
              status:
                type: string
                example: success
              data:
                type: object
                properties:
                  pools:
                    type: array
                    items:
                      $ref: ../components/schemas/StoragePoolsResponse.yaml
                  pagination:
                    type: object
                    properties:
                      total:
                        type: integer
                        description: Total number of items matching the filter
                        example: 25
                      page:
                        type: integer
                        description: Current page number
                        example: 1
                      page_size:
                        type: integer
                        description: Number of items per page
                        example: 50
                      total_pages:
                        type: integer
                        description: Total number of pages
                        example: 1
    '500':
      $ref: ../components/responses/InternalError.yaml
post:
  summary: Create a new storage pool
  description: |
    Creates a new storage pool with validation for directory-type pools.
    
    **Path Validation (for `type: "dir"`):**
    - Path must not be empty
    - Path must be absolute (start with `/`)
    - Parent directory must exist
    - Parent directory must be writable
    - If path exists, it must be a directory (not a file)
    
    **Build Process:**
    - For directory pools, libvirt will attempt to create the directory if it doesn't exist
    - Build failures for `dir` pools are treated as critical errors
    - Pool will be undefined if build or start fails
  tags:
  - Virtualization Storage
  security:
  - bearerAuth: []
  requestBody:
    required: true
    content:
      application/json:
        schema:
          $ref: ../components/schemas/StoragePoolCreateRequest.yaml
        examples:
          dir_pool:
            summary: Directory-based storage pool
            value:
              name: "vm-storage"
              type: "dir"
              path: "/var/lib/libvirt/images/vm-storage"
              autostart: true
          netfs_pool:
            summary: NFS storage pool
            value:
              name: "nfs-storage"
              type: "netfs"
              source: "nfs.example.com"
              path: "/exports/vms"
              target: "/mnt/nfs-storage"
              autostart: false
  responses:
    '201':
      description: Storage pool created successfully
      content:
        application/json:
          schema:
            $ref: ../components/schemas/StoragePoolCreateResponse.yaml
    '400':
      description: |
        Bad request - validation failed
        
        **Common validation errors:**
        - `path is required for directory-type storage pools`
        - `path must be an absolute path, got: <path>`
        - `parent directory does not exist: <dir>`
        - `parent directory is not writable: <dir>`
        - `path exists but is not a directory: <path>`
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "path is required for directory-type storage pools"
    '500':
      description: |
        Internal server error - pool creation failed
        
        **Common errors:**
        - `failed to define storage pool` - libvirt couldn't parse pool XML
        - `failed to build storage pool (could not create directory)` - directory creation failed
        - `failed to start storage pool` - pool couldn't be activated
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: "failed to build storage pool (could not create directory): Permission denied"
