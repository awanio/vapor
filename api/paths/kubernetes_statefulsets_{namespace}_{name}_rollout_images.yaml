patch:
  summary: Update container images in a StatefulSet
  description: |
    Update one or more container images in a StatefulSet.
    
    This operation performs a strategic merge patch to update specific 
    container images without affecting other StatefulSet settings. The 
    update triggers an ordered rolling update to replace pods with the 
    new images.
    
    This is equivalent to running:
    ```bash
    kubectl set image statefulset/{name} container1=image1 container2=image2 -n {namespace}
    ```
    
    **Note:** Container names must match existing containers in the StatefulSet.
    Pods will be updated in reverse ordinal order (highest to lowest) according
    to the StatefulSet's updateStrategy. This ensures stable network identities
    and storage are maintained.
  tags:
    - Kubernetes
  security:
    - bearerAuth: []
  parameters:
    - name: namespace
      in: path
      required: true
      description: StatefulSet namespace
      schema:
        type: string
      example: default
    - name: name
      in: path
      required: true
      description: StatefulSet name
      schema:
        type: string
      example: mysql
  requestBody:
    required: true
    description: |
      Array of container name to image mappings.
      Each object in the array should have a single key-value pair where:
      - Key: container name (must exist in the StatefulSet)
      - Value: new image to use (including tag)
    content:
      application/json:
        schema:
          type: array
          items:
            type: object
            additionalProperties:
              type: string
          minItems: 1
        example:
          - mysql: "mysql:8.0.32"
          - xtrabackup: "percona/percona-xtrabackup:8.0.32"
  responses:
    '200':
      description: Container images updated successfully
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: true
              message:
                type: string
                example: "Successfully updated images for StatefulSet default/mysql"
              updated_images:
                type: object
                additionalProperties:
                  type: string
                description: Map of container names to their new images
                example:
                  mysql: "mysql:8.0.32"
                  xtrabackup: "percona/percona-xtrabackup:8.0.32"
              statefulset:
                $ref: ../components/schemas/StatefulSetDetail.yaml
    '400':
      description: Invalid request
      content:
        application/json:
          schema:
            $ref: ../components/schemas/ErrorResponse.yaml
          examples:
            noImages:
              summary: No images provided
              value:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "No image updates provided"
                  details: "Please provide at least one container image to update"
            invalidContainer:
              summary: Container not found
              value:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "Container 'invalid-name' not found in StatefulSet"
                  details: "Please provide a valid container name that exists in the StatefulSet"
    '401':
      $ref: ../components/responses/UnauthorizedError.yaml
    '404':
      description: StatefulSet not found
      content:
        application/json:
          schema:
            $ref: ../components/schemas/ErrorResponse.yaml
    '500':
      description: Failed to update StatefulSet images
      content:
        application/json:
          schema:
            $ref: ../components/schemas/ErrorResponse.yaml
    '503':
      $ref: ../components/responses/KubernetesNotInstalledError.yaml
