openapi: 3.0.3
info:
  title: VM Network Link State Management API
  version: 1.0.0
  description: API endpoint for managing virtual machine network interface link states (disconnect/reconnect)
  
paths:
  /virtualization/computes/{id}/network-link:
    post:
      summary: Set VM network interface link state
      description: |
        Change the link state of a virtual machine's network interface to disconnect (down) or reconnect (up).
        This is equivalent to the virsh commands:
        - `virsh domif-setlink <domain> <interface> down` - to disconnect
        - `virsh domif-setlink <domain> <interface> up` - to reconnect
        
        The interface can be identified by either:
        - Interface name (e.g., "vnet0", "vnet1")
        - MAC address (e.g., "52:54:00:12:34:56")
      tags:
        - "Virtualization Compute"
        - "Network Management"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: VM name or UUID
          examples:
            by_name:
              value: "web-server-01"
              summary: VM identified by name
            by_uuid:
              value: "550e8400-e29b-41d4-a716-446655440000"
              summary: VM identified by UUID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NetworkLinkStateRequest'
            examples:
              disconnect_by_name:
                summary: Disconnect interface by name
                value:
                  interface: "vnet0"
                  state: "down"
              reconnect_by_name:
                summary: Reconnect interface by name
                value:
                  interface: "vnet0"
                  state: "up"
              disconnect_by_mac:
                summary: Disconnect interface by MAC address
                value:
                  interface: "52:54:00:12:34:56"
                  state: "down"
              reconnect_by_mac:
                summary: Reconnect interface by MAC address
                value:
                  interface: "52:54:00:12:34:56"
                  state: "up"
      responses:
        '200':
          description: Network link state changed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NetworkLinkStateResponse'
              examples:
                disconnected:
                  summary: Interface disconnected successfully
                  value:
                    status: "success"
                    message: "Network interface vnet0 link state changed to down"
                    interface: "vnet0"
                    state: "down"
                    mac: "52:54:00:12:34:56"
                reconnected:
                  summary: Interface reconnected successfully
                  value:
                    status: "success"
                    message: "Network interface vnet0 link state changed to up"
                    interface: "vnet0"
                    state: "up"
                    mac: "52:54:00:12:34:56"
        '400':
          description: Bad Request - Invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_state:
                  summary: Invalid state value
                  value:
                    status: "error"
                    error:
                      code: "INVALID_REQUEST"
                      message: "Invalid network link state request"
                      details: "state must be either 'up' or 'down'"
                missing_interface:
                  summary: Missing interface parameter
                  value:
                    status: "error"
                    error:
                      code: "INVALID_REQUEST"
                      message: "Invalid network link state request"
                      details: "interface is required"
        '404':
          description: Not Found - VM or interface not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                vm_not_found:
                  summary: VM not found
                  value:
                    status: "error"
                    error:
                      code: "NOT_FOUND"
                      message: "domain 'web-server-01' not found"
                interface_not_found:
                  summary: Interface not found
                  value:
                    status: "error"
                    error:
                      code: "NOT_FOUND"
                      message: "interface vnet99 not found"
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: "error"
                error:
                  code: "INTERNAL_ERROR"
                  message: "Failed to set network link state"
                  details: "failed to acquire connection: connection pool exhausted"

components:
  schemas:
    NetworkLinkStateRequest:
      type: object
      required:
        - interface
        - state
      properties:
        interface:
          type: string
          description: |
            The network interface identifier. Can be either:
            - Interface device name (e.g., "vnet0", "vnet1", "eth0")
            - MAC address (e.g., "52:54:00:12:34:56")
          examples:
            - "vnet0"
            - "52:54:00:ab:cd:ef"
        state:
          type: string
          description: The desired link state
          enum:
            - up
            - down
          example: "down"
      example:
        interface: "vnet0"
        state: "down"

    NetworkLinkStateResponse:
      type: object
      properties:
        status:
          type: string
          description: Operation status
          example: "success"
        message:
          type: string
          description: Human-readable message about the operation result
          example: "Network interface vnet0 link state changed to down"
        interface:
          type: string
          description: The actual interface name that was modified
          example: "vnet0"
        state:
          type: string
          description: The current link state after the operation
          enum:
            - up
            - down
          example: "down"
        mac:
          type: string
          description: MAC address of the network interface
          example: "52:54:00:12:34:56"
      required:
        - status
        - message
        - interface
        - state

    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          example: "error"
        error:
          type: object
          properties:
            code:
              type: string
              description: Error code
              example: "NOT_FOUND"
            message:
              type: string
              description: Error message
              example: "Interface not found"
            details:
              type: string
              description: Additional error details
              example: "interface vnet99 not found on domain web-server-01"

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token for API authentication

tags:
  - name: "Virtualization Compute"
    description: Virtual machine management operations
  - name: "Network Management"
    description: Network interface and connectivity management
