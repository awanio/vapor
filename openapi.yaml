openapi: 3.1.0
info:
  title: Vapor API
  version: 0.0.1
  description: |
    RESTful API for Vapor, a web console for modern Linux stacks.
    
    ### Key Features
    - System management and monitoring
    - Network configuration
    - Storage management
    - Virtual machine management
    - Container and Kubernetes support
    - Ansible automation
    - Resumable file uploads using TUS protocol

    ### TUS Protocol Support
    
    This API implements the **TUS Protocol v1.0.0** for resumable file uploads, specifically for:
    - ISO images for virtual machines (`/virtualmachines/isos/upload/*`)
    - Container images (`/containers/images/upload/*`)
    - Docker images (`/docker/images/upload/*`)
    
    #### What is TUS?
    
    TUS is an open protocol for resumable file uploads via HTTP/1.1 and HTTP/2. It allows:
    - **Resume interrupted uploads**: Network failures don't mean starting over
    - **Upload large files reliably**: Perfect for multi-GB ISO and container images
    - **Monitor progress**: Real-time upload progress tracking
    - **Automatic retry**: Built-in resilience to network issues
    
    #### How to Use TUS Endpoints
    
    ##### 1. Create Upload Session
    ```http
    POST /api/v1/virtualmachines/isos/upload
    Headers:
      Upload-Length: 1474560000  # File size in bytes
      Upload-Metadata: filename aXNvLXVidW50dS0yMi4wNC5pc28=  # Base64 encoded metadata
    ```
    Returns:
    - `201 Created` with `Location` header containing upload URL
    - Upload session ID in response body
    
    ##### 2. Upload File Chunks
    ```http
    PATCH /api/v1/virtualmachines/isos/upload/{upload_id}
    Headers:
      Upload-Offset: 0  # Starting byte position
      Content-Type: application/offset+octet-stream
    Body: [binary data chunk]
    ```
    - Chunk size: 1MB - 50MB recommended
    - Returns new offset after successful upload
    
    ##### 3. Resume Interrupted Upload
    ```http
    HEAD /api/v1/virtualmachines/isos/upload/{upload_id}
    ```
    Returns current `Upload-Offset` to resume from
    
    ##### 4. Complete Upload
    ```http
    POST /api/v1/virtualmachines/isos/upload/{upload_id}/complete
    ```
    Finalizes upload and registers the file in the system
    
    #### Frontend Implementation
    
    For frontend applications, we recommend using:
    - **tus-js-client**: Official JavaScript client library
    - **Uppy**: Modern file upload library with TUS support
    - **Fine Uploader**: Enterprise-grade upload solution
    
    Example with tus-js-client:
    ```javascript
    import * as tus from 'tus-js-client';
    
    const upload = new tus.Upload(file, {
      endpoint: '/api/v1/virtualmachines/isos/upload',
      headers: {
        'Authorization': 'Bearer ' + token
      },
      chunkSize: 10 * 1024 * 1024, // 10MB chunks
      metadata: {
        filename: file.name,
        filetype: file.type
      },
      onError: (error) => console.error('Upload failed:', error),
      onProgress: (bytesUploaded, bytesTotal) => {
        const percentage = (bytesUploaded / bytesTotal * 100).toFixed(2);
        console.log(percentage + '% uploaded');
      },
      onSuccess: () => {
        console.log('Upload complete');
        // Call complete endpoint to finalize
        fetch(`/api/v1/virtualmachines/isos/upload/${upload.url.split('/').pop()}/complete`, {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + token }
        });
      }
    });
    
    upload.start();
    ```
    
    ### Benefits for Large Files
    
    - **Reliability**: Automatic resume on network failures
    - **Efficiency**: Only retransmit failed chunks
    - **User Experience**: Show accurate progress, pause/resume capability
    - **Bandwidth Optimization**: Configurable chunk sizes
    - **Server Resources**: Reduced memory usage with streaming uploads
servers:
  - url: http://localhost:8080/api/v1
    description: Local development server
paths:
  /auth/login:
    post:
      summary: Authenticate user
      description: |
        Authenticate a user and receive a JWT token.
        
        **Authentication Methods:**
        - **Password**: Use Linux system user credentials
        - **SSH Key**: Use SSH private key for authentication
        
        The `auth_type` field determines the authentication method.
      tags:
        - Auth
      security: []  # No authentication required for login endpoint
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EnhancedLoginRequest'
      responses:
        '200':
          description: Successful authentication
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnhancedLoginResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /auth/refresh:
    post:
      summary: Refresh JWT token
      description: |
        Refresh an existing JWT token. Supports refreshing expired tokens
        within a 7-day grace period.
      tags:
        - Auth
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnhancedLoginResponse'
        '401':
          description: Invalid or expired token beyond refresh window
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /auth/challenge:
    post:
      summary: Create SSH authentication challenge
      description: |
        Create a challenge for SSH key-based authentication.
        The challenge must be signed with the user's private key.
      tags:
        - Auth
      security: []  # No authentication required
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChallengeRequest'
      responses:
        '200':
          description: Challenge created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChallengeResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /auth/challenge/verify:
    post:
      summary: Verify SSH challenge signature
      description: |
        Verify a signed SSH challenge to complete authentication.
        Returns a JWT token upon successful verification.
      tags:
        - Auth
      security: []  # No authentication required
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyRequest'
      responses:
        '200':
          description: Challenge verified successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnhancedLoginResponse'
        '401':
          description: Invalid signature or expired challenge
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Challenge not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /auth/users/{username}/keys:
    get:
      summary: Get user's SSH public keys
      description: |
        Retrieve the authorized SSH public keys for a specific user.
        Reads from the user's ~/.ssh/authorized_keys file.
      tags:
        - Auth
      security: []  # Public endpoint for key discovery
      parameters:
        - name: username
          in: path
          required: true
          description: Username to get keys for
          schema:
            type: string
      responses:
        '200':
          description: List of SSH public keys
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SSHKeysResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /network/interfaces:
    get:
      summary: List network interfaces
      tags:
        - Network
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of interfaces
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InterfacesResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /network/interfaces/{name}/up:
    put:
      summary: Bring interface up
      tags:
        - Network
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Interface brought up
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '404':
          description: Interface not found
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /network/interfaces/{name}/down:
    put:
      summary: Bring interface down
      tags:
        - Network
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Interface brought down
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '404':
          description: Interface not found
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /network/interfaces/{name}/address:
    post:
      summary: Configure IP address
      tags:
        - Network
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddressRequest'
      responses:
        '200':
          description: Address configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '404':
          description: Interface not found
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
    put:
      summary: Update IP address
      tags:
        - Network
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddressRequest'
      responses:
        '200':
          description: Address updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '404':
          description: Interface not found
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
    delete:
      summary: Delete IP address
      tags:
        - Network
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
        - name: address
          in: query
          required: true
          schema:
            type: string
            format: ipv4
      responses:
        '200':
          description: Address deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '404':
          description: Interface or address not found
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /network/bridges:
    get:
      summary: List network bridges
      tags:
        - Network
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of bridges
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      bridges:
                        type: array
                        items:
                          $ref: '#/components/schemas/Interface'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /network/bridge:
    post:
      summary: Create network bridge
      tags:
        - Network
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BridgeRequest'
      responses:
        '200':
          description: Bridge created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '409':
          description: Bridge already exists
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /network/bridge/{name}:
    put:
      summary: Update network bridge
      tags:
        - Network
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BridgeRequest'
      responses:
        '200':
          description: Bridge updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '404':
          description: Bridge not found
        '400':
          description: Not a bridge interface
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    delete:
      summary: Delete network bridge
      tags:
        - Network
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Bridge deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '404':
          description: Bridge not found
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /network/bonds:
    get:
      summary: List network bonds
      tags:
        - Network
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of bonds
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      bonds:
                        type: array
                        items:
                          $ref: '#/components/schemas/Interface'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /network/bond:
    post:
      summary: Create network bond
      tags:
        - Network
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BondRequest'
      responses:
        '200':
          description: Bond created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '409':
          description: Bond already exists
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /network/bond/{name}:
    put:
      summary: Update network bond
      tags:
        - Network
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BondRequest'
      responses:
        '200':
          description: Bond updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '404':
          description: Bond not found
        '400':
          description: Not a bond interface
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    delete:
      summary: Delete network bond
      tags:
        - Network
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Bond deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '404':
          description: Bond not found
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /network/vlans:
    get:
      summary: List VLAN interfaces
      tags:
        - Network
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of VLANs
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      vlans:
                        type: array
                        items:
                          $ref: '#/components/schemas/Interface'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /network/vlan:
    post:
      summary: Create VLAN interface
      tags:
        - Network
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VLANRequest'
      responses:
        '200':
          description: VLAN created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '409':
          description: VLAN already exists
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /network/vlan/{name}:
    put:
      summary: Update VLAN interface
      tags:
        - Network
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VLANRequest'
      responses:
        '200':
          description: VLAN updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '404':
          description: VLAN not found
        '400':
          description: Not a VLAN interface
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    delete:
      summary: Delete VLAN interface
      tags:
        - Network
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: VLAN deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '404':
          description: VLAN not found
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/disks:
    get:
      summary: List storage disks
      tags:
        - Storage
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of disks
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DisksResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/mount:
    post:
      summary: Mount filesystem
      tags:
        - Storage
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MountRequest'
      responses:
        '200':
          description: Filesystem mounted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '404':
          description: Device not found
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/unmount:
    post:
      summary: Unmount filesystem
      tags:
        - Storage
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UnmountRequest'
      responses:
        '200':
          description: Filesystem unmounted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/format:
    post:
      summary: Format disk
      tags:
        - Storage
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FormatRequest'
      responses:
        '200':
          description: Disk formatted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '404':
          description: Device not found
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/lvm/vgs:
    get:
      summary: List LVM volume groups
      tags:
        - Storage
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Volume groups listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VolumeGroupsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/lvm/lvs:
    get:
      summary: List LVM logical volumes
      tags:
        - Storage
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logical volumes listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogicalVolumesResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/lvm/pvs:
    get:
      summary: List LVM physical volumes
      tags:
        - Storage
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Physical volumes listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PhysicalVolumesResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/lvm/vg:
    post:
      summary: Create LVM volume group
      tags:
        - Storage
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateVGRequest'
      responses:
        '200':
          description: Volume group created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/lvm/lv:
    post:
      summary: Create LVM logical volume
      tags:
        - Storage
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateLVRequest'
      responses:
        '200':
          description: Logical volume created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/iscsi/discover:
    post:
      summary: Discover iSCSI targets
      tags:
        - Storage
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ISCSIDiscoverRequest'
      responses:
        '200':
          description: Targets discovered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ISCSITargetsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /containers:
    get:
      summary: List containers
      tags:
        - Container
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Containers listed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      containers:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: 2309b08a1303d054769d3adba93ac148c6cc31748a6dbecda5b12156028b034c
                            name:
                              type: string
                              example: reloader
                            image:
                              type: string
                              example: sha256:5ea6cbf6dee9b4b67edbd108986d75c5958273e6f6faaf0c18e734572b6b8821
                            state:
                              type: string
                              example: CONTAINER_RUNNING
                            status:
                              type: string
                              example: CONTAINER_RUNNING
                            created_at:
                              type: string
                              format: date-time
                              example: "2025-07-25T09:38:51.086238448Z"
                            labels:
                              type: object
                              additionalProperties:
                                type: string
                              example: {"io.kubernetes.container.name": "reloader"}
                            runtime:
                              type: string
                              example: containerd
                      count:
                        type: integer
                        example: 151
                      runtime:
                        type: string
                        example: containerd
        '503':
          description: No container runtime available
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        example: NO_RUNTIME_AVAILABLE
                      message:
                        type: string
                        example: "No container runtime found. Tried CRI sockets ([/run/containerd/containerd.sock /var/run/crio/crio.sock]) and Docker. Last error: Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?"

  /containers/{id}:
    get:
      summary: Get detailed container information
      tags:
        - Container
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Container ID
          schema:
            type: string
      responses:
        '200':
          description: Container details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      container:
                        $ref: '#/components/schemas/ContainerDetail'
                      runtime:
                        type: string
                        example: docker
                      execution_context:
                        type: object
                        properties:
                          directory_state:
                            type: object
                            properties:
                              pwd:
                                type: string
                                example: /Users/kandar/Workspaces/vapor/api
                              home:
                                type: string
                                example: /Users/kandar
                          operating_system:
                            type: object
                            properties:
                              platform:
                                type: string
                                example: MacOS
                          current_time:
                            type: string
                            format: date-time
                            example: '2025-08-02T06:33:19Z'
                          shell:
                            type: object
                            properties:
                              name:
                                type: string
                                example: zsh
                              version:
                                type: string
                                example: '5.9'
        '400':
          description: Invalid container ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Failed to get container details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          description: No container runtime available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /containers/{id}/logs:
    get:
      summary: Get container logs
      tags:
        - Container
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Container ID
          schema:
            type: string
      responses:
        '200':
          description: Container logs retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      container_id:
                        type: string
                        example: abc123def456
                      logs:
                        type: string
                        description: Container logs output
                        example: "2025-08-02T09:00:00.000Z Started application\n2025-08-02T09:00:01.000Z Listening on port 8080\n"
                      runtime:
                        type: string
                        example: docker
        '400':
          description: Invalid container ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: INVALID_ID
                  message: Container ID is required
        '500':
          description: Failed to get container logs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: CONTAINER_LOGS_ERROR
                  message: failed to get container logs
        '503':
          description: No container runtime available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: NO_RUNTIME_AVAILABLE
                  message: No container runtime found

  /containers/images:
    get:
      summary: List images
      tags:
        - Container
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Images listed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      images:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: sha256:d12fc38c77e50eab23af17f302d5b94514173d9f84150b7662aecbfeb21f8717
                            repo_tags:
                              type: array
                              items:
                                type: string
                              example: ["r.awan.app/library/remote-console-ipmi:2.0"]
                            repo_digests:
                              type: array
                              items:
                                type: string
                              example: ["quay.io/operatorhubio/catalog@sha256:096fa413e1b8dba2071020e5809597e7d86da5a2833ffdf97a20457af714e678"]
                            size:
                              type: integer
                              example: 109999465
                            created_at:
                              type: string
                              format: date-time
                              example: "2025-08-01T12:40:55.236465486Z"
                            runtime:
                              type: string
                              example: containerd
                      count:
                        type: integer
                        example: 92
                      runtime:
                        type: string
                        example: containerd
        '503':
          description: No container runtime available
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        example: NO_RUNTIME_AVAILABLE
                      message:
                        type: string
                        example: "No container runtime found. Tried CRI sockets ([/run/containerd/containerd.sock /var/run/crio/crio.sock]) and Docker. Last error: Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?"

  /containers/images/{id}:
    get:
      summary: Get detailed image information
      tags:
        - Container
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Image ID
          schema:
            type: string
      responses:
        '200':
          description: Image details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      image:
                        $ref: '#/components/schemas/ImageDetail'
                      runtime:
                        type: string
                        example: docker
        '400':
          description: Invalid image ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Failed to get image details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          description: No container runtime available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /containers/images/import:
    post:
      summary: Import container image from tarball
      tags:
        - Container
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
      responses:
        '200':
          description: Image imported successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      import_result:
                        $ref: '#/components/schemas/ImageImportResult'
                      runtime:
                        type: string
                        example: docker
                      filename:
                        type: string
                        example: "my-image.tar.gz"
        '400':
          description: Invalid file or request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Failed to import image
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /containers/images/upload:
    post:
      summary: Create resumable upload session
      description: |
        Alternative path for creating resumable upload session for container images using TUS protocol.
        ```
      tags:
        - Container
      security:
        - bearerAuth: []
      parameters:
        - name: Upload-Length
          in: header
          required: true
          description: Total size of the file to upload
          schema:
            type: integer
            format: int64
        - name: Upload-Metadata
          in: header
          required: false
          description: Metadata about the upload (filename, etc.)
          schema:
            type: string
      responses:
        '201':
          description: Upload session created successfully
          headers:
            Location:
              description: URL for the upload session
              schema:
                type: string
            Upload-Offset:
              description: Current upload offset (starts at 0)
              schema:
                type: integer
            Tus-Resumable:
              description: TUS protocol version
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  upload_id:
                    type: string
                    example: "abc123-def456-ghi789"
                  upload_url:
                    type: string
                    example: "/containers/images/upload/abc123-def456-ghi789"
                  expires_at:
                    type: string
                    format: date-time
                    example: "2025-08-06T15:38:32Z"
        '400':
          description: Invalid upload request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '413':
          description: File too large
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          description: No container runtime available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: List active upload sessions
      description: |
        
        This endpoint lists all active TUS upload sessions for container images,
        allowing you to:
        - Monitor multiple concurrent uploads
        - Resume interrupted uploads
        - Clean up stale upload sessions
        
        Upload sessions expire after 24 hours of inactivity.
      tags:
        - Container
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Upload sessions listed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      uploads:
                        type: array
                        items:
                          type: object
                          properties:
                            upload_id:
                              type: string
                            total_size:
                              type: integer
                            uploaded_size:
                              type: integer
                            progress:
                              type: number
                              format: float
                            status:
                              type: string
                              enum: [created, in_progress, completed, failed, cancelled]
                            created_at:
                              type: string
                              format: date-time
                            updated_at:
                              type: string
                              format: date-time
                            filename:
                              type: string
                      count:
                        type: integer

  /containers/images/upload/{id}:
    head:
      summary: Get upload session info
      description: Get information about a resumable upload session for container images
      tags:
        - Container
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Upload session ID
          schema:
            type: string
      responses:
        '200':
          description: Upload session info retrieved successfully
          headers:
            Upload-Offset:
              description: Current upload offset
              schema:
                type: integer
            Upload-Length:
              description: Total upload length
              schema:
                type: integer
            Tus-Resumable:
              description: TUS protocol version
              schema:
                type: string
            Cache-Control:
              description: Cache control header
              schema:
                type: string
        '404':
          description: Upload session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    patch:
      summary: Upload chunk
      description: Upload a chunk of data to a resumable upload session for container images
      tags:
        - Container
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Upload session ID
          schema:
            type: string
        - name: Upload-Offset
          in: header
          required: true
          description: Current upload offset
          schema:
            type: integer
        - name: Content-Type
          in: header
          required: true
          description: Must be application/offset+octet-stream
          schema:
            type: string
            enum: [application/offset+octet-stream]
      requestBody:
        required: true
        content:
          application/offset+octet-stream:
            schema:
              type: string
              format: binary
      responses:
        '204':
          description: Chunk uploaded successfully
          headers:
            Upload-Offset:
              description: New upload offset after this chunk
              schema:
                type: integer
            Tus-Resumable:
              description: TUS protocol version
              schema:
                type: string
        '400':
          description: Invalid chunk or headers
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Upload session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Offset mismatch or upload already completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '410':
          description: Upload session expired or cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: Get upload status
      description: Get detailed status of a resumable upload session for container images
      tags:
        - Container
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Upload session ID
          schema:
            type: string
      responses:
        '200':
          description: Upload status retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      upload:
                        type: object
                        properties:
                          upload_id:
                            type: string
                          total_size:
                            type: integer
                          uploaded_size:
                            type: integer
                          progress:
                            type: number
                            format: float
                          status:
                            type: string
                            enum: [created, in_progress, completed, failed, cancelled]
                          created_at:
                            type: string
                            format: date-time
                          updated_at:
                            type: string
                            format: date-time
                          filename:
                            type: string
                          metadata:
                            type: object
                            additionalProperties: true
        '404':
          description: Upload session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Cancel upload session
      description: Cancel and delete a resumable upload session for container images
      tags:
        - Container
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Upload session ID
          schema:
            type: string
      responses:
        '204':
          description: Upload session cancelled successfully
          headers:
            Tus-Resumable:
              description: TUS protocol version
              schema:
                type: string
        '404':
          description: Upload session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /containers/images/upload/{id}/complete:
    post:
      summary: Complete upload and import image
      description: Complete the upload session and import the container image
      tags:
        - Container
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Upload session ID
          schema:
            type: string
      responses:
        '200':
          description: Upload completed and image imported successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      upload_id:
                        type: string
                      import_result:
                        $ref: '#/components/schemas/ImageImportResult'
                      runtime:
                        type: string
                        example: containerd
                      filename:
                        type: string
        '400':
          description: Upload not complete or invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Upload session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Failed to import image
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          description: No container runtime available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /docker/images/import:
    post:
      summary: Import Docker image from tarball
      tags:
        - Docker
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
      responses:
        '200':
          description: Docker image imported successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      import_result:
                        $ref: '#/components/schemas/ImageImportResult'
                      runtime:
                        type: string
                        example: docker
                      filename:
                        type: string
                        example: "docker-image.tar.gz"
        '400':
          description: Invalid file or request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Failed to import Docker image
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /docker/images/upload:
    post:
      summary: Create resumable upload session
      description: Create a new resumable upload session for Docker image using TUS protocol
      tags:
        - Docker
      security:
        - bearerAuth: []
      parameters:
        - name: Upload-Length
          in: header
          required: true
          description: Total size of the file to upload
          schema:
            type: integer
            format: int64
        - name: Upload-Metadata
          in: header
          required: false
          description: Metadata about the upload (filename, etc.)
          schema:
            type: string
      responses:
        '201':
          description: Upload session created successfully
          headers:
            Location:
              description: URL for the upload session
              schema:
                type: string
            Upload-Offset:
              description: Current upload offset (starts at 0)
              schema:
                type: integer
            Tus-Resumable:
              description: TUS protocol version
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  upload_id:
                    type: string
                    example: "abc123-def456-ghi789"
                  upload_url:
                    type: string
                    example: "/docker/images/upload/abc123-def456-ghi789"
                  expires_at:
                    type: string
                    format: date-time
                    example: "2025-08-06T15:38:32Z"
        '400':
          description: Invalid upload request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '413':
          description: File too large
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: List active upload sessions
      description: List all active resumable upload sessions
      tags:
        - Docker
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Upload sessions listed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      uploads:
                        type: array
                        items:
                          type: object
                          properties:
                            upload_id:
                              type: string
                            total_size:
                              type: integer
                            uploaded_size:
                              type: integer
                            progress:
                              type: number
                              format: float
                            status:
                              type: string
                              enum: [created, in_progress, completed, failed, cancelled]
                            created_at:
                              type: string
                              format: date-time
                            updated_at:
                              type: string
                              format: date-time
                            filename:
                              type: string
                      count:
                        type: integer

  /docker/images/upload/{id}:
    head:
      summary: Get upload session info
      description: Get information about a resumable upload session
      tags:
        - Docker
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Upload session ID
          schema:
            type: string
      responses:
        '200':
          description: Upload session info retrieved successfully
          headers:
            Upload-Offset:
              description: Current upload offset
              schema:
                type: integer
            Upload-Length:
              description: Total upload length
              schema:
                type: integer
            Tus-Resumable:
              description: TUS protocol version
              schema:
                type: string
            Cache-Control:
              description: Cache control header
              schema:
                type: string
        '404':
          description: Upload session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    patch:
      summary: Upload chunk
      description: Upload a chunk of data to a resumable upload session
      tags:
        - Docker
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Upload session ID
          schema:
            type: string
        - name: Upload-Offset
          in: header
          required: true
          description: Byte offset where this chunk starts
          schema:
            type: integer
            format: int64
        - name: Content-Type
          in: header
          required: true
          description: Must be application/offset+octet-stream
          schema:
            type: string
            enum: ["application/offset+octet-stream"]
      requestBody:
        required: true
        content:
          application/offset+octet-stream:
            schema:
              type: string
              format: binary
      responses:
        '204':
          description: Chunk uploaded successfully
          headers:
            Upload-Offset:
              description: New upload offset after this chunk
              schema:
                type: integer
            Tus-Resumable:
              description: TUS protocol version
              schema:
                type: string
        '400':
          description: Invalid chunk upload request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Upload session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Offset mismatch or upload already completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '410':
          description: Upload session expired or cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: Get upload status
      description: Get detailed status of a resumable upload session
      tags:
        - Docker
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Upload session ID
          schema:
            type: string
      responses:
        '200':
          description: Upload status retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      upload_id:
                        type: string
                      total_size:
                        type: integer
                      uploaded_size:
                        type: integer
                      progress:
                        type: number
                        format: float
                      status:
                        type: string
                        enum: [created, in_progress, completed, failed, cancelled]
                      created_at:
                        type: string
                        format: date-time
                      updated_at:
                        type: string
                        format: date-time
                      metadata:
                        type: object
                        additionalProperties:
                          type: string
                      chunk_size:
                        type: integer
        '404':
          description: Upload session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Cancel upload session
      description: Cancel a resumable upload session
      tags:
        - Docker
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Upload session ID
          schema:
            type: string
      responses:
        '204':
          description: Upload session cancelled successfully
          headers:
            Tus-Resumable:
              description: TUS protocol version
              schema:
                type: string
        '404':
          description: Upload session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /docker/images/upload/{id}/complete:
    post:
      summary: Complete upload and import image
      description: Complete a resumable upload session and import the Docker image
      tags:
        - Docker
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Upload session ID
          schema:
            type: string
      responses:
        '200':
          description: Upload completed and image imported successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      upload_id:
                        type: string
                      import_result:
                        $ref: '#/components/schemas/ImageImportResult'
                      runtime:
                        type: string
                        example: docker
                      filename:
                        type: string
        '400':
          description: Upload not complete
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Upload session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Failed to import image
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          description: No container runtime available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /virtualization/storages/pools:
    get:
      summary: List all storage pools
      tags:
        - "Virtualization Storage"
      security:
        - bearerAuth: []
      responses:
        '200':
          description: A list of storage pools
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StoragePoolsResponse'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      summary: Create a new storage pool
      tags:
        - "Virtualization Storage"
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StoragePoolCreateRequest'
      responses:
        '201':
          description: Storage pool created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StoragePoolCreateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/storages/pools/{name}:
    get:
      summary: Get storage pool details
      tags:
        - "Virtualization Storage"
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: Storage pool name
      responses:
        '200':
          description: Storage pool details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StoragePoolDetailResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    delete:
      summary: Delete a storage pool
      tags:
        - "Virtualization Storage"
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: Storage pool name
        - name: delete_volumes
          in: query
          required: false
          schema:
            type: boolean
          description: Whether to delete associated volumes
      responses:
        '204':
          description: Storage pool deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/storages/pools/{pool_name}/volumes:
    get:
      summary: List all volumes in a storage pool
      tags:
        - "Virtualization Volume"
      security:
        - bearerAuth: []
      parameters:
        - name: pool_name
          in: path
          required: true
          schema:
            type: string
          description: Storage pool name
      responses:
        '200':
          description: A list of storage volumes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StorageVolumesResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      summary: Create a new volume in a storage pool
      tags:
        - "Virtualization Volume"
      security:
        - bearerAuth: []
      parameters:
        - name: pool_name
          in: path
          required: true
          schema:
            type: string
          description: Storage pool name
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VolumeCreateRequest'
      responses:
        '201':
          description: Storage volume created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StorageVolumeCreateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/storages/pools/{pool_name}/volumes/{vol_name}:
    get:
      summary: Get storage volume details
      tags:
        - "Virtualization Volume"
      security:
        - bearerAuth: []
      parameters:
        - name: pool_name
          in: path
          required: true
          schema:
            type: string
          description: Storage pool name
        - name: vol_name
          in: path
          required: true
          schema:
            type: string
          description: Storage volume name
      responses:
        '200':
          description: Storage volume details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StorageVolumeDetailResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    delete:
      summary: Delete a storage volume
      tags:
        - "Virtualization Volume"
      security:
        - bearerAuth: []
      parameters:
        - name: pool_name
          in: path
          required: true
          schema:
            type: string
          description: Storage pool name
        - name: vol_name
          in: path
          required: true
          schema:
            type: string
          description: Storage volume name
      responses:
        '204':
          description: Storage volume deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/isos/upload:
    post:
      summary: Create ISO upload session (TUS)
      description: |
        Create a new resumable upload session for ISO images using TUS protocol.
        
        This endpoint follows TUS protocol v1.0.0 for resumable uploads.
        
        Required headers:
        - Upload-Length: Total size of the ISO file in bytes
        - Upload-Metadata: Base64-encoded metadata (filename, os_type, os_variant, architecture, description, tags)
        
        Example Upload-Metadata header:
        ```
        Upload-Metadata: filename dWJ1bnR1LTIyLjA0LWRlc2t0b3AtYW1kNjQuaXNv,os_type bGludXg=,os_variant dWJ1bnR1MjIuMDQ=
        ```
      tags:
        - Virtualization ISO
      security:
        - bearerAuth: []
      parameters:
        - name: Upload-Length
          in: header
          required: true
          description: Total size of the ISO file in bytes
          schema:
            type: integer
        - name: Upload-Metadata
          in: header
          required: false
          description: Base64-encoded metadata about the ISO
          schema:
            type: string
        - name: Tus-Resumable
          in: header
          required: false
          description: TUS protocol version (1.0.0)
          schema:
            type: string
            default: "1.0.0"
      responses:
        '201':
          description: Upload session created successfully
          headers:
            Location:
              description: URL of the created upload session
              schema:
                type: string
            Upload-Offset:
              description: Current upload offset (0 for new upload)
              schema:
                type: string
            Tus-Resumable:
              description: TUS protocol version
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  upload_id:
                    type: string
                    description: Unique identifier for the upload session
                  upload_url:
                    type: string
                    description: URL to upload chunks to
                  expires_at:
                    type: string
                    format: date-time
                    description: When the upload session expires
                  metadata:
                    type: object
                    properties:
                      filename:
                        type: string
                      size:
                        type: integer
                      os_type:
                        type: string
                      os_variant:
                        type: string
                      architecture:
                        type: string
                      description:
                        type: string
        '400':
          description: Invalid request (missing headers or invalid metadata)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '413':
          description: File size exceeds maximum allowed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: List active ISO upload sessions
      description: Get a list of all active ISO upload sessions for the current user
      tags:
        - Virtualization ISO
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Upload sessions listed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  uploads:
                    type: array
                    items:
                      type: object
                      properties:
                        upload_id:
                          type: string
                        filename:
                          type: string
                        status:
                          type: string
                          enum: [created, in_progress, completed, failed, cancelled]
                        progress:
                          type: string
                          example: "45.50%"
                        total_size:
                          type: integer
                        uploaded_size:
                          type: integer
                        created_at:
                          type: string
                          format: date-time
                        expires_at:
                          type: string
                          format: date-time
                  count:
                    type: integer
                    description: Total number of active uploads
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/isos/upload/{id}:
    head:
      summary: Get upload session info (TUS)
      description: |
        Get information about a resumable upload session for ISO images.
        This follows TUS protocol for HEAD requests.
      tags:
        - Virtualization ISO
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Upload session ID
          schema:
            type: string
      responses:
        '200':
          description: Upload session info retrieved
          headers:
            Upload-Offset:
              description: Current upload offset in bytes
              schema:
                type: string
            Upload-Length:
              description: Total size of the file in bytes
              schema:
                type: string
            Cache-Control:
              description: Cache control header
              schema:
                type: string
                default: no-store
            Tus-Resumable:
              description: TUS protocol version
              schema:
                type: string
        '404':
          description: Upload session not found

    patch:
      summary: Upload ISO chunk (TUS)
      description: |
        Upload a chunk of data for an ISO file using TUS protocol.
        
        Required headers:
        - Upload-Offset: Current offset in bytes
        - Content-Type: Must be "application/offset+octet-stream"
        
        The request body should contain the raw binary data of the chunk.
      tags:
        - Virtualization ISO
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Upload session ID
          schema:
            type: string
        - name: Upload-Offset
          in: header
          required: true
          description: Current offset in bytes
          schema:
            type: integer
        - name: Content-Type
          in: header
          required: true
          description: Must be application/offset+octet-stream
          schema:
            type: string
            enum: [application/offset+octet-stream]
        - name: Tus-Resumable
          in: header
          required: false
          description: TUS protocol version
          schema:
            type: string
            default: "1.0.0"
      requestBody:
        required: true
        content:
          application/offset+octet-stream:
            schema:
              type: string
              format: binary
      responses:
        '204':
          description: Chunk uploaded successfully
          headers:
            Upload-Offset:
              description: New upload offset after this chunk
              schema:
                type: string
            Tus-Resumable:
              description: TUS protocol version
              schema:
                type: string
        '400':
          description: Invalid chunk or headers
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Upload session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Offset mismatch or upload already completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '410':
          description: Upload session expired or cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: Get ISO upload status
      description: Get detailed status of an ISO upload session
      tags:
        - Virtualization ISO
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Upload session ID
          schema:
            type: string
      responses:
        '200':
          description: Upload status retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  upload_id:
                    type: string
                  status:
                    type: string
                    enum: [created, in_progress, completed, failed, cancelled]
                  total_size:
                    type: integer
                  uploaded_size:
                    type: integer
                  progress:
                    type: string
                    example: "75.25%"
                  metadata:
                    type: object
                    properties:
                      filename:
                        type: string
                      os_type:
                        type: string
                      os_variant:
                        type: string
                      architecture:
                        type: string
                      description:
                        type: string
                      tags:
                        type: string
                  created_at:
                    type: string
                    format: date-time
                  updated_at:
                    type: string
                    format: date-time
                  expires_at:
                    type: string
                    format: date-time
        '404':
          description: Upload session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Cancel ISO upload session
      description: Cancel and delete an ISO upload session, removing any uploaded data
      tags:
        - Virtualization ISO
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Upload session ID
          schema:
            type: string
      responses:
        '200':
          description: Upload session cancelled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Upload cancelled successfully"
                  upload_id:
                    type: string
        '404':
          description: Upload session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /virtualization/isos/upload/{id}/complete:
    post:
      summary: Complete ISO upload and register
      description: |
        Complete the upload session and register the ISO in the system.
        This will move the ISO to the final storage location and make it available for VM creation.
      tags:
        - Virtualization ISO
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Upload session ID
          schema:
            type: string
      responses:
        '200':
          description: Upload completed and ISO registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      upload_id:
                        type: string
                      iso:
                        $ref: '#/components/schemas/ISOImage'
                      message:
                        type: string
                        example: "ISO uploaded and registered successfully"
        '400':
          description: Upload not complete or invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Upload session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Failed to register ISO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /virtualization/networks:
    get:
      summary: List all virtual networks
      tags:
        - "Virtualization Network"
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Networks listed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  networks:
                    type: array
                    items:
                      $ref: '#/components/schemas/VirtualNetwork'
        '500':
          $ref: '#/components/responses/InternalError'
    
    post:
      summary: Create a new virtual network
      tags:
        - "Virtualization Network"
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NetworkCreateRequest'
      responses:
        '201':
          description: Virtual network created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VirtualNetworkCreateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/networks/{name}:
    get:
      summary: Get virtual network details
      tags:
        - "Virtualization Network"
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: Network name
      responses:
        '200':
          description: Virtual network details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VirtualNetworkDetailResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    put:
      summary: Update a virtual network
      description: Update an existing virtual network configuration. The network will be stopped if active, updated, and restarted.
      tags:
        - "Virtualization Network"
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: Network name
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NetworkUpdateRequest'
      responses:
        '200':
          description: Virtual network updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VirtualNetworkUpdateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
    delete:
      summary: Delete a virtual network
      tags:
        - "Virtualization Network"
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: Network name
      responses:
        '204':
          description: Virtual network deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/networks/{name}/dhcp-leases:
    get:
      summary: Get DHCP leases for a network
      description: Retrieve active DHCP leases for a virtual network
      tags:
        - "Virtualization Network"
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: Network name
      responses:
        '200':
          description: DHCP leases retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NetworkDHCPLeasesResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/networks/{name}/ports:
    get:
      summary: Get network ports
      description: Retrieve list of ports (VM interfaces) attached to a virtual network
      tags:
        - "Virtualization Network"
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: Network name
      responses:
        '200':
          description: Network ports retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NetworkPortsResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /storage/iscsi/sessions:
    get:
      summary: List iSCSI sessions
      tags:
        - Storage
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Sessions listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ISCSISessionsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/iscsi/login:
    post:
      summary: Login to iSCSI target
      tags:
        - Storage
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ISCSILoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/iscsi/logout:
    post:
      summary: Logout from iSCSI target
      tags:
        - Storage
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ISCSILogoutRequest'
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/multipath/devices:
    get:
      summary: List multipath devices
      tags:
        - Storage
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Multipath devices listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MultipathDevicesResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/multipath/paths:
    get:
      summary: List multipath paths
      tags:
        - Storage
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Multipath paths listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MultipathPathsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/btrfs/subvolumes:
    get:
      summary: List BTRFS subvolumes
      tags:
        - Storage
      security:
        - bearerAuth: []
      parameters:
        - name: mount_point
          in: query
          schema:
            type: string
          required: true
      responses:
        '200':
          description: Subvolumes listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BTRFSSubvolumesResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/btrfs/subvolume:
    post:
      summary: Create BTRFS subvolume
      tags:
        - Storage
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BTRFSSubvolumeRequest'
      responses:
        '200':
          description: Subvolume created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    delete:
      summary: Delete BTRFS subvolume
      tags:
        - Storage
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BTRFSSubvolumeRequest'
      responses:
        '200':
          description: Subvolume deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/btrfs/snapshot:
    post:
      summary: Create BTRFS snapshot
      tags:
        - Storage
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BTRFSSnapshotRequest'
      responses:
        '200':
          description: Snapshot created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/raid/devices:
    get:
      summary: List RAID devices
      tags:
        - Storage
      security:
        - bearerAuth: []
      responses:
        '200':
          description: RAID devices listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RAIDDevicesResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/raid/available-disks:
    get:
      summary: Get available disks for RAID
      tags:
        - Storage
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Available disks listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RAIDAvailableDisksResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/raid/create:
    post:
      summary: Create RAID device
      tags:
        - Storage
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRAIDRequest'
      responses:
        '200':
          description: RAID device created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          description: Invalid request or validation error
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /storage/raid/destroy:
    post:
      summary: Destroy RAID device
      tags:
        - Storage
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DestroyRAIDRequest'
      responses:
        '200':
          description: RAID device destroyed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /docker/ps:
    get:
      summary: List Docker containers
      description: |
        List Docker containers with optional filtering and pagination.
        Returns information about container state, image, ports, and resource usage.
      tags:
        - Docker
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Containers listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DockerContainersResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          description: Docker service unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: DOCKER_ERROR
                  message: "Failed to list containers: Cannot connect to the Docker daemon"

  /docker/images:
    get:
      summary: List Docker images
      description: List all Docker images available on the system
      tags:
        - Docker
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Images listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DockerImagesResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          description: Docker service unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: DOCKER_ERROR
                  message: "Failed to list images: Cannot connect to the Docker daemon"

  /docker/images/pull:
    post:
      summary: Pull Docker image
      description: Pull a Docker image from a registry (e.g., Docker Hub)
      tags:
        - Docker
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ImagePullRequest'
            examples:
              pullNginx:
                summary: Pull nginx image
                value:
                  imageName: nginx
                  tag: latest
              pullAlpine:
                summary: Pull Alpine Linux
                value:
                  imageName: alpine
                  tag: "3.18"
      responses:
        '200':
          description: Image pulled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImagePullResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          description: Failed to pull image
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: PULL_IMAGE_FAILED
                  message: "Failed to pull image: repository does not exist"

  /docker/containers:
    post:
      summary: Create Docker container
      description: Create a new Docker container from an image
      tags:
        - Docker
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContainerCreateRequest'
            examples:
              createNginx:
                summary: Create nginx container
                value:
                  name: my-nginx
                  image: nginx:latest
                  env:
                    - "ENV=production"
                  portBindings:
                    "80/tcp":
                      - hostPort: "8080"
              createUbuntu:
                summary: Create Ubuntu container
                value:
                  name: my-ubuntu
                  image: ubuntu:22.04
                  cmd: ["/bin/bash"]
                  env:
                    - "DEBIAN_FRONTEND=noninteractive"
      responses:
        '201':
          description: Container created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContainerCreateResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          description: Failed to create container
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: CREATE_CONTAINER_FAILED
                  message: "Failed to create container: image not found"

  /docker/images/{id}:
    delete:
      summary: Remove Docker image
      description: Remove a Docker image from the system
      tags:
        - Docker
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Image ID or tag
          schema:
            type: string
      responses:
        '200':
          description: Image removed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageActionResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          description: Failed to remove image
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: REMOVE_IMAGE_FAILED
                  message: "Failed to remove image: Image is being used by running container"

  /docker/networks:
    get:
      summary: List Docker networks
      description: List all Docker networks configured on the system
      tags:
        - Docker
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Networks listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DockerNetworksResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          description: Docker service unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: DOCKER_ERROR
                  message: "Failed to list networks: Cannot connect to the Docker daemon"

  /docker/networks/{id}:
    delete:
      summary: Remove Docker network
      description: Remove a Docker network from the system
      tags:
        - Docker
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Network ID or name
          schema:
            type: string
      responses:
        '200':
          description: Network removed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NetworkActionResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          description: Failed to remove network
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: REMOVE_NETWORK_FAILED
                  message: "Failed to remove network: Network is in use by containers"

  /docker/volumes:
    get:
      summary: List Docker volumes
      description: List all Docker volumes available on the system
      tags:
        - Docker
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Volumes listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DockerVolumesResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          description: Docker service unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: DOCKER_ERROR
                  message: "Failed to list volumes: Cannot connect to the Docker daemon"

  /docker/volumes/{id}:
    delete:
      summary: Remove Docker volume
      description: Remove a Docker volume from the system
      tags:
        - Docker
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Volume name
          schema:
            type: string
      responses:
        '200':
          description: Volume removed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VolumeActionResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          description: Failed to remove volume
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: REMOVE_VOLUME_FAILED
                  message: "Failed to remove volume: Volume is in use by containers"

  /docker/containers/{id}:
    get:
      summary: Get Docker container details
      description: Get detailed information about a specific Docker container
      tags:
        - Docker
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Container ID or name
          schema:
            type: string
      responses:
        '200':
          description: Container details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContainerDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Container not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: CONTAINER_NOT_FOUND
                  message: "Failed to get container detail: No such container"
    delete:
      summary: Remove Docker container
      description: Remove a Docker container (must be stopped first)
      tags:
        - Docker
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Container ID or name
          schema:
            type: string
      responses:
        '200':
          description: Container removed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContainerActionResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          description: Failed to remove container
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: REMOVE_CONTAINER_FAILED
                  message: "Failed to remove container: Cannot remove running container"

  /docker/containers/{id}/start:
    post:
      summary: Start Docker container
      description: Start a stopped Docker container
      tags:
        - Docker
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Container ID or name
          schema:
            type: string
      responses:
        '200':
          description: Container started successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContainerActionResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          description: Failed to start container
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: START_CONTAINER_FAILED
                  message: "Failed to start container: Container already running"

  /docker/containers/{id}/stop:
    post:
      summary: Stop Docker container
      description: Stop a running Docker container
      tags:
        - Docker
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Container ID or name
          schema:
            type: string
      responses:
        '200':
          description: Container stopped successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContainerActionResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          description: Failed to stop container
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: STOP_CONTAINER_FAILED
                  message: "Failed to stop container: Container not running"

  /docker/containers/{id}/kill:
    post:
      summary: Kill Docker container
      description: Forcefully kill a running Docker container using SIGKILL
      tags:
        - Docker
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Container ID or name
          schema:
            type: string
      responses:
        '200':
          description: Container killed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContainerActionResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          description: Failed to kill container
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: KILL_CONTAINER_FAILED
                  message: "Failed to kill container: Container not running"

  /docker/containers/{id}/logs:
    get:
      summary: Get Docker container logs
      description: Get logs from a Docker container
      tags:
        - Docker
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Container ID or name
          schema:
            type: string
      responses:
        '200':
          description: Container logs retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContainerLogsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          description: Failed to get logs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: GET_LOGS_FAILED
                  message: "Failed to get container logs: Container not found"

  /users:
    get:
      summary: List users
      tags:
        - Users
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsersResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    
    post:
      summary: Create user
      tags:
        - Users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRequest'
      responses:
        '200':
          description: User created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /users/{username}:
    put:
      summary: Update user
      tags:
        - Users
      security:
        - bearerAuth: []
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRequest'
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    
    delete:
      summary: Delete user
      tags:
        - Users
      security:
        - bearerAuth: []
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: User deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /users/{username}/reset-password:
    post:
      summary: Reset user password
      tags:
        - Users
      security:
        - bearerAuth: []
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: The username of the user whose password to reset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordResetRequest'
      responses:
        '200':
          description: Password reset successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          description: Bad request (invalid password format)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '501':
          description: Not implemented (on non-Linux systems)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /logs:
    get:
      summary: Query system logs
      tags:
        - Logs
      security:
        - bearerAuth: []
      parameters:
        - name: service
          in: query
          schema:
            type: string
          description: Filter by service name
        - name: priority
          in: query
          schema:
            type: string
            enum: [emergency, alert, critical, error, warning, notice, info, debug]
          description: Filter by priority
        - name: since
          in: query
          schema:
            type: string
          description: Show logs since timestamp
        - name: until
          in: query
          schema:
            type: string
          description: Show logs until timestamp
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 100
            maximum: 1000
      responses:
        '200':
          description: Log entries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /system/summary:
    get:
      summary: Get system summary
      tags:
        - System
      security:
        - bearerAuth: []
      responses:
        '200':
          description: System summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemSummaryResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /system/hardware:
    get:
      summary: Get hardware information
      tags:
        - System
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Hardware information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HardwareResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /system/memory:
    get:
      summary: Get memory information
      tags:
        - System
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Memory information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MemoryResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /system/cpu:
    get:
      summary: Get CPU information
      tags:
        - System
      security:
        - bearerAuth: []
      responses:
        '200':
          description: CPU information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CPUResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /ws/metrics:
    get:
      summary: WebSocket endpoint for live system metrics
      description: |
        Establish a WebSocket connection to receive real-time system metrics.
        
        **WebSocket URL**: `ws://localhost:8080/ws/metrics`
        
        **Authentication**: Send JWT token in the first message after connection:
        ```json
        {
          "type": "auth",
          "payload": {
            "token": "your-jwt-token"
          }
        }
        ```
        
        **Subscribe to metrics**:
        ```json
        {
          "type": "subscribe"
        }
        ```
        
        **Unsubscribe from metrics**:
        ```json
        {
          "type": "unsubscribe"
        }
        ```
        
        **Server messages** will be in the format:
        ```json
        {
          "type": "metric",
          "metric": "cpu",
          "timestamp": "2024-01-01T00:00:00Z",
          "data": { ... }
        }
        ```
      tags:
        - WebSocket
      security:
        - bearerAuth: []
      responses:
        '101':
          description: Switching Protocols - WebSocket connection established
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /ws/logs:
    get:
      summary: WebSocket endpoint for live system logs
      description: |
        Establish a WebSocket connection to receive real-time system logs.
        
        **WebSocket URL**: `ws://localhost:8080/ws/logs`
        
        **Authentication**: Send JWT token in the first message after connection:
        ```json
        {
          "type": "auth",
          "payload": {
            "token": "your-jwt-token"
          }
        }
        ```
        
        **Subscribe Examples**:
        
        1. All logs from all services (most verbose):
        ```json
        {
          "type": "subscribe",
          "payload": {
            "filters": {
              "follow": true
            }
          }
        }
        ```
        
        2. Specific service logs:
        ```json
        {
          "type": "subscribe",
          "payload": {
            "filters": {
              "unit": "sshd",
              "priority": "info",
              "follow": true
            }
          }
        }
        ```
        
        3. Kernel messages:
        ```json
        {
          "type": "subscribe",
          "payload": {
            "filters": {
              "unit": "kernel",
              "follow": true
            }
          }
        }
        ```
        
        4. Recent logs (last 10 minutes):
        ```json
        {
          "type": "subscribe",
          "payload": {
            "filters": {
              "since": "10 minutes ago",
              "follow": true
            }
          }
        }
        ```
        
        **Server Response Format**:
        ```json
        {
          "type": "data",
          "payload": {
            "timestamp": "2024-01-15T10:30:00Z",
            "level": "info",
            "unit": "sshd.service",
            "message": "Accepted publickey for john from 192.168.1.100 port 52341 ssh2"
          }
        }
        ```
        
        **Priority Levels** (from least to most severe):
        - `debug` - Debugging messages
        - `info` - Informational messages  
        - `notice` - Normal but significant messages
        - `warning` - Warning messages
        - `error` - Error messages
        - `critical` - Critical messages
      tags:
        - WebSocket
      security:
        - bearerAuth: []
      responses:
        '101':
          description: Switching Protocols - WebSocket connection established
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  
  /virtualization/computes:
    get:
      summary: List all virtual machines
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      responses:
        '200':
          description: A list of virtual machines
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VirtualMachinesResponse'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      summary: Create a new virtual machine
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VMCreateRequest'
      responses:
        '201':
          description: Virtual machine created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VMCreateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/{id}:
    get:
      summary: Get virtual machine details
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: VM name or UUID
      responses:
        '200':
          description: Virtual machine details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VMDetailResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    put:
      summary: Update a virtual machine
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: VM name or UUID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VMUpdateRequest'
      responses:
        '200':
          description: Virtual machine updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VMUpdateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    delete:
      summary: Delete a virtual machine
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: VM name or UUID
        - name: remove_disks
          in: query
          required: false
          schema:
            type: boolean
          description: Whether to remove associated storage disks
      responses:
        '204':
          description: Virtual machine deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/{id}/migrate:
    post:
      summary: Migrate VM to another host
      description: |
        Initiate live or offline migration of a virtual machine to another host.
        
        **Prerequisites for SSH-based Migration:**
        
        When using SSH transport (e.g., `qemu+ssh://host2.example.com/system`):
        
        1. **SSH Key Authentication Required:**
           - The source host must have passwordless SSH access to the destination host
           - The user running libvirtd (typically `root` or `libvirt`) needs SSH keys configured
        
        2. **Setup Steps:**
           ```bash
           # On source host (as root or libvirt user):
           ssh-keygen -t rsa -N "" -f ~/.ssh/id_rsa
           ssh-copy-id root@destination-host
           
           # Verify connectivity:
           ssh root@destination-host 'virsh list'
           ```
        
        3. **Both Hosts Requirements:**
           - Same libvirt version (recommended)
           - Compatible CPU architectures
           - Shared storage (for disk migration) or use `copy_storage` parameter
           - Network connectivity between hosts
           - Sufficient resources on destination host
        
        4. **Alternative Transport Options:**
           - `qemu+tcp://` - Unencrypted TCP (not recommended)
           - `qemu+tls://` - TLS with certificates (more secure for production)
           - `qemu+ssh://user@host/system` - SSH with specific user
        
        5. **Security Best Practices:**
           - Use dedicated service accounts instead of root
           - Restrict SSH keys to libvirt commands only
           - Consider TLS for production environments
           - Ensure firewall rules allow migration traffic
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: VM name or UUID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MigrationRequest'
      responses:
        '202':
          description: Migration initiated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MigrationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/{id}/migration/status:
    get:
      summary: Get migration status
      description: Check the status of an ongoing VM migration
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: VM name or UUID
        - name: migration_id
          in: query
          required: false
          schema:
            type: string
          description: Migration ID to check status for
      responses:
        '200':
          description: Migration status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MigrationStatusResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/{id}/console:
    get:
      summary: Get VM console information
      description: |
        Retrieves console connection information for a virtual machine and generates a secure access token.
        The token is valid for a limited time (default 5 minutes) and can only be used once.
      tags:
        - "Virtualization Compute"
      operationId: getVMConsole
      parameters:
        - name: id
          in: path
          required: true
          description: VM ID (name or UUID)
          schema:
            type: string
        - name: type
          in: query
          required: false
          description: Console type preference
          schema:
            type: string
            enum: [vnc, spice]
            default: vnc
      responses:
        '200':
          description: Console information retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsoleInfo'
              example:
                type: vnc
                host: localhost
                port: 5901
                token: "a1b2c3d4e5f6789..."
                ws_path: "/api/v1/virtualization/computes/vm-123/console/ws"
                expires_at: "2024-01-15T10:30:00Z"
                tls_enabled: false
                password: "********"
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - bearerAuth: []

  /virtualization/computes/{id}/console/ws:
    get:
      summary: WebSocket console connection
      description: |
        Establishes a WebSocket connection for VM console access. This endpoint upgrades the HTTP connection
        to a WebSocket connection and proxies data between the client and the VM's VNC/SPICE server.
        
        **Protocol**: WebSocket (ws:// or wss://)
        
        **Data Flow**: Binary frames containing VNC/SPICE protocol data
        
        **Error Messages**: JSON messages for errors and status updates
      tags:
        - "Virtualization Compute"
      operationId: vmConsoleWebSocket
      parameters:
        - name: id
          in: path
          required: true
          description: VM ID (name or UUID)
          schema:
            type: string
        - name: token
          in: query
          required: true
          description: Access token from console information endpoint
          schema:
            type: string
      responses:
        '101':
          description: Switching Protocols - WebSocket connection established
        '400':
          description: Bad Request - Missing or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Invalid or expired token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsoleError'
        '503':
          description: Service Unavailable - Console proxy not available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
        - bearerAuth: []

  /virtualization/computes/{id}/console/stats:
    get:
      summary: Get console connection statistics
      description: |
        Retrieves statistics about active console connections for monitoring and debugging purposes.
      tags:
        - "Virtualization Compute"
      operationId: getVMConsoleStats
      parameters:
        - name: id
          in: path
          required: true
          description: VM ID (name or UUID)
          schema:
            type: string
      responses:
        '200':
          description: Console statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  active_connections:
                    type: integer
                    description: Number of active console connections for this VM
                  total_bytes_sent:
                    type: integer
                    format: int64
                    description: Total bytes sent to clients
                  total_bytes_received:
                    type: integer
                    format: int64
                    description: Total bytes received from clients
                  connections:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        established:
                          type: string
                          format: date-time
                        last_activity:
                          type: string
                          format: date-time
                        bytes_sent:
                          type: integer
                          format: int64
                        bytes_received:
                          type: integer
                          format: int64
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - bearerAuth: []
  
  /virtualization/computes/pci-devices:
    get:
      summary: List available PCI devices
      description: |
        List all PCI devices available for passthrough to virtual machines.
        This includes GPUs, network cards, storage controllers, USB controllers, and other PCI devices.
        
        **Prerequisites:**
        - IOMMU must be enabled in BIOS/UEFI and kernel
        - Devices must be in separate IOMMU groups for passthrough
        - vfio-pci driver must be loaded
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: type
          in: query
          required: false
          schema:
            type: string
            enum: [gpu, network, storage, usb, other]
          description: Filter devices by type
      responses:
        '200':
          description: PCI devices listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PCIDevicesResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/{id}/pci-devices:
    post:
      summary: Attach PCI device to VM
      description: |
        Attach a PCI device to a virtual machine for passthrough.
        
        **Important Notes:**
        - VM must be powered off for initial PCI passthrough setup
        - All devices in the same IOMMU group must be passed through together
        - Device will be unbound from host driver and bound to vfio-pci
        - For GPUs, consider passing through audio device as well
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: VM name or UUID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PCIPassthroughRequest'
      responses:
        '200':
          description: PCI device attached successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PCIAttachResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Device already in use or IOMMU group conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/{id}/pci-devices/{device_id}:
    delete:
      summary: Detach PCI device from VM
      description: |
        Detach a PCI device from a virtual machine.
        
        **Notes:**
        - VM should be powered off for safe removal
        - Device will be unbound from vfio-pci and may rebind to original driver
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: VM name or UUID
        - name: device_id
          in: path
          required: true
          schema:
            type: string
          description: PCI device ID (e.g., pci_0000_01_00_0)
      responses:
        '200':
          description: PCI device detached successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PCIDetachResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/{id}/hotplug:
    post:
      summary: Hotplug resources to VM
      description: |
        Dynamically add or remove resources to/from a running virtual machine.
        
        **Supported Resources:**
        - **CPU**: Add vCPUs (removal not supported on most guests)
        - **Memory**: Add memory (removal requires guest support)
        - **Disk**: Add/remove storage devices
        - **Network**: Add/remove network interfaces
        - **USB**: Add/remove USB devices
        
        **Requirements:**
        - VM must be running for hotplug operations
        - Guest OS must support hotplug for the resource type
        - ACPI hotplug must be enabled in VM configuration
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: VM name or UUID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HotplugRequest'
      responses:
        '200':
          description: Hotplug operation completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HotplugResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: VM not running or resource conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/{id}/snapshots/capabilities:
    get:
      summary: Check VM snapshot capabilities
      description: |
        Check what snapshot operations are supported for a VM based on its disk formats.
        
        This endpoint analyzes all disks attached to the VM and determines:
        - Whether internal snapshots are supported (requires all disks to be qcow2)
        - Whether external snapshots are supported (always supported)
        - Whether memory snapshots are supported (requires qcow2 for all disks)
        - Disk format limitations and recommendations
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: VM name or UUID
      responses:
        '200':
          description: Snapshot capabilities retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VMSnapshotCapabilitiesResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/{id}/snapshots:
    get:
      summary: List VM snapshots
      description: Retrieve all snapshots for a specific virtual machine
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: VM name or UUID
      responses:
        '200':
          description: Snapshots retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VMSnapshotsListResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
    
    post:
      summary: Create VM snapshot with enhanced format checking
      description: |
        Create a new snapshot of a virtual machine with enhanced disk format validation.
        
        This endpoint performs comprehensive format checking for all VM disks and determines
        the appropriate snapshot type based on disk formats and user preferences.
        
        **Snapshot Types:**
        - **Internal**: All disk states stored within existing disk files (requires all disks to be qcow2)
        - **External**: Creates new files for disk states (supports any disk format)
        - **Internal-Memory**: Internal snapshot with memory state (requires qcow2 and running VM)
        
        **Format Requirements:**
        - Internal snapshots: All disks must be qcow2 format
        - External snapshots: Works with any disk format (raw, qcow2, vmdk, etc.)
        - Memory snapshots: Requires qcow2 format for all disks
        
        **Validation Checks:**
        - Disk format compatibility
        - VM state compatibility
        - Storage availability
        - Guest agent availability (for quiesce)
        
        **Warning Conditions:**
        - Mixed disk formats detected
        - Raw format disks requiring external snapshots
        - Large memory state warnings
        - Quiesce requested but guest agent unavailable
        
        **Best Practices:**
        - Use quiesce for database workloads when guest agent is available
        - Consider external snapshots for mixed format environments
        - Monitor storage space before creating snapshots
        - Test snapshot restoration in non-production first
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: VM name or UUID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VMSnapshotRequest'
      responses:
        '201':
          description: Snapshot created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VMSnapshotResponse'
        '400':
          description: |
            Bad request - validation failed. Common reasons:
            - Internal snapshot requested but disks not all qcow2
            - Memory snapshot requested with incompatible disk formats
            - Invalid snapshot name or parameters
            - Insufficient storage space
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                formatMismatch:
                  summary: Disk format incompatible with internal snapshots
                  value:
                    status: error
                    error:
                      code: INVALID_DISK_FORMAT
                      message: "Cannot create internal snapshot: disk 'vda' has format 'raw'. All disks must be qcow2 for internal snapshots."
                      details: "Use force_external=true or convert disks to qcow2 format"
                mixedFormats:
                  summary: Mixed disk formats detected
                  value:
                    status: error
                    error:
                      code: MIXED_DISK_FORMATS
                      message: "VM has mixed disk formats (qcow2, raw). External snapshot will be used."
                      details: "Disks: vda (qcow2), vdb (raw)"
                      data:
                        warnings:
                          - "External snapshot required due to raw format disk 'vdb'"
                          - "Consider converting all disks to qcow2 for internal snapshot support"
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          description: |
            Unprocessable entity - snapshot cannot be created due to VM state or configuration.
            Common reasons:
            - VM doesn't support snapshots
            - Transient VM (non-persistent)
            - VM in migration state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                unsupported:
                  summary: VM doesn't support snapshots
                  value:
                    status: error
                    error:
                      code: SNAPSHOTS_NOT_SUPPORTED
                      message: "This VM configuration does not support snapshots"
                      details: "VM may be transient or have unsupported devices attached"
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/{id}/snapshots/{snapshot}:
    get:
      summary: Get snapshot details
      description: Retrieve details of a specific VM snapshot
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: VM name or UUID
        - name: snapshot
          in: path
          required: true
          schema:
            type: string
          description: Snapshot name
      responses:
        '200':
          description: Snapshot details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VMSnapshotDetailResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
    
    delete:
      summary: Delete VM snapshot
      description: Delete a specific snapshot of a virtual machine
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: VM name or UUID
        - name: snapshot
          in: path
          required: true
          schema:
            type: string
          description: Snapshot name to delete
      responses:
        '204':
          description: Snapshot deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/{id}/snapshots/{snapshot}/revert:
    post:
      summary: Revert to snapshot
      description: |
        Revert a virtual machine to a previous snapshot state.
        
        **Warning:** This operation will:
        - Discard all changes made since the snapshot was taken
        - Restore the VM to the exact state when the snapshot was created
        - Cannot be undone without another snapshot
        
        **Note:** If the snapshot includes memory state, the VM will resume
        from the exact running state. Otherwise, the VM will be in a stopped state.
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: VM name or UUID
        - name: snapshot
          in: path
          required: true
          schema:
            type: string
          description: Snapshot name to revert to
      responses:
        '200':
          description: VM reverted to snapshot successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VMSnapshotRevertResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Conflict - VM is in a state that prevents reverting
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/{id}/backups:
    get:
      summary: List VM backups
      description: List all backups for a specific virtual machine
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: VM name or UUID
      responses:
        '200':
          description: Backups listed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  backups:
                    type: array
                    items:
                      $ref: '#/components/schemas/VMBackup'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
    
    post:
      summary: Create VM backup
      description: |
        Create a backup of a virtual machine.
        
        **Backup Types:**
        - `full`: Complete backup of all VM disks
        - `incremental`: Only changes since last backup
        - `differential`: Changes since last full backup
        
        **Options:**
        - Compression (gzip, bzip2, xz, zstd)
        - Encryption (AES-256, AES-128)
        - Include memory state
        - Custom retention period
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: VM name or UUID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VMBackupRequest'
      responses:
        '202':
          description: Backup initiated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VMBackup'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/restore:
    post:
      summary: Restore VM from backup
      description: |
        Restore a virtual machine from a backup.
        
        **Options:**
        - Restore to new VM with different name
        - Overwrite existing VM
        - Decrypt encrypted backups
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VMRestoreRequest'
      responses:
        '200':
          description: VM restored successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VMResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: Backup not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflict - VM already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/backups/{backup_id}:
    delete:
      summary: Delete VM backup
      description: Delete a specific VM backup
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: backup_id
          in: path
          required: true
          schema:
            type: string
          description: Backup ID
      responses:
        '204':
          description: Backup deleted successfully
        '404':
          description: Backup not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/templates:
    get:
      summary: List VM templates
      description: |
        List all available VM templates from the system.
        
        Templates provide pre-configured VM specifications that can be used
        to quickly create new virtual machines with optimal settings for
        specific operating systems and use cases.
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Templates listed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  templates:
                    type: array
                    items:
                      $ref: '#/components/schemas/VMTemplate'
        '500':
          $ref: '#/components/responses/InternalError'
    
    post:
      summary: Create VM template
      description: |
        Create a new VM template with specific requirements and recommendations.
        
        Templates define minimum and recommended specifications for VMs,
        including memory, CPU, disk, and optional features like UEFI boot,
        Secure Boot, and TPM support.
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VMTemplateCreateRequest'
      responses:
        '201':
          description: Template created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VMTemplate'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Template with same name already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/templates/{id}:
    get:
      summary: Get VM template details
      description: Get detailed information about a specific VM template
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Template ID
      responses:
        '200':
          description: Template details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VMTemplate'
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalError'
    
    put:
      summary: Update VM template
      description: Update an existing VM template
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Template ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VMTemplateUpdateRequest'
      responses:
        '200':
          description: Template updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VMTemplate'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalError'
    
    delete:
      summary: Delete VM template
      description: Delete a VM template from the system
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Template ID
      responses:
        '204':
          description: Template deleted successfully
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/from-template:
    post:
      summary: Create VM from template
      description: |
        Create a new virtual machine using a predefined template.
        
        The template provides base specifications including minimum and recommended
        values for memory, vCPUs, and disk size. User-provided values will override
        template recommendations but must meet minimum requirements.
        
        **Template Application:**
        - If user values are not provided, template recommended values are used
        - If template has no recommendation, minimum values are used
        - User values are validated against template minimum requirements
        - Template settings for OS, network, graphics, and cloud-init are applied
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - template_id
                - name
              properties:
                template_id:
                  type: integer
                  description: Template ID to use for VM creation
                  example: 1
                name:
                  type: string
                  description: Name for the new VM
                  example: "my-ubuntu-vm"
                memory:
                  type: integer
                  description: Memory in MB (overrides template recommendation, must meet minimum)
                  example: 4096
                vcpus:
                  type: integer
                  description: Number of vCPUs (overrides template recommendation, must meet minimum)
                  example: 2
                disk_size:
                  type: integer
                  description: Disk size in GB (overrides template recommendation, must meet minimum)
                  example: 50
                network:
                  type: object
                  description: Network configuration (overrides template defaults)
                  properties:
                    type:
                      type: string
                      enum: [bridge, nat, direct, user]
                      description: Network type
                    source:
                      type: string
                      description: Network source (bridge name, network name, etc.)
                    model:
                      type: string
                      enum: [virtio, e1000, rtl8139]
                      description: Network adapter model
                    mac:
                      type: string
                      description: MAC address (auto-generated if not specified)
                graphics:
                  type: object
                  description: Graphics configuration (overrides template defaults)
                  properties:
                    type:
                      type: string
                      enum: [vnc, spice, none]
                      description: Graphics type
                    port:
                      type: integer
                      description: Graphics port (auto-assigned if -1 or not specified)
                    listen:
                      type: string
                      description: Listen address
                      default: "0.0.0.0"
                    password:
                      type: string
                      description: Graphics password for authentication
                cloud_init:
                  type: object
                  description: Cloud-init configuration (if template supports cloud-init)
                  properties:
                    users:
                      type: array
                      description: Users to create
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                          password:
                            type: string
                          ssh_keys:
                            type: array
                            items:
                              type: string
                          sudo:
                            type: string
                          groups:
                            type: string
                          shell:
                            type: string
                    hostname:
                      type: string
                      description: Hostname to set
                    packages:
                      type: array
                      description: Packages to install
                      items:
                        type: string
                    runcmd:
                      type: array
                      description: Commands to run on first boot
                      items:
                        type: string
                metadata:
                  type: object
                  description: Additional metadata for the VM
                  additionalProperties:
                    type: string
      responses:
        '201':
          description: VM created successfully from template
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VMCreateResponse'
        '400':
          description: |
            Bad request - validation error.
            This can occur when:
            - Required fields are missing
            - User values don't meet template minimum requirements
            - Invalid configuration provided
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/computes/create-enhanced:
    post:
      summary: Create VM with enhanced configuration (v2)
      description: |
        Create a new virtual machine with enhanced disk and device configuration options.
        
        **BREAKING CHANGE (v2):**
        - Storage configuration now nested under "storage" object
        - "storage_pool", "iso_path", and "disks" at root level removed
        - PCI device passthrough support added
        - Required fields: name, memory, vcpus, storage
        
        **Key Features:**
        - Multiple disk support (new, existing, or cloned)
        - Flexible ISO management
        - Advanced network and graphics configuration
        - Cloud-init support
        - Template-based creation
        
        **Disk Configuration Options:**
        - Create new disks with custom sizes and formats
        - Attach existing disk images
        - Clone from existing disks
        
        **ISO Management:**
        - Reference ISOs by ID, name, or path
        - Automatic ISO resolution from multiple sources
      tags:
        - "Virtualization Compute"
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VMCreateRequestEnhancedV2"
            examples:
              simple_vm:
                summary: Simple VM with boot ISO
                value:
                  name: "ubuntu-vm"
                  memory: 2048
                  vcpus: 2
                  storage:
                    default_pool: "default"
                    boot_iso: "ubuntu-22.04.iso"
                    disks:
                      - action: "create"
                        size: 20
              gpu_passthrough:
                summary: VM with GPU passthrough
                value:
                  name: "gpu-workstation"
                  memory: 32768
                  vcpus: 16
                  storage:
                    default_pool: "fast-nvme"
                    boot_iso: "ubuntu-desktop.iso"
                    disks:
                      - action: "create"
                        size: 100
                        format: "qcow2"
                  pci_devices:
                    - host_address: "0000:01:00.0"
                      rom_file: "/usr/share/vgabios/rtx3080.rom"
                      primary_gpu: true
                    - host_address: "0000:01:00.1"
                  graphics:
                    - type: "none"
              multi_disk_vm:
                summary: VM with multiple disks from different pools
                value:
                  name: "database-server"
                  memory: 16384
                  vcpus: 8
                  storage:
                    default_pool: "fast-nvme"
                    disks:
                      - action: "create"
                        size: 50
                        format: "qcow2"
                      - action: "create"
                        size: 500
                        storage_pool: "bulk-storage"
                      - action: "attach"
                        path: "/mnt/shared/data.qcow2"
              comprehensive_example:
                summary: Complete VM configuration with all available fields
                description: |
                  This example demonstrates all available configuration options for creating
                  a virtual machine, including advanced features like PCI passthrough, cloud-init,
                  multiple disks, networks, and custom metadata.
                value:
                  name: "enterprise-workstation"
                  memory: 32768
                  vcpus: 16
                  storage:
                    default_pool: "fast-nvme"
                    boot_iso: "ubuntu-22.04-server.iso"
                    disks:
                      # Primary OS disk - create new
                      - action: "create"
                        size: 100
                        format: "qcow2"
                        bus: "virtio"
                        boot_order: 1
                        cache: "writeback"
                        io_mode: "native"
                        target: "vda"
                      # Data disk - create new in different pool
                      - action: "create"
                        size: 500
                        format: "raw"
                        storage_pool: "bulk-storage"
                        bus: "virtio"
                        cache: "writethrough"
                        target: "vdb"
                      # Clone from template disk
                      - action: "clone"
                        clone_from: "/var/lib/libvirt/images/templates/base-ubuntu.qcow2"
                        storage_pool: "templates"
                        bus: "virtio"
                        target: "vdc"
                      # Attach existing disk
                      - action: "attach"
                        path: "/mnt/shared/database.qcow2"
                        bus: "scsi"
                        readonly: true
                        target: "sda"
                      # CD-ROM device
                      - action: "attach"
                        path: "/var/lib/libvirt/images/iso/drivers.iso"
                        device: "cdrom"
                        bus: "ide"
                        readonly: true
                        target: "hdc"
                  os_type: "linux"
                  os_variant: "ubuntu22.04"
                  architecture: "x86_64"
                  uefi: true
                  secure_boot: true
                  tpm: true
                  networks:
                    # Default NAT network
                    - type: "network"
                      source: "default"
                      model: "virtio"
                    # Bridge network with specific MAC
                    - type: "bridge"
                      source: "br0"
                      model: "virtio"
                      mac: "52:54:00:12:34:56"
                    # Direct network (macvtap)
                    - type: "direct"
                      source: "eth0"
                      model: "e1000"
                    # Isolated user network
                    - type: "user"
                      model: "rtl8139"
                  graphics:
                    # Primary VNC console
                    - type: "vnc"
                      port: 5900
                      autoport: false
                      listen: "0.0.0.0"
                      password: "SecureVNC123!"
                    # Secondary SPICE console
                    - type: "spice"
                      port: 5901
                      autoport: true
                      listen: "127.0.0.1"
                      password: "SpicePass456!"
                    # Headless EGL for GPU rendering
                    - type: "egl-headless"
                  pci_devices:
                    # GPU passthrough
                    - host_address: "0000:01:00.0"
                      guest_address: "0000:05:00.0"
                      rom_file: "/usr/share/vgabios/nvidia_rtx3080.rom"
                      multifunction: true
                      primary_gpu: true
                    # GPU audio device
                    - host_address: "0000:01:00.1"
                      guest_address: "0000:05:00.1"
                      multifunction: true
                    # NVMe controller passthrough
                    - host_address: "0000:02:00.0"
                    # USB controller passthrough
                    - host_address: "0000:00:14.0"
                  cloud_init:
                    user_data: |
                      #cloud-config
                      hostname: enterprise-workstation
                      manage_etc_hosts: true
                      package_update: true
                      package_upgrade: true
                      timezone: UTC
                      
                      write_files:
                        - path: /etc/sysctl.d/99-custom.conf
                          content: |
                            net.ipv4.ip_forward=1
                            vm.swappiness=10
                      
                      runcmd:
                        - sysctl -p /etc/sysctl.d/99-custom.conf
                        - curl -fsSL https://get.docker.com | sh
                        - systemctl enable docker
                        - usermod -aG docker ubuntu
                    meta_data: |
                      instance-id: i-enterprise-001
                      local-hostname: enterprise-workstation
                      network-interfaces: |
                        auto eth0
                        iface eth0 inet dhcp
                    network_data: |
                      version: 2
                      ethernets:
                        enp0s3:
                          dhcp4: true
                        enp0s8:
                          addresses:
                            - 192.168.100.10/24
                          gateway4: 192.168.100.1
                          nameservers:
                            addresses:
                              - 8.8.8.8
                              - 8.8.4.4
                    ssh_keys:
                      - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDYnGqA... admin@company.com"
                      - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMe8R... backup@company.com"
                    users:
                      - name: "admin"
                        ssh_authorized_keys:
                          - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDYnGqA... admin@company.com"
                        sudo: "ALL=(ALL) NOPASSWD:ALL"
                        groups: "admin,docker,wheel,kvm,libvirt"
                        shell: "/bin/bash"
                      - name: "developer"
                        ssh_authorized_keys:
                          - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMe8R... dev@company.com"
                        sudo: "ALL=(ALL) ALL"
                        groups: "docker,developers"
                        shell: "/bin/zsh"
                        password: "$6$rounds=4096$saltsalt$hashedpasswordhere"
                      - name: "monitoring"
                        groups: "systemd-journal"
                        shell: "/bin/sh"
                    packages:
                      - "docker.io"
                      - "docker-compose"
                      - "git"
                      - "vim"
                      - "htop"
                      - "build-essential"
                      - "python3-pip"
                      - "curl"
                      - "wget"
                      - "net-tools"
                      - "nvidia-driver-525"
                  template: "ubuntu-22.04-base"
                  autostart: true
                  custom_xml: |
                    <features>
                      <acpi/>
                      <apic/>
                      <hyperv>
                        <relaxed state='on'/>
                        <vapic state='on'/>
                        <spinlocks state='on' retries='8191'/>
                      </hyperv>
                    </features>
                    <cpu mode='host-passthrough' check='none'>
                      <topology sockets='1' cores='8' threads='2'/>
                    </cpu>
                  metadata:
                    environment: "production"
                    department: "engineering"
                    project: "ai-workstation"
                    owner: "john.doe@company.com"
                    cost_center: "ENG-2024"
                    backup_policy: "daily"
                    monitoring: "enabled"
                    compliance: "pci-dss"
                    created_by: "terraform"
                    managed_by: "vapor"
      responses:
        '201':
          description: Virtual machine created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VMCreateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/isos:
    get:
      summary: List available ISO images
      description: |
        List all available ISO images from the system.
        
        **Sources:**
        - Database-managed ISOs
        - ISOs in /var/lib/libvirt/images/iso
        - ISOs in /var/lib/vapor/iso
        - ISOs in /usr/share/iso
      tags:
        - "Virtualization ISO"
      security:
        - bearerAuth: []
      responses:
        '200':
          description: ISO images listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ISOImagesResponse'
        '500':
          $ref: '#/components/responses/InternalError'
    
    post:
      summary: Upload ISO image
      description: |
        Upload (non resumable) a new ISO image to the system.
        
        **Options:**
        - Direct file upload
        - Download from URL
        - Copy from existing path
      tags:
        - "Virtualization ISO"
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: ISO file to upload
                name:
                  type: string
                  description: Name for the ISO
                description:
                  type: string
                  description: Description of the ISO
          application/json:
            schema:
              type: object
              properties:
                url:
                  type: string
                  description: URL to download ISO from
                path:
                  type: string
                  description: Local path to copy ISO from
                name:
                  type: string
                  description: Name for the ISO
                description:
                  type: string
                  description: Description of the ISO
      responses:
        '201':
          description: ISO uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ISOUploadResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /virtualization/isos/{id}:
    delete:
      summary: Delete ISO image
      description: Delete an ISO image from the system
      tags:
        - "Virtualization ISO"
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ISO ID or filename
      responses:
        '204':
          description: ISO deleted successfully
        '404':
          description: ISO not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /ws/terminal:
    get:
      summary: WebSocket Terminal Connection
      description: |
        Establish a WebSocket connection for an interactive terminal session.
        
        **WebSocket URL**: `ws://localhost:8080/ws/terminal`
        
        **Authentication**: Send JWT token in the first message after connection:
        ```json
        {
          "type": "auth",
          "payload": {
            "token": "your-jwt-token"
          }
        }
        ```
        
        **Start terminal session**:
        ```json
        {
          "type": "subscribe",
          "payload": {
            "cols": 80,
            "rows": 24,
            "shell": "/bin/bash"
          }
        }
        ```
        
        **Send input**:
        ```json
        {
          "type": "input",
          "data": "ls -la\n"
        }
        ```
        
        **Resize terminal**:
        ```json
        {
          "type": "resize",
          "payload": {
            "cols": 120,
            "rows": 40
          }
        }
        ```
        
        **Server messages** will be in the format:
        ```json
        {
          "type": "output",
          "data": "terminal output..."
        }
        ```
      tags:
        - WebSocket
      security:
        - bearerAuth: []
      responses:
        '101':
          description: Switching Protocols - WebSocket connection established
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /kubernetes/customresourcedefinitions:
    get:
      summary: List all Kubernetes Custom Resource Definitions
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: CRDs listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CRDsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/customresourcedefinitions/{name}:
    get:
      summary: Get detailed CRD information
      description: Get detailed information about a specific Custom Resource Definition
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: CRD name
          schema:
            type: string
      responses:
        '200':
          description: CRD details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CRDDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: CRD not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/customresourcedefinitions/{name}/instances:
    get:
      summary: List all objects for a specific CRD
      description: List all Kubernetes objects for a specific Custom Resource Definition
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: CRD name
          schema:
            type: string
        - name: namespace
          in: query
          required: false
          description: Namespace to filter objects by. If not provided, all namespaces are searched for cluster-scoped CRDs, and the default namespace is used for namespaced-scoped CRDs.
          schema:
            type: string
      responses:
        '200':
          description: CRD objects listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CRDObjectListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: CRD not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/customresourcedefinitions/{name}/instances/{namespace}/{object-name}:
    get:
      summary: Get detailed CRD object information
      description: Get detailed information about a specific CRD object. For namespaced CRDs, provide the actual namespace. For cluster-scoped CRDs, use '-' as the namespace.
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: CRD name
          schema:
            type: string
        - name: namespace
          in: path
          required: true
          description: Namespace for the CRD object. Use '-' for cluster-scoped CRDs, or the actual namespace name for namespaced CRDs.
          schema:
            type: string
        - name: object-name
          in: path
          required: true
          description: The name of the CRD object
          schema:
            type: string
      responses:
        '200':
          description: CRD object details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CRDObjectDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: CRD or object not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/pods:
    get:
      summary: List all pods in the cluster
      description: List all pods across all namespaces in the Kubernetes cluster
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Pods listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PodsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    post:
      summary: Create or update a pod
      description: |
        Create a new pod or update an existing pod using Kubernetes apply semantics.
        
        Supports both JSON and YAML content types:
        - For JSON: Set Content-Type to "application/json"
        - For YAML: Set Content-Type to "application/yaml" or "text/yaml"
        
        If no Content-Type is specified, JSON is assumed by default.
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      requestBody:
        required: true
        description: Pod specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PodDetail'
            example:
              apiVersion: v1
              kind: Pod
              metadata:
                name: nginx-pod
                namespace: default
                labels:
                  app: nginx
              spec:
                containers:
                  - name: nginx
                    image: nginx:latest
                    ports:
                      - containerPort: 80
          application/yaml:
            schema:
              type: string
              description: Pod specification in YAML format
            example: |
              apiVersion: v1
              kind: Pod
              metadata:
                name: nginx-pod
                namespace: default
                labels:
                  app: nginx
              spec:
                containers:
                - name: nginx
                  image: nginx:latest
                  ports:
                  - containerPort: 80
          text/yaml:
            schema:
              type: string
              description: Pod specification in YAML format
            example: |
              apiVersion: v1
              kind: Pod
              metadata:
                name: nginx-pod
                namespace: default
                labels:
                  app: nginx
              spec:
                containers:
                - name: nginx
                  image: nginx:latest
                  ports:
                  - containerPort: 80
      responses:
        '200':
          description: Pod created or updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PodDetailResponse'
        '400':
          description: Invalid pod specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidYaml:
                  summary: Invalid YAML format
                  value:
                    status: error
                    error:
                      code: INVALID_INPUT
                      message: "Invalid YAML pod specification"
                      details: "yaml: line 5: found character that cannot start any token"
                invalidJson:
                  summary: Invalid JSON format
                  value:
                    status: error
                    error:
                      code: INVALID_INPUT
                      message: "Invalid JSON pod specification"
                      details: "unexpected end of JSON input"
                unsupportedContentType:
                  summary: Unsupported content type
                  value:
                    status: error
                    error:
                      code: INVALID_INPUT
                      message: "Unsupported content type"
                      details: "Content-Type must be 'application/json', 'application/yaml', or 'text/yaml'"
                missingName:
                  summary: Missing required field
                  value:
                    status: error
                    error:
                      code: INVALID_INPUT
                      message: "Invalid pod specification"
                      details: "Pod name is required in metadata.name"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/deployments:
    get:
      summary: List all deployments in the cluster
      description: List all deployments across all namespaces in the Kubernetes cluster
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Deployments listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeploymentsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    post:
      summary: Create or update a Deployment
      description: Create a new Deployment or update an existing Deployment using Kubernetes apply semantics.
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      requestBody:
        required: true
        description: Deployment specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeploymentDetail'
          application/yaml:
            schema:
              type: string
          text/yaml:
            schema:
              type: string
      responses:
        '200':
          description: Deployment created or updated successfully
        '400':
          description: Invalid Deployment specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/services:
    get:
      summary: List all services in the cluster
      description: List all services across all namespaces in the Kubernetes cluster
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Services listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServicesResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    post:
      summary: Create or update a Service
      description: Create a new Service or update an existing Service using Kubernetes apply semantics.
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      requestBody:
        required: true
        description: Service specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ServiceDetail'
          application/yaml:
            schema:
              type: string
          text/yaml:
            schema:
              type: string
      responses:
        '200':
          description: Service created or updated successfully
        '400':
          description: Invalid Service specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/ingresses:
    get:
      summary: List all ingresses in the cluster
      description: List all ingresses across all namespaces in the Kubernetes cluster
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Ingresses listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngressesResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    post:
      summary: Create or update an Ingress
      description: Create a new Ingress or update an existing Ingress using Kubernetes apply semantics.
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      requestBody:
        required: true
        description: Ingress specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngressDetail'
          application/yaml:
            schema:
              type: string
          text/yaml:
            schema:
              type: string
      responses:
        '200':
          description: Ingress created or updated successfully
        '400':
          description: Invalid Ingress specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/pvcs:
    get:
      summary: List all persistent volume claims in the cluster
      description: List all PVCs across all namespaces in the Kubernetes cluster
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: PVCs listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PVCsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    post:
      summary: Create or update a PVC
      description: Create a new PVC or update an existing PVC using Kubernetes apply semantics.
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      requestBody:
        required: true
        description: PVC specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PVCDetail'
          application/yaml:
            schema:
              type: string
          text/yaml:
            schema:
              type: string
      responses:
        '200':
          description: PVC created or updated successfully
        '400':
          description: Invalid PVC specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
  
  /kubernetes/pvs:
    get:
      summary: List all persistent volumes in the cluster
      description: List all PVs in the Kubernetes cluster
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: PVs listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PVsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    post:
      summary: Create or update a PV
      description: Create a new PV or update an existing PV using Kubernetes apply semantics.
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      requestBody:
        required: true
        description: PV specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PVDetail'
          application/yaml:
            schema:
              type: string
          text/yaml:
            schema:
              type: string
      responses:
        '200':
          description: PV created or updated successfully
        '400':
          description: Invalid PV specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/secrets:
    get:
      summary: List all secrets in the cluster
      description: List all secrets across all namespaces in the Kubernetes cluster
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Secrets listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/configmaps:
    get:
      summary: List all config maps in the cluster
      description: List all config maps across all namespaces in the Kubernetes cluster
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Config maps listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfigMapsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/namespaces:
    get:
      summary: List all namespaces in the cluster
      description: List all namespaces in the Kubernetes cluster
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Namespaces listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NamespacesResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    post:
      summary: Create or update a Namespace
      description: Create a new Namespace or update an existing one using Kubernetes apply semantics.
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      requestBody:
        required: true
        description: Namespace specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NamespaceDetail'
          application/yaml:
            schema:
              type: string
          text/yaml:
            schema:
              type: string
      responses:
        '200':
          description: Namespace created or updated successfully
        '400':
          description: Invalid Namespace specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/nodes:
    get:
      summary: List all nodes in the cluster
      description: List all nodes in the Kubernetes cluster
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Nodes listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NodesResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/daemonsets:
    get:
      summary: List all daemon sets in the cluster
      description: List all daemon sets across all namespaces in the Kubernetes cluster
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Daemon sets listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DaemonSetsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/statefulsets:
    get:
      summary: List all stateful sets in the cluster
      description: List all stateful sets across all namespaces in the Kubernetes cluster
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Stateful sets listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatefulSetsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/jobs:
    get:
      summary: List all jobs in the cluster
      description: List all jobs across all namespaces in the Kubernetes cluster
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Jobs listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/cronjobs:
    get:
      summary: List all cron jobs in the cluster
      description: List all cron jobs across all namespaces in the Kubernetes cluster
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Cron jobs listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CronJobsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/cluster-info:
    get:
      summary: Get cluster information
      description: Get basic information about the Kubernetes cluster
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Cluster information retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClusterInfoResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/ingressclasses:
    get:
      summary: List all ingress classes in the cluster
      description: List all ingress classes in the Kubernetes cluster
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Ingress classes listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngressClassesResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    post:
      summary: Create or update an IngressClass
      description: Create a new IngressClass or update an existing IngressClass using Kubernetes apply semantics.
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      requestBody:
        required: true
        description: IngressClass specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngressClassDetail'
          application/yaml:
            schema:
              type: string
          text/yaml:
            schema:
              type: string
      responses:
        '200':
          description: IngressClass created or updated successfully
        '400':
          description: Invalid IngressClass specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/ingressclasses/{name}:
    get:
      summary: Get detailed ingress class information
      description: Get detailed information about a specific ingress class
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: IngressClass name
          schema:
            type: string
      responses:
        '200':
          description: IngressClass details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngressClassDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: IngressClass not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    put:
      summary: Update an IngressClass
      description: Update an existing IngressClass
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: IngressClass name
          schema:
            type: string
      requestBody:
        required: true
        description: IngressClass specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngressClassDetail'
          application/yaml:
            schema:
              type: string
          text/yaml:
            schema:
              type: string
      responses:
        '200':
          description: IngressClass updated successfully
        '400':
          description: Invalid IngressClass specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: IngressClass not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    delete:
      summary: Delete an ingress class
      description: Delete a specific ingress class
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: IngressClass name
          schema:
            type: string
      responses:
        '200':
          description: IngressClass deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: IngressClass not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/networkpolicies:
    get:
      summary: List all network policies in the cluster
      description: List all network policies across all namespaces in the Kubernetes cluster
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Network policies listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NetworkPoliciesResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    post:
      summary: Create or update a NetworkPolicy
      description: Create a new NetworkPolicy or update an existing NetworkPolicy using Kubernetes apply semantics.
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      requestBody:
        required: true
        description: NetworkPolicy specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NetworkPolicyDetail'
          application/yaml:
            schema:
              type: string
          text/yaml:
            schema:
              type: string
      responses:
        '200':
          description: NetworkPolicy created or updated successfully
        '400':
          description: Invalid NetworkPolicy specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/networkpolicies/{namespace}/{name}:
    get:
      summary: Get detailed network policy information
      description: Get detailed information about a specific network policy in a namespace
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: NetworkPolicy namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: NetworkPolicy name
          schema:
            type: string
      responses:
        '200':
          description: NetworkPolicy details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NetworkPolicyDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: NetworkPolicy not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    put:
      summary: Update a NetworkPolicy
      description: Update an existing NetworkPolicy
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: NetworkPolicy namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: NetworkPolicy name
          schema:
            type: string
      requestBody:
        required: true
        description: NetworkPolicy specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NetworkPolicyDetail'
          application/yaml:
            schema:
              type: string
          text/yaml:
            schema:
              type: string
      responses:
        '200':
          description: NetworkPolicy updated successfully
        '400':
          description: Invalid NetworkPolicy specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: NetworkPolicy not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    delete:
      summary: Delete a network policy
      description: Delete a specific network policy from a namespace
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: NetworkPolicy namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: NetworkPolicy name
          schema:
            type: string
      responses:
        '200':
          description: NetworkPolicy deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: NetworkPolicy not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/pods/{namespace}/{name}:
    get:
      summary: Get detailed pod information
      description: Get detailed information about a specific pod in a namespace
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: Pod namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: Pod name
          schema:
            type: string
      responses:
        '200':
          description: Pod details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PodDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Pod not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    put:
      summary: Update a Pod
      description: Update an existing Pod
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: Pod namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: Pod name
          schema:
            type: string
      requestBody:
        required: true
        description: Pod specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PodDetail'
          application/yaml:
            schema:
              type: string
          text/yaml:
            schema:
              type: string
      responses:
        '200':
          description: Pod updated successfully
        '400':
          description: Invalid Pod specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Pod not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    delete:
      summary: Delete a pod
      description: Delete a specific pod from a namespace
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: Pod namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: Pod name
          schema:
            type: string
      responses:
        '200':
          description: Pod deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  message:
                    type: string
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Pod not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/pods/{namespace}/{name}/logs:
    get:
      summary: Get pod logs
      description: Retrieve logs from a specific pod
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: Pod namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: Pod name
          schema:
            type: string
        - name: follow
          in: query
          required: false
          description: Follow the log output
          schema:
            type: boolean
            default: false
        - name: lines
          in: query
          required: false
          description: Number of lines to retrieve from the end of the logs
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: Pod logs retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  logs:
                    type: string
                    description: Pod log output
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Pod not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/deployments/{namespace}/{name}:
    get:
      summary: Get detailed deployment information
      description: Get detailed information about a specific deployment in a namespace
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: Deployment namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: Deployment name
          schema:
            type: string
      responses:
        '200':
          description: Deployment details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeploymentDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Deployment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    put:
      summary: Update a Deployment
      description: Update an existing Deployment
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: Deployment namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: Deployment name
          schema:
            type: string
      requestBody:
        required: true
        description: Deployment specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeploymentDetail'
          application/yaml:
            schema:
              type: string
          text/yaml:
            schema:
              type: string
      responses:
        '200':
          description: Deployment updated successfully
        '400':
          description: Invalid Deployment specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Deployment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    delete:
      summary: Delete a Deployment
      description: Delete a specific Deployment
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: Deployment namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: Deployment name
          schema:
            type: string
      responses:
        '200':
          description: Deployment deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Deployment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/services/{namespace}/{name}:
    get:
      summary: Get detailed service information
      description: Get detailed information about a specific service in a namespace
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: Service namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: Service name
          schema:
            type: string
      responses:
        '200':
          description: Service details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Service not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    put:
      summary: Update a Service
      description: Update an existing Service
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: Service namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: Service name
          schema:
            type: string
      requestBody:
        required: true
        description: Service specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ServiceDetail'
          application/yaml:
            schema:
              type: string
          text/yaml:
            schema:
              type: string
      responses:
        '200':
          description: Service updated successfully
        '400':
          description: Invalid Service specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Service not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    delete:
      summary: Delete a Service
      description: Delete a specific Service
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: Service namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: Service name
          schema:
            type: string
      responses:
        '200':
          description: Service deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Service not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/ingresses/{namespace}/{name}:
    get:
      summary: Get detailed ingress information
      description: Get detailed information about a specific ingress in a namespace
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: Ingress namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: Ingress name
          schema:
            type: string
      responses:
        '200':
          description: Ingress details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngressDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Ingress not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    put:
      summary: Update an Ingress
      description: Update an existing Ingress
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: Ingress namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: Ingress name
          schema:
            type: string
      requestBody:
        required: true
        description: Ingress specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngressDetail'
          application/yaml:
            schema:
              type: string
          text/yaml:
            schema:
              type: string
      responses:
        '200':
          description: Ingress updated successfully
        '400':
          description: Invalid Ingress specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Ingress not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    delete:
      summary: Delete an Ingress
      description: Delete a specific Ingress
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: Ingress namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: Ingress name
          schema:
            type: string
      responses:
        '200':
          description: Ingress deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Ingress not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/pvcs/{namespace}/{name}:
    get:
      summary: Get detailed PVC information
      description: Get detailed information about a specific persistent volume claim in a namespace
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: PVC namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: PVC name
          schema:
            type: string
      responses:
        '200':
          description: PVC details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PVCDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: PVC not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    delete:
      summary: Delete a PVC
      description: Delete a specific PVC
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          schema:
            type: string
        - name: name
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: PVC deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/pvs/{name}:
    get:
      summary: Get detailed PV information
      description: Get detailed information about a specific persistent volume
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: PV name
          schema:
            type: string
      responses:
        '200':
          description: PV details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PVDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: PV not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/secrets/{namespace}/{name}:
    get:
      summary: Get detailed secret information
      description: Get detailed information about a specific secret in a namespace
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: Secret namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: Secret name
          schema:
            type: string
      responses:
        '200':
          description: Secret details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Secret not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    put:
      summary: Update a Secret
      description: Update an existing Secret
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: Secret namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: Secret name
          schema:
            type: string
      requestBody:
        required: true
        description: Secret specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SecretDetail'
          application/yaml:
            schema:
              type: string
          text/yaml:
            schema:
              type: string
      responses:
        '200':
          description: Secret updated successfully
        '400':
          description: Invalid Secret specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Secret not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    delete:
      summary: Delete a Secret
      description: Delete a specific Secret
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: Secret namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: Secret name
          schema:
            type: string
      responses:
        '200':
          description: Secret deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Secret not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/configmaps/{namespace}/{name}:
    get:
      summary: Get detailed configmap information
      description: Get detailed information about a specific configmap in a namespace
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: ConfigMap namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: ConfigMap name
          schema:
            type: string
      responses:
        '200':
          description: ConfigMap details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfigMapDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: ConfigMap not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    put:
      summary: Update a ConfigMap
      description: Update an existing ConfigMap
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: ConfigMap namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: ConfigMap name
          schema:
            type: string
      requestBody:
        required: true
        description: ConfigMap specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfigMapDetail'
          application/yaml:
            schema:
              type: string
          text/yaml:
            schema:
              type: string
      responses:
        '200':
          description: ConfigMap updated successfully
        '400':
          description: Invalid ConfigMap specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: ConfigMap not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    delete:
      summary: Delete a ConfigMap
      description: Delete a specific ConfigMap
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: ConfigMap namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: ConfigMap name
          schema:
            type: string
      responses:
        '200':
          description: ConfigMap deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: ConfigMap not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/namespaces/{name}:
    get:
      summary: Get detailed namespace information
      description: Get detailed information about a specific namespace
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: Namespace name
          schema:
            type: string
      responses:
        '200':
          description: Namespace details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NamespaceDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Namespace not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    put:
      summary: Update a Namespace
      description: Update an existing Namespace
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: Namespace name
          schema:
            type: string
      requestBody:
        required: true
        description: Namespace specification in JSON or YAML format
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NamespaceDetail'
          application/yaml:
            schema:
              type: string
          text/yaml:
            schema:
              type: string
      responses:
        '200':
          description: Namespace updated successfully
        '400':
          description: Invalid Namespace specification or unsupported content type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Namespace not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'
    delete:
      summary: Delete a Namespace
      description: Delete a specific Namespace
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: Namespace name
          schema:
            type: string
      responses:
        '200':
          description: Namespace deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/nodes/{name}:
    get:
      summary: Get detailed node information
      description: Get detailed information about a specific node
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: Node name
          schema:
            type: string
      responses:
        '200':
          description: Node details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NodeDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Node not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/daemonsets/{namespace}/{name}:
    get:
      summary: Get detailed daemonset information
      description: Get detailed information about a specific daemonset in a namespace
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: DaemonSet namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: DaemonSet name
          schema:
            type: string
      responses:
        '200':
          description: DaemonSet details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DaemonSetDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: DaemonSet not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/statefulsets/{namespace}/{name}:
    get:
      summary: Get detailed statefulset information
      description: Get detailed information about a specific statefulset in a namespace
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: StatefulSet namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: StatefulSet name
          schema:
            type: string
      responses:
        '200':
          description: StatefulSet details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatefulSetDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: StatefulSet not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/jobs/{namespace}/{name}:
    get:
      summary: Get detailed job information
      description: Get detailed information about a specific job in a namespace
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: Job namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: Job name
          schema:
            type: string
      responses:
        '200':
          description: Job details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/cronjobs/{namespace}/{name}:
    get:
      summary: Get detailed cronjob information
      description: Get detailed information about a specific cronjob in a namespace
      tags:
        - Kubernetes
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: path
          required: true
          description: CronJob namespace
          schema:
            type: string
        - name: name
          in: path
          required: true
          description: CronJob name
          schema:
            type: string
      responses:
        '200':
          description: CronJob details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CronJobDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: CronJob not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          $ref: '#/components/responses/KubernetesNotInstalledError'

  /kubernetes/helm/releases:
    get:
      summary: List Helm releases
      description: List all Helm releases from all namespaces in the Kubernetes cluster by default. Use namespace parameter to filter to a specific namespace.
      tags:
        - Helm
      security:
        - bearerAuth: []
      parameters:
        - name: namespace
          in: query
          description: Filter releases by specific namespace (overrides default all-namespace behavior)
          required: false
          schema:
            type: string
            example: "default"
        - name: all
          in: query
          description: |
            Explicitly control whether to show releases from all namespaces (default: true)
          required: false
          schema:
            type: boolean
            default: true
        - name: filter
          in: query
          description: Filter releases by name pattern
          required: false
          schema:
            type: string
            example: "nginx"
      responses:
        '200':
          description: Helm releases listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HelmReleasesResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/HelmNotAvailableError'
        '500':
          $ref: '#/components/responses/HelmError'

  /kubernetes/helm/charts:
    get:
      summary: List Helm charts
      description: Search all Helm charts from configured repositories (equivalent to 'helm search repo -l')
      tags:
        - Helm
      security:
        - bearerAuth: []
      parameters:
        - name: repository
          in: query
          description: Filter charts by repository name
          required: false
          schema:
            type: string
            example: "bitnami"
        - name: all_versions
          in: query
          description: Show all versions of charts (equivalent to -l flag in helm search)
          required: false
          schema:
            type: boolean
            default: true
        - name: devel
          in: query
          description: Include development versions (equivalent to --devel flag)
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Helm charts listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HelmChartsResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/HelmNotAvailableError'
        '500':
          $ref: '#/components/responses/HelmError'

  /kubernetes/helm/repositories:
    get:
      summary: List Helm repositories
      description: List all configured Helm repositories (equivalent to 'helm repo list')
      tags:
        - Helm
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Helm repositories listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HelmRepositoriesResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/HelmNotAvailableError'
        '500':
          $ref: '#/components/responses/HelmError'
    post:
      summary: Add a new Helm repository
      description: Add a new Helm repository to the configuration (equivalent to 'helm repo add')
      tags:
        - Helm
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HelmRepositoryAddRequest'
            example:
              name: "bitnami"
              url: "https://charts.bitnami.com/bitnami"
              username: ""
              password: ""
              cert_file: ""
              key_file: ""
              ca_file: ""
              insecure_skip_tls_verify: false
              pass_credentials_all: false
              force_update: false
      responses:
        '200':
          description: Helm repository added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HelmRepositoryAddResponse'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/HelmNotAvailableError'
        '409':
          description: Repository already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/HelmError'

  /kubernetes/helm/repositories/{name}/update:
    put:
      summary: Update a Helm repository
      description: Update a specific Helm repository to fetch the latest charts (equivalent to 'helm repo update {repo-name}')
      tags:
        - Helm
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: Name of the repository to update
          schema:
            type: string
            example: "bitnami"
      responses:
        '200':
          description: Helm repository updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HelmRepositoryUpdateResponse'
              example:
                status: success
                data:
                  repository:
                    name: "bitnami"
                    url: "https://charts.bitnami.com/bitnami"
                  message: "Successfully got an update from the 'bitnami' chart repository"
                  updated_at: "2025-08-07T00:10:12Z"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/HelmNotAvailableError'
        '404':
          description: Repository not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                error:
                  code: REPOSITORY_NOT_FOUND
                  message: "No repository named 'bitnami' found"
                  details: "Run 'helm repo add' to add the repository first"
        '500':
          $ref: '#/components/responses/HelmError'

  # Ansible Endpoints
  /ansible/playbooks:
    get:
      summary: List all playbooks
      description: Returns a list of all available Ansible playbooks in the system
      tags:
        - Ansible
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Playbooks listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaybooksListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          description: Failed to list playbooks
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /ansible/playbooks/{name}:
    get:
      summary: Get playbook details
      description: Returns detailed information about a specific playbook including its content
      tags:
        - Ansible
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: Name of the playbook
          schema:
            type: string
      responses:
        '200':
          description: Playbook details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaybookDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Playbook not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Delete playbook
      description: Deletes a playbook from the system
      tags:
        - Ansible
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: Name of the playbook to delete
          schema:
            type: string
      responses:
        '200':
          description: Playbook deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Playbook not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /ansible/playbooks/upload:
    post:
      summary: Upload playbook
      description: Uploads a new playbook to the server
      tags:
        - Ansible
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlaybookUploadRequest'
      responses:
        '201':
          description: Playbook uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          description: Invalid request or playbook validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '409':
          description: Playbook already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /ansible/playbooks/validate:
    post:
      summary: Validate playbook
      description: Validates playbook syntax using ansible-playbook --syntax-check
      tags:
        - Ansible
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  description: Name of the playbook to validate
      responses:
        '200':
          description: Validation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaybookValidationResponse'
        '400':
          description: Playbook syntax is invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaybookValidationResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Playbook not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /ansible/playbooks/run:
    post:
      summary: Run playbook
      description: Executes an Ansible playbook with specified parameters
      tags:
        - Ansible
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlaybookRunRequest'
      responses:
        '202':
          description: Playbook execution started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecutionStartResponse'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Playbook not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /ansible/playbooks/templates:
    get:
      summary: Get playbook templates
      description: Returns a list of available playbook templates
      tags:
        - Ansible
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Templates retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplatesListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /ansible/playbooks/from-template:
    post:
      summary: Create playbook from template
      description: Creates a new playbook from a template with variable substitution
      tags:
        - Ansible
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateFromTemplateRequest'
      responses:
        '201':
          description: Playbook created from template successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          description: Invalid request or template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /ansible/playbooks/sync-git:
    post:
      summary: Sync playbooks from Git
      description: Syncs playbooks from a Git repository
      tags:
        - Ansible
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GitSyncRequest'
      responses:
        '200':
          description: Playbooks synced successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          description: Invalid repository URL or authentication failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /ansible/playbooks/from-galaxy:
    post:
      summary: Install from Ansible Galaxy
      description: Installs roles or collections from Ansible Galaxy
      tags:
        - Ansible
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GalaxyInstallRequest'
      responses:
        '200':
          description: Roles/collections installed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          description: Invalid request or installation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /ansible/playbooks/from-url:
    post:
      summary: Download playbook from URL
      description: Downloads a playbook from a URL
      tags:
        - Ansible
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - url
                - name
              properties:
                url:
                  type: string
                  format: uri
                  description: URL of the playbook to download
                name:
                  type: string
                  description: Name to save the playbook as
      responses:
        '200':
          description: Playbook downloaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          description: Invalid URL or download failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /ansible/adhoc:
    post:
      summary: Run ad-hoc command
      description: Executes an ad-hoc Ansible command
      tags:
        - Ansible
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdHocRequest'
      responses:
        '202':
          description: Ad-hoc command execution started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecutionStartResponse'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /ansible/executions:
    get:
      summary: List executions
      description: Returns a list of all Ansible execution results
      tags:
        - Ansible
      security:
        - bearerAuth: []
      parameters:
        - name: status
          in: query
          required: false
          description: Filter by execution status
          schema:
            type: string
            enum: [running, success, failed]
        - name: type
          in: query
          required: false
          description: Filter by execution type
          schema:
            type: string
            enum: [playbook, adhoc]
        - name: limit
          in: query
          required: false
          description: Maximum number of results to return
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: Executions listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecutionsListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /ansible/executions/{id}:
    get:
      summary: Get execution details
      description: Returns detailed information about a specific execution
      tags:
        - Ansible
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Execution ID
          schema:
            type: string
      responses:
        '200':
          description: Execution details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecutionDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Execution not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Cancel execution
      description: Cancels a running execution (not yet implemented)
      tags:
        - Ansible
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Execution ID
          schema:
            type: string
      responses:
        '200':
          description: Execution cancelled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Execution not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '501':
          description: Cancellation not yet implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /ansible/executions/{id}/stream:
    get:
      summary: Stream execution output
      description: |
        Establishes a WebSocket connection to stream real-time execution output.
        
        **WebSocket URL**: `ws://localhost:8080/api/v1/ansible/executions/{id}/stream`
        
        **Authentication**: Send JWT token as query parameter or in first message.
        
        **Message Format**:
        ```json
        {
          "type": "output",
          "content": "TASK [Update packages] *****",
          "time": 1705315800
        }
        ```
        
        **Completion Message**:
        ```json
        {
          "type": "complete",
          "result": {
            "id": "exec-123456",
            "status": "success",
            "exit_code": 0
          }
        }
        ```
      tags:
        - Ansible
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Execution ID
          schema:
            type: string
      responses:
        '101':
          description: Switching Protocols - WebSocket connection established
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Execution not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /ansible/inventory/dynamic:
    get:
      summary: Generate dynamic inventory
      description: Generates a dynamic inventory from current system state
      tags:
        - Ansible
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Dynamic inventory generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DynamicInventoryResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /ansible/inventory:
    post:
      summary: Save inventory
      description: Saves an inventory configuration
      tags:
        - Ansible
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveInventoryRequest'
      responses:
        '200':
          description: Inventory saved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          description: Invalid inventory format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /ansible/inventory/{name}:
    get:
      summary: Get inventory
      description: Retrieves a saved inventory (not yet implemented)
      tags:
        - Ansible
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: Inventory name
          schema:
            type: string
      responses:
        '200':
          description: Inventory retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DynamicInventoryResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Inventory not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '501':
          description: Not yet implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /ansible/schedules:
    get:
      summary: List scheduled tasks
      description: Returns all scheduled Ansible tasks (not yet implemented)
      tags:
        - Ansible
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Schedules listed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchedulesListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '501':
          description: Scheduling not yet implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      summary: Create scheduled task
      description: Creates a scheduled playbook execution (not yet implemented)
      tags:
        - Ansible
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateScheduleRequest'
      responses:
        '201':
          description: Schedule created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          description: Invalid schedule format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '501':
          description: Scheduling not yet implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /ansible/schedules/{id}:
    delete:
      summary: Delete scheduled task
      description: Deletes a scheduled task (not yet implemented)
      tags:
        - Ansible
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Schedule ID
          schema:
            type: string
      responses:
        '200':
          description: Schedule deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Schedule not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '501':
          description: Scheduling not yet implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  
  responses:
    UnauthorizedError:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    BadRequest:
      description: Invalid request parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    KubernetesNotInstalledError:
      description: Kubernetes is not installed on the system
      content:
        application/json:
          schema:
            type: object
            properties:
              status:
                type: string
                enum: [error]
              error:
                type: object
                properties:
                  code:
                    type: string
                    enum: [KUBERNETES_NOT_INSTALLED]
                  message:
                    type: string
                    example: "Kubernetes is not installed on this system"
                  details:
                    type: string
                    example: "The kubelet service was not found on this system. Please install Kubernetes to use these features."
                  data:
                    type: object

    HelmNotAvailableError:
      description: Helm is not available
      content:
        application/json:
          schema:
            type: object
            properties:
              status:
                type: string
                enum: [error]
              error:
                type: object
                properties:
                  code:
                    type: string
                    enum: [HELM_NOT_AVAILABLE]
                  message:
                    type: string
                    example: "Helm is not available"
                  details:
                    type: string
                    example: "Helm requires Kubernetes to be installed and configured. Please ensure Kubernetes is running and accessible."
                  data:
                    type: object

    HelmError:
      description: Helm operation failed
      content:
        application/json:
          schema:
            type: object
            properties:
              status:
                type: string
                enum: [error]
              error:
                type: object
                properties:
                  code:
                    type: string
                    enum: [HELM_ERROR]
                  message:
                    type: string
                    example: "Failed to list releases: connection refused"
                  data:
                    type: object
  
  schemas:
    APIResponse:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum: [success, error]
    data:
      type: object
    error:
      $ref: '#/components/schemas/APIError'
    
    APIError:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: string
    
    ErrorResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            status:
              enum: [error]
    
    LoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          description: |
            Username for authentication.
            - For development builds: 'admin' with password 'admin123' is available
            - For production builds: Only Linux system users are allowed
        password:
          type: string
          description: User password
    
    LoginResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                token:
                  type: string
                expires_at:
                  type: integer
    
    EnhancedLoginRequest:
      type: object
      required:
        - username
      properties:
        username:
          type: string
          description: Username for authentication
        password:
          type: string
          description: User password (required for password auth)
        auth_type:
          type: string
          description: Authentication type
          enum: [password, ssh_key]
          default: password
        ssh_signature:
          type: string
          description: SSH signature for key-based auth
        challenge:
          type: string
          description: Challenge string for SSH key auth
    
    EnhancedLoginResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                token:
                  type: string
                  description: JWT authentication token
                expires_at:
                  type: integer
                  description: Token expiration timestamp
                refresh_token:
                  type: string
                  description: Refresh token for token renewal
                token_type:
                  type: string
                  description: Token type
                  default: Bearer
                user:
                  type: object
                  properties:
                    username:
                      type: string
                    uid:
                      type: string
                    groups:
                      type: array
                      items:
                        type: string
    
    ChallengeRequest:
      type: object
      required:
        - username
      properties:
        username:
          type: string
          description: Username requesting the challenge
        key_fingerprint:
          type: string
          description: Optional SSH key fingerprint to use
    
    ChallengeResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                challenge:
                  type: string
                  description: Challenge string to be signed
                expires_at:
                  type: integer
                  description: Challenge expiration timestamp
                username:
                  type: string
                  description: Username for this challenge
    
    VerifyRequest:
      type: object
      required:
        - username
        - challenge
        - signature
      properties:
        username:
          type: string
          description: Username
        challenge:
          type: string
          description: Original challenge string
        signature:
          type: string
          description: Base64-encoded signature of the challenge
        key_type:
          type: string
          description: SSH key type
          enum: [rsa, ed25519, ecdsa]
    
    SSHKeysResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                username:
                  type: string
                  description: Username
                keys:
                  type: array
                  items:
                    $ref: '#/components/schemas/SSHKey'
    
    SSHKey:
      type: object
      properties:
        key:
          type: string
          description: Full SSH public key string
        type:
          type: string
          description: Key type (ssh-rsa, ssh-ed25519, etc.)
        fingerprint:
          type: string
          description: Key fingerprint
        comment:
          type: string
          description: Key comment/label
    
    MessageResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                message:
                  type: string

    CRDsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                crds:
                  type: array
                  items:
                    $ref: '#/components/schemas/CRDInfo'

    CRDInfo:
      type: object
      properties:
        name:
          type: string
          description: The name of the CRD
        group:
          type: string
          description: The API group of the CRD
        version:
          type: string
          description: The version of the CRD
        kind:
          type: string
          description: The kind of the custom resource
        scope:
          type: string
          description: The scope of the CRD (Namespaced or Cluster)
          enum: [Namespaced, Cluster]
        names:
          type: array
          items:
            type: string
          description: All accepted names for the CRD (plural, singular, shortNames)
        age:
          type: string
          description: Age of the CRD
        labels:
          type: object
          additionalProperties:
            type: string
          description: Labels attached to the CRD
        creationTimestamp:
          type: string
          format: date-time
          description: Timestamp when the CRD was created

    CRDDetailResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                crd:
                  $ref: '#/components/schemas/CRDDetail'

    CRDDetail:
      allOf:
        - $ref: '#/components/schemas/CRDInfo'
        - type: object
          properties:
            spec:
              type: object
              properties:
                versions:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                        description: Version name
                      served:
                        type: boolean
                        description: Whether this version is served
                      storage:
                        type: boolean
                        description: Whether this version is the storage version
                      schema:
                        type: object
                        description: OpenAPI v3 schema for this version
                conversion:
                  type: object
                  properties:
                    strategy:
                      type: string
                      description: Conversion strategy
                preserveUnknownFields:
                  type: boolean
                  description: Whether unknown fields are preserved

    CRDObjectListResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                objects:
                  type: array
                  items:
                    $ref: '#/components/schemas/CRDObject'
                count:
                  type: integer

    CRDObjectDetailResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/CRDObjectDetail'

    CRDObject:
      type: object
      properties:
        name:
          type: string
        namespace:
          type: string
        kind:
          type: string
        apiVersion:
          type: string
        creationTimestamp:
          type: string
          format: date-time
        labels:
          type: object
          additionalProperties:
            type: string
        annotations:
          type: object
          additionalProperties:
            type: string

    CRDObjectDetail:
      allOf:
        - $ref: '#/components/schemas/CRDObject'
        - type: object
          properties:
            raw:
              type: object
              description: The full Kubernetes object data.
              additionalProperties: true
    
    Interface:
      type: object
      properties:
        name:
          type: string
        mac:
          type: string
        mtu:
          type: integer
        state:
          type: string
          enum: [up, down]
        type:
          type: string
        addresses:
          type: array
          items:
            type: string
        statistics:
          type: object
          properties:
            rx_bytes:
              type: integer
            tx_bytes:
              type: integer
            rx_packets:
              type: integer
            tx_packets:
              type: integer
            rx_errors:
              type: integer
            tx_errors:
              type: integer
    
    InterfacesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                interfaces:
                  type: array
                  items:
                    $ref: '#/components/schemas/Interface'
    
    AddressRequest:
      type: object
      required:
        - address
        - netmask
      properties:
        address:
          type: string
          format: ipv4
        netmask:
          type: integer
          minimum: 0
          maximum: 32
        gateway:
          type: string
          format: ipv4
    
    BridgeRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
        interfaces:
          type: array
          items:
            type: string
    
    BondRequest:
      type: object
      required:
        - name
        - mode
        - interfaces
      properties:
        name:
          type: string
        mode:
          type: string
        interfaces:
          type: array
          items:
            type: string
    
    VLANRequest:
      type: object
      required:
        - interface
        - vlan_id
      properties:
        interface:
          type: string
        vlan_id:
          type: integer
          minimum: 1
          maximum: 4094
        name:
          type: string
    
    Disk:
      type: object
      properties:
        name:
          type: string
        path:
          type: string
        size:
          type: integer
        model:
          type: string
        serial:
          type: string
        type:
          type: string
        removable:
          type: boolean
        partitions:
          type: array
          items:
            $ref: '#/components/schemas/Partition'
    
    Partition:
      type: object
      properties:
        name:
          type: string
        path:
          type: string
        size:
          type: integer
        type:
          type: string
        filesystem:
          type: string
        mount_point:
          type: string
        used:
          type: integer
        available:
          type: integer
        use_percent:
          type: number
    
    DisksResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                disks:
                  type: array
                  items:
                    $ref: '#/components/schemas/Disk'
    
    MountRequest:
      type: object
      required:
        - device
        - mount_point
      properties:
        device:
          type: string
        mount_point:
          type: string
        filesystem:
          type: string
        options:
          type: string
    
    UnmountRequest:
      type: object
      required:
        - mount_point
      properties:
        mount_point:
          type: string
        force:
          type: boolean
          default: false
    
    FormatRequest:
      type: object
      required:
        - device
        - filesystem
      properties:
        device:
          type: string
        filesystem:
          type: string
          enum: [ext4, ext3, ext2, xfs, btrfs]
        label:
          type: string
    
    User:
      type: object
      properties:
        username:
          type: string
        uid:
          type: string
        gid:
          type: string
        home:
          type: string
        shell:
          type: string
    
    UsersResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                users:
                  type: array
                  items:
                    $ref: '#/components/schemas/User'
    
    UserRequest:
      type: object
      required:
        - username
      properties:
        username:
          type: string
        password:
          type: string
        groups:
          type: string
    
    PasswordResetRequest:
      type: object
      required:
        - password
      properties:
        password:
          type: string
          minLength: 6
          description: New password for the user (minimum 6 characters)
    
    LogEntry:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        priority:
          type: string
        unit:
          type: string
        message:
          type: string
        hostname:
          type: string
        pid:
          type: integer
    
    LogsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                logs:
                  type: array
                  items:
                    $ref: '#/components/schemas/LogEntry'
                total_count:
                  type: integer
                page:
                  type: integer
                page_size:
                  type: integer
    
    SystemSummaryResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                hostname:
                  type: string
                os:
                  type: string
                platform:
                  type: string
                platform_family:
                  type: string
                platform_version:
                  type: string
                kernel_version:
                  type: string
                uptime:
                  type: integer
                boot_time:
                  type: integer
                cpu_count:
                  type: integer
    
    HardwareResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                hostname:
                  type: string
                architecture:
                  type: string
                virtualization:
                  type: string
                role:
                  type: string
                kernel_version:
                  type: string
    
    MemoryResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                total:
                  type: integer
                free:
                  type: integer
                used:
                  type: integer
                used_percent:
                  type: number
    
    CPUResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                model_name:
                  type: string
                cores:
                  type: integer
                load1:
                  type: number
                load5:
                  type: number
                load15:
                  type: number
    
    VolumeGroup:
      type: object
      properties:
        name:
          type: string
        size:
          type: integer
        free:
          type: integer
        pv_count:
          type: integer
        lv_count:
          type: integer
        uuid:
          type: string
    
    LogicalVolume:
      type: object
      properties:
        name:
          type: string
        vg_name:
          type: string
        size:
          type: integer
        path:
          type: string
        uuid:
          type: string
        attr:
          type: string
    
    PhysicalVolume:
      type: object
      properties:
        name:
          type: string
        vg_name:
          type: string
        size:
          type: integer
        free:
          type: integer
        uuid:
          type: string
    
    VolumeGroupsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                volume_groups:
                  type: array
                  items:
                    $ref: '#/components/schemas/VolumeGroup'
    
    LogicalVolumesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                logical_volumes:
                  type: array
                  items:
                    $ref: '#/components/schemas/LogicalVolume'
    
    PhysicalVolumesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                physical_volumes:
                  type: array
                  items:
                    $ref: '#/components/schemas/PhysicalVolume'
    
    CreateVGRequest:
      type: object
      required:
        - name
        - devices
      properties:
        name:
          type: string
        devices:
          type: array
          items:
            type: string
    
    CreateLVRequest:
      type: object
      required:
        - name
        - vg_name
        - size
      properties:
        name:
          type: string
        vg_name:
          type: string
        size:
          type: string
        filesystem:
          type: string
          enum: [ext4, ext3, ext2, xfs, btrfs]
    
    ISCSITarget:
      type: object
      properties:
        portal:
          type: string
        iqn:
          type: string
        name:
          type: string
        connected:
          type: boolean
    
    ISCSISession:
      type: object
      properties:
        target:
          type: string
        portal:
          type: string
        session_id:
          type: string
        state:
          type: string
    
    ISCSIDiscoverRequest:
      type: object
      required:
        - portal
      properties:
        portal:
          type: string
    
    ISCSITargetsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                targets:
                  type: array
                  items:
                    $ref: '#/components/schemas/ISCSITarget'
    
    ISCSISessionsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                sessions:
                  type: array
                  items:
                    $ref: '#/components/schemas/ISCSISession'
    
    ISCSILoginRequest:
      type: object
      required:
        - target
        - portal
      properties:
        target:
          type: string
        portal:
          type: string
        username:
          type: string
        password:
          type: string
    
    ISCSILogoutRequest:
      type: object
      required:
        - target
      properties:
        target:
          type: string
    
    MultipathDevice:
      type: object
      properties:
        name:
          type: string
        wwid:
          type: string
        vendor:
          type: string
        product:
          type: string
        size:
          type: string
        state:
          type: string
        paths:
          type: array
          items:
            $ref: '#/components/schemas/MultipathPath'
    
    MultipathPath:
      type: object
      properties:
        device:
          type: string
        host:
          type: string
        state:
          type: string
        priority:
          type: integer
        checker:
          type: string
    
    MultipathDevicesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                devices:
                  type: array
                  items:
                    $ref: '#/components/schemas/MultipathDevice'
    
    MultipathPathsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                paths:
                  type: array
                  items:
                    $ref: '#/components/schemas/MultipathPath'
    
    BTRFSSubvolumesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                subvolumes:
                  type: array
                  items:
                    type: string
    
    BTRFSSubvolumeRequest:
      type: object
      required:
        - path
      properties:
        path:
          type: string
    
    BTRFSSnapshotRequest:
      type: object
      required:
        - source
        - destination
      properties:
        source:
          type: string
        destination:
          type: string
    
    RAIDDevice:
      type: object
      properties:
        name:
          type: string
        path:
          type: string
        level:
          type: string
        state:
          type: string
        size:
          type: integer
        devices:
          type: array
          items:
            type: string
        active_disks:
          type: integer
        total_disks:
          type: integer
        chunk_size:
          type: string
        uuid:
          type: string
    
    RAIDDisk:
      type: object
      properties:
        path:
          type: string
        size:
          type: integer
        partition:
          type: boolean
        device:
          type: string
    
    RAIDDevicesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                devices:
                  type: array
                  items:
                    $ref: '#/components/schemas/RAIDDevice'
    
    RAIDAvailableDisksResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                disks:
                  type: array
                  items:
                    $ref: '#/components/schemas/RAIDDisk'
    
    CreateRAIDRequest:
      type: object
      required:
        - name
        - level
        - disks
      properties:
        name:
          type: string
          description: Name of the RAID device (e.g., raid0)
        level:
          type: string
          enum: ['0', '1', '5', '6', '10']
          description: RAID level
        disks:
          type: array
          items:
            type: string
          minItems: 2
          description: List of disk paths to use for RAID
        chunk_size:
          type: string
          description: Chunk size (e.g., 512K, 1M)
          default: '512K'
    
    DestroyRAIDRequest:
      type: object
      required:
        - device
      properties:
        device:
          type: string
          description: RAID device path to destroy

    ContainerDetail:
      type: object
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            id:
              type: string
            name:
              type: string
            image:
              type: string
            image_id:
              type: string
            state:
              type: string
            status:
              type: string
            created_at:
              type: string
              format: date-time
            started_at:
              type: string
              format: date-time
            finished_at:
              type: string
              format: date-time
            exit_code:
              type: integer
            pid:
              type: integer
            restart_count:
              type: integer
            command:
              type: array
              items:
                type: string
            args:
              type: array
              items:
                type: string
            env:
              type: array
              items:
                type: string
            mounts:
              type: array
              items:
                type: object
                properties:
                  source:
                    type: string
                  destination:
                    type: string
                  mode:
                    type: string
                  type:
                    type: string
                  read_only:
                    type: boolean
            ports:
              type: array
              items:
                type: object
                properties:
                  container_port:
                    type: integer
                  host_port:
                    type: integer
                  protocol:
                    type: string
                  host_ip:
                    type: string
            networks:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                  id:
                    type: string
                  ip_address:
                    type: string
                  ip_prefix_len:
                    type: integer
                  gateway:
                    type: string
                  mac_address:
                    type: string
                  ipv6_address:
                    type: string
                  ipv6_gateway:
                    type: string
                  aliases:
                    type: array
                    items:
                      type: string
                  driver_opts:
                    type: object
                    additionalProperties:
                      type: string
            resources:
              type: object
              properties:
                cpu_shares:
                  type: integer
                cpu_quota:
                  type: integer
                cpu_period:
                  type: integer
                cpuset_cpus:
                  type: string
                cpuset_mems:
                  type: string
                memory_limit:
                  type: integer
                memory_reservation:
                  type: integer
                memory_swap:
                  type: integer
                memory_usage:
                  type: integer
                memory_max_usage:
                  type: integer
                cpu_usage_percent:
                  type: number
                  format: float
                pids_limit:
                  type: integer
                pids_current:
                  type: integer
                blkio_weight:
                  type: integer
                io_read_bytes:
                  type: integer
                io_write_bytes:
                  type: integer
                network_rx_bytes:
                  type: integer
                network_tx_bytes:
                  type: integer
            user:
              type: string
            working_dir:
              type: string
            hostname:
              type: string
            domain_name:
              type: string
            labels:
              type: object
              additionalProperties:
                type: string
            annotations:
              type: object
              additionalProperties:
                type: string
            config:
              type: object
              additionalProperties:
                type: object

    ImageDetail:
      type: object
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            id:
              type: string
            repo_tags:
              type: array
              items:
                type: string
            repo_digests:
              type: array
              items:
                type: string
            parent:
              type: string
            author:
              type: string
            architecture:
              type: string
            os:
              type: string
            variant:
              type: string
            created_at:
              type: string
              format: date-time
            size:
              type: integer
            labels:
              type: object
              additionalProperties:
                type: string
            annotations:
              type: object
              additionalProperties:
                type: string
            layers:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                  size:
                    type: integer
                  created_at:
                    type: string
                    format: date-time
                  created_by:
                    type: string
                  comment:
                    type: string
            config:
              type: object
              properties:
                user:
                  type: string
                exposed_ports:
                  type: array
                  items:
                    type: string
                env:
                  type: array
                  items:
                    type: string
                cmd:
                  type: array
                  items:
                    type: string
                entrypoint:
                  type: array
                  items:
                    type: string
                volumes:
                  type: array
                  items:
                    type: string
                working_dir:
                  type: string
                stop_signal:
                  type: string
                labels:
                  type: object
                  additionalProperties:
                    type: string
            manifest:
              type: object
              additionalProperties:
                type: string

    ImageImportResult:
      type: object
      properties:
        image_id:
          type: string
          description: The ID of the imported image
          example: "sha256:abc123def456"
        repo_tags:
          type: array
          items:
            type: string
          description: Repository tags for the imported image
          example: ["my-app:latest"]
        size:
          type: integer
          format: int64
          description: Size of the imported image in bytes
          example: 125829120
        imported_at:
          type: string
          format: date-time
          description: Timestamp when the image was imported
          example: "2025-08-05T15:00:00Z"
        runtime:
          type: string
          description: Container runtime used for import
          example: "docker"
        status:
          type: string
          description: Import status
          enum: [success, failed]
          example: "success"
        message:
          type: string
          description: Additional information about the import operation
          example: "Loaded image: my-app:latest"

    # WebSocket Message Schemas
    WSAuthMessage:
      type: object
      required:
        - type
        - token
      properties:
        type:
          type: string
          enum: [auth]
        token:
          type: string
          description: JWT authentication token
    
    WSMetricsSubscribeMessage:
      type: object
      required:
        - type
        - metrics
      properties:
        type:
          type: string
          enum: [subscribe]
        metrics:
          type: array
          items:
            type: string
            enum: [cpu, memory, disk, network, load]
          description: List of metrics to subscribe to
    
    WSMetricsUnsubscribeMessage:
      type: object
      required:
        - type
        - metrics
      properties:
        type:
          type: string
          enum: [unsubscribe]
        metrics:
          type: array
          items:
            type: string
            enum: [cpu, memory, disk, network, load]
          description: List of metrics to unsubscribe from
    
    WSMetricMessage:
      type: object
      required:
        - type
        - metric
        - timestamp
        - data
      properties:
        type:
          type: string
          enum: [metric]
        metric:
          type: string
          enum: [cpu, memory, disk, network, load]
        timestamp:
          type: string
          format: date-time
        data:
          type: object
          description: Metric-specific data
    
    WSLogsSubscribeMessage:
      type: object
      required:
        - type
        - filters
      properties:
        type:
          type: string
          enum: [subscribe]
        filters:
          type: object
          properties:
            services:
              type: array
              items:
                type: string
              description: Filter by service names
            priority:
              type: string
              enum: [emergency, alert, critical, error, warning, notice, info, debug]
              description: Minimum priority level
            follow:
              type: boolean
              default: true
              description: Whether to follow new logs
    
    WSLogMessage:
      type: object
      required:
        - type
        - timestamp
        - message
      properties:
        type:
          type: string
          enum: [log]
        timestamp:
          type: string
          format: date-time
        service:
          type: string
        priority:
          type: string
          enum: [emergency, alert, critical, error, warning, notice, info, debug]
        message:
          type: string
        hostname:
          type: string
        pid:
          type: integer
    
    WSTerminalStartMessage:
      type: object
      required:
        - type
        - cols
        - rows
      properties:
        type:
          type: string
          enum: [start]
        cols:
          type: integer
          minimum: 1
          description: Terminal width in columns
        rows:
          type: integer
          minimum: 1
          description: Terminal height in rows
        shell:
          type: string
          default: /bin/bash
          description: Shell to execute
    
    WSTerminalInputMessage:
      type: object
      required:
        - type
        - data
      properties:
        type:
          type: string
          enum: [input]
        data:
          type: string
          description: Input data to send to terminal
    
    WSTerminalResizeMessage:
      type: object
      required:
        - type
        - cols
        - rows
      properties:
        type:
          type: string
          enum: [resize]
        cols:
          type: integer
          minimum: 1
          description: New terminal width in columns
        rows:
          type: integer
          minimum: 1
          description: New terminal height in rows
    
    WSTerminalOutputMessage:
      type: object
      required:
        - type
        - data
      properties:
        type:
          type: string
          enum: [output]
        data:
          type: string
          description: Output data from terminal
    
    WSErrorMessage:
      type: object
      required:
        - type
        - error
      properties:
        type:
          type: string
          enum: [error]
        error:
          type: string
          description: Error message
        code:
          type: string
          description: Error code
    
    # Metric Data Schemas
    CPUMetricData:
      type: object
      properties:
        usage_percent:
          type: number
          format: float
          minimum: 0
          maximum: 100
        load1:
          type: number
          format: float
        load5:
          type: number
          format: float
        load15:
          type: number
          format: float
        cores:
          type: array
          items:
            type: object
            properties:
              core:
                type: integer
              usage_percent:
                type: number
                format: float
                minimum: 0
                maximum: 100
    
    MemoryMetricData:
      type: object
      properties:
        total:
          type: integer
          description: Total memory in bytes
        used:
          type: integer
          description: Used memory in bytes
        free:
          type: integer
          description: Free memory in bytes
        available:
          type: integer
          description: Available memory in bytes
        used_percent:
          type: number
          format: float
          minimum: 0
          maximum: 100
        swap_total:
          type: integer
          description: Total swap in bytes
        swap_used:
          type: integer
          description: Used swap in bytes
        swap_free:
          type: integer
          description: Free swap in bytes
        swap_used_percent:
          type: number
          format: float
          minimum: 0
          maximum: 100
    
    DiskMetricData:
      type: object
      properties:
        disks:
          type: array
          items:
            type: object
            properties:
              device:
                type: string
              mount_point:
                type: string
              filesystem:
                type: string
              total:
                type: integer
                description: Total space in bytes
              used:
                type: integer
                description: Used space in bytes
              free:
                type: integer
                description: Free space in bytes
              used_percent:
                type: number
                format: float
                minimum: 0
                maximum: 100
              io_stats:
                type: object
                properties:
                  read_bytes_per_sec:
                    type: number
                    format: float
                  write_bytes_per_sec:
                    type: number
                    format: float
                  read_ops_per_sec:
                    type: number
                    format: float
                  write_ops_per_sec:
                    type: number
                    format: float
    
    NetworkMetricData:
      type: object
      properties:
        interfaces:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              rx_bytes_per_sec:
                type: number
                format: float
              tx_bytes_per_sec:
                type: number
                format: float
              rx_packets_per_sec:
                type: number
                format: float
              tx_packets_per_sec:
                type: number
                format: float
              rx_errors:
                type: integer
              tx_errors:
                type: integer
              rx_dropped:
                type: integer
              tx_dropped:
                type: integer

    DockerContainersResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                containers:
                  type: array
                  items:
                    $ref: '#/components/schemas/Container'

    DockerImagesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                images:
                  type: array
                  items:
                    $ref: '#/components/schemas/Image'

    DockerNetworksResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                networks:
                  type: array
                  items:
                    $ref: '#/components/schemas/Network'

    DockerVolumesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                volumes:
                  type: array
                  items:
                    $ref: '#/components/schemas/Volume'

    Container:
      type: object
      properties:
        id:
          type: string
          description: Container ID
          example: "9c7c8a3b0123"
        names:
          type: array
          items:
            type: string
          description: Container names
          example: ["my-container"]
        image:
          type: string
          description: Image name
          example: "nginx:latest"
        imageId:
          type: string
          description: Image ID
          example: "sha256:abcd1234"
        command:
          type: string
          description: Command being run
          example: "nginx -g 'daemon off;'"
        created:
          type: string
          format: date-time
          description: Container creation time
        state:
          type: string
          description: Container state
          example: "running"
        status:
          type: string
          description: Container status
          example: "Up 2 hours"
        ports:
          type: array
          items:
            $ref: '#/components/schemas/Port'
          description: Port mappings
        labels:
          type: object
          additionalProperties:
            type: string
          description: Container labels
        sizeRw:
          type: integer
          format: int64
          description: Size of files that have been created or changed
        sizeRootFs:
          type: integer
          format: int64
          description: Total size of all the files in the container
        hostConfig:
          $ref: '#/components/schemas/HostConfig'
        networkSettings:
          $ref: '#/components/schemas/NetworkSettings'
        mounts:
          type: array
          items:
            $ref: '#/components/schemas/Mount'
          description: Container mounts

    Port:
      type: object
      properties:
        ip:
          type: string
          description: Host IP address
          example: "0.0.0.0"
        privatePort:
          type: integer
          description: Container port
          example: 80
        publicPort:
          type: integer
          description: Host port
          example: 8080
        type:
          type: string
          description: Port type
          example: "tcp"

    HostConfig:
      type: object
      properties:
        networkMode:
          type: string
          description: Network mode
          example: "bridge"

    NetworkSettings:
      type: object
      properties:
        networks:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/NetworkInfo'
          description: Network configurations

    NetworkInfo:
      type: object
      properties:
        networkId:
          type: string
          description: Network ID
        endpointId:
          type: string
          description: Endpoint ID
        gateway:
          type: string
          description: Gateway IP
        ipAddress:
          type: string
          description: Container IP address
        ipPrefixLen:
          type: integer
          description: IP prefix length
        ipv6Gateway:
          type: string
          description: IPv6 gateway
        macAddress:
          type: string
          description: MAC address

    Mount:
      type: object
      properties:
        type:
          type: string
          description: Mount type
          example: "bind"
        source:
          type: string
          description: Source path
          example: "/host/path"
        destination:
          type: string
          description: Destination path in container
          example: "/container/path"
        mode:
          type: string
          description: Mount mode
          example: "rw"
        rw:
          type: boolean
          description: Read-write flag
        propagation:
          type: string
          description: Mount propagation
          example: "rprivate"

    Image:
      type: object
      properties:
        id:
          type: string
          description: Image ID
          example: "sha256:abcd1234"
        parentId:
          type: string
          description: Parent image ID
        repoTags:
          type: array
          items:
            type: string
          description: Repository tags
          example: ["nginx:latest"]
        repoDigests:
          type: array
          items:
            type: string
          description: Repository digests
        created:
          type: string
          format: date-time
          description: Image creation time
        size:
          type: integer
          format: int64
          description: Image size in bytes
        virtualSize:
          type: integer
          format: int64
          description: Virtual size in bytes
        sharedSize:
          type: integer
          format: int64
          description: Shared size in bytes
        labels:
          type: object
          additionalProperties:
            type: string
          description: Image labels
        containers:
          type: integer
          format: int64
          description: Number of containers using this image

    Network:
      type: object
      properties:
        id:
          type: string
          description: Network ID
          example: "bridge"
        name:
          type: string
          description: Network name
          example: "bridge"
        driver:
          type: string
          description: Network driver
          example: "bridge"
        created:
          type: string
          format: date-time
          description: Network creation time
        scope:
          type: string
          description: Network scope
          example: "local"
        enableIPv6:
          type: boolean
          description: IPv6 enabled flag
        ipam:
          $ref: '#/components/schemas/IPAM'
        internal:
          type: boolean
          description: Internal network flag
        attachable:
          type: boolean
          description: Attachable flag
        ingress:
          type: boolean
          description: Ingress flag
        configOnly:
          type: boolean
          description: Config-only flag
        options:
          type: object
          additionalProperties:
            type: string
          description: Network options
        labels:
          type: object
          additionalProperties:
            type: string
          description: Network labels
        containers:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/NetworkInfo'
          description: Connected containers

    IPAM:
      type: object
      properties:
        driver:
          type: string
          description: IPAM driver
          example: "default"
        options:
          type: object
          additionalProperties:
            type: string
          description: IPAM options
        config:
          type: array
          items:
            $ref: '#/components/schemas/IPAMConfig'
          description: IPAM configuration

    IPAMConfig:
      type: object
      properties:
        subnet:
          type: string
          description: Subnet CIDR
          example: "172.18.0.0/16"
        ipRange:
          type: string
          description: IP range CIDR
        gateway:
          type: string
          description: Gateway IP
          example: "172.18.0.1"
        auxAddress:
          type: object
          additionalProperties:
            type: string
          description: Auxiliary IP addresses

    Volume:
      type: object
      properties:
        name:
          type: string
          description: Volume name
          example: "my-volume"
        driver:
          type: string
          description: Volume driver
          example: "local"
        mountpoint:
          type: string
          description: Volume mount point
          example: "/var/lib/docker/volumes/my-volume/_data"
        createdAt:
          type: string
          format: date-time
          description: Volume creation time
        labels:
          type: object
          additionalProperties:
            type: string
          description: Volume labels
        scope:
          type: string
          description: Volume scope
          example: "local"
        options:
          type: object
          additionalProperties:
            type: string
          description: Volume options
        usageData:
          $ref: '#/components/schemas/VolumeUsageData'

    VolumeUsageData:
      type: object
      properties:
        size:
          type: integer
          format: int64
          description: Volume size in bytes
        refCount:
          type: integer
          format: int64
          description: Reference count

    # Kubernetes Resource Response Schemas
    PodsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                pods:
                  type: array
                  items:
                    $ref: '#/components/schemas/PodInfo'

    DeploymentsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                deployments:
                  type: array
                  items:
                    $ref: '#/components/schemas/DeploymentInfo'

    ServicesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                services:
                  type: array
                  items:
                    $ref: '#/components/schemas/ServiceInfo'

    IngressesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                ingresses:
                  type: array
                  items:
                    $ref: '#/components/schemas/IngressInfo'

    PVCsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                pvcs:
                  type: array
                  items:
                    $ref: '#/components/schemas/PVCInfo'

    PVsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                pvs:
                  type: array
                  items:
                    $ref: '#/components/schemas/PVInfo'

    SecretsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                secrets:
                  type: array
                  items:
                    $ref: '#/components/schemas/SecretInfo'

    ConfigMapsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                configmaps:
                  type: array
                  items:
                    $ref: '#/components/schemas/ConfigMapInfo'

    NamespacesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                namespaces:
                  type: array
                  items:
                    $ref: '#/components/schemas/NamespaceInfo'

    NodesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                count:
                  type: integer
                  description: Total number of nodes
                nodes:
                  type: array
                  items:
                    $ref: '#/components/schemas/NodeInfo'

    DaemonSetsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                daemonsets:
                  type: array
                  items:
                    $ref: '#/components/schemas/DaemonSetInfo'

    StatefulSetsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                statefulsets:
                  type: array
                  items:
                    $ref: '#/components/schemas/StatefulSetInfo'

    JobsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                jobs:
                  type: array
                  items:
                    $ref: '#/components/schemas/JobInfo'

    CronJobsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                cronjobs:
                  type: array
                  items:
                    $ref: '#/components/schemas/CronJobInfo'

    ClusterInfoResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                cluster:
                  $ref: '#/components/schemas/ClusterInfo'

    IngressClassesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                ingressClasses:
                  type: array
                  items:
                    $ref: '#/components/schemas/IngressClassInfo'
                count:
                  type: integer

    NetworkPoliciesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                networkPolicies:
                  type: array
                  items:
                    $ref: '#/components/schemas/NetworkPolicyInfo'
                count:
                  type: integer

    # Kubernetes Resource Info Schemas
    PodInfo:
      type: object
      properties:
        name:
          type: string
        namespace:
          type: string
        status:
          type: string
        ready:
          type: string
        restarts:
          type: integer
        age:
          type: string
        ip:
          type: string
        node:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        annotations:
          type: object
          additionalProperties:
            type: string

    DeploymentInfo:
      type: object
      properties:
        name:
          type: string
        namespace:
          type: string
        ready:
          type: string
        up_to_date:
          type: integer
        available:
          type: integer
        age:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        annotations:
          type: object
          additionalProperties:
            type: string

    ServiceInfo:
      type: object
      properties:
        name:
          type: string
        namespace:
          type: string
        type:
          type: string
        cluster_ip:
          type: string
        external_ip:
          type: string
        ports:
          type: string
        age:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        annotations:
          type: object
          additionalProperties:
            type: string

    IngressInfo:
      type: object
      properties:
        name:
          type: string
        namespace:
          type: string
        class:
          type: string
        hosts:
          type: string
        address:
          type: string
        ports:
          type: string
        age:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        annotations:
          type: object
          additionalProperties:
            type: string

    PVCInfo:
      type: object
      properties:
        name:
          type: string
        namespace:
          type: string
        status:
          type: string
        volume:
          type: string
        capacity:
          type: string
        access_modes:
          type: string
        storage_class:
          type: string
        age:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        annotations:
          type: object
          additionalProperties:
            type: string

    PVInfo:
      type: object
      properties:
        name:
          type: string
        capacity:
          type: string
        access_modes:
          type: string
        reclaim_policy:
          type: string
        status:
          type: string
        claim:
          type: string
        storage_class:
          type: string
        reason:
          type: string
        age:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        annotations:
          type: object
          additionalProperties:
            type: string

    SecretInfo:
      type: object
      properties:
        name:
          type: string
        namespace:
          type: string
        type:
          type: string
        data:
          type: integer
        age:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        annotations:
          type: object
          additionalProperties:
            type: string

    ConfigMapInfo:
      type: object
      properties:
        name:
          type: string
        namespace:
          type: string
        data:
          type: integer
        age:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        annotations:
          type: object
          additionalProperties:
            type: string

    NamespaceInfo:
      type: object
      properties:
        name:
          type: string
        status:
          type: string
        age:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        annotations:
          type: object
          additionalProperties:
            type: string

    NodeInfo:
      type: object
      properties:
        name:
          type: string
        status:
          type: string
        roles:
          type: string
        age:
          type: string
        version:
          type: string
        internalIP:
          type: string
        externalIP:
          type: string
        os:
          type: string
        kernelVersion:
          type: string
        containerRuntime:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        creationTimestamp:
          type: string
          format: date-time

    DaemonSetInfo:
      type: object
      properties:
        name:
          type: string
        namespace:
          type: string
        desired:
          type: integer
        current:
          type: integer
        ready:
          type: integer
        up_to_date:
          type: integer
        available:
          type: integer
        node_selector:
          type: string
        age:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        annotations:
          type: object
          additionalProperties:
            type: string

    StatefulSetInfo:
      type: object
      properties:
        name:
          type: string
        namespace:
          type: string
        ready:
          type: string
        age:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        annotations:
          type: object
          additionalProperties:
            type: string

    JobInfo:
      type: object
      properties:
        name:
          type: string
        namespace:
          type: string
        completions:
          type: string
        duration:
          type: string
        age:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        annotations:
          type: object
          additionalProperties:
            type: string

    CronJobInfo:
      type: object
      properties:
        name:
          type: string
        namespace:
          type: string
        schedule:
          type: string
        suspend:
          type: boolean
        active:
          type: integer
        last_schedule:
          type: string
        age:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        annotations:
          type: object
          additionalProperties:
            type: string

    ClusterInfo:
      type: object
      properties:
        version:
          type: string
        platform:
          type: string
        nodes:
          type: integer
        namespaces:
          type: integer
        pods:
          type: integer
        services:
          type: integer

    IngressClassInfo:
      type: object
      properties:
        name:
          type: string
        controller:
          type: string
        parameters:
          type: object
          properties:
            apiGroup:
              type: string
            kind:
              type: string
            name:
              type: string
        age:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        annotations:
          type: object
          additionalProperties:
            type: string

    NetworkPolicyInfo:
      type: object
      properties:
        name:
          type: string
        namespace:
          type: string
        pod_selector:
          type: object
          additionalProperties:
            type: string
        policy_types:
          type: array
          items:
            type: string
            enum: [Ingress, Egress]
        age:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        annotations:
          type: object
          additionalProperties:
            type: string

    # Container action and detail response schemas
    ContainerDetailResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              description: Detailed container information from Docker daemon
              # The data contains the raw Docker ContainerJSON object
              # which has extensive details about the container

    ContainerActionResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                containerId:
                  type: string
                  description: Container ID that the action was performed on
                  example: "abc123def456"
                action:
                  type: string
                  description: Action that was performed
                  enum: [start, stop, remove]
                  example: "start"
                message:
                  type: string
                  description: Human-readable message about the action result
                  example: "Container started successfully"
                success:
                  type: boolean
                  description: Whether the action was successful
                  example: true

    ContainerLogsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                containerId:
                  type: string
                  description: Container ID that logs were retrieved from
                  example: "abc123def456"
                logs:
                  type: string
                  description: Container logs output
                  example: "2025-08-04T12:00:00.000Z Starting application...\n2025-08-04T12:00:01.000Z Server listening on port 8080\n"

    ImageActionResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                imageId:
                  type: string
                  description: Image ID that the action was performed on
                  example: "sha256:abc123def456"
                action:
                  type: string
                  description: Action that was performed
                  enum: [remove]
                  example: "remove"
                message:
                  type: string
                  description: Human-readable message about the action result
                  example: "Image removed successfully"
                success:
                  type: boolean
                  description: Whether the action was successful
                  example: true

    VolumeActionResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                volumeId:
                  type: string
                  description: Volume ID that the action was performed on
                  example: "my-volume"
                action:
                  type: string
                  description: Action that was performed
                  enum: [remove]
                  example: "remove"
                message:
                  type: string
                  description: Human-readable message about the action result
                  example: "Volume removed successfully"
                success:
                  type: boolean
                  description: Whether the action was successful
                  example: true

    NetworkActionResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                networkId:
                  type: string
                  description: Network ID that the action was performed on
                  example: "bridge"
                action:
                  type: string
                  description: Action that was performed
                  enum: [remove]
                  example: "remove"
                message:
                  type: string
                  description: Human-readable message about the action result
                  example: "Network removed successfully"
                success:
                  type: boolean
                  description: Whether the action was successful
                  example: true

    ContainerCreateRequest:
      type: object
      properties:
        name:
          type: string
          description: Optional container name
          example: my-container
        image:
          type: string
          description: Docker image to use for the container
          example: "nginx:latest"
        cmd:
          type: array
          items:
            type: string
          description: Command to run in the container
          example: ["nginx", "-g", "daemon off;"]
        env:
          type: array
          items:
            type: string
          description: List of environment variables to set in the container
          example: ["ENV=production", "DEBUG=false"]
        exposedPorts:
          type: object
          additionalProperties: {}
          description: Ports to expose from the container
          example:
            "80/tcp": {}
        portBindings:
          type: object
          additionalProperties:
            type: array
            items:
              type: object
              properties:
                hostPort:
                  type: string
          description: Port mappings for exposed container ports
          example:
            "80/tcp":
              - hostPort: "8080"
        labels:
          type: object
          additionalProperties:
            type: string
          description: Metadata labels assigned to the container
        workingDir:
          type: string
          description: Working directory in the container
          example: /app
        volumes:
          type: array
          items:
            type: object
            properties:
              source:
                type: string
              target:
                type: string
              type:
                type: string
              readOnly:
                type: boolean
              bindOptions:
                type: object
                properties:
                  propagation:
                    type: string
            example:
              source: "/var/www"
              target: "/usr/share/nginx/html"
              type: "bind"
              readOnly: false
        networkMode:
          type: string
          description: Which network to connect container to
          example: bridge
        restartPolicy:
          type: object
          properties:
            name:
              type: string
              description: Restart policy to apply when a container exits
              example: "always"
            maximumRetryCount:
              type: integer
              description: Maximum retry count for 'on-failure' policy

    ContainerCreateResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                containerId:
                  type: string
                  description: ID of the created container
                  example: "8dfafdbc3a40"
                warnings:
                  type: array
                  items:
                    type: string
                  description: Any warnings generated from container creation

    ImagePullRequest:
      type: object
      properties:
        imageName:
          type: string
          description: Name of the image to pull
          example: "nginx"
        tag:
          type: string
          description: Tag of the image to pull
          example: "latest"

    ImagePullResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                imageName:
                  type: string
                  description: Name of the pulled image
                  example: "nginx:latest"

    # Helm Response Schemas
    HelmReleasesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                releases:
                  type: array
                  items:
                    $ref: '#/components/schemas/HelmRelease'
                count:
                  type: integer
                  description: Number of releases returned
                  example: 3

    HelmChartsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                charts:
                  type: array
                  items:
                    $ref: '#/components/schemas/HelmChart'
                count:
                  type: integer
                  description: Number of charts returned
                  example: 6

    HelmRelease:
      type: object
      properties:
        name:
          type: string
          description: Name of the Helm release
          example: "nginx-release"
        namespace:
          type: string
          description: Kubernetes namespace where the release is deployed
          example: "default"
        version:
          type: integer
          description: Release revision number
          example: 1
        status:
          type: string
          description: Current status of the release
          enum: [unknown, deployed, uninstalled, superseded, failed, uninstalling, pending-install, pending-upgrade, pending-rollback]
          example: "deployed"
        chart:
          type: string
          description: Name of the Helm chart
          example: "nginx"
        chart_version:
          type: string
          description: Version of the Helm chart
          example: "1.0.0"
        app_version:
          type: string
          description: Version of the application being deployed
          example: "1.21.0"
        updated:
          type: string
          format: date-time
          description: Last update time of the release
          example: "2025-08-05T12:00:00Z"
        description:
          type: string
          description: Description of the release
          example: "Install complete"
        labels:
          type: object
          additionalProperties:
            type: string
          description: Labels attached to the release
          example:
            app.kubernetes.io/managed-by: "Helm"

    HelmChart:
      type: object
      properties:
        name:
          type: string
          description: Name of the Helm chart
          example: "bitnami/nginx"
        version:
          type: string
          description: Version of the chart
          example: "13.2.23"
        description:
          type: string
          description: Description of the chart
          example: "NGINX Open Source plus a number of useful modules"
        repository:
          type: string
          description: Repository containing the chart
          example: "bitnami"
        app_version:
          type: string
          description: Version of the application being deployed
          example: "1.25.3"

    HelmRepositoriesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                repositories:
                  type: array
                  items:
                    $ref: '#/components/schemas/HelmRepository'
                count:
                  type: integer
                  description: Number of repositories returned
                  example: 2

    HelmRepository:
      type: object
      properties:
        name:
          type: string
          description: Name of the Helm repository
          example: "bitnami"
        url:
          type: string
          description: URL of the Helm repository
          example: "https://charts.bitnami.com/bitnami"

    HelmRepositoryAddRequest:
      type: object
      required:
        - name
        - url
      properties:
        name:
          type: string
          description: Name to assign to the repository
          example: "bitnami"
          minLength: 1
        url:
          type: string
          description: URL of the Helm repository
          example: "https://charts.bitnami.com/bitnami"
          format: uri
        username:
          type: string
          description: Username for authenticated repositories
          example: ""
        password:
          type: string
          description: Password for authenticated repositories
          example: ""
        cert_file:
          type: string
          description: Path to TLS certificate file
          example: ""
        key_file:
          type: string
          description: Path to TLS key file
          example: ""
        ca_file:
          type: string
          description: Path to CA bundle file
          example: ""
        insecure_skip_tls_verify:
          type: boolean
          description: Skip TLS certificate verification
          default: false
        pass_credentials_all:
          type: boolean
          description: Pass credentials to all domains
          default: false
        force_update:
          type: boolean
          description: Force update the repository if it already exists
          default: false

    HelmRepositoryAddResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                repository:
                  $ref: '#/components/schemas/HelmRepository'
                message:
                  type: string
                  description: Success message
                  example: "Repository has been added"
                updated:
                  type: boolean
                  description: Whether the repository was updated (vs newly added)
                  example: false

    HelmRepositoryUpdateResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                repository:
                  $ref: '#/components/schemas/HelmRepository'
                message:
                  type: string
                  description: Success message from helm repo update
                  example: "Successfully got an update from the \"bitnami\" chart repository"
                updated_at:
                  type: string
                  format: date-time
                  description: Timestamp when the repository was updated
                  example: "2025-08-07T00:10:12Z"

    # Kubernetes Resource Detail Response Schemas
    PodDetailResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        pod_detail:
          $ref: '#/components/schemas/PodDetail'
        error:
          $ref: '#/components/schemas/APIError'
          nullable: true

    DeploymentDetailResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        deployment_detail:
          $ref: '#/components/schemas/DeploymentDetail'
        error:
          $ref: '#/components/schemas/APIError'
          nullable: true

    ServiceDetailResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        service_detail:
          $ref: '#/components/schemas/ServiceDetail'
        error:
          $ref: '#/components/schemas/APIError'
          nullable: true

    IngressDetailResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        ingress_detail:
          $ref: '#/components/schemas/IngressDetail'
        error:
          $ref: '#/components/schemas/APIError'
          nullable: true

    PVCDetailResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        pvc_detail:
          $ref: '#/components/schemas/PVCDetail'
        error:
          $ref: '#/components/schemas/APIError'
          nullable: true

    PVDetailResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        pv_detail:
          $ref: '#/components/schemas/PVDetail'
        error:
          $ref: '#/components/schemas/APIError'
          nullable: true

    SecretDetailResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        secret_detail:
          $ref: '#/components/schemas/SecretDetail'
        error:
          $ref: '#/components/schemas/APIError'
          nullable: true

    ConfigMapDetailResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        configmap_detail:
          $ref: '#/components/schemas/ConfigMapDetail'
        error:
          $ref: '#/components/schemas/APIError'
          nullable: true

    NamespaceDetailResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        namespace_detail:
          $ref: '#/components/schemas/NamespaceDetail'
        error:
          $ref: '#/components/schemas/APIError'
          nullable: true

    NodeDetailResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        node_detail:
          $ref: '#/components/schemas/NodeDetail'
        error:
          $ref: '#/components/schemas/APIError'
          nullable: true

    DaemonSetDetailResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        daemonset_detail:
          $ref: '#/components/schemas/DaemonSetDetail'
        error:
          $ref: '#/components/schemas/APIError'
          nullable: true

    StatefulSetDetailResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        statefulset_detail:
          $ref: '#/components/schemas/StatefulSetDetail'
        error:
          $ref: '#/components/schemas/APIError'
          nullable: true

    JobDetailResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        job_detail:
          $ref: '#/components/schemas/JobDetail'
        error:
          $ref: '#/components/schemas/APIError'
          nullable: true

    CronJobDetailResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        cronjob_detail:
          $ref: '#/components/schemas/CronJobDetail'
        error:
          $ref: '#/components/schemas/APIError'
          nullable: true

    IngressClassDetailResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        ingressclass_detail:
          $ref: '#/components/schemas/IngressClassDetail'
        error:
          $ref: '#/components/schemas/APIError'
          nullable: true

    NetworkPolicyDetailResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        networkpolicy_detail:
          $ref: '#/components/schemas/NetworkPolicyDetail'
        error:
          $ref: '#/components/schemas/APIError'
          nullable: true

    # Pod Detail Schema - Returns raw Kubernetes Pod object
    PodDetail:
      type: object
      description: Raw Kubernetes Pod object with full API specification
      additionalProperties: true
      example:
        apiVersion: v1
        kind: Pod
        metadata:
          name: nginx-pod
          namespace: default
          uid: 12345678-1234-1234-1234-123456789012
          resourceVersion: "1234"
          creationTimestamp: "2024-01-15T10:30:00Z"
          labels:
            app: nginx
            environment: production
          annotations:
            kubectl.kubernetes.io/last-applied-configuration: |
              {"apiVersion":"v1","kind":"Pod",...}
        spec:
          containers:
          - name: nginx
            image: nginx:1.21
            ports:
            - containerPort: 80
              protocol: TCP
            resources:
              limits:
                cpu: "1"
                memory: 1Gi
              requests:
                cpu: 100m
                memory: 128Mi
            volumeMounts:
            - name: config
              mountPath: /etc/nginx
          volumes:
          - name: config
            configMap:
              name: nginx-config
          restartPolicy: Always
          serviceAccountName: default
          nodeName: worker-node-1
        status:
          phase: Running
          conditions:
          - type: Ready
            status: "True"
            lastProbeTime: null
            lastTransitionTime: "2024-01-15T10:31:00Z"
          - type: ContainersReady
            status: "True"
            lastProbeTime: null
            lastTransitionTime: "2024-01-15T10:31:00Z"
          - type: PodScheduled
            status: "True"
            lastProbeTime: null
            lastTransitionTime: "2024-01-15T10:30:30Z"
          hostIP: 10.0.1.100
          podIP: 172.16.1.10
          podIPs:
          - ip: 172.16.1.10
          startTime: "2024-01-15T10:30:30Z"
          containerStatuses:
          - name: nginx
            state:
              running:
                startedAt: "2024-01-15T10:31:00Z"
            lastState: {}
            ready: true
            restartCount: 0
            image: nginx:1.21
            imageID: docker://sha256:abcdef123456
            containerID: docker://abcdef123456789
            started: true

    ContainerInfo:
      type: object
      properties:
        name:
          type: string
          description: Container name
        image:
          type: string
          description: Container image
        ready:
          type: boolean
          description: Container ready status
        restart_count:
          type: integer
          description: Container restart count
        state:
          type: string
          description: Container state
        state_reason:
          type: string
          description: Container state reason

    PodCondition:
      type: object
      properties:
        type:
          type: string
          description: Condition type
        status:
          type: string
          description: Condition status
        last_probe_time:
          type: string
          format: date-time
          description: Last probe time
        last_transition_time:
          type: string
          format: date-time
          description: Last transition time
        reason:
          type: string
          description: Condition reason
        message:
          type: string
          description: Condition message

    DeploymentDetail:
      type: object
      description: Raw Kubernetes Deployment object with full API specification
      additionalProperties: true
      example:
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          name: nginx-deployment
          namespace: default
          uid: 22345678-2234-2234-2234-223456789012
          resourceVersion: "5678"
          generation: 3
          creationTimestamp: "2024-01-15T09:00:00Z"
          labels:
            app: nginx
            tier: frontend
          annotations:
            deployment.kubernetes.io/revision: "3"
        spec:
          replicas: 3
          selector:
            matchLabels:
              app: nginx
          template:
            metadata:
              labels:
                app: nginx
            spec:
              containers:
              - name: nginx
                image: nginx:1.21-alpine
                ports:
                - containerPort: 80
                resources:
                  limits:
                    cpu: 500m
                    memory: 512Mi
                  requests:
                    cpu: 250m
                    memory: 256Mi
          strategy:
            type: RollingUpdate
            rollingUpdate:
              maxSurge: 1
              maxUnavailable: 1
          minReadySeconds: 10
          revisionHistoryLimit: 10
          progressDeadlineSeconds: 600
        status:
          observedGeneration: 3
          replicas: 3
          updatedReplicas: 3
          readyReplicas: 3
          availableReplicas: 3
          conditions:
          - type: Available
            status: "True"
            lastUpdateTime: "2024-01-15T09:05:00Z"
            lastTransitionTime: "2024-01-15T09:05:00Z"
            reason: MinimumReplicasAvailable
            message: Deployment has minimum availability.
          - type: Progressing
            status: "True"
            lastUpdateTime: "2024-01-15T09:05:00Z"
            lastTransitionTime: "2024-01-15T09:01:00Z"
            reason: NewReplicaSetAvailable
            message: ReplicaSet "nginx-deployment-6b474476c4" has successfully progressed.

    StatefulSetDetail:
      type: object
      description: Raw Kubernetes StatefulSet object with full API specification
      additionalProperties: true
      example:
        apiVersion: apps/v1
        kind: StatefulSet
        metadata:
          name: postgres-statefulset
          namespace: database
          uid: 32345678-3234-3234-3234-323456789012
          resourceVersion: "8901"
          generation: 2
          creationTimestamp: "2024-01-15T08:00:00Z"
          labels:
            app: postgres
            tier: database
        spec:
          serviceName: postgres-service
          replicas: 3
          selector:
            matchLabels:
              app: postgres
          template:
            metadata:
              labels:
                app: postgres
            spec:
              containers:
              - name: postgres
                image: postgres:14.5
                ports:
                - containerPort: 5432
                  name: postgres
                env:
                - name: POSTGRES_DB
                  value: mydb
                - name: POSTGRES_USER
                  value: myuser
                - name: POSTGRES_PASSWORD
                  valueFrom:
                    secretKeyRef:
                      name: postgres-secret
                      key: password
                volumeMounts:
                - name: postgres-storage
                  mountPath: /var/lib/postgresql/data
          volumeClaimTemplates:
          - metadata:
              name: postgres-storage
            spec:
              accessModes: [ "ReadWriteOnce" ]
              storageClassName: fast-ssd
              resources:
                requests:
                  storage: 10Gi
          updateStrategy:
            type: RollingUpdate
            rollingUpdate:
              partition: 0
          podManagementPolicy: OrderedReady
          persistentVolumeClaimRetentionPolicy:
            whenDeleted: Retain
            whenScaled: Retain
        status:
          observedGeneration: 2
          replicas: 3
          readyReplicas: 3
          currentReplicas: 3
          updatedReplicas: 3
          currentRevision: postgres-statefulset-6d4cf56b5f
          updateRevision: postgres-statefulset-6d4cf56b5f
          collisionCount: 0
          conditions:
          - type: Available
            status: "True"
            lastTransitionTime: "2024-01-15T08:10:00Z"
            reason: MinimumReplicasAvailable
            message: StatefulSet has minimum availability.

    ServiceDetail:
      type: object
      description: Raw Kubernetes Service object with full API specification
      additionalProperties: true
      example:
        apiVersion: v1
        kind: Service
        metadata:
          name: nginx-service
          namespace: default
          uid: 42345678-4234-4234-4234-423456789012
          resourceVersion: "9999"
          creationTimestamp: "2024-01-15T10:00:00Z"
          labels:
            app: nginx
            tier: frontend
          annotations:
            service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
        spec:
          type: LoadBalancer
          selector:
            app: nginx
          ports:
          - name: http
            port: 80
            targetPort: 8080
            protocol: TCP
            nodePort: 30080
          - name: https
            port: 443
            targetPort: 8443
            protocol: TCP
            nodePort: 30443
          clusterIP: 10.96.0.44
          externalTrafficPolicy: Cluster
          sessionAffinity: None
          loadBalancerSourceRanges:
          - 0.0.0.0/0
        status:
          loadBalancer:
            ingress:
            - ip: 192.168.1.100
              hostname: a1234567890abcdef.elb.us-west-2.amazonaws.com
          conditions:
          - type: LoadBalancerReady
            status: "True"
            lastTransitionTime: "2024-01-15T10:05:00Z"
            reason: LoadBalancerProvisioned
            message: Load balancer is ready

    IngressDetail:
      type: object
      description: Raw Kubernetes Ingress object with full API specification
      additionalProperties: true
      example:
        apiVersion: networking.k8s.io/v1
        kind: Ingress
        metadata:
          name: app-ingress
          namespace: default
          uid: 52345678-5234-5234-5234-523456789012
          resourceVersion: "11111"
          creationTimestamp: "2024-01-15T11:00:00Z"
          labels:
            app: webapp
            environment: production
          annotations:
            nginx.ingress.kubernetes.io/rewrite-target: /
            cert-manager.io/cluster-issuer: letsencrypt-prod
            nginx.ingress.kubernetes.io/ssl-redirect: "true"
        spec:
          ingressClassName: nginx
          tls:
          - hosts:
            - app.example.com
            - www.app.example.com
            secretName: app-tls-secret
          rules:
          - host: app.example.com
            http:
              paths:
              - path: /api
                pathType: Prefix
                backend:
                  service:
                    name: api-service
                    port:
                      number: 8080
              - path: /
                pathType: Prefix
                backend:
                  service:
                    name: frontend-service
                    port:
                      number: 80
          - host: www.app.example.com
            http:
              paths:
              - path: /
                pathType: Prefix
                backend:
                  service:
                    name: frontend-service
                    port:
                      number: 80
        status:
          loadBalancer:
            ingress:
            - ip: 203.0.113.10
              hostname: a234567890abcdef.elb.us-west-2.amazonaws.com

    PVCDetail:
      type: object
      description: Raw Kubernetes PersistentVolumeClaim object with full API specification
      additionalProperties: true
      example:
        apiVersion: v1
        kind: PersistentVolumeClaim
        metadata:
          name: postgres-pvc
          namespace: database
          uid: 62345678-6234-6234-6234-623456789012
          resourceVersion: "12345"
          creationTimestamp: "2024-01-15T07:30:00Z"
          labels:
            app: postgres
            environment: production
          annotations:
            volume.beta.kubernetes.io/storage-provisioner: ebs.csi.aws.com
            pv.kubernetes.io/bind-completed: "yes"
            pv.kubernetes.io/bound-by-controller: "yes"
          finalizers:
          - kubernetes.io/pvc-protection
        spec:
          accessModes:
          - ReadWriteOnce
          resources:
            requests:
              storage: 20Gi
          storageClassName: gp3-encrypted
          volumeMode: Filesystem
          volumeName: pvc-62345678-6234-6234-6234-623456789012
        status:
          phase: Bound
          accessModes:
          - ReadWriteOnce
          capacity:
            storage: 20Gi
          conditions:
          - type: Resizing
            status: "False"
            lastProbeTime: null
            lastTransitionTime: "2024-01-15T07:31:00Z"
          - type: FileSystemResizePending
            status: "False"
            lastProbeTime: null
            lastTransitionTime: "2024-01-15T07:31:00Z"

    PVDetail:
      type: object
      description: Raw Kubernetes PersistentVolume object with full API specification
      additionalProperties: true
      example:
        apiVersion: v1
        kind: PersistentVolume
        metadata:
          name: postgres-pv
          uid: 72345678-7234-7234-7234-723456789012
          resourceVersion: "56789"
          creationTimestamp: "2024-01-15T07:00:00Z"
          labels:
            type: gp3-encrypted
            app: postgres
          annotations:
            pv.kubernetes.io/provisioned-by: ebs.csi.aws.com
          finalizers:
          - kubernetes.io/pv-protection
        spec:
          capacity:
            storage: 20Gi
          accessModes:
          - ReadWriteOnce
          persistentVolumeReclaimPolicy: Retain
          storageClassName: gp3-encrypted
          mountOptions:
          - debug
          volumeMode: Filesystem
          csi:
            driver: ebs.csi.aws.com
            fsType: ext4
            volumeHandle: vol-0a1b2c3d4e5f6g7h8
        status:
          phase: Bound
          reason: ""
          message: ""
          conditions:
          - type: Resizing
            status: "False"
            lastProbeTime: null
            lastTransitionTime: "2024-01-15T07:45:00Z"

    SecretDetail:
      type: object
      description: Raw Kubernetes Secret object with full API specification
      additionalProperties: true
      example:
        apiVersion: v1
        kind: Secret
        metadata:
          name: postgres-secret
          namespace: database
          uid: 82345678-8234-8234-8234-823456789012
          resourceVersion: "67890"
          creationTimestamp: "2024-01-15T06:00:00Z"
          labels:
            app: postgres
          annotations:
            kubernetes.io/service-account.name: postgres
        data:
          password: cG9zdGdyZXM=
          username: cG9zdGdyZXVzZXI=
        type: Opaque

    ConfigMapDetail:
      type: object
      description: Raw Kubernetes ConfigMap object with full API specification
      additionalProperties: true
      example:
        apiVersion: v1
        kind: ConfigMap
        metadata:
          name: nginx-config
          namespace: default
          uid: 92345678-9234-9234-9234-923456789012
          resourceVersion: "78901"
          creationTimestamp: "2024-01-15T05:00:00Z"
          labels:
            app: nginx
        data:
          nginx.conf: |
            server {
              listen 80;
              server_name localhost;
              location / {
                root /usr/share/nginx/html;
                index index.html index.htm;
              }
            }

    NamespaceDetail:
      type: object
      description: Raw Kubernetes Namespace object with full API specification
      additionalProperties: true
      example:
        apiVersion: v1
        kind: Namespace
        metadata:
          name: production
          uid: a2345678-a234-a234-a234-a23456789012
          resourceVersion: "89012"
          creationTimestamp: "2024-01-15T04:00:00Z"
          labels:
            name: production
        status:
          phase: Active

    NodeDetail:
      type: object
      description: Raw Kubernetes Node object with full API specification
      additionalProperties: true
      example:
        apiVersion: v1
        kind: Node
        metadata:
          name: worker-node-1
          uid: b2345678-b234-b234-b234-b23456789012
          resourceVersion: "90123"
          creationTimestamp: "2024-01-15T03:00:00Z"
          labels:
            node-role.kubernetes.io/worker: ""
        spec:
          podCIDR: 192.168.1.0/24
          providerID: aws:///us-west-2a/i-0a1b2c3d4e5f6g7h8
        status:
          capacity:
            cpu: "4"
            memory: 16384Mi
            pods: "110"
          allocatable:
            cpu: "4"
            memory: 16384Mi
            pods: "110"
          addresses:
          - type: InternalIP
            address: 10.0.1.100
          - type: ExternalIP
            address: 52.10.15.20
          - type: Hostname
            address: worker-node-1.example.com
          conditions:
          - type: Ready
            status: "True"
            lastHeartbeatTime: "2024-01-15T03:10:00Z"
            lastTransitionTime: "2024-01-15T03:05:00Z"
            reason: KubeletReady
            message: kubelet is posting ready status
          nodeInfo:
            machineID: ec2540b5b2540123
            systemUUID: ecb4567-ebfd-44b1-a312-a23456789012
            bootID: ec7c257e-a128-11ec-9620-a23456789012
            kernelVersion: 5.4.0-1045-aws
            osImage: Ubuntu 20.04.2 LTS
            containerRuntimeVersion: docker://20.10.6
            kubeletVersion: v1.21.1
            kubeProxyVersion: v1.21.1
            operatingSystem: linux
            architecture: amd64

    DaemonSetDetail:
      type: object
      description: Raw Kubernetes DaemonSet object with full API specification
      additionalProperties: true
      example:
        apiVersion: apps/v1
        kind: DaemonSet
        metadata:
          name: prometheus-node-exporter
          namespace: monitoring
          uid: c2345678-c234-c234-c234-c23456789012
          resourceVersion: "91234"
          creationTimestamp: "2024-01-15T02:00:00Z"
          labels:
            app: node-exporter
            environment: production
        spec:
          selector:
            matchLabels:
              app: node-exporter
          template:
            metadata:
              labels:
                app: node-exporter
            spec:
              containers:
              - name: node-exporter
                image: prom/node-exporter:v1.0.1
                resources:
                  limits:
                    cpu: "100m"
                    memory: "200Mi"
                  requests:
                    cpu: "100m"
                    memory: "200Mi"
          updateStrategy:
            type: RollingUpdate
          minReadySeconds: 5
        status:
          currentNumberScheduled: 5
          numberMisscheduled: 0
          desiredNumberScheduled: 5
          numberReady: 5
          observedGeneration: 1

    JobDetail:
      type: object
      description: Raw Kubernetes Job object with full API specification
      additionalProperties: true
      example:
        apiVersion: batch/v1
        kind: Job
        metadata:
          name: backup-job
          namespace: backup
          uid: d2345678-d234-d234-d234-d23456789012
          resourceVersion: "92345"
          creationTimestamp: "2024-01-15T01:00:00Z"
          labels:
            batch: backup
            environment: production
        spec:
          template:
            metadata:
              labels:
                batch: backup
            spec:
              containers:
              - name: backup-container
                image: myorg/backup:1.0
                command: ["/bin/sh", "-c", "echo Backup started..."]
              restartPolicy: Never
          backoffLimit: 3
        status:
          conditions:
          - type: Complete
            status: "True"
            lastProbeTime: "2024-01-15T01:20:00Z"
            lastTransitionTime: "2024-01-15T01:15:00Z"
          startTime: "2024-01-15T01:00:00Z"
          completionTime: "2024-01-15T01:30:00Z"
          succeeded: 1

    CronJobDetail:
      type: object
      description: Raw Kubernetes CronJob object with full API specification
      additionalProperties: true
      example:
        apiVersion: batch/v1
        kind: CronJob
        metadata:
          name: database-backup
          namespace: backups
          uid: e2345678-e234-e234-e234-e23456789012
          resourceVersion: "93456"
          creationTimestamp: "2024-01-14T23:00:00Z"
          labels:
            batch: cron-job
            environment: production
        spec:
          schedule: "0 1 * * *"
          jobTemplate:
            spec:
              template:
                metadata:
                  labels:
                    batch: cron-job
                spec:
                  containers:
                  - name: backup-container
                    image: myorg/backup:1.0
                    command: ["/bin/sh", "-c", "echo Performing backup..."]
                  restartPolicy: OnFailure
          successfulJobsHistoryLimit: 3
          failedJobsHistoryLimit: 1
        status:
          lastScheduleTime: "2024-01-19T01:00:00Z"
          active:
          - name: database-backup-273987
            namespace: backups
            uid: f2345678-f234-f234-f234-f23456789012

    IngressClassDetail:
      type: object
      description: Raw Kubernetes IngressClass object with full API specification
      additionalProperties: true
      example:
        apiVersion: networking.k8s.io/v1
        kind: IngressClass
        metadata:
          name: nginx
          uid: f3345678-f334-f334-f334-f33456789012
          resourceVersion: "94567"
          creationTimestamp: "2024-01-14T22:00:00Z"
          labels:
            app.kubernetes.io/component: controller
            app.kubernetes.io/instance: nginx
            app.kubernetes.io/name: ingress-nginx
          annotations:
            ingressclass.kubernetes.io/is-default-class: "true"
        spec:
          controller: k8s.io/ingress-nginx
          parameters:
            apiGroup: v1
            kind: ConfigMap
            name: nginx-load-balancer-microk8s-conf
            namespace: ingress

    NetworkPolicyDetail:
      type: object
      description: Raw Kubernetes NetworkPolicy object with full API specification
      additionalProperties: true
      example:
        apiVersion: networking.k8s.io/v1
        kind: NetworkPolicy
        metadata:
          name: web-deny-all
          namespace: default
          uid: f4345678-f434-f434-f434-f43456789012
          resourceVersion: "95678"
          creationTimestamp: "2024-01-14T21:00:00Z"
          labels:
            app: web
            environment: production
        spec:
          podSelector:
            matchLabels:
              app: web
          policyTypes:
          - Ingress
          - Egress
          ingress:
          - from:
            - namespaceSelector:
                matchLabels:
                  name: production
            - podSelector:
                matchLabels:
                  role: frontend
            ports:
            - protocol: TCP
              port: 80
          egress:
          - to:
            - podSelector:
                matchLabels:
                  role: database
            ports:
            - protocol: TCP
              port: 5432

    # Virtualization Schemas
    VM:
      type: object
      properties:
        uuid:
          type: string
        name:
          type: string
        state:
          type: string
        memory:
          type: integer
        max_memory:
          type: integer
        vcpus:
          type: integer
        autostart:
          type: boolean
        persistent:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        os:
          $ref: '#/components/schemas/OSInfo'
        disks:
          type: array
          items:
            $ref: '#/components/schemas/Disk'
        networks:
          type: array
          items:
            $ref: '#/components/schemas/NetworkInterface'

    VMCreateRequest:
      type: object
      properties:
        name:
          type: string
        memory:
          type: integer
        vcpus:
          type: integer
        disk_size:
          type: integer
        disk_path:
          type: string
        iso_path:
          type: string
        storage_pool:
          type: string
        network:
          type: string
        cloud_init:
          $ref: '#/components/schemas/CloudInit'
        autostart:
          type: boolean

    VMUpdateRequest:
      type: object
      properties:
        memory:
          type: integer
        vcpus:
          type: integer
        autostart:
          type: boolean

    OSInfo:
      type: object
      properties:
        type:
          type: string
        architecture:
          type: string
        machine:
          type: string

    NetworkInterface:
      type: object
      properties:
        mac:
          type: string
        source:
          type: string
        model:
          type: string

    CloudInit:
      type: object
      description: Cloud-init configuration for VM initialization
      properties:
        user_data:
          type: string
          description: Cloud-init user data script (YAML or shell script)
          example: |
            #cloud-config
            package_update: true
            package_upgrade: true
        meta_data:
          type: string
          description: Cloud-init metadata
          example: |
            instance-id: i-1234567890abcdef0
            local-hostname: cloudimg
        network_data:
          type: string
          description: Cloud-init network configuration
          example: |
            version: 2
            ethernets:
              enp0s3:
                dhcp4: true
        ssh_keys:
          type: array
          description: SSH public keys to add to the default user
          items:
            type: string
          example:
            - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC..."
            - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOM..."
        users:
          type: array
          description: Additional users to create
          items:
            type: object
            properties:
              name:
                type: string
                description: Username
                example: "devops"
              ssh_authorized_keys:
                type: array
                description: SSH public keys for this user
                items:
                  type: string
                example:
                  - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC..."
              sudo:
                type: string
                description: Sudo privileges configuration
                example: "ALL=(ALL) NOPASSWD:ALL"
              groups:
                type: string
                description: Comma-separated list of groups
                example: "admin,docker,wheel"
              shell:
                type: string
                description: User's shell
                example: "/bin/bash"
              password:
                type: string
                description: Encrypted password for the user
                format: password
                example: "$6$rounds=4096$saltsalt$..."
        packages:
          type: array
          description: Packages to install
          items:
            type: string
          example:
            - "docker.io"
            - "git"
            - "vim"
            - "htop"
    StoragePool:
      type: object
      properties:
        name:
          type: string
        type:
          type: string
        path:
          type: string
        state:
          type: string
        capacity:
          type: integer
        allocation:
          type: integer
        available:
          type: integer
        autostart:
          type: boolean

    StoragePoolCreateRequest:
      type: object
      properties:
        name:
          type: string
        type:
          type: string
        path:
          type: string
        autostart:
          type: boolean

    StorageVolume:
      type: object
      properties:
        name:
          type: string
        pool:
          type: string
        path:
          type: string
        type:
          type: string
        capacity:
          type: integer
        allocation:
          type: integer

    VolumeCreateRequest:
      type: object
      properties:
        name:
          type: string
        capacity:
          type: integer
        format:
          type: string

    VirtualNetwork:
      type: object
      properties:
        name:
          type: string
          description: Network name
        uuid:
          type: string
          description: Network UUID
        state:
          type: string
          description: Network state (active, inactive)
          enum: ["active", "inactive"]
        bridge:
          type: string
          description: Bridge name
        mode:
          type: string
          description: Network forwarding mode
          enum: ["nat", "route", "bridge", "private"]
        ip_range:
          $ref: '#/components/schemas/IPRange'
        dhcp:
          $ref: '#/components/schemas/DHCPConfig'
        autostart:
          type: boolean
          description: Whether autostart is enabled
        persistent:
          type: boolean
          description: Whether the network is persistent

    NetworkCreateRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
        mode:
          type: string
          enum: ["nat", "route", "bridge", "private"]
        bridge:
          type: string
        ip_range:
          $ref: '#/components/schemas/IPRange'
        dhcp:
          $ref: '#/components/schemas/DHCPConfig'
        autostart:
          type: boolean

    IPRange:
      type: object
      description: IP range configuration for network
      properties:
        address:
          type: string
          description: Network address (e.g., 192.168.122.1)
        netmask:
          type: string
          description: Network mask (e.g., 255.255.255.0)
        gateway:
          type: string
          description: Gateway address (optional)

    
    NetworkUpdateRequest:
      type: object
      description: Request to update a virtual network configuration
      properties:
        mode:
          type: string
          description: Network forwarding mode
          enum: ["nat", "route", "bridge", "private"]
        bridge:
          type: string
          description: Bridge name for the network
        ip_range:
          $ref: '#/components/schemas/IPRange'
        dhcp:
          $ref: '#/components/schemas/DHCPConfig'
        autostart:
          type: boolean
          description: Whether to enable autostart for the network
    
    DHCPConfig:
      type: object
      description: DHCP configuration for network
      properties:
        start:
          type: string
          description: Start of DHCP IP range (e.g., 192.168.122.2)
        end:
          type: string
          description: End of DHCP IP range (e.g., 192.168.122.254)
        hosts:
          type: array
          description: Static DHCP host assignments
          items:
            $ref: '#/components/schemas/DHCPHost'
    
    DHCPHost:
      type: object
      description: Static DHCP host assignment
      required:
        - mac
        - ip
      properties:
        mac:
          type: string
          description: MAC address of the host
        ip:
          type: string
          description: IP address to assign to the host
        name:
          type: string
          description: Optional hostname for the host
    
    DHCPLease:
      type: object
      description: Active DHCP lease information
      properties:
        interface:
          type: string
          description: Network interface name
        expiry_time:
          type: string
          format: date-time
          description: Lease expiry time
        type:
          type: string
          description: IP address type
          enum: ["ipv4", "ipv6", "unknown"]
        mac:
          type: string
          description: MAC address of the client
        iaid:
          type: string
          description: Identity Association Identifier (for DHCPv6)
        ip_address:
          type: string
          description: Assigned IP address
        prefix:
          type: integer
          description: Network prefix length
        hostname:
          type: string
          description: Client hostname
        client_id:
          type: string
          description: DHCP client identifier
      required:
        - expiry_time
        - type
        - mac
        - ip_address
        - prefix
    
    NetworkDHCPLeasesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                network_name:
                  type: string
                  description: Name of the network
                leases:
                  type: array
                  description: List of active DHCP leases
                  items:
                    $ref: '#/components/schemas/DHCPLease'
                count:
                  type: integer
                  description: Total number of active leases
              required:
                - network_name
                - leases
                - count
    
    NetworkPort:
      type: object
      description: Network port/interface attached to a virtual network
      properties:
        vm_name:
          type: string
          description: Name of the virtual machine
        vm_uuid:
          type: string
          description: UUID of the virtual machine
        vm_state:
          type: string
          description: Current state of the virtual machine
          enum: ["nostate", "running", "blocked", "paused", "shutdown", "shutoff", "crashed", "pmsuspended", "unknown"]
        interface_mac:
          type: string
          description: MAC address of the network interface
        interface_model:
          type: string
          description: Network interface model (e.g., virtio, e1000)
        interface_type:
          type: string
          description: Type of network interface
        interface_target:
          type: string
          description: Target device name (e.g., vnet0)
        ip_address:
          type: string
          description: IP address assigned to the interface (if available)
        attached_at:
          type: string
          format: date-time
          description: Time when the interface was attached
      required:
        - vm_name
        - vm_uuid
        - vm_state
        - interface_mac
        - interface_type
    
    NetworkPortsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                network_name:
                  type: string
                  description: Name of the network
                ports:
                  type: array
                  description: List of network ports/interfaces
                  items:
                    $ref: '#/components/schemas/NetworkPort'
                count:
                  type: integer
                  description: Total number of ports
              required:
                - network_name
                - ports
                - count
    
    VirtualNetworkUpdateResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                network:
                  $ref: '#/components/schemas/VirtualNetwork'
                message:
                  type: string
                  description: Success message
    PlaybooksListResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                playbooks:
                  type: array
                  items:
                    $ref: '#/components/schemas/PlaybookInfo'
                count:
                  type: integer

    PlaybookInfo:
      type: object
      properties:
        name:
          type: string
          description: Playbook filename
          example: "site.yml"
        path:
          type: string
          description: Full path to the playbook
          example: "/opt/ansible/playbooks/site.yml"
        size:
          type: integer
          description: File size in bytes
          example: 2048
        modified:
          type: string
          format: date-time
          description: Last modification time
          example: "2025-01-15T10:30:00Z"
        is_directory:
          type: boolean
          description: Whether this is a directory
          example: false

    PlaybookDetailResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                playbook:
                  $ref: '#/components/schemas/PlaybookDetail'

    PlaybookDetail:
      type: object
      properties:
        name:
          type: string
          description: Playbook filename
          example: "site.yml"
        path:
          type: string
          description: Full path to the playbook
          example: "/opt/ansible/playbooks/site.yml"
        content:
          type: string
          description: Playbook content (YAML)
          example: |
            ---
            - name: Configure web servers
              hosts: webservers
              become: yes
              tasks:
                - name: Install nginx
                  package:
                    name: nginx
                    state: present
        size:
          type: integer
          description: File size in bytes
          example: 2048
        modified:
          type: string
          format: date-time
          description: Last modification time
          example: "2025-01-15T10:30:00Z"

    PlaybookUploadRequest:
      type: object
      required:
        - name
        - content
      properties:
        name:
          type: string
          description: Name of the playbook file
          example: "deploy.yml"
        content:
          type: string
          description: Base64 encoded playbook content
          example: "LS0tCi0gbmFtZTogRGVwbG95IGFwcGxpY2F0aW9uCiAgaG9zdHM6IGFsbAogIHRhc2tzOgogICAgLSBuYW1lOiBVcGRhdGUgYXBwCiAgICAgIGNvbW1hbmQ6IC9iaW4vdXBkYXRlLnNo"
        overwrite:
          type: boolean
          description: Whether to overwrite existing playbook
          default: false
          example: true

    PlaybookValidationResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                valid:
                  type: boolean
                  description: Whether the playbook syntax is valid
                  example: true
                message:
                  type: string
                  description: Validation result message
                  example: "Playbook syntax is valid"
                errors:
                  type: array
                  items:
                    type: string
                  description: Syntax errors if validation failed
                  example: ["ERROR! 'hosts' is not a valid attribute for a Play"]
                warnings:
                  type: array
                  items:
                    type: string
                  description: Syntax warnings
                  example: ["[WARNING]: No inventory was parsed"]

    PlaybookRunRequest:
      type: object
      required:
        - playbook
      properties:
        playbook:
          type: string
          description: Name of the playbook to run
          example: "site.yml"
        inventory:
          type: string
          description: Inventory to use (name or content)
          example: "production"
        limit:
          type: string
          description: Limit execution to specific hosts/groups
          example: "webservers"
        tags:
          type: array
          items:
            type: string
          description: Run only tasks with these tags
          example: ["deploy", "config"]
        skip_tags:
          type: array
          items:
            type: string
          description: Skip tasks with these tags
          example: ["test"]
        extra_vars:
          type: object
          additionalProperties:
            type: string
          description: Extra variables to pass to playbook
          example:
            app_version: "1.2.3"
            environment: "production"
        check:
          type: boolean
          description: Run in check mode (dry run)
          default: false
          example: false
        diff:
          type: boolean
          description: Show differences
          default: false
          example: true
        verbose:
          type: integer
          description: Verbosity level (0-4)
          minimum: 0
          maximum: 4
          default: 0
          example: 2
        become:
          type: boolean
          description: Run with become (sudo)
          default: false
          example: true
        become_user:
          type: string
          description: User to become
          example: "root"
        private_key:
          type: string
          description: Path to SSH private key
          example: "/home/user/.ssh/id_rsa"
        timeout:
          type: integer
          description: Connection timeout in seconds
          default: 10
          example: 30
        forks:
          type: integer
          description: Number of parallel processes
          default: 5
          example: 10

    AdHocRequest:
      type: object
      required:
        - hosts
        - module
      properties:
        hosts:
          type: string
          description: Host pattern to run against
          example: "all"
        module:
          type: string
          description: Ansible module to run
          example: "ping"
        args:
          type: string
          description: Module arguments
          example: "data=pong"
        inventory:
          type: string
          description: Inventory to use
          example: "production"
        extra_vars:
          type: object
          additionalProperties:
            type: string
          description: Extra variables
        become:
          type: boolean
          description: Run with become (sudo)
          default: false
        verbose:
          type: integer
          description: Verbosity level
          minimum: 0
          maximum: 4
          default: 0
        forks:
          type: integer
          description: Number of parallel processes
          default: 5

    ExecutionStartResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                execution_id:
                  type: string
                  description: Unique execution identifier
                  example: "exec-a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                status:
                  type: string
                  description: Execution status
                  enum: [starting, running, success, failed]
                  example: "starting"
                type:
                  type: string
                  description: Execution type
                  enum: [playbook, adhoc]
                  example: "playbook"
                started_at:
                  type: string
                  format: date-time
                  description: Execution start time
                  example: "2025-01-15T10:30:00Z"
                stream_url:
                  type: string
                  description: WebSocket URL for streaming output
                  example: "/api/v1/ansible/executions/exec-a1b2c3d4/stream"

    ExecutionsListResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                executions:
                  type: array
                  items:
                    $ref: '#/components/schemas/ExecutionSummary'
                count:
                  type: integer
                  description: Total number of executions
                  example: 25

    ExecutionSummary:
      type: object
      properties:
        id:
          type: string
          description: Execution ID
          example: "exec-a1b2c3d4"
        type:
          type: string
          description: Execution type
          enum: [playbook, adhoc]
          example: "playbook"
        playbook:
          type: string
          description: Playbook name (if type is playbook)
          example: "site.yml"
        module:
          type: string
          description: Module name (if type is adhoc)
          example: "ping"
        status:
          type: string
          description: Execution status
          enum: [running, success, failed, cancelled]
          example: "success"
        started_at:
          type: string
          format: date-time
          example: "2025-01-15T10:30:00Z"
        finished_at:
          type: string
          format: date-time
          example: "2025-01-15T10:35:00Z"
        duration:
          type: integer
          description: Duration in seconds
          example: 300
        hosts_summary:
          type: object
          properties:
            ok:
              type: integer
              example: 10
            changed:
              type: integer
              example: 5
            unreachable:
              type: integer
              example: 0
            failed:
              type: integer
              example: 1
            skipped:
              type: integer
              example: 2
            rescued:
              type: integer
              example: 0
            ignored:
              type: integer
              example: 0

    ExecutionDetailResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                execution:
                  $ref: '#/components/schemas/ExecutionDetail'

    ExecutionDetail:
      allOf:
        - $ref: '#/components/schemas/ExecutionSummary'
        - type: object
          properties:
            command:
              type: string
              description: Full ansible command executed
              example: "ansible-playbook -i production site.yml"
            parameters:
              type: object
              description: Execution parameters
              additionalProperties: true
            output:
              type: string
              description: Full execution output
              example: "PLAY [Configure web servers] ***\n\nTASK [Gathering Facts] ***\nok: [web1]\n"
            exit_code:
              type: integer
              description: Process exit code
              example: 0
            host_results:
              type: array
              items:
                $ref: '#/components/schemas/HostResult'

    HostResult:
      type: object
      properties:
        host:
          type: string
          description: Host name
          example: "web1.example.com"
        ok:
          type: integer
          example: 10
        changed:
          type: integer
          example: 3
        unreachable:
          type: boolean
          example: false
        failed:
          type: boolean
          example: false
        skipped:
          type: integer
          example: 1
        rescued:
          type: integer
          example: 0
        ignored:
          type: integer
          example: 0

    TemplatesListResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                templates:
                  type: array
                  items:
                    $ref: '#/components/schemas/PlaybookTemplate'

    PlaybookTemplate:
      type: object
      properties:
        id:
          type: string
          description: Template identifier
          example: "nginx-setup"
        name:
          type: string
          description: Template display name
          example: "Nginx Web Server Setup"
        description:
          type: string
          description: Template description
          example: "Sets up Nginx with SSL and basic configuration"
        category:
          type: string
          description: Template category
          example: "Web Servers"
        variables:
          type: array
          items:
            $ref: '#/components/schemas/TemplateVariable'
        tags:
          type: array
          items:
            type: string
          example: ["web", "nginx", "ssl"]

    TemplateVariable:
      type: object
      properties:
        name:
          type: string
          description: Variable name
          example: "domain_name"
        description:
          type: string
          description: Variable description
          example: "The domain name for the website"
        type:
          type: string
          description: Variable type
          enum: [string, integer, boolean, list, dict]
          example: "string"
        required:
          type: boolean
          description: Whether variable is required
          example: true
        default:
          type: string
          description: Default value
          example: "example.com"
        validation:
          type: string
          description: Validation regex pattern
          example: "^[a-z0-9.-]+$"

    CreateFromTemplateRequest:
      type: object
      required:
        - template_id
        - name
      properties:
        template_id:
          type: string
          description: Template identifier
          example: "nginx-setup"
        name:
          type: string
          description: Name for the new playbook
          example: "production-nginx.yml"
        variables:
          type: object
          additionalProperties:
            type: string
          description: Template variable values
          example:
            domain_name: "mysite.com"
            ssl_enabled: "true"
            worker_processes: "4"

    GitSyncRequest:
      type: object
      required:
        - url
      properties:
        url:
          type: string
          format: uri
          description: Git repository URL
          example: "https://github.com/myorg/ansible-playbooks.git"
        branch:
          type: string
          description: Git branch to sync
          default: "main"
          example: "main"
        path:
          type: string
          description: Path within repository
          example: "playbooks/"
        auth_token:
          type: string
          description: Authentication token for private repos
          example: "ghp_xxxxxxxxxxxxxxxxxxxx"
        ssh_key:
          type: string
          description: SSH private key for authentication
        sync_as_symlink:
          type: boolean
          description: Create symlink instead of copying
          default: false
          example: false

    GalaxyInstallRequest:
      type: object
      properties:
        type:
          type: string
          enum: [role, collection]
          description: Resource type to install
          example: "collection"
        name:
          type: string
          description: Name of role/collection
          example: "community.general"
        version:
          type: string
          description: Version to install
          example: "5.0.0"
        requirements_file:
          type: string
          description: Path to requirements file
          example: "requirements.yml"
        force:
          type: boolean
          description: Force reinstall
          default: false
          example: false

    DynamicInventoryResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                inventory:
                  $ref: '#/components/schemas/AnsibleInventory'

    AnsibleInventory:
      type: object
      properties:
        _meta:
          type: object
          properties:
            hostvars:
              type: object
              additionalProperties:
                type: object
                additionalProperties:
                  type: string
          description: Host variables
        all:
          type: object
          properties:
            hosts:
              type: array
              items:
                type: string
              example: ["web1.example.com", "web2.example.com"]
            children:
              type: array
              items:
                type: string
              example: ["webservers", "databases"]
            vars:
              type: object
              additionalProperties:
                type: string
        webservers:
          type: object
          properties:
            hosts:
              type: array
              items:
                type: string
              example: ["web1.example.com", "web2.example.com"]
            vars:
              type: object
              additionalProperties:
                type: string
              example:
                http_port: "80"
                max_clients: "200"
        databases:
          type: object
          properties:
            hosts:
              type: array
              items:
                type: string
              example: ["db1.example.com"]
            vars:
              type: object
              additionalProperties:
                type: string

    SaveInventoryRequest:
      type: object
      required:
        - name
        - content
      properties:
        name:
          type: string
          description: Inventory name
          example: "production"
        content:
          type: string
          description: Inventory content (INI or YAML format)
          example: |
            [webservers]
            web1.example.com
            web2.example.com
            
            [databases]
            db1.example.com
        format:
          type: string
          enum: [ini, yaml, json]
          description: Inventory format
          default: "ini"
          example: "ini"

    SchedulesListResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                schedules:
                  type: array
                  items:
                    $ref: '#/components/schemas/Schedule'
                count:
                  type: integer

    Schedule:
      type: object
      properties:
        id:
          type: string
          description: Schedule ID
          example: "sched-123456"
        name:
          type: string
          description: Schedule name
          example: "Daily backup"
        playbook:
          type: string
          description: Playbook to run
          example: "backup.yml"
        cron:
          type: string
          description: Cron expression
          example: "0 2 * * *"
        enabled:
          type: boolean
          description: Whether schedule is enabled
          example: true
        last_run:
          type: string
          format: date-time
          description: Last execution time
          example: "2025-01-14T02:00:00Z"
        next_run:
          type: string
          format: date-time
          description: Next scheduled execution
          example: "2025-01-15T02:00:00Z"
        parameters:
          type: object
          description: Playbook parameters
          additionalProperties: true

    CreateScheduleRequest:
      type: object
      required:
        - name
        - playbook
        - cron
      properties:
        name:
          type: string
          description: Schedule name
          example: "Daily backup"
        playbook:
          type: string
          description: Playbook to run
          example: "backup.yml"
        cron:
          type: string
          description: Cron expression
          example: "0 2 * * *"
        enabled:
          type: boolean
          description: Enable schedule immediately
          default: true
          example: true
        parameters:
          $ref: '#/components/schemas/PlaybookRunRequest'
        timezone:
          type: string
          description: Timezone for schedule
          default: "UTC"
          example: "America/New_York"

    # Virtualization Response Schemas
    VirtualMachinesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                vms:
                  type: array
                  items:
                    $ref: '#/components/schemas/VM'
                count:
                  type: integer

    VMCreateResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                vm:
                  $ref: '#/components/schemas/VM'
                message:
                  type: string

    VMDetailResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                vm:
                  $ref: '#/components/schemas/VM'

    VMUpdateResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                vm:
                  $ref: '#/components/schemas/VM'
                message:
                  type: string

    StoragePoolsResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                pools:
                  type: array
                  items:
                    $ref: '#/components/schemas/StoragePool'
                count:
                  type: integer

    StoragePoolCreateResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                pool:
                  $ref: '#/components/schemas/StoragePool'
                message:
                  type: string

    StoragePoolDetailResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                pool:
                  $ref: '#/components/schemas/StoragePool'

    StorageVolumesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                volumes:
                  type: array
                  items:
                    $ref: '#/components/schemas/StorageVolume'
                count:
                  type: integer

    StorageVolumeCreateResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                volume:
                  $ref: '#/components/schemas/StorageVolume'
                message:
                  type: string

    StorageVolumeDetailResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                volume:
                  $ref: '#/components/schemas/StorageVolume'

    VirtualNetworksResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                networks:
                  type: array
                  items:
                    $ref: '#/components/schemas/VirtualNetwork'
                count:
                  type: integer

    VirtualNetworkCreateResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                network:
                  $ref: '#/components/schemas/VirtualNetwork'
                message:
                  type: string

    VirtualNetworkDetailResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                network:
                  $ref: '#/components/schemas/VirtualNetwork'

    MigrationRequest:
      type: object
      required:
        - destination_host
      properties:
        destination_host:
          type: string
          description: |
            Target host for migration. The host must be accessible via the transport
            method specified in destination_uri (SSH by default).
            
            For SSH transport, passwordless SSH access must be configured from
            source to destination host.
          example: "host2.example.com"
        destination_uri:
          type: string
          description: |
            Optional custom libvirt URI for destination. Common formats:
            
            - `qemu+ssh://host2.example.com/system` - SSH transport (default, requires SSH keys)
            - `qemu+ssh://user@host2.example.com/system` - SSH with specific user
            - `qemu+tcp://host2.example.com/system` - TCP transport (unencrypted, not recommended)
            - `qemu+tls://host2.example.com/system` - TLS transport (requires certificates)
            
            **SSH Requirements:**
            The source host must have passwordless SSH access to the destination.
            SSH public key of the source host's libvirt user (usually root) must be
            in the destination host's authorized_keys file.
            
            **Setup Example:**
            ```bash
            # On source host as root:
            ssh-keygen -t rsa -N "" -f ~/.ssh/id_rsa
            ssh-copy-id root@host2.example.com
            ```
          example: "qemu+ssh://host2.example.com/system"
        live:
          type: boolean
          description: |
            Perform live migration (VM stays running during migration).
            Requires stable network connection and compatible hosts.
          default: true
        tunneled:
          type: boolean
          description: |
            Use tunneled migration. All migration data goes through the libvirt
            connection. More secure but potentially slower.
          default: false
        compressed:
          type: boolean
          description: |
            Enable compression during migration. Reduces network bandwidth usage
            but increases CPU usage on both hosts.
          default: false
        auto_converge:
          type: boolean
          description: |
            Enable auto-convergence to speed up migration. Automatically throttles
            VM CPU usage if migration is not converging.
          default: false
        allow_unsafe:
          type: boolean
          description: |
            Allow unsafe migration operations. Use with caution as it may result
            in VM crashes or data corruption if hosts are incompatible.
          default: false
        max_bandwidth:
          type: integer
          description: |
            Maximum bandwidth in MB/s for migration (0 for unlimited).
            Useful to prevent migration from saturating network links.
          default: 0
          example: 100
        max_downtime:
          type: integer
          description: |
            Maximum allowed downtime in milliseconds during live migration.
            Lower values mean less interruption but migration may take longer.
          default: 500
          example: 500
        copy_storage:
          type: string
          description: |
            Storage migration mode:
            - `none`: No storage migration (requires shared storage)
            - `all`: Copy all disk images to destination
            - `inc`: Copy only incremental changes (for supported formats)
            
            Note: Storage migration significantly increases migration time.
          enum: [none, all, inc]
          default: none

    MigrationResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                migration_id:
                  type: string
                  description: Unique migration identifier
                  example: "mig-a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                status:
                  type: string
                  description: Current migration status
                  enum: [initiated, migrating, completed, failed, cancelled]
                  example: "initiated"
                source_host:
                  type: string
                  description: Source host name
                  example: "host1.example.com"
                dest_host:
                  type: string
                  description: Destination host name
                  example: "host2.example.com"
                started_at:
                  type: string
                  format: date-time
                  description: Migration start time
                  example: "2025-01-15T10:30:00Z"
                message:
                  type: string
                  description: Additional status message
                  example: "Migration initiated successfully"

    MigrationStatusResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                migration_id:
                  type: string
                  description: Unique migration identifier
                  example: "mig-a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                vm_name:
                  type: string
                  description: Name of the VM being migrated
                  example: "web-server-01"
                status:
                  type: string
                  description: Current migration status
                  enum: [initiating, migrating, completed, failed, cancelled]
                  example: "migrating"
                progress:
                  type: integer
                  description: Migration progress percentage (0-100)
                  minimum: 0
                  maximum: 100
                  example: 45
                source_host:
                  type: string
                  description: Source host name
                  example: "host1.example.com"
                dest_host:
                  type: string
                  description: Destination host name
                  example: "host2.example.com"
                data_processed:
                  type: integer
                  format: int64
                  description: Bytes of data processed
                  example: 1073741824
                data_remaining:
                  type: integer
                  format: int64
                  description: Bytes of data remaining
                  example: 2147483648
                mem_processed:
                  type: integer
                  format: int64
                  description: Memory bytes processed
                  example: 536870912
                mem_remaining:
                  type: integer
                  format: int64
                  description: Memory bytes remaining
                  example: 1073741824
                started_at:
                  type: string
                  format: date-time
                  description: Migration start time
                  example: "2025-01-15T10:30:00Z"
                completed_at:
                  type: string
                  format: date-time
                  description: Migration completion time (if completed)
                  example: "2025-01-15T10:35:00Z"
                error_message:
                  type: string
                  description: Error message if migration failed
                  example: "Connection to destination host lost"

    # VM Snapshot Schemas
    VMSnapshotRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Name for the snapshot
          example: "before-upgrade"
          minLength: 1
          maxLength: 255
        description:
          type: string
          description: Optional description of the snapshot
          example: "Snapshot taken before system upgrade"
          maxLength: 1024
        include_memory:
          type: boolean
          description: |
            Include memory state in the snapshot.
            - true: Full system state including RAM (VM must be running)
            - false: Disk-only snapshot (VM can be running or stopped)
          default: false
          example: true
        quiesce:
          type: boolean
          description: |
            Quiesce the VM filesystem before snapshot (requires guest agent).
            This ensures filesystem consistency by flushing buffers.
          default: false
          example: true

    VMSnapshotResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                snapshot:
                  $ref: '#/components/schemas/VMSnapshot'
                message:
                  type: string
                  example: "Snapshot created successfully"

    VMSnapshotsListResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                snapshots:
                  type: array
                  items:
                    $ref: '#/components/schemas/VMSnapshot'
                count:
                  type: integer
                  example: 3

    VMSnapshotDetailResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                snapshot:
                  $ref: '#/components/schemas/VMSnapshotDetail'

    VMSnapshotRevertResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                vm_name:
                  type: string
                  example: "web-server-01"
                snapshot_name:
                  type: string
                  example: "before-upgrade"
                reverted_at:
                  type: string
                  format: date-time
                  example: "2025-01-15T11:00:00Z"
                message:
                  type: string
                  example: "VM successfully reverted to snapshot 'before-upgrade'"

    VMSnapshotCapabilitiesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                capabilities:
                  $ref: '#/components/schemas/VMSnapshotCapabilities'

    VMSnapshotCapabilities:
      type: object
      properties:
        supports_snapshots:
          type: boolean
          description: Whether this VM supports snapshots at all
          example: true
        supports_internal:
          type: boolean
          description: Whether internal snapshots are supported (requires all disks to be qcow2)
          example: false
        supports_external:
          type: boolean
          description: Whether external snapshots are supported (always true if snapshots are supported)
          example: true
        supports_memory:
          type: boolean
          description: Whether memory snapshots are supported (requires qcow2 for all disks)
          example: false
        disk_formats:
          type: array
          items:
            $ref: '#/components/schemas/DiskFormatInfo'
          description: Information about each disk's format
        warnings:
          type: array
          items:
            type: string
          description: Any warnings about snapshot capabilities
          example:
            - "Disk 'vdb' uses raw format, only external snapshots are supported"
            - "Mixed disk formats detected (qcow2, raw)"
        recommendations:
          type: array
          items:
            type: string
          description: Recommendations for optimal snapshot support
          example:
            - "Convert all disks to qcow2 format for full snapshot capabilities"
            - "Use external snapshots for this VM configuration"

    DiskFormatInfo:
      type: object
      properties:
        name:
          type: string
          description: Disk device name
          example: "vda"
        path:
          type: string
          description: Path to the disk image
          example: "/var/lib/libvirt/images/vm1-vda.qcow2"
        format:
          type: string
          description: Disk image format
          enum: [qcow2, raw, vmdk, vdi, vpc, qed]
          example: "qcow2"
        supports_internal:
          type: boolean
          description: Whether this disk supports internal snapshots
          example: true
        size_bytes:
          type: integer
          format: int64
          description: Disk size in bytes
          example: 10737418240

    # VM Backup Schemas
    VMBackup:
      type: object
      properties:
        id:
          type: string
          description: Unique backup identifier
          example: "backup-123e4567-e89b-12d3-a456-426614174000"
        backup_id:
          type: string
          description: Backup ID
          example: "backup-123456"
        vm_uuid:
          type: string
          description: UUID of the VM
          example: "550e8400-e29b-41d4-a716-446655440000"
        vm_name:
          type: string
          description: Name of the VM
          example: "web-server-01"
        backup_type:
          type: string
          description: Type of backup
          enum: [full, incremental, differential]
          example: "full"
        status:
          type: string
          description: Backup status
          enum: [running, completed, failed, deleted]
          example: "completed"
        source_path:
          type: string
          description: Source path of the backup
          example: "/var/lib/libvirt/images/web-server-01.qcow2"
        destination_path:
          type: string
          description: Destination path of the backup
          example: "/backup/vms/web-server-01/"
        size_bytes:
          type: integer
          format: int64
          description: Size of the backup in bytes
          example: 10737418240
        compressed:
          type: boolean
          description: Whether the backup is compressed
          example: true
        compression:
          type: string
          description: Compression type
          enum: [none, gzip, bzip2, xz, zstd]
          example: "gzip"
        encryption:
          type: string
          description: Encryption type
          enum: [none, AES-256, AES-128]
          example: "AES-256"
        parent_backup_id:
          type: string
          description: Parent backup ID for incremental backups
          example: "backup-123455"
        started_at:
          type: string
          format: date-time
          description: When the backup started
          example: "2025-01-15T10:00:00Z"
        completed_at:
          type: string
          format: date-time
          description: When the backup completed
          example: "2025-01-15T10:30:00Z"
        retention_days:
          type: integer
          description: Number of days to retain the backup
          example: 30
        include_memory:
          type: boolean
          description: Whether memory state is included
          example: false
        error_message:
          type: string
          description: Error message if backup failed
          example: "Failed to connect to storage"

    VMBackupRequest:
      type: object
      required:
        - destination_path
      properties:
        backup_type:
          type: string
          description: Type of backup
          enum: [full, incremental, differential]
          default: full
          example: "full"
        destination_path:
          type: string
          description: Where to store the backup
          example: "/backup/vms/"
        compression:
          type: string
          description: Compression type
          enum: [none, gzip, bzip2, xz, zstd]
          default: none
          example: "gzip"
        encryption:
          type: string
          description: Encryption type
          enum: [none, AES-256, AES-128]
          default: none
          example: "AES-256"
        encryption_key:
          type: string
          description: Encryption key (required if encryption is enabled)
          example: "my-secret-key-123"
        include_memory:
          type: boolean
          description: Include memory state in backup
          default: false
          example: true
        retention_days:
          type: integer
          description: Number of days to retain the backup
          default: 30
          example: 90
        description:
          type: string
          description: Optional description of the backup
          example: "Weekly backup before maintenance"

    VMRestoreRequest:
      type: object
      required:
        - backup_id
      properties:
        backup_id:
          type: string
          description: ID of the backup to restore from
          example: "backup-123456"
        new_vm_name:
          type: string
          description: Name for the restored VM (optional, uses original name if not specified)
          example: "web-server-01-restored"
        overwrite:
          type: boolean
          description: Whether to overwrite existing VM with same name
          default: false
          example: false
        decryption_key:
          type: string
          description: Decryption key (required if backup is encrypted)
          example: "my-secret-key-123"
        restore_memory:
          type: boolean
          description: Whether to restore memory state (if available)
          default: true
          example: true
        storage_pool:
          type: string
          description: Storage pool to restore VM disks to
          example: "default"

    VMResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                vm:
                  $ref: '#/components/schemas/VM'

    # VM Template Schemas
    VMTemplate:
      type: object
      properties:
        id:
          type: integer
          description: Template unique identifier
          example: 1
        name:
          type: string
          description: Template name (unique)
          example: "ubuntu-22.04"
        display_name:
          type: string
          description: Display name for the template
          example: "Ubuntu 22.04 LTS Server"
        description:
          type: string
          description: Template description
          example: "Ubuntu 22.04 LTS Server optimized for cloud deployments"
        os_type:
          type: string
          description: Operating system type
          enum: [linux, windows, bsd, other]
          example: "linux"
        os_variant:
          type: string
          description: OS variant identifier for libvirt
          example: "ubuntu22.04"
        min_memory:
          type: integer
          description: Minimum memory in MB
          example: 512
        recommended_memory:
          type: integer
          description: Recommended memory in MB
          example: 2048
        min_vcpus:
          type: integer
          description: Minimum vCPUs
          example: 1
        recommended_vcpus:
          type: integer
          description: Recommended vCPUs
          example: 2
        min_disk:
          type: integer
          description: Minimum disk size in GB
          example: 10
        recommended_disk:
          type: integer
          description: Recommended disk size in GB
          example: 20
        disk_bus:
          type: string
          description: Recommended disk bus type
          enum: [virtio, ide, scsi, sata]
          default: "virtio"
          example: "virtio"
        network_model:
          type: string
          description: Recommended network model
          enum: [virtio, e1000, rtl8139]
          default: "virtio"
          example: "virtio"
        features:
          type: object
          description: Required or recommended features
          properties:
            uefi:
              type: boolean
              description: Use UEFI boot
              example: true
            secure_boot:
              type: boolean
              description: Enable secure boot
              example: false
            tpm:
              type: boolean
              description: Add TPM device
              example: false
            virtio_drivers:
              type: boolean
              description: Requires VirtIO drivers
              example: true
        cloud_init_support:
          type: boolean
          description: Supports cloud-init
          example: true
        default_user:
          type: string
          description: Default username for the OS
          example: "ubuntu"
        icon:
          type: string
          description: Icon identifier or URL
          example: "ubuntu"
        tags:
          type: array
          items:
            type: string
          description: Template tags for categorization
          example: ["server", "lts", "cloud"]
        is_active:
          type: boolean
          description: Whether template is active
          example: true
        created_at:
          type: string
          format: date-time
          description: When the template was created
          example: "2025-01-15T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: When the template was last updated
          example: "2025-01-15T10:00:00Z"

    VMTemplateCreateRequest:
      type: object
      required:
        - name
        - display_name
        - os_type
        - os_variant
      properties:
        name:
          type: string
          description: Template name (must be unique)
          example: "ubuntu-22.04"
          pattern: "^[a-z0-9][a-z0-9-_.]*$"
          minLength: 1
          maxLength: 64
        display_name:
          type: string
          description: Display name for the template
          example: "Ubuntu 22.04 LTS Server"
          minLength: 1
          maxLength: 255
        description:
          type: string
          description: Template description
          example: "Ubuntu 22.04 LTS Server optimized for cloud deployments"
          maxLength: 1024
        os_type:
          type: string
          description: Operating system type
          enum: [linux, windows, bsd, other]
          example: "linux"
        os_variant:
          type: string
          description: OS variant identifier for libvirt
          example: "ubuntu22.04"
        min_memory:
          type: integer
          description: Minimum memory in MB
          minimum: 128
          example: 512
        recommended_memory:
          type: integer
          description: Recommended memory in MB
          minimum: 256
          example: 2048
        min_vcpus:
          type: integer
          description: Minimum vCPUs
          minimum: 1
          maximum: 256
          example: 1
        recommended_vcpus:
          type: integer
          description: Recommended vCPUs
          minimum: 1
          maximum: 256
          example: 2
        min_disk:
          type: integer
          description: Minimum disk size in GB
          minimum: 1
          example: 10
        recommended_disk:
          type: integer
          description: Recommended disk size in GB
          minimum: 1
          example: 20
        disk_bus:
          type: string
          description: Recommended disk bus type
          enum: [virtio, ide, scsi, sata]
          default: "virtio"
          example: "virtio"
        network_model:
          type: string
          description: Recommended network model
          enum: [virtio, e1000, rtl8139]
          default: "virtio"
          example: "virtio"
        features:
          type: object
          description: Required or recommended features
          properties:
            uefi:
              type: boolean
              description: Use UEFI boot
              default: false
              example: true
            secure_boot:
              type: boolean
              description: Enable secure boot
              default: false
              example: false
            tpm:
              type: boolean
              description: Add TPM device
              default: false
              example: false
            virtio_drivers:
              type: boolean
              description: Requires VirtIO drivers
              default: true
              example: true
        cloud_init_support:
          type: boolean
          description: Supports cloud-init
          default: false
          example: true
        default_user:
          type: string
          description: Default username for the OS
          example: "ubuntu"
        icon:
          type: string
          description: Icon identifier or URL
          example: "ubuntu"
        tags:
          type: array
          items:
            type: string
          description: Template tags for categorization
          example: ["server", "lts", "cloud"]
        is_active:
          type: boolean
          description: Whether template is active
          default: true
          example: true

    VMTemplateUpdateRequest:
      type: object
      properties:
        display_name:
          type: string
          description: Display name for the template
          example: "Ubuntu 22.04 LTS Server Updated"
          minLength: 1
          maxLength: 255
        description:
          type: string
          description: Template description
          example: "Updated Ubuntu 22.04 LTS Server template"
          maxLength: 1024
        min_memory:
          type: integer
          description: Minimum memory in MB
          minimum: 128
          example: 512
        recommended_memory:
          type: integer
          description: Recommended memory in MB
          minimum: 256
          example: 4096
        min_vcpus:
          type: integer
          description: Minimum vCPUs
          minimum: 1
          maximum: 256
          example: 1
        recommended_vcpus:
          type: integer
          description: Recommended vCPUs
          minimum: 1
          maximum: 256
          example: 4
        min_disk:
          type: integer
          description: Minimum disk size in GB
          minimum: 1
          example: 10
        recommended_disk:
          type: integer
          description: Recommended disk size in GB
          minimum: 1
          example: 30
        disk_bus:
          type: string
          description: Recommended disk bus type
          enum: [virtio, ide, scsi, sata]
          example: "virtio"
        network_model:
          type: string
          description: Recommended network model
          enum: [virtio, e1000, rtl8139]
          example: "virtio"
        features:
          type: object
          description: Required or recommended features
          properties:
            uefi:
              type: boolean
              description: Use UEFI boot
              example: true
            secure_boot:
              type: boolean
              description: Enable secure boot
              example: true
            tpm:
              type: boolean
              description: Add TPM device
              example: true
            virtio_drivers:
              type: boolean
              description: Requires VirtIO drivers
              example: true
        cloud_init_support:
          type: boolean
          description: Supports cloud-init
          example: true
        default_user:
          type: string
          description: Default username for the OS
          example: "ubuntu"
        icon:
          type: string
          description: Icon identifier or URL
          example: "ubuntu-new"
        tags:
          type: array
          items:
            type: string
          description: Template tags for categorization
          example: ["server", "lts", "cloud", "production"]
        is_active:
          type: boolean
          description: Whether template is active
          example: true

    # PCI Passthrough Schemas
    PCIDevicesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                devices:
                  type: array
                  items:
                    $ref: '#/components/schemas/PCIDevice'
                count:
                  type: integer
                  description: Total number of PCI devices
                  example: 5

    PCIDevice:
      type: object
      properties:
        device_id:
          type: string
          description: PCI device identifier
          example: "pci_0000_01_00_0"
        vendor_id:
          type: string
          description: Vendor ID
          example: "10de"
        product_id:
          type: string
          description: Product ID
          example: "1e84"
        vendor_name:
          type: string
          description: Vendor name
          example: "NVIDIA Corporation"
        product_name:
          type: string
          description: Product name
          example: "GeForce RTX 2070 SUPER"
        device_type:
          type: string
          description: Device type
          enum: [gpu, network, storage, usb, other]
          example: "gpu"
        pci_address:
          type: string
          description: PCI address
          example: "0000:01:00.0"
        iommu_group:
          type: integer
          description: IOMMU group number
          example: 14
        driver:
          type: string
          description: Current driver
          example: "vfio-pci"
        is_available:
          type: boolean
          description: Whether device is available for passthrough
          example: true
        assigned_to_vm:
          type: string
          description: VM UUID if assigned
          example: null
        capabilities:
          type: object
          description: Device capabilities
          additionalProperties:
            type: string
        last_seen:
          type: string
          format: date-time
          description: Last time device was detected
          example: "2025-01-15T10:00:00Z"

    PCIPassthroughRequest:
      type: object
      required:
        - device_id
      properties:
        device_id:
          type: string
          description: PCI device identifier to attach
          example: "pci_0000_01_00_0"
        vfio_options:
          type: object
          description: VFIO driver options
          properties:
            display:
              type: string
              description: Display mode for GPU passthrough
              enum: [on, off, auto]
              default: auto
              example: "on"
            x_vga:
              type: boolean
              description: Enable VGA mode for primary GPU
              default: false
              example: true
            romfile:
              type: string
              description: Path to GPU ROM file
              example: "/usr/share/vgabios/gpu.rom"
        managed:
          type: boolean
          description: Let libvirt manage device binding
          default: true
          example: true

    PCIAttachResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                vm_id:
                  type: string
                  description: VM identifier
                  example: "web-server-01"
                device_id:
                  type: string
                  description: Attached PCI device ID
                  example: "pci_0000_01_00_0"
                pci_address:
                  type: string
                  description: PCI address of the device
                  example: "0000:01:00.0"
                message:
                  type: string
                  description: Success message
                  example: "PCI device attached successfully"

    PCIDetachResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                vm_id:
                  type: string
                  description: VM identifier
                  example: "web-server-01"
                device_id:
                  type: string
                  description: Detached PCI device ID
                  example: "pci_0000_01_00_0"
                message:
                  type: string
                  description: Success message
                  example: "PCI device detached successfully"

    # Hotplug Schemas
    HotplugRequest:
      type: object
      required:
        - resource_type
        - action
        - configuration
      properties:
        resource_type:
          type: string
          description: Type of resource to hotplug
          enum: [cpu, memory, disk, network, usb]
          example: "cpu"
        action:
          type: string
          description: Action to perform
          enum: [add, remove]
          example: "add"
        configuration:
          oneOf:
            - $ref: '#/components/schemas/HotplugCPUConfig'
            - $ref: '#/components/schemas/HotplugMemoryConfig'
            - $ref: '#/components/schemas/HotplugDiskConfig'
            - $ref: '#/components/schemas/HotplugNetworkConfig'
            - $ref: '#/components/schemas/HotplugUSBConfig'
          description: Resource-specific configuration

    HotplugCPUConfig:
      type: object
      required:
        - vcpus
      properties:
        vcpus:
          type: integer
          description: Number of vCPUs to set (add operation only)
          minimum: 1
          maximum: 256
          example: 4

    HotplugMemoryConfig:
      type: object
      required:
        - memory
      properties:
        memory:
          type: integer
          description: Memory in MB to set (add operation only)
          minimum: 256
          example: 4096

    HotplugDiskConfig:
      type: object
      required:
        - source
      properties:
        source:
          type: string
          description: Path to disk image or device
          example: "/var/lib/libvirt/images/additional-disk.qcow2"
        target:
          type: string
          description: Target device name (e.g., vdb, vdc)
          example: "vdb"
        bus:
          type: string
          description: Bus type
          enum: [virtio, scsi, ide, sata]
          default: virtio
          example: "virtio"
        readonly:
          type: boolean
          description: Mount as read-only
          default: false
          example: false

    HotplugNetworkConfig:
      type: object
      required:
        - source
        - type
      properties:
        type:
          type: string
          description: Network type
          enum: [bridge, network, direct]
          example: "network"
        source:
          type: string
          description: Network source (bridge name, network name, or interface)
          example: "default"
        model:
          type: string
          description: Network device model
          enum: [virtio, e1000, rtl8139]
          default: virtio
          example: "virtio"
        mac:
          type: string
          description: MAC address (auto-generated if not specified)
          example: "52:54:00:12:34:56"

    HotplugUSBConfig:
      type: object
      required:
        - vendor_id
        - product_id
      properties:
        vendor_id:
          type: string
          description: USB vendor ID
          example: "0x1234"
        product_id:
          type: string
          description: USB product ID
          example: "0x5678"
        bus:
          type: integer
          description: USB bus number
          example: 1
        device:
          type: integer
          description: USB device number
          example: 2

    HotplugResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                vm_id:
                  type: string
                  description: VM identifier
                  example: "web-server-01"
                resource_type:
                  type: string
                  description: Type of resource that was hotplugged
                  example: "cpu"
                action:
                  type: string
                  description: Action that was performed
                  example: "add"
                message:
                  type: string
                  description: Success message
                  example: "Successfully added 2 vCPUs to VM"
                details:
                  type: object
                  description: Additional details about the operation
                  additionalProperties:
                    type: string

    VMSnapshot:
      type: object
      properties:
        id:
          type: string
          description: Unique snapshot identifier
          example: "snap-123e4567-e89b-12d3-a456-426614174000"
        name:
          type: string
          description: Snapshot name
          example: "before-upgrade"
        description:
          type: string
          description: Snapshot description
          example: "Snapshot taken before system upgrade"
        vm_name:
          type: string
          description: Name of the VM this snapshot belongs to
          example: "web-server-01"
        vm_uuid:
          type: string
          description: UUID of the VM
          example: "550e8400-e29b-41d4-a716-446655440000"
        state:
          type: string
          description: Snapshot state
          enum: [active, inactive, creating, deleting, error]
          example: "active"
        type:
          type: string
          description: Snapshot type
          enum: [disk-only, memory-included]
          example: "memory-included"
        parent:
          type: string
          description: Parent snapshot name (if part of a snapshot tree)
          example: "initial-snapshot"
        created_at:
          type: string
          format: date-time
          description: When the snapshot was created
          example: "2025-01-15T10:00:00Z"
        size_bytes:
          type: integer
          format: int64
          description: Total size of the snapshot in bytes
          example: 5368709120
        is_current:
          type: boolean
          description: Whether this is the current snapshot
          example: false

    VMSnapshotDetail:
      allOf:
        - $ref: '#/components/schemas/VMSnapshot'
        - type: object
          properties:
            disks:
              type: array
              description: Disk snapshots included in this VM snapshot
              items:
                $ref: '#/components/schemas/DiskSnapshot'
            memory_state:
              type: object
              description: Memory state information (if included)
              properties:
                size_bytes:
                  type: integer
                  format: int64
                  description: Size of memory snapshot
                  example: 2147483648
                file_path:
                  type: string
                  description: Path to memory state file
                  example: "/var/lib/libvirt/qemu/save/web-server-01.before-upgrade.mem"
            metadata:
              type: object
              description: Additional metadata
              additionalProperties:
                type: string
            children:
              type: array
              description: Child snapshots (if any)
              items:
                type: string
              example: ["after-upgrade", "test-config"]

    DiskSnapshot:
      type: object
      properties:
        disk_name:
          type: string
          description: Name of the disk
          example: "vda"
        snapshot_name:
          type: string
          description: Snapshot name for this disk
          example: "vda.before-upgrade"
        size_bytes:
          type: integer
          format: int64
          description: Size of the disk snapshot
          example: 10737418240
        type:
          type: string
          description: Snapshot type
          enum: [internal, external]
          example: "internal"
        file_path:
          type: string
          description: Path to snapshot file (for external snapshots)
          example: "/var/lib/libvirt/images/web-server-01.vda.before-upgrade.qcow2"

    # Enhanced VM Creation Schemas
    VMCreateRequestEnhanced:
      type: object
      required:
        - name
        - memory
        - vcpus
      properties:
        name:
          type: string
          description: Name of the virtual machine
          example: "web-server-01"
        memory:
          type: integer
          description: Memory size in MB
          minimum: 256
          example: 4096
        vcpus:
          type: integer
          description: Number of virtual CPUs
          minimum: 1
          maximum: 256
          example: 2
        disks:
          type: array
          description: Disk configurations
          items:
            $ref: '#/components/schemas/DiskCreateConfig'
        iso_path:
          type: string
          description: ISO image path, name, or ID
          example: "ubuntu-22.04.iso"
        storage_pool:
          type: string
          description: Storage pool name
          default: "default"
          example: "default"
        networks:
          type: array
          description: Network configurations
          items:
            $ref: '#/components/schemas/NetworkCreateConfig'
        graphics:
          type: array
          description: Graphics device configurations
          items:
            $ref: '#/components/schemas/GraphicsConfig'
        cloud_init:
          $ref: '#/components/schemas/CloudInit'
        autostart:
          type: boolean
          description: Start VM automatically on host boot
          default: false
          example: true
        template:
          type: string
          description: Template name to base VM on
          example: "ubuntu-server-template"
        custom_xml:
          type: string
          description: Custom libvirt XML snippet to merge
        metadata:
          type: object
          description: Custom metadata key-value pairs
          additionalProperties:
            type: string

    DiskCreateConfig:
      type: object
      required:
        - action
      properties:
        action:
          type: string
          description: Disk action type
          enum: [create, existing, clone]
          example: "create"
        size:
          type: integer
          description: Disk size in GB (for create action)
          minimum: 1
          example: 20
        path:
          type: string
          description: Path to existing disk image (for existing action)
          example: "/var/lib/libvirt/images/disk.qcow2"
        source_path:
          type: string
          description: Source disk path to clone from (for clone action)
          example: "/var/lib/libvirt/images/template.qcow2"
        format:
          type: string
          description: Disk format
          enum: [qcow2, raw, vmdk, vdi]
          default: "qcow2"
          example: "qcow2"
        bus:
          type: string
          description: Disk bus type
          enum: [virtio, ide, scsi, sata]
          default: "virtio"
          example: "virtio"
        cache:
          type: string
          description: Cache mode
          enum: [none, writethrough, writeback, directsync, unsafe]
          default: "none"
          example: "writeback"
        target:
          type: string
          description: Target device name (e.g., vda, sda)
          example: "vda"

    NetworkCreateConfig:
      type: object
      required:
        - type
      properties:
        type:
          type: string
          description: Network type
          enum: [network, bridge, direct, user]
          example: "network"
        source:
          type: string
          description: Network source (network name, bridge name, or interface)
          example: "default"
        model:
          type: string
          description: Network device model
          enum: [virtio, e1000, rtl8139]
          default: "virtio"
          example: "virtio"
        mac:
          type: string
          description: MAC address (auto-generated if not specified)
          pattern: "^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$"
          example: "52:54:00:12:34:56"

    GraphicsConfig:
      type: object
      required:
        - type
      properties:
        type:
          type: string
          description: Graphics type
          enum: [vnc, spice, none]
          example: "vnc"
        port:
          type: integer
          description: Port number (-1 for auto-assign)
          default: -1
          example: 5900
        listen:
          type: string
          description: Listen address
          default: "127.0.0.1"
          example: "0.0.0.0"
        password:
          type: string
          description: Access password
          example: "secret123"
        autoport:
          type: boolean
          description: Automatically assign port
          default: true
          example: true

    ISOImage:
      type: object
      properties:
        id:
          type: string
          description: ISO unique identifier
          example: "iso-123e4567-e89b-12d3-a456-426614174000"
        name:
          type: string
          description: ISO name
          example: "ubuntu-22.04-live-server-amd64.iso"
        path:
          type: string
          description: Full path to ISO file
          example: "/var/lib/libvirt/images/iso/ubuntu-22.04-live-server-amd64.iso"
        size:
          type: integer
          format: int64
          description: File size in bytes
          example: 1474560000
        checksum:
          type: string
          description: SHA256 checksum
          example: "5e38b55d57d94ff029719342357325ed3bda38fa80054f9330dc789cd2d43931"
        os_type:
          type: string
          description: Operating system type
          example: "linux"
        os_variant:
          type: string
          description: Operating system variant
          example: "ubuntu22.04"
        description:
          type: string
          description: ISO description
          example: "Ubuntu 22.04 LTS Server Installation Media"
        created_at:
          type: string
          format: date-time
          description: When the ISO was added
          example: "2025-01-15T10:00:00Z"
        last_used:
          type: string
          format: date-time
          description: Last time the ISO was used
          example: "2025-01-15T14:30:00Z"
        source:
          type: string
          description: Source of the ISO
          enum: [uploaded, downloaded, system]
          example: "uploaded"
        metadata:
          type: object
          description: Additional metadata
          additionalProperties:
            type: string

    ISOImagesResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                isos:
                  type: array
                  items:
                    $ref: '#/components/schemas/ISOImage'

    ISOUploadResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                iso:
                  $ref: '#/components/schemas/ISOImage'

    ISOUploadSessionResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                upload_id:
                  type: string
                  description: Unique upload session identifier
                  example: "550e8400-e29b-41d4-a716-446655440000"
                upload_url:
                  type: string
                  description: URL for uploading chunks
                  example: "/api/v1/virtualmachines/isos/upload/550e8400-e29b-41d4-a716-446655440000"
                expires_at:
                  type: string
                  format: date-time
                  description: When the upload session expires
                  example: "2025-08-06T15:38:32Z"
                total_size:
                  type: integer
                  format: int64
                  description: Total file size in bytes
                  example: 1474560000
                uploaded_size:
                  type: integer
                  format: int64
                  description: Bytes uploaded so far
                  example: 0

    ISOUploadSessionsListResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                uploads:
                  type: array
                  items:
                    $ref: '#/components/schemas/ISOUploadSession'
                count:
                  type: integer
                  description: Total number of active upload sessions
                  example: 3

    ISOUploadSession:
      type: object
      properties:
        upload_id:
          type: string
          description: Unique upload session identifier
          example: "550e8400-e29b-41d4-a716-446655440000"
        filename:
          type: string
          description: Name of the ISO file being uploaded
          example: "ubuntu-22.04-server-amd64.iso"
        total_size:
          type: integer
          format: int64
          description: Total file size in bytes
          example: 1474560000
        uploaded_size:
          type: integer
          format: int64
          description: Bytes uploaded so far
          example: 737280000
        progress:
          type: number
          format: float
          description: Upload progress percentage
          minimum: 0
          maximum: 100
          example: 50.0
        status:
          type: string
          description: Upload session status
          enum: [created, uploading, completed, failed, expired]
          example: "uploading"
        created_at:
          type: string
          format: date-time
          description: When the upload session was created
          example: "2025-01-15T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Last update time
          example: "2025-01-15T10:15:00Z"
        expires_at:
          type: string
          format: date-time
          description: When the upload session expires
          example: "2025-01-16T10:00:00Z"

    ISOUploadStatusResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                upload:
                  $ref: '#/components/schemas/ISOUploadStatus'

    ISOUploadStatus:
      type: object
      properties:
        upload_id:
          type: string
          description: Unique upload session identifier
          example: "550e8400-e29b-41d4-a716-446655440000"
        filename:
          type: string
          description: Name of the ISO file
          example: "ubuntu-22.04-server-amd64.iso"
        total_size:
          type: integer
          format: int64
          description: Total file size in bytes
          example: 1474560000
        uploaded_size:
          type: integer
          format: int64
          description: Bytes uploaded so far
          example: 1474560000
        progress:
          type: number
          format: float
          description: Upload progress percentage
          minimum: 0
          maximum: 100
          example: 100.0
        status:
          type: string
          description: Upload session status
          enum: [created, uploading, completed, failed, expired, cancelled]
          example: "completed"
        chunk_size:
          type: integer
          description: Chunk size being used
          example: 10485760
        created_at:
          type: string
          format: date-time
          description: When the upload session was created
          example: "2025-01-15T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Last update time
          example: "2025-01-15T10:30:00Z"
        completed_at:
          type: string
          format: date-time
          description: When the upload completed (if applicable)
          example: "2025-01-15T10:30:00Z"
        expires_at:
          type: string
          format: date-time
          description: When the upload session expires
          example: "2025-01-16T10:00:00Z"
        metadata:
          type: object
          description: Additional metadata from upload
          additionalProperties:
            type: string
          example:
            os_type: "linux"
            os_variant: "ubuntu22.04"
            description: "Ubuntu 22.04 LTS Server"

    ISOCompleteUploadRequest:
      type: object
      properties:
        name:
          type: string
          description: Optional custom name for the ISO
          example: "ubuntu-22.04-custom.iso"
        description:
          type: string
          description: Optional description for the ISO
          example: "Ubuntu 22.04 LTS Server with custom packages"
        os_type:
          type: string
          description: Operating system type
          example: "linux"
        os_variant:
          type: string
          description: Operating system variant
          example: "ubuntu22.04"
        metadata:
          type: object
          description: Additional metadata to store with the ISO
          additionalProperties:
            type: string

    ISOCompleteUploadResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                iso:
                  $ref: '#/components/schemas/ISOImage'
                upload_id:
                  type: string
                  description: Completed upload session ID
                  example: "550e8400-e29b-41d4-a716-446655440000"
                message:
                  type: string
                  description: Success message
                  example: "ISO upload completed and registered successfully"

    ConsoleInfo:
      type: object
      description: VM console connection information
      required:
        - type
        - host
        - port
        - token
        - ws_path
        - expires_at
      properties:
        type:
          type: string
          enum: [vnc, spice]
          description: Console protocol type
        host:
          type: string
          description: Console server host address
        port:
          type: integer
          description: Console server port
        password:
          type: string
          description: Console password (masked for security)
        token:
          type: string
          description: Secure access token for WebSocket connection
        ws_path:
          type: string
          description: WebSocket endpoint path
        expires_at:
          type: string
          format: date-time
          description: Token expiration time
        tls_enabled:
          type: boolean
          description: Whether TLS is enabled for console connection
        tls_port:
          type: integer
          description: TLS port if TLS is enabled

    ConsoleError:
      type: object
      description: Console-specific error response
      required:
        - code
        - error
      properties:
        type:
          type: string
          enum: [error]
          default: error
        code:
          type: string
          enum:
            - INVALID_TOKEN
            - TOKEN_EXPIRED
            - TOKEN_ALREADY_USED
            - VM_NOT_FOUND
            - NO_CONSOLE_AVAILABLE
            - CONNECTION_FAILED
            - MAX_CONNECTIONS_REACHED
            - UNAUTHORIZED
            - INTERNAL_ERROR
          description: Error code for console operations
        error:
          type: string
          description: Human-readable error message

    ConsoleConfig:
      type: object
      description: Console proxy configuration
      properties:
        max_connections_per_vm:
          type: integer
          description: Maximum concurrent connections per VM
          default: 5
        max_total_connections:
          type: integer
          description: Maximum total concurrent connections
          default: 100
        token_ttl:
          type: string
          description: Token expiration time (e.g., "5m")
          default: "5m"
        connection_timeout:
          type: string
          description: Connection establishment timeout
          default: "30s"
        idle_timeout:
          type: string
          description: Idle connection timeout
          default: "10m"
        allowed_hosts:
          type: array
          items:
            type: string
          description: List of allowed console server hosts
          default: ["localhost", "127.0.0.1", "::1"]
        enable_tls:
          type: boolean
          description: Enable TLS for console connections
          default: false
        buffer_size:
          type: integer
          description: Buffer size in KB for data transfer
          default: 32
        cleanup_interval:
          type: string
          description: Interval for cleaning up expired tokens and connections
          default: "1m"

    ConsoleStats:
      type: object
      description: Console connection statistics
      properties:
        total_connections:
          type: integer
          description: Total number of active connections
        total_tokens:
          type: integer
          description: Total number of active tokens
        connections_per_vm:
          type: object
          additionalProperties:
            type: integer
          description: Number of connections per VM
        connections:
          type: array
          items:
            $ref: '#/components/schemas/ConsoleConnection'

    ConsoleConnection:
      type: object
      description: Active console connection details
      properties:
        id:
          type: string
          description: Connection ID
        vm_name:
          type: string
          description: VM name
        vm_uuid:
          type: string
          description: VM UUID
        type:
          type: string
          enum: [vnc, spice]
          description: Console type
        established:
          type: string
          format: date-time
          description: Connection establishment time
        last_activity:
          type: string
          format: date-time
          description: Last activity timestamp
        bytes_sent:
          type: integer
          format: int64
          description: Bytes sent to client
        bytes_received:
          type: integer
          format: int64
          description: Bytes received from client

    # Updated schemas for VM creation with new structure
    VMCreateRequestEnhancedV2:
      type: object
      required:
        - name
        - memory
        - vcpus
        - storage
      properties:
        name:
          type: string
          description: Name of the virtual machine
          example: "web-server-01"
        memory:
          type: integer
          description: Memory size in MB
          minimum: 256
          example: 4096
        vcpus:
          type: integer
          description: Number of virtual CPUs
          minimum: 1
          maximum: 256
          example: 2
        storage:
          $ref: '#/components/schemas/StorageConfig'
        os_type:
          type: string
          description: Operating system type
          example: "linux"
        os_variant:
          type: string
          description: Operating system variant
          example: "ubuntu20.04"
        architecture:
          type: string
          description: System architecture
          default: "x86_64"
          example: "x86_64"
        uefi:
          type: boolean
          description: Use UEFI boot
          default: false
        secure_boot:
          type: boolean
          description: Enable secure boot
          default: false
        tpm:
          type: boolean
          description: Add TPM device
          default: false
        networks:
          type: array
          description: Network configurations
          items:
            $ref: '#/components/schemas/NetworkCreateConfig'
        graphics:
          type: array
          description: Graphics device configurations
          items:
            $ref: '#/components/schemas/EnhancedGraphicsConfig'
        pci_devices:
          type: array
          description: PCI devices for passthrough
          items:
            $ref: '#/components/schemas/PCIDeviceConfig'
        cloud_init:
          $ref: '#/components/schemas/CloudInit'
        template:
          type: string
          description: Template name to base VM on
          example: "ubuntu-server-template"
        autostart:
          type: boolean
          description: Start VM automatically on host boot
          default: false
        custom_xml:
          type: string
          description: Custom libvirt XML snippet to merge
        metadata:
          type: object
          description: Custom metadata key-value pairs
          additionalProperties:
            type: string

    StorageConfig:
      type: object
      required:
        - default_pool
        - disks
      properties:
        default_pool:
          type: string
          description: Default storage pool for relative paths
          example: "default"
        boot_iso:
          type: string
          description: Optional boot ISO path or name
          example: "ubuntu-22.04.iso"
        disks:
          type: array
          description: Array of disk configurations
          minItems: 1
          items:
            $ref: '#/components/schemas/DiskCreateConfigV2'

    DiskCreateConfigV2:
      type: object
      required:
        - action
      properties:
        action:
          type: string
          description: Disk action type
          enum: [create, attach, clone]
          example: "create"
        size:
          type: integer
          description: Disk size in GB (required for create action)
          minimum: 1
          example: 20
        format:
          type: string
          description: Disk format
          enum: [qcow2, raw, vmdk, vdi]
          default: "qcow2"
        path:
          type: string
          description: Path to disk (for attach action, or relative path for any action)
          example: "existing-disk.qcow2"
        storage_pool:
          type: string
          description: Override storage pool for this disk
          example: "fast-ssd"
        clone_from:
          type: string
          description: Source disk path to clone from (required for clone action)
          example: "template-disk.qcow2"
        bus:
          type: string
          description: Disk bus type
          enum: [virtio, sata, scsi, ide, usb]
          default: "virtio"
        boot_order:
          type: integer
          description: Boot priority (1 = first)
          minimum: 1
        cache:
          type: string
          description: Cache mode
          enum: [none, writethrough, writeback]
        io_mode:
          type: string
          description: I/O mode
          enum: [native, threads]
        readonly:
          type: boolean
          description: Read-only disk
          default: false
        device:
          type: string
          description: Device type
          enum: [disk, cdrom, floppy]
          default: "disk"
        target:
          type: string
          description: Target device name (auto-generated if not specified)
          example: "vda"

    PCIDeviceConfig:
      type: object
      required:
        - host_address
      properties:
        host_address:
          type: string
          description: PCI address on host
          pattern: '^[0-9a-fA-F]{4}:[0-9a-fA-F]{2}:[0-9a-fA-F]{2}\.[0-7]$'
          example: "0000:01:00.0"
        guest_address:
          type: string
          description: PCI address in guest (auto-assigned if omitted)
          pattern: '^[0-9a-fA-F]{4}:[0-9a-fA-F]{2}:[0-9a-fA-F]{2}\.[0-7]$'
          example: "0000:05:00.0"
        rom_file:
          type: string
          description: Path to ROM file (for GPU passthrough)
          example: "/usr/share/vgabios/rtx3080.rom"
        multifunction:
          type: boolean
          description: Enable multifunction
          default: false
        primary_gpu:
          type: boolean
          description: Set as primary GPU
          default: false

    EnhancedGraphicsConfig:
      type: object
      required:
        - type
      properties:
        type:
          type: string
          description: Graphics type
          enum: [vnc, spice, egl-headless, none]
          example: "vnc"
        port:
          type: integer
          description: Port number (-1 for auto)
          default: -1
        autoport:
          type: boolean
          description: Auto-assign port
          default: true
        listen:
          type: string
          description: Listen address
          default: "127.0.0.1"
          example: "0.0.0.0"
        password:
          type: string
          description: Console password
          format: password
