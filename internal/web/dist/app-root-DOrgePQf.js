import{g as e,a as t,i as s,r as i,b as o,p as r,t as a,c as n}from"./index-BUiOeSBK.js";const l=globalThis,c=l.ShadowRoot&&(void 0===l.ShadyCSS||l.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,d=Symbol(),h=/* @__PURE__ */new WeakMap;let u=class{constructor(e,t,s){if(this._$cssResult$=!0,s!==d)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(c&&void 0===e){const s=void 0!==t&&1===t.length;s&&(e=h.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),s&&h.set(t,e))}return e}toString(){return this.cssText}};const p=e=>new u("string"==typeof e?e:e+"",void 0,d),g=(e,...t)=>{const s=1===e.length?e[0]:t.reduce((t,s,i)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(s)+e[i+1],e[0]);return new u(s,e,d)},m=c?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const s of e.cssRules)t+=s.cssText;return p(t)})(e):e,{is:f,defineProperty:v,getOwnPropertyDescriptor:b,getOwnPropertyNames:y,getOwnPropertySymbols:w,getPrototypeOf:x}=Object,_=globalThis,k=_.trustedTypes,S=k?k.emptyScript:"",C=_.reactiveElementPolyfillSupport,$=(e,t)=>e,D={toAttribute(e,t){switch(t){case Boolean:e=e?S:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let s=e;switch(t){case Boolean:s=null!==e;break;case Number:s=null===e?null:Number(e);break;case Object:case Array:try{s=JSON.parse(e)}catch(i){s=null}}return s}},E=(e,t)=>!f(e,t),M={attribute:!0,type:String,converter:D,reflect:!1,useDefault:!1,hasChanged:E};Symbol.metadata??=Symbol("metadata"),_.litPropertyMetadata??=/* @__PURE__ */new WeakMap;let A=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=M){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const s=Symbol(),i=this.getPropertyDescriptor(e,s,t);void 0!==i&&v(this.prototype,e,i)}}static getPropertyDescriptor(e,t,s){const{get:i,set:o}=b(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:i,set(t){const r=i?.call(this);o?.call(this,t),this.requestUpdate(e,r,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??M}static _$Ei(){if(this.hasOwnProperty($("elementProperties")))return;const e=x(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty($("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty($("properties"))){const e=this.properties,t=[...y(e),...w(e)];for(const s of t)this.createProperty(s,e[s])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,s]of t)this.elementProperties.set(e,s)}this._$Eh=/* @__PURE__ */new Map;for(const[t,s]of this.elementProperties){const e=this._$Eu(t,s);void 0!==e&&this._$Eh.set(e,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const s=new Set(e.flat(1/0).reverse());for(const e of s)t.unshift(m(e))}else void 0!==e&&t.push(m(e));return t}static _$Eu(e,t){const s=t.attribute;return!1===s?void 0:"string"==typeof s?s:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=/* @__PURE__ */new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$EO??=/* @__PURE__ */new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=/* @__PURE__ */new Map,t=this.constructor.elementProperties;for(const s of t.keys())this.hasOwnProperty(s)&&(e.set(s,this[s]),delete this[s]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{if(c)e.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const s of t){const t=document.createElement("style"),i=l.litNonce;void 0!==i&&t.setAttribute("nonce",i),t.textContent=s.cssText,e.appendChild(t)}})(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,t,s){this._$AK(e,s)}_$ET(e,t){const s=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,s);if(void 0!==i&&!0===s.reflect){const o=(void 0!==s.converter?.toAttribute?s.converter:D).toAttribute(t,s.type);this._$Em=e,null==o?this.removeAttribute(i):this.setAttribute(i,o),this._$Em=null}}_$AK(e,t){const s=this.constructor,i=s._$Eh.get(e);if(void 0!==i&&this._$Em!==i){const e=s.getPropertyOptions(i),o="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:D;this._$Em=i;const r=o.fromAttribute(t,e.type);this[i]=r??this._$Ej?.get(i)??r,this._$Em=null}}requestUpdate(e,t,s){if(void 0!==e){const i=this.constructor,o=this[e];if(s??=i.getPropertyOptions(e),!((s.hasChanged??E)(o,t)||s.useDefault&&s.reflect&&o===this._$Ej?.get(e)&&!this.hasAttribute(i._$Eu(e,s))))return;this.C(e,t,s)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:s,reflect:i,wrapped:o},r){s&&!(this._$Ej??=/* @__PURE__ */new Map).has(e)&&(this._$Ej.set(e,r??t??this[e]),!0!==o||void 0!==r)||(this._$AL.has(e)||(this.hasUpdated||s||(t=void 0),this._$AL.set(e,t)),!0===i&&this._$Em!==e&&(this._$Eq??=/* @__PURE__ */new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,s]of e){const{wrapped:e}=s,i=this[t];!0!==e||this._$AL.has(t)||void 0===i||this.C(t,void 0,s,i)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach(e=>e.hostUpdate?.()),this.update(t)):this._$EM()}catch(s){throw e=!1,this._$EM(),s}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach(e=>e.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=/* @__PURE__ */new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach(e=>this._$ET(e,this[e])),this._$EM()}updated(e){}firstUpdated(e){}};A.elementStyles=[],A.shadowRootOptions={mode:"open"},A[$("elementProperties")]=/* @__PURE__ */new Map,A[$("finalized")]=/* @__PURE__ */new Map,C?.({ReactiveElement:A}),(_.reactiveElementVersions??=[]).push("2.1.1");const I=globalThis,T=I.trustedTypes,P=T?T.createPolicy("lit-html",{createHTML:e=>e}):void 0,L="$lit$",R=`lit$${Math.random().toFixed(9).slice(2)}$`,O="?"+R,N=`<${O}>`,B=document,F=()=>B.createComment(""),z=e=>null===e||"object"!=typeof e&&"function"!=typeof e,U=Array.isArray,V="[ \t\n\f\r]",j=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,H=/-->/g,W=/>/g,q=RegExp(`>|${V}(?:([^\\s"'>=/]+)(${V}*=${V}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),K=/'/g,G=/"/g,Q=/^(?:script|style|textarea|title)$/i,J=(te=1,(e,...t)=>({_$litType$:te,strings:e,values:t})),Y=Symbol.for("lit-noChange"),X=Symbol.for("lit-nothing"),Z=/* @__PURE__ */new WeakMap,ee=B.createTreeWalker(B,129);var te;function se(e,t){if(!U(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==P?P.createHTML(t):t}class ie{constructor({strings:e,_$litType$:t},s){let i;this.parts=[];let o=0,r=0;const a=e.length-1,n=this.parts,[l,c]=((e,t)=>{const s=e.length-1,i=[];let o,r=2===t?"<svg>":3===t?"<math>":"",a=j;for(let n=0;n<s;n++){const t=e[n];let s,l,c=-1,d=0;for(;d<t.length&&(a.lastIndex=d,l=a.exec(t),null!==l);)d=a.lastIndex,a===j?"!--"===l[1]?a=H:void 0!==l[1]?a=W:void 0!==l[2]?(Q.test(l[2])&&(o=RegExp("</"+l[2],"g")),a=q):void 0!==l[3]&&(a=q):a===q?">"===l[0]?(a=o??j,c=-1):void 0===l[1]?c=-2:(c=a.lastIndex-l[2].length,s=l[1],a=void 0===l[3]?q:'"'===l[3]?G:K):a===G||a===K?a=q:a===H||a===W?a=j:(a=q,o=void 0);const h=a===q&&e[n+1].startsWith("/>")?" ":"";r+=a===j?t+N:c>=0?(i.push(s),t.slice(0,c)+L+t.slice(c)+R+h):t+R+(-2===c?n:h)}return[se(e,r+(e[s]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),i]})(e,t);if(this.el=ie.createElement(l,s),ee.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(i=ee.nextNode())&&n.length<a;){if(1===i.nodeType){if(i.hasAttributes())for(const e of i.getAttributeNames())if(e.endsWith(L)){const t=c[r++],s=i.getAttribute(e).split(R),a=/([.?@])?(.*)/.exec(t);n.push({type:1,index:o,name:a[2],strings:s,ctor:"."===a[1]?le:"?"===a[1]?ce:"@"===a[1]?de:ne}),i.removeAttribute(e)}else e.startsWith(R)&&(n.push({type:6,index:o}),i.removeAttribute(e));if(Q.test(i.tagName)){const e=i.textContent.split(R),t=e.length-1;if(t>0){i.textContent=T?T.emptyScript:"";for(let s=0;s<t;s++)i.append(e[s],F()),ee.nextNode(),n.push({type:2,index:++o});i.append(e[t],F())}}}else if(8===i.nodeType)if(i.data===O)n.push({type:2,index:o});else{let e=-1;for(;-1!==(e=i.data.indexOf(R,e+1));)n.push({type:7,index:o}),e+=R.length-1}o++}}static createElement(e,t){const s=B.createElement("template");return s.innerHTML=e,s}}function oe(e,t,s=e,i){if(t===Y)return t;let o=void 0!==i?s._$Co?.[i]:s._$Cl;const r=z(t)?void 0:t._$litDirective$;return o?.constructor!==r&&(o?._$AO?.(!1),void 0===r?o=void 0:(o=new r(e),o._$AT(e,s,i)),void 0!==i?(s._$Co??=[])[i]=o:s._$Cl=o),void 0!==o&&(t=oe(e,o._$AS(e,t.values),o,i)),t}let re=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:s}=this._$AD,i=(e?.creationScope??B).importNode(t,!0);ee.currentNode=i;let o=ee.nextNode(),r=0,a=0,n=s[0];for(;void 0!==n;){if(r===n.index){let t;2===n.type?t=new ae(o,o.nextSibling,this,e):1===n.type?t=new n.ctor(o,n.name,n.strings,this,e):6===n.type&&(t=new he(o,this,e)),this._$AV.push(t),n=s[++a]}r!==n?.index&&(o=ee.nextNode(),r++)}return ee.currentNode=B,i}p(e){let t=0;for(const s of this._$AV)void 0!==s&&(void 0!==s.strings?(s._$AI(e,s,t),t+=s.strings.length-2):s._$AI(e[t])),t++}};class ae{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,s,i){this.type=2,this._$AH=X,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=s,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=oe(this,e,t),z(e)?e===X||null==e||""===e?(this._$AH!==X&&this._$AR(),this._$AH=X):e!==this._$AH&&e!==Y&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):(e=>U(e)||"function"==typeof e?.[Symbol.iterator])(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==X&&z(this._$AH)?this._$AA.nextSibling.data=e:this.T(B.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:s}=e,i="number"==typeof s?this._$AC(e):(void 0===s.el&&(s.el=ie.createElement(se(s.h,s.h[0]),this.options)),s);if(this._$AH?._$AD===i)this._$AH.p(t);else{const e=new re(i,this),s=e.u(this.options);e.p(t),this.T(s),this._$AH=e}}_$AC(e){let t=Z.get(e.strings);return void 0===t&&Z.set(e.strings,t=new ie(e)),t}k(e){U(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let s,i=0;for(const o of e)i===t.length?t.push(s=new ae(this.O(F()),this.O(F()),this,this.options)):s=t[i],s._$AI(o),i++;i<t.length&&(this._$AR(s&&s._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class ne{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,s,i,o){this.type=1,this._$AH=X,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=o,s.length>2||""!==s[0]||""!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=X}_$AI(e,t=this,s,i){const o=this.strings;let r=!1;if(void 0===o)e=oe(this,e,t,0),r=!z(e)||e!==this._$AH&&e!==Y,r&&(this._$AH=e);else{const i=e;let a,n;for(e=o[0],a=0;a<o.length-1;a++)n=oe(this,i[s+a],t,a),n===Y&&(n=this._$AH[a]),r||=!z(n)||n!==this._$AH[a],n===X?e=X:e!==X&&(e+=(n??"")+o[a+1]),this._$AH[a]=n}r&&!i&&this.j(e)}j(e){e===X?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class le extends ne{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===X?void 0:e}}class ce extends ne{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==X)}}class de extends ne{constructor(e,t,s,i,o){super(e,t,s,i,o),this.type=5}_$AI(e,t=this){if((e=oe(this,e,t,0)??X)===Y)return;const s=this._$AH,i=e===X&&s!==X||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,o=e!==X&&(s===X||i);i&&this.element.removeEventListener(this.name,this,s),o&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class he{constructor(e,t,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){oe(this,e)}}const ue={I:ae},pe=I.litHtmlPolyfillSupport;pe?.(ie,ae),(I.litHtmlVersions??=[]).push("3.3.1");const ge=globalThis;let me=class extends A{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=((e,t,s)=>{const i=s?.renderBefore??t;let o=i._$litPart$;if(void 0===o){const e=s?.renderBefore??null;i._$litPart$=o=new ae(t.insertBefore(F(),e),e,void 0,s??{})}return o._$AI(e),o})(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return Y}};me._$litElement$=!0,me.finalized=!0,ge.litElementHydrateSupport?.({LitElement:me});const fe=ge.litElementPolyfillSupport;fe?.({LitElement:me}),(ge.litElementVersions??=[]).push("4.2.1");const ve=e=>(t,s)=>{void 0!==s?s.addInitializer(()=>{customElements.define(e,t)}):customElements.define(e,t)},be={attribute:!0,type:String,converter:D,reflect:!1,hasChanged:E},ye=(e=be,t,s)=>{const{kind:i,metadata:o}=s;let r=globalThis.litPropertyMetadata.get(o);if(void 0===r&&globalThis.litPropertyMetadata.set(o,r=/* @__PURE__ */new Map),"setter"===i&&((e=Object.create(e)).wrapped=!0),r.set(s.name,e),"accessor"===i){const{name:i}=s;return{set(s){const o=t.get.call(this);t.set.call(this,s),this.requestUpdate(i,o,e)},init(t){return void 0!==t&&this.C(i,void 0,e,t),t}}}if("setter"===i){const{name:i}=s;return function(s){const o=this[i];t.call(this,s),this.requestUpdate(i,o,e)}}throw Error("Unsupported decorator location: "+i)};function we(e){return(t,s)=>"object"==typeof s?ye(e,t,s):((e,t,s)=>{const i=t.hasOwnProperty(s);return t.constructor.createProperty(s,e),i?Object.getOwnPropertyDescriptor(t,s):void 0})(e,t,s)}function xe(e){return we({...e,state:!0,attribute:!1})}function _e(e,t){return(t,s,i)=>((e,t,s)=>(s.configurable=!0,s.enumerable=!0,Reflect.decorate&&"object"!=typeof t&&Object.defineProperty(e,t,s),s))(t,s,{get(){return(t=>t.renderRoot?.querySelector(e)??null)(this)}})}function ke(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Se,Ce={exports:{}};var $e,De,Ee=(Se||(Se=1,$e=Ce,function(e,t){$e.exports=t()}(self,()=>(()=>{var e={4567:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AccessibilityManager=void 0;const r=s(9042),a=s(6114),n=s(9924),l=s(844),c=s(5596),d=s(4725),h=s(3656);let u=t.AccessibilityManager=class extends l.Disposable{constructor(e,t){super(),this._terminal=e,this._renderService=t,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=document.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=document.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let s=0;s<this._terminal.rows;s++)this._rowElements[s]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[s]);if(this._topBoundaryFocusListener=e=>this._handleBoundaryFocus(e,0),this._bottomBoundaryFocusListener=e=>this._handleBoundaryFocus(e,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=document.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new n.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize(e=>this._handleResize(e.rows))),this.register(this._terminal.onRender(e=>this._refreshRows(e.start,e.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(e=>this._handleChar(e))),this.register(this._terminal.onLineFeed(()=>this._handleChar("\n"))),this.register(this._terminal.onA11yTab(e=>this._handleTab(e))),this.register(this._terminal.onKey(e=>this._handleKey(e.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._screenDprMonitor=new c.ScreenDprMonitor(window),this.register(this._screenDprMonitor),this._screenDprMonitor.setListener(()=>this._refreshRowsDimensions()),this.register((0,h.addDisposableDomListener)(window,"resize",()=>this._refreshRowsDimensions())),this._refreshRows(),this.register((0,l.toDisposable)(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(e){for(let t=0;t<e;t++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,"\n"===e&&(this._liveRegionLineCount++,21===this._liveRegionLineCount&&(this._liveRegion.textContent+=r.tooMuchOutput)),a.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout(()=>{this._accessibilityContainer.appendChild(this._liveRegion)},0))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0,a.isMac&&this._liveRegion.remove()}_handleKey(e){this._clearLiveRegion(),/\p{Control}/u.test(e)||this._charsToConsume.push(e)}_refreshRows(e,t){this._liveRegionDebouncer.refresh(e,t,this._terminal.rows)}_renderRows(e,t){const s=this._terminal.buffer,i=s.lines.length.toString();for(let o=e;o<=t;o++){const e=s.translateBufferLineToString(s.ydisp+o,!0),t=(s.ydisp+o+1).toString(),r=this._rowElements[o];r&&(0===e.length?r.innerText="Â ":r.textContent=e,r.setAttribute("aria-posinset",t),r.setAttribute("aria-setsize",i))}this._announceCharacters()}_announceCharacters(){0!==this._charsToAnnounce.length&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(e,t){const s=e.target,i=this._rowElements[0===t?1:this._rowElements.length-2];if(s.getAttribute("aria-posinset")===(0===t?"1":`${this._terminal.buffer.lines.length}`))return;if(e.relatedTarget!==i)return;let o,r;if(0===t?(o=s,r=this._rowElements.pop(),this._rowContainer.removeChild(r)):(o=this._rowElements.shift(),r=s,this._rowContainer.removeChild(o)),o.removeEventListener("focus",this._topBoundaryFocusListener),r.removeEventListener("focus",this._bottomBoundaryFocusListener),0===t){const e=this._createAccessibilityTreeNode();this._rowElements.unshift(e),this._rowContainer.insertAdjacentElement("afterbegin",e)}else{const e=this._createAccessibilityTreeNode();this._rowElements.push(e),this._rowContainer.appendChild(e)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(0===t?-1:1),this._rowElements[0===t?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let t=this._rowContainer.children.length;t<this._terminal.rows;t++)this._rowElements[t]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[t]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const e=document.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}};t.AccessibilityManager=u=i([o(1,d.IRenderService)],u)},3614:(e,t)=>{function s(e){return e.replace(/\r?\n/g,"\r")}function i(e,t){return t?"[200~"+e+"[201~":e}function o(e,t,o,r){e=i(e=s(e),o.decPrivateModes.bracketedPasteMode&&!0!==r.rawOptions.ignoreBracketedPasteMode),o.triggerDataEvent(e,!0),t.value=""}function r(e,t,s){const i=s.getBoundingClientRect(),o=e.clientX-i.left-10,r=e.clientY-i.top-10;t.style.width="20px",t.style.height="20px",t.style.left=`${o}px`,t.style.top=`${r}px`,t.style.zIndex="1000",t.focus()}Object.defineProperty(t,"__esModule",{value:!0}),t.rightClickHandler=t.moveTextAreaUnderMouseCursor=t.paste=t.handlePasteEvent=t.copyHandler=t.bracketTextForPaste=t.prepareTextForTerminal=void 0,t.prepareTextForTerminal=s,t.bracketTextForPaste=i,t.copyHandler=function(e,t){e.clipboardData&&e.clipboardData.setData("text/plain",t.selectionText),e.preventDefault()},t.handlePasteEvent=function(e,t,s,i){e.stopPropagation(),e.clipboardData&&o(e.clipboardData.getData("text/plain"),t,s,i)},t.paste=o,t.moveTextAreaUnderMouseCursor=r,t.rightClickHandler=function(e,t,s,i,o){r(e,t,s),o&&i.rightClickSelect(e),t.value=i.selectionText,t.select()}},7239:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorContrastCache=void 0;const i=s(1505);t.ColorContrastCache=class{constructor(){this._color=new i.TwoKeyMap,this._css=new i.TwoKeyMap}setCss(e,t,s){this._css.set(e,t,s)}getCss(e,t){return this._css.get(e,t)}setColor(e,t,s){this._color.set(e,t,s)}getColor(e,t){return this._color.get(e,t)}clear(){this._color.clear(),this._css.clear()}}},3656:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addDisposableDomListener=void 0,t.addDisposableDomListener=function(e,t,s,i){e.addEventListener(t,s,i);let o=!1;return{dispose:()=>{o||(o=!0,e.removeEventListener(t,s,i))}}}},6465:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Linkifier2=void 0;const r=s(3656),a=s(8460),n=s(844),l=s(2585);let c=t.Linkifier2=class extends n.Disposable{get currentLink(){return this._currentLink}constructor(e){super(),this._bufferService=e,this._linkProviders=[],this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new a.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new a.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,n.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,n.toDisposable)(()=>{this._lastMouseEvent=void 0})),this.register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0}))}registerLinkProvider(e){return this._linkProviders.push(e),{dispose:()=>{const t=this._linkProviders.indexOf(e);-1!==t&&this._linkProviders.splice(t,1)}}}attachToDom(e,t,s){this._element=e,this._mouseService=t,this._renderService=s,this.register((0,r.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,r.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,r.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,r.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(e){if(this._lastMouseEvent=e,!this._element||!this._mouseService)return;const t=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!t)return;this._isMouseOut=!1;const s=e.composedPath();for(let i=0;i<s.length;i++){const e=s[i];if(e.classList.contains("xterm"))break;if(e.classList.contains("xterm-hover"))return}this._lastBufferCell&&t.x===this._lastBufferCell.x&&t.y===this._lastBufferCell.y||(this._handleHover(t),this._lastBufferCell=t)}_handleHover(e){if(this._activeLine!==e.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(e,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,t){var s,i;this._activeProviderReplies&&t||(null===(s=this._activeProviderReplies)||void 0===s||s.forEach(e=>{null==e||e.forEach(e=>{e.link.dispose&&e.link.dispose()})}),this._activeProviderReplies=/* @__PURE__ */new Map,this._activeLine=e.y);let o=!1;for(const[r,a]of this._linkProviders.entries())t?(null===(i=this._activeProviderReplies)||void 0===i?void 0:i.get(r))&&(o=this._checkLinkProviderResult(r,e,o)):a.provideLinks(e.y,t=>{var s,i;if(this._isMouseOut)return;const a=null==t?void 0:t.map(e=>({link:e}));null===(s=this._activeProviderReplies)||void 0===s||s.set(r,a),o=this._checkLinkProviderResult(r,e,o),(null===(i=this._activeProviderReplies)||void 0===i?void 0:i.size)===this._linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)})}_removeIntersectingLinks(e,t){const s=/* @__PURE__ */new Set;for(let i=0;i<t.size;i++){const o=t.get(i);if(o)for(let t=0;t<o.length;t++){const i=o[t],r=i.link.range.start.y<e?0:i.link.range.start.x,a=i.link.range.end.y>e?this._bufferService.cols:i.link.range.end.x;for(let e=r;e<=a;e++){if(s.has(e)){o.splice(t--,1);break}s.add(e)}}}}_checkLinkProviderResult(e,t,s){var i;if(!this._activeProviderReplies)return s;const o=this._activeProviderReplies.get(e);let r=!1;for(let a=0;a<e;a++)this._activeProviderReplies.has(a)&&!this._activeProviderReplies.get(a)||(r=!0);if(!r&&o){const e=o.find(e=>this._linkAtPosition(e.link,t));e&&(s=!0,this._handleNewLink(e))}if(this._activeProviderReplies.size===this._linkProviders.length&&!s)for(let a=0;a<this._activeProviderReplies.size;a++){const e=null===(i=this._activeProviderReplies.get(a))||void 0===i?void 0:i.find(e=>this._linkAtPosition(e.link,t));if(e){s=!0,this._handleNewLink(e);break}}return s}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){if(!this._element||!this._mouseService||!this._currentLink)return;const t=this._positionFromMouseEvent(e,this._element,this._mouseService);t&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,t)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,t){this._element&&this._currentLink&&this._lastMouseEvent&&(!e||!t||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=t)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,n.disposeArray)(this._linkCacheDisposables))}_handleNewLink(e){if(!this._element||!this._lastMouseEvent||!this._mouseService)return;const t=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);t&&this._linkAtPosition(e.link,t)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:void 0===e.link.decorations||e.link.decorations.underline,pointerCursor:void 0===e.link.decorations||e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>{var e,t;return null===(t=null===(e=this._currentLink)||void 0===e?void 0:e.state)||void 0===t?void 0:t.decorations.pointerCursor},set:e=>{var t,s;(null===(t=this._currentLink)||void 0===t?void 0:t.state)&&this._currentLink.state.decorations.pointerCursor!==e&&(this._currentLink.state.decorations.pointerCursor=e,this._currentLink.state.isHovered&&(null===(s=this._element)||void 0===s||s.classList.toggle("xterm-cursor-pointer",e)))}},underline:{get:()=>{var e,t;return null===(t=null===(e=this._currentLink)||void 0===e?void 0:e.state)||void 0===t?void 0:t.decorations.underline},set:t=>{var s,i,o;(null===(s=this._currentLink)||void 0===s?void 0:s.state)&&(null===(o=null===(i=this._currentLink)||void 0===i?void 0:i.state)||void 0===o?void 0:o.decorations.underline)!==t&&(this._currentLink.state.decorations.underline=t,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,t))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(e=>{if(!this._currentLink)return;const t=0===e.start?0:e.start+1+this._bufferService.buffer.ydisp,s=this._bufferService.buffer.ydisp+1+e.end;if(this._currentLink.link.range.start.y>=t&&this._currentLink.link.range.end.y<=s&&(this._clearCurrentLink(t,s),this._lastMouseEvent&&this._element)){const e=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);e&&this._askForLink(e,!1)}})))}_linkHover(e,t,s){var i;(null===(i=this._currentLink)||void 0===i?void 0:i.state)&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),t.hover&&t.hover(s,t.text)}_fireUnderlineEvent(e,t){const s=e.range,i=this._bufferService.buffer.ydisp,o=this._createLinkUnderlineEvent(s.start.x-1,s.start.y-i-1,s.end.x,s.end.y-i-1,void 0);(t?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(o)}_linkLeave(e,t,s){var i;(null===(i=this._currentLink)||void 0===i?void 0:i.state)&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),t.leave&&t.leave(s,t.text)}_linkAtPosition(e,t){const s=e.range.start.y*this._bufferService.cols+e.range.start.x,i=e.range.end.y*this._bufferService.cols+e.range.end.x,o=t.y*this._bufferService.cols+t.x;return s<=o&&o<=i}_positionFromMouseEvent(e,t,s){const i=s.getCoords(e,t,this._bufferService.cols,this._bufferService.rows);if(i)return{x:i[0],y:i[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,t,s,i,o){return{x1:e,y1:t,x2:s,y2:i,cols:this._bufferService.cols,fg:o}}};t.Linkifier2=c=i([o(0,l.IBufferService)],c)},9042:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tooMuchOutput=t.promptLabel=void 0,t.promptLabel="Terminal input",t.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkProvider=void 0;const r=s(511),a=s(2585);let n=t.OscLinkProvider=class{constructor(e,t,s){this._bufferService=e,this._optionsService=t,this._oscLinkService=s}provideLinks(e,t){var s;const i=this._bufferService.buffer.lines.get(e-1);if(!i)return void t(void 0);const o=[],a=this._optionsService.rawOptions.linkHandler,n=new r.CellData,c=i.getTrimmedLength();let d=-1,h=-1,u=!1;for(let r=0;r<c;r++)if(-1!==h||i.hasContent(r)){if(i.loadCell(r,n),n.hasExtendedAttrs()&&n.extended.urlId){if(-1===h){h=r,d=n.extended.urlId;continue}u=n.extended.urlId!==d}else-1!==h&&(u=!0);if(u||-1!==h&&r===c-1){const t=null===(s=this._oscLinkService.getLinkData(d))||void 0===s?void 0:s.uri;if(t){const s={start:{x:h+1,y:e},end:{x:r+(u||r!==c-1?0:1),y:e}};let i=!1;if(!(null==a?void 0:a.allowNonHttpProtocols))try{const e=new URL(t);["http:","https:"].includes(e.protocol)||(i=!0)}catch(p){i=!0}i||o.push({text:t,range:s,activate:(e,t)=>a?a.activate(e,t,s):l(0,t),hover:(e,t)=>{var i;return null===(i=null==a?void 0:a.hover)||void 0===i?void 0:i.call(a,e,t,s)},leave:(e,t)=>{var i;return null===(i=null==a?void 0:a.leave)||void 0===i?void 0:i.call(a,e,t,s)}})}u=!1,n.hasExtendedAttrs()&&n.extended.urlId?(h=r,d=n.extended.urlId):(h=-1,d=-1)}}t(o)}};function l(e,t){if(confirm(`Do you want to navigate to ${t}?\n\nWARNING: This link could potentially be dangerous`)){const e=window.open();if(e){try{e.opener=null}catch(s){}e.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}}t.OscLinkProvider=n=i([o(0,a.IBufferService),o(1,a.IOptionsService),o(2,a.IOscLinkService)],n)},6193:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderDebouncer=void 0,t.RenderDebouncer=class{constructor(e,t){this._parentWindow=e,this._renderCallback=t,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._parentWindow.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(e){return this._refreshCallbacks.push(e),this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(e,t,s){this._rowCount=s,e=void 0!==e?e:0,t=void 0!==t?t:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,e):e,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,t):t,this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return void this._runRefreshCallbacks();const e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const e of this._refreshCallbacks)e(0);this._refreshCallbacks=[]}}},5596:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenDprMonitor=void 0;const i=s(844);class o extends i.Disposable{constructor(e){super(),this._parentWindow=e,this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this.register((0,i.toDisposable)(()=>{this.clearListener()}))}setListener(e){this._listener&&this.clearListener(),this._listener=e,this._outerListener=()=>{this._listener&&(this._listener(this._parentWindow.devicePixelRatio,this._currentDevicePixelRatio),this._updateDpr())},this._updateDpr()}_updateDpr(){var e;this._outerListener&&(null===(e=this._resolutionMediaMatchList)||void 0===e||e.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)}}t.ScreenDprMonitor=o},3236:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Terminal=void 0;const i=s(3614),o=s(3656),r=s(6465),a=s(9042),n=s(3730),l=s(1680),c=s(3107),d=s(5744),h=s(2950),u=s(1296),p=s(428),g=s(4269),m=s(5114),f=s(8934),v=s(3230),b=s(9312),y=s(4725),w=s(6731),x=s(8055),_=s(8969),k=s(8460),S=s(844),C=s(6114),$=s(8437),D=s(2584),E=s(7399),M=s(5941),A=s(9074),I=s(2585),T=s(5435),P=s(4567),L="undefined"!=typeof window?window.document:null;class R extends _.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(e={}){super(e),this.browser=C,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new S.MutableDisposable),this._onCursorMove=this.register(new k.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new k.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new k.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new k.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new k.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new k.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new k.EventEmitter),this._onBlur=this.register(new k.EventEmitter),this._onA11yCharEmitter=this.register(new k.EventEmitter),this._onA11yTabEmitter=this.register(new k.EventEmitter),this._onWillOpen=this.register(new k.EventEmitter),this._setup(),this.linkifier2=this.register(this._instantiationService.createInstance(r.Linkifier2)),this.linkifier2.registerLinkProvider(this._instantiationService.createInstance(n.OscLinkProvider)),this._decorationService=this._instantiationService.createInstance(A.DecorationService),this._instantiationService.setService(I.IDecorationService,this._decorationService),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((e,t)=>this.refresh(e,t))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(e=>this._reportWindowsOptions(e))),this.register(this._inputHandler.onColor(e=>this._handleColorEvent(e))),this.register((0,k.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,k.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,k.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,k.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(e=>this._afterResize(e.cols,e.rows))),this.register((0,S.toDisposable)(()=>{var e,t;this._customKeyEventHandler=void 0,null===(t=null===(e=this.element)||void 0===e?void 0:e.parentNode)||void 0===t||t.removeChild(this.element)}))}_handleColorEvent(e){if(this._themeService)for(const t of e){let e,s="";switch(t.index){case 256:e="foreground",s="10";break;case 257:e="background",s="11";break;case 258:e="cursor",s="12";break;default:e="ansi",s="4;"+t.index}switch(t.type){case 0:const i=x.color.toColorRGB("ansi"===e?this._themeService.colors.ansi[t.index]:this._themeService.colors[e]);this.coreService.triggerDataEvent(`${D.C0.ESC}]${s};${(0,M.toRgbString)(i)}${D.C1_ESCAPED.ST}`);break;case 1:if("ansi"===e)this._themeService.modifyColors(e=>e.ansi[t.index]=x.rgba.toColor(...t.color));else{const s=e;this._themeService.modifyColors(e=>e[s]=x.rgba.toColor(...t.color))}break;case 2:this._themeService.restoreColor(t.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(e){e?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(P.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(e){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(D.C0.ESC+"[I"),this.updateCursorStyle(e),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var e;return null===(e=this.textarea)||void 0===e?void 0:e.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(D.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const e=this.buffer.ybase+this.buffer.y,t=this.buffer.lines.get(e);if(!t)return;const s=Math.min(this.buffer.x,this.cols-1),i=this._renderService.dimensions.css.cell.height,o=t.getWidth(s),r=this._renderService.dimensions.css.cell.width*o,a=this.buffer.y*this._renderService.dimensions.css.cell.height,n=s*this._renderService.dimensions.css.cell.width;this.textarea.style.left=n+"px",this.textarea.style.top=a+"px",this.textarea.style.width=r+"px",this.textarea.style.height=i+"px",this.textarea.style.lineHeight=i+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,o.addDisposableDomListener)(this.element,"copy",e=>{this.hasSelection()&&(0,i.copyHandler)(e,this._selectionService)}));const e=e=>(0,i.handlePasteEvent)(e,this.textarea,this.coreService,this.optionsService);this.register((0,o.addDisposableDomListener)(this.textarea,"paste",e)),this.register((0,o.addDisposableDomListener)(this.element,"paste",e)),C.isFirefox?this.register((0,o.addDisposableDomListener)(this.element,"mousedown",e=>{2===e.button&&(0,i.rightClickHandler)(e,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,o.addDisposableDomListener)(this.element,"contextmenu",e=>{(0,i.rightClickHandler)(e,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),C.isLinux&&this.register((0,o.addDisposableDomListener)(this.element,"auxclick",e=>{1===e.button&&(0,i.moveTextAreaUnderMouseCursor)(e,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,o.addDisposableDomListener)(this.textarea,"keyup",e=>this._keyUp(e),!0)),this.register((0,o.addDisposableDomListener)(this.textarea,"keydown",e=>this._keyDown(e),!0)),this.register((0,o.addDisposableDomListener)(this.textarea,"keypress",e=>this._keyPress(e),!0)),this.register((0,o.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,o.addDisposableDomListener)(this.textarea,"compositionupdate",e=>this._compositionHelper.compositionupdate(e))),this.register((0,o.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,o.addDisposableDomListener)(this.textarea,"input",e=>this._inputEvent(e),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(e){var t;if(!e)throw new Error("Terminal requires a parent element.");e.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=e.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),e.appendChild(this.element);const s=L.createDocumentFragment();this._viewportElement=L.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),s.appendChild(this._viewportElement),this._viewportScrollArea=L.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=L.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=L.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),s.appendChild(this.screenElement),this.textarea=L.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",a.promptLabel),C.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this._instantiationService.createInstance(m.CoreBrowserService,this.textarea,null!==(t=this._document.defaultView)&&void 0!==t?t:window),this._instantiationService.setService(y.ICoreBrowserService,this._coreBrowserService),this.register((0,o.addDisposableDomListener)(this.textarea,"focus",e=>this._handleTextAreaFocus(e))),this.register((0,o.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(p.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(y.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(w.ThemeService),this._instantiationService.setService(y.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(g.CharacterJoinerService),this._instantiationService.setService(y.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(v.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(y.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(e=>this._onRender.fire(e))),this.onResize(e=>this._renderService.resize(e.cols,e.rows)),this._compositionView=L.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(h.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(s);try{this._onWillOpen.fire(this.element)}catch(i){}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._mouseService=this._instantiationService.createInstance(f.MouseService),this._instantiationService.setService(y.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(l.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines(e=>this.scrollLines(e.amount,e.suppressScrollEvent,1)),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(b.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(y.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(e=>this.scrollLines(e.amount,e.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw(e=>this._renderService.handleSelectionChanged(e.start,e.end,e.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection(e=>{this.textarea.value=e,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event(e=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,o.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(c.BufferDecorationRenderer,this.screenElement)),this.register((0,o.addDisposableDomListener)(this.element,"mousedown",e=>this._selectionService.handleMouseDown(e))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(P.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",e=>this._handleScreenReaderModeOptionChange(e))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(d.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",e=>{!this._overviewRulerRenderer&&e&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(d.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(u.DomRenderer,this.element,this.screenElement,this._viewportElement,this.linkifier2)}bindMouse(){const e=this,t=this.element;function s(t){const s=e._mouseService.getMouseReportCoords(t,e.screenElement);if(!s)return!1;let i,o;switch(t.overrideType||t.type){case"mousemove":o=32,void 0===t.buttons?(i=3,void 0!==t.button&&(i=t.button<3?t.button:3)):i=1&t.buttons?0:4&t.buttons?1:2&t.buttons?2:3;break;case"mouseup":o=0,i=t.button<3?t.button:3;break;case"mousedown":o=1,i=t.button<3?t.button:3;break;case"wheel":if(0===e.viewport.getLinesScrolled(t))return!1;o=t.deltaY<0?0:1,i=4;break;default:return!1}return!(void 0===o||void 0===i||i>4)&&e.coreMouseService.triggerMouseEvent({col:s.col,row:s.row,x:s.x,y:s.y,button:i,action:o,ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey})}const i={mouseup:null,wheel:null,mousedrag:null,mousemove:null},r={mouseup:e=>(s(e),e.buttons||(this._document.removeEventListener("mouseup",i.mouseup),i.mousedrag&&this._document.removeEventListener("mousemove",i.mousedrag)),this.cancel(e)),wheel:e=>(s(e),this.cancel(e,!0)),mousedrag:e=>{e.buttons&&s(e)},mousemove:e=>{e.buttons||s(e)}};this.register(this.coreMouseService.onProtocolChange(e=>{e?("debug"===this.optionsService.rawOptions.logLevel&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(e)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&e?i.mousemove||(t.addEventListener("mousemove",r.mousemove),i.mousemove=r.mousemove):(t.removeEventListener("mousemove",i.mousemove),i.mousemove=null),16&e?i.wheel||(t.addEventListener("wheel",r.wheel,{passive:!1}),i.wheel=r.wheel):(t.removeEventListener("wheel",i.wheel),i.wheel=null),2&e?i.mouseup||(t.addEventListener("mouseup",r.mouseup),i.mouseup=r.mouseup):(this._document.removeEventListener("mouseup",i.mouseup),t.removeEventListener("mouseup",i.mouseup),i.mouseup=null),4&e?i.mousedrag||(i.mousedrag=r.mousedrag):(this._document.removeEventListener("mousemove",i.mousedrag),i.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,o.addDisposableDomListener)(t,"mousedown",e=>{if(e.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(e))return s(e),i.mouseup&&this._document.addEventListener("mouseup",i.mouseup),i.mousedrag&&this._document.addEventListener("mousemove",i.mousedrag),this.cancel(e)})),this.register((0,o.addDisposableDomListener)(t,"wheel",e=>{if(!i.wheel){if(!this.buffer.hasScrollback){const t=this.viewport.getLinesScrolled(e);if(0===t)return;const s=D.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(e.deltaY<0?"A":"B");let i="";for(let e=0;e<Math.abs(t);e++)i+=s;return this.coreService.triggerDataEvent(i,!0),this.cancel(e,!0)}return this.viewport.handleWheel(e)?this.cancel(e):void 0}},{passive:!1})),this.register((0,o.addDisposableDomListener)(t,"touchstart",e=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(e),this.cancel(e)},{passive:!0})),this.register((0,o.addDisposableDomListener)(t,"touchmove",e=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(e)?void 0:this.cancel(e)},{passive:!1}))}refresh(e,t){var s;null===(s=this._renderService)||void 0===s||s.refreshRows(e,t)}updateCursorStyle(e){var t;(null===(t=this._selectionService)||void 0===t?void 0:t.shouldColumnSelect(e))?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(e,t,s=0){var i;1===s?(super.scrollLines(e,t,s),this.refresh(0,this.rows-1)):null===(i=this.viewport)||void 0===i||i.scrollLines(e)}paste(e){(0,i.paste)(e,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(e){this._customKeyEventHandler=e}registerLinkProvider(e){return this.linkifier2.registerLinkProvider(e)}registerCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const t=this._characterJoinerService.register(e);return this.refresh(0,this.rows-1),t}deregisterCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(e)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(e){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+e)}registerDecoration(e){return this._decorationService.registerDecoration(e)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(e,t,s){this._selectionService.setSelection(e,t,s)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var e;null===(e=this._selectionService)||void 0===e||e.clearSelection()}selectAll(){var e;null===(e=this._selectionService)||void 0===e||e.selectAll()}selectLines(e,t){var s;null===(s=this._selectionService)||void 0===s||s.selectLines(e,t)}_keyDown(e){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&!1===this._customKeyEventHandler(e))return!1;const t=this.browser.isMac&&this.options.macOptionIsMeta&&e.altKey;if(!t&&!this._compositionHelper.keydown(e))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;t||"Dead"!==e.key&&"AltGraph"!==e.key||(this._unprocessedDeadKey=!0);const s=(0,E.evaluateKeyboardEvent)(e,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(e),3===s.type||2===s.type){const t=this.rows-1;return this.scrollLines(2===s.type?-t:t),this.cancel(e,!0)}return 1===s.type&&this.selectAll(),!!this._isThirdLevelShift(this.browser,e)||(s.cancel&&this.cancel(e,!0),!s.key||!!(e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&1===e.key.length&&e.key.charCodeAt(0)>=65&&e.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(s.key!==D.C0.ETX&&s.key!==D.C0.CR||(this.textarea.value=""),this._onKey.fire({key:s.key,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(s.key,!0),!this.optionsService.rawOptions.screenReaderMode||e.altKey||e.ctrlKey?this.cancel(e,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(e,t){const s=e.isMac&&!this.options.macOptionIsMeta&&t.altKey&&!t.ctrlKey&&!t.metaKey||e.isWindows&&t.altKey&&t.ctrlKey&&!t.metaKey||e.isWindows&&t.getModifierState("AltGraph");return"keypress"===t.type?s:s&&(!t.keyCode||t.keyCode>47)}_keyUp(e){var t;this._keyDownSeen=!1,this._customKeyEventHandler&&!1===this._customKeyEventHandler(e)||(16===(t=e).keyCode||17===t.keyCode||18===t.keyCode||this.focus(),this.updateCursorStyle(e),this._keyPressHandled=!1)}_keyPress(e){let t;if(this._keyPressHandled=!1,this._keyDownHandled)return!1;if(this._customKeyEventHandler&&!1===this._customKeyEventHandler(e))return!1;if(this.cancel(e),e.charCode)t=e.charCode;else if(null===e.which||void 0===e.which)t=e.keyCode;else{if(0===e.which||0===e.charCode)return!1;t=e.which}return!(!t||(e.altKey||e.ctrlKey||e.metaKey)&&!this._isThirdLevelShift(this.browser,e)||(t=String.fromCharCode(t),this._onKey.fire({key:t,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(t,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(e){if(e.data&&"insertText"===e.inputType&&(!e.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const t=e.data;return this.coreService.triggerDataEvent(t,!0),this.cancel(e),!0}return!1}resize(e,t){e!==this.cols||t!==this.rows?super.resize(e,t):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(e,t){var s,i;null===(s=this._charSizeService)||void 0===s||s.measure(),null===(i=this.viewport)||void 0===i||i.syncScrollArea(!0)}clear(){var e;if(0!==this.buffer.ybase||0!==this.buffer.y){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let e=1;e<this.rows;e++)this.buffer.lines.push(this.buffer.getBlankLine($.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),null===(e=this.viewport)||void 0===e||e.reset(),this.refresh(0,this.rows-1)}}reset(){var e,t;this.options.rows=this.rows,this.options.cols=this.cols;const s=this._customKeyEventHandler;this._setup(),super.reset(),null===(e=this._selectionService)||void 0===e||e.reset(),this._decorationService.reset(),null===(t=this.viewport)||void 0===t||t.reset(),this._customKeyEventHandler=s,this.refresh(0,this.rows-1)}clearTextureAtlas(){var e;null===(e=this._renderService)||void 0===e||e.clearTextureAtlas()}_reportFocus(){var e;(null===(e=this.element)||void 0===e?void 0:e.classList.contains("focus"))?this.coreService.triggerDataEvent(D.C0.ESC+"[I"):this.coreService.triggerDataEvent(D.C0.ESC+"[O")}_reportWindowsOptions(e){if(this._renderService)switch(e){case T.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const e=this._renderService.dimensions.css.canvas.width.toFixed(0),t=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${D.C0.ESC}[4;${t};${e}t`);break;case T.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const s=this._renderService.dimensions.css.cell.width.toFixed(0),i=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${D.C0.ESC}[6;${i};${s}t`)}}cancel(e,t){if(this.options.cancelEvents||t)return e.preventDefault(),e.stopPropagation(),!1}}t.Terminal=R},9924:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TimeBasedDebouncer=void 0,t.TimeBasedDebouncer=class{constructor(e,t=1e3){this._renderCallback=e,this._debounceThresholdMS=t,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(e,t,s){this._rowCount=s,e=void 0!==e?e:0,t=void 0!==t?t:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,e):e,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,t):t;const i=Date.now();if(i-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=i,this._innerRefresh();else if(!this._additionalRefreshRequested){const e=i-this._lastRefreshMs,t=this._debounceThresholdMS-e;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},t)}}_innerRefresh(){if(void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return;const e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t)}}},1680:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=void 0;const r=s(3656),a=s(4725),n=s(8460),l=s(844),c=s(2585);let d=t.Viewport=class extends l.Disposable{constructor(e,t,s,i,o,a,l,c){super(),this._viewportElement=e,this._scrollArea=t,this._bufferService=s,this._optionsService=i,this._charSizeService=o,this._renderService=a,this._coreBrowserService=l,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new n.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,r.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(e=>this._activeBuffer=e.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(e=>this._renderDimensions=e)),this._handleThemeChange(c.colors),this.register(c.onChangeColors(e=>this._handleThemeChange(e))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea())}_handleThemeChange(e){this._viewportElement.style.backgroundColor=e.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame(()=>this.syncScrollArea())}_refresh(e){if(e)return this._innerRefresh(),void(null!==this._refreshAnimationFrame&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));null===this._refreshAnimationFrame&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderService.dimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const e=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.css.canvas.height);this._lastRecordedBufferHeight!==e&&(this._lastRecordedBufferHeight=e,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const e=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==e&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=e),this._refreshAnimationFrame=null}syncScrollArea(e=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(e);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(e)}_handleScroll(e){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const t=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:t,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||-1===this._smoothScrollState.origin||-1===this._smoothScrollState.target)return;const e=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(e*(this._smoothScrollState.target-this._smoothScrollState.origin)),e<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(e,t){const s=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(t<0&&0!==this._viewportElement.scrollTop||t>0&&s<this._lastRecordedBufferHeight)||(e.cancelable&&e.preventDefault(),!1)}handleWheel(e){const t=this._getPixelsScrolled(e);return 0!==t&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,-1===this._smoothScrollState.target?this._smoothScrollState.target=this._viewportElement.scrollTop+t:this._smoothScrollState.target+=t,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=t,this._bubbleScroll(e,t))}scrollLines(e){if(0!==e)if(this._optionsService.rawOptions.smoothScrollDuration){const t=e*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+t,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:e,suppressScrollEvent:!1})}_getPixelsScrolled(e){if(0===e.deltaY||e.shiftKey)return 0;let t=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_LINE?t*=this._currentRowHeight:e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._currentRowHeight*this._bufferService.rows),t}getBufferElements(e,t){var s;let i,o="";const r=[],a=null!=t?t:this._bufferService.buffer.lines.length,n=this._bufferService.buffer.lines;for(let l=e;l<a;l++){const e=n.get(l);if(!e)continue;const t=null===(s=n.get(l+1))||void 0===s?void 0:s.isWrapped;if(o+=e.translateToString(!t),!t||l===n.length-1){const e=document.createElement("div");e.textContent=o,r.push(e),o.length>0&&(i=e),o=""}}return{bufferElements:r,cursorElement:i}}getLinesScrolled(e){if(0===e.deltaY||e.shiftKey)return 0;let t=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(t/=this._currentRowHeight+0,this._wheelPartialScroll+=t,t=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._bufferService.rows),t}_applyScrollModifier(e,t){const s=this._optionsService.rawOptions.fastScrollModifier;return"alt"===s&&t.altKey||"ctrl"===s&&t.ctrlKey||"shift"===s&&t.shiftKey?e*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:e*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(e){this._lastTouchY=e.touches[0].pageY}handleTouchMove(e){const t=this._lastTouchY-e.touches[0].pageY;return this._lastTouchY=e.touches[0].pageY,0!==t&&(this._viewportElement.scrollTop+=t,this._bubbleScroll(e,t))}};t.Viewport=d=i([o(2,c.IBufferService),o(3,c.IOptionsService),o(4,a.ICharSizeService),o(5,a.IRenderService),o(6,a.ICoreBrowserService),o(7,a.IThemeService)],d)},3107:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferDecorationRenderer=void 0;const r=s(3656),a=s(4725),n=s(844),l=s(2585);let c=t.BufferDecorationRenderer=class extends n.Disposable{constructor(e,t,s,i){super(),this._screenElement=e,this._bufferService=t,this._decorationService=s,this._renderService=i,this._decorationElements=/* @__PURE__ */new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register((0,r.addDisposableDomListener)(window,"resize",()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(e=>this._removeDecoration(e))),this.register((0,n.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){void 0===this._animationFrame&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(const e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){var t,s;const i=document.createElement("div");i.classList.add("xterm-decoration"),i.classList.toggle("xterm-decoration-top-layer","top"===(null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.layer)),i.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,i.style.height=(e.options.height||1)*this._renderService.dimensions.css.cell.height+"px",i.style.top=(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",i.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const o=null!==(s=e.options.x)&&void 0!==s?s:0;return o&&o>this._bufferService.cols&&(i.style.display="none"),this._refreshXPosition(e,i),i}_refreshStyle(e){const t=e.marker.line-this._bufferService.buffers.active.ydisp;if(t<0||t>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let s=this._decorationElements.get(e);s||(s=this._createElement(e),e.element=s,this._decorationElements.set(e,s),this._container.appendChild(s),e.onDispose(()=>{this._decorationElements.delete(e),s.remove()})),s.style.top=t*this._renderService.dimensions.css.cell.height+"px",s.style.display=this._altBufferIsActive?"none":"block",e.onRenderEmitter.fire(s)}}_refreshXPosition(e,t=e.element){var s;if(!t)return;const i=null!==(s=e.options.x)&&void 0!==s?s:0;"right"===(e.options.anchor||"left")?t.style.right=i?i*this._renderService.dimensions.css.cell.width+"px":"":t.style.left=i?i*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(e){var t;null===(t=this._decorationElements.get(e))||void 0===t||t.remove(),this._decorationElements.delete(e),e.dispose()}};t.BufferDecorationRenderer=c=i([o(1,l.IBufferService),o(2,l.IDecorationService),o(3,a.IRenderService)],c)},5871:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorZoneStore=void 0,t.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(e){if(e.options.overviewRulerOptions){for(const t of this._zones)if(t.color===e.options.overviewRulerOptions.color&&t.position===e.options.overviewRulerOptions.position){if(this._lineIntersectsZone(t,e.marker.line))return;if(this._lineAdjacentToZone(t,e.marker.line,e.options.overviewRulerOptions.position))return void this._addLineToZone(t,e.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=e.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=e.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=e.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=e.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:e.options.overviewRulerOptions.color,position:e.options.overviewRulerOptions.position,startBufferLine:e.marker.line,endBufferLine:e.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(e){this._linePadding=e}_lineIntersectsZone(e,t){return t>=e.startBufferLine&&t<=e.endBufferLine}_lineAdjacentToZone(e,t,s){return t>=e.startBufferLine-this._linePadding[s||"full"]&&t<=e.endBufferLine+this._linePadding[s||"full"]}_addLineToZone(e,t){e.startBufferLine=Math.min(e.startBufferLine,t),e.endBufferLine=Math.max(e.endBufferLine,t)}}},5744:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OverviewRulerRenderer=void 0;const r=s(5871),a=s(3656),n=s(4725),l=s(844),c=s(2585),d={full:0,left:0,center:0,right:0},h={full:0,left:0,center:0,right:0},u={full:0,left:0,center:0,right:0};let p=t.OverviewRulerRenderer=class extends l.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(e,t,s,i,o,a,n){var c;super(),this._viewportElement=e,this._screenElement=t,this._bufferService=s,this._decorationService=i,this._renderService=o,this._optionsService=a,this._coreBrowseService=n,this._colorZoneStore=new r.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),null===(c=this._viewportElement.parentElement)||void 0===c||c.insertBefore(this._canvas,this._viewportElement);const d=this._canvas.getContext("2d");if(!d)throw new Error("Ctx cannot be null");this._ctx=d,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,l.toDisposable)(()=>{var e;null===(e=this._canvas)||void 0===e||e.remove()}))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register((0,a.addDisposableDomListener)(this._coreBrowseService.window,"resize",()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){const e=Math.floor(this._canvas.width/3),t=Math.ceil(this._canvas.width/3);h.full=this._canvas.width,h.left=e,h.center=t,h.right=e,this._refreshDrawHeightConstants(),u.full=0,u.left=0,u.center=h.left,u.right=h.left+h.center}_refreshDrawHeightConstants(){d.full=Math.round(2*this._coreBrowseService.dpr);const e=this._canvas.height/this._bufferService.buffer.lines.length,t=Math.round(Math.max(Math.min(e,12),6)*this._coreBrowseService.dpr);d.left=t,d.center=t,d.right=t}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*d.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*d.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*d.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*d.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowseService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowseService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const t of this._decorationService.decorations)this._colorZoneStore.addDecoration(t);this._ctx.lineWidth=1;const e=this._colorZoneStore.zones;for(const t of e)"full"!==t.position&&this._renderColorZone(t);for(const t of e)"full"===t.position&&this._renderColorZone(t);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(e){this._ctx.fillStyle=e.color,this._ctx.fillRect(u[e.position||"full"],Math.round((this._canvas.height-1)*(e.startBufferLine/this._bufferService.buffers.active.lines.length)-d[e.position||"full"]/2),h[e.position||"full"],Math.round((this._canvas.height-1)*((e.endBufferLine-e.startBufferLine)/this._bufferService.buffers.active.lines.length)+d[e.position||"full"]))}_queueRefresh(e,t){this._shouldUpdateDimensions=e||this._shouldUpdateDimensions,this._shouldUpdateAnchor=t||this._shouldUpdateAnchor,void 0===this._animationFrame&&(this._animationFrame=this._coreBrowseService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};t.OverviewRulerRenderer=p=i([o(2,c.IBufferService),o(3,c.IDecorationService),o(4,n.IRenderService),o(5,c.IOptionsService),o(6,n.ICoreBrowserService)],p)},2950:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CompositionHelper=void 0;const r=s(4725),a=s(2585),n=s(2584);let l=t.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(e,t,s,i,o,r){this._textarea=e,this._compositionView=t,this._bufferService=s,this._optionsService=i,this._coreService=o,this._renderService=r,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(e){this._compositionView.textContent=e.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(e){if(this._isComposing||this._isSendingComposition){if(229===e.keyCode)return!1;if(16===e.keyCode||17===e.keyCode||18===e.keyCode)return!1;this._finalizeComposition(!1)}return 229!==e.keyCode||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(e){if(this._compositionView.classList.remove("active"),this._isComposing=!1,e){const e={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let t;this._isSendingComposition=!1,e.start+=this._dataAlreadySent.length,t=this._isComposing?this._textarea.value.substring(e.start,e.end):this._textarea.value.substring(e.start),t.length>0&&this._coreService.triggerDataEvent(t,!0)}},0)}else{this._isSendingComposition=!1;const e=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(e,!0)}}_handleAnyTextareaChanges(){const e=this._textarea.value;setTimeout(()=>{if(!this._isComposing){const t=this._textarea.value,s=t.replace(e,"");this._dataAlreadySent=s,t.length>e.length?this._coreService.triggerDataEvent(s,!0):t.length<e.length?this._coreService.triggerDataEvent(`${n.C0.DEL}`,!0):t.length===e.length&&t!==e&&this._coreService.triggerDataEvent(t,!0)}},0)}updateCompositionElements(e){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const e=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),t=this._renderService.dimensions.css.cell.height,s=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,i=e*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=i+"px",this._compositionView.style.top=s+"px",this._compositionView.style.height=t+"px",this._compositionView.style.lineHeight=t+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const o=this._compositionView.getBoundingClientRect();this._textarea.style.left=i+"px",this._textarea.style.top=s+"px",this._textarea.style.width=Math.max(o.width,1)+"px",this._textarea.style.height=Math.max(o.height,1)+"px",this._textarea.style.lineHeight=o.height+"px"}e||setTimeout(()=>this.updateCompositionElements(!0),0)}}};t.CompositionHelper=l=i([o(2,a.IBufferService),o(3,a.IOptionsService),o(4,a.ICoreService),o(5,r.IRenderService)],l)},9806:(e,t)=>{function s(e,t,s){const i=s.getBoundingClientRect(),o=e.getComputedStyle(s),r=parseInt(o.getPropertyValue("padding-left")),a=parseInt(o.getPropertyValue("padding-top"));return[t.clientX-i.left-r,t.clientY-i.top-a]}Object.defineProperty(t,"__esModule",{value:!0}),t.getCoords=t.getCoordsRelativeToElement=void 0,t.getCoordsRelativeToElement=s,t.getCoords=function(e,t,i,o,r,a,n,l,c){if(!a)return;const d=s(e,t,i);return d?(d[0]=Math.ceil((d[0]+(c?n/2:0))/n),d[1]=Math.ceil(d[1]/l),d[0]=Math.min(Math.max(d[0],1),o+(c?1:0)),d[1]=Math.min(Math.max(d[1],1),r),d):void 0}},9504:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.moveToCellSequence=void 0;const i=s(2584);function o(e,t,s,i){const o=e-r(e,s),n=t-r(t,s);return c(Math.abs(o-n)-function(e,t,s){let i=0;const o=e-r(e,s),n=t-r(t,s);for(let r=0;r<Math.abs(o-n);r++){const n="A"===a(e,t)?-1:1,l=s.buffer.lines.get(o+n*r);(null==l?void 0:l.isWrapped)&&i++}return i}(e,t,s),l(a(e,t),i))}function r(e,t){let s=0,i=t.buffer.lines.get(e),o=null==i?void 0:i.isWrapped;for(;o&&e>=0&&e<t.rows;)s++,i=t.buffer.lines.get(--e),o=null==i?void 0:i.isWrapped;return s}function a(e,t){return e>t?"A":"B"}function n(e,t,s,i,o,r){let a=e,n=t,l="";for(;a!==s||n!==i;)a+=o?1:-1,o&&a>r.cols-1?(l+=r.buffer.translateBufferLineToString(n,!1,e,a),a=0,e=0,n++):!o&&a<0&&(l+=r.buffer.translateBufferLineToString(n,!1,0,e+1),a=r.cols-1,e=a,n--);return l+r.buffer.translateBufferLineToString(n,!1,e,a)}function l(e,t){const s=t?"O":"[";return i.C0.ESC+s+e}function c(e,t){e=Math.floor(e);let s="";for(let i=0;i<e;i++)s+=t;return s}t.moveToCellSequence=function(e,t,s,i){const a=s.buffer.x,d=s.buffer.y;if(!s.buffer.hasScrollback)return h=a,(0===o(u=d,t,p=s,g=i).length?"":c(n(h,u,h,u-r(u,p),!1,p).length,l("D",g)))+o(d,t,s,i)+function(e,t,s,i,a,d){let h;h=o(t,i,a,d).length>0?i-r(i,a):t;const u=i,p=function(e,t,s,i,a,n){let l;return l=o(s,i,a,n).length>0?i-r(i,a):t,e<s&&l<=i||e>=s&&l<i?"C":"D"}(e,t,s,i,a,d);return c(n(e,h,s,u,"C"===p,a).length,l(p,d))}(a,d,e,t,s,i);var h,u,p,g;let m;if(d===t)return m=a>e?"D":"C",c(Math.abs(a-e),l(m,i));m=d>t?"D":"C";const f=Math.abs(d-t);return c(function(e,t){return t.cols-e}(d>t?e:a,s)+(f-1)*s.cols+1+((d>t?a:e)-1),l(m,i))}},1296:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRenderer=void 0;const r=s(3787),a=s(2550),n=s(2223),l=s(6171),c=s(4725),d=s(8055),h=s(8460),u=s(844),p=s(2585),g="xterm-dom-renderer-owner-",m="xterm-rows",f="xterm-fg-",v="xterm-bg-",b="xterm-focus",y="xterm-selection";let w=1,x=t.DomRenderer=class extends u.Disposable{constructor(e,t,s,i,o,n,c,d,p,f){super(),this._element=e,this._screenElement=t,this._viewportElement=s,this._linkifier2=i,this._charSizeService=n,this._optionsService=c,this._bufferService=d,this._coreBrowserService=p,this._themeService=f,this._terminalClass=w++,this._rowElements=[],this.onRequestRedraw=this.register(new h.EventEmitter).event,this._rowContainer=document.createElement("div"),this._rowContainer.classList.add(m),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=document.createElement("div"),this._selectionContainer.classList.add(y),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,l.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._themeService.onChangeColors(e=>this._injectCss(e))),this._injectCss(this._themeService.colors),this._rowFactory=o.createInstance(r.DomRendererRowFactory,document),this._element.classList.add(g+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(e=>this._handleLinkHover(e))),this.register(this._linkifier2.onHideLinkUnderline(e=>this._handleLinkLeave(e))),this.register((0,u.toDisposable)(()=>{this._element.classList.remove(g+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new a.WidthCache(document),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const e=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*e,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*e),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/e),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/e),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const s of this._rowElements)s.style.width=`${this.dimensions.css.canvas.width}px`,s.style.height=`${this.dimensions.css.cell.height}px`,s.style.lineHeight=`${this.dimensions.css.cell.height}px`,s.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const t=`${this._terminalSelector} .${m} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=t,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(e){this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let t=`${this._terminalSelector} .${m} { color: ${e.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;t+=`${this._terminalSelector} .${m} .xterm-dim { color: ${d.color.multiplyOpacity(e.foreground,.5).css};}`,t+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`,t+="@keyframes blink_box_shadow_"+this._terminalClass+" { 50% {  border-bottom-style: hidden; }}",t+="@keyframes blink_block_"+this._terminalClass+` { 0% {  background-color: ${e.cursor.css};  color: ${e.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${e.cursor.css}; }}`,t+=`${this._terminalSelector} .${m}.${b} .xterm-cursor.xterm-cursor-blink:not(.xterm-cursor-block) { animation: blink_box_shadow_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .${m}.${b} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: blink_block_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .${m} .xterm-cursor.xterm-cursor-block { background-color: ${e.cursor.css}; color: ${e.cursorAccent.css};}${this._terminalSelector} .${m} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${e.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${m} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${e.cursor.css} inset;}${this._terminalSelector} .${m} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${e.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,t+=`${this._terminalSelector} .${y} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${y} div { position: absolute; background-color: ${e.selectionBackgroundOpaque.css};}${this._terminalSelector} .${y} div { position: absolute; background-color: ${e.selectionInactiveBackgroundOpaque.css};}`;for(const[s,i]of e.ansi.entries())t+=`${this._terminalSelector} .${f}${s} { color: ${i.css}; }${this._terminalSelector} .${f}${s}.xterm-dim { color: ${d.color.multiplyOpacity(i,.5).css}; }${this._terminalSelector} .${v}${s} { background-color: ${i.css}; }`;t+=`${this._terminalSelector} .${f}${n.INVERTED_DEFAULT_COLOR} { color: ${d.color.opaque(e.background).css}; }${this._terminalSelector} .${f}${n.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${d.color.multiplyOpacity(d.color.opaque(e.background),.5).css}; }${this._terminalSelector} .${v}${n.INVERTED_DEFAULT_COLOR} { background-color: ${e.foreground.css}; }`,this._themeStyleElement.textContent=t}_setDefaultSpacing(){const e=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${e}px`,this._rowFactory.defaultSpacing=e}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(e,t){for(let s=this._rowElements.length;s<=t;s++){const e=document.createElement("div");this._rowContainer.appendChild(e),this._rowElements.push(e)}for(;this._rowElements.length>t;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(e,t){this._refreshRowElements(e,t),this._updateDimensions()}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(b)}handleFocus(){this._rowContainer.classList.add(b),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(e,t,s){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(e,t,s),this.renderRows(0,this._bufferService.rows-1),!e||!t)return;const i=e[1]-this._bufferService.buffer.ydisp,o=t[1]-this._bufferService.buffer.ydisp,r=Math.max(i,0),a=Math.min(o,this._bufferService.rows-1);if(r>=this._bufferService.rows||a<0)return;const n=document.createDocumentFragment();if(s){const s=e[0]>t[0];n.appendChild(this._createSelectionElement(r,s?t[0]:e[0],s?e[0]:t[0],a-r+1))}else{const s=i===r?e[0]:0,l=r===o?t[0]:this._bufferService.cols;n.appendChild(this._createSelectionElement(r,s,l));const c=a-r-1;if(n.appendChild(this._createSelectionElement(r+1,0,this._bufferService.cols,c)),r!==a){const e=o===a?t[0]:this._bufferService.cols;n.appendChild(this._createSelectionElement(a,0,e))}}this._selectionContainer.appendChild(n)}_createSelectionElement(e,t,s,i=1){const o=document.createElement("div");return o.style.height=i*this.dimensions.css.cell.height+"px",o.style.top=e*this.dimensions.css.cell.height+"px",o.style.left=t*this.dimensions.css.cell.width+"px",o.style.width=this.dimensions.css.cell.width*(s-t)+"px",o}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const e of this._rowElements)e.replaceChildren()}renderRows(e,t){const s=this._bufferService.buffer,i=s.ybase+s.y,o=Math.min(s.x,this._bufferService.cols-1),r=this._optionsService.rawOptions.cursorBlink,a=this._optionsService.rawOptions.cursorStyle,n=this._optionsService.rawOptions.cursorInactiveStyle;for(let l=e;l<=t;l++){const e=l+s.ydisp,t=this._rowElements[l],c=s.lines.get(e);if(!t||!c)break;t.replaceChildren(...this._rowFactory.createRow(c,e,e===i,a,n,o,r,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${g}${this._terminalClass}`}_handleLinkHover(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!0)}_handleLinkLeave(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!1)}_setCellUnderline(e,t,s,i,o,r){s<0&&(e=0),i<0&&(t=0);const a=this._bufferService.rows-1;s=Math.max(Math.min(s,a),0),i=Math.max(Math.min(i,a),0),o=Math.min(o,this._bufferService.cols);const n=this._bufferService.buffer,l=n.ybase+n.y,c=Math.min(n.x,o-1),d=this._optionsService.rawOptions.cursorBlink,h=this._optionsService.rawOptions.cursorStyle,u=this._optionsService.rawOptions.cursorInactiveStyle;for(let p=s;p<=i;++p){const a=p+n.ydisp,g=this._rowElements[p],m=n.lines.get(a);if(!g||!m)break;g.replaceChildren(...this._rowFactory.createRow(m,a,a===l,h,u,c,d,this.dimensions.css.cell.width,this._widthCache,r?p===s?e:0:-1,r?(p===i?t:o)-1:-1))}}};t.DomRenderer=x=i([o(4,p.IInstantiationService),o(5,c.ICharSizeService),o(6,p.IOptionsService),o(7,p.IBufferService),o(8,c.ICoreBrowserService),o(9,c.IThemeService)],x)},3787:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRendererRowFactory=void 0;const r=s(2223),a=s(643),n=s(511),l=s(2585),c=s(8055),d=s(4725),h=s(4269),u=s(6171),p=s(3734);let g=t.DomRendererRowFactory=class{constructor(e,t,s,i,o,r,a){this._document=e,this._characterJoinerService=t,this._optionsService=s,this._coreBrowserService=i,this._coreService=o,this._decorationService=r,this._themeService=a,this._workCell=new n.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(e,t,s){this._selectionStart=e,this._selectionEnd=t,this._columnSelectMode=s}createRow(e,t,s,i,o,n,l,d,u,g,f){const v=[],b=this._characterJoinerService.getJoinedCharacters(t),y=this._themeService.colors;let w,x=e.getNoBgTrimmedLength();s&&x<n+1&&(x=n+1);let _=0,k="",S=0,C=0,$=0,D=!1,E=0,M=!1,A=0;const I=[],T=-1!==g&&-1!==f;for(let P=0;P<x;P++){e.loadCell(P,this._workCell);let x=this._workCell.getWidth();if(0===x)continue;let L=!1,R=P,O=this._workCell;if(b.length>0&&P===b[0][0]){L=!0;const t=b.shift();O=new h.JoinedCellData(this._workCell,e.translateToString(!0,t[0],t[1]),t[1]-t[0]),R=t[1]-1,x=O.getWidth()}const N=this._isCellInSelection(P,t),B=s&&P===n,F=T&&P>=g&&P<=f;let z=!1;this._decorationService.forEachDecorationAtCell(P,t,void 0,e=>{z=!0});let U=O.getChars()||a.WHITESPACE_CELL_CHAR;if(" "===U&&(O.isUnderline()||O.isOverline())&&(U="Â "),A=x*d-u.get(U,O.isBold(),O.isItalic()),w){if(_&&(N&&M||!N&&!M&&O.bg===S)&&(N&&M&&y.selectionForeground||O.fg===C)&&O.extended.ext===$&&F===D&&A===E&&!B&&!L&&!z){k+=U,_++;continue}_&&(w.textContent=k),w=this._document.createElement("span"),_=0,k=""}else w=this._document.createElement("span");if(S=O.bg,C=O.fg,$=O.extended.ext,D=F,E=A,M=N,L&&n>=P&&n<=R&&(n=P),!this._coreService.isCursorHidden&&B)if(I.push("xterm-cursor"),this._coreBrowserService.isFocused)l&&I.push("xterm-cursor-blink"),I.push("bar"===i?"xterm-cursor-bar":"underline"===i?"xterm-cursor-underline":"xterm-cursor-block");else if(o)switch(o){case"outline":I.push("xterm-cursor-outline");break;case"block":I.push("xterm-cursor-block");break;case"bar":I.push("xterm-cursor-bar");break;case"underline":I.push("xterm-cursor-underline")}if(O.isBold()&&I.push("xterm-bold"),O.isItalic()&&I.push("xterm-italic"),O.isDim()&&I.push("xterm-dim"),k=O.isInvisible()?a.WHITESPACE_CELL_CHAR:O.getChars()||a.WHITESPACE_CELL_CHAR,O.isUnderline()&&(I.push(`xterm-underline-${O.extended.underlineStyle}`)," "===k&&(k="Â "),!O.isUnderlineColorDefault()))if(O.isUnderlineColorRGB())w.style.textDecorationColor=`rgb(${p.AttributeData.toColorRGB(O.getUnderlineColor()).join(",")})`;else{let e=O.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&O.isBold()&&e<8&&(e+=8),w.style.textDecorationColor=y.ansi[e].css}O.isOverline()&&(I.push("xterm-overline")," "===k&&(k="Â ")),O.isStrikethrough()&&I.push("xterm-strikethrough"),F&&(w.style.textDecoration="underline");let V=O.getFgColor(),j=O.getFgColorMode(),H=O.getBgColor(),W=O.getBgColorMode();const q=!!O.isInverse();if(q){const e=V;V=H,H=e;const t=j;j=W,W=t}let K,G,Q,J=!1;switch(this._decorationService.forEachDecorationAtCell(P,t,void 0,e=>{"top"!==e.options.layer&&J||(e.backgroundColorRGB&&(W=50331648,H=e.backgroundColorRGB.rgba>>8&16777215,K=e.backgroundColorRGB),e.foregroundColorRGB&&(j=50331648,V=e.foregroundColorRGB.rgba>>8&16777215,G=e.foregroundColorRGB),J="top"===e.options.layer)}),!J&&N&&(K=this._coreBrowserService.isFocused?y.selectionBackgroundOpaque:y.selectionInactiveBackgroundOpaque,H=K.rgba>>8&16777215,W=50331648,J=!0,y.selectionForeground&&(j=50331648,V=y.selectionForeground.rgba>>8&16777215,G=y.selectionForeground)),J&&I.push("xterm-decoration-top"),W){case 16777216:case 33554432:Q=y.ansi[H],I.push(`xterm-bg-${H}`);break;case 50331648:Q=c.rgba.toColor(H>>16,H>>8&255,255&H),this._addStyle(w,`background-color:#${m((H>>>0).toString(16),"0",6)}`);break;default:q?(Q=y.foreground,I.push(`xterm-bg-${r.INVERTED_DEFAULT_COLOR}`)):Q=y.background}switch(K||O.isDim()&&(K=c.color.multiplyOpacity(Q,.5)),j){case 16777216:case 33554432:O.isBold()&&V<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(V+=8),this._applyMinimumContrast(w,Q,y.ansi[V],O,K,void 0)||I.push(`xterm-fg-${V}`);break;case 50331648:const e=c.rgba.toColor(V>>16&255,V>>8&255,255&V);this._applyMinimumContrast(w,Q,e,O,K,G)||this._addStyle(w,`color:#${m(V.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(w,Q,y.foreground,O,K,void 0)||q&&I.push(`xterm-fg-${r.INVERTED_DEFAULT_COLOR}`)}I.length&&(w.className=I.join(" "),I.length=0),B||L||z?w.textContent=k:_++,A!==this.defaultSpacing&&(w.style.letterSpacing=`${A}px`),v.push(w),P=R}return w&&_&&(w.textContent=k),v}_applyMinimumContrast(e,t,s,i,o,r){if(1===this._optionsService.rawOptions.minimumContrastRatio||(0,u.excludeFromContrastRatioDemands)(i.getCode()))return!1;const a=this._getContrastCache(i);let n;if(o||r||(n=a.getColor(t.rgba,s.rgba)),void 0===n){const e=this._optionsService.rawOptions.minimumContrastRatio/(i.isDim()?2:1);n=c.color.ensureContrastRatio(o||t,r||s,e),a.setColor((o||t).rgba,(r||s).rgba,null!=n?n:null)}return!!n&&(this._addStyle(e,`color:${n.css}`),!0)}_getContrastCache(e){return e.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(e,t){e.setAttribute("style",`${e.getAttribute("style")||""}${t};`)}_isCellInSelection(e,t){const s=this._selectionStart,i=this._selectionEnd;return!(!s||!i)&&(this._columnSelectMode?s[0]<=i[0]?e>=s[0]&&t>=s[1]&&e<i[0]&&t<=i[1]:e<s[0]&&t>=s[1]&&e>=i[0]&&t<=i[1]:t>s[1]&&t<i[1]||s[1]===i[1]&&t===s[1]&&e>=s[0]&&e<i[0]||s[1]<i[1]&&t===i[1]&&e<i[0]||s[1]<i[1]&&t===s[1]&&e>=s[0])}};function m(e,t,s){for(;e.length<s;)e=t+e;return e}t.DomRendererRowFactory=g=i([o(1,d.ICharacterJoinerService),o(2,l.IOptionsService),o(3,d.ICoreBrowserService),o(4,l.ICoreService),o(5,l.IDecorationService),o(6,d.IThemeService)],g)},2550:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WidthCache=void 0,t.WidthCache=class{constructor(e){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=e.createElement("div"),this._container.style.position="absolute",this._container.style.top="-50000px",this._container.style.width="50000px",this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const t=e.createElement("span"),s=e.createElement("span");s.style.fontWeight="bold";const i=e.createElement("span");i.style.fontStyle="italic";const o=e.createElement("span");o.style.fontWeight="bold",o.style.fontStyle="italic",this._measureElements=[t,s,i,o],this._container.appendChild(t),this._container.appendChild(s),this._container.appendChild(i),this._container.appendChild(o),e.body.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=/* @__PURE__ */new Map}setFont(e,t,s,i){e===this._font&&t===this._fontSize&&s===this._weight&&i===this._weightBold||(this._font=e,this._fontSize=t,this._weight=s,this._weightBold=i,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${s}`,this._measureElements[1].style.fontWeight=`${i}`,this._measureElements[2].style.fontWeight=`${s}`,this._measureElements[3].style.fontWeight=`${i}`,this.clear())}get(e,t,s){let i=0;if(!t&&!s&&1===e.length&&(i=e.charCodeAt(0))<256)return-9999!==this._flat[i]?this._flat[i]:this._flat[i]=this._measure(e,0);let o=e;t&&(o+="B"),s&&(o+="I");let r=this._holey.get(o);if(void 0===r){let i=0;t&&(i|=1),s&&(i|=2),r=this._measure(e,i),this._holey.set(o,r)}return r}_measure(e,t){const s=this._measureElements[t];return s.textContent=e.repeat(32),s.offsetWidth/32}}},2223:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT_BASELINE=t.DIM_OPACITY=t.INVERTED_DEFAULT_COLOR=void 0;const i=s(6114);t.INVERTED_DEFAULT_COLOR=257,t.DIM_OPACITY=.5,t.TEXT_BASELINE=i.isFirefox||i.isLegacyEdge?"bottom":"ideographic"},6171:(e,t)=>{function s(e){return 57508<=e&&e<=57558}Object.defineProperty(t,"__esModule",{value:!0}),t.createRenderDimensions=t.excludeFromContrastRatioDemands=t.isRestrictedPowerlineGlyph=t.isPowerlineGlyph=t.throwIfFalsy=void 0,t.throwIfFalsy=function(e){if(!e)throw new Error("value must not be falsy");return e},t.isPowerlineGlyph=s,t.isRestrictedPowerlineGlyph=function(e){return 57520<=e&&e<=57527},t.excludeFromContrastRatioDemands=function(e){return s(e)||9472<=(t=e)&&t<=9631;var t},t.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},456:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionModel=void 0,t.SelectionModel=class{constructor(e){this._bufferService=e,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?e%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)-1]:[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[e,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[Math.max(e,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const e=this.selectionStart,t=this.selectionEnd;return!(!e||!t)&&(e[1]>t[1]||e[1]===t[1]&&e[0]>t[0])}handleTrim(e){return this.selectionStart&&(this.selectionStart[1]-=e),this.selectionEnd&&(this.selectionEnd[1]-=e),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharSizeService=void 0;const r=s(2585),a=s(8460),n=s(844);let l=t.CharSizeService=class extends n.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(e,t,s){super(),this._optionsService=s,this.width=0,this.height=0,this._onCharSizeChange=this.register(new a.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event,this._measureStrategy=new c(e,t,this._optionsService),this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}measure(){const e=this._measureStrategy.measure();e.width===this.width&&e.height===this.height||(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};t.CharSizeService=l=i([o(2,r.IOptionsService)],l);class c{constructor(e,t,s){this._document=e,this._parentElement=t,this._optionsService=s,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`;const e={height:Number(this._measureElement.offsetHeight),width:Number(this._measureElement.offsetWidth)};return 0!==e.width&&0!==e.height&&(this._result.width=e.width/32,this._result.height=Math.ceil(e.height)),this._result}}},4269:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterJoinerService=t.JoinedCellData=void 0;const r=s(3734),a=s(643),n=s(511),l=s(2585);class c extends r.AttributeData{constructor(e,t,s){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=t,this._width=s}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.JoinedCellData=c;let d=t.CharacterJoinerService=class e{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new n.CellData}register(e){const t={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(t),t.id}deregister(e){for(let t=0;t<this._characterJoiners.length;t++)if(this._characterJoiners[t].id===e)return this._characterJoiners.splice(t,1),!0;return!1}getJoinedCharacters(e){if(0===this._characterJoiners.length)return[];const t=this._bufferService.buffer.lines.get(e);if(!t||0===t.length)return[];const s=[],i=t.translateToString(!0);let o=0,r=0,n=0,l=t.getFg(0),c=t.getBg(0);for(let d=0;d<t.getTrimmedLength();d++)if(t.loadCell(d,this._workCell),0!==this._workCell.getWidth()){if(this._workCell.fg!==l||this._workCell.bg!==c){if(d-o>1){const e=this._getJoinedRanges(i,n,r,t,o);for(let t=0;t<e.length;t++)s.push(e[t])}o=d,n=r,l=this._workCell.fg,c=this._workCell.bg}r+=this._workCell.getChars().length||a.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-o>1){const e=this._getJoinedRanges(i,n,r,t,o);for(let t=0;t<e.length;t++)s.push(e[t])}return s}_getJoinedRanges(t,s,i,o,r){const a=t.substring(s,i);let n=[];try{n=this._characterJoiners[0].handler(a)}catch(l){console.error(l)}for(let c=1;c<this._characterJoiners.length;c++)try{const t=this._characterJoiners[c].handler(a);for(let s=0;s<t.length;s++)e._mergeRanges(n,t[s])}catch(l){console.error(l)}return this._stringRangesToCellRanges(n,o,r),n}_stringRangesToCellRanges(e,t,s){let i=0,o=!1,r=0,n=e[i];if(n){for(let l=s;l<this._bufferService.cols;l++){const s=t.getWidth(l),c=t.getString(l).length||a.WHITESPACE_CELL_CHAR.length;if(0!==s){if(!o&&n[0]<=r&&(n[0]=l,o=!0),n[1]<=r){if(n[1]=l,n=e[++i],!n)break;n[0]<=r?(n[0]=l,o=!0):o=!1}r+=c}}n&&(n[1]=this._bufferService.cols)}}static _mergeRanges(e,t){let s=!1;for(let i=0;i<e.length;i++){const o=e[i];if(s){if(t[1]<=o[0])return e[i-1][1]=t[1],e;if(t[1]<=o[1])return e[i-1][1]=Math.max(t[1],o[1]),e.splice(i,1),e;e.splice(i,1),i--}else{if(t[1]<=o[0])return e.splice(i,0,t),e;if(t[1]<=o[1])return o[0]=Math.min(t[0],o[0]),e;t[0]<o[1]&&(o[0]=Math.min(t[0],o[0]),s=!0)}}return s?e[e.length-1][1]=t[1]:e.push(t),e}};t.CharacterJoinerService=d=i([o(0,l.IBufferService)],d)},5114:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreBrowserService=void 0,t.CoreBrowserService=class{constructor(e,t){this._textarea=e,this.window=t,this._isFocused=!1,this._cachedIsFocused=void 0,this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get dpr(){return this.window.devicePixelRatio}get isFocused(){return void 0===this._cachedIsFocused&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}},8934:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MouseService=void 0;const r=s(4725),a=s(9806);let n=t.MouseService=class{constructor(e,t){this._renderService=e,this._charSizeService=t}getCoords(e,t,s,i,o){return(0,a.getCoords)(window,e,t,s,i,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,o)}getMouseReportCoords(e,t){const s=(0,a.getCoordsRelativeToElement)(window,e,t);if(this._charSizeService.hasValidSize)return s[0]=Math.min(Math.max(s[0],0),this._renderService.dimensions.css.canvas.width-1),s[1]=Math.min(Math.max(s[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(s[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(s[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(s[0]),y:Math.floor(s[1])}}};t.MouseService=n=i([o(0,r.IRenderService),o(1,r.ICharSizeService)],n)},3230:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderService=void 0;const r=s(3656),a=s(6193),n=s(5596),l=s(4725),c=s(8460),d=s(844),h=s(7226),u=s(2585);let p=t.RenderService=class extends d.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(e,t,s,i,o,l,u,p){if(super(),this._rowCount=e,this._charSizeService=i,this._renderer=this.register(new d.MutableDisposable),this._pausedResizeTask=new h.DebouncedIdleTask,this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new c.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new c.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new c.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new c.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new a.RenderDebouncer(u.window,(e,t)=>this._renderRows(e,t)),this.register(this._renderDebouncer),this._screenDprMonitor=new n.ScreenDprMonitor(u.window),this._screenDprMonitor.setListener(()=>this.handleDevicePixelRatioChange()),this.register(this._screenDprMonitor),this.register(l.onResize(()=>this._fullRefresh())),this.register(l.buffers.onBufferActivate(()=>{var e;return null===(e=this._renderer.value)||void 0===e?void 0:e.clear()})),this.register(s.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(o.onDecorationRegistered(()=>this._fullRefresh())),this.register(o.onDecorationRemoved(()=>this._fullRefresh())),this.register(s.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio"],()=>{this.clear(),this.handleResize(l.cols,l.rows),this._fullRefresh()})),this.register(s.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(l.buffer.y,l.buffer.y,!0))),this.register((0,r.addDisposableDomListener)(u.window,"resize",()=>this.handleDevicePixelRatioChange())),this.register(p.onChangeColors(()=>this._fullRefresh())),"IntersectionObserver"in u.window){const e=new u.window.IntersectionObserver(e=>this._handleIntersectionChange(e[e.length-1]),{threshold:0});e.observe(t),this.register({dispose:()=>e.disconnect()})}}_handleIntersectionChange(e){this._isPaused=void 0===e.isIntersecting?0===e.intersectionRatio:!e.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(e,t,s=!1){this._isPaused?this._needsFullRefresh=!0:(s||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,t,this._rowCount))}_renderRows(e,t){this._renderer.value&&(e=Math.min(e,this._rowCount-1),t=Math.min(t,this._rowCount-1),this._renderer.value.renderRows(e,t),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:t}),this._onRender.fire({start:e,end:t}),this._isNextRenderRedrawOnly=!0)}resize(e,t){this._rowCount=t,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(e){this._renderer.value=e,this._renderer.value.onRequestRedraw(e=>this.refreshRows(e.start,e.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh()}addRefreshCallback(e){return this._renderDebouncer.addRefreshCallback(e)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var e,t;this._renderer.value&&(null===(t=(e=this._renderer.value).clearTextureAtlas)||void 0===t||t.call(e),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(e,t){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value.handleResize(e,t)):this._renderer.value.handleResize(e,t),this._fullRefresh())}handleCharSizeChanged(){var e;null===(e=this._renderer.value)||void 0===e||e.handleCharSizeChanged()}handleBlur(){var e;null===(e=this._renderer.value)||void 0===e||e.handleBlur()}handleFocus(){var e;null===(e=this._renderer.value)||void 0===e||e.handleFocus()}handleSelectionChanged(e,t,s){var i;this._selectionState.start=e,this._selectionState.end=t,this._selectionState.columnSelectMode=s,null===(i=this._renderer.value)||void 0===i||i.handleSelectionChanged(e,t,s)}handleCursorMove(){var e;null===(e=this._renderer.value)||void 0===e||e.handleCursorMove()}clear(){var e;null===(e=this._renderer.value)||void 0===e||e.clear()}};t.RenderService=p=i([o(2,u.IOptionsService),o(3,l.ICharSizeService),o(4,u.IDecorationService),o(5,u.IBufferService),o(6,l.ICoreBrowserService),o(7,l.IThemeService)],p)},9312:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionService=void 0;const r=s(9806),a=s(9504),n=s(456),l=s(4725),c=s(8460),d=s(844),h=s(6114),u=s(4841),p=s(511),g=s(2585),m=String.fromCharCode(160),f=new RegExp(m,"g");let v=t.SelectionService=class extends d.Disposable{constructor(e,t,s,i,o,r,a,l,h){super(),this._element=e,this._screenElement=t,this._linkifier=s,this._bufferService=i,this._coreService=o,this._mouseService=r,this._optionsService=a,this._renderService=l,this._coreBrowserService=h,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new p.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new c.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new c.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new c.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new c.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=e=>this._handleMouseMove(e),this._mouseUpListener=e=>this._handleMouseUp(e),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(e=>this._handleTrim(e)),this.register(this._bufferService.buffers.onBufferActivate(e=>this._handleBufferActivate(e))),this.enable(),this._model=new n.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,d.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;return!(!e||!t||e[0]===t[0]&&e[1]===t[1])}get selectionText(){const e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;if(!e||!t)return"";const s=this._bufferService.buffer,i=[];if(3===this._activeSelectionMode){if(e[0]===t[0])return"";const o=e[0]<t[0]?e[0]:t[0],r=e[0]<t[0]?t[0]:e[0];for(let a=e[1];a<=t[1];a++){const e=s.translateBufferLineToString(a,!0,o,r);i.push(e)}}else{const o=e[1]===t[1]?t[0]:void 0;i.push(s.translateBufferLineToString(e[1],!0,e[0],o));for(let r=e[1]+1;r<=t[1]-1;r++){const e=s.lines.get(r),t=s.translateBufferLineToString(r,!0);(null==e?void 0:e.isWrapped)?i[i.length-1]+=t:i.push(t)}if(e[1]!==t[1]){const e=s.lines.get(t[1]),o=s.translateBufferLineToString(t[1],!0,0,t[0]);e&&e.isWrapped?i[i.length-1]+=o:i.push(o)}}return i.map(e=>e.replace(f," ")).join(h.isWindows?"\r\n":"\n")}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(e){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),h.isLinux&&e&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:3===this._activeSelectionMode})}_isClickInSelection(e){const t=this._getMouseBufferCoords(e),s=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;return!!(s&&i&&t)&&this._areCoordsInSelection(t,s,i)}isCellInSelection(e,t){const s=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;return!(!s||!i)&&this._areCoordsInSelection([e,t],s,i)}_areCoordsInSelection(e,t,s){return e[1]>t[1]&&e[1]<s[1]||t[1]===s[1]&&e[1]===t[1]&&e[0]>=t[0]&&e[0]<s[0]||t[1]<s[1]&&e[1]===s[1]&&e[0]<s[0]||t[1]<s[1]&&e[1]===t[1]&&e[0]>=t[0]}_selectWordAtCursor(e,t){var s,i;const o=null===(i=null===(s=this._linkifier.currentLink)||void 0===s?void 0:s.link)||void 0===i?void 0:i.range;if(o)return this._model.selectionStart=[o.start.x-1,o.start.y-1],this._model.selectionStartLength=(0,u.getRangeLength)(o,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const r=this._getMouseBufferCoords(e);return!!r&&(this._selectWordAt(r,t),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(e,t){this._model.clearSelection(),e=Math.max(e,0),t=Math.min(t,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,e],this._model.selectionEnd=[this._bufferService.cols,t],this.refresh(),this._onSelectionChange.fire()}_handleTrim(e){this._model.handleTrim(e)&&this.refresh()}_getMouseBufferCoords(e){const t=this._mouseService.getCoords(e,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(t)return t[0]--,t[1]--,t[1]+=this._bufferService.buffer.ydisp,t}_getMouseEventScrollAmount(e){let t=(0,r.getCoordsRelativeToElement)(this._coreBrowserService.window,e,this._screenElement)[1];const s=this._renderService.dimensions.css.canvas.height;return t>=0&&t<=s?0:(t>s&&(t-=s),t=Math.min(Math.max(t,-50),50),t/=50,t/Math.abs(t)+Math.round(14*t))}shouldForceSelection(e){return h.isMac?e.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:e.shiftKey}handleMouseDown(e){if(this._mouseDownTimeStamp=e.timeStamp,(2!==e.button||!this.hasSelection)&&0===e.button){if(!this._enabled){if(!this.shouldForceSelection(e))return;e.stopPropagation()}e.preventDefault(),this._dragScrollAmount=0,this._enabled&&e.shiftKey?this._handleIncrementalClick(e):1===e.detail?this._handleSingleClick(e):2===e.detail?this._handleDoubleClick(e):3===e.detail&&this._handleTripleClick(e),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(e){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(e))}_handleSingleClick(e){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(e)?3:0,this._model.selectionStart=this._getMouseBufferCoords(e),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const t=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);t&&t.length!==this._model.selectionStart[0]&&0===t.hasWidth(this._model.selectionStart[0])&&this._model.selectionStart[0]++}_handleDoubleClick(e){this._selectWordAtCursor(e,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(e){const t=this._getMouseBufferCoords(e);t&&(this._activeSelectionMode=2,this._selectLineAt(t[1]))}shouldColumnSelect(e){return e.altKey&&!(h.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(e){if(e.stopImmediatePropagation(),!this._model.selectionStart)return;const t=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(e),!this._model.selectionEnd)return void this.refresh(!0);2===this._activeSelectionMode?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:1===this._activeSelectionMode&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(e),3!==this._activeSelectionMode&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const s=this._bufferService.buffer;if(this._model.selectionEnd[1]<s.lines.length){const e=s.lines.get(this._model.selectionEnd[1]);e&&0===e.hasWidth(this._model.selectionEnd[0])&&this._model.selectionEnd[0]++}t&&t[0]===this._model.selectionEnd[0]&&t[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const e=this._bufferService.buffer;this._dragScrollAmount>0?(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(e.ydisp+this._bufferService.rows,e.lines.length-1)):(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=e.ydisp),this.refresh()}}_handleMouseUp(e){const t=e.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&t<500&&e.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const t=this._mouseService.getCoords(e,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(t&&void 0!==t[0]&&void 0!==t[1]){const e=(0,a.moveToCellSequence)(t[0]-1,t[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(e,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd,s=!(!e||!t||e[0]===t[0]&&e[1]===t[1]);s?e&&t&&(this._oldSelectionStart&&this._oldSelectionEnd&&e[0]===this._oldSelectionStart[0]&&e[1]===this._oldSelectionStart[1]&&t[0]===this._oldSelectionEnd[0]&&t[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(e,t,s)):this._oldHasSelection&&this._fireOnSelectionChange(e,t,s)}_fireOnSelectionChange(e,t,s){this._oldSelectionStart=e,this._oldSelectionEnd=t,this._oldHasSelection=s,this._onSelectionChange.fire()}_handleBufferActivate(e){this.clearSelection(),this._trimListener.dispose(),this._trimListener=e.activeBuffer.lines.onTrim(e=>this._handleTrim(e))}_convertViewportColToCharacterIndex(e,t){let s=t;for(let i=0;t>=i;i++){const o=e.loadCell(i,this._workCell).getChars().length;0===this._workCell.getWidth()?s--:o>1&&t!==i&&(s+=o-1)}return s}setSelection(e,t,s){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[e,t],this._model.selectionStartLength=s,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(e){this._isClickInSelection(e)||(this._selectWordAtCursor(e,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(e,t,s=!0,i=!0){if(e[0]>=this._bufferService.cols)return;const o=this._bufferService.buffer,r=o.lines.get(e[1]);if(!r)return;const a=o.translateBufferLineToString(e[1],!1);let n=this._convertViewportColToCharacterIndex(r,e[0]),l=n;const c=e[0]-n;let d=0,h=0,u=0,p=0;if(" "===a.charAt(n)){for(;n>0&&" "===a.charAt(n-1);)n--;for(;l<a.length&&" "===a.charAt(l+1);)l++}else{let t=e[0],s=e[0];0===r.getWidth(t)&&(d++,t--),2===r.getWidth(s)&&(h++,s++);const i=r.getString(s).length;for(i>1&&(p+=i-1,l+=i-1);t>0&&n>0&&!this._isCharWordSeparator(r.loadCell(t-1,this._workCell));){r.loadCell(t-1,this._workCell);const e=this._workCell.getChars().length;0===this._workCell.getWidth()?(d++,t--):e>1&&(u+=e-1,n-=e-1),n--,t--}for(;s<r.length&&l+1<a.length&&!this._isCharWordSeparator(r.loadCell(s+1,this._workCell));){r.loadCell(s+1,this._workCell);const e=this._workCell.getChars().length;2===this._workCell.getWidth()?(h++,s++):e>1&&(p+=e-1,l+=e-1),l++,s++}}l++;let g=n+c-d+u,m=Math.min(this._bufferService.cols,l-n+d+h-u-p);if(t||""!==a.slice(n,l).trim()){if(s&&0===g&&32!==r.getCodePoint(0)){const t=o.lines.get(e[1]-1);if(t&&r.isWrapped&&32!==t.getCodePoint(this._bufferService.cols-1)){const t=this._getWordAt([this._bufferService.cols-1,e[1]-1],!1,!0,!1);if(t){const e=this._bufferService.cols-t.start;g-=e,m+=e}}}if(i&&g+m===this._bufferService.cols&&32!==r.getCodePoint(this._bufferService.cols-1)){const t=o.lines.get(e[1]+1);if((null==t?void 0:t.isWrapped)&&32!==t.getCodePoint(0)){const t=this._getWordAt([0,e[1]+1],!1,!1,!0);t&&(m+=t.length)}}return{start:g,length:m}}}_selectWordAt(e,t){const s=this._getWordAt(e,t);if(s){for(;s.start<0;)s.start+=this._bufferService.cols,e[1]--;this._model.selectionStart=[s.start,e[1]],this._model.selectionStartLength=s.length}}_selectToWordAt(e){const t=this._getWordAt(e,!0);if(t){let s=e[1];for(;t.start<0;)t.start+=this._bufferService.cols,s--;if(!this._model.areSelectionValuesReversed())for(;t.start+t.length>this._bufferService.cols;)t.length-=this._bufferService.cols,s++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?t.start:t.start+t.length,s]}}_isCharWordSeparator(e){return 0!==e.getWidth()&&this._optionsService.rawOptions.wordSeparator.indexOf(e.getChars())>=0}_selectLineAt(e){const t=this._bufferService.buffer.getWrappedRangeForLine(e),s={start:{x:0,y:t.first},end:{x:this._bufferService.cols-1,y:t.last}};this._model.selectionStart=[0,t.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,u.getRangeLength)(s,this._bufferService.cols)}};t.SelectionService=v=i([o(3,g.IBufferService),o(4,g.ICoreService),o(5,l.IMouseService),o(6,g.IOptionsService),o(7,l.IRenderService),o(8,l.ICoreBrowserService)],v)},4725:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IThemeService=t.ICharacterJoinerService=t.ISelectionService=t.IRenderService=t.IMouseService=t.ICoreBrowserService=t.ICharSizeService=void 0;const i=s(8343);t.ICharSizeService=(0,i.createDecorator)("CharSizeService"),t.ICoreBrowserService=(0,i.createDecorator)("CoreBrowserService"),t.IMouseService=(0,i.createDecorator)("MouseService"),t.IRenderService=(0,i.createDecorator)("RenderService"),t.ISelectionService=(0,i.createDecorator)("SelectionService"),t.ICharacterJoinerService=(0,i.createDecorator)("CharacterJoinerService"),t.IThemeService=(0,i.createDecorator)("ThemeService")},6731:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeService=t.DEFAULT_ANSI_COLORS=void 0;const r=s(7239),a=s(8055),n=s(8460),l=s(844),c=s(2585),d=a.css.toColor("#ffffff"),h=a.css.toColor("#000000"),u=a.css.toColor("#ffffff"),p=a.css.toColor("#000000"),g={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};t.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const e=[a.css.toColor("#2e3436"),a.css.toColor("#cc0000"),a.css.toColor("#4e9a06"),a.css.toColor("#c4a000"),a.css.toColor("#3465a4"),a.css.toColor("#75507b"),a.css.toColor("#06989a"),a.css.toColor("#d3d7cf"),a.css.toColor("#555753"),a.css.toColor("#ef2929"),a.css.toColor("#8ae234"),a.css.toColor("#fce94f"),a.css.toColor("#729fcf"),a.css.toColor("#ad7fa8"),a.css.toColor("#34e2e2"),a.css.toColor("#eeeeec")],t=[0,95,135,175,215,255];for(let s=0;s<216;s++){const i=t[s/36%6|0],o=t[s/6%6|0],r=t[s%6];e.push({css:a.channels.toCss(i,o,r),rgba:a.channels.toRgba(i,o,r)})}for(let s=0;s<24;s++){const t=8+10*s;e.push({css:a.channels.toCss(t,t,t),rgba:a.channels.toRgba(t,t,t)})}return e})());let m=t.ThemeService=class extends l.Disposable{get colors(){return this._colors}constructor(e){super(),this._optionsService=e,this._contrastCache=new r.ColorContrastCache,this._halfContrastCache=new r.ColorContrastCache,this._onChangeColors=this.register(new n.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:d,background:h,cursor:u,cursorAccent:p,selectionForeground:void 0,selectionBackgroundTransparent:g,selectionBackgroundOpaque:a.color.blend(h,g),selectionInactiveBackgroundTransparent:g,selectionInactiveBackgroundOpaque:a.color.blend(h,g),ansi:t.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}_setTheme(e={}){const s=this._colors;if(s.foreground=f(e.foreground,d),s.background=f(e.background,h),s.cursor=f(e.cursor,u),s.cursorAccent=f(e.cursorAccent,p),s.selectionBackgroundTransparent=f(e.selectionBackground,g),s.selectionBackgroundOpaque=a.color.blend(s.background,s.selectionBackgroundTransparent),s.selectionInactiveBackgroundTransparent=f(e.selectionInactiveBackground,s.selectionBackgroundTransparent),s.selectionInactiveBackgroundOpaque=a.color.blend(s.background,s.selectionInactiveBackgroundTransparent),s.selectionForeground=e.selectionForeground?f(e.selectionForeground,a.NULL_COLOR):void 0,s.selectionForeground===a.NULL_COLOR&&(s.selectionForeground=void 0),a.color.isOpaque(s.selectionBackgroundTransparent)){const e=.3;s.selectionBackgroundTransparent=a.color.opacity(s.selectionBackgroundTransparent,e)}if(a.color.isOpaque(s.selectionInactiveBackgroundTransparent)){const e=.3;s.selectionInactiveBackgroundTransparent=a.color.opacity(s.selectionInactiveBackgroundTransparent,e)}if(s.ansi=t.DEFAULT_ANSI_COLORS.slice(),s.ansi[0]=f(e.black,t.DEFAULT_ANSI_COLORS[0]),s.ansi[1]=f(e.red,t.DEFAULT_ANSI_COLORS[1]),s.ansi[2]=f(e.green,t.DEFAULT_ANSI_COLORS[2]),s.ansi[3]=f(e.yellow,t.DEFAULT_ANSI_COLORS[3]),s.ansi[4]=f(e.blue,t.DEFAULT_ANSI_COLORS[4]),s.ansi[5]=f(e.magenta,t.DEFAULT_ANSI_COLORS[5]),s.ansi[6]=f(e.cyan,t.DEFAULT_ANSI_COLORS[6]),s.ansi[7]=f(e.white,t.DEFAULT_ANSI_COLORS[7]),s.ansi[8]=f(e.brightBlack,t.DEFAULT_ANSI_COLORS[8]),s.ansi[9]=f(e.brightRed,t.DEFAULT_ANSI_COLORS[9]),s.ansi[10]=f(e.brightGreen,t.DEFAULT_ANSI_COLORS[10]),s.ansi[11]=f(e.brightYellow,t.DEFAULT_ANSI_COLORS[11]),s.ansi[12]=f(e.brightBlue,t.DEFAULT_ANSI_COLORS[12]),s.ansi[13]=f(e.brightMagenta,t.DEFAULT_ANSI_COLORS[13]),s.ansi[14]=f(e.brightCyan,t.DEFAULT_ANSI_COLORS[14]),s.ansi[15]=f(e.brightWhite,t.DEFAULT_ANSI_COLORS[15]),e.extendedAnsi){const i=Math.min(s.ansi.length-16,e.extendedAnsi.length);for(let o=0;o<i;o++)s.ansi[o+16]=f(e.extendedAnsi[o],t.DEFAULT_ANSI_COLORS[o+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(e){this._restoreColor(e),this._onChangeColors.fire(this.colors)}_restoreColor(e){if(void 0!==e)switch(e){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[e]=this._restoreColors.ansi[e]}else for(let t=0;t<this._restoreColors.ansi.length;++t)this._colors.ansi[t]=this._restoreColors.ansi[t]}modifyColors(e){e(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function f(e,t){if(void 0!==e)try{return a.css.toColor(e)}catch(s){}return t}t.ThemeService=m=i([o(0,c.IOptionsService)],m)},6349:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CircularList=void 0;const i=s(8460),o=s(844);class r extends o.Disposable{constructor(e){super(),this._maxLength=e,this.onDeleteEmitter=this.register(new i.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new i.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new i.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(e){if(this._maxLength===e)return;const t=new Array(e);for(let s=0;s<Math.min(e,this.length);s++)t[s]=this._array[this._getCyclicIndex(s)];this._array=t,this._maxLength=e,this._startIndex=0}get length(){return this._length}set length(e){if(e>this._length)for(let t=this._length;t<e;t++)this._array[t]=void 0;this._length=e}get(e){return this._array[this._getCyclicIndex(e)]}set(e,t){this._array[this._getCyclicIndex(e)]=t}push(e){this._array[this._getCyclicIndex(this._length)]=e,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(e,t,...s){if(t){for(let s=e;s<this._length-t;s++)this._array[this._getCyclicIndex(s)]=this._array[this._getCyclicIndex(s+t)];this._length-=t,this.onDeleteEmitter.fire({index:e,amount:t})}for(let i=this._length-1;i>=e;i--)this._array[this._getCyclicIndex(i+s.length)]=this._array[this._getCyclicIndex(i)];for(let i=0;i<s.length;i++)this._array[this._getCyclicIndex(e+i)]=s[i];if(s.length&&this.onInsertEmitter.fire({index:e,amount:s.length}),this._length+s.length>this._maxLength){const e=this._length+s.length-this._maxLength;this._startIndex+=e,this._length=this._maxLength,this.onTrimEmitter.fire(e)}else this._length+=s.length}trimStart(e){e>this._length&&(e=this._length),this._startIndex+=e,this._length-=e,this.onTrimEmitter.fire(e)}shiftElements(e,t,s){if(!(t<=0)){if(e<0||e>=this._length)throw new Error("start argument out of range");if(e+s<0)throw new Error("Cannot shift elements in list beyond index 0");if(s>0){for(let o=t-1;o>=0;o--)this.set(e+o+s,this.get(e+o));const i=e+t+s-this._length;if(i>0)for(this._length+=i;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let i=0;i<t;i++)this.set(e+i+s,this.get(e+i))}}_getCyclicIndex(e){return(this._startIndex+e)%this._maxLength}}t.CircularList=r},1439:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clone=void 0,t.clone=function e(t,s=5){if("object"!=typeof t)return t;const i=Array.isArray(t)?[]:{};for(const o in t)i[o]=s<=1?t[o]:t[o]&&e(t[o],s-1);return i}},8055:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contrastRatio=t.toPaddedHex=t.rgba=t.rgb=t.css=t.color=t.channels=t.NULL_COLOR=void 0;const i=s(6114);let o=0,r=0,a=0,n=0;var l,c,d,h,u,p;function g(e){const t=e.toString(16);return t.length<2?"0"+t:t}function m(e,t){return e<t?(t+.05)/(e+.05):(e+.05)/(t+.05)}t.NULL_COLOR={css:"#00000000",rgba:0},(p=l||(t.channels=l={})).toCss=function(e,t,s,i){return void 0!==i?`#${g(e)}${g(t)}${g(s)}${g(i)}`:`#${g(e)}${g(t)}${g(s)}`},p.toRgba=function(e,t,s,i=255){return(e<<24|t<<16|s<<8|i)>>>0},function(e){function t(e,t){return n=Math.round(255*t),[o,r,a]=u.toChannels(e.rgba),{css:l.toCss(o,r,a,n),rgba:l.toRgba(o,r,a,n)}}e.blend=function(e,t){if(n=(255&t.rgba)/255,1===n)return{css:t.css,rgba:t.rgba};const s=t.rgba>>24&255,i=t.rgba>>16&255,c=t.rgba>>8&255,d=e.rgba>>24&255,h=e.rgba>>16&255,u=e.rgba>>8&255;return o=d+Math.round((s-d)*n),r=h+Math.round((i-h)*n),a=u+Math.round((c-u)*n),{css:l.toCss(o,r,a),rgba:l.toRgba(o,r,a)}},e.isOpaque=function(e){return!(255&~e.rgba)},e.ensureContrastRatio=function(e,t,s){const i=u.ensureContrastRatio(e.rgba,t.rgba,s);if(i)return u.toColor(i>>24&255,i>>16&255,i>>8&255)},e.opaque=function(e){const t=(255|e.rgba)>>>0;return[o,r,a]=u.toChannels(t),{css:l.toCss(o,r,a),rgba:t}},e.opacity=t,e.multiplyOpacity=function(e,s){return n=255&e.rgba,t(e,n*s/255)},e.toColorRGB=function(e){return[e.rgba>>24&255,e.rgba>>16&255,e.rgba>>8&255]}}(c||(t.color=c={})),function(e){let t,s;if(!i.isNode){const e=document.createElement("canvas");e.width=1,e.height=1;const i=e.getContext("2d",{willReadFrequently:!0});i&&(t=i,t.globalCompositeOperation="copy",s=t.createLinearGradient(0,0,1,1))}e.toColor=function(e){if(e.match(/#[\da-f]{3,8}/i))switch(e.length){case 4:return o=parseInt(e.slice(1,2).repeat(2),16),r=parseInt(e.slice(2,3).repeat(2),16),a=parseInt(e.slice(3,4).repeat(2),16),u.toColor(o,r,a);case 5:return o=parseInt(e.slice(1,2).repeat(2),16),r=parseInt(e.slice(2,3).repeat(2),16),a=parseInt(e.slice(3,4).repeat(2),16),n=parseInt(e.slice(4,5).repeat(2),16),u.toColor(o,r,a,n);case 7:return{css:e,rgba:(parseInt(e.slice(1),16)<<8|255)>>>0};case 9:return{css:e,rgba:parseInt(e.slice(1),16)>>>0}}const i=e.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(i)return o=parseInt(i[1]),r=parseInt(i[2]),a=parseInt(i[3]),n=Math.round(255*(void 0===i[5]?1:parseFloat(i[5]))),u.toColor(o,r,a,n);if(!t||!s)throw new Error("css.toColor: Unsupported css format");if(t.fillStyle=s,t.fillStyle=e,"string"!=typeof t.fillStyle)throw new Error("css.toColor: Unsupported css format");if(t.fillRect(0,0,1,1),[o,r,a,n]=t.getImageData(0,0,1,1).data,255!==n)throw new Error("css.toColor: Unsupported css format");return{rgba:l.toRgba(o,r,a,n),css:e}}}(d||(t.css=d={})),function(e){function t(e,t,s){const i=e/255,o=t/255,r=s/255;return.2126*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))+.7152*(o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4))+.0722*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))}e.relativeLuminance=function(e){return t(e>>16&255,e>>8&255,255&e)},e.relativeLuminance2=t}(h||(t.rgb=h={})),function(e){function t(e,t,s){const i=e>>24&255,o=e>>16&255,r=e>>8&255;let a=t>>24&255,n=t>>16&255,l=t>>8&255,c=m(h.relativeLuminance2(a,n,l),h.relativeLuminance2(i,o,r));for(;c<s&&(a>0||n>0||l>0);)a-=Math.max(0,Math.ceil(.1*a)),n-=Math.max(0,Math.ceil(.1*n)),l-=Math.max(0,Math.ceil(.1*l)),c=m(h.relativeLuminance2(a,n,l),h.relativeLuminance2(i,o,r));return(a<<24|n<<16|l<<8|255)>>>0}function s(e,t,s){const i=e>>24&255,o=e>>16&255,r=e>>8&255;let a=t>>24&255,n=t>>16&255,l=t>>8&255,c=m(h.relativeLuminance2(a,n,l),h.relativeLuminance2(i,o,r));for(;c<s&&(a<255||n<255||l<255);)a=Math.min(255,a+Math.ceil(.1*(255-a))),n=Math.min(255,n+Math.ceil(.1*(255-n))),l=Math.min(255,l+Math.ceil(.1*(255-l))),c=m(h.relativeLuminance2(a,n,l),h.relativeLuminance2(i,o,r));return(a<<24|n<<16|l<<8|255)>>>0}e.ensureContrastRatio=function(e,i,o){const r=h.relativeLuminance(e>>8),a=h.relativeLuminance(i>>8);if(m(r,a)<o){if(a<r){const a=t(e,i,o),n=m(r,h.relativeLuminance(a>>8));if(n<o){const t=s(e,i,o);return n>m(r,h.relativeLuminance(t>>8))?a:t}return a}const n=s(e,i,o),l=m(r,h.relativeLuminance(n>>8));if(l<o){const s=t(e,i,o);return l>m(r,h.relativeLuminance(s>>8))?n:s}return n}},e.reduceLuminance=t,e.increaseLuminance=s,e.toChannels=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]},e.toColor=function(e,t,s,i){return{css:l.toCss(e,t,s,i),rgba:l.toRgba(e,t,s,i)}}}(u||(t.rgba=u={})),t.toPaddedHex=g,t.contrastRatio=m},8969:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreTerminal=void 0;const i=s(844),o=s(2585),r=s(4348),a=s(7866),n=s(744),l=s(7302),c=s(6975),d=s(8460),h=s(1753),u=s(1480),p=s(7994),g=s(9282),m=s(5435),f=s(5981),v=s(2660);let b=!1;class y extends i.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new d.EventEmitter),this._onScroll.event(e=>{var t;null===(t=this._onScrollApi)||void 0===t||t.fire(e.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(e){for(const t in e)this.optionsService.options[t]=e[t]}constructor(e){super(),this._windowsWrappingHeuristics=this.register(new i.MutableDisposable),this._onBinary=this.register(new d.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new d.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new d.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new d.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new d.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new d.EventEmitter),this._instantiationService=new r.InstantiationService,this.optionsService=this.register(new l.OptionsService(e)),this._instantiationService.setService(o.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(n.BufferService)),this._instantiationService.setService(o.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(a.LogService)),this._instantiationService.setService(o.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(c.CoreService)),this._instantiationService.setService(o.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(h.CoreMouseService)),this._instantiationService.setService(o.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(u.UnicodeService)),this._instantiationService.setService(o.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(p.CharsetService),this._instantiationService.setService(o.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(v.OscLinkService),this._instantiationService.setService(o.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new m.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,d.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,d.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,d.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,d.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(e=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(e=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new f.WriteBuffer((e,t)=>this._inputHandler.parse(e,t))),this.register((0,d.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(e,t){this._writeBuffer.write(e,t)}writeSync(e,t){this._logService.logLevel<=o.LogLevelEnum.WARN&&!b&&(this._logService.warn("writeSync is unreliable and will be removed soon."),b=!0),this._writeBuffer.writeSync(e,t)}resize(e,t){isNaN(e)||isNaN(t)||(e=Math.max(e,n.MINIMUM_COLS),t=Math.max(t,n.MINIMUM_ROWS),this._bufferService.resize(e,t))}scroll(e,t=!1){this._bufferService.scroll(e,t)}scrollLines(e,t,s){this._bufferService.scrollLines(e,t,s)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){const t=e-this._bufferService.buffer.ydisp;0!==t&&this.scrollLines(t)}registerEscHandler(e,t){return this._inputHandler.registerEscHandler(e,t)}registerDcsHandler(e,t){return this._inputHandler.registerDcsHandler(e,t)}registerCsiHandler(e,t){return this._inputHandler.registerCsiHandler(e,t)}registerOscHandler(e,t){return this._inputHandler.registerOscHandler(e,t)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let e=!1;const t=this.optionsService.rawOptions.windowsPty;t&&void 0!==t.buildNumber&&void 0!==t.buildNumber?e=!!("conpty"===t.backend&&t.buildNumber<21376):this.optionsService.rawOptions.windowsMode&&(e=!0),e?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const e=[];e.push(this.onLineFeed(g.updateWindowsModeWrappedState.bind(null,this._bufferService))),e.push(this.registerCsiHandler({final:"H"},()=>((0,g.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,i.toDisposable)(()=>{for(const t of e)t.dispose()})}}}t.CoreTerminal=y},8460:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.forwardEvent=t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=e=>(this._listeners.push(e),{dispose:()=>{if(!this._disposed)for(let t=0;t<this._listeners.length;t++)if(this._listeners[t]===e)return void this._listeners.splice(t,1)}})),this._event}fire(e,t){const s=[];for(let i=0;i<this._listeners.length;i++)s.push(this._listeners[i]);for(let i=0;i<s.length;i++)s[i].call(void 0,e,t)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},t.forwardEvent=function(e,t){return e(e=>t.fire(e))}},5435:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.InputHandler=t.WindowsOptionsReportType=void 0;const r=s(2584),a=s(7116),n=s(2015),l=s(844),c=s(482),d=s(8437),h=s(8460),u=s(643),p=s(511),g=s(3734),m=s(2585),f=s(6242),v=s(6351),b=s(5941),y={"(":0,")":1,"*":2,"+":3,"-":1,".":2},w=131072;function x(e,t){if(e>24)return t.setWinLines||!1;switch(e){case 1:return!!t.restoreWin;case 2:return!!t.minimizeWin;case 3:return!!t.setWinPosition;case 4:return!!t.setWinSizePixels;case 5:return!!t.raiseWin;case 6:return!!t.lowerWin;case 7:return!!t.refreshWin;case 8:return!!t.setWinSizeChars;case 9:return!!t.maximizeWin;case 10:return!!t.fullscreenWin;case 11:return!!t.getWinState;case 13:return!!t.getWinPosition;case 14:return!!t.getWinSizePixels;case 15:return!!t.getScreenSizePixels;case 16:return!!t.getCellSizePixels;case 18:return!!t.getWinSizeChars;case 19:return!!t.getScreenSizeChars;case 20:return!!t.getIconTitle;case 21:return!!t.getWinTitle;case 22:return!!t.pushTitle;case 23:return!!t.popTitle;case 24:return!!t.setWinLines}return!1}var _,k;(k=_||(t.WindowsOptionsReportType=_={}))[k.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",k[k.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS";let S=0;class C extends l.Disposable{getAttrData(){return this._curAttrData}constructor(e,t,s,i,o,l,u,g,m=new n.EscapeSequenceParser){super(),this._bufferService=e,this._charsetService=t,this._coreService=s,this._logService=i,this._optionsService=o,this._oscLinkService=l,this._coreMouseService=u,this._unicodeService=g,this._parser=m,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new c.StringToUtf32,this._utf8Decoder=new c.Utf8ToUtf32,this._workCell=new p.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=d.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=d.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new h.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new h.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new h.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new h.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new h.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new h.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new h.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new h.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new h.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new h.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new h.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new h.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new h.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new $(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(e=>this._activeBuffer=e.activeBuffer)),this._parser.setCsiHandlerFallback((e,t)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(e),params:t.toArray()})}),this._parser.setEscHandlerFallback(e=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(e)})}),this._parser.setExecuteHandlerFallback(e=>{this._logService.debug("Unknown EXECUTE code: ",{code:e})}),this._parser.setOscHandlerFallback((e,t,s)=>{this._logService.debug("Unknown OSC code: ",{identifier:e,action:t,data:s})}),this._parser.setDcsHandlerFallback((e,t,s)=>{"HOOK"===t&&(s=s.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(e),action:t,payload:s})}),this._parser.setPrintHandler((e,t,s)=>this.print(e,t,s)),this._parser.registerCsiHandler({final:"@"},e=>this.insertChars(e)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},e=>this.scrollLeft(e)),this._parser.registerCsiHandler({final:"A"},e=>this.cursorUp(e)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},e=>this.scrollRight(e)),this._parser.registerCsiHandler({final:"B"},e=>this.cursorDown(e)),this._parser.registerCsiHandler({final:"C"},e=>this.cursorForward(e)),this._parser.registerCsiHandler({final:"D"},e=>this.cursorBackward(e)),this._parser.registerCsiHandler({final:"E"},e=>this.cursorNextLine(e)),this._parser.registerCsiHandler({final:"F"},e=>this.cursorPrecedingLine(e)),this._parser.registerCsiHandler({final:"G"},e=>this.cursorCharAbsolute(e)),this._parser.registerCsiHandler({final:"H"},e=>this.cursorPosition(e)),this._parser.registerCsiHandler({final:"I"},e=>this.cursorForwardTab(e)),this._parser.registerCsiHandler({final:"J"},e=>this.eraseInDisplay(e,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},e=>this.eraseInDisplay(e,!0)),this._parser.registerCsiHandler({final:"K"},e=>this.eraseInLine(e,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},e=>this.eraseInLine(e,!0)),this._parser.registerCsiHandler({final:"L"},e=>this.insertLines(e)),this._parser.registerCsiHandler({final:"M"},e=>this.deleteLines(e)),this._parser.registerCsiHandler({final:"P"},e=>this.deleteChars(e)),this._parser.registerCsiHandler({final:"S"},e=>this.scrollUp(e)),this._parser.registerCsiHandler({final:"T"},e=>this.scrollDown(e)),this._parser.registerCsiHandler({final:"X"},e=>this.eraseChars(e)),this._parser.registerCsiHandler({final:"Z"},e=>this.cursorBackwardTab(e)),this._parser.registerCsiHandler({final:"`"},e=>this.charPosAbsolute(e)),this._parser.registerCsiHandler({final:"a"},e=>this.hPositionRelative(e)),this._parser.registerCsiHandler({final:"b"},e=>this.repeatPrecedingCharacter(e)),this._parser.registerCsiHandler({final:"c"},e=>this.sendDeviceAttributesPrimary(e)),this._parser.registerCsiHandler({prefix:">",final:"c"},e=>this.sendDeviceAttributesSecondary(e)),this._parser.registerCsiHandler({final:"d"},e=>this.linePosAbsolute(e)),this._parser.registerCsiHandler({final:"e"},e=>this.vPositionRelative(e)),this._parser.registerCsiHandler({final:"f"},e=>this.hVPosition(e)),this._parser.registerCsiHandler({final:"g"},e=>this.tabClear(e)),this._parser.registerCsiHandler({final:"h"},e=>this.setMode(e)),this._parser.registerCsiHandler({prefix:"?",final:"h"},e=>this.setModePrivate(e)),this._parser.registerCsiHandler({final:"l"},e=>this.resetMode(e)),this._parser.registerCsiHandler({prefix:"?",final:"l"},e=>this.resetModePrivate(e)),this._parser.registerCsiHandler({final:"m"},e=>this.charAttributes(e)),this._parser.registerCsiHandler({final:"n"},e=>this.deviceStatus(e)),this._parser.registerCsiHandler({prefix:"?",final:"n"},e=>this.deviceStatusPrivate(e)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},e=>this.softReset(e)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},e=>this.setCursorStyle(e)),this._parser.registerCsiHandler({final:"r"},e=>this.setScrollRegion(e)),this._parser.registerCsiHandler({final:"s"},e=>this.saveCursor(e)),this._parser.registerCsiHandler({final:"t"},e=>this.windowOptions(e)),this._parser.registerCsiHandler({final:"u"},e=>this.restoreCursor(e)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},e=>this.insertColumns(e)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},e=>this.deleteColumns(e)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},e=>this.selectProtected(e)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},e=>this.requestMode(e,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},e=>this.requestMode(e,!1)),this._parser.setExecuteHandler(r.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(r.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(r.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(r.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(r.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(r.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(r.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(r.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(r.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(r.C1.IND,()=>this.index()),this._parser.setExecuteHandler(r.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(r.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new f.OscHandler(e=>(this.setTitle(e),this.setIconName(e),!0))),this._parser.registerOscHandler(1,new f.OscHandler(e=>this.setIconName(e))),this._parser.registerOscHandler(2,new f.OscHandler(e=>this.setTitle(e))),this._parser.registerOscHandler(4,new f.OscHandler(e=>this.setOrReportIndexedColor(e))),this._parser.registerOscHandler(8,new f.OscHandler(e=>this.setHyperlink(e))),this._parser.registerOscHandler(10,new f.OscHandler(e=>this.setOrReportFgColor(e))),this._parser.registerOscHandler(11,new f.OscHandler(e=>this.setOrReportBgColor(e))),this._parser.registerOscHandler(12,new f.OscHandler(e=>this.setOrReportCursorColor(e))),this._parser.registerOscHandler(104,new f.OscHandler(e=>this.restoreIndexedColor(e))),this._parser.registerOscHandler(110,new f.OscHandler(e=>this.restoreFgColor(e))),this._parser.registerOscHandler(111,new f.OscHandler(e=>this.restoreBgColor(e))),this._parser.registerOscHandler(112,new f.OscHandler(e=>this.restoreCursorColor(e))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(const r in a.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:r},()=>this.selectCharset("("+r)),this._parser.registerEscHandler({intermediates:")",final:r},()=>this.selectCharset(")"+r)),this._parser.registerEscHandler({intermediates:"*",final:r},()=>this.selectCharset("*"+r)),this._parser.registerEscHandler({intermediates:"+",final:r},()=>this.selectCharset("+"+r)),this._parser.registerEscHandler({intermediates:"-",final:r},()=>this.selectCharset("-"+r)),this._parser.registerEscHandler({intermediates:".",final:r},()=>this.selectCharset("."+r)),this._parser.registerEscHandler({intermediates:"/",final:r},()=>this.selectCharset("/"+r));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(e=>(this._logService.error("Parsing error: ",e),e)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new v.DcsHandler((e,t)=>this.requestStatusString(e,t)))}_preserveStack(e,t,s,i){this._parseStack.paused=!0,this._parseStack.cursorStartX=e,this._parseStack.cursorStartY=t,this._parseStack.decodedLength=s,this._parseStack.position=i}_logSlowResolvingAsync(e){this._logService.logLevel<=m.LogLevelEnum.WARN&&Promise.race([e,new Promise((e,t)=>setTimeout(()=>t("#SLOW_TIMEOUT"),5e3))]).catch(e=>{if("#SLOW_TIMEOUT"!==e)throw e;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(e,t){let s,i=this._activeBuffer.x,o=this._activeBuffer.y,r=0;const a=this._parseStack.paused;if(a){if(s=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,t))return this._logSlowResolvingAsync(s),s;i=this._parseStack.cursorStartX,o=this._parseStack.cursorStartY,this._parseStack.paused=!1,e.length>w&&(r=this._parseStack.position+w)}if(this._logService.logLevel<=m.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+("string"==typeof e?` "${e}"`:` "${Array.prototype.map.call(e,e=>String.fromCharCode(e)).join("")}"`),"string"==typeof e?e.split("").map(e=>e.charCodeAt(0)):e),this._parseBuffer.length<e.length&&this._parseBuffer.length<w&&(this._parseBuffer=new Uint32Array(Math.min(e.length,w))),a||this._dirtyRowTracker.clearRange(),e.length>w)for(let n=r;n<e.length;n+=w){const t=n+w<e.length?n+w:e.length,r="string"==typeof e?this._stringDecoder.decode(e.substring(n,t),this._parseBuffer):this._utf8Decoder.decode(e.subarray(n,t),this._parseBuffer);if(s=this._parser.parse(this._parseBuffer,r))return this._preserveStack(i,o,r,n),this._logSlowResolvingAsync(s),s}else if(!a){const t="string"==typeof e?this._stringDecoder.decode(e,this._parseBuffer):this._utf8Decoder.decode(e,this._parseBuffer);if(s=this._parser.parse(this._parseBuffer,t))return this._preserveStack(i,o,t,0),this._logSlowResolvingAsync(s),s}this._activeBuffer.x===i&&this._activeBuffer.y===o||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowTracker.start,this._dirtyRowTracker.end)}print(e,t,s){let i,o;const r=this._charsetService.charset,a=this._optionsService.rawOptions.screenReaderMode,n=this._bufferService.cols,l=this._coreService.decPrivateModes.wraparound,d=this._coreService.modes.insertMode,h=this._curAttrData;let p=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&s-t>0&&2===p.getWidth(this._activeBuffer.x-1)&&p.setCellFromCodePoint(this._activeBuffer.x-1,0,1,h.fg,h.bg,h.extended);for(let g=t;g<s;++g){if(i=e[g],o=this._unicodeService.wcwidth(i),i<127&&r){const e=r[String.fromCharCode(i)];e&&(i=e.charCodeAt(0))}if(a&&this._onA11yChar.fire((0,c.stringFromCodePoint)(i)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),o||!this._activeBuffer.x){if(this._activeBuffer.x+o-1>=n)if(l){for(;this._activeBuffer.x<n;)p.setCellFromCodePoint(this._activeBuffer.x++,0,1,h.fg,h.bg,h.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),p=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=n-1,2===o)continue;if(d&&(p.insertCells(this._activeBuffer.x,o,this._activeBuffer.getNullCell(h),h),2===p.getWidth(n-1)&&p.setCellFromCodePoint(n-1,u.NULL_CELL_CODE,u.NULL_CELL_WIDTH,h.fg,h.bg,h.extended)),p.setCellFromCodePoint(this._activeBuffer.x++,i,o,h.fg,h.bg,h.extended),o>0)for(;--o;)p.setCellFromCodePoint(this._activeBuffer.x++,0,0,h.fg,h.bg,h.extended)}else p.getWidth(this._activeBuffer.x-1)?p.addCodepointToCell(this._activeBuffer.x-1,i):p.addCodepointToCell(this._activeBuffer.x-2,i)}s-t>0&&(p.loadCell(this._activeBuffer.x-1,this._workCell),2===this._workCell.getWidth()||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<n&&s-t>0&&0===p.getWidth(this._activeBuffer.x)&&!p.hasContent(this._activeBuffer.x)&&p.setCellFromCodePoint(this._activeBuffer.x,0,1,h.fg,h.bg,h.extended),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(e,t){return"t"!==e.final||e.prefix||e.intermediates?this._parser.registerCsiHandler(e,t):this._parser.registerCsiHandler(e,e=>!x(e.params[0],this._optionsService.rawOptions.windowOptions)||t(e))}registerDcsHandler(e,t){return this._parser.registerDcsHandler(e,new v.DcsHandler(t))}registerEscHandler(e,t){return this._parser.registerEscHandler(e,t)}registerOscHandler(e,t){return this._parser.registerOscHandler(e,new f.OscHandler(t))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var e;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(0===this._activeBuffer.x&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&(null===(e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))||void 0===e?void 0:e.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);e.hasWidth(this._activeBuffer.x)&&!e.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const e=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-e),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(e=this._bufferService.cols-1){this._activeBuffer.x=Math.min(e,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(e,t){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=e,this._activeBuffer.y=this._activeBuffer.scrollTop+t):(this._activeBuffer.x=e,this._activeBuffer.y=t),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(e,t){this._restrictCursor(),this._setCursor(this._activeBuffer.x+e,this._activeBuffer.y+t)}cursorUp(e){const t=this._activeBuffer.y-this._activeBuffer.scrollTop;return t>=0?this._moveCursor(0,-Math.min(t,e.params[0]||1)):this._moveCursor(0,-(e.params[0]||1)),!0}cursorDown(e){const t=this._activeBuffer.scrollBottom-this._activeBuffer.y;return t>=0?this._moveCursor(0,Math.min(t,e.params[0]||1)):this._moveCursor(0,e.params[0]||1),!0}cursorForward(e){return this._moveCursor(e.params[0]||1,0),!0}cursorBackward(e){return this._moveCursor(-(e.params[0]||1),0),!0}cursorNextLine(e){return this.cursorDown(e),this._activeBuffer.x=0,!0}cursorPrecedingLine(e){return this.cursorUp(e),this._activeBuffer.x=0,!0}cursorCharAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(e){return this._setCursor(e.length>=2?(e.params[1]||1)-1:0,(e.params[0]||1)-1),!0}charPosAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(e){return this._moveCursor(e.params[0]||1,0),!0}linePosAbsolute(e){return this._setCursor(this._activeBuffer.x,(e.params[0]||1)-1),!0}vPositionRelative(e){return this._moveCursor(0,e.params[0]||1),!0}hVPosition(e){return this.cursorPosition(e),!0}tabClear(e){const t=e.params[0];return 0===t?delete this._activeBuffer.tabs[this._activeBuffer.x]:3===t&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(e){const t=e.params[0];return 1===t&&(this._curAttrData.bg|=536870912),2!==t&&0!==t||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(e,t,s,i=!1,o=!1){const r=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);r.replaceCells(t,s,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData(),o),i&&(r.isWrapped=!1)}_resetBufferLine(e,t=!1){const s=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);s&&(s.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),t),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+e),s.isWrapped=!1)}eraseInDisplay(e,t=!1){let s;switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:for(s=this._activeBuffer.y,this._dirtyRowTracker.markDirty(s),this._eraseInBufferLine(s++,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,t);s<this._bufferService.rows;s++)this._resetBufferLine(s,t);this._dirtyRowTracker.markDirty(s);break;case 1:for(s=this._activeBuffer.y,this._dirtyRowTracker.markDirty(s),this._eraseInBufferLine(s,0,this._activeBuffer.x+1,!0,t),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(s+1).isWrapped=!1);s--;)this._resetBufferLine(s,t);this._dirtyRowTracker.markDirty(0);break;case 2:for(s=this._bufferService.rows,this._dirtyRowTracker.markDirty(s-1);s--;)this._resetBufferLine(s,t);this._dirtyRowTracker.markDirty(0);break;case 3:const e=this._activeBuffer.lines.length-this._bufferService.rows;e>0&&(this._activeBuffer.lines.trimStart(e),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-e,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-e,0),this._onScroll.fire(0))}return!0}eraseInLine(e,t=!1){switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,t);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,t);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,t)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const s=this._activeBuffer.ybase+this._activeBuffer.y,i=this._bufferService.rows-1-this._activeBuffer.scrollBottom,o=this._bufferService.rows-1+this._activeBuffer.ybase-i+1;for(;t--;)this._activeBuffer.lines.splice(o-1,1),this._activeBuffer.lines.splice(s,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const s=this._activeBuffer.ybase+this._activeBuffer.y;let i;for(i=this._bufferService.rows-1-this._activeBuffer.scrollBottom,i=this._bufferService.rows-1+this._activeBuffer.ybase-i;t--;)this._activeBuffer.lines.splice(s,1),this._activeBuffer.lines.splice(i,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(e){this._restrictCursor();const t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.insertCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(e){this._restrictCursor();const t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.deleteCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(d.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let s=this._activeBuffer.scrollTop;s<=this._activeBuffer.scrollBottom;++s){const e=this._activeBuffer.lines.get(this._activeBuffer.ybase+s);e.deleteCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),e.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let s=this._activeBuffer.scrollTop;s<=this._activeBuffer.scrollBottom;++s){const e=this._activeBuffer.lines.get(this._activeBuffer.ybase+s);e.insertCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),e.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let s=this._activeBuffer.scrollTop;s<=this._activeBuffer.scrollBottom;++s){const e=this._activeBuffer.lines.get(this._activeBuffer.ybase+s);e.insertCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),e.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let s=this._activeBuffer.scrollTop;s<=this._activeBuffer.scrollBottom;++s){const e=this._activeBuffer.lines.get(this._activeBuffer.ybase+s);e.deleteCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),e.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(e){this._restrictCursor();const t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(e.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(e){if(!this._parser.precedingCodepoint)return!0;const t=e.params[0]||1,s=new Uint32Array(t);for(let i=0;i<t;++i)s[i]=this._parser.precedingCodepoint;return this.print(s,0,s.length),!0}sendDeviceAttributesPrimary(e){return e.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(r.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(r.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(e){return e.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(r.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(r.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(e.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(r.C0.ESC+"[>83;40003;0c")),!0}_is(e){return 0===(this._optionsService.rawOptions.termName+"").indexOf(e)}setMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,a.DEFAULT_CHARSET),this._charsetService.setgCharset(1,a.DEFAULT_CHARSET),this._charsetService.setgCharset(2,a.DEFAULT_CHARSET),this._charsetService.setgCharset(3,a.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),1049===e.params[t]&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(e,t){const s=this._coreService.decPrivateModes,{activeProtocol:i,activeEncoding:o}=this._coreMouseService,a=this._coreService,{buffers:n,cols:l}=this._bufferService,{active:c,alt:d}=n,h=this._optionsService.rawOptions,u=e=>e?1:2,p=e.params[0];return g=p,m=t?2===p?4:4===p?u(a.modes.insertMode):12===p?3:20===p?u(h.convertEol):0:1===p?u(s.applicationCursorKeys):3===p?h.windowOptions.setWinLines?80===l?2:132===l?1:0:0:6===p?u(s.origin):7===p?u(s.wraparound):8===p?3:9===p?u("X10"===i):12===p?u(h.cursorBlink):25===p?u(!a.isCursorHidden):45===p?u(s.reverseWraparound):66===p?u(s.applicationKeypad):67===p?4:1e3===p?u("VT200"===i):1002===p?u("DRAG"===i):1003===p?u("ANY"===i):1004===p?u(s.sendFocus):1005===p?4:1006===p?u("SGR"===o):1015===p?4:1016===p?u("SGR_PIXELS"===o):1048===p?1:47===p||1047===p||1049===p?u(c===d):2004===p?u(s.bracketedPasteMode):0,a.triggerDataEvent(`${r.C0.ESC}[${t?"":"?"}${g};${m}$y`),!0;var g,m}_updateAttrColor(e,t,s,i,o){return 2===t?(e|=50331648,e&=-16777216,e|=g.AttributeData.fromColorRGB([s,i,o])):5===t&&(e&=-50331904,e|=33554432|255&s),e}_extractColor(e,t,s){const i=[0,0,-1,0,0,0];let o=0,r=0;do{if(i[r+o]=e.params[t+r],e.hasSubParams(t+r)){const s=e.getSubParams(t+r);let a=0;do{5===i[1]&&(o=1),i[r+a+1+o]=s[a]}while(++a<s.length&&a+r+1+o<i.length);break}if(5===i[1]&&r+o>=2||2===i[1]&&r+o>=5)break;i[1]&&(o=1)}while(++r+t<e.length&&r+o<i.length);for(let a=2;a<i.length;++a)-1===i[a]&&(i[a]=0);switch(i[0]){case 38:s.fg=this._updateAttrColor(s.fg,i[1],i[3],i[4],i[5]);break;case 48:s.bg=this._updateAttrColor(s.bg,i[1],i[3],i[4],i[5]);break;case 58:s.extended=s.extended.clone(),s.extended.underlineColor=this._updateAttrColor(s.extended.underlineColor,i[1],i[3],i[4],i[5])}return r}_processUnderline(e,t){t.extended=t.extended.clone(),(!~e||e>5)&&(e=1),t.extended.underlineStyle=e,t.fg|=268435456,0===e&&(t.fg&=-268435457),t.updateExtended()}_processSGR0(e){e.fg=d.DEFAULT_ATTR_DATA.fg,e.bg=d.DEFAULT_ATTR_DATA.bg,e.extended=e.extended.clone(),e.extended.underlineStyle=0,e.extended.underlineColor&=-67108864,e.updateExtended()}charAttributes(e){if(1===e.length&&0===e.params[0])return this._processSGR0(this._curAttrData),!0;const t=e.length;let s;const i=this._curAttrData;for(let o=0;o<t;o++)s=e.params[o],s>=30&&s<=37?(i.fg&=-50331904,i.fg|=16777216|s-30):s>=40&&s<=47?(i.bg&=-50331904,i.bg|=16777216|s-40):s>=90&&s<=97?(i.fg&=-50331904,i.fg|=16777224|s-90):s>=100&&s<=107?(i.bg&=-50331904,i.bg|=16777224|s-100):0===s?this._processSGR0(i):1===s?i.fg|=134217728:3===s?i.bg|=67108864:4===s?(i.fg|=268435456,this._processUnderline(e.hasSubParams(o)?e.getSubParams(o)[0]:1,i)):5===s?i.fg|=536870912:7===s?i.fg|=67108864:8===s?i.fg|=1073741824:9===s?i.fg|=2147483648:2===s?i.bg|=134217728:21===s?this._processUnderline(2,i):22===s?(i.fg&=-134217729,i.bg&=-134217729):23===s?i.bg&=-67108865:24===s?(i.fg&=-268435457,this._processUnderline(0,i)):25===s?i.fg&=-536870913:27===s?i.fg&=-67108865:28===s?i.fg&=-1073741825:29===s?i.fg&=2147483647:39===s?(i.fg&=-67108864,i.fg|=16777215&d.DEFAULT_ATTR_DATA.fg):49===s?(i.bg&=-67108864,i.bg|=16777215&d.DEFAULT_ATTR_DATA.bg):38===s||48===s||58===s?o+=this._extractColor(e,o,i):53===s?i.bg|=1073741824:55===s?i.bg&=-1073741825:59===s?(i.extended=i.extended.clone(),i.extended.underlineColor=-1,i.updateExtended()):100===s?(i.fg&=-67108864,i.fg|=16777215&d.DEFAULT_ATTR_DATA.fg,i.bg&=-67108864,i.bg|=16777215&d.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",s);return!0}deviceStatus(e){switch(e.params[0]){case 5:this._coreService.triggerDataEvent(`${r.C0.ESC}[0n`);break;case 6:const e=this._activeBuffer.y+1,t=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${r.C0.ESC}[${e};${t}R`)}return!0}deviceStatusPrivate(e){if(6===e.params[0]){const e=this._activeBuffer.y+1,t=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${r.C0.ESC}[?${e};${t}R`)}return!0}softReset(e){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=d.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(e){const t=e.params[0]||1;switch(t){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const s=t%2==1;return this._optionsService.options.cursorBlink=s,!0}setScrollRegion(e){const t=e.params[0]||1;let s;return(e.length<2||(s=e.params[1])>this._bufferService.rows||0===s)&&(s=this._bufferService.rows),s>t&&(this._activeBuffer.scrollTop=t-1,this._activeBuffer.scrollBottom=s-1,this._setCursor(0,0)),!0}windowOptions(e){if(!x(e.params[0],this._optionsService.rawOptions.windowOptions))return!0;const t=e.length>1?e.params[1]:0;switch(e.params[0]){case 14:2!==t&&this._onRequestWindowsOptionsReport.fire(_.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(_.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${r.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:0!==t&&2!==t||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),0!==t&&1!==t||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:0!==t&&2!==t||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),0!==t&&1!==t||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(e){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(e){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(e){return this._windowTitle=e,this._onTitleChange.fire(e),!0}setIconName(e){return this._iconName=e,!0}setOrReportIndexedColor(e){const t=[],s=e.split(";");for(;s.length>1;){const e=s.shift(),i=s.shift();if(/^\d+$/.exec(e)){const s=parseInt(e);if(D(s))if("?"===i)t.push({type:0,index:s});else{const e=(0,b.parseColor)(i);e&&t.push({type:1,index:s,color:e})}}}return t.length&&this._onColor.fire(t),!0}setHyperlink(e){const t=e.split(";");return!(t.length<2)&&(t[1]?this._createHyperlink(t[0],t[1]):!t[0]&&this._finishHyperlink())}_createHyperlink(e,t){this._getCurrentLinkId()&&this._finishHyperlink();const s=e.split(":");let i;const o=s.findIndex(e=>e.startsWith("id="));return-1!==o&&(i=s[o].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:i,uri:t}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(e,t){const s=e.split(";");for(let i=0;i<s.length&&!(t>=this._specialColors.length);++i,++t)if("?"===s[i])this._onColor.fire([{type:0,index:this._specialColors[t]}]);else{const e=(0,b.parseColor)(s[i]);e&&this._onColor.fire([{type:1,index:this._specialColors[t],color:e}])}return!0}setOrReportFgColor(e){return this._setOrReportSpecialColor(e,0)}setOrReportBgColor(e){return this._setOrReportSpecialColor(e,1)}setOrReportCursorColor(e){return this._setOrReportSpecialColor(e,2)}restoreIndexedColor(e){if(!e)return this._onColor.fire([{type:2}]),!0;const t=[],s=e.split(";");for(let i=0;i<s.length;++i)if(/^\d+$/.exec(s[i])){const e=parseInt(s[i]);D(e)&&t.push({type:2,index:e})}return t.length&&this._onColor.fire(t),!0}restoreFgColor(e){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(e){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(e){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,a.DEFAULT_CHARSET),!0}selectCharset(e){return 2!==e.length?(this.selectDefaultCharset(),!0):("/"===e[0]||this._charsetService.setgCharset(y[e[0]],a.CHARSETS[e[1]]||a.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const e=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,e,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=d.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=d.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(e){return this._charsetService.setgLevel(e),!0}screenAlignmentPattern(){const e=new p.CellData;e.content=1<<22|"E".charCodeAt(0),e.fg=this._curAttrData.fg,e.bg=this._curAttrData.bg,this._setCursor(0,0);for(let t=0;t<this._bufferService.rows;++t){const s=this._activeBuffer.ybase+this._activeBuffer.y+t,i=this._activeBuffer.lines.get(s);i&&(i.fill(e),i.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(e,t){const s=this._bufferService.buffer,i=this._optionsService.rawOptions;return(e=>(this._coreService.triggerDataEvent(`${r.C0.ESC}${e}${r.C0.ESC}\\`),!0))('"q'===e?`P1$r${this._curAttrData.isProtected()?1:0}"q`:'"p'===e?'P1$r61;1"p':"r"===e?`P1$r${s.scrollTop+1};${s.scrollBottom+1}r`:"m"===e?"P1$r0m":" q"===e?`P1$r${{block:2,underline:4,bar:6}[i.cursorStyle]-(i.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(e,t){this._dirtyRowTracker.markRangeDirty(e,t)}}t.InputHandler=C;let $=class{constructor(e){this._bufferService=e,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(e){e<this.start?this.start=e:e>this.end&&(this.end=e)}markRangeDirty(e,t){e>t&&(S=e,e=t,t=S),e<this.start&&(this.start=e),t>this.end&&(this.end=t)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function D(e){return 0<=e&&e<256}$=i([o(0,m.IBufferService)],$)},844:(e,t)=>{function s(e){for(const t of e)t.dispose();e.length=0}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisposeArrayDisposable=t.disposeArray=t.toDisposable=t.MutableDisposable=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const e of this._disposables)e.dispose();this._disposables.length=0}register(e){return this._disposables.push(e),e}unregister(e){const t=this._disposables.indexOf(e);-1!==t&&this._disposables.splice(t,1)}},t.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(e){var t;this._isDisposed||e===this._value||(null===(t=this._value)||void 0===t||t.dispose(),this._value=e)}clear(){this.value=void 0}dispose(){var e;this._isDisposed=!0,null===(e=this._value)||void 0===e||e.dispose(),this._value=void 0}},t.toDisposable=function(e){return{dispose:e}},t.disposeArray=s,t.getDisposeArrayDisposable=function(e){return{dispose:()=>s(e)}}},1505:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FourKeyMap=t.TwoKeyMap=void 0;class s{constructor(){this._data={}}set(e,t,s){this._data[e]||(this._data[e]={}),this._data[e][t]=s}get(e,t){return this._data[e]?this._data[e][t]:void 0}clear(){this._data={}}}t.TwoKeyMap=s,t.FourKeyMap=class{constructor(){this._data=new s}set(e,t,i,o,r){this._data.get(e,t)||this._data.set(e,t,new s),this._data.get(e,t).set(i,o,r)}get(e,t,s,i){var o;return null===(o=this._data.get(e,t))||void 0===o?void 0:o.get(s,i)}clear(){this._data.clear()}}},6114:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isChromeOS=t.isLinux=t.isWindows=t.isIphone=t.isIpad=t.isMac=t.getSafariVersion=t.isSafari=t.isLegacyEdge=t.isFirefox=t.isNode=void 0,t.isNode="undefined"==typeof navigator;const s=t.isNode?"node":navigator.userAgent,i=t.isNode?"node":navigator.platform;t.isFirefox=s.includes("Firefox"),t.isLegacyEdge=s.includes("Edge"),t.isSafari=/^((?!chrome|android).)*safari/i.test(s),t.getSafariVersion=function(){if(!t.isSafari)return 0;const e=s.match(/Version\/(\d+)/);return null===e||e.length<2?0:parseInt(e[1])},t.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(i),t.isIpad="iPad"===i,t.isIphone="iPhone"===i,t.isWindows=["Windows","Win16","Win32","WinCE"].includes(i),t.isLinux=i.indexOf("Linux")>=0,t.isChromeOS=/\bCrOS\b/.test(s)},6106:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SortedList=void 0;let s=0;t.SortedList=class{constructor(e){this._getKey=e,this._array=[]}clear(){this._array.length=0}insert(e){0!==this._array.length?(s=this._search(this._getKey(e)),this._array.splice(s,0,e)):this._array.push(e)}delete(e){if(0===this._array.length)return!1;const t=this._getKey(e);if(void 0===t)return!1;if(s=this._search(t),-1===s)return!1;if(this._getKey(this._array[s])!==t)return!1;do{if(this._array[s]===e)return this._array.splice(s,1),!0}while(++s<this._array.length&&this._getKey(this._array[s])===t);return!1}*getKeyIterator(e){if(0!==this._array.length&&(s=this._search(e),!(s<0||s>=this._array.length)&&this._getKey(this._array[s])===e))do{yield this._array[s]}while(++s<this._array.length&&this._getKey(this._array[s])===e)}forEachByKey(e,t){if(0!==this._array.length&&(s=this._search(e),!(s<0||s>=this._array.length)&&this._getKey(this._array[s])===e))do{t(this._array[s])}while(++s<this._array.length&&this._getKey(this._array[s])===e)}values(){return[...this._array].values()}_search(e){let t=0,s=this._array.length-1;for(;s>=t;){let i=t+s>>1;const o=this._getKey(this._array[i]);if(o>e)s=i-1;else{if(!(o<e)){for(;i>0&&this._getKey(this._array[i-1])===e;)i--;return i}t=i+1}}return t}}},7226:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DebouncedIdleTask=t.IdleTaskQueue=t.PriorityTaskQueue=void 0;const i=s(6114);class o{constructor(){this._tasks=[],this._i=0}enqueue(e){this._tasks.push(e),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let t=0,s=0,i=e.timeRemaining(),o=0;for(;this._i<this._tasks.length;){if(t=Date.now(),this._tasks[this._i]()||this._i++,t=Math.max(1,Date.now()-t),s=Math.max(t,s),o=e.timeRemaining(),1.5*s>o)return i-t<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(i-t))}ms`),void this._start();i=o}this.clear()}}class r extends o{_requestCallback(e){return setTimeout(()=>e(this._createDeadline(16)))}_cancelCallback(e){clearTimeout(e)}_createDeadline(e){const t=Date.now()+e;return{timeRemaining:()=>Math.max(0,t-Date.now())}}}t.PriorityTaskQueue=r,t.IdleTaskQueue=!i.isNode&&"requestIdleCallback"in window?class extends o{_requestCallback(e){return requestIdleCallback(e)}_cancelCallback(e){cancelIdleCallback(e)}}:r,t.DebouncedIdleTask=class{constructor(){this._queue=new t.IdleTaskQueue}set(e){this._queue.clear(),this._queue.enqueue(e)}flush(){this._queue.flush()}}},9282:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateWindowsModeWrappedState=void 0;const i=s(643);t.updateWindowsModeWrappedState=function(e){const t=e.buffer.lines.get(e.buffer.ybase+e.buffer.y-1),s=null==t?void 0:t.get(e.cols-1),o=e.buffer.lines.get(e.buffer.ybase+e.buffer.y);o&&s&&(o.isWrapped=s[i.CHAR_DATA_CODE_INDEX]!==i.NULL_CELL_CODE&&s[i.CHAR_DATA_CODE_INDEX]!==i.WHITESPACE_CELL_CODE)}},3734:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedAttrs=t.AttributeData=void 0;class s{constructor(){this.fg=0,this.bg=0,this.extended=new i}static toColorRGB(e){return[e>>>16&255,e>>>8&255,255&e]}static fromColorRGB(e){return(255&e[0])<<16|(255&e[1])<<8|255&e[2]}clone(){const e=new s;return e.fg=this.fg,e.bg=this.bg,e.extended=this.extended.clone(),e}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&0!==this.extended.underlineStyle?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return!(50331648&~this.fg)}isBgRGB(){return!(50331648&~this.bg)}isFgPalette(){return 16777216==(50331648&this.fg)||33554432==(50331648&this.fg)}isBgPalette(){return 16777216==(50331648&this.bg)||33554432==(50331648&this.bg)}isFgDefault(){return!(50331648&this.fg)}isBgDefault(){return!(50331648&this.bg)}isAttributeDefault(){return 0===this.fg&&0===this.bg}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?!(50331648&~this.extended.underlineColor):this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?16777216==(50331648&this.extended.underlineColor)||33554432==(50331648&this.extended.underlineColor):this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?!(50331648&this.extended.underlineColor):this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}t.AttributeData=s;class i{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(e){this._ext=e}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(e){this._ext&=-469762049,this._ext|=e<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(e){this._ext&=-67108864,this._ext|=67108863&e}get urlId(){return this._urlId}set urlId(e){this._urlId=e}constructor(e=0,t=0){this._ext=0,this._urlId=0,this._ext=e,this._urlId=t}clone(){return new i(this._ext,this._urlId)}isEmpty(){return 0===this.underlineStyle&&0===this._urlId}}t.ExtendedAttrs=i},9092:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Buffer=t.MAX_BUFFER_SIZE=void 0;const i=s(6349),o=s(7226),r=s(3734),a=s(8437),n=s(4634),l=s(511),c=s(643),d=s(4863),h=s(7116);t.MAX_BUFFER_SIZE=4294967295,t.Buffer=class{constructor(e,t,s){this._hasScrollback=e,this._optionsService=t,this._bufferService=s,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=a.DEFAULT_ATTR_DATA.clone(),this.savedCharset=h.DEFAULT_CHARSET,this.markers=[],this._nullCell=l.CellData.fromCharData([0,c.NULL_CELL_CHAR,c.NULL_CELL_WIDTH,c.NULL_CELL_CODE]),this._whitespaceCell=l.CellData.fromCharData([0,c.WHITESPACE_CELL_CHAR,c.WHITESPACE_CELL_WIDTH,c.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new o.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new i.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(e){return e?(this._nullCell.fg=e.fg,this._nullCell.bg=e.bg,this._nullCell.extended=e.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new r.ExtendedAttrs),this._nullCell}getWhitespaceCell(e){return e?(this._whitespaceCell.fg=e.fg,this._whitespaceCell.bg=e.bg,this._whitespaceCell.extended=e.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new r.ExtendedAttrs),this._whitespaceCell}getBlankLine(e,t){return new a.BufferLine(this._bufferService.cols,this.getNullCell(e),t)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const e=this.ybase+this.y-this.ydisp;return e>=0&&e<this._rows}_getCorrectBufferLength(e){if(!this._hasScrollback)return e;const s=e+this._optionsService.rawOptions.scrollback;return s>t.MAX_BUFFER_SIZE?t.MAX_BUFFER_SIZE:s}fillViewportRows(e){if(0===this.lines.length){void 0===e&&(e=a.DEFAULT_ATTR_DATA);let t=this._rows;for(;t--;)this.lines.push(this.getBlankLine(e))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new i.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(e,t){const s=this.getNullCell(a.DEFAULT_ATTR_DATA);let i=0;const o=this._getCorrectBufferLength(t);if(o>this.lines.maxLength&&(this.lines.maxLength=o),this.lines.length>0){if(this._cols<e)for(let t=0;t<this.lines.length;t++)i+=+this.lines.get(t).resize(e,s);let r=0;if(this._rows<t)for(let i=this._rows;i<t;i++)this.lines.length<t+this.ybase&&(this._optionsService.rawOptions.windowsMode||void 0!==this._optionsService.rawOptions.windowsPty.backend||void 0!==this._optionsService.rawOptions.windowsPty.buildNumber?this.lines.push(new a.BufferLine(e,s)):this.ybase>0&&this.lines.length<=this.ybase+this.y+r+1?(this.ybase--,r++,this.ydisp>0&&this.ydisp--):this.lines.push(new a.BufferLine(e,s)));else for(let e=this._rows;e>t;e--)this.lines.length>t+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(o<this.lines.maxLength){const e=this.lines.length-o;e>0&&(this.lines.trimStart(e),this.ybase=Math.max(this.ybase-e,0),this.ydisp=Math.max(this.ydisp-e,0),this.savedY=Math.max(this.savedY-e,0)),this.lines.maxLength=o}this.x=Math.min(this.x,e-1),this.y=Math.min(this.y,t-1),r&&(this.y+=r),this.savedX=Math.min(this.savedX,e-1),this.scrollTop=0}if(this.scrollBottom=t-1,this._isReflowEnabled&&(this._reflow(e,t),this._cols>e))for(let r=0;r<this.lines.length;r++)i+=+this.lines.get(r).resize(e,s);this._cols=e,this._rows=t,this._memoryCleanupQueue.clear(),i>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let e=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,e=!1);let t=0;for(;this._memoryCleanupPosition<this.lines.length;)if(t+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),t>100)return!0;return e}get _isReflowEnabled(){const e=this._optionsService.rawOptions.windowsPty;return e&&e.buildNumber?this._hasScrollback&&"conpty"===e.backend&&e.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(e,t){this._cols!==e&&(e>this._cols?this._reflowLarger(e,t):this._reflowSmaller(e,t))}_reflowLarger(e,t){const s=(0,n.reflowLargerGetLinesToRemove)(this.lines,this._cols,e,this.ybase+this.y,this.getNullCell(a.DEFAULT_ATTR_DATA));if(s.length>0){const i=(0,n.reflowLargerCreateNewLayout)(this.lines,s);(0,n.reflowLargerApplyNewLayout)(this.lines,i.layout),this._reflowLargerAdjustViewport(e,t,i.countRemoved)}}_reflowLargerAdjustViewport(e,t,s){const i=this.getNullCell(a.DEFAULT_ATTR_DATA);let o=s;for(;o-- >0;)0===this.ybase?(this.y>0&&this.y--,this.lines.length<t&&this.lines.push(new a.BufferLine(e,i))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-s,0)}_reflowSmaller(e,t){const s=this.getNullCell(a.DEFAULT_ATTR_DATA),i=[];let o=0;for(let r=this.lines.length-1;r>=0;r--){let l=this.lines.get(r);if(!l||!l.isWrapped&&l.getTrimmedLength()<=e)continue;const c=[l];for(;l.isWrapped&&r>0;)l=this.lines.get(--r),c.unshift(l);const d=this.ybase+this.y;if(d>=r&&d<r+c.length)continue;const h=c[c.length-1].getTrimmedLength(),u=(0,n.reflowSmallerGetNewLineLengths)(c,this._cols,e),p=u.length-c.length;let g;g=0===this.ybase&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+p):Math.max(0,this.lines.length-this.lines.maxLength+p);const m=[];for(let e=0;e<p;e++){const e=this.getBlankLine(a.DEFAULT_ATTR_DATA,!0);m.push(e)}m.length>0&&(i.push({start:r+c.length+o,newLines:m}),o+=m.length),c.push(...m);let f=u.length-1,v=u[f];0===v&&(f--,v=u[f]);let b=c.length-p-1,y=h;for(;b>=0;){const e=Math.min(y,v);if(void 0===c[f])break;if(c[f].copyCellsFrom(c[b],y-e,v-e,e,!0),v-=e,0===v&&(f--,v=u[f]),y-=e,0===y){b--;const e=Math.max(b,0);y=(0,n.getWrappedLineTrimmedLength)(c,e,this._cols)}}for(let t=0;t<c.length;t++)u[t]<e&&c[t].setCell(u[t],s);let w=p-g;for(;w-- >0;)0===this.ybase?this.y<t-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+o)-t&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+p,this.ybase+t-1)}if(i.length>0){const e=[],t=[];for(let i=0;i<this.lines.length;i++)t.push(this.lines.get(i));const s=this.lines.length;let r=s-1,a=0,n=i[a];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+o);let l=0;for(let h=Math.min(this.lines.maxLength-1,s+o-1);h>=0;h--)if(n&&n.start>r+l){for(let e=n.newLines.length-1;e>=0;e--)this.lines.set(h--,n.newLines[e]);h++,e.push({index:r+1,amount:n.newLines.length}),l+=n.newLines.length,n=i[++a]}else this.lines.set(h,t[r--]);let c=0;for(let i=e.length-1;i>=0;i--)e[i].index+=c,this.lines.onInsertEmitter.fire(e[i]),c+=e[i].amount;const d=Math.max(0,s+o-this.lines.maxLength);d>0&&this.lines.onTrimEmitter.fire(d)}}translateBufferLineToString(e,t,s=0,i){const o=this.lines.get(e);return o?o.translateToString(t,s,i):""}getWrappedRangeForLine(e){let t=e,s=e;for(;t>0&&this.lines.get(t).isWrapped;)t--;for(;s+1<this.lines.length&&this.lines.get(s+1).isWrapped;)s++;return{first:t,last:s}}setupTabStops(e){for(null!=e?this.tabs[e]||(e=this.prevStop(e)):(this.tabs={},e=0);e<this._cols;e+=this._optionsService.rawOptions.tabStopWidth)this.tabs[e]=!0}prevStop(e){for(null==e&&(e=this.x);!this.tabs[--e]&&e>0;);return e>=this._cols?this._cols-1:e<0?0:e}nextStop(e){for(null==e&&(e=this.x);!this.tabs[++e]&&e<this._cols;);return e>=this._cols?this._cols-1:e<0?0:e}clearMarkers(e){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].line===e&&(this.markers[t].dispose(),this.markers.splice(t--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let e=0;e<this.markers.length;e++)this.markers[e].dispose(),this.markers.splice(e--,1);this._isClearing=!1}addMarker(e){const t=new d.Marker(e);return this.markers.push(t),t.register(this.lines.onTrim(e=>{t.line-=e,t.line<0&&t.dispose()})),t.register(this.lines.onInsert(e=>{t.line>=e.index&&(t.line+=e.amount)})),t.register(this.lines.onDelete(e=>{t.line>=e.index&&t.line<e.index+e.amount&&t.dispose(),t.line>e.index&&(t.line-=e.amount)})),t.register(t.onDispose(()=>this._removeMarker(t))),t}_removeMarker(e){this._isClearing||this.markers.splice(this.markers.indexOf(e),1)}}},8437:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLine=t.DEFAULT_ATTR_DATA=void 0;const i=s(3734),o=s(511),r=s(643),a=s(482);t.DEFAULT_ATTR_DATA=Object.freeze(new i.AttributeData);let n=0;class l{constructor(e,t,s=!1){this.isWrapped=s,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*e);const i=t||o.CellData.fromCharData([0,r.NULL_CELL_CHAR,r.NULL_CELL_WIDTH,r.NULL_CELL_CODE]);for(let o=0;o<e;++o)this.setCell(o,i);this.length=e}get(e){const t=this._data[3*e+0],s=2097151&t;return[this._data[3*e+1],2097152&t?this._combined[e]:s?(0,a.stringFromCodePoint)(s):"",t>>22,2097152&t?this._combined[e].charCodeAt(this._combined[e].length-1):s]}set(e,t){this._data[3*e+1]=t[r.CHAR_DATA_ATTR_INDEX],t[r.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[e]=t[1],this._data[3*e+0]=2097152|e|t[r.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*e+0]=t[r.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|t[r.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(e){return this._data[3*e+0]>>22}hasWidth(e){return 12582912&this._data[3*e+0]}getFg(e){return this._data[3*e+1]}getBg(e){return this._data[3*e+2]}hasContent(e){return 4194303&this._data[3*e+0]}getCodePoint(e){const t=this._data[3*e+0];return 2097152&t?this._combined[e].charCodeAt(this._combined[e].length-1):2097151&t}isCombined(e){return 2097152&this._data[3*e+0]}getString(e){const t=this._data[3*e+0];return 2097152&t?this._combined[e]:2097151&t?(0,a.stringFromCodePoint)(2097151&t):""}isProtected(e){return 536870912&this._data[3*e+2]}loadCell(e,t){return n=3*e,t.content=this._data[n+0],t.fg=this._data[n+1],t.bg=this._data[n+2],2097152&t.content&&(t.combinedData=this._combined[e]),268435456&t.bg&&(t.extended=this._extendedAttrs[e]),t}setCell(e,t){2097152&t.content&&(this._combined[e]=t.combinedData),268435456&t.bg&&(this._extendedAttrs[e]=t.extended),this._data[3*e+0]=t.content,this._data[3*e+1]=t.fg,this._data[3*e+2]=t.bg}setCellFromCodePoint(e,t,s,i,o,r){268435456&o&&(this._extendedAttrs[e]=r),this._data[3*e+0]=t|s<<22,this._data[3*e+1]=i,this._data[3*e+2]=o}addCodepointToCell(e,t){let s=this._data[3*e+0];2097152&s?this._combined[e]+=(0,a.stringFromCodePoint)(t):(2097151&s?(this._combined[e]=(0,a.stringFromCodePoint)(2097151&s)+(0,a.stringFromCodePoint)(t),s&=-2097152,s|=2097152):s=t|1<<22,this._data[3*e+0]=s)}insertCells(e,t,s,r){if((e%=this.length)&&2===this.getWidth(e-1)&&this.setCellFromCodePoint(e-1,0,1,(null==r?void 0:r.fg)||0,(null==r?void 0:r.bg)||0,(null==r?void 0:r.extended)||new i.ExtendedAttrs),t<this.length-e){const i=new o.CellData;for(let s=this.length-e-t-1;s>=0;--s)this.setCell(e+t+s,this.loadCell(e+s,i));for(let o=0;o<t;++o)this.setCell(e+o,s)}else for(let i=e;i<this.length;++i)this.setCell(i,s);2===this.getWidth(this.length-1)&&this.setCellFromCodePoint(this.length-1,0,1,(null==r?void 0:r.fg)||0,(null==r?void 0:r.bg)||0,(null==r?void 0:r.extended)||new i.ExtendedAttrs)}deleteCells(e,t,s,r){if(e%=this.length,t<this.length-e){const i=new o.CellData;for(let s=0;s<this.length-e-t;++s)this.setCell(e+s,this.loadCell(e+t+s,i));for(let e=this.length-t;e<this.length;++e)this.setCell(e,s)}else for(let i=e;i<this.length;++i)this.setCell(i,s);e&&2===this.getWidth(e-1)&&this.setCellFromCodePoint(e-1,0,1,(null==r?void 0:r.fg)||0,(null==r?void 0:r.bg)||0,(null==r?void 0:r.extended)||new i.ExtendedAttrs),0!==this.getWidth(e)||this.hasContent(e)||this.setCellFromCodePoint(e,0,1,(null==r?void 0:r.fg)||0,(null==r?void 0:r.bg)||0,(null==r?void 0:r.extended)||new i.ExtendedAttrs)}replaceCells(e,t,s,o,r=!1){if(r)for(e&&2===this.getWidth(e-1)&&!this.isProtected(e-1)&&this.setCellFromCodePoint(e-1,0,1,(null==o?void 0:o.fg)||0,(null==o?void 0:o.bg)||0,(null==o?void 0:o.extended)||new i.ExtendedAttrs),t<this.length&&2===this.getWidth(t-1)&&!this.isProtected(t)&&this.setCellFromCodePoint(t,0,1,(null==o?void 0:o.fg)||0,(null==o?void 0:o.bg)||0,(null==o?void 0:o.extended)||new i.ExtendedAttrs);e<t&&e<this.length;)this.isProtected(e)||this.setCell(e,s),e++;else for(e&&2===this.getWidth(e-1)&&this.setCellFromCodePoint(e-1,0,1,(null==o?void 0:o.fg)||0,(null==o?void 0:o.bg)||0,(null==o?void 0:o.extended)||new i.ExtendedAttrs),t<this.length&&2===this.getWidth(t-1)&&this.setCellFromCodePoint(t,0,1,(null==o?void 0:o.fg)||0,(null==o?void 0:o.bg)||0,(null==o?void 0:o.extended)||new i.ExtendedAttrs);e<t&&e<this.length;)this.setCell(e++,s)}resize(e,t){if(e===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const s=3*e;if(e>this.length){if(this._data.buffer.byteLength>=4*s)this._data=new Uint32Array(this._data.buffer,0,s);else{const e=new Uint32Array(s);e.set(this._data),this._data=e}for(let s=this.length;s<e;++s)this.setCell(s,t)}else{this._data=this._data.subarray(0,s);const t=Object.keys(this._combined);for(let s=0;s<t.length;s++){const i=parseInt(t[s],10);i>=e&&delete this._combined[i]}const i=Object.keys(this._extendedAttrs);for(let s=0;s<i.length;s++){const t=parseInt(i[s],10);t>=e&&delete this._extendedAttrs[t]}}return this.length=e,4*s*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const e=new Uint32Array(this._data.length);return e.set(this._data),this._data=e,1}return 0}fill(e,t=!1){if(t)for(let s=0;s<this.length;++s)this.isProtected(s)||this.setCell(s,e);else{this._combined={},this._extendedAttrs={};for(let t=0;t<this.length;++t)this.setCell(t,e)}}copyFrom(e){this.length!==e.length?this._data=new Uint32Array(e._data):this._data.set(e._data),this.length=e.length,this._combined={};for(const t in e._combined)this._combined[t]=e._combined[t];this._extendedAttrs={};for(const t in e._extendedAttrs)this._extendedAttrs[t]=e._extendedAttrs[t];this.isWrapped=e.isWrapped}clone(){const e=new l(0);e._data=new Uint32Array(this._data),e.length=this.length;for(const t in this._combined)e._combined[t]=this._combined[t];for(const t in this._extendedAttrs)e._extendedAttrs[t]=this._extendedAttrs[t];return e.isWrapped=this.isWrapped,e}getTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0])return e+(this._data[3*e+0]>>22);return 0}getNoBgTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0]||50331648&this._data[3*e+2])return e+(this._data[3*e+0]>>22);return 0}copyCellsFrom(e,t,s,i,o){const r=e._data;if(o)for(let n=i-1;n>=0;n--){for(let e=0;e<3;e++)this._data[3*(s+n)+e]=r[3*(t+n)+e];268435456&r[3*(t+n)+2]&&(this._extendedAttrs[s+n]=e._extendedAttrs[t+n])}else for(let n=0;n<i;n++){for(let e=0;e<3;e++)this._data[3*(s+n)+e]=r[3*(t+n)+e];268435456&r[3*(t+n)+2]&&(this._extendedAttrs[s+n]=e._extendedAttrs[t+n])}const a=Object.keys(e._combined);for(let n=0;n<a.length;n++){const i=parseInt(a[n],10);i>=t&&(this._combined[i-t+s]=e._combined[i])}}translateToString(e=!1,t=0,s=this.length){e&&(s=Math.min(s,this.getTrimmedLength()));let i="";for(;t<s;){const e=this._data[3*t+0],s=2097151&e;i+=2097152&e?this._combined[t]:s?(0,a.stringFromCodePoint)(s):r.WHITESPACE_CELL_CHAR,t+=e>>22||1}return i}}t.BufferLine=l},4841:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRangeLength=void 0,t.getRangeLength=function(e,t){if(e.start.y>e.end.y)throw new Error(`Buffer range end (${e.end.x}, ${e.end.y}) cannot be before start (${e.start.x}, ${e.start.y})`);return t*(e.end.y-e.start.y)+(e.end.x-e.start.x+1)}},4634:(e,t)=>{function s(e,t,s){if(t===e.length-1)return e[t].getTrimmedLength();const i=!e[t].hasContent(s-1)&&1===e[t].getWidth(s-1),o=2===e[t+1].getWidth(0);return i&&o?s-1:s}Object.defineProperty(t,"__esModule",{value:!0}),t.getWrappedLineTrimmedLength=t.reflowSmallerGetNewLineLengths=t.reflowLargerApplyNewLayout=t.reflowLargerCreateNewLayout=t.reflowLargerGetLinesToRemove=void 0,t.reflowLargerGetLinesToRemove=function(e,t,i,o,r){const a=[];for(let n=0;n<e.length-1;n++){let l=n,c=e.get(++l);if(!c.isWrapped)continue;const d=[e.get(n)];for(;l<e.length&&c.isWrapped;)d.push(c),c=e.get(++l);if(o>=n&&o<l){n+=d.length-1;continue}let h=0,u=s(d,h,t),p=1,g=0;for(;p<d.length;){const e=s(d,p,t),o=e-g,a=i-u,n=Math.min(o,a);d[h].copyCellsFrom(d[p],g,u,n,!1),u+=n,u===i&&(h++,u=0),g+=n,g===e&&(p++,g=0),0===u&&0!==h&&2===d[h-1].getWidth(i-1)&&(d[h].copyCellsFrom(d[h-1],i-1,u++,1,!1),d[h-1].setCell(i-1,r))}d[h].replaceCells(u,i,r);let m=0;for(let e=d.length-1;e>0&&(e>h||0===d[e].getTrimmedLength());e--)m++;m>0&&(a.push(n+d.length-m),a.push(m)),n+=d.length-1}return a},t.reflowLargerCreateNewLayout=function(e,t){const s=[];let i=0,o=t[i],r=0;for(let a=0;a<e.length;a++)if(o===a){const s=t[++i];e.onDeleteEmitter.fire({index:a-r,amount:s}),a+=s-1,r+=s,o=t[++i]}else s.push(a);return{layout:s,countRemoved:r}},t.reflowLargerApplyNewLayout=function(e,t){const s=[];for(let i=0;i<t.length;i++)s.push(e.get(t[i]));for(let i=0;i<s.length;i++)e.set(i,s[i]);e.length=t.length},t.reflowSmallerGetNewLineLengths=function(e,t,i){const o=[],r=e.map((i,o)=>s(e,o,t)).reduce((e,t)=>e+t);let a=0,n=0,l=0;for(;l<r;){if(r-l<i){o.push(r-l);break}a+=i;const c=s(e,n,t);a>c&&(a-=c,n++);const d=2===e[n].getWidth(a-1);d&&a--;const h=d?i-1:i;o.push(h),l+=h}return o},t.getWrappedLineTrimmedLength=s},5295:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferSet=void 0;const i=s(8460),o=s(844),r=s(9092);class a extends o.Disposable{constructor(e,t){super(),this._optionsService=e,this._bufferService=t,this._onBufferActivate=this.register(new i.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new r.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new r.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(e){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(e),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(e,t){this._normal.resize(e,t),this._alt.resize(e,t),this.setupTabStops(e)}setupTabStops(e){this._normal.setupTabStops(e),this._alt.setupTabStops(e)}}t.BufferSet=a},511:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellData=void 0;const i=s(482),o=s(643),r=s(3734);class a extends r.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new r.ExtendedAttrs,this.combinedData=""}static fromCharData(e){const t=new a;return t.setFromCharData(e),t}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,i.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(e){this.fg=e[o.CHAR_DATA_ATTR_INDEX],this.bg=0;let t=!1;if(e[o.CHAR_DATA_CHAR_INDEX].length>2)t=!0;else if(2===e[o.CHAR_DATA_CHAR_INDEX].length){const s=e[o.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=s&&s<=56319){const i=e[o.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=i&&i<=57343?this.content=1024*(s-55296)+i-56320+65536|e[o.CHAR_DATA_WIDTH_INDEX]<<22:t=!0}else t=!0}else this.content=e[o.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|e[o.CHAR_DATA_WIDTH_INDEX]<<22;t&&(this.combinedData=e[o.CHAR_DATA_CHAR_INDEX],this.content=2097152|e[o.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.CellData=a},643:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WHITESPACE_CELL_CODE=t.WHITESPACE_CELL_WIDTH=t.WHITESPACE_CELL_CHAR=t.NULL_CELL_CODE=t.NULL_CELL_WIDTH=t.NULL_CELL_CHAR=t.CHAR_DATA_CODE_INDEX=t.CHAR_DATA_WIDTH_INDEX=t.CHAR_DATA_CHAR_INDEX=t.CHAR_DATA_ATTR_INDEX=t.DEFAULT_EXT=t.DEFAULT_ATTR=t.DEFAULT_COLOR=void 0,t.DEFAULT_COLOR=0,t.DEFAULT_ATTR=256|t.DEFAULT_COLOR<<9,t.DEFAULT_EXT=0,t.CHAR_DATA_ATTR_INDEX=0,t.CHAR_DATA_CHAR_INDEX=1,t.CHAR_DATA_WIDTH_INDEX=2,t.CHAR_DATA_CODE_INDEX=3,t.NULL_CELL_CHAR="",t.NULL_CELL_WIDTH=1,t.NULL_CELL_CODE=0,t.WHITESPACE_CELL_CHAR=" ",t.WHITESPACE_CELL_WIDTH=1,t.WHITESPACE_CELL_CODE=32},4863:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Marker=void 0;const i=s(8460),o=s(844);class r{get id(){return this._id}constructor(e){this.line=e,this.isDisposed=!1,this._disposables=[],this._id=r._nextId++,this._onDispose=this.register(new i.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,o.disposeArray)(this._disposables),this._disposables.length=0)}register(e){return this._disposables.push(e),e}}t.Marker=r,r._nextId=1},7116:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CHARSET=t.CHARSETS=void 0,t.CHARSETS={},t.DEFAULT_CHARSET=t.CHARSETS.B,t.CHARSETS[0]={"`":"â",a:"â",b:"â",c:"â",d:"â",e:"â",f:"Â°",g:"Â±",h:"â¤",i:"â",j:"â",k:"â",l:"â",m:"â",n:"â¼",o:"âº",p:"â»",q:"â",r:"â¼",s:"â½",t:"â",u:"â¤",v:"â´",w:"â¬",x:"â",y:"â¤",z:"â¥","{":"Ï","|":"â ","}":"Â£","~":"Â·"},t.CHARSETS.A={"#":"Â£"},t.CHARSETS.B=void 0,t.CHARSETS[4]={"#":"Â£","@":"Â¾","[":"ij","\\":"Â½","]":"|","{":"Â¨","|":"f","}":"Â¼","~":"Â´"},t.CHARSETS.C=t.CHARSETS[5]={"[":"Ã","\\":"Ã","]":"Ã","^":"Ã","`":"Ã©","{":"Ã¤","|":"Ã¶","}":"Ã¥","~":"Ã¼"},t.CHARSETS.R={"#":"Â£","@":"Ã ","[":"Â°","\\":"Ã§","]":"Â§","{":"Ã©","|":"Ã¹","}":"Ã¨","~":"Â¨"},t.CHARSETS.Q={"@":"Ã ","[":"Ã¢","\\":"Ã§","]":"Ãª","^":"Ã®","`":"Ã´","{":"Ã©","|":"Ã¹","}":"Ã¨","~":"Ã»"},t.CHARSETS.K={"@":"Â§","[":"Ã","\\":"Ã","]":"Ã","{":"Ã¤","|":"Ã¶","}":"Ã¼","~":"Ã"},t.CHARSETS.Y={"#":"Â£","@":"Â§","[":"Â°","\\":"Ã§","]":"Ã©","`":"Ã¹","{":"Ã ","|":"Ã²","}":"Ã¨","~":"Ã¬"},t.CHARSETS.E=t.CHARSETS[6]={"@":"Ã","[":"Ã","\\":"Ã","]":"Ã","^":"Ã","`":"Ã¤","{":"Ã¦","|":"Ã¸","}":"Ã¥","~":"Ã¼"},t.CHARSETS.Z={"#":"Â£","@":"Â§","[":"Â¡","\\":"Ã","]":"Â¿","{":"Â°","|":"Ã±","}":"Ã§"},t.CHARSETS.H=t.CHARSETS[7]={"@":"Ã","[":"Ã","\\":"Ã","]":"Ã","^":"Ã","`":"Ã©","{":"Ã¤","|":"Ã¶","}":"Ã¥","~":"Ã¼"},t.CHARSETS["="]={"#":"Ã¹","@":"Ã ","[":"Ã©","\\":"Ã§","]":"Ãª","^":"Ã®",_:"Ã¨","`":"Ã´","{":"Ã¤","|":"Ã¶","}":"Ã¼","~":"Ã»"}},2584:(e,t)=>{var s,i,o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.C1_ESCAPED=t.C1=t.C0=void 0,(r=s||(t.C0=s={})).NUL="\0",r.SOH="",r.STX="",r.ETX="",r.EOT="",r.ENQ="",r.ACK="",r.BEL="",r.BS="\b",r.HT="\t",r.LF="\n",r.VT="\v",r.FF="\f",r.CR="\r",r.SO="",r.SI="",r.DLE="",r.DC1="",r.DC2="",r.DC3="",r.DC4="",r.NAK="",r.SYN="",r.ETB="",r.CAN="",r.EM="",r.SUB="",r.ESC="",r.FS="",r.GS="",r.RS="",r.US="",r.SP=" ",r.DEL="",function(e){e.PAD="Â",e.HOP="Â",e.BPH="Â",e.NBH="Â",e.IND="Â",e.NEL="Â",e.SSA="Â",e.ESA="Â",e.HTS="Â",e.HTJ="Â",e.VTS="Â",e.PLD="Â",e.PLU="Â",e.RI="Â",e.SS2="Â",e.SS3="Â",e.DCS="Â",e.PU1="Â",e.PU2="Â",e.STS="Â",e.CCH="Â",e.MW="Â",e.SPA="Â",e.EPA="Â",e.SOS="Â",e.SGCI="Â",e.SCI="Â",e.CSI="Â",e.ST="Â",e.OSC="Â",e.PM="Â",e.APC="Â"}(i||(t.C1=i={})),function(e){e.ST=`${s.ESC}\\`}(o||(t.C1_ESCAPED=o={}))},7399:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateKeyboardEvent=void 0;const i=s(2584),o={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};t.evaluateKeyboardEvent=function(e,t,s,r){const a={type:0,cancel:!1,key:void 0},n=(e.shiftKey?1:0)|(e.altKey?2:0)|(e.ctrlKey?4:0)|(e.metaKey?8:0);switch(e.keyCode){case 0:"UIKeyInputUpArrow"===e.key?a.key=t?i.C0.ESC+"OA":i.C0.ESC+"[A":"UIKeyInputLeftArrow"===e.key?a.key=t?i.C0.ESC+"OD":i.C0.ESC+"[D":"UIKeyInputRightArrow"===e.key?a.key=t?i.C0.ESC+"OC":i.C0.ESC+"[C":"UIKeyInputDownArrow"===e.key&&(a.key=t?i.C0.ESC+"OB":i.C0.ESC+"[B");break;case 8:if(e.altKey){a.key=i.C0.ESC+i.C0.DEL;break}a.key=i.C0.DEL;break;case 9:if(e.shiftKey){a.key=i.C0.ESC+"[Z";break}a.key=i.C0.HT,a.cancel=!0;break;case 13:a.key=e.altKey?i.C0.ESC+i.C0.CR:i.C0.CR,a.cancel=!0;break;case 27:a.key=i.C0.ESC,e.altKey&&(a.key=i.C0.ESC+i.C0.ESC),a.cancel=!0;break;case 37:if(e.metaKey)break;n?(a.key=i.C0.ESC+"[1;"+(n+1)+"D",a.key===i.C0.ESC+"[1;3D"&&(a.key=i.C0.ESC+(s?"b":"[1;5D"))):a.key=t?i.C0.ESC+"OD":i.C0.ESC+"[D";break;case 39:if(e.metaKey)break;n?(a.key=i.C0.ESC+"[1;"+(n+1)+"C",a.key===i.C0.ESC+"[1;3C"&&(a.key=i.C0.ESC+(s?"f":"[1;5C"))):a.key=t?i.C0.ESC+"OC":i.C0.ESC+"[C";break;case 38:if(e.metaKey)break;n?(a.key=i.C0.ESC+"[1;"+(n+1)+"A",s||a.key!==i.C0.ESC+"[1;3A"||(a.key=i.C0.ESC+"[1;5A")):a.key=t?i.C0.ESC+"OA":i.C0.ESC+"[A";break;case 40:if(e.metaKey)break;n?(a.key=i.C0.ESC+"[1;"+(n+1)+"B",s||a.key!==i.C0.ESC+"[1;3B"||(a.key=i.C0.ESC+"[1;5B")):a.key=t?i.C0.ESC+"OB":i.C0.ESC+"[B";break;case 45:e.shiftKey||e.ctrlKey||(a.key=i.C0.ESC+"[2~");break;case 46:a.key=n?i.C0.ESC+"[3;"+(n+1)+"~":i.C0.ESC+"[3~";break;case 36:a.key=n?i.C0.ESC+"[1;"+(n+1)+"H":t?i.C0.ESC+"OH":i.C0.ESC+"[H";break;case 35:a.key=n?i.C0.ESC+"[1;"+(n+1)+"F":t?i.C0.ESC+"OF":i.C0.ESC+"[F";break;case 33:e.shiftKey?a.type=2:e.ctrlKey?a.key=i.C0.ESC+"[5;"+(n+1)+"~":a.key=i.C0.ESC+"[5~";break;case 34:e.shiftKey?a.type=3:e.ctrlKey?a.key=i.C0.ESC+"[6;"+(n+1)+"~":a.key=i.C0.ESC+"[6~";break;case 112:a.key=n?i.C0.ESC+"[1;"+(n+1)+"P":i.C0.ESC+"OP";break;case 113:a.key=n?i.C0.ESC+"[1;"+(n+1)+"Q":i.C0.ESC+"OQ";break;case 114:a.key=n?i.C0.ESC+"[1;"+(n+1)+"R":i.C0.ESC+"OR";break;case 115:a.key=n?i.C0.ESC+"[1;"+(n+1)+"S":i.C0.ESC+"OS";break;case 116:a.key=n?i.C0.ESC+"[15;"+(n+1)+"~":i.C0.ESC+"[15~";break;case 117:a.key=n?i.C0.ESC+"[17;"+(n+1)+"~":i.C0.ESC+"[17~";break;case 118:a.key=n?i.C0.ESC+"[18;"+(n+1)+"~":i.C0.ESC+"[18~";break;case 119:a.key=n?i.C0.ESC+"[19;"+(n+1)+"~":i.C0.ESC+"[19~";break;case 120:a.key=n?i.C0.ESC+"[20;"+(n+1)+"~":i.C0.ESC+"[20~";break;case 121:a.key=n?i.C0.ESC+"[21;"+(n+1)+"~":i.C0.ESC+"[21~";break;case 122:a.key=n?i.C0.ESC+"[23;"+(n+1)+"~":i.C0.ESC+"[23~";break;case 123:a.key=n?i.C0.ESC+"[24;"+(n+1)+"~":i.C0.ESC+"[24~";break;default:if(!e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)if(s&&!r||!e.altKey||e.metaKey)!s||e.altKey||e.ctrlKey||e.shiftKey||!e.metaKey?e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.keyCode>=48&&1===e.key.length?a.key=e.key:e.key&&e.ctrlKey&&("_"===e.key&&(a.key=i.C0.US),"@"===e.key&&(a.key=i.C0.NUL)):65===e.keyCode&&(a.type=1);else{const t=o[e.keyCode],s=null==t?void 0:t[e.shiftKey?1:0];if(s)a.key=i.C0.ESC+s;else if(e.keyCode>=65&&e.keyCode<=90){const t=e.ctrlKey?e.keyCode-64:e.keyCode+32;let s=String.fromCharCode(t);e.shiftKey&&(s=s.toUpperCase()),a.key=i.C0.ESC+s}else if(32===e.keyCode)a.key=i.C0.ESC+(e.ctrlKey?i.C0.NUL:" ");else if("Dead"===e.key&&e.code.startsWith("Key")){let t=e.code.slice(3,4);e.shiftKey||(t=t.toLowerCase()),a.key=i.C0.ESC+t,a.cancel=!0}}else e.keyCode>=65&&e.keyCode<=90?a.key=String.fromCharCode(e.keyCode-64):32===e.keyCode?a.key=i.C0.NUL:e.keyCode>=51&&e.keyCode<=55?a.key=String.fromCharCode(e.keyCode-51+27):56===e.keyCode?a.key=i.C0.DEL:219===e.keyCode?a.key=i.C0.ESC:220===e.keyCode?a.key=i.C0.FS:221===e.keyCode&&(a.key=i.C0.GS)}return a}},482:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Utf8ToUtf32=t.StringToUtf32=t.utf32ToString=t.stringFromCodePoint=void 0,t.stringFromCodePoint=function(e){return e>65535?(e-=65536,String.fromCharCode(55296+(e>>10))+String.fromCharCode(e%1024+56320)):String.fromCharCode(e)},t.utf32ToString=function(e,t=0,s=e.length){let i="";for(let o=t;o<s;++o){let t=e[o];t>65535?(t-=65536,i+=String.fromCharCode(55296+(t>>10))+String.fromCharCode(t%1024+56320)):i+=String.fromCharCode(t)}return i},t.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(e,t){const s=e.length;if(!s)return 0;let i=0,o=0;if(this._interim){const s=e.charCodeAt(o++);56320<=s&&s<=57343?t[i++]=1024*(this._interim-55296)+s-56320+65536:(t[i++]=this._interim,t[i++]=s),this._interim=0}for(let r=o;r<s;++r){const o=e.charCodeAt(r);if(55296<=o&&o<=56319){if(++r>=s)return this._interim=o,i;const a=e.charCodeAt(r);56320<=a&&a<=57343?t[i++]=1024*(o-55296)+a-56320+65536:(t[i++]=o,t[i++]=a)}else 65279!==o&&(t[i++]=o)}return i}},t.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(e,t){const s=e.length;if(!s)return 0;let i,o,r,a,n=0,l=0,c=0;if(this.interim[0]){let i=!1,o=this.interim[0];o&=192==(224&o)?31:224==(240&o)?15:7;let r,a=0;for(;(r=63&this.interim[++a])&&a<4;)o<<=6,o|=r;const l=192==(224&this.interim[0])?2:224==(240&this.interim[0])?3:4,d=l-a;for(;c<d;){if(c>=s)return 0;if(r=e[c++],128!=(192&r)){c--,i=!0;break}this.interim[a++]=r,o<<=6,o|=63&r}i||(2===l?o<128?c--:t[n++]=o:3===l?o<2048||o>=55296&&o<=57343||65279===o||(t[n++]=o):o<65536||o>1114111||(t[n++]=o)),this.interim.fill(0)}const d=s-4;let h=c;for(;h<s;){for(;!(!(h<d)||128&(i=e[h])||128&(o=e[h+1])||128&(r=e[h+2])||128&(a=e[h+3]));)t[n++]=i,t[n++]=o,t[n++]=r,t[n++]=a,h+=4;if(i=e[h++],i<128)t[n++]=i;else if(192==(224&i)){if(h>=s)return this.interim[0]=i,n;if(o=e[h++],128!=(192&o)){h--;continue}if(l=(31&i)<<6|63&o,l<128){h--;continue}t[n++]=l}else if(224==(240&i)){if(h>=s)return this.interim[0]=i,n;if(o=e[h++],128!=(192&o)){h--;continue}if(h>=s)return this.interim[0]=i,this.interim[1]=o,n;if(r=e[h++],128!=(192&r)){h--;continue}if(l=(15&i)<<12|(63&o)<<6|63&r,l<2048||l>=55296&&l<=57343||65279===l)continue;t[n++]=l}else if(240==(248&i)){if(h>=s)return this.interim[0]=i,n;if(o=e[h++],128!=(192&o)){h--;continue}if(h>=s)return this.interim[0]=i,this.interim[1]=o,n;if(r=e[h++],128!=(192&r)){h--;continue}if(h>=s)return this.interim[0]=i,this.interim[1]=o,this.interim[2]=r,n;if(a=e[h++],128!=(192&a)){h--;continue}if(l=(7&i)<<18|(63&o)<<12|(63&r)<<6|63&a,l<65536||l>1114111)continue;t[n++]=l}}return n}}},225:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeV6=void 0;const s=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],i=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let o;t.UnicodeV6=class{constructor(){if(this.version="6",!o){o=new Uint8Array(65536),o.fill(1),o[0]=0,o.fill(0,1,32),o.fill(0,127,160),o.fill(2,4352,4448),o[9001]=2,o[9002]=2,o.fill(2,11904,42192),o[12351]=1,o.fill(2,44032,55204),o.fill(2,63744,64256),o.fill(2,65040,65050),o.fill(2,65072,65136),o.fill(2,65280,65377),o.fill(2,65504,65511);for(let e=0;e<s.length;++e)o.fill(0,s[e][0],s[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?o[e]:function(e,t){let s,i=0,o=t.length-1;if(e<t[0][0]||e>t[o][1])return!1;for(;o>=i;)if(s=i+o>>1,e>t[s][1])i=s+1;else{if(!(e<t[s][0]))return!0;o=s-1}return!1}(e,i)?0:e>=131072&&e<=196605||e>=196608&&e<=262141?2:1}}},5981:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WriteBuffer=void 0;const i=s(8460),o=s(844);class r extends o.Disposable{constructor(e){super(),this._action=e,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new i.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(e,t){if(void 0!==t&&this._syncCalls>t)return void(this._syncCalls=0);if(this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let s;for(this._isSyncWriting=!0;s=this._writeBuffer.shift();){this._action(s);const e=this._callbacks.shift();e&&e()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(e,t){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t)}_innerWrite(e=0,t=!0){const s=e||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const e=this._writeBuffer[this._bufferOffset],i=this._action(e,t);if(i){const e=e=>Date.now()-s>=12?setTimeout(()=>this._innerWrite(0,e)):this._innerWrite(s,e);return void i.catch(e=>(queueMicrotask(()=>{throw e}),Promise.resolve(!1))).then(e)}const o=this._callbacks[this._bufferOffset];if(o&&o(),this._bufferOffset++,this._pendingData-=e.length,Date.now()-s>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}t.WriteBuffer=r},5941:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toRgbString=t.parseColor=void 0;const s=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,i=/^[\da-f]+$/;function o(e,t){const s=e.toString(16),i=s.length<2?"0"+s:s;switch(t){case 4:return s[0];case 8:return i;case 12:return(i+i).slice(0,3);default:return i+i}}t.parseColor=function(e){if(!e)return;let t=e.toLowerCase();if(0===t.indexOf("rgb:")){t=t.slice(4);const e=s.exec(t);if(e){const t=e[1]?15:e[4]?255:e[7]?4095:65535;return[Math.round(parseInt(e[1]||e[4]||e[7]||e[10],16)/t*255),Math.round(parseInt(e[2]||e[5]||e[8]||e[11],16)/t*255),Math.round(parseInt(e[3]||e[6]||e[9]||e[12],16)/t*255)]}}else if(0===t.indexOf("#")&&(t=t.slice(1),i.exec(t)&&[3,6,9,12].includes(t.length))){const e=t.length/3,s=[0,0,0];for(let i=0;i<3;++i){const o=parseInt(t.slice(e*i,e*i+e),16);s[i]=1===e?o<<4:2===e?o:3===e?o>>4:o>>8}return s}},t.toRgbString=function(e,t=16){const[s,i,r]=e;return`rgb:${o(s,t)}/${o(i,t)}/${o(r,t)}`}},5770:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PAYLOAD_LIMIT=void 0,t.PAYLOAD_LIMIT=1e7},6351:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DcsHandler=t.DcsParser=void 0;const i=s(482),o=s(8742),r=s(5770),a=[];t.DcsParser=class{constructor(){this._handlers=/* @__PURE__ */Object.create(null),this._active=a,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=/* @__PURE__ */Object.create(null),this._handlerFb=()=>{},this._active=a}registerHandler(e,t){void 0===this._handlers[e]&&(this._handlers[e]=[]);const s=this._handlers[e];return s.push(t),{dispose:()=>{const e=s.indexOf(t);-1!==e&&s.splice(e,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}reset(){if(this._active.length)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].unhook(!1);this._stack.paused=!1,this._active=a,this._ident=0}hook(e,t){if(this.reset(),this._ident=e,this._active=this._handlers[e]||a,this._active.length)for(let s=this._active.length-1;s>=0;s--)this._active[s].hook(t);else this._handlerFb(this._ident,"HOOK",t)}put(e,t,s){if(this._active.length)for(let i=this._active.length-1;i>=0;i--)this._active[i].put(e,t,s);else this._handlerFb(this._ident,"PUT",(0,i.utf32ToString)(e,t,s))}unhook(e,t=!0){if(this._active.length){let s=!1,i=this._active.length-1,o=!1;if(this._stack.paused&&(i=this._stack.loopPosition-1,s=t,o=this._stack.fallThrough,this._stack.paused=!1),!o&&!1===s){for(;i>=0&&(s=this._active[i].unhook(e),!0!==s);i--)if(s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!1,s;i--}for(;i>=0;i--)if(s=this._active[i].unhook(!1),s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!0,s}else this._handlerFb(this._ident,"UNHOOK",e);this._active=a,this._ident=0}};const n=new o.Params;n.addParam(0),t.DcsHandler=class{constructor(e){this._handler=e,this._data="",this._params=n,this._hitLimit=!1}hook(e){this._params=e.length>1||e.params[0]?e.clone():n,this._data="",this._hitLimit=!1}put(e,t,s){this._hitLimit||(this._data+=(0,i.utf32ToString)(e,t,s),this._data.length>r.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data,this._params),t instanceof Promise))return t.then(e=>(this._params=n,this._data="",this._hitLimit=!1,e));return this._params=n,this._data="",this._hitLimit=!1,t}}},2015:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EscapeSequenceParser=t.VT500_TRANSITION_TABLE=t.TransitionTable=void 0;const i=s(844),o=s(8742),r=s(6242),a=s(6351);class n{constructor(e){this.table=new Uint8Array(e)}setDefault(e,t){this.table.fill(e<<4|t)}add(e,t,s,i){this.table[t<<8|e]=s<<4|i}addMany(e,t,s,i){for(let o=0;o<e.length;o++)this.table[t<<8|e[o]]=s<<4|i}}t.TransitionTable=n;const l=160;t.VT500_TRANSITION_TABLE=function(){const e=new n(4095),t=Array.apply(null,Array(256)).map((e,t)=>t),s=(e,s)=>t.slice(e,s),i=s(32,127),o=s(0,24);o.push(25),o.push.apply(o,s(28,32));const r=s(0,14);let a;for(a in e.setDefault(1,0),e.addMany(i,0,2,0),r)e.addMany([24,26,153,154],a,3,0),e.addMany(s(128,144),a,3,0),e.addMany(s(144,152),a,3,0),e.add(156,a,0,0),e.add(27,a,11,1),e.add(157,a,4,8),e.addMany([152,158,159],a,0,7),e.add(155,a,11,3),e.add(144,a,11,9);return e.addMany(o,0,3,0),e.addMany(o,1,3,1),e.add(127,1,0,1),e.addMany(o,8,0,8),e.addMany(o,3,3,3),e.add(127,3,0,3),e.addMany(o,4,3,4),e.add(127,4,0,4),e.addMany(o,6,3,6),e.addMany(o,5,3,5),e.add(127,5,0,5),e.addMany(o,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(i,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(s(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(i,7,0,7),e.addMany(o,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(s(64,127),3,7,0),e.addMany(s(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(s(48,60),4,8,4),e.addMany(s(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(s(32,64),6,0,6),e.add(127,6,0,6),e.addMany(s(64,127),6,0,0),e.addMany(s(32,48),3,9,5),e.addMany(s(32,48),5,9,5),e.addMany(s(48,64),5,0,6),e.addMany(s(64,127),5,7,0),e.addMany(s(32,48),4,9,5),e.addMany(s(32,48),1,9,2),e.addMany(s(32,48),2,9,2),e.addMany(s(48,127),2,10,0),e.addMany(s(48,80),1,10,0),e.addMany(s(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(s(96,127),1,10,0),e.add(80,1,11,9),e.addMany(o,9,0,9),e.add(127,9,0,9),e.addMany(s(28,32),9,0,9),e.addMany(s(32,48),9,9,12),e.addMany(s(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(o,11,0,11),e.addMany(s(32,128),11,0,11),e.addMany(s(28,32),11,0,11),e.addMany(o,10,0,10),e.add(127,10,0,10),e.addMany(s(28,32),10,0,10),e.addMany(s(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(s(32,48),10,9,12),e.addMany(o,12,0,12),e.add(127,12,0,12),e.addMany(s(28,32),12,0,12),e.addMany(s(32,48),12,9,12),e.addMany(s(48,64),12,0,11),e.addMany(s(64,127),12,12,13),e.addMany(s(64,127),10,12,13),e.addMany(s(64,127),9,12,13),e.addMany(o,13,13,13),e.addMany(i,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(l,0,2,0),e.add(l,8,5,8),e.add(l,6,0,6),e.add(l,11,0,11),e.add(l,13,13,13),e}();class c extends i.Disposable{constructor(e=t.VT500_TRANSITION_TABLE){super(),this._transitions=e,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new o.Params,this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._printHandlerFb=(e,t,s)=>{},this._executeHandlerFb=e=>{},this._csiHandlerFb=(e,t)=>{},this._escHandlerFb=e=>{},this._errorHandlerFb=e=>e,this._printHandler=this._printHandlerFb,this._executeHandlers=/* @__PURE__ */Object.create(null),this._csiHandlers=/* @__PURE__ */Object.create(null),this._escHandlers=/* @__PURE__ */Object.create(null),this.register((0,i.toDisposable)(()=>{this._csiHandlers=/* @__PURE__ */Object.create(null),this._executeHandlers=/* @__PURE__ */Object.create(null),this._escHandlers=/* @__PURE__ */Object.create(null)})),this._oscParser=this.register(new r.OscParser),this._dcsParser=this.register(new a.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(e,t=[64,126]){let s=0;if(e.prefix){if(e.prefix.length>1)throw new Error("only one byte as prefix supported");if(s=e.prefix.charCodeAt(0),s&&60>s||s>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(e.intermediates){if(e.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let t=0;t<e.intermediates.length;++t){const i=e.intermediates.charCodeAt(t);if(32>i||i>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");s<<=8,s|=i}}if(1!==e.final.length)throw new Error("final must be a single byte");const i=e.final.charCodeAt(0);if(t[0]>i||i>t[1])throw new Error(`final must be in range ${t[0]} .. ${t[1]}`);return s<<=8,s|=i,s}identToString(e){const t=[];for(;e;)t.push(String.fromCharCode(255&e)),e>>=8;return t.reverse().join("")}setPrintHandler(e){this._printHandler=e}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(e,t){const s=this._identifier(e,[48,126]);void 0===this._escHandlers[s]&&(this._escHandlers[s]=[]);const i=this._escHandlers[s];return i.push(t),{dispose:()=>{const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}}clearEscHandler(e){this._escHandlers[this._identifier(e,[48,126])]&&delete this._escHandlers[this._identifier(e,[48,126])]}setEscHandlerFallback(e){this._escHandlerFb=e}setExecuteHandler(e,t){this._executeHandlers[e.charCodeAt(0)]=t}clearExecuteHandler(e){this._executeHandlers[e.charCodeAt(0)]&&delete this._executeHandlers[e.charCodeAt(0)]}setExecuteHandlerFallback(e){this._executeHandlerFb=e}registerCsiHandler(e,t){const s=this._identifier(e);void 0===this._csiHandlers[s]&&(this._csiHandlers[s]=[]);const i=this._csiHandlers[s];return i.push(t),{dispose:()=>{const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}}clearCsiHandler(e){this._csiHandlers[this._identifier(e)]&&delete this._csiHandlers[this._identifier(e)]}setCsiHandlerFallback(e){this._csiHandlerFb=e}registerDcsHandler(e,t){return this._dcsParser.registerHandler(this._identifier(e),t)}clearDcsHandler(e){this._dcsParser.clearHandler(this._identifier(e))}setDcsHandlerFallback(e){this._dcsParser.setHandlerFallback(e)}registerOscHandler(e,t){return this._oscParser.registerHandler(e,t)}clearOscHandler(e){this._oscParser.clearHandler(e)}setOscHandlerFallback(e){this._oscParser.setHandlerFallback(e)}setErrorHandler(e){this._errorHandler=e}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,0!==this._parseStack.state&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(e,t,s,i,o){this._parseStack.state=e,this._parseStack.handlers=t,this._parseStack.handlerPos=s,this._parseStack.transition=i,this._parseStack.chunkPos=o}parse(e,t,s){let i,o=0,r=0,a=0;if(this._parseStack.state)if(2===this._parseStack.state)this._parseStack.state=0,a=this._parseStack.chunkPos+1;else{if(void 0===s||1===this._parseStack.state)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const t=this._parseStack.handlers;let r=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(!1===s&&r>-1)for(;r>=0&&(i=t[r](this._params),!0!==i);r--)if(i instanceof Promise)return this._parseStack.handlerPos=r,i;this._parseStack.handlers=[];break;case 4:if(!1===s&&r>-1)for(;r>=0&&(i=t[r](),!0!==i);r--)if(i instanceof Promise)return this._parseStack.handlerPos=r,i;this._parseStack.handlers=[];break;case 6:if(o=e[this._parseStack.chunkPos],i=this._dcsParser.unhook(24!==o&&26!==o,s),i)return i;27===o&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(o=e[this._parseStack.chunkPos],i=this._oscParser.end(24!==o&&26!==o,s),i)return i;27===o&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,a=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}for(let n=a;n<t;++n){switch(o=e[n],r=this._transitions.table[this.currentState<<8|(o<160?o:l)],r>>4){case 2:for(let i=n+1;;++i){if(i>=t||(o=e[i])<32||o>126&&o<l){this._printHandler(e,n,i),n=i-1;break}if(++i>=t||(o=e[i])<32||o>126&&o<l){this._printHandler(e,n,i),n=i-1;break}if(++i>=t||(o=e[i])<32||o>126&&o<l){this._printHandler(e,n,i),n=i-1;break}if(++i>=t||(o=e[i])<32||o>126&&o<l){this._printHandler(e,n,i),n=i-1;break}}break;case 3:this._executeHandlers[o]?this._executeHandlers[o]():this._executeHandlerFb(o),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:n,code:o,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const s=this._csiHandlers[this._collect<<8|o];let a=s?s.length-1:-1;for(;a>=0&&(i=s[a](this._params),!0!==i);a--)if(i instanceof Promise)return this._preserveStack(3,s,a,r,n),i;a<0&&this._csiHandlerFb(this._collect<<8|o,this._params),this.precedingCodepoint=0;break;case 8:do{switch(o){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(o-48)}}while(++n<t&&(o=e[n])>47&&o<60);n--;break;case 9:this._collect<<=8,this._collect|=o;break;case 10:const c=this._escHandlers[this._collect<<8|o];let d=c?c.length-1:-1;for(;d>=0&&(i=c[d](),!0!==i);d--)if(i instanceof Promise)return this._preserveStack(4,c,d,r,n),i;d<0&&this._escHandlerFb(this._collect<<8|o),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|o,this._params);break;case 13:for(let i=n+1;;++i)if(i>=t||24===(o=e[i])||26===o||27===o||o>127&&o<l){this._dcsParser.put(e,n,i),n=i-1;break}break;case 14:if(i=this._dcsParser.unhook(24!==o&&26!==o),i)return this._preserveStack(6,[],0,r,n),i;27===o&&(r|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(let i=n+1;;i++)if(i>=t||(o=e[i])<32||o>127&&o<l){this._oscParser.put(e,n,i),n=i-1;break}break;case 6:if(i=this._oscParser.end(24!==o&&26!==o),i)return this._preserveStack(5,[],0,r,n),i;27===o&&(r|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&r}}}t.EscapeSequenceParser=c},6242:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OscHandler=t.OscParser=void 0;const i=s(5770),o=s(482),r=[];t.OscParser=class{constructor(){this._state=0,this._active=r,this._id=-1,this._handlers=/* @__PURE__ */Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(e,t){void 0===this._handlers[e]&&(this._handlers[e]=[]);const s=this._handlers[e];return s.push(t),{dispose:()=>{const e=s.indexOf(t);-1!==e&&s.splice(e,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}dispose(){this._handlers=/* @__PURE__ */Object.create(null),this._handlerFb=()=>{},this._active=r}reset(){if(2===this._state)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].end(!1);this._stack.paused=!1,this._active=r,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||r,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].start();else this._handlerFb(this._id,"START")}_put(e,t,s){if(this._active.length)for(let i=this._active.length-1;i>=0;i--)this._active[i].put(e,t,s);else this._handlerFb(this._id,"PUT",(0,o.utf32ToString)(e,t,s))}start(){this.reset(),this._state=1}put(e,t,s){if(3!==this._state){if(1===this._state)for(;t<s;){const s=e[t++];if(59===s){this._state=2,this._start();break}if(s<48||57<s)return void(this._state=3);-1===this._id&&(this._id=0),this._id=10*this._id+s-48}2===this._state&&s-t>0&&this._put(e,t,s)}}end(e,t=!0){if(0!==this._state){if(3!==this._state)if(1===this._state&&this._start(),this._active.length){let s=!1,i=this._active.length-1,o=!1;if(this._stack.paused&&(i=this._stack.loopPosition-1,s=t,o=this._stack.fallThrough,this._stack.paused=!1),!o&&!1===s){for(;i>=0&&(s=this._active[i].end(e),!0!==s);i--)if(s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!1,s;i--}for(;i>=0;i--)if(s=this._active[i].end(!1),s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!0,s}else this._handlerFb(this._id,"END",e);this._active=r,this._id=-1,this._state=0}}},t.OscHandler=class{constructor(e){this._handler=e,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(e,t,s){this._hitLimit||(this._data+=(0,o.utf32ToString)(e,t,s),this._data.length>i.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data),t instanceof Promise))return t.then(e=>(this._data="",this._hitLimit=!1,e));return this._data="",this._hitLimit=!1,t}}},8742:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Params=void 0;const s=2147483647;class i{static fromArray(e){const t=new i;if(!e.length)return t;for(let s=Array.isArray(e[0])?1:0;s<e.length;++s){const i=e[s];if(Array.isArray(i))for(let e=0;e<i.length;++e)t.addSubParam(i[e]);else t.addParam(i)}return t}constructor(e=32,t=32){if(this.maxLength=e,this.maxSubParamsLength=t,t>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(e),this.length=0,this._subParams=new Int32Array(t),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(e),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const e=new i(this.maxLength,this.maxSubParamsLength);return e.params.set(this.params),e.length=this.length,e._subParams.set(this._subParams),e._subParamsLength=this._subParamsLength,e._subParamsIdx.set(this._subParamsIdx),e._rejectDigits=this._rejectDigits,e._rejectSubDigits=this._rejectSubDigits,e._digitIsSub=this._digitIsSub,e}toArray(){const e=[];for(let t=0;t<this.length;++t){e.push(this.params[t]);const s=this._subParamsIdx[t]>>8,i=255&this._subParamsIdx[t];i-s>0&&e.push(Array.prototype.slice.call(this._subParams,s,i))}return e}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(e){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(e<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=e>s?s:e}}addSubParam(e){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(e<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=e>s?s:e,this._subParamsIdx[this.length-1]++}}hasSubParams(e){return(255&this._subParamsIdx[e])-(this._subParamsIdx[e]>>8)>0}getSubParams(e){const t=this._subParamsIdx[e]>>8,s=255&this._subParamsIdx[e];return s-t>0?this._subParams.subarray(t,s):null}getSubParamsAll(){const e={};for(let t=0;t<this.length;++t){const s=this._subParamsIdx[t]>>8,i=255&this._subParamsIdx[t];i-s>0&&(e[t]=this._subParams.slice(s,i))}return e}addDigit(e){let t;if(this._rejectDigits||!(t=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const i=this._digitIsSub?this._subParams:this.params,o=i[t-1];i[t-1]=~o?Math.min(10*o+e,s):e}}t.Params=i},5741:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AddonManager=void 0,t.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let e=this._addons.length-1;e>=0;e--)this._addons[e].instance.dispose()}loadAddon(e,t){const s={instance:t,dispose:t.dispose,isDisposed:!1};this._addons.push(s),t.dispose=()=>this._wrappedAddonDispose(s),t.activate(e)}_wrappedAddonDispose(e){if(e.isDisposed)return;let t=-1;for(let s=0;s<this._addons.length;s++)if(this._addons[s]===e){t=s;break}if(-1===t)throw new Error("Could not dispose an addon that has not been loaded");e.isDisposed=!0,e.dispose.apply(e.instance),this._addons.splice(t,1)}}},8771:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferApiView=void 0;const i=s(3785),o=s(511);t.BufferApiView=class{constructor(e,t){this._buffer=e,this.type=t}init(e){return this._buffer=e,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(e){const t=this._buffer.lines.get(e);if(t)return new i.BufferLineApiView(t)}getNullCell(){return new o.CellData}}},3785:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLineApiView=void 0;const i=s(511);t.BufferLineApiView=class{constructor(e){this._line=e}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(e,t){if(!(e<0||e>=this._line.length))return t?(this._line.loadCell(e,t),t):this._line.loadCell(e,new i.CellData)}translateToString(e,t,s){return this._line.translateToString(e,t,s)}}},8285:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferNamespaceApi=void 0;const i=s(8771),o=s(8460),r=s(844);class a extends r.Disposable{constructor(e){super(),this._core=e,this._onBufferChange=this.register(new o.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new i.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new i.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}t.BufferNamespaceApi=a},7975:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ParserApi=void 0,t.ParserApi=class{constructor(e){this._core=e}registerCsiHandler(e,t){return this._core.registerCsiHandler(e,e=>t(e.toArray()))}addCsiHandler(e,t){return this.registerCsiHandler(e,t)}registerDcsHandler(e,t){return this._core.registerDcsHandler(e,(e,s)=>t(e,s.toArray()))}addDcsHandler(e,t){return this.registerDcsHandler(e,t)}registerEscHandler(e,t){return this._core.registerEscHandler(e,t)}addEscHandler(e,t){return this.registerEscHandler(e,t)}registerOscHandler(e,t){return this._core.registerOscHandler(e,t)}addOscHandler(e,t){return this.registerOscHandler(e,t)}}},7090:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeApi=void 0,t.UnicodeApi=class{constructor(e){this._core=e}register(e){this._core.unicodeService.register(e)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(e){this._core.unicodeService.activeVersion=e}}},744:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferService=t.MINIMUM_ROWS=t.MINIMUM_COLS=void 0;const r=s(8460),a=s(844),n=s(5295),l=s(2585);t.MINIMUM_COLS=2,t.MINIMUM_ROWS=1;let c=t.BufferService=class extends a.Disposable{get buffer(){return this.buffers.active}constructor(e){super(),this.isUserScrolling=!1,this._onResize=this.register(new r.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new r.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,t.MINIMUM_COLS),this.rows=Math.max(e.rawOptions.rows||0,t.MINIMUM_ROWS),this.buffers=this.register(new n.BufferSet(e,this))}resize(e,t){this.cols=e,this.rows=t,this.buffers.resize(e,t),this._onResize.fire({cols:e,rows:t})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,t=!1){const s=this.buffer;let i;i=this._cachedBlankLine,i&&i.length===this.cols&&i.getFg(0)===e.fg&&i.getBg(0)===e.bg||(i=s.getBlankLine(e,t),this._cachedBlankLine=i),i.isWrapped=t;const o=s.ybase+s.scrollTop,r=s.ybase+s.scrollBottom;if(0===s.scrollTop){const e=s.lines.isFull;r===s.lines.length-1?e?s.lines.recycle().copyFrom(i):s.lines.push(i.clone()):s.lines.splice(r+1,0,i.clone()),e?this.isUserScrolling&&(s.ydisp=Math.max(s.ydisp-1,0)):(s.ybase++,this.isUserScrolling||s.ydisp++)}else{const e=r-o+1;s.lines.shiftElements(o+1,e-1,-1),s.lines.set(r,i.clone())}this.isUserScrolling||(s.ydisp=s.ybase),this._onScroll.fire(s.ydisp)}scrollLines(e,t,s){const i=this.buffer;if(e<0){if(0===i.ydisp)return;this.isUserScrolling=!0}else e+i.ydisp>=i.ybase&&(this.isUserScrolling=!1);const o=i.ydisp;i.ydisp=Math.max(Math.min(i.ydisp+e,i.ybase),0),o!==i.ydisp&&(t||this._onScroll.fire(i.ydisp))}};t.BufferService=c=i([o(0,l.IOptionsService)],c)},7994:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CharsetService=void 0,t.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(e){this.glevel=e,this.charset=this._charsets[e]}setgCharset(e,t){this._charsets[e]=t,this.glevel===e&&(this.charset=t)}}},1753:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreMouseService=void 0;const r=s(2585),a=s(8460),n=s(844),l={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:e=>4!==e.button&&1===e.action&&(e.ctrl=!1,e.alt=!1,e.shift=!1,!0)},VT200:{events:19,restrict:e=>32!==e.action},DRAG:{events:23,restrict:e=>32!==e.action||3!==e.button},ANY:{events:31,restrict:e=>!0}};function c(e,t){let s=(e.ctrl?16:0)|(e.shift?4:0)|(e.alt?8:0);return 4===e.button?(s|=64,s|=e.action):(s|=3&e.button,4&e.button&&(s|=64),8&e.button&&(s|=128),32===e.action?s|=32:0!==e.action||t||(s|=3)),s}const d=String.fromCharCode,h={DEFAULT:e=>{const t=[c(e,!1)+32,e.col+32,e.row+32];return t[0]>255||t[1]>255||t[2]>255?"":`[M${d(t[0])}${d(t[1])}${d(t[2])}`},SGR:e=>{const t=0===e.action&&4!==e.button?"m":"M";return`[<${c(e,!0)};${e.col};${e.row}${t}`},SGR_PIXELS:e=>{const t=0===e.action&&4!==e.button?"m":"M";return`[<${c(e,!0)};${e.x};${e.y}${t}`}};let u=t.CoreMouseService=class extends n.Disposable{constructor(e,t){super(),this._bufferService=e,this._coreService=t,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new a.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const s of Object.keys(l))this.addProtocol(s,l[s]);for(const s of Object.keys(h))this.addEncoding(s,h[s]);this.reset()}addProtocol(e,t){this._protocols[e]=t}addEncoding(e,t){this._encodings[e]=t}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return 0!==this._protocols[this._activeProtocol].events}set activeProtocol(e){if(!this._protocols[e])throw new Error(`unknown protocol "${e}"`);this._activeProtocol=e,this._onProtocolChange.fire(this._protocols[e].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(e){if(!this._encodings[e])throw new Error(`unknown encoding "${e}"`);this._activeEncoding=e}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(e){if(e.col<0||e.col>=this._bufferService.cols||e.row<0||e.row>=this._bufferService.rows)return!1;if(4===e.button&&32===e.action)return!1;if(3===e.button&&32!==e.action)return!1;if(4!==e.button&&(2===e.action||3===e.action))return!1;if(e.col++,e.row++,32===e.action&&this._lastEvent&&this._equalEvents(this._lastEvent,e,"SGR_PIXELS"===this._activeEncoding))return!1;if(!this._protocols[this._activeProtocol].restrict(e))return!1;const t=this._encodings[this._activeEncoding](e);return t&&("DEFAULT"===this._activeEncoding?this._coreService.triggerBinaryEvent(t):this._coreService.triggerDataEvent(t,!0)),this._lastEvent=e,!0}explainEvents(e){return{down:!!(1&e),up:!!(2&e),drag:!!(4&e),move:!!(8&e),wheel:!!(16&e)}}_equalEvents(e,t,s){if(s){if(e.x!==t.x)return!1;if(e.y!==t.y)return!1}else{if(e.col!==t.col)return!1;if(e.row!==t.row)return!1}return e.button===t.button&&e.action===t.action&&e.ctrl===t.ctrl&&e.alt===t.alt&&e.shift===t.shift}};t.CoreMouseService=u=i([o(0,r.IBufferService),o(1,r.ICoreService)],u)},6975:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreService=void 0;const r=s(1439),a=s(8460),n=s(844),l=s(2585),c=Object.freeze({insertMode:!1}),d=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let h=t.CoreService=class extends n.Disposable{constructor(e,t,s){super(),this._bufferService=e,this._logService=t,this._optionsService=s,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new a.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new a.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new a.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new a.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,r.clone)(c),this.decPrivateModes=(0,r.clone)(d)}reset(){this.modes=(0,r.clone)(c),this.decPrivateModes=(0,r.clone)(d)}triggerDataEvent(e,t=!1){if(this._optionsService.rawOptions.disableStdin)return;const s=this._bufferService.buffer;t&&this._optionsService.rawOptions.scrollOnUserInput&&s.ybase!==s.ydisp&&this._onRequestScrollToBottom.fire(),t&&this._onUserInput.fire(),this._logService.debug(`sending data "${e}"`,()=>e.split("").map(e=>e.charCodeAt(0))),this._onData.fire(e)}triggerBinaryEvent(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${e}"`,()=>e.split("").map(e=>e.charCodeAt(0))),this._onBinary.fire(e))}};t.CoreService=h=i([o(0,l.IBufferService),o(1,l.ILogService),o(2,l.IOptionsService)],h)},9074:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DecorationService=void 0;const i=s(8055),o=s(8460),r=s(844),a=s(6106);let n=0,l=0;class c extends r.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new a.SortedList(e=>null==e?void 0:e.marker.line),this._onDecorationRegistered=this.register(new o.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new o.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,r.toDisposable)(()=>this.reset()))}registerDecoration(e){if(e.marker.isDisposed)return;const t=new d(e);if(t){const e=t.marker.onDispose(()=>t.dispose());t.onDispose(()=>{t&&(this._decorations.delete(t)&&this._onDecorationRemoved.fire(t),e.dispose())}),this._decorations.insert(t),this._onDecorationRegistered.fire(t)}return t}reset(){for(const e of this._decorations.values())e.dispose();this._decorations.clear()}*getDecorationsAtCell(e,t,s){var i,o,r;let a=0,n=0;for(const l of this._decorations.getKeyIterator(t))a=null!==(i=l.options.x)&&void 0!==i?i:0,n=a+(null!==(o=l.options.width)&&void 0!==o?o:1),e>=a&&e<n&&(!s||(null!==(r=l.options.layer)&&void 0!==r?r:"bottom")===s)&&(yield l)}forEachDecorationAtCell(e,t,s,i){this._decorations.forEachByKey(t,t=>{var o,r,a;n=null!==(o=t.options.x)&&void 0!==o?o:0,l=n+(null!==(r=t.options.width)&&void 0!==r?r:1),e>=n&&e<l&&(!s||(null!==(a=t.options.layer)&&void 0!==a?a:"bottom")===s)&&i(t)})}}t.DecorationService=c;class d extends r.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return null===this._cachedBg&&(this.options.backgroundColor?this._cachedBg=i.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return null===this._cachedFg&&(this.options.foregroundColor?this._cachedFg=i.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(e){super(),this.options=e,this.onRenderEmitter=this.register(new o.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new o.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=e.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InstantiationService=t.ServiceCollection=void 0;const i=s(2585),o=s(8343);class r{constructor(...e){this._entries=/* @__PURE__ */new Map;for(const[t,s]of e)this.set(t,s)}set(e,t){const s=this._entries.get(e);return this._entries.set(e,t),s}forEach(e){for(const[t,s]of this._entries.entries())e(t,s)}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}}t.ServiceCollection=r,t.InstantiationService=class{constructor(){this._services=new r,this._services.set(i.IInstantiationService,this)}setService(e,t){this._services.set(e,t)}getService(e){return this._services.get(e)}createInstance(e,...t){const s=(0,o.getServiceDependencies)(e).sort((e,t)=>e.index-t.index),i=[];for(const o of s){const t=this._services.get(o.id);if(!t)throw new Error(`[createInstance] ${e.name} depends on UNKNOWN service ${o.id}.`);i.push(t)}const r=s.length>0?s[0].index:t.length;if(t.length!==r)throw new Error(`[createInstance] First service dependency of ${e.name} at position ${r+1} conflicts with ${t.length} static arguments`);return new e(...[...t,...i])}}},7866:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.traceCall=t.setTraceLogger=t.LogService=void 0;const r=s(844),a=s(2585),n={trace:a.LogLevelEnum.TRACE,debug:a.LogLevelEnum.DEBUG,info:a.LogLevelEnum.INFO,warn:a.LogLevelEnum.WARN,error:a.LogLevelEnum.ERROR,off:a.LogLevelEnum.OFF};let l,c=t.LogService=class extends r.Disposable{get logLevel(){return this._logLevel}constructor(e){super(),this._optionsService=e,this._logLevel=a.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),l=this}_updateLogLevel(){this._logLevel=n[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let t=0;t<e.length;t++)"function"==typeof e[t]&&(e[t]=e[t]())}_log(e,t,s){this._evalLazyOptionalParams(s),e.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+t,...s)}trace(e,...t){var s,i;this._logLevel<=a.LogLevelEnum.TRACE&&this._log(null!==(i=null===(s=this._optionsService.options.logger)||void 0===s?void 0:s.trace.bind(this._optionsService.options.logger))&&void 0!==i?i:console.log,e,t)}debug(e,...t){var s,i;this._logLevel<=a.LogLevelEnum.DEBUG&&this._log(null!==(i=null===(s=this._optionsService.options.logger)||void 0===s?void 0:s.debug.bind(this._optionsService.options.logger))&&void 0!==i?i:console.log,e,t)}info(e,...t){var s,i;this._logLevel<=a.LogLevelEnum.INFO&&this._log(null!==(i=null===(s=this._optionsService.options.logger)||void 0===s?void 0:s.info.bind(this._optionsService.options.logger))&&void 0!==i?i:console.info,e,t)}warn(e,...t){var s,i;this._logLevel<=a.LogLevelEnum.WARN&&this._log(null!==(i=null===(s=this._optionsService.options.logger)||void 0===s?void 0:s.warn.bind(this._optionsService.options.logger))&&void 0!==i?i:console.warn,e,t)}error(e,...t){var s,i;this._logLevel<=a.LogLevelEnum.ERROR&&this._log(null!==(i=null===(s=this._optionsService.options.logger)||void 0===s?void 0:s.error.bind(this._optionsService.options.logger))&&void 0!==i?i:console.error,e,t)}};t.LogService=c=i([o(0,a.IOptionsService)],c),t.setTraceLogger=function(e){l=e},t.traceCall=function(e,t,s){if("function"!=typeof s.value)throw new Error("not supported");const i=s.value;s.value=function(...e){if(l.logLevel!==a.LogLevelEnum.TRACE)return i.apply(this,e);l.trace(`GlyphRenderer#${i.name}(${e.map(e=>JSON.stringify(e)).join(", ")})`);const t=i.apply(this,e);return l.trace(`GlyphRenderer#${i.name} return`,t),t}}},7302:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OptionsService=t.DEFAULT_OPTIONS=void 0;const i=s(8460),o=s(844),r=s(6114);t.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:r.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const a=["normal","bold","100","200","300","400","500","600","700","800","900"];class n extends o.Disposable{constructor(e){super(),this._onOptionChange=this.register(new i.EventEmitter),this.onOptionChange=this._onOptionChange.event;const s=Object.assign({},t.DEFAULT_OPTIONS);for(const t in e)if(t in s)try{const i=e[t];s[t]=this._sanitizeAndValidateOption(t,i)}catch(o){console.error(o)}this.rawOptions=s,this.options=Object.assign({},s),this._setupOptions()}onSpecificOptionChange(e,t){return this.onOptionChange(s=>{s===e&&t(this.rawOptions[e])})}onMultipleOptionChange(e,t){return this.onOptionChange(s=>{-1!==e.indexOf(s)&&t()})}_setupOptions(){const e=e=>{if(!(e in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${e}"`);return this.rawOptions[e]},s=(e,s)=>{if(!(e in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${e}"`);s=this._sanitizeAndValidateOption(e,s),this.rawOptions[e]!==s&&(this.rawOptions[e]=s,this._onOptionChange.fire(e))};for(const t in this.rawOptions){const i={get:e.bind(this,t),set:s.bind(this,t)};Object.defineProperty(this.options,t,i)}}_sanitizeAndValidateOption(e,s){switch(e){case"cursorStyle":if(s||(s=t.DEFAULT_OPTIONS[e]),!/* @__PURE__ */function(e){return"block"===e||"underline"===e||"bar"===e}(s))throw new Error(`"${s}" is not a valid value for ${e}`);break;case"wordSeparator":s||(s=t.DEFAULT_OPTIONS[e]);break;case"fontWeight":case"fontWeightBold":if("number"==typeof s&&1<=s&&s<=1e3)break;s=a.includes(s)?s:t.DEFAULT_OPTIONS[e];break;case"cursorWidth":s=Math.floor(s);case"lineHeight":case"tabStopWidth":if(s<1)throw new Error(`${e} cannot be less than 1, value: ${s}`);break;case"minimumContrastRatio":s=Math.max(1,Math.min(21,Math.round(10*s)/10));break;case"scrollback":if((s=Math.min(s,4294967295))<0)throw new Error(`${e} cannot be less than 0, value: ${s}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(s<=0)throw new Error(`${e} cannot be less than or equal to 0, value: ${s}`);break;case"rows":case"cols":if(!s&&0!==s)throw new Error(`${e} must be numeric, value: ${s}`);break;case"windowsPty":s=null!=s?s:{}}return s}}t.OptionsService=n},2660:function(e,t,s){var i=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(r<3?o(a):r>3?o(t,s,a):o(t,s))||a);return r>3&&a&&Object.defineProperty(t,s,a),a},o=this&&this.__param||function(e,t){return function(s,i){t(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkService=void 0;const r=s(2585);let a=t.OscLinkService=class{constructor(e){this._bufferService=e,this._nextId=1,this._entriesWithId=/* @__PURE__ */new Map,this._dataByLinkId=/* @__PURE__ */new Map}registerLink(e){const t=this._bufferService.buffer;if(void 0===e.id){const s=t.addMarker(t.ybase+t.y),i={data:e,id:this._nextId++,lines:[s]};return s.onDispose(()=>this._removeMarkerFromLink(i,s)),this._dataByLinkId.set(i.id,i),i.id}const s=e,i=this._getEntryIdKey(s),o=this._entriesWithId.get(i);if(o)return this.addLineToLink(o.id,t.ybase+t.y),o.id;const r=t.addMarker(t.ybase+t.y),a={id:this._nextId++,key:this._getEntryIdKey(s),data:s,lines:[r]};return r.onDispose(()=>this._removeMarkerFromLink(a,r)),this._entriesWithId.set(a.key,a),this._dataByLinkId.set(a.id,a),a.id}addLineToLink(e,t){const s=this._dataByLinkId.get(e);if(s&&s.lines.every(e=>e.line!==t)){const e=this._bufferService.buffer.addMarker(t);s.lines.push(e),e.onDispose(()=>this._removeMarkerFromLink(s,e))}}getLinkData(e){var t;return null===(t=this._dataByLinkId.get(e))||void 0===t?void 0:t.data}_getEntryIdKey(e){return`${e.id};;${e.uri}`}_removeMarkerFromLink(e,t){const s=e.lines.indexOf(t);-1!==s&&(e.lines.splice(s,1),0===e.lines.length&&(void 0!==e.data.id&&this._entriesWithId.delete(e.key),this._dataByLinkId.delete(e.id)))}};t.OscLinkService=a=i([o(0,r.IBufferService)],a)},8343:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createDecorator=t.getServiceDependencies=t.serviceRegistry=void 0;const s="di$target",i="di$dependencies";t.serviceRegistry=/* @__PURE__ */new Map,t.getServiceDependencies=function(e){return e[i]||[]},t.createDecorator=function(e){if(t.serviceRegistry.has(e))return t.serviceRegistry.get(e);const o=function(e,t,r){if(3!==arguments.length)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");var a,n,l;a=o,l=r,(n=e)[s]===n?n[i].push({id:a,index:l}):(n[i]=[{id:a,index:l}],n[s]=n)};return o.toString=()=>e,t.serviceRegistry.set(e,o),o}},2585:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IDecorationService=t.IUnicodeService=t.IOscLinkService=t.IOptionsService=t.ILogService=t.LogLevelEnum=t.IInstantiationService=t.ICharsetService=t.ICoreService=t.ICoreMouseService=t.IBufferService=void 0;const i=s(8343);var o,r;t.IBufferService=(0,i.createDecorator)("BufferService"),t.ICoreMouseService=(0,i.createDecorator)("CoreMouseService"),t.ICoreService=(0,i.createDecorator)("CoreService"),t.ICharsetService=(0,i.createDecorator)("CharsetService"),t.IInstantiationService=(0,i.createDecorator)("InstantiationService"),(r=o||(t.LogLevelEnum=o={}))[r.TRACE=0]="TRACE",r[r.DEBUG=1]="DEBUG",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.OFF=5]="OFF",t.ILogService=(0,i.createDecorator)("LogService"),t.IOptionsService=(0,i.createDecorator)("OptionsService"),t.IOscLinkService=(0,i.createDecorator)("OscLinkService"),t.IUnicodeService=(0,i.createDecorator)("UnicodeService"),t.IDecorationService=(0,i.createDecorator)("DecorationService")},1480:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeService=void 0;const i=s(8460),o=s(225);t.UnicodeService=class{constructor(){this._providers=/* @__PURE__ */Object.create(null),this._active="",this._onChange=new i.EventEmitter,this.onChange=this._onChange.event;const e=new o.UnicodeV6;this.register(e),this._active=e.version,this._activeProvider=e}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(e){if(!this._providers[e])throw new Error(`unknown Unicode version "${e}"`);this._active=e,this._activeProvider=this._providers[e],this._onChange.fire(e)}register(e){this._providers[e.version]=e}wcwidth(e){return this._activeProvider.wcwidth(e)}getStringCellWidth(e){let t=0;const s=e.length;for(let i=0;i<s;++i){let o=e.charCodeAt(i);if(55296<=o&&o<=56319){if(++i>=s)return t+this.wcwidth(o);const r=e.charCodeAt(i);56320<=r&&r<=57343?o=1024*(o-55296)+r-56320+65536:t+=this.wcwidth(r)}t+=this.wcwidth(o)}return t}}}},t={};function s(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={exports:{}};return e[i].call(r.exports,r,r.exports,s),r.exports}var i={};return(()=>{var e=i;Object.defineProperty(e,"__esModule",{value:!0}),e.Terminal=void 0;const t=s(9042),o=s(3236),r=s(844),a=s(5741),n=s(8285),l=s(7975),c=s(7090),d=["cols","rows"];class h extends r.Disposable{constructor(e){super(),this._core=this.register(new o.Terminal(e)),this._addonManager=this.register(new a.AddonManager),this._publicOptions=Object.assign({},this._core.options);const t=e=>this._core.options[e],s=(e,t)=>{this._checkReadonlyOptions(e),this._core.options[e]=t};for(const i in this._core.options){const e={get:t.bind(this,i),set:s.bind(this,i)};Object.defineProperty(this._publicOptions,i,e)}}_checkReadonlyOptions(e){if(d.includes(e))throw new Error(`Option "${e}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new l.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new c.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new n.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const e=this._core.coreService.decPrivateModes;let t="none";switch(this._core.coreMouseService.activeProtocol){case"X10":t="x10";break;case"VT200":t="vt200";break;case"DRAG":t="drag";break;case"ANY":t="any"}return{applicationCursorKeysMode:e.applicationCursorKeys,applicationKeypadMode:e.applicationKeypad,bracketedPasteMode:e.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:t,originMode:e.origin,reverseWraparoundMode:e.reverseWraparound,sendFocusMode:e.sendFocus,wraparoundMode:e.wraparound}}get options(){return this._publicOptions}set options(e){for(const t in e)this._publicOptions[t]=e[t]}blur(){this._core.blur()}focus(){this._core.focus()}resize(e,t){this._verifyIntegers(e,t),this._core.resize(e,t)}open(e){this._core.open(e)}attachCustomKeyEventHandler(e){this._core.attachCustomKeyEventHandler(e)}registerLinkProvider(e){return this._core.registerLinkProvider(e)}registerCharacterJoiner(e){return this._checkProposedApi(),this._core.registerCharacterJoiner(e)}deregisterCharacterJoiner(e){this._checkProposedApi(),this._core.deregisterCharacterJoiner(e)}registerMarker(e=0){return this._verifyIntegers(e),this._core.registerMarker(e)}registerDecoration(e){var t,s,i;return this._checkProposedApi(),this._verifyPositiveIntegers(null!==(t=e.x)&&void 0!==t?t:0,null!==(s=e.width)&&void 0!==s?s:0,null!==(i=e.height)&&void 0!==i?i:0),this._core.registerDecoration(e)}hasSelection(){return this._core.hasSelection()}select(e,t,s){this._verifyIntegers(e,t,s),this._core.select(e,t,s)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(e,t){this._verifyIntegers(e,t),this._core.selectLines(e,t)}dispose(){super.dispose()}scrollLines(e){this._verifyIntegers(e),this._core.scrollLines(e)}scrollPages(e){this._verifyIntegers(e),this._core.scrollPages(e)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(e){this._verifyIntegers(e),this._core.scrollToLine(e)}clear(){this._core.clear()}write(e,t){this._core.write(e,t)}writeln(e,t){this._core.write(e),this._core.write("\r\n",t)}paste(e){this._core.paste(e)}refresh(e,t){this._verifyIntegers(e,t),this._core.refresh(e,t)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(e){this._addonManager.loadAddon(this,e)}static get strings(){return t}_verifyIntegers(...e){for(const t of e)if(t===1/0||isNaN(t)||t%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...e){for(const t of e)if(t&&(t===1/0||isNaN(t)||t%1!=0||t<0))throw new Error("This API only accepts positive integers")}}e.Terminal=h})(),i})())),Ce.exports),Me={exports:{}};var Ae,Ie=(De||(De=1,function(e){!function(t,s){e.exports=s()}(self,()=>{return e={},(()=>{var t=e;Object.defineProperty(t,"__esModule",{value:!0}),t.FitAddon=void 0,t.FitAddon=class{activate(e){this._terminal=e}dispose(){}fit(){const e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;const t=this._terminal._core;this._terminal.rows===e.rows&&this._terminal.cols===e.cols||(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){if(!this._terminal)return;if(!this._terminal.element||!this._terminal.element.parentElement)return;const e=this._terminal._core,t=e._renderService.dimensions;if(0===t.css.cell.width||0===t.css.cell.height)return;const s=0===this._terminal.options.scrollback?0:e.viewport.scrollBarWidth,i=window.getComputedStyle(this._terminal.element.parentElement),o=parseInt(i.getPropertyValue("height")),r=Math.max(0,parseInt(i.getPropertyValue("width"))),a=window.getComputedStyle(this._terminal.element),n=o-(parseInt(a.getPropertyValue("padding-top"))+parseInt(a.getPropertyValue("padding-bottom"))),l=r-(parseInt(a.getPropertyValue("padding-right"))+parseInt(a.getPropertyValue("padding-left")))-s;return{cols:Math.max(2,Math.floor(l/t.css.cell.width)),rows:Math.max(1,Math.floor(n/t.css.cell.height))}}}})(),e;var e})}(Me)),Me.exports),Te={exports:{}};var Pe=(Ae||(Ae=1,function(e){!function(t,s){e.exports=s()}(self,()=>(()=>{var e={6:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkComputer=t.WebLinkProvider=void 0,t.WebLinkProvider=class{constructor(e,t,s,i={}){this._terminal=e,this._regex=t,this._handler=s,this._options=i}provideLinks(e,t){const i=s.computeLink(e,this._regex,this._terminal,this._handler);t(this._addCallbacks(i))}_addCallbacks(e){return e.map(e=>(e.leave=this._options.leave,e.hover=(t,s)=>{if(this._options.hover){const{range:i}=e;this._options.hover(t,s,i)}},e))}};class s{static computeLink(e,t,i,o){const r=new RegExp(t.source,(t.flags||"")+"g"),[a,n]=s._getWindowedLineStrings(e-1,i),l=a.join("");let c;const d=[];for(;c=r.exec(l);){const e=c[0];try{const t=new URL(e),s=decodeURI(t.toString());if(e!==s&&e+"/"!==s)continue}catch(h){continue}const[t,r]=s._mapStrIdx(i,n,0,c.index),[a,l]=s._mapStrIdx(i,t,r,e.length);if(-1===t||-1===r||-1===a||-1===l)continue;const u={start:{x:r+1,y:t+1},end:{x:l,y:a+1}};d.push({range:u,text:e,activate:o})}return d}static _getWindowedLineStrings(e,t){let s,i=e,o=e,r=0,a="";const n=[];if(s=t.buffer.active.getLine(e)){const e=s.translateToString(!0);if(s.isWrapped&&" "!==e[0]){for(r=0;(s=t.buffer.active.getLine(--i))&&r<2048&&(a=s.translateToString(!0),r+=a.length,n.push(a),s.isWrapped&&-1===a.indexOf(" ")););n.reverse()}for(n.push(e),r=0;(s=t.buffer.active.getLine(++o))&&s.isWrapped&&r<2048&&(a=s.translateToString(!0),r+=a.length,n.push(a),-1===a.indexOf(" ")););}return[n,i]}static _mapStrIdx(e,t,s,i){const o=e.buffer.active,r=o.getNullCell();let a=s;for(;i;){const e=o.getLine(t);if(!e)return[-1,-1];for(let s=a;s<e.length;++s){e.getCell(s,r);const a=r.getChars();if(r.getWidth()&&(i-=a.length||1,s===e.length-1&&""===a)){const e=o.getLine(t+1);e&&e.isWrapped&&(e.getCell(0,r),2===r.getWidth()&&(i+=1))}if(i<0)return[t,s]}t++,a=0}return[t,a]}}t.LinkComputer=s}},t={};function s(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,s),r.exports}var i={};return(()=>{var e=i;Object.defineProperty(e,"__esModule",{value:!0}),e.WebLinksAddon=void 0;const t=s(6),o=/https?:[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function r(e,t){const s=window.open();if(s){try{s.opener=null}catch(i){}s.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}e.WebLinksAddon=class{constructor(e=r,t={}){this._handler=e,this._options=t}activate(e){this._terminal=e;const s=this._options,i=s.urlRegex||o;this._linkProvider=this._terminal.registerLinkProvider(new t.WebLinkProvider(this._terminal,i,this._handler,s))}dispose(){var e;null===(e=this._linkProvider)||void 0===e||e.dispose()}}})(),i})())}(Te)),Te.exports);const Le=".xterm{cursor:text;position:relative;-moz-user-select:none;user-select:none;-ms-user-select:none;-webkit-user-select:none}.xterm.focus,.xterm:focus{outline:none}.xterm .xterm-helpers{position:absolute;top:0;z-index:5}.xterm .xterm-helper-textarea{padding:0;border:0;margin:0;position:absolute;opacity:0;left:-9999em;top:0;width:0;height:0;z-index:-5;white-space:nowrap;overflow:hidden;resize:none}.xterm .composition-view{background:#000;color:#fff;display:none;position:absolute;white-space:nowrap;z-index:1}.xterm .composition-view.active{display:block}.xterm .xterm-viewport{background-color:#000;overflow-y:scroll;cursor:default;position:absolute;inset:0}.xterm .xterm-screen{position:relative}.xterm .xterm-screen canvas{position:absolute;left:0;top:0}.xterm .xterm-scroll-area{visibility:hidden}.xterm-char-measure-element{display:inline-block;visibility:hidden;position:absolute;top:0;left:-9999em;line-height:normal}.xterm.enable-mouse-events{cursor:default}.xterm.xterm-cursor-pointer,.xterm .xterm-cursor-pointer{cursor:pointer}.xterm.column-select.focus{cursor:crosshair}.xterm .xterm-accessibility,.xterm .xterm-message{position:absolute;inset:0;z-index:10;color:transparent;pointer-events:none}.xterm .live-region{position:absolute;left:-9999px;width:1px;height:1px;overflow:hidden}.xterm-dim{opacity:1!important}.xterm-underline-1{text-decoration:underline}.xterm-underline-2{-webkit-text-decoration:double underline;text-decoration:double underline}.xterm-underline-3{-webkit-text-decoration:wavy underline;text-decoration:wavy underline}.xterm-underline-4{-webkit-text-decoration:dotted underline;text-decoration:dotted underline}.xterm-underline-5{-webkit-text-decoration:dashed underline;text-decoration:dashed underline}.xterm-overline{text-decoration:overline}.xterm-overline.xterm-underline-1{text-decoration:overline underline}.xterm-overline.xterm-underline-2{-webkit-text-decoration:overline double underline;text-decoration:overline double underline}.xterm-overline.xterm-underline-3{-webkit-text-decoration:overline wavy underline;text-decoration:overline wavy underline}.xterm-overline.xterm-underline-4{-webkit-text-decoration:overline dotted underline;text-decoration:overline dotted underline}.xterm-overline.xterm-underline-5{-webkit-text-decoration:overline dashed underline;text-decoration:overline dashed underline}.xterm-strikethrough{text-decoration:line-through}.xterm-screen .xterm-decoration-container .xterm-decoration{z-index:6;position:absolute}.xterm-screen .xterm-decoration-container .xterm-decoration.xterm-decoration-top-layer{z-index:7}.xterm-decoration-overview-ruler{z-index:8;position:absolute;top:0;right:0;pointer-events:none}.xterm-decoration-top{z-index:2;position:relative}";let Re=[],Oe=0;let Ne=0,Be=e=>{let t=[],s={get:()=>(s.lc||s.listen(()=>{})(),s.value),lc:0,listen:e=>(s.lc=t.push(e),()=>{for(let t=Oe+4;t<Re.length;)Re[t]===e?Re.splice(t,4):t+=4;let i=t.indexOf(e);~i&&(t.splice(i,1),--s.lc||s.off())}),notify(e,i){Ne++;let o=!Re.length;for(let r of t)Re.push(r,s.value,e,i);if(o){for(Oe=0;Oe<Re.length;Oe+=4)Re[Oe](Re[Oe+1],Re[Oe+2],Re[Oe+3]);Re.length=0}},off(){},set(e){let t=s.value;t!==e&&(s.value=e,s.notify(t))},subscribe(e){let t=s.listen(e);return e(s.value),t},value:e};return s};let Fe=(e,t)=>((e,t,s,i)=>(e.events=e.events||{},e.events[s+10]||(e.events[s+10]=i(t=>{e.events[s].reduceRight((e,t)=>(t(e),e),{shared:{},...t})})),e.events[s]=e.events[s]||[],e.events[s].push(t),()=>{let i=e.events[s],o=i.indexOf(t);i.splice(o,1),i.length||(delete e.events[s],e.events[s+10](),delete e.events[s+10])}))(e,s=>{let i=t(s);i&&e.events[6].push(i)},5,t=>{let s=e.listen;e.listen=(...i)=>(e.lc||e.active||(e.active=!0,t()),s(...i));let i=e.off;return e.events[6]=[],e.off=()=>{i(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let t of e.events[6])t();e.events[6]=[]}},1e3)},()=>{e.listen=s,e.off=i}}),ze=(e,t)=>((e,t)=>{let s,i;Array.isArray(e)||(e=[e]);let o=()=>{if(i===Ne)return;i=Ne;let o=e.map(e=>e.get());if(!s||o.some((e,t)=>e!==s[t])){s=o;let e=t(...o);e&&e.then&&e.t?e.then(e=>{s===o&&r.set(e)}):(r.set(e),i=Ne)}},r=Be(void 0),a=r.get;r.get=()=>(o(),a());let n=o;return Fe(r,()=>{let t=e.map(e=>e.listen(n));return o(),()=>{for(let e of t)e()}}),r})(e,t),Ue=(e={})=>{let t=Be(e);return t.setKey=function(e,s){let i=t.value;void 0===s&&e in t.value?(t.value={...t.value},delete t.value[e],t.notify(i,e)):t.value[e]!==s&&(t.value={...t.value,[e]:s},t.notify(i,e))},t};function Ve(e){const t=function(e){try{const t=e.split(".");if(3!==t.length)return console.error("[Auth] Invalid JWT format"),null;const s=t[1];if(!s)return console.error("[Auth] Missing JWT payload"),null;const i=atob(s.replace(/-/g,"+").replace(/_/g,"/"));return JSON.parse(i)}catch(t){return console.error("[Auth] Failed to decode JWT:",t),null}}(e);if(!t)/* @__PURE__ */
return new Set;const s=/* @__PURE__ */new Set;return t.permissions&&t.permissions.forEach(e=>s.add(e)),t.groups&&t.groups.forEach(e=>{s.add(`group:${e}`),"sudo"!==e&&"wheel"!==e&&"admin"!==e||(s.add("admin"),s.add("system:manage")),"docker"===e&&s.add("containers:manage")}),s}class je{static{this.TOKEN_KEY="jwt_token"}static{this.REFRESH_TOKEN_KEY="jwt_refresh_token"}static{this.EXPIRES_KEY="jwt_expires_at"}static{this.USER_KEY="jwt_user"}static save(e,t,s,i){try{const o=s<1e10?1e3*s:s;localStorage.setItem(this.TOKEN_KEY,e),localStorage.setItem(this.REFRESH_TOKEN_KEY,t),localStorage.setItem(this.EXPIRES_KEY,o.toString()),localStorage.setItem(this.USER_KEY,JSON.stringify(i)),console.log("[AuthStorage] Saved auth data",{hasToken:!!e,hasRefreshToken:!!t,expiresAt:new Date(o).toISOString()})}catch(o){console.error("[AuthStorage] Failed to save auth data:",o)}}static load(){try{const e=localStorage.getItem(this.TOKEN_KEY),t=localStorage.getItem(this.REFRESH_TOKEN_KEY),s=localStorage.getItem(this.EXPIRES_KEY),i=localStorage.getItem(this.USER_KEY);return{token:e,refreshToken:t,expiresAt:s?parseInt(s,10):null,user:i?JSON.parse(i):null}}catch(e){return console.error("[AuthStorage] Failed to load auth data:",e),{token:null,refreshToken:null,expiresAt:null,user:null}}}static clear(){try{localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.REFRESH_TOKEN_KEY),localStorage.removeItem(this.EXPIRES_KEY),localStorage.removeItem(this.USER_KEY),console.log("[AuthStorage] Cleared auth data")}catch(e){console.error("[AuthStorage] Failed to clear auth data:",e)}}static exists(){return!!localStorage.getItem(this.TOKEN_KEY)}}class He{static{this.lastActivity=Date.now()}static{this.activityListeners=/* @__PURE__ */new Set}static{this.initialized=!1}static init(){if(this.initialized)return;const e=()=>{this.lastActivity=Date.now(),this.activityListeners.forEach(e=>e())};["mousedown","keydown","scroll","touchstart"].forEach(t=>{window.addEventListener(t,e,{passive:!0})}),this.initialized=!0,console.log("[SessionTracker] Initialized")}static getLastActivity(){return this.lastActivity}static isInactive(e){return Date.now()-this.lastActivity>e}static addListener(e){return this.activityListeners.add(e),()=>this.activityListeners.delete(e)}static reset(){this.lastActivity=Date.now()}}const We=Ue({user:null,token:null,refreshToken:null,expiresAt:null,permissions:/* @__PURE__ */new Set,isRefreshing:!1,lastActivity:Date.now()}),qe=Ue({sessionTimeout:18e5,refreshThreshold:3e5,autoRefresh:!0,enableSessionTimeout:!0}),Ke=Be(null),Ge=ze(We,e=>!!e.token&&!!e.expiresAt&&e.expiresAt>Date.now());ze(We,e=>e.user);const Qe=ze(We,e=>e.token);ze(We,e=>e.permissions),ze(We,e=>e.isRefreshing);let Je=null,Ye=null;function Xe(){Je&&(clearTimeout(Je),Je=null);const t=qe.get();if(!t.autoRefresh)return void console.log("[AuthStore] Auto-refresh disabled");const s=We.get();if(!s.expiresAt)return void console.log("[AuthStore] No expiry time, skipping refresh setup");const i=function(e){const t=e<1e10?1e3*e:e;return Math.max(0,t-Date.now())}(s.expiresAt),o=Math.max(0,i-t.refreshThreshold);console.log("[AuthStore] Setting up token refresh",{expiresAt:new Date(s.expiresAt).toISOString(),refreshIn:`${Math.floor(o/1e3)}s`,refreshAt:new Date(Date.now()+o).toISOString()}),Je=setTimeout(async()=>{console.log("[AuthStore] Auto-refresh triggered");const t=await async function(){const t=We.get();if(!t.refreshToken||t.isRefreshing)return console.log("[AuthStore] Cannot refresh token",{hasRefreshToken:!!t.refreshToken,isRefreshing:t.isRefreshing}),!1;console.log("[AuthStore] Refreshing token"),We.setKey("isRefreshing",!0);try{const s=await fetch(e("/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.token}`},body:JSON.stringify({refresh_token:t.refreshToken})}),i=await s.json();if(s.ok&&"success"===i.status&&i.data){const e=i.data;return We.set({user:e.user,token:e.token,refreshToken:e.refresh_token,expiresAt:e.expires_at<1e10?1e3*e.expires_at:e.expires_at,permissions:Ve(e.token),isRefreshing:!1,lastActivity:Date.now()}),je.save(e.token,e.refresh_token,e.expires_at,e.user),Xe(),console.log("[AuthStore] Token refreshed successfully"),!0}{const e={type:"REFRESH_FAILED",message:i.error?.message||"Failed to refresh token",timestamp:Date.now(),details:i.error};return Ke.set(e),console.error("[AuthStore] Token refresh failed:",e),et(),!1}}catch(s){const e={type:"NETWORK_ERROR",message:s instanceof Error?s.message:"Network error",timestamp:Date.now(),details:s};return Ke.set(e),console.error("[AuthStore] Token refresh error:",s),!1}finally{We.setKey("isRefreshing",!1)}}();t||console.error("[AuthStore] Auto-refresh failed")},o)}function Ze(){Ye&&(clearInterval(Ye),Ye=null);const e=qe.get();e.enableSessionTimeout?Ye=setInterval(()=>{if(He.isInactive(e.sessionTimeout)){console.log("[AuthStore] Session timeout detected");const e={type:"SESSION_TIMEOUT",message:"Your session has expired due to inactivity",timestamp:Date.now()};Ke.set(e),et()}},6e4):console.log("[AuthStore] Session timeout disabled")}function et(){console.log("[AuthStore] Logging out"),Je&&(clearTimeout(Je),Je=null),Ye&&(clearInterval(Ye),Ye=null),We.set({user:null,token:null,refreshToken:null,expiresAt:null,permissions:/* @__PURE__ */new Set,isRefreshing:!1,lastActivity:Date.now()}),je.clear(),window.dispatchEvent(new CustomEvent("auth:logout")),window.location.href="/"}function tt(){const e=Qe.get();return e?{Authorization:`Bearer ${e}`}:{}}!function(){console.log("[AuthStore] Initializing");const e=je.load();e.token&&e.expiresAt&&e.user&&(e.expiresAt>Date.now()?(We.setKey("token",e.token),We.setKey("refreshToken",e.refreshToken),We.setKey("expiresAt",e.expiresAt),We.setKey("user",e.user),We.setKey("permissions",Ve(e.token)),console.log("[AuthStore] Restored auth from storage"),Xe()):(console.log("[AuthStore] Stored token expired, clearing"),je.clear())),He.init(),Ze(),He.addListener(()=>{We.setKey("lastActivity",Date.now())}),console.log("[AuthStore] Initialized")}();var st=Object.defineProperty,it=Object.getOwnPropertyDescriptor,ot=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?it(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&st(t,s,r),r};let rt=class extends me{constructor(){super(...arguments),this.pod="",this.namespace="",this.container="",this.terminal=null,this.fitAddon=null,this.socket=null,this.resizeObserver=null}firstUpdated(){this.initTerminal()}updated(e){(e.has("pod")||e.has("namespace")||e.has("container"))&&this.pod&&this.namespace&&(this.socket&&(this.disconnect(),this.terminal?.reset()),this.connect())}disconnectedCallback(){super.disconnectedCallback(),this.disconnect(),this.terminal?.dispose(),this.resizeObserver?.disconnect()}initTerminal(){this.terminal=new Ee.Terminal({cursorBlink:!0,fontSize:14,fontFamily:'Menlo, Monaco, "Courier New", monospace',theme:{background:"#1e1e1e",foreground:"#d4d4d4"}}),this.fitAddon=new Ie.FitAddon,this.terminal.loadAddon(this.fitAddon),this.terminal.loadAddon(new Pe.WebLinksAddon),this.terminal.open(this.containerElement),this.fitAddon.fit(),this.terminal.onData(e=>{this.sendInput(e)}),this.terminal.onResize(e=>{this.sendResize(e.rows,e.cols)}),this.resizeObserver=new ResizeObserver(()=>{requestAnimationFrame(()=>{this.fitAddon?.fit(),this.terminal&&this.sendResize(this.terminal.rows,this.terminal.cols)})}),this.resizeObserver.observe(this.containerElement)}connect(){if(!this.pod||!this.namespace)return;const e=`?pod=${this.pod}&namespace=${this.namespace}&container=${this.container||""}`,s=t(`/ws/kubernetes/pods/exec${e}`);this.socket=new WebSocket(s),this.socket.onopen=()=>{this.terminal?.writeln("\r\nConnecting to pod...\r\n");const e=Qe.get();this.sendMessage("auth",{token:e}),this.sendMessage("subscribe",{channel:"pod-exec"}),this.fitAddon?.fit(),this.terminal&&this.sendResize(this.terminal.rows,this.terminal.cols)},this.socket.onmessage=e=>{try{const t=JSON.parse(e.data);this.handleMessage(t)}catch(t){console.error("Failed to parse message",t)}},this.socket.onclose=()=>{this.terminal?.writeln("\r\nConnection closed.\r\n")},this.socket.onerror=e=>{this.terminal?.writeln("\r\nConnection error.\r\n"),console.error("WebSocket error",e)}}disconnect(){this.socket&&(this.socket.close(),this.socket=null)}sendMessage(e,t){this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify({type:e,payload:t}))}sendInput(e){this.sendMessage("input",{data:e})}sendResize(e,t){this.sendMessage("resize",{rows:e,cols:t})}handleMessage(e){switch(e.type){case"output":e.payload&&e.payload.data&&this.terminal?.write(e.payload.data);break;case"error":e.payload&&e.payload.message&&this.terminal?.writeln(`\r\nError: ${e.payload.message}\r\n`)}}render(){return J`<div id="terminal-container"></div>`}};rt.styles=[g`${p(Le)}`,g`
      :host {
        display: block;
        height: 100%;
        width: 100%;
        background-color: #1e1e1e;
        overflow: hidden;
      }
      #terminal-container {
        height: 100%;
        width: 100%;
        padding: 4px;
        box-sizing: border-box;
      }
    `],ot([we({type:String})],rt.prototype,"pod",2),ot([we({type:String})],rt.prototype,"namespace",2),ot([we({type:String})],rt.prototype,"container",2),ot([_e("#terminal-container")],rt.prototype,"containerElement",2),rt=ot([ve("pod-terminal")],rt);var at=Object.defineProperty,nt=Object.getOwnPropertyDescriptor,lt=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?nt(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&at(t,s,r),r};let ct=class extends me{constructor(){super(...arguments),this.containerId="",this.containerName="",this.runtime="docker",this.terminal=null,this.fitAddon=null,this.socket=null,this.resizeObserver=null}firstUpdated(){this.initTerminal()}updated(e){(e.has("containerId")||e.has("runtime"))&&this.containerId&&(this.socket&&(this.disconnect(),this.terminal?.reset()),this.connect())}disconnectedCallback(){super.disconnectedCallback(),this.disconnect(),this.terminal?.dispose(),this.resizeObserver?.disconnect()}initTerminal(){this.terminal=new Ee.Terminal({cursorBlink:!0,fontSize:14,fontFamily:'Menlo, Monaco, "Courier New", monospace',theme:{background:"#1e1e1e",foreground:"#d4d4d4"}}),this.fitAddon=new Ie.FitAddon,this.terminal.loadAddon(this.fitAddon),this.terminal.loadAddon(new Pe.WebLinksAddon),this.terminal.open(this.containerElement),this.fitAddon.fit(),this.terminal.onData(e=>{this.sendInput(e)}),this.terminal.onResize(e=>{this.sendResize(e.rows,e.cols)}),this.resizeObserver=new ResizeObserver(()=>{requestAnimationFrame(()=>{this.fitAddon?.fit(),this.terminal&&this.sendResize(this.terminal.rows,this.terminal.cols)})}),this.resizeObserver.observe(this.containerElement)}connect(){if(!this.containerId)return;const e=`?container=${encodeURIComponent(this.containerId)}&runtime=${encodeURIComponent(this.runtime)}`,s=t(`/ws/containers/exec${e}`);this.socket=new WebSocket(s),this.socket.onopen=()=>{const e=this.containerName||this.containerId;this.terminal?.writeln(`\nConnecting to container ${e}...\n`);const t=Qe.get();this.sendMessage("auth",{token:t}),this.sendMessage("subscribe",{channel:"container-exec"}),this.fitAddon?.fit(),this.terminal&&this.sendResize(this.terminal.rows,this.terminal.cols)},this.socket.onmessage=e=>{try{const t=JSON.parse(e.data);this.handleMessage(t)}catch(t){console.error("Failed to parse message",t)}},this.socket.onclose=()=>{this.terminal?.writeln("\r\nConnection closed.\r\n")},this.socket.onerror=e=>{this.terminal?.writeln("\r\nConnection error.\r\n"),console.error("WebSocket error",e)}}disconnect(){this.socket&&(this.socket.close(),this.socket=null)}sendMessage(e,t){this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify({type:e,payload:t}))}sendInput(e){this.sendMessage("input",{data:e})}sendResize(e,t){this.sendMessage("resize",{rows:e,cols:t})}handleMessage(e){switch(e.type){case"output":e.payload&&e.payload.data&&this.terminal?.write(e.payload.data);break;case"error":e.payload&&e.payload.message&&this.terminal?.writeln(`\nError: ${e.payload.message}\n`)}}render(){return J`<div id="terminal-container"></div>`}};ct.styles=[g`${p(Le)}`,g`
      :host {
        display: block;
        height: 100%;
        width: 100%;
        background-color: #1e1e1e;
        overflow: hidden;
      }
      #terminal-container {
        height: 100%;
        width: 100%;
        padding: 4px;
        box-sizing: border-box;
      }
    `],lt([we({type:String})],ct.prototype,"containerId",2),lt([we({type:String})],ct.prototype,"containerName",2),lt([we({type:String})],ct.prototype,"runtime",2),lt([_e("#terminal-container")],ct.prototype,"containerElement",2),ct=lt([ve("container-terminal")],ct);class dt extends me{connectedCallback(){super.connectedCallback(),this._i18nUnsubscribe=s.onChange(()=>{this.requestUpdate()})}disconnectedCallback(){super.disconnectedCallback(),this._i18nUnsubscribe&&(this._i18nUnsubscribe(),this._i18nUnsubscribe=void 0)}}var ht=Object.defineProperty,ut=Object.getOwnPropertyDescriptor,pt=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?ut(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&ht(t,s,r),r};let gt=class extends dt{constructor(){super(...arguments),this.username="",this.password="",this.loading=!1,this.error="",this.showPassword=!1}render(){return J`
      <div class="login-container">
        <div class="logo">
          <svg viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
        </div>
        
        <h1>Vapor by Awanio</h1>
        
        <form @submit=${this.handleSubmit}>
          <div class="form-group">
            <label for="username">Username</label>
            <input
              id="username"
              type="text"
              .value=${this.username}
              @input=${this.handleUsernameInput}
              ?disabled=${this.loading}
              required
              autocomplete="username"
            />
          </div>
          
          <div class="form-group">
            <label for="password">Password</label>
            <div class="password-input-wrapper">
              <input
                id="password"
                type=${this.showPassword?"text":"password"}
                .value=${this.password}
                @input=${this.handlePasswordInput}
                ?disabled=${this.loading}
                required
                autocomplete="current-password"
              />
              <button
                type="button"
                class="password-toggle"
                @click=${this.togglePasswordVisibility}
                ?disabled=${this.loading}
                title=${this.showPassword?"Hide password":"Show password"}
                aria-label=${this.showPassword?"Hide password":"Show password"}
              >
                ${this.showPassword?J`
                  <!-- Eye Off Icon -->
                  <svg viewBox="0 0 24 24">
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                    <line x1="1" y1="1" x2="23" y2="23"></line>
                  </svg>
                `:J`
                  <!-- Eye Icon -->
                  <svg viewBox="0 0 24 24">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                `}
              </button>
            </div>
          </div>
          
          <button type="submit" ?disabled=${this.loading}>
            ${this.loading?"Logging in...":"Login"}
          </button>
          
          ${this.error?J`
            <div class="error-message">${this.error}</div>
          `:""}
        </form>
        <div id="copy">
        <span>&copy; ${/* @__PURE__ */(new Date).getFullYear()} Awanio. All rights reserved.</span>
        </div>
      </div>
    `}handleUsernameInput(e){this.username=e.target.value,this.error=""}handlePasswordInput(e){this.password=e.target.value,this.error=""}togglePasswordVisibility(){this.showPassword=!this.showPassword}async handleSubmit(t){if(t.preventDefault(),this.username&&this.password){this.loading=!0,this.error="";try{await async function(t){try{console.log("[AuthStore] Attempting login");const s=await fetch(e("/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,auth_type:t.auth_type||"password"})}),i=await s.json();if(s.ok&&"success"===i.status&&i.data){const e=i.data;return We.set({user:e.user,token:e.token,refreshToken:e.refresh_token,expiresAt:e.expires_at<1e10?1e3*e.expires_at:e.expires_at,permissions:Ve(e.token),isRefreshing:!1,lastActivity:Date.now()}),je.save(e.token,e.refresh_token,e.expires_at,e.user),Xe(),He.reset(),Ze(),window.dispatchEvent(new CustomEvent("auth:login",{detail:{user:e.user}})),console.log("[AuthStore] Login successful"),!0}{const e={type:"INVALID_CREDENTIALS",message:i.error?.message||"Invalid credentials",timestamp:Date.now(),details:i.error};return Ke.set(e),console.error("[AuthStore] Login failed:",e),!1}}catch(s){const e={type:"NETWORK_ERROR",message:s instanceof Error?s.message:"Network error",timestamp:Date.now(),details:s};return Ke.set(e),console.error("[AuthStore] Login error:",s),!1}}({username:this.username,password:this.password})?this.dispatchEvent(new CustomEvent("login-success",{bubbles:!0,composed:!0})):this.error="Invalid username or password"}catch(s){this.error="An error occurred. Please try again.",console.error("Login error:",s)}finally{this.loading=!1}}else this.error="Please enter both username and password"}};function mt(e){return e+.5|0}gt.styles=g`
    :host {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: var(--surface-0);
    }

    .login-container {
      background: var(--surface-1);
      border-radius: 8px;
      padding: 2rem;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    h1 {
      text-align: center;
      color: var(--text-primary);
      margin-bottom: 2rem;
      font-size: 1.5rem;
    }

    div#copy {
      text-align: center;
      font-size: small;
      width: 100%;
      justify-content: center;
      margin-top: 1.5rem;
      padding-top: 1rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      background: var(--surface-0);
      color: var(--text-primary);
      font-size: 1rem;
      transition: border-color 0.2s;
      box-sizing: border-box;
    }

    input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .password-input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }

    .password-input-wrapper input {
      padding-right: 2.5rem;
    }

    .password-toggle {
      position: absolute;
      right: 0.75rem;
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s;
      width: 24px;
      height: 24px;
    }

    .password-toggle:hover {
      color: var(--text-primary);
    }

    .password-toggle:focus {
      outline: none;
      color: var(--primary);
    }

    .password-toggle svg {
      width: 20px;
      height: 20px;
      fill: none;
      stroke: currentColor;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    button {
      width: 100%;
      padding: 0.75rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }

    button:hover:not(:disabled) {
      background: var(--primary-hover);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .error-message {
      color: var(--error);
      text-align: center;
      margin-top: 1rem;
      font-size: 0.875rem;
    }

    .logo {
      text-align: center;
      margin-bottom: 2rem;
    }

    .logo svg {
      width: 64px;
      height: 64px;
      fill: var(--primary);
    }
  `,pt([xe()],gt.prototype,"username",2),pt([xe()],gt.prototype,"password",2),pt([xe()],gt.prototype,"loading",2),pt([xe()],gt.prototype,"error",2),pt([xe()],gt.prototype,"showPassword",2),gt=pt([ve("login-page")],gt);const ft=(e,t,s)=>Math.max(Math.min(e,s),t);function vt(e){return ft(mt(2.55*e),0,255)}function bt(e){return ft(mt(255*e),0,255)}function yt(e){return ft(mt(e/2.55)/100,0,1)}function wt(e){return ft(mt(100*e),0,100)}const xt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},_t=[..."0123456789ABCDEF"],kt=e=>_t[15&e],St=e=>_t[(240&e)>>4]+_t[15&e],Ct=e=>(240&e)>>4==(15&e);function $t(e){var t=(e=>Ct(e.r)&&Ct(e.g)&&Ct(e.b)&&Ct(e.a))(e)?kt:St;return e?"#"+t(e.r)+t(e.g)+t(e.b)+((e,t)=>e<255?t(e):"")(e.a,t):void 0}const Dt=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Et(e,t,s){const i=t*Math.min(s,1-s),o=(t,o=(t+e/30)%12)=>s-i*Math.max(Math.min(o-3,9-o,1),-1);return[o(0),o(8),o(4)]}function Mt(e,t,s){const i=(i,o=(i+e/60)%6)=>s-s*t*Math.max(Math.min(o,4-o,1),0);return[i(5),i(3),i(1)]}function At(e,t,s){const i=Et(e,1,.5);let o;for(t+s>1&&(o=1/(t+s),t*=o,s*=o),o=0;o<3;o++)i[o]*=1-t-s,i[o]+=t;return i}function It(e){const t=e.r/255,s=e.g/255,i=e.b/255,o=Math.max(t,s,i),r=Math.min(t,s,i),a=(o+r)/2;let n,l,c;return o!==r&&(c=o-r,l=a>.5?c/(2-o-r):c/(o+r),n=function(e,t,s,i,o){return e===o?(t-s)/i+(t<s?6:0):t===o?(s-e)/i+2:(e-t)/i+4}(t,s,i,c,o),n=60*n+.5),[0|n,l||0,a]}function Tt(e,t,s,i){return(Array.isArray(t)?e(t[0],t[1],t[2]):e(t,s,i)).map(bt)}function Pt(e,t,s){return Tt(Et,e,t,s)}function Lt(e){return(e%360+360)%360}function Rt(e){const t=Dt.exec(e);let s,i=255;if(!t)return;t[5]!==s&&(i=t[6]?vt(+t[5]):bt(+t[5]));const o=Lt(+t[2]),r=+t[3]/100,a=+t[4]/100;return s="hwb"===t[1]?function(e,t,s){return Tt(At,e,t,s)}(o,r,a):"hsv"===t[1]?function(e,t,s){return Tt(Mt,e,t,s)}(o,r,a):Pt(o,r,a),{r:s[0],g:s[1],b:s[2],a:i}}const Ot={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Nt={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let Bt;function Ft(e){Bt||(Bt=function(){const e={},t=Object.keys(Nt),s=Object.keys(Ot);let i,o,r,a,n;for(i=0;i<t.length;i++){for(a=n=t[i],o=0;o<s.length;o++)r=s[o],n=n.replace(r,Ot[r]);r=parseInt(Nt[a],16),e[n]=[r>>16&255,r>>8&255,255&r]}return e}(),Bt.transparent=[0,0,0,0]);const t=Bt[e.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:4===t.length?t[3]:255}}const zt=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;const Ut=e=>e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055,Vt=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function jt(e,t,s){if(e){let i=It(e);i[t]=Math.max(0,Math.min(i[t]+i[t]*s,0===t?360:1)),i=Pt(i),e.r=i[0],e.g=i[1],e.b=i[2]}}function Ht(e,t){return e?Object.assign(t||{},e):e}function Wt(e){var t={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(t={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(t.a=bt(e[3]))):(t=Ht(e,{r:0,g:0,b:0,a:1})).a=bt(t.a),t}function qt(e){return"r"===e.charAt(0)?function(e){const t=zt.exec(e);let s,i,o,r=255;if(t){if(t[7]!==s){const e=+t[7];r=t[8]?vt(e):ft(255*e,0,255)}return s=+t[1],i=+t[3],o=+t[5],s=255&(t[2]?vt(s):ft(s,0,255)),i=255&(t[4]?vt(i):ft(i,0,255)),o=255&(t[6]?vt(o):ft(o,0,255)),{r:s,g:i,b:o,a:r}}}(e):Rt(e)}class Kt{constructor(e){if(e instanceof Kt)return e;const t=typeof e;let s;var i,o,r;"object"===t?s=Wt(e):"string"===t&&(r=(i=e).length,"#"===i[0]&&(4===r||5===r?o={r:255&17*xt[i[1]],g:255&17*xt[i[2]],b:255&17*xt[i[3]],a:5===r?17*xt[i[4]]:255}:7!==r&&9!==r||(o={r:xt[i[1]]<<4|xt[i[2]],g:xt[i[3]]<<4|xt[i[4]],b:xt[i[5]]<<4|xt[i[6]],a:9===r?xt[i[7]]<<4|xt[i[8]]:255})),s=o||Ft(e)||qt(e)),this._rgb=s,this._valid=!!s}get valid(){return this._valid}get rgb(){var e=Ht(this._rgb);return e&&(e.a=yt(e.a)),e}set rgb(e){this._rgb=Wt(e)}rgbString(){return this._valid?(e=this._rgb)&&(e.a<255?`rgba(${e.r}, ${e.g}, ${e.b}, ${yt(e.a)})`:`rgb(${e.r}, ${e.g}, ${e.b})`):void 0;var e}hexString(){return this._valid?$t(this._rgb):void 0}hslString(){return this._valid?function(e){if(!e)return;const t=It(e),s=t[0],i=wt(t[1]),o=wt(t[2]);return e.a<255?`hsla(${s}, ${i}%, ${o}%, ${yt(e.a)})`:`hsl(${s}, ${i}%, ${o}%)`}(this._rgb):void 0}mix(e,t){if(e){const s=this.rgb,i=e.rgb;let o;const r=t===o?.5:t,a=2*r-1,n=s.a-i.a,l=((a*n===-1?a:(a+n)/(1+a*n))+1)/2;o=1-l,s.r=255&l*s.r+o*i.r+.5,s.g=255&l*s.g+o*i.g+.5,s.b=255&l*s.b+o*i.b+.5,s.a=r*s.a+(1-r)*i.a,this.rgb=s}return this}interpolate(e,t){return e&&(this._rgb=function(e,t,s){const i=Vt(yt(e.r)),o=Vt(yt(e.g)),r=Vt(yt(e.b));return{r:bt(Ut(i+s*(Vt(yt(t.r))-i))),g:bt(Ut(o+s*(Vt(yt(t.g))-o))),b:bt(Ut(r+s*(Vt(yt(t.b))-r))),a:e.a+s*(t.a-e.a)}}(this._rgb,e._rgb,t)),this}clone(){return new Kt(this.rgb)}alpha(e){return this._rgb.a=bt(e),this}clearer(e){return this._rgb.a*=1-e,this}greyscale(){const e=this._rgb,t=mt(.3*e.r+.59*e.g+.11*e.b);return e.r=e.g=e.b=t,this}opaquer(e){return this._rgb.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return jt(this._rgb,2,e),this}darken(e){return jt(this._rgb,2,-e),this}saturate(e){return jt(this._rgb,1,e),this}desaturate(e){return jt(this._rgb,1,-e),this}rotate(e){return function(e,t){var s=It(e);s[0]=Lt(s[0]+t),s=Pt(s),e.r=s[0],e.g=s[1],e.b=s[2]}(this._rgb,e),this}}function Gt(){}const Qt=/* @__PURE__ */(()=>{let e=0;return()=>e++})();function Jt(e){return null==e}function Yt(e){if(Array.isArray&&Array.isArray(e))return!0;const t=Object.prototype.toString.call(e);return"[object"===t.slice(0,7)&&"Array]"===t.slice(-6)}function Xt(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}function Zt(e){return("number"==typeof e||e instanceof Number)&&isFinite(+e)}function es(e,t){return Zt(e)?e:t}function ts(e,t){return void 0===e?t:e}const ss=(e,t)=>"string"==typeof e&&e.endsWith("%")?parseFloat(e)/100*t:+e;function is(e,t,s){if(e&&"function"==typeof e.call)return e.apply(s,t)}function os(e,t,s,i){let o,r,a;if(Yt(e))for(r=e.length,o=0;o<r;o++)t.call(s,e[o],o);else if(Xt(e))for(a=Object.keys(e),r=a.length,o=0;o<r;o++)t.call(s,e[a[o]],a[o])}function rs(e,t){let s,i,o,r;if(!e||!t||e.length!==t.length)return!1;for(s=0,i=e.length;s<i;++s)if(o=e[s],r=t[s],o.datasetIndex!==r.datasetIndex||o.index!==r.index)return!1;return!0}function as(e){if(Yt(e))return e.map(as);if(Xt(e)){const t=/* @__PURE__ */Object.create(null),s=Object.keys(e),i=s.length;let o=0;for(;o<i;++o)t[s[o]]=as(e[s[o]]);return t}return e}function ns(e){return-1===["__proto__","prototype","constructor"].indexOf(e)}function ls(e,t,s,i){if(!ns(e))return;const o=t[e],r=s[e];Xt(o)&&Xt(r)?cs(o,r,i):t[e]=as(r)}function cs(e,t,s){const i=Yt(t)?t:[t],o=i.length;if(!Xt(e))return e;const r=(s=s||{}).merger||ls;let a;for(let n=0;n<o;++n){if(a=i[n],!Xt(a))continue;const t=Object.keys(a);for(let i=0,o=t.length;i<o;++i)r(t[i],e,a,s)}return e}function ds(e,t){return cs(e,t,{merger:hs})}function hs(e,t,s){if(!ns(e))return;const i=t[e],o=s[e];Xt(i)&&Xt(o)?ds(i,o):Object.prototype.hasOwnProperty.call(t,e)||(t[e]=as(o))}const us={"":e=>e,x:e=>e.x,y:e=>e.y};function ps(e,t){const s=us[t]||(us[t]=function(e){const t=function(e){const t=e.split("."),s=[];let i="";for(const o of t)i+=o,i.endsWith("\\")?i=i.slice(0,-1)+".":(s.push(i),i="");return s}(e);return e=>{for(const s of t){if(""===s)break;e=e&&e[s]}return e}}(t));return s(e)}function gs(e){return e.charAt(0).toUpperCase()+e.slice(1)}const ms=e=>void 0!==e,fs=e=>"function"==typeof e,vs=(e,t)=>{if(e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;return!0};const bs=Math.PI,ys=2*bs,ws=ys+bs,xs=Number.POSITIVE_INFINITY,_s=bs/180,ks=bs/2,Ss=bs/4,Cs=2*bs/3,$s=Math.log10,Ds=Math.sign;function Es(e,t,s){return Math.abs(e-t)<s}function Ms(e){const t=Math.round(e);e=Es(e,t,e/1e3)?t:e;const s=Math.pow(10,Math.floor($s(e))),i=e/s;return(i<=1?1:i<=2?2:i<=5?5:10)*s}function As(e){return!function(e){return"symbol"==typeof e||"object"==typeof e&&null!==e&&!(Symbol.toPrimitive in e||"toString"in e||"valueOf"in e)}(e)&&!isNaN(parseFloat(e))&&isFinite(e)}function Is(e,t,s){let i,o,r;for(i=0,o=e.length;i<o;i++)r=e[i][s],isNaN(r)||(t.min=Math.min(t.min,r),t.max=Math.max(t.max,r))}function Ts(e){return e*(bs/180)}function Ps(e){return e*(180/bs)}function Ls(e){if(!Zt(e))return;let t=1,s=0;for(;Math.round(e*t)/t!==e;)t*=10,s++;return s}function Rs(e,t){const s=t.x-e.x,i=t.y-e.y,o=Math.sqrt(s*s+i*i);let r=Math.atan2(i,s);return r<-.5*bs&&(r+=ys),{angle:r,distance:o}}function Os(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Ns(e,t){return(e-t+ws)%ys-bs}function Bs(e){return(e%ys+ys)%ys}function Fs(e,t,s,i){const o=Bs(e),r=Bs(t),a=Bs(s),n=Bs(r-o),l=Bs(a-o),c=Bs(o-r),d=Bs(o-a);return o===r||o===a||i&&r===a||n>l&&c<d}function zs(e,t,s){return Math.max(t,Math.min(s,e))}function Us(e,t,s,i=1e-6){return e>=Math.min(t,s)-i&&e<=Math.max(t,s)+i}function Vs(e,t,s){s=s||(s=>e[s]<t);let i,o=e.length-1,r=0;for(;o-r>1;)i=r+o>>1,s(i)?r=i:o=i;return{lo:r,hi:o}}const js=(e,t,s,i)=>Vs(e,s,i?i=>{const o=e[i][t];return o<s||o===s&&e[i+1][t]===s}:i=>e[i][t]<s),Hs=(e,t,s)=>Vs(e,s,i=>e[i][t]>=s);const Ws=["push","pop","shift","splice","unshift"];function qs(e,t){const s=e._chartjs;if(!s)return;const i=s.listeners,o=i.indexOf(t);-1!==o&&i.splice(o,1),i.length>0||(Ws.forEach(t=>{delete e[t]}),delete e._chartjs)}function Ks(e){const t=new Set(e);return t.size===e.length?e:Array.from(t)}const Gs="undefined"==typeof window?function(e){return e()}:window.requestAnimationFrame;function Qs(e,t){let s=[],i=!1;return function(...o){s=o,i||(i=!0,Gs.call(window,()=>{i=!1,e.apply(t,s)}))}}const Js=e=>"start"===e?"left":"end"===e?"right":"center",Ys=(e,t,s)=>"start"===e?t:"end"===e?s:(t+s)/2;function Xs(e,t,s){const i=t.length;let o=0,r=i;if(e._sorted){const{iScale:a,vScale:n,_parsed:l}=e,c=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null,d=a.axis,{min:h,max:u,minDefined:p,maxDefined:g}=a.getUserBounds();if(p){if(o=Math.min(js(l,d,h).lo,s?i:js(t,d,a.getPixelForValue(h)).lo),c){const e=l.slice(0,o+1).reverse().findIndex(e=>!Jt(e[n.axis]));o-=Math.max(0,e)}o=zs(o,0,i-1)}if(g){let e=Math.max(js(l,a.axis,u,!0).hi+1,s?0:js(t,d,a.getPixelForValue(u),!0).hi+1);if(c){const t=l.slice(e-1).findIndex(e=>!Jt(e[n.axis]));e+=Math.max(0,t)}r=zs(e,o,i)-o}else r=i-o}return{start:o,count:r}}function Zs(e){const{xScale:t,yScale:s,_scaleRanges:i}=e,o={xmin:t.min,xmax:t.max,ymin:s.min,ymax:s.max};if(!i)return e._scaleRanges=o,!0;const r=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==s.min||i.ymax!==s.max;return Object.assign(i,o),r}const ei=e=>0===e||1===e,ti=(e,t,s)=>-Math.pow(2,10*(e-=1))*Math.sin((e-t)*ys/s),si=(e,t,s)=>Math.pow(2,-10*e)*Math.sin((e-t)*ys/s)+1,ii={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>1-Math.cos(e*ks),easeOutSine:e=>Math.sin(e*ks),easeInOutSine:e=>-.5*(Math.cos(bs*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>ei(e)?e:e<.5?.5*Math.pow(2,10*(2*e-1)):.5*(2-Math.pow(2,-10*(2*e-1))),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>ei(e)?e:ti(e,.075,.3),easeOutElastic:e=>ei(e)?e:si(e,.075,.3),easeInOutElastic(e){const t=.1125;return ei(e)?e:e<.5?.5*ti(2*e,t,.45):.5+.5*si(2*e-1,t,.45)},easeInBack(e){const t=1.70158;return e*e*((t+1)*e-t)},easeOutBack(e){const t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},easeInOutBack(e){let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=1.525))*e-t)*.5:.5*((e-=2)*e*((1+(t*=1.525))*e+t)+2)},easeInBounce:e=>1-ii.easeOutBounce(1-e),easeOutBounce(e){const t=7.5625,s=2.75;return e<1/s?t*e*e:e<2/s?t*(e-=1.5/s)*e+.75:e<2.5/s?t*(e-=2.25/s)*e+.9375:t*(e-=2.625/s)*e+.984375},easeInOutBounce:e=>e<.5?.5*ii.easeInBounce(2*e):.5*ii.easeOutBounce(2*e-1)+.5};function oi(e){if(e&&"object"==typeof e){const t=e.toString();return"[object CanvasPattern]"===t||"[object CanvasGradient]"===t}return!1}function ri(e){return oi(e)?e:new Kt(e)}function ai(e){return oi(e)?e:new Kt(e).saturate(.5).darken(.1).hexString()}const ni=["x","y","borderWidth","radius","tension"],li=["color","borderColor","backgroundColor"];const ci=/* @__PURE__ */new Map;function di(e,t,s){return function(e,t){t=t||{};const s=e+JSON.stringify(t);let i=ci.get(s);return i||(i=new Intl.NumberFormat(e,t),ci.set(s,i)),i}(t,s).format(e)}const hi={values:e=>Yt(e)?e:""+e,numeric(e,t,s){if(0===e)return"0";const i=this.chart.options.locale;let o,r=e;if(s.length>1){const t=Math.max(Math.abs(s[0].value),Math.abs(s[s.length-1].value));(t<1e-4||t>1e15)&&(o="scientific"),r=function(e,t){let s=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;Math.abs(s)>=1&&e!==Math.floor(e)&&(s=e-Math.floor(e));return s}(e,s)}const a=$s(Math.abs(r)),n=isNaN(a)?1:Math.max(Math.min(-1*Math.floor(a),20),0),l={notation:o,minimumFractionDigits:n,maximumFractionDigits:n};return Object.assign(l,this.options.ticks.format),di(e,i,l)},logarithmic(e,t,s){if(0===e)return"0";const i=s[t].significand||e/Math.pow(10,Math.floor($s(e)));return[1,2,3,5,10,15].includes(i)||t>.8*s.length?hi.numeric.call(this,e,t,s):""}};var ui={formatters:hi};const pi=/* @__PURE__ */Object.create(null),gi=/* @__PURE__ */Object.create(null);function mi(e,t){if(!t)return e;const s=t.split(".");for(let i=0,o=s.length;i<o;++i){const t=s[i];e=e[t]||(e[t]=/* @__PURE__ */Object.create(null))}return e}function fi(e,t,s){return"string"==typeof t?cs(mi(e,t),s):cs(mi(e,""),t)}class vi{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=e=>e.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(e,t)=>ai(t.backgroundColor),this.hoverBorderColor=(e,t)=>ai(t.borderColor),this.hoverColor=(e,t)=>ai(t.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return fi(this,e,t)}get(e){return mi(this,e)}describe(e,t){return fi(gi,e,t)}override(e,t){return fi(pi,e,t)}route(e,t,s,i){const o=mi(this,e),r=mi(this,s),a="_"+t;Object.defineProperties(o,{[a]:{value:o[t],writable:!0},[t]:{enumerable:!0,get(){const e=this[a],t=r[i];return Xt(e)?Object.assign({},t,e):ts(e,t)},set(e){this[a]=e}}})}apply(e){e.forEach(e=>e(this))}}var bi=/* @__PURE__ */new vi({_scriptable:e=>!e.startsWith("on"),_indexable:e=>"events"!==e,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function(e){e.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),e.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>"onProgress"!==e&&"onComplete"!==e&&"fn"!==e}),e.set("animations",{colors:{type:"color",properties:li},numbers:{type:"number",properties:ni}}),e.describe("animations",{_fallback:"animation"}),e.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>0|e}}}})},function(e){e.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function(e){e.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:ui.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),e.route("scale.ticks","color","","color"),e.route("scale.grid","color","","borderColor"),e.route("scale.border","color","","borderColor"),e.route("scale.title","color","","color"),e.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&"callback"!==e&&"parser"!==e,_indexable:e=>"borderDash"!==e&&"tickBorderDash"!==e&&"dash"!==e}),e.describe("scales",{_fallback:"scale"}),e.describe("scale.ticks",{_scriptable:e=>"backdropPadding"!==e&&"callback"!==e,_indexable:e=>"backdropPadding"!==e})}]);function yi(e,t,s,i,o){let r=t[o];return r||(r=t[o]=e.measureText(o).width,s.push(o)),r>i&&(i=r),i}function wi(e,t,s,i){let o=(i=i||{}).data=i.data||{},r=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(o=i.data={},r=i.garbageCollect=[],i.font=t),e.save(),e.font=t;let a=0;const n=s.length;let l,c,d,h,u;for(l=0;l<n;l++)if(h=s[l],null==h||Yt(h)){if(Yt(h))for(c=0,d=h.length;c<d;c++)u=h[c],null==u||Yt(u)||(a=yi(e,o,r,a,u))}else a=yi(e,o,r,a,h);e.restore();const p=r.length/2;if(p>s.length){for(l=0;l<p;l++)delete o[r[l]];r.splice(0,p)}return a}function xi(e,t,s){const i=e.currentDevicePixelRatio,o=0!==s?Math.max(s/2,.5):0;return Math.round((t-o)*i)/i+o}function _i(e,t){(t||e)&&((t=t||e.getContext("2d")).save(),t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.restore())}function ki(e,t,s,i){Si(e,t,s,i,null)}function Si(e,t,s,i,o){let r,a,n,l,c,d,h,u;const p=t.pointStyle,g=t.rotation,m=t.radius;let f=(g||0)*_s;if(p&&"object"==typeof p&&(r=p.toString(),"[object HTMLImageElement]"===r||"[object HTMLCanvasElement]"===r))return e.save(),e.translate(s,i),e.rotate(f),e.drawImage(p,-p.width/2,-p.height/2,p.width,p.height),void e.restore();if(!(isNaN(m)||m<=0)){switch(e.beginPath(),p){default:o?e.ellipse(s,i,o/2,m,0,0,ys):e.arc(s,i,m,0,ys),e.closePath();break;case"triangle":d=o?o/2:m,e.moveTo(s+Math.sin(f)*d,i-Math.cos(f)*m),f+=Cs,e.lineTo(s+Math.sin(f)*d,i-Math.cos(f)*m),f+=Cs,e.lineTo(s+Math.sin(f)*d,i-Math.cos(f)*m),e.closePath();break;case"rectRounded":c=.516*m,l=m-c,a=Math.cos(f+Ss)*l,h=Math.cos(f+Ss)*(o?o/2-c:l),n=Math.sin(f+Ss)*l,u=Math.sin(f+Ss)*(o?o/2-c:l),e.arc(s-h,i-n,c,f-bs,f-ks),e.arc(s+u,i-a,c,f-ks,f),e.arc(s+h,i+n,c,f,f+ks),e.arc(s-u,i+a,c,f+ks,f+bs),e.closePath();break;case"rect":if(!g){l=Math.SQRT1_2*m,d=o?o/2:l,e.rect(s-d,i-l,2*d,2*l);break}f+=Ss;case"rectRot":h=Math.cos(f)*(o?o/2:m),a=Math.cos(f)*m,n=Math.sin(f)*m,u=Math.sin(f)*(o?o/2:m),e.moveTo(s-h,i-n),e.lineTo(s+u,i-a),e.lineTo(s+h,i+n),e.lineTo(s-u,i+a),e.closePath();break;case"crossRot":f+=Ss;case"cross":h=Math.cos(f)*(o?o/2:m),a=Math.cos(f)*m,n=Math.sin(f)*m,u=Math.sin(f)*(o?o/2:m),e.moveTo(s-h,i-n),e.lineTo(s+h,i+n),e.moveTo(s+u,i-a),e.lineTo(s-u,i+a);break;case"star":h=Math.cos(f)*(o?o/2:m),a=Math.cos(f)*m,n=Math.sin(f)*m,u=Math.sin(f)*(o?o/2:m),e.moveTo(s-h,i-n),e.lineTo(s+h,i+n),e.moveTo(s+u,i-a),e.lineTo(s-u,i+a),f+=Ss,h=Math.cos(f)*(o?o/2:m),a=Math.cos(f)*m,n=Math.sin(f)*m,u=Math.sin(f)*(o?o/2:m),e.moveTo(s-h,i-n),e.lineTo(s+h,i+n),e.moveTo(s+u,i-a),e.lineTo(s-u,i+a);break;case"line":a=o?o/2:Math.cos(f)*m,n=Math.sin(f)*m,e.moveTo(s-a,i-n),e.lineTo(s+a,i+n);break;case"dash":e.moveTo(s,i),e.lineTo(s+Math.cos(f)*(o?o/2:m),i+Math.sin(f)*m);break;case!1:e.closePath()}e.fill(),t.borderWidth>0&&e.stroke()}}function Ci(e,t,s){return s=s||.5,!t||e&&e.x>t.left-s&&e.x<t.right+s&&e.y>t.top-s&&e.y<t.bottom+s}function $i(e,t){e.save(),e.beginPath(),e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()}function Di(e){e.restore()}function Ei(e,t,s,i,o){if(!t)return e.lineTo(s.x,s.y);if("middle"===o){const i=(t.x+s.x)/2;e.lineTo(i,t.y),e.lineTo(i,s.y)}else"after"===o!=!!i?e.lineTo(t.x,s.y):e.lineTo(s.x,t.y);e.lineTo(s.x,s.y)}function Mi(e,t,s,i){if(!t)return e.lineTo(s.x,s.y);e.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?s.cp2x:s.cp1x,i?s.cp2y:s.cp1y,s.x,s.y)}function Ai(e,t,s,i,o){if(o.strikethrough||o.underline){const r=e.measureText(i),a=t-r.actualBoundingBoxLeft,n=t+r.actualBoundingBoxRight,l=s-r.actualBoundingBoxAscent,c=s+r.actualBoundingBoxDescent,d=o.strikethrough?(l+c)/2:c;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=o.decorationWidth||2,e.moveTo(a,d),e.lineTo(n,d),e.stroke()}}function Ii(e,t){const s=e.fillStyle;e.fillStyle=t.color,e.fillRect(t.left,t.top,t.width,t.height),e.fillStyle=s}function Ti(e,t,s,i,o,r={}){const a=Yt(t)?t:[t],n=r.strokeWidth>0&&""!==r.strokeColor;let l,c;for(e.save(),e.font=o.string,function(e,t){t.translation&&e.translate(t.translation[0],t.translation[1]),Jt(t.rotation)||e.rotate(t.rotation),t.color&&(e.fillStyle=t.color),t.textAlign&&(e.textAlign=t.textAlign),t.textBaseline&&(e.textBaseline=t.textBaseline)}(e,r),l=0;l<a.length;++l)c=a[l],r.backdrop&&Ii(e,r.backdrop),n&&(r.strokeColor&&(e.strokeStyle=r.strokeColor),Jt(r.strokeWidth)||(e.lineWidth=r.strokeWidth),e.strokeText(c,s,i,r.maxWidth)),e.fillText(c,s,i,r.maxWidth),Ai(e,s,i,c,r),i+=Number(o.lineHeight);e.restore()}function Pi(e,t){const{x:s,y:i,w:o,h:r,radius:a}=t;e.arc(s+a.topLeft,i+a.topLeft,a.topLeft,1.5*bs,bs,!0),e.lineTo(s,i+r-a.bottomLeft),e.arc(s+a.bottomLeft,i+r-a.bottomLeft,a.bottomLeft,bs,ks,!0),e.lineTo(s+o-a.bottomRight,i+r),e.arc(s+o-a.bottomRight,i+r-a.bottomRight,a.bottomRight,ks,0,!0),e.lineTo(s+o,i+a.topRight),e.arc(s+o-a.topRight,i+a.topRight,a.topRight,0,-ks,!0),e.lineTo(s+a.topLeft,i)}const Li=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Ri=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Oi(e,t){const s=(""+e).match(Li);if(!s||"normal"===s[1])return 1.2*t;switch(e=+s[2],s[3]){case"px":return e;case"%":e/=100}return t*e}const Ni=e=>+e||0;function Bi(e,t){const s={},i=Xt(t),o=i?Object.keys(t):t,r=Xt(e)?i?s=>ts(e[s],e[t[s]]):t=>e[t]:()=>e;for(const a of o)s[a]=Ni(r(a));return s}function Fi(e){return Bi(e,{top:"y",right:"x",bottom:"y",left:"x"})}function zi(e){return Bi(e,["topLeft","topRight","bottomLeft","bottomRight"])}function Ui(e){const t=Fi(e);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function Vi(e,t){e=e||{},t=t||bi.font;let s=ts(e.size,t.size);"string"==typeof s&&(s=parseInt(s,10));let i=ts(e.style,t.style);i&&!(""+i).match(Ri)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const o={family:ts(e.family,t.family),lineHeight:Oi(ts(e.lineHeight,t.lineHeight),s),size:s,style:i,weight:ts(e.weight,t.weight),string:""};return o.string=function(e){return!e||Jt(e.size)||Jt(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family}(o),o}function ji(e,t,s,i){let o,r,a;for(o=0,r=e.length;o<r;++o)if(a=e[o],void 0!==a&&void 0!==a)return a}function Hi(e,t){return Object.assign(Object.create(e),t)}function Wi(e,t=[""],s,i,o=()=>e[0]){const r=s||e;void 0===i&&(i=so("_fallback",e));const a={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:r,_fallback:i,_getTarget:o,override:s=>Wi([s,...e],t,r,i)};return new Proxy(a,{deleteProperty:(t,s)=>(delete t[s],delete t._keys,delete e[0][s],!0),get:(s,i)=>Ji(s,i,()=>function(e,t,s,i){let o;for(const r of t)if(o=so(Gi(r,e),s),void 0!==o)return Qi(e,o)?eo(s,i,e,o):o}(i,t,e,s)),getOwnPropertyDescriptor:(e,t)=>Reflect.getOwnPropertyDescriptor(e._scopes[0],t),getPrototypeOf:()=>Reflect.getPrototypeOf(e[0]),has:(e,t)=>io(e).includes(t),ownKeys:e=>io(e),set(e,t,s){const i=e._storage||(e._storage=o());return e[t]=i[t]=s,delete e._keys,!0}})}function qi(e,t,s,i){const o={_cacheable:!1,_proxy:e,_context:t,_subProxy:s,_stack:/* @__PURE__ */new Set,_descriptors:Ki(e,i),setContext:t=>qi(e,t,s,i),override:o=>qi(e.override(o),t,s,i)};return new Proxy(o,{deleteProperty:(t,s)=>(delete t[s],delete e[s],!0),get:(e,t,s)=>Ji(e,t,()=>function(e,t,s){const{_proxy:i,_context:o,_subProxy:r,_descriptors:a}=e;let n=i[t];fs(n)&&a.isScriptable(t)&&(n=function(e,t,s,i){const{_proxy:o,_context:r,_subProxy:a,_stack:n}=s;if(n.has(e))throw new Error("Recursion detected: "+Array.from(n).join("->")+"->"+e);n.add(e);let l=t(r,a||i);n.delete(e),Qi(e,l)&&(l=eo(o._scopes,o,e,l));return l}(t,n,e,s));Yt(n)&&n.length&&(n=function(e,t,s,i){const{_proxy:o,_context:r,_subProxy:a,_descriptors:n}=s;if(void 0!==r.index&&i(e))return t[r.index%t.length];if(Xt(t[0])){const s=t,i=o._scopes.filter(e=>e!==s);t=[];for(const l of s){const s=eo(i,o,e,l);t.push(qi(s,r,a&&a[e],n))}}return t}(t,n,e,a.isIndexable));Qi(t,n)&&(n=qi(n,o,r&&r[t],a));return n}(e,t,s)),getOwnPropertyDescriptor:(t,s)=>t._descriptors.allKeys?Reflect.has(e,s)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,s),getPrototypeOf:()=>Reflect.getPrototypeOf(e),has:(t,s)=>Reflect.has(e,s),ownKeys:()=>Reflect.ownKeys(e),set:(t,s,i)=>(e[s]=i,delete t[s],!0)})}function Ki(e,t={scriptable:!0,indexable:!0}){const{_scriptable:s=t.scriptable,_indexable:i=t.indexable,_allKeys:o=t.allKeys}=e;return{allKeys:o,scriptable:s,indexable:i,isScriptable:fs(s)?s:()=>s,isIndexable:fs(i)?i:()=>i}}const Gi=(e,t)=>e?e+gs(t):t,Qi=(e,t)=>Xt(t)&&"adapters"!==e&&(null===Object.getPrototypeOf(t)||t.constructor===Object);function Ji(e,t,s){if(Object.prototype.hasOwnProperty.call(e,t)||"constructor"===t)return e[t];const i=s();return e[t]=i,i}function Yi(e,t,s){return fs(e)?e(t,s):e}const Xi=(e,t)=>!0===e?t:"string"==typeof e?ps(t,e):void 0;function Zi(e,t,s,i,o){for(const r of t){const t=Xi(s,r);if(t){e.add(t);const r=Yi(t._fallback,s,o);if(void 0!==r&&r!==s&&r!==i)return r}else if(!1===t&&void 0!==i&&s!==i)return null}return!1}function eo(e,t,s,i){const o=t._rootScopes,r=Yi(t._fallback,s,i),a=[...e,...o],n=/* @__PURE__ */new Set;n.add(i);let l=to(n,a,s,r||s,i);return null!==l&&((void 0===r||r===s||(l=to(n,a,r,l,i),null!==l))&&Wi(Array.from(n),[""],o,r,()=>function(e,t,s){const i=e._getTarget();t in i||(i[t]={});const o=i[t];if(Yt(o)&&Xt(s))return s;return o||{}}(t,s,i)))}function to(e,t,s,i,o){for(;s;)s=Zi(e,t,s,i,o);return s}function so(e,t){for(const s of t){if(!s)continue;const t=s[e];if(void 0!==t)return t}}function io(e){let t=e._keys;return t||(t=e._keys=function(e){const t=/* @__PURE__ */new Set;for(const s of e)for(const e of Object.keys(s).filter(e=>!e.startsWith("_")))t.add(e);return Array.from(t)}(e._scopes)),t}function oo(e,t,s,i){const{iScale:o}=e,{key:r="r"}=this._parsing,a=new Array(i);let n,l,c,d;for(n=0,l=i;n<l;++n)c=n+s,d=t[c],a[n]={r:o.parse(ps(d,r),c)};return a}const ro=Number.EPSILON||1e-14,ao=(e,t)=>t<e.length&&!e[t].skip&&e[t],no=e=>"x"===e?"y":"x";function lo(e,t,s,i){const o=e.skip?t:e,r=t,a=s.skip?t:s,n=Os(r,o),l=Os(a,r);let c=n/(n+l),d=l/(n+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const h=i*c,u=i*d;return{previous:{x:r.x-h*(a.x-o.x),y:r.y-h*(a.y-o.y)},next:{x:r.x+u*(a.x-o.x),y:r.y+u*(a.y-o.y)}}}function co(e,t="x"){const s=no(t),i=e.length,o=Array(i).fill(0),r=Array(i);let a,n,l,c=ao(e,0);for(a=0;a<i;++a)if(n=l,l=c,c=ao(e,a+1),l){if(c){const e=c[t]-l[t];o[a]=0!==e?(c[s]-l[s])/e:0}r[a]=n?c?Ds(o[a-1])!==Ds(o[a])?0:(o[a-1]+o[a])/2:o[a-1]:o[a]}!function(e,t,s){const i=e.length;let o,r,a,n,l,c=ao(e,0);for(let d=0;d<i-1;++d)l=c,c=ao(e,d+1),l&&c&&(Es(t[d],0,ro)?s[d]=s[d+1]=0:(o=s[d]/t[d],r=s[d+1]/t[d],n=Math.pow(o,2)+Math.pow(r,2),n<=9||(a=3/Math.sqrt(n),s[d]=o*a*t[d],s[d+1]=r*a*t[d])))}(e,o,r),function(e,t,s="x"){const i=no(s),o=e.length;let r,a,n,l=ao(e,0);for(let c=0;c<o;++c){if(a=n,n=l,l=ao(e,c+1),!n)continue;const o=n[s],d=n[i];a&&(r=(o-a[s])/3,n[`cp1${s}`]=o-r,n[`cp1${i}`]=d-r*t[c]),l&&(r=(l[s]-o)/3,n[`cp2${s}`]=o+r,n[`cp2${i}`]=d+r*t[c])}}(e,r,t)}function ho(e,t,s){return Math.max(Math.min(e,s),t)}function uo(e,t,s,i,o){let r,a,n,l;if(t.spanGaps&&(e=e.filter(e=>!e.skip)),"monotone"===t.cubicInterpolationMode)co(e,o);else{let s=i?e[e.length-1]:e[0];for(r=0,a=e.length;r<a;++r)n=e[r],l=lo(s,n,e[Math.min(r+1,a-(i?0:1))%a],t.tension),n.cp1x=l.previous.x,n.cp1y=l.previous.y,n.cp2x=l.next.x,n.cp2y=l.next.y,s=n}t.capBezierPoints&&function(e,t){let s,i,o,r,a,n=Ci(e[0],t);for(s=0,i=e.length;s<i;++s)a=r,r=n,n=s<i-1&&Ci(e[s+1],t),r&&(o=e[s],a&&(o.cp1x=ho(o.cp1x,t.left,t.right),o.cp1y=ho(o.cp1y,t.top,t.bottom)),n&&(o.cp2x=ho(o.cp2x,t.left,t.right),o.cp2y=ho(o.cp2y,t.top,t.bottom)))}(e,s)}function po(){return"undefined"!=typeof window&&"undefined"!=typeof document}function go(e){let t=e.parentNode;return t&&"[object ShadowRoot]"===t.toString()&&(t=t.host),t}function mo(e,t,s){let i;return"string"==typeof e?(i=parseInt(e,10),-1!==e.indexOf("%")&&(i=i/100*t.parentNode[s])):i=e,i}const fo=e=>e.ownerDocument.defaultView.getComputedStyle(e,null);const vo=["top","right","bottom","left"];function bo(e,t,s){const i={};s=s?"-"+s:"";for(let o=0;o<4;o++){const r=vo[o];i[r]=parseFloat(e[t+"-"+r+s])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}function yo(e,t){if("native"in e)return e;const{canvas:s,currentDevicePixelRatio:i}=t,o=fo(s),r="border-box"===o.boxSizing,a=bo(o,"padding"),n=bo(o,"border","width"),{x:l,y:c,box:d}=function(e,t){const s=e.touches,i=s&&s.length?s[0]:e,{offsetX:o,offsetY:r}=i;let a,n,l=!1;if(((e,t,s)=>(e>0||t>0)&&(!s||!s.shadowRoot))(o,r,e.target))a=o,n=r;else{const e=t.getBoundingClientRect();a=i.clientX-e.left,n=i.clientY-e.top,l=!0}return{x:a,y:n,box:l}}(e,s),h=a.left+(d&&n.left),u=a.top+(d&&n.top);let{width:p,height:g}=t;return r&&(p-=a.width+n.width,g-=a.height+n.height),{x:Math.round((l-h)/p*s.width/i),y:Math.round((c-u)/g*s.height/i)}}const wo=e=>Math.round(10*e)/10;function xo(e,t,s,i){const o=fo(e),r=bo(o,"margin"),a=mo(o.maxWidth,e,"clientWidth")||xs,n=mo(o.maxHeight,e,"clientHeight")||xs,l=function(e,t,s){let i,o;if(void 0===t||void 0===s){const r=e&&go(e);if(r){const e=r.getBoundingClientRect(),a=fo(r),n=bo(a,"border","width"),l=bo(a,"padding");t=e.width-l.width-n.width,s=e.height-l.height-n.height,i=mo(a.maxWidth,r,"clientWidth"),o=mo(a.maxHeight,r,"clientHeight")}else t=e.clientWidth,s=e.clientHeight}return{width:t,height:s,maxWidth:i||xs,maxHeight:o||xs}}(e,t,s);let{width:c,height:d}=l;if("content-box"===o.boxSizing){const e=bo(o,"border","width"),t=bo(o,"padding");c-=t.width+e.width,d-=t.height+e.height}c=Math.max(0,c-r.width),d=Math.max(0,i?c/i:d-r.height),c=wo(Math.min(c,a,l.maxWidth)),d=wo(Math.min(d,n,l.maxHeight)),c&&!d&&(d=wo(c/2));return(void 0!==t||void 0!==s)&&i&&l.height&&d>l.height&&(d=l.height,c=wo(Math.floor(d*i))),{width:c,height:d}}function _o(e,t,s){const i=t||1,o=wo(e.height*i),r=wo(e.width*i);e.height=wo(e.height),e.width=wo(e.width);const a=e.canvas;return a.style&&(s||!a.style.height&&!a.style.width)&&(a.style.height=`${e.height}px`,a.style.width=`${e.width}px`),(e.currentDevicePixelRatio!==i||a.height!==o||a.width!==r)&&(e.currentDevicePixelRatio=i,a.height=o,a.width=r,e.ctx.setTransform(i,0,0,i,0,0),!0)}const ko=function(){let e=!1;try{const t={get passive(){return e=!0,!1}};po()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch(t){}return e}();function So(e,t){const s=function(e,t){return fo(e).getPropertyValue(t)}(e,t),i=s&&s.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function Co(e,t,s,i){return{x:e.x+s*(t.x-e.x),y:e.y+s*(t.y-e.y)}}function $o(e,t,s,i){return{x:e.x+s*(t.x-e.x),y:"middle"===i?s<.5?e.y:t.y:"after"===i?s<1?e.y:t.y:s>0?t.y:e.y}}function Do(e,t,s,i){const o={x:e.cp2x,y:e.cp2y},r={x:t.cp1x,y:t.cp1y},a=Co(e,o,s),n=Co(o,r,s),l=Co(r,t,s),c=Co(a,n,s),d=Co(n,l,s);return Co(c,d,s)}function Eo(e,t,s){return e?function(e,t){return{x:s=>e+e+t-s,setWidth(e){t=e},textAlign:e=>"center"===e?e:"right"===e?"left":"right",xPlus:(e,t)=>e-t,leftForLtr:(e,t)=>e-t}}(t,s):{x:e=>e,setWidth(e){},textAlign:e=>e,xPlus:(e,t)=>e+t,leftForLtr:(e,t)=>e}}function Mo(e,t){let s,i;"ltr"!==t&&"rtl"!==t||(s=e.canvas.style,i=[s.getPropertyValue("direction"),s.getPropertyPriority("direction")],s.setProperty("direction",t,"important"),e.prevTextDirection=i)}function Ao(e,t){void 0!==t&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",t[0],t[1]))}function Io(e){return"angle"===e?{between:Fs,compare:Ns,normalize:Bs}:{between:Us,compare:(e,t)=>e-t,normalize:e=>e}}function To({start:e,end:t,count:s,loop:i,style:o}){return{start:e%s,end:t%s,loop:i&&(t-e+1)%s==0,style:o}}function Po(e,t,s){if(!s)return[e];const{property:i,start:o,end:r}=s,a=t.length,{compare:n,between:l,normalize:c}=Io(i),{start:d,end:h,loop:u,style:p}=function(e,t,s){const{property:i,start:o,end:r}=s,{between:a,normalize:n}=Io(i),l=t.length;let c,d,{start:h,end:u,loop:p}=e;if(p){for(h+=l,u+=l,c=0,d=l;c<d&&a(n(t[h%l][i]),o,r);++c)h--,u--;h%=l,u%=l}return u<h&&(u+=l),{start:h,end:u,loop:p,style:e.style}}(e,t,s),g=[];let m,f,v,b=!1,y=null;const w=()=>b||l(o,v,m)&&0!==n(o,v),x=()=>!b||0===n(r,m)||l(r,v,m);for(let _=d,k=d;_<=h;++_)f=t[_%a],f.skip||(m=c(f[i]),m!==v&&(b=l(m,o,r),null===y&&w()&&(y=0===n(m,o)?_:k),null!==y&&x()&&(g.push(To({start:y,end:_,loop:u,count:a,style:p})),y=null),k=_,v=m));return null!==y&&g.push(To({start:y,end:h,loop:u,count:a,style:p})),g}function Lo(e,t){const s=[],i=e.segments;for(let o=0;o<i.length;o++){const r=Po(i[o],e.points,t);r.length&&s.push(...r)}return s}function Ro(e,t,s,i){return i&&i.setContext&&s?function(e,t,s,i){const o=e._chart.getContext(),r=Oo(e.options),{_datasetIndex:a,options:{spanGaps:n}}=e,l=s.length,c=[];let d=r,h=t[0].start,u=h;function p(e,t,i,o){const r=n?-1:1;if(e!==t){for(e+=l;s[e%l].skip;)e-=r;for(;s[t%l].skip;)t+=r;e%l!==t%l&&(c.push({start:e%l,end:t%l,loop:i,style:o}),d=o,h=t%l)}}for(const g of t){h=n?h:g.start;let e,t=s[h%l];for(u=h+1;u<=g.end;u++){const r=s[u%l];e=Oo(i.setContext(Hi(o,{type:"segment",p0:t,p1:r,p0DataIndex:(u-1)%l,p1DataIndex:u%l,datasetIndex:a}))),No(e,d)&&p(h,u-1,g.loop,d),t=r,d=e}h<u-1&&p(h,u-1,g.loop,d)}return c}(e,t,s,i):t}function Oo(e){return{backgroundColor:e.backgroundColor,borderCapStyle:e.borderCapStyle,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderJoinStyle:e.borderJoinStyle,borderWidth:e.borderWidth,borderColor:e.borderColor}}function No(e,t){if(!t)return!1;const s=[],i=function(e,t){return oi(t)?(s.includes(t)||s.push(t),s.indexOf(t)):t};return JSON.stringify(e,i)!==JSON.stringify(t,i)}function Bo(e,t,s){return e.options.clip?e[s]:t[s]}function Fo(e,t){const s=t._clip;if(s.disabled)return!1;const i=function(e,t){const{xScale:s,yScale:i}=e;return s&&i?{left:Bo(s,t,"left"),right:Bo(s,t,"right"),top:Bo(i,t,"top"),bottom:Bo(i,t,"bottom")}:t}(t,e.chartArea);return{left:!1===s.left?0:i.left-(!0===s.left?0:s.left),right:!1===s.right?e.width:i.right+(!0===s.right?0:s.right),top:!1===s.top?0:i.top-(!0===s.top?0:s.top),bottom:!1===s.bottom?e.height:i.bottom+(!0===s.bottom?0:s.bottom)}}class zo{constructor(){this._request=null,this._charts=/* @__PURE__ */new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,s,i){const o=t.listeners[i],r=t.duration;o.forEach(i=>i({chart:e,initial:t.initial,numSteps:r,currentStep:Math.min(s-t.start,r)}))}_refresh(){this._request||(this._running=!0,this._request=Gs.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((s,i)=>{if(!s.running||!s.items.length)return;const o=s.items;let r,a=o.length-1,n=!1;for(;a>=0;--a)r=o[a],r._active?(r._total>s.duration&&(s.duration=r._total),r.tick(e),n=!0):(o[a]=o[o.length-1],o.pop());n&&(i.draw(),this._notify(i,s,e,"progress")),o.length||(s.running=!1,this._notify(i,s,e,"complete"),s.initial=!1),t+=o.length}),this._lastDate=e,0===t&&(this._running=!1)}_getAnims(e){const t=this._charts;let s=t.get(e);return s||(s={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,s)),s}listen(e,t,s){this._getAnims(e).listeners[t].push(s)}add(e,t){t&&t.length&&this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((e,t)=>Math.max(e,t._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!!(t&&t.running&&t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const s=t.items;let i=s.length-1;for(;i>=0;--i)s[i].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var Uo=/* @__PURE__ */new zo;const Vo="transparent",jo={boolean:(e,t,s)=>s>.5?t:e,color(e,t,s){const i=ri(e||Vo),o=i.valid&&ri(t||Vo);return o&&o.valid?o.mix(i,s).hexString():t},number:(e,t,s)=>e+(t-e)*s};class Ho{constructor(e,t,s,i){const o=t[s];i=ji([e.to,i,o,e.from]);const r=ji([e.from,o,i]);this._active=!0,this._fn=e.fn||jo[e.type||typeof r],this._easing=ii[e.easing]||ii.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=s,this._from=r,this._to=i,this._promises=void 0}active(){return this._active}update(e,t,s){if(this._active){this._notify(!1);const i=this._target[this._prop],o=s-this._start,r=this._duration-o;this._start=s,this._duration=Math.floor(Math.max(r,e.duration)),this._total+=o,this._loop=!!e.loop,this._to=ji([e.to,t,i,e.from]),this._from=ji([e.from,i,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,s=this._duration,i=this._prop,o=this._from,r=this._loop,a=this._to;let n;if(this._active=o!==a&&(r||t<s),!this._active)return this._target[i]=a,void this._notify(!0);t<0?this._target[i]=o:(n=t/s%2,n=r&&n>1?2-n:n,n=this._easing(Math.min(1,Math.max(0,n))),this._target[i]=this._fn(o,a,n))}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,s)=>{e.push({res:t,rej:s})})}_notify(e){const t=e?"res":"rej",s=this._promises||[];for(let i=0;i<s.length;i++)s[i][t]()}}class Wo{constructor(e,t){this._chart=e,this._properties=/* @__PURE__ */new Map,this.configure(t)}configure(e){if(!Xt(e))return;const t=Object.keys(bi.animation),s=this._properties;Object.getOwnPropertyNames(e).forEach(i=>{const o=e[i];if(!Xt(o))return;const r={};for(const e of t)r[e]=o[e];(Yt(o.properties)&&o.properties||[i]).forEach(e=>{e!==i&&s.has(e)||s.set(e,r)})})}_animateOptions(e,t){const s=t.options,i=function(e,t){if(!t)return;let s=e.options;if(!s)return void(e.options=t);s.$shared&&(e.options=s=Object.assign({},s,{$shared:!1,$animations:{}}));return s}(e,s);if(!i)return[];const o=this._createAnimations(i,s);return s.$shared&&function(e,t){const s=[],i=Object.keys(t);for(let o=0;o<i.length;o++){const t=e[i[o]];t&&t.active()&&s.push(t.wait())}return Promise.all(s)}(e.options.$animations,s).then(()=>{e.options=s},()=>{}),o}_createAnimations(e,t){const s=this._properties,i=[],o=e.$animations||(e.$animations={}),r=Object.keys(t),a=Date.now();let n;for(n=r.length-1;n>=0;--n){const l=r[n];if("$"===l.charAt(0))continue;if("options"===l){i.push(...this._animateOptions(e,t));continue}const c=t[l];let d=o[l];const h=s.get(l);if(d){if(h&&d.active()){d.update(h,c,a);continue}d.cancel()}h&&h.duration?(o[l]=d=new Ho(h,e,l,c),i.push(d)):e[l]=c}return i}update(e,t){if(0===this._properties.size)return void Object.assign(e,t);const s=this._createAnimations(e,t);return s.length?(Uo.add(this._chart,s),!0):void 0}}function qo(e,t){const s=e&&e.options||{},i=s.reverse,o=void 0===s.min?t:0,r=void 0===s.max?t:0;return{start:i?r:o,end:i?o:r}}function Ko(e,t){const s=[],i=e._getSortedDatasetMetas(t);let o,r;for(o=0,r=i.length;o<r;++o)s.push(i[o].index);return s}function Go(e,t,s,i={}){const o=e.keys,r="single"===i.mode;let a,n,l,c;if(null===t)return;let d=!1;for(a=0,n=o.length;a<n;++a){if(l=+o[a],l===s){if(d=!0,i.all)continue;break}c=e.values[l],Zt(c)&&(r||0===t||Ds(t)===Ds(c))&&(t+=c)}return d||i.all?t:0}function Qo(e,t){const s=e&&e.options.stacked;return s||void 0===s&&void 0!==t.stack}function Jo(e,t,s){const i=e[t]||(e[t]={});return i[s]||(i[s]={})}function Yo(e,t,s,i){for(const o of t.getMatchingVisibleMetas(i).reverse()){const t=e[o.index];if(s&&t>0||!s&&t<0)return o.index}return null}function Xo(e,t){const{chart:s,_cachedMeta:i}=e,o=s._stacks||(s._stacks={}),{iScale:r,vScale:a,index:n}=i,l=r.axis,c=a.axis,d=function(e,t,s){return`${e.id}.${t.id}.${s.stack||s.type}`}(r,a,i),h=t.length;let u;for(let p=0;p<h;++p){const e=t[p],{[l]:s,[c]:r}=e;u=(e._stacks||(e._stacks={}))[c]=Jo(o,d,s),u[n]=r,u._top=Yo(u,a,!0,i.type),u._bottom=Yo(u,a,!1,i.type);(u._visualValues||(u._visualValues={}))[n]=r}}function Zo(e,t){const s=e.scales;return Object.keys(s).filter(e=>s[e].axis===t).shift()}function er(e,t){const s=e.controller.index,i=e.vScale&&e.vScale.axis;if(i){t=t||e._parsed;for(const e of t){const t=e._stacks;if(!t||void 0===t[i]||void 0===t[i][s])return;delete t[i][s],void 0!==t[i]._visualValues&&void 0!==t[i]._visualValues[s]&&delete t[i]._visualValues[s]}}}const tr=e=>"reset"===e||"none"===e,sr=(e,t)=>t?e:Object.assign({},e);class ir{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=Qo(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&er(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,s=this.getDataset(),i=(e,t,s,i)=>"x"===e?t:"r"===e?i:s,o=t.xAxisID=ts(s.xAxisID,Zo(e,"x")),r=t.yAxisID=ts(s.yAxisID,Zo(e,"y")),a=t.rAxisID=ts(s.rAxisID,Zo(e,"r")),n=t.indexAxis,l=t.iAxisID=i(n,o,r,a),c=t.vAxisID=i(n,r,o,a);t.xScale=this.getScaleForId(o),t.yScale=this.getScaleForId(r),t.rScale=this.getScaleForId(a),t.iScale=this.getScaleForId(l),t.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&qs(this._data,this),e._stacked&&er(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),s=this._data;if(Xt(t)){const e=this._cachedMeta;this._data=function(e,t){const{iScale:s,vScale:i}=t,o="x"===s.axis?"x":"y",r="x"===i.axis?"x":"y",a=Object.keys(e),n=new Array(a.length);let l,c,d;for(l=0,c=a.length;l<c;++l)d=a[l],n[l]={[o]:d,[r]:e[d]};return n}(t,e)}else if(s!==t){if(s){qs(s,this);const e=this._cachedMeta;er(e),e._parsed=[]}t&&Object.isExtensible(t)&&(o=this,(i=t)._chartjs?i._chartjs.listeners.push(o):(Object.defineProperty(i,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[o]}}),Ws.forEach(e=>{const t="_onData"+gs(e),s=i[e];Object.defineProperty(i,e,{configurable:!0,enumerable:!1,value(...e){const o=s.apply(this,e);return i._chartjs.listeners.forEach(s=>{"function"==typeof s[t]&&s[t](...e)}),o}})}))),this._syncList=[],this._data=t}var i,o}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,s=this.getDataset();let i=!1;this._dataCheck();const o=t._stacked;t._stacked=Qo(t.vScale,t),t.stack!==s.stack&&(i=!0,er(t),t.stack=s.stack),this._resyncElements(e),(i||o!==t._stacked)&&(Xo(this,t._parsed),t._stacked=Qo(t.vScale,t))}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),s=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(s,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:s,_data:i}=this,{iScale:o,_stacked:r}=s,a=o.axis;let n,l,c,d=0===e&&t===i.length||s._sorted,h=e>0&&s._parsed[e-1];if(!1===this._parsing)s._parsed=i,s._sorted=!0,c=i;else{c=Yt(i[e])?this.parseArrayData(s,i,e,t):Xt(i[e])?this.parseObjectData(s,i,e,t):this.parsePrimitiveData(s,i,e,t);const o=()=>null===l[a]||h&&l[a]<h[a];for(n=0;n<t;++n)s._parsed[n+e]=l=c[n],d&&(o()&&(d=!1),h=l);s._sorted=d}r&&Xo(this,c)}parsePrimitiveData(e,t,s,i){const{iScale:o,vScale:r}=e,a=o.axis,n=r.axis,l=o.getLabels(),c=o===r,d=new Array(i);let h,u,p;for(h=0,u=i;h<u;++h)p=h+s,d[h]={[a]:c||o.parse(l[p],p),[n]:r.parse(t[p],p)};return d}parseArrayData(e,t,s,i){const{xScale:o,yScale:r}=e,a=new Array(i);let n,l,c,d;for(n=0,l=i;n<l;++n)c=n+s,d=t[c],a[n]={x:o.parse(d[0],c),y:r.parse(d[1],c)};return a}parseObjectData(e,t,s,i){const{xScale:o,yScale:r}=e,{xAxisKey:a="x",yAxisKey:n="y"}=this._parsing,l=new Array(i);let c,d,h,u;for(c=0,d=i;c<d;++c)h=c+s,u=t[h],l[c]={x:o.parse(ps(u,a),h),y:r.parse(ps(u,n),h)};return l}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,s){const i=this.chart,o=this._cachedMeta,r=t[e.axis];return Go({keys:Ko(i,!0),values:t._stacks[e.axis]._visualValues},r,o.index,{mode:s})}updateRangeFromParsed(e,t,s,i){const o=s[t.axis];let r=null===o?NaN:o;const a=i&&s._stacks[t.axis];i&&a&&(i.values=a,r=Go(i,o,this._cachedMeta.index)),e.min=Math.min(e.min,r),e.max=Math.max(e.max,r)}getMinMax(e,t){const s=this._cachedMeta,i=s._parsed,o=s._sorted&&e===s.iScale,r=i.length,a=this._getOtherScale(e),n=((e,t,s)=>e&&!t.hidden&&t._stacked&&{keys:Ko(s,!0),values:null})(t,s,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:d}=function(e){const{min:t,max:s,minDefined:i,maxDefined:o}=e.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:o?s:Number.POSITIVE_INFINITY}}(a);let h,u;function p(){u=i[h];const t=u[a.axis];return!Zt(u[e.axis])||c>t||d<t}for(h=0;h<r&&(p()||(this.updateRangeFromParsed(l,e,u,n),!o));++h);if(o)for(h=r-1;h>=0;--h)if(!p()){this.updateRangeFromParsed(l,e,u,n);break}return l}getAllParsedValues(e){const t=this._cachedMeta._parsed,s=[];let i,o,r;for(i=0,o=t.length;i<o;++i)r=t[i][e.axis],Zt(r)&&s.push(r);return s}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,s=t.iScale,i=t.vScale,o=this.getParsed(e);return{label:s?""+s.getLabelForValue(o[s.axis]):"",value:i?""+i.getLabelForValue(o[i.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=function(e){let t,s,i,o;return Xt(e)?(t=e.top,s=e.right,i=e.bottom,o=e.left):t=s=i=o=e,{top:t,right:s,bottom:i,left:o,disabled:!1===e}}(ts(this.options.clip,function(e,t,s){if(!1===s)return!1;const i=qo(e,s),o=qo(t,s);return{top:o.end,right:i.end,bottom:o.start,left:i.start}}(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,s=this._cachedMeta,i=s.data||[],o=t.chartArea,r=[],a=this._drawStart||0,n=this._drawCount||i.length-a,l=this.options.drawActiveElementsOnTop;let c;for(s.dataset&&s.dataset.draw(e,o,a,n),c=a;c<a+n;++c){const t=i[c];t.hidden||(t.active&&l?r.push(t):t.draw(e,o))}for(c=0;c<r.length;++c)r[c].draw(e,o)}getStyle(e,t){const s=t?"active":"default";return void 0===e&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(s):this.resolveDataElementOptions(e||0,s)}getContext(e,t,s){const i=this.getDataset();let o;if(e>=0&&e<this._cachedMeta.data.length){const t=this._cachedMeta.data[e];o=t.$context||(t.$context=function(e,t,s){return Hi(e,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:s,index:t,mode:"default",type:"data"})}(this.getContext(),e,t)),o.parsed=this.getParsed(e),o.raw=i.data[e],o.index=o.dataIndex=e}else o=this.$context||(this.$context=function(e,t){return Hi(e,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),o.dataset=i,o.index=o.datasetIndex=this.index;return o.active=!!t,o.mode=s,o}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",s){const i="active"===t,o=this._cachedDataOpts,r=e+"-"+t,a=o[r],n=this.enableOptionSharing&&ms(s);if(a)return sr(a,n);const l=this.chart.config,c=l.datasetElementScopeKeys(this._type,e),d=i?[`${e}Hover`,"hover",e,""]:[e,""],h=l.getOptionScopes(this.getDataset(),c),u=Object.keys(bi.elements[e]),p=l.resolveNamedOptions(h,u,()=>this.getContext(s,i,t),d);return p.$shared&&(p.$shared=n,o[r]=Object.freeze(sr(p,n))),p}_resolveAnimations(e,t,s){const i=this.chart,o=this._cachedDataOpts,r=`animation-${t}`,a=o[r];if(a)return a;let n;if(!1!==i.options.animation){const i=this.chart.config,o=i.datasetAnimationScopeKeys(this._type,t),r=i.getOptionScopes(this.getDataset(),o);n=i.createResolver(r,this.getContext(e,s,t))}const l=new Wo(i,n&&n.animations);return n&&n._cacheable&&(o[r]=Object.freeze(l)),l}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||tr(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const s=this.resolveDataElementOptions(e,t),i=this._sharedOptions,o=this.getSharedOptions(s),r=this.includeOptions(t,o)||o!==i;return this.updateSharedOptions(o,t,s),{sharedOptions:o,includeOptions:r}}updateElement(e,t,s,i){tr(i)?Object.assign(e,s):this._resolveAnimations(t,i).update(e,s)}updateSharedOptions(e,t,s){e&&!tr(t)&&this._resolveAnimations(void 0,t).update(e,s)}_setStyle(e,t,s,i){e.active=i;const o=this.getStyle(t,i);this._resolveAnimations(t,s,i).update(e,{options:!i&&this.getSharedOptions(o)||o})}removeHoverStyle(e,t,s){this._setStyle(e,s,"active",!1)}setHoverStyle(e,t,s){this._setStyle(e,s,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,s=this._cachedMeta.data;for(const[a,n,l]of this._syncList)this[a](n,l);this._syncList=[];const i=s.length,o=t.length,r=Math.min(o,i);r&&this.parse(0,r),o>i?this._insertElements(i,o-i,e):o<i&&this._removeElements(o,i-o)}_insertElements(e,t,s=!0){const i=this._cachedMeta,o=i.data,r=e+t;let a;const n=e=>{for(e.length+=t,a=e.length-1;a>=r;a--)e[a]=e[a-t]};for(n(o),a=e;a<r;++a)o[a]=new this.dataElementType;this._parsing&&n(i._parsed),this.parse(e,t),s&&this.updateElements(o,e,t,"reset")}updateElements(e,t,s,i){}_removeElements(e,t){const s=this._cachedMeta;if(this._parsing){const i=s._parsed.splice(e,t);s._stacked&&er(s,i)}s.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,s,i]=e;this[t](s,i)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const s=arguments.length-2;s&&this._sync(["_insertElements",e,s])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function or(e){const t=e.iScale,s=function(e,t){if(!e._cache.$bar){const s=e.getMatchingVisibleMetas(t);let i=[];for(let t=0,o=s.length;t<o;t++)i=i.concat(s[t].controller.getAllParsedValues(e));e._cache.$bar=Ks(i.sort((e,t)=>e-t))}return e._cache.$bar}(t,e.type);let i,o,r,a,n=t._length;const l=()=>{32767!==r&&-32768!==r&&(ms(a)&&(n=Math.min(n,Math.abs(r-a)||n)),a=r)};for(i=0,o=s.length;i<o;++i)r=t.getPixelForValue(s[i]),l();for(a=void 0,i=0,o=t.ticks.length;i<o;++i)r=t.getPixelForTick(i),l();return n}function rr(e,t,s,i){return Yt(e)?function(e,t,s,i){const o=s.parse(e[0],i),r=s.parse(e[1],i),a=Math.min(o,r),n=Math.max(o,r);let l=a,c=n;Math.abs(a)>Math.abs(n)&&(l=n,c=a),t[s.axis]=c,t._custom={barStart:l,barEnd:c,start:o,end:r,min:a,max:n}}(e,t,s,i):t[s.axis]=s.parse(e,i),t}function ar(e,t,s,i){const o=e.iScale,r=e.vScale,a=o.getLabels(),n=o===r,l=[];let c,d,h,u;for(c=s,d=s+i;c<d;++c)u=t[c],h={},h[o.axis]=n||o.parse(a[c],c),l.push(rr(u,h,r,c));return l}function nr(e){return e&&void 0!==e.barStart&&void 0!==e.barEnd}function lr(e,t,s,i){let o=t.borderSkipped;const r={};if(!o)return void(e.borderSkipped=r);if(!0===o)return void(e.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:a,end:n,reverse:l,top:c,bottom:d}=function(e){let t,s,i,o,r;return e.horizontal?(t=e.base>e.x,s="left",i="right"):(t=e.base<e.y,s="bottom",i="top"),t?(o="end",r="start"):(o="start",r="end"),{start:s,end:i,reverse:t,top:o,bottom:r}}(e);"middle"===o&&s&&(e.enableBorderRadius=!0,(s._top||0)===i?o=c:(s._bottom||0)===i?o=d:(r[cr(d,a,n,l)]=!0,o=c)),r[cr(o,a,n,l)]=!0,e.borderSkipped=r}function cr(e,t,s,i){var o,r,a;return i?(a=s,e=dr(e=(o=e)===(r=t)?a:o===a?r:o,s,t)):e=dr(e,t,s),e}function dr(e,t,s){return"start"===e?t:"end"===e?s:e}function hr(e,{inflateAmount:t},s){e.inflateAmount="auto"===t?1===s?.33:0:t}class ur extends ir{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:e=>"spacing"!==e,_indexable:e=>"spacing"!==e&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data,{labels:{pointStyle:s,textAlign:i,color:o,useBorderRadius:r,borderRadius:a}}=e.legend.options;return t.labels.length&&t.datasets.length?t.labels.map((t,n)=>{const l=e.getDatasetMeta(0).controller.getStyle(n);return{text:t,fillStyle:l.backgroundColor,fontColor:o,hidden:!e.getDataVisibility(n),lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:l.borderWidth,strokeStyle:l.borderColor,textAlign:i,pointStyle:s,borderRadius:r&&(a||l.borderRadius),index:n}}):[]}},onClick(e,t,s){s.chart.toggleDataVisibility(t.index),s.chart.update()}}}};constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){const s=this.getDataset().data,i=this._cachedMeta;if(!1===this._parsing)i._parsed=s;else{let o,r,a=e=>+s[e];if(Xt(s[e])){const{key:e="value"}=this._parsing;a=t=>+ps(s[t],e)}for(o=e,r=e+t;o<r;++o)i._parsed[o]=a(o)}}_getRotation(){return Ts(this.options.rotation-90)}_getCircumference(){return Ts(this.options.circumference)}_getRotationExtents(){let e=ys,t=-ys;for(let s=0;s<this.chart.data.datasets.length;++s)if(this.chart.isDatasetVisible(s)&&this.chart.getDatasetMeta(s).type===this._type){const i=this.chart.getDatasetMeta(s).controller,o=i._getRotation(),r=i._getCircumference();e=Math.min(e,o),t=Math.max(t,o+r)}return{rotation:e,circumference:t-e}}update(e){const t=this.chart,{chartArea:s}=t,i=this._cachedMeta,o=i.data,r=this.getMaxBorderWidth()+this.getMaxOffset(o)+this.options.spacing,a=Math.max((Math.min(s.width,s.height)-r)/2,0),n=Math.min((l=this.options.cutout,c=a,"string"==typeof l&&l.endsWith("%")?parseFloat(l)/100:+l/c),1);var l,c;const d=this._getRingWeight(this.index),{circumference:h,rotation:u}=this._getRotationExtents(),{ratioX:p,ratioY:g,offsetX:m,offsetY:f}=function(e,t,s){let i=1,o=1,r=0,a=0;if(t<ys){const n=e,l=n+t,c=Math.cos(n),d=Math.sin(n),h=Math.cos(l),u=Math.sin(l),p=(e,t,i)=>Fs(e,n,l,!0)?1:Math.max(t,t*s,i,i*s),g=(e,t,i)=>Fs(e,n,l,!0)?-1:Math.min(t,t*s,i,i*s),m=p(0,c,h),f=p(ks,d,u),v=g(bs,c,h),b=g(bs+ks,d,u);i=(m-v)/2,o=(f-b)/2,r=-(m+v)/2,a=-(f+b)/2}return{ratioX:i,ratioY:o,offsetX:r,offsetY:a}}(u,h,n),v=(s.width-r)/p,b=(s.height-r)/g,y=Math.max(Math.min(v,b)/2,0),w=ss(this.options.radius,y),x=(w-Math.max(w*n,0))/this._getVisibleDatasetWeightTotal();this.offsetX=m*w,this.offsetY=f*w,i.total=this.calculateTotal(),this.outerRadius=w-x*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-x*d,0),this.updateElements(o,0,o.length,e)}_circumference(e,t){const s=this.options,i=this._cachedMeta,o=this._getCircumference();return t&&s.animation.animateRotate||!this.chart.getDataVisibility(e)||null===i._parsed[e]||i.data[e].hidden?0:this.calculateCircumference(i._parsed[e]*o/ys)}updateElements(e,t,s,i){const o="reset"===i,r=this.chart,a=r.chartArea,n=r.options.animation,l=(a.left+a.right)/2,c=(a.top+a.bottom)/2,d=o&&n.animateScale,h=d?0:this.innerRadius,u=d?0:this.outerRadius,{sharedOptions:p,includeOptions:g}=this._getSharedOptions(t,i);let m,f=this._getRotation();for(m=0;m<t;++m)f+=this._circumference(m,o);for(m=t;m<t+s;++m){const t=this._circumference(m,o),s=e[m],r={x:l+this.offsetX,y:c+this.offsetY,startAngle:f,endAngle:f+t,circumference:t,outerRadius:u,innerRadius:h};g&&(r.options=p||this.resolveDataElementOptions(m,s.active?"active":i)),f+=t,this.updateElement(s,m,r,i)}}calculateTotal(){const e=this._cachedMeta,t=e.data;let s,i=0;for(s=0;s<t.length;s++){const o=e._parsed[s];null===o||isNaN(o)||!this.chart.getDataVisibility(s)||t[s].hidden||(i+=Math.abs(o))}return i}calculateCircumference(e){const t=this._cachedMeta.total;return t>0&&!isNaN(e)?ys*(Math.abs(e)/t):0}getLabelAndValue(e){const t=this._cachedMeta,s=this.chart,i=s.data.labels||[],o=di(t._parsed[e],s.options.locale);return{label:i[e]||"",value:o}}getMaxBorderWidth(e){let t=0;const s=this.chart;let i,o,r,a,n;if(!e)for(i=0,o=s.data.datasets.length;i<o;++i)if(s.isDatasetVisible(i)){r=s.getDatasetMeta(i),e=r.data,a=r.controller;break}if(!e)return 0;for(i=0,o=e.length;i<o;++i)n=a.resolveDataElementOptions(i),"inner"!==n.borderAlign&&(t=Math.max(t,n.borderWidth||0,n.hoverBorderWidth||0));return t}getMaxOffset(e){let t=0;for(let s=0,i=e.length;s<i;++s){const e=this.resolveDataElementOptions(s);t=Math.max(t,e.offset||0,e.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let s=0;s<e;++s)this.chart.isDatasetVisible(s)&&(t+=this._getRingWeight(s));return t}_getRingWeight(e){return Math.max(ts(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}class pr extends ir{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:s,color:i}}=e.legend.options;return t.labels.map((t,o)=>{const r=e.getDatasetMeta(0).controller.getStyle(o);return{text:t,fillStyle:r.backgroundColor,strokeStyle:r.borderColor,fontColor:i,lineWidth:r.borderWidth,pointStyle:s,hidden:!e.getDataVisibility(o),index:o}})}return[]}},onClick(e,t,s){s.chart.toggleDataVisibility(t.index),s.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(e,t){super(e,t),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const t=this._cachedMeta,s=this.chart,i=s.data.labels||[],o=di(t._parsed[e].r,s.options.locale);return{label:i[e]||"",value:o}}parseObjectData(e,t,s,i){return oo.bind(this)(e,t,s,i)}update(e){const t=this._cachedMeta.data;this._updateRadius(),this.updateElements(t,0,t.length,e)}getMinMax(){const e=this._cachedMeta,t={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach((e,s)=>{const i=this.getParsed(s).r;!isNaN(i)&&this.chart.getDataVisibility(s)&&(i<t.min&&(t.min=i),i>t.max&&(t.max=i))}),t}_updateRadius(){const e=this.chart,t=e.chartArea,s=e.options,i=Math.min(t.right-t.left,t.bottom-t.top),o=Math.max(i/2,0),r=(o-Math.max(s.cutoutPercentage?o/100*s.cutoutPercentage:1,0))/e.getVisibleDatasetCount();this.outerRadius=o-r*this.index,this.innerRadius=this.outerRadius-r}updateElements(e,t,s,i){const o="reset"===i,r=this.chart,a=r.options.animation,n=this._cachedMeta.rScale,l=n.xCenter,c=n.yCenter,d=n.getIndexAngle(0)-.5*bs;let h,u=d;const p=360/this.countVisibleElements();for(h=0;h<t;++h)u+=this._computeAngle(h,i,p);for(h=t;h<t+s;h++){const t=e[h];let s=u,g=u+this._computeAngle(h,i,p),m=r.getDataVisibility(h)?n.getDistanceFromCenterForValue(this.getParsed(h).r):0;u=g,o&&(a.animateScale&&(m=0),a.animateRotate&&(s=g=d));const f={x:l,y:c,innerRadius:0,outerRadius:m,startAngle:s,endAngle:g,options:this.resolveDataElementOptions(h,t.active?"active":i)};this.updateElement(t,h,f,i)}}countVisibleElements(){const e=this._cachedMeta;let t=0;return e.data.forEach((e,s)=>{!isNaN(this.getParsed(s).r)&&this.chart.getDataVisibility(s)&&t++}),t}_computeAngle(e,t,s){return this.chart.getDataVisibility(e)?Ts(this.resolveDataElementOptions(e,t).angle||s):0}}var gr=/* @__PURE__ */Object.freeze({__proto__:null,BarController:class extends ir{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(e,t,s,i){return ar(e,t,s,i)}parseArrayData(e,t,s,i){return ar(e,t,s,i)}parseObjectData(e,t,s,i){const{iScale:o,vScale:r}=e,{xAxisKey:a="x",yAxisKey:n="y"}=this._parsing,l="x"===o.axis?a:n,c="x"===r.axis?a:n,d=[];let h,u,p,g;for(h=s,u=s+i;h<u;++h)g=t[h],p={},p[o.axis]=o.parse(ps(g,l),h),d.push(rr(ps(g,c),p,r,h));return d}updateRangeFromParsed(e,t,s,i){super.updateRangeFromParsed(e,t,s,i);const o=s._custom;o&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,o.min),e.max=Math.max(e.max,o.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const t=this._cachedMeta,{iScale:s,vScale:i}=t,o=this.getParsed(e),r=o._custom,a=nr(r)?"["+r.start+", "+r.end+"]":""+i.getLabelForValue(o[i.axis]);return{label:""+s.getLabelForValue(o[s.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();this._cachedMeta.stack=this.getDataset().stack}update(e){const t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,s,i){const o="reset"===i,{index:r,_cachedMeta:{vScale:a}}=this,n=a.getBasePixel(),l=a.isHorizontal(),c=this._getRuler(),{sharedOptions:d,includeOptions:h}=this._getSharedOptions(t,i);for(let u=t;u<t+s;u++){const t=this.getParsed(u),s=o||Jt(t[a.axis])?{base:n,head:n}:this._calculateBarValuePixels(u),p=this._calculateBarIndexPixels(u,c),g=(t._stacks||{})[a.axis],m={horizontal:l,base:s.base,enableBorderRadius:!g||nr(t._custom)||r===g._top||r===g._bottom,x:l?s.head:p.center,y:l?p.center:s.head,height:l?p.size:Math.abs(s.size),width:l?Math.abs(s.size):p.size};h&&(m.options=d||this.resolveDataElementOptions(u,e[u].active?"active":i));const f=m.options||e[u].options;lr(m,f,g,r),hr(m,f,c.ratio),this.updateElement(e[u],u,m,i)}}_getStacks(e,t){const{iScale:s}=this._cachedMeta,i=s.getMatchingVisibleMetas(this._type).filter(e=>e.controller.options.grouped),o=s.options.stacked,r=[],a=this._cachedMeta.controller.getParsed(t),n=a&&a[s.axis],l=e=>{const t=e._parsed.find(e=>e[s.axis]===n),i=t&&t[e.vScale.axis];if(Jt(i)||isNaN(i))return!0};for(const c of i)if((void 0===t||!l(c))&&((!1===o||-1===r.indexOf(c.stack)||void 0===o&&void 0===c.stack)&&r.push(c.stack),c.index===e))break;return r.length||r.push(void 0),r}_getStackCount(e){return this._getStacks(void 0,e).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const e=this.chart.scales,t=this.chart.options.indexAxis;return Object.keys(e).filter(s=>e[s].axis===t).shift()}_getAxis(){const e={},t=this.getFirstScaleIdForIndexAxis();for(const s of this.chart.data.datasets)e[ts("x"===this.chart.options.indexAxis?s.xAxisID:s.yAxisID,t)]=!0;return Object.keys(e)}_getStackIndex(e,t,s){const i=this._getStacks(e,s),o=void 0!==t?i.indexOf(t):-1;return-1===o?i.length-1:o}_getRuler(){const e=this.options,t=this._cachedMeta,s=t.iScale,i=[];let o,r;for(o=0,r=t.data.length;o<r;++o)i.push(s.getPixelForValue(this.getParsed(o)[s.axis],o));const a=e.barThickness;return{min:a||or(t),pixels:i,start:s._startPixel,end:s._endPixel,stackCount:this._getStackCount(),scale:s,grouped:e.grouped,ratio:a?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:t,_stacked:s,index:i},options:{base:o,minBarLength:r}}=this,a=o||0,n=this.getParsed(e),l=n._custom,c=nr(l);let d,h,u=n[t.axis],p=0,g=s?this.applyStack(t,n,s):u;g!==u&&(p=g-u,g=u),c&&(u=l.barStart,g=l.barEnd-l.barStart,0!==u&&Ds(u)!==Ds(l.barEnd)&&(p=0),p+=u);const m=Jt(o)||c?p:o;let f=t.getPixelForValue(m);if(d=this.chart.getDataVisibility(e)?t.getPixelForValue(p+g):f,h=d-f,Math.abs(h)<r){h=function(e,t,s){return 0!==e?Ds(e):(t.isHorizontal()?1:-1)*(t.min>=s?1:-1)}(h,t,a)*r,u===a&&(f-=h/2);const e=t.getPixelForDecimal(0),o=t.getPixelForDecimal(1),l=Math.min(e,o),p=Math.max(e,o);f=Math.max(Math.min(f,p),l),d=f+h,s&&!c&&(n._stacks[t.axis]._visualValues[i]=t.getValueForPixel(d)-t.getValueForPixel(f))}if(f===t.getPixelForValue(a)){const e=Ds(h)*t.getLineWidthForValue(a)/2;f+=e,h-=e}return{size:h,base:f,head:d,center:d+h/2}}_calculateBarIndexPixels(e,t){const s=t.scale,i=this.options,o=i.skipNull,r=ts(i.maxBarThickness,1/0);let a,n;const l=this._getAxisCount();if(t.grouped){const s=o?this._getStackCount(e):t.stackCount,c="flex"===i.barThickness?function(e,t,s,i){const o=t.pixels,r=o[e];let a=e>0?o[e-1]:null,n=e<o.length-1?o[e+1]:null;const l=s.categoryPercentage;null===a&&(a=r-(null===n?t.end-t.start:n-r)),null===n&&(n=r+r-a);const c=r-(r-Math.min(a,n))/2*l;return{chunk:Math.abs(n-a)/2*l/i,ratio:s.barPercentage,start:c}}(e,t,i,s*l):function(e,t,s,i){const o=s.barThickness;let r,a;return Jt(o)?(r=t.min*s.categoryPercentage,a=s.barPercentage):(r=o*i,a=1),{chunk:r/i,ratio:a,start:t.pixels[e]-r/2}}(e,t,i,s*l),d="x"===this.chart.options.indexAxis?this.getDataset().xAxisID:this.getDataset().yAxisID,h=this._getAxis().indexOf(ts(d,this.getFirstScaleIdForIndexAxis())),u=this._getStackIndex(this.index,this._cachedMeta.stack,o?e:void 0)+h;a=c.start+c.chunk*u+c.chunk/2,n=Math.min(r,c.chunk*c.ratio)}else a=s.getPixelForValue(this.getParsed(e)[s.axis],e),n=Math.min(r,t.min*t.ratio);return{base:a-n/2,head:a+n/2,center:a,size:n}}draw(){const e=this._cachedMeta,t=e.vScale,s=e.data,i=s.length;let o=0;for(;o<i;++o)null===this.getParsed(o)[t.axis]||s[o].hidden||s[o].draw(this._ctx)}},BubbleController:class extends ir{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,t,s,i){const o=super.parsePrimitiveData(e,t,s,i);for(let r=0;r<o.length;r++)o[r]._custom=this.resolveDataElementOptions(r+s).radius;return o}parseArrayData(e,t,s,i){const o=super.parseArrayData(e,t,s,i);for(let r=0;r<o.length;r++){const e=t[s+r];o[r]._custom=ts(e[2],this.resolveDataElementOptions(r+s).radius)}return o}parseObjectData(e,t,s,i){const o=super.parseObjectData(e,t,s,i);for(let r=0;r<o.length;r++){const e=t[s+r];o[r]._custom=ts(e&&e.r&&+e.r,this.resolveDataElementOptions(r+s).radius)}return o}getMaxOverflow(){const e=this._cachedMeta.data;let t=0;for(let s=e.length-1;s>=0;--s)t=Math.max(t,e[s].size(this.resolveDataElementOptions(s))/2);return t>0&&t}getLabelAndValue(e){const t=this._cachedMeta,s=this.chart.data.labels||[],{xScale:i,yScale:o}=t,r=this.getParsed(e),a=i.getLabelForValue(r.x),n=o.getLabelForValue(r.y),l=r._custom;return{label:s[e]||"",value:"("+a+", "+n+(l?", "+l:"")+")"}}update(e){const t=this._cachedMeta.data;this.updateElements(t,0,t.length,e)}updateElements(e,t,s,i){const o="reset"===i,{iScale:r,vScale:a}=this._cachedMeta,{sharedOptions:n,includeOptions:l}=this._getSharedOptions(t,i),c=r.axis,d=a.axis;for(let h=t;h<t+s;h++){const t=e[h],s=!o&&this.getParsed(h),u={},p=u[c]=o?r.getPixelForDecimal(.5):r.getPixelForValue(s[c]),g=u[d]=o?a.getBasePixel():a.getPixelForValue(s[d]);u.skip=isNaN(p)||isNaN(g),l&&(u.options=n||this.resolveDataElementOptions(h,t.active?"active":i),o&&(u.options.radius=0)),this.updateElement(t,h,u,i)}}resolveDataElementOptions(e,t){const s=this.getParsed(e);let i=super.resolveDataElementOptions(e,t);i.$shared&&(i=Object.assign({},i,{$shared:!1}));const o=i.radius;return"active"!==t&&(i.radius=0),i.radius+=ts(s&&s._custom,o),i}},DoughnutController:ur,LineController:class extends ir{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:s,data:i=[],_dataset:o}=t,r=this.chart._animationsDisabled;let{start:a,count:n}=Xs(t,i,r);this._drawStart=a,this._drawCount=n,Zs(t)&&(a=0,n=i.length),s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!o._decimated,s.points=i;const l=this.resolveDatasetElementOptions(e);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(s,void 0,{animated:!r,options:l},e),this.updateElements(i,a,n,e)}updateElements(e,t,s,i){const o="reset"===i,{iScale:r,vScale:a,_stacked:n,_dataset:l}=this._cachedMeta,{sharedOptions:c,includeOptions:d}=this._getSharedOptions(t,i),h=r.axis,u=a.axis,{spanGaps:p,segment:g}=this.options,m=As(p)?p:Number.POSITIVE_INFINITY,f=this.chart._animationsDisabled||o||"none"===i,v=t+s,b=e.length;let y=t>0&&this.getParsed(t-1);for(let w=0;w<b;++w){const s=e[w],p=f?s:{};if(w<t||w>=v){p.skip=!0;continue}const b=this.getParsed(w),x=Jt(b[u]),_=p[h]=r.getPixelForValue(b[h],w),k=p[u]=o||x?a.getBasePixel():a.getPixelForValue(n?this.applyStack(a,b,n):b[u],w);p.skip=isNaN(_)||isNaN(k)||x,p.stop=w>0&&Math.abs(b[h]-y[h])>m,g&&(p.parsed=b,p.raw=l.data[w]),d&&(p.options=c||this.resolveDataElementOptions(w,s.active?"active":i)),f||this.updateElement(s,w,p,i),y=b}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,s=t.options&&t.options.borderWidth||0,i=e.data||[];if(!i.length)return s;const o=i[0].size(this.resolveDataElementOptions(0)),r=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(s,o,r)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}},PieController:class extends ur{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}},PolarAreaController:pr,RadarController:class extends ir{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(e){const t=this._cachedMeta.vScale,s=this.getParsed(e);return{label:t.getLabels()[e],value:""+t.getLabelForValue(s[t.axis])}}parseObjectData(e,t,s,i){return oo.bind(this)(e,t,s,i)}update(e){const t=this._cachedMeta,s=t.dataset,i=t.data||[],o=t.iScale.getLabels();if(s.points=i,"resize"!==e){const t=this.resolveDatasetElementOptions(e);this.options.showLine||(t.borderWidth=0);const r={_loop:!0,_fullLoop:o.length===i.length,options:t};this.updateElement(s,void 0,r,e)}this.updateElements(i,0,i.length,e)}updateElements(e,t,s,i){const o=this._cachedMeta.rScale,r="reset"===i;for(let a=t;a<t+s;a++){const t=e[a],s=this.resolveDataElementOptions(a,t.active?"active":i),n=o.getPointPositionForValue(a,this.getParsed(a).r),l=r?o.xCenter:n.x,c=r?o.yCenter:n.y,d={x:l,y:c,angle:n.angle,skip:isNaN(l)||isNaN(c),options:s};this.updateElement(t,a,d,i)}}},ScatterController:class extends ir{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(e){const t=this._cachedMeta,s=this.chart.data.labels||[],{xScale:i,yScale:o}=t,r=this.getParsed(e),a=i.getLabelForValue(r.x),n=o.getLabelForValue(r.y);return{label:s[e]||"",value:"("+a+", "+n+")"}}update(e){const t=this._cachedMeta,{data:s=[]}=t,i=this.chart._animationsDisabled;let{start:o,count:r}=Xs(t,s,i);if(this._drawStart=o,this._drawCount=r,Zs(t)&&(o=0,r=s.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:o,_dataset:r}=t;o._chart=this.chart,o._datasetIndex=this.index,o._decimated=!!r._decimated,o.points=s;const a=this.resolveDatasetElementOptions(e);a.segment=this.options.segment,this.updateElement(o,void 0,{animated:!i,options:a},e)}else this.datasetElementType&&(delete t.dataset,this.datasetElementType=!1);this.updateElements(s,o,r,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,t,s,i){const o="reset"===i,{iScale:r,vScale:a,_stacked:n,_dataset:l}=this._cachedMeta,c=this.resolveDataElementOptions(t,i),d=this.getSharedOptions(c),h=this.includeOptions(i,d),u=r.axis,p=a.axis,{spanGaps:g,segment:m}=this.options,f=As(g)?g:Number.POSITIVE_INFINITY,v=this.chart._animationsDisabled||o||"none"===i;let b=t>0&&this.getParsed(t-1);for(let y=t;y<t+s;++y){const t=e[y],s=this.getParsed(y),c=v?t:{},g=Jt(s[p]),w=c[u]=r.getPixelForValue(s[u],y),x=c[p]=o||g?a.getBasePixel():a.getPixelForValue(n?this.applyStack(a,s,n):s[p],y);c.skip=isNaN(w)||isNaN(x)||g,c.stop=y>0&&Math.abs(s[u]-b[u])>f,m&&(c.parsed=s,c.raw=l.data[y]),h&&(c.options=d||this.resolveDataElementOptions(y,t.active?"active":i)),v||this.updateElement(t,y,c,i),b=s}this.updateSharedOptions(d,i,c)}getMaxOverflow(){const e=this._cachedMeta,t=e.data||[];if(!this.options.showLine){let e=0;for(let s=t.length-1;s>=0;--s)e=Math.max(e,t[s].size(this.resolveDataElementOptions(s))/2);return e>0&&e}const s=e.dataset,i=s.options&&s.options.borderWidth||0;if(!t.length)return i;const o=t[0].size(this.resolveDataElementOptions(0)),r=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(i,o,r)/2}}});function mr(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class fr{static override(e){Object.assign(fr.prototype,e)}options;constructor(e){this.options=e||{}}init(){}formats(){return mr()}parse(){return mr()}format(){return mr()}add(){return mr()}diff(){return mr()}startOf(){return mr()}endOf(){return mr()}}var vr=fr;function br(e,t,s,i){const{controller:o,data:r,_sorted:a}=e,n=o._cachedMeta.iScale,l=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null;if(n&&t===n.axis&&"r"!==t&&a&&r.length){const a=n._reversePixels?Hs:js;if(!i){const i=a(r,t,s);if(l){const{vScale:t}=o._cachedMeta,{_parsed:s}=e,r=s.slice(0,i.lo+1).reverse().findIndex(e=>!Jt(e[t.axis]));i.lo-=Math.max(0,r);const a=s.slice(i.hi).findIndex(e=>!Jt(e[t.axis]));i.hi+=Math.max(0,a)}return i}if(o._sharedOptions){const e=r[0],i="function"==typeof e.getRange&&e.getRange(t);if(i){const e=a(r,t,s-i),o=a(r,t,s+i);return{lo:e.lo,hi:o.hi}}}}return{lo:0,hi:r.length-1}}function yr(e,t,s,i,o){const r=e.getSortedVisibleDatasetMetas(),a=s[t];for(let n=0,l=r.length;n<l;++n){const{index:e,data:s}=r[n],{lo:l,hi:c}=br(r[n],t,a,o);for(let t=l;t<=c;++t){const o=s[t];o.skip||i(o,e,t)}}}function wr(e,t,s,i,o){const r=[];if(!o&&!e.isPointInArea(t))return r;return yr(e,s,t,function(s,a,n){(o||Ci(s,e.chartArea,0))&&s.inRange(t.x,t.y,i)&&r.push({element:s,datasetIndex:a,index:n})},!0),r}function xr(e,t,s,i,o,r){let a=[];const n=function(e){const t=-1!==e.indexOf("x"),s=-1!==e.indexOf("y");return function(e,i){const o=t?Math.abs(e.x-i.x):0,r=s?Math.abs(e.y-i.y):0;return Math.sqrt(Math.pow(o,2)+Math.pow(r,2))}}(s);let l=Number.POSITIVE_INFINITY;return yr(e,s,t,function(s,c,d){const h=s.inRange(t.x,t.y,o);if(i&&!h)return;const u=s.getCenterPoint(o);if(!(!!r||e.isPointInArea(u))&&!h)return;const p=n(t,u);p<l?(a=[{element:s,datasetIndex:c,index:d}],l=p):p===l&&a.push({element:s,datasetIndex:c,index:d})}),a}function _r(e,t,s,i,o,r){return r||e.isPointInArea(t)?"r"!==s||i?xr(e,t,s,i,o,r):function(e,t,s,i){let o=[];return yr(e,s,t,function(e,s,r){const{startAngle:a,endAngle:n}=e.getProps(["startAngle","endAngle"],i),{angle:l}=Rs(e,{x:t.x,y:t.y});Fs(l,a,n)&&o.push({element:e,datasetIndex:s,index:r})}),o}(e,t,s,o):[]}function kr(e,t,s,i,o){const r=[],a="x"===s?"inXRange":"inYRange";let n=!1;return yr(e,s,t,(e,i,l)=>{e[a]&&e[a](t[s],o)&&(r.push({element:e,datasetIndex:i,index:l}),n=n||e.inRange(t.x,t.y,o))}),i&&!n?[]:r}var Sr={modes:{index(e,t,s,i){const o=yo(t,e),r=s.axis||"x",a=s.includeInvisible||!1,n=s.intersect?wr(e,o,r,i,a):_r(e,o,r,!1,i,a),l=[];return n.length?(e.getSortedVisibleDatasetMetas().forEach(e=>{const t=n[0].index,s=e.data[t];s&&!s.skip&&l.push({element:s,datasetIndex:e.index,index:t})}),l):[]},dataset(e,t,s,i){const o=yo(t,e),r=s.axis||"xy",a=s.includeInvisible||!1;let n=s.intersect?wr(e,o,r,i,a):_r(e,o,r,!1,i,a);if(n.length>0){const t=n[0].datasetIndex,s=e.getDatasetMeta(t).data;n=[];for(let e=0;e<s.length;++e)n.push({element:s[e],datasetIndex:t,index:e})}return n},point:(e,t,s,i)=>wr(e,yo(t,e),s.axis||"xy",i,s.includeInvisible||!1),nearest(e,t,s,i){const o=yo(t,e),r=s.axis||"xy",a=s.includeInvisible||!1;return _r(e,o,r,s.intersect,i,a)},x:(e,t,s,i)=>kr(e,yo(t,e),"x",s.intersect,i),y:(e,t,s,i)=>kr(e,yo(t,e),"y",s.intersect,i)}};const Cr=["left","top","right","bottom"];function $r(e,t){return e.filter(e=>e.pos===t)}function Dr(e,t){return e.filter(e=>-1===Cr.indexOf(e.pos)&&e.box.axis===t)}function Er(e,t){return e.sort((e,s)=>{const i=t?s:e,o=t?e:s;return i.weight===o.weight?i.index-o.index:i.weight-o.weight})}function Mr(e,t){const s=function(e){const t={};for(const s of e){const{stack:e,pos:i,stackWeight:o}=s;if(!e||!Cr.includes(i))continue;const r=t[e]||(t[e]={count:0,placed:0,weight:0,size:0});r.count++,r.weight+=o}return t}(e),{vBoxMaxWidth:i,hBoxMaxHeight:o}=t;let r,a,n;for(r=0,a=e.length;r<a;++r){n=e[r];const{fullSize:a}=n.box,l=s[n.stack],c=l&&n.stackWeight/l.weight;n.horizontal?(n.width=c?c*i:a&&t.availableWidth,n.height=o):(n.width=i,n.height=c?c*o:a&&t.availableHeight)}return s}function Ar(e,t,s,i){return Math.max(e[s],t[s])+Math.max(e[i],t[i])}function Ir(e,t){e.top=Math.max(e.top,t.top),e.left=Math.max(e.left,t.left),e.bottom=Math.max(e.bottom,t.bottom),e.right=Math.max(e.right,t.right)}function Tr(e,t,s,i){const{pos:o,box:r}=s,a=e.maxPadding;if(!Xt(o)){s.size&&(e[o]-=s.size);const t=i[s.stack]||{size:0,count:1};t.size=Math.max(t.size,s.horizontal?r.height:r.width),s.size=t.size/t.count,e[o]+=s.size}r.getPadding&&Ir(a,r.getPadding());const n=Math.max(0,t.outerWidth-Ar(a,e,"left","right")),l=Math.max(0,t.outerHeight-Ar(a,e,"top","bottom")),c=n!==e.w,d=l!==e.h;return e.w=n,e.h=l,s.horizontal?{same:c,other:d}:{same:d,other:c}}function Pr(e,t){const s=t.maxPadding;function i(e){const i={left:0,top:0,right:0,bottom:0};return e.forEach(e=>{i[e]=Math.max(t[e],s[e])}),i}return i(e?["left","right"]:["top","bottom"])}function Lr(e,t,s,i){const o=[];let r,a,n,l,c,d;for(r=0,a=e.length,c=0;r<a;++r){n=e[r],l=n.box,l.update(n.width||t.w,n.height||t.h,Pr(n.horizontal,t));const{same:a,other:h}=Tr(t,s,n,i);c|=a&&o.length,d=d||h,l.fullSize||o.push(n)}return c&&Lr(o,t,s,i)||d}function Rr(e,t,s,i,o){e.top=s,e.left=t,e.right=t+i,e.bottom=s+o,e.width=i,e.height=o}function Or(e,t,s,i){const o=s.padding;let{x:r,y:a}=t;for(const n of e){const e=n.box,l=i[n.stack]||{placed:0,weight:1},c=n.stackWeight/l.weight||1;if(n.horizontal){const i=t.w*c,r=l.size||e.height;ms(l.start)&&(a=l.start),e.fullSize?Rr(e,o.left,a,s.outerWidth-o.right-o.left,r):Rr(e,t.left+l.placed,a,i,r),l.start=a,l.placed+=i,a=e.bottom}else{const i=t.h*c,a=l.size||e.width;ms(l.start)&&(r=l.start),e.fullSize?Rr(e,r,o.top,a,s.outerHeight-o.bottom-o.top):Rr(e,r,t.top+l.placed,a,i),l.start=r,l.placed+=i,r=e.right}}t.x=r,t.y=a}var Nr={addBox(e,t){e.boxes||(e.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},e.boxes.push(t)},removeBox(e,t){const s=e.boxes?e.boxes.indexOf(t):-1;-1!==s&&e.boxes.splice(s,1)},configure(e,t,s){t.fullSize=s.fullSize,t.position=s.position,t.weight=s.weight},update(e,t,s,i){if(!e)return;const o=Ui(e.options.layout.padding),r=Math.max(t-o.width,0),a=Math.max(s-o.height,0),n=function(e){const t=function(e){const t=[];let s,i,o,r,a,n;for(s=0,i=(e||[]).length;s<i;++s)o=e[s],({position:r,options:{stack:a,stackWeight:n=1}}=o),t.push({index:s,box:o,pos:r,horizontal:o.isHorizontal(),weight:o.weight,stack:a&&r+a,stackWeight:n});return t}(e),s=Er(t.filter(e=>e.box.fullSize),!0),i=Er($r(t,"left"),!0),o=Er($r(t,"right")),r=Er($r(t,"top"),!0),a=Er($r(t,"bottom")),n=Dr(t,"x"),l=Dr(t,"y");return{fullSize:s,leftAndTop:i.concat(r),rightAndBottom:o.concat(l).concat(a).concat(n),chartArea:$r(t,"chartArea"),vertical:i.concat(o).concat(l),horizontal:r.concat(a).concat(n)}}(e.boxes),l=n.vertical,c=n.horizontal;os(e.boxes,e=>{"function"==typeof e.beforeLayout&&e.beforeLayout()});const d=l.reduce((e,t)=>t.box.options&&!1===t.box.options.display?e:e+1,0)||1,h=Object.freeze({outerWidth:t,outerHeight:s,padding:o,availableWidth:r,availableHeight:a,vBoxMaxWidth:r/2/d,hBoxMaxHeight:a/2}),u=Object.assign({},o);Ir(u,Ui(i));const p=Object.assign({maxPadding:u,w:r,h:a,x:o.left,y:o.top},o),g=Mr(l.concat(c),h);Lr(n.fullSize,p,h,g),Lr(l,p,h,g),Lr(c,p,h,g)&&Lr(l,p,h,g),function(e){const t=e.maxPadding;function s(s){const i=Math.max(t[s]-e[s],0);return e[s]+=i,i}e.y+=s("top"),e.x+=s("left"),s("right"),s("bottom")}(p),Or(n.leftAndTop,p,h,g),p.x+=p.w,p.y+=p.h,Or(n.rightAndBottom,p,h,g),e.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},os(n.chartArea,t=>{const s=t.box;Object.assign(s,e.chartArea),s.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})})}};class Br{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,s){}removeEventListener(e,t,s){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,s,i){return t=Math.max(0,t||e.width),s=s||e.height,{width:t,height:Math.max(0,i?Math.floor(t/i):s)}}isAttached(e){return!0}updateConfig(e){}}class Fr extends Br{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const zr="$chartjs",Ur={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Vr=e=>null===e||""===e;const jr=!!ko&&{passive:!0};function Hr(e,t,s){e&&e.canvas&&e.canvas.removeEventListener(t,s,jr)}function Wr(e,t){for(const s of e)if(s===t||s.contains(t))return!0}function qr(e,t,s){const i=e.canvas,o=new MutationObserver(e=>{let t=!1;for(const s of e)t=t||Wr(s.addedNodes,i),t=t&&!Wr(s.removedNodes,i);t&&s()});return o.observe(document,{childList:!0,subtree:!0}),o}function Kr(e,t,s){const i=e.canvas,o=new MutationObserver(e=>{let t=!1;for(const s of e)t=t||Wr(s.removedNodes,i),t=t&&!Wr(s.addedNodes,i);t&&s()});return o.observe(document,{childList:!0,subtree:!0}),o}const Gr=/* @__PURE__ */new Map;let Qr=0;function Jr(){const e=window.devicePixelRatio;e!==Qr&&(Qr=e,Gr.forEach((t,s)=>{s.currentDevicePixelRatio!==e&&t()}))}function Yr(e,t,s){const i=e.canvas,o=i&&go(i);if(!o)return;const r=Qs((e,t)=>{const i=o.clientWidth;s(e,t),i<o.clientWidth&&s()},window),a=new ResizeObserver(e=>{const t=e[0],s=t.contentRect.width,i=t.contentRect.height;0===s&&0===i||r(s,i)});return a.observe(o),function(e,t){Gr.size||window.addEventListener("resize",Jr),Gr.set(e,t)}(e,r),a}function Xr(e,t,s){s&&s.disconnect(),"resize"===t&&function(e){Gr.delete(e),Gr.size||window.removeEventListener("resize",Jr)}(e)}function Zr(e,t,s){const i=e.canvas,o=Qs(t=>{null!==e.ctx&&s(function(e,t){const s=Ur[e.type]||e.type,{x:i,y:o}=yo(e,t);return{type:s,chart:t,native:e,x:void 0!==i?i:null,y:void 0!==o?o:null}}(t,e))},e);return function(e,t,s){e&&e.addEventListener(t,s,jr)}(i,t,o),o}class ea extends Br{acquireContext(e,t){const s=e&&e.getContext&&e.getContext("2d");return s&&s.canvas===e?(function(e,t){const s=e.style,i=e.getAttribute("height"),o=e.getAttribute("width");if(e[zr]={initial:{height:i,width:o,style:{display:s.display,height:s.height,width:s.width}}},s.display=s.display||"block",s.boxSizing=s.boxSizing||"border-box",Vr(o)){const t=So(e,"width");void 0!==t&&(e.width=t)}if(Vr(i))if(""===e.style.height)e.height=e.width/(t||2);else{const t=So(e,"height");void 0!==t&&(e.height=t)}}(e,t),s):null}releaseContext(e){const t=e.canvas;if(!t[zr])return!1;const s=t[zr].initial;["height","width"].forEach(e=>{const i=s[e];Jt(i)?t.removeAttribute(e):t.setAttribute(e,i)});const i=s.style||{};return Object.keys(i).forEach(e=>{t.style[e]=i[e]}),t.width=t.width,delete t[zr],!0}addEventListener(e,t,s){this.removeEventListener(e,t);const i=e.$proxies||(e.$proxies={}),o={attach:qr,detach:Kr,resize:Yr}[t]||Zr;i[t]=o(e,t,s)}removeEventListener(e,t){const s=e.$proxies||(e.$proxies={}),i=s[t];if(!i)return;({attach:Xr,detach:Xr,resize:Xr}[t]||Hr)(e,t,i),s[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,s,i){return xo(e,t,s,i)}isAttached(e){const t=e&&go(e);return!(!t||!t.isConnected)}}class ta{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(e){const{x:t,y:s}=this.getProps(["x","y"],e);return{x:t,y:s}}hasValue(){return As(this.x)&&As(this.y)}getProps(e,t){const s=this.$animations;if(!t||!s)return this;const i={};return e.forEach(e=>{i[e]=s[e]&&s[e].active()?s[e]._to:this[e]}),i}}function sa(e,t){const s=e.options.ticks,i=function(e){const t=e.options.offset,s=e._tickSize(),i=e._length/s+(t?0:1),o=e._maxLength/s;return Math.floor(Math.min(i,o))}(e),o=Math.min(s.maxTicksLimit||i,i),r=s.major.enabled?function(e){const t=[];let s,i;for(s=0,i=e.length;s<i;s++)e[s].major&&t.push(s);return t}(t):[],a=r.length,n=r[0],l=r[a-1],c=[];if(a>o)return function(e,t,s,i){let o,r=0,a=s[0];for(i=Math.ceil(i),o=0;o<e.length;o++)o===a&&(t.push(e[o]),r++,a=s[r*i])}(t,c,r,a/o),c;const d=function(e,t,s){const i=function(e){const t=e.length;let s,i;if(t<2)return!1;for(i=e[0],s=1;s<t;++s)if(e[s]-e[s-1]!==i)return!1;return i}(e),o=t.length/s;if(!i)return Math.max(o,1);const r=function(e){const t=[],s=Math.sqrt(e);let i;for(i=1;i<s;i++)e%i===0&&(t.push(i),t.push(e/i));return s===(0|s)&&t.push(s),t.sort((e,t)=>e-t).pop(),t}(i);for(let a=0,n=r.length-1;a<n;a++){const e=r[a];if(e>o)return e}return Math.max(o,1)}(r,t,o);if(a>0){let e,s;const i=a>1?Math.round((l-n)/(a-1)):null;for(ia(t,c,d,Jt(i)?0:n-i,n),e=0,s=a-1;e<s;e++)ia(t,c,d,r[e],r[e+1]);return ia(t,c,d,l,Jt(i)?t.length:l+i),c}return ia(t,c,d),c}function ia(e,t,s,i,o){const r=ts(i,0),a=Math.min(ts(o,e.length),e.length);let n,l,c,d=0;for(s=Math.ceil(s),o&&(n=o-i,s=n/Math.floor(n/s)),c=r;c<0;)d++,c=Math.round(r+d*s);for(l=Math.max(r,0);l<a;l++)l===c&&(t.push(e[l]),d++,c=Math.round(r+d*s))}const oa=(e,t,s)=>"top"===t||"left"===t?e[t]+s:e[t]-s,ra=(e,t)=>Math.min(t||e,e);function aa(e,t){const s=[],i=e.length/t,o=e.length;let r=0;for(;r<o;r+=i)s.push(e[Math.floor(r)]);return s}function na(e,t,s){const i=e.ticks.length,o=Math.min(t,i-1),r=e._startPixel,a=e._endPixel,n=1e-6;let l,c=e.getPixelForTick(o);if(!(s&&(l=1===i?Math.max(c-r,a-c):0===t?(e.getPixelForTick(1)-c)/2:(c-e.getPixelForTick(o-1))/2,c+=o<t?l:-l,c<r-n||c>a+n)))return c}function la(e){return e.drawTicks?e.tickLength:0}function ca(e,t){if(!e.display)return 0;const s=Vi(e.font,t),i=Ui(e.padding);return(Yt(e.text)?e.text.length:1)*s.lineHeight+i.height}function da(e,t,s){let i=Js(e);return(s&&"right"!==t||!s&&"right"===t)&&(i=(e=>"left"===e?"right":"right"===e?"left":e)(i)),i}class ha extends ta{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:s,_suggestedMax:i}=this;return e=es(e,Number.POSITIVE_INFINITY),t=es(t,Number.NEGATIVE_INFINITY),s=es(s,Number.POSITIVE_INFINITY),i=es(i,Number.NEGATIVE_INFINITY),{min:es(e,s),max:es(t,i),minDefined:Zt(e),maxDefined:Zt(t)}}getMinMax(e){let t,{min:s,max:i,minDefined:o,maxDefined:r}=this.getUserBounds();if(o&&r)return{min:s,max:i};const a=this.getMatchingVisibleMetas();for(let n=0,l=a.length;n<l;++n)t=a[n].controller.getMinMax(this,e),o||(s=Math.min(s,t.min)),r||(i=Math.max(i,t.max));return s=r&&s>i?i:s,i=o&&s>i?s:i,{min:es(s,es(i,s)),max:es(i,es(s,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){is(this.options.beforeUpdate,[this])}update(e,t,s){const{beginAtZero:i,grace:o,ticks:r}=this.options,a=r.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=s=Object.assign({left:0,right:0,top:0,bottom:0},s),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+s.left+s.right:this.height+s.top+s.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(e,t,s){const{min:i,max:o}=e,r=ss(t,(o-i)/2),a=(e,t)=>s&&0===e?0:e+t;return{min:a(i,-Math.abs(r)),max:a(o,r)}}(this,o,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const n=a<this.ticks.length;this._convertTicksToLabels(n?aa(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),r.display&&(r.autoSkip||"auto"===r.source)&&(this.ticks=sa(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),n&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e,t,s=this.options.reverse;this.isHorizontal()?(e=this.left,t=this.right):(e=this.top,t=this.bottom,s=!s),this._startPixel=e,this._endPixel=t,this._reversePixels=s,this._length=t-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){is(this.options.afterUpdate,[this])}beforeSetDimensions(){is(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){is(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),is(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){is(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let s,i,o;for(s=0,i=e.length;s<i;s++)o=e[s],o.label=is(t.callback,[o.value,s,e],this)}afterTickToLabelConversion(){is(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){is(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,s=ra(this.ticks.length,e.ticks.maxTicksLimit),i=t.minRotation||0,o=t.maxRotation;let r,a,n,l=i;if(!this._isVisible()||!t.display||i>=o||s<=1||!this.isHorizontal())return void(this.labelRotation=i);const c=this._getLabelSizes(),d=c.widest.width,h=c.highest.height,u=zs(this.chart.width-d,0,this.maxWidth);r=e.offset?this.maxWidth/s:u/(s-1),d+6>r&&(r=u/(s-(e.offset?.5:1)),a=this.maxHeight-la(e.grid)-t.padding-ca(e.title,this.chart.options.font),n=Math.sqrt(d*d+h*h),l=Ps(Math.min(Math.asin(zs((c.highest.height+6)/r,-1,1)),Math.asin(zs(a/n,-1,1))-Math.asin(zs(h/n,-1,1)))),l=Math.max(i,Math.min(o,l))),this.labelRotation=l}afterCalculateLabelRotation(){is(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){is(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:s,title:i,grid:o}}=this,r=this._isVisible(),a=this.isHorizontal();if(r){const r=ca(i,t.options.font);if(a?(e.width=this.maxWidth,e.height=la(o)+r):(e.height=this.maxHeight,e.width=la(o)+r),s.display&&this.ticks.length){const{first:t,last:i,widest:o,highest:r}=this._getLabelSizes(),n=2*s.padding,l=Ts(this.labelRotation),c=Math.cos(l),d=Math.sin(l);if(a){const t=s.mirror?0:d*o.width+c*r.height;e.height=Math.min(this.maxHeight,e.height+t+n)}else{const t=s.mirror?0:c*o.width+d*r.height;e.width=Math.min(this.maxWidth,e.width+t+n)}this._calculatePadding(t,i,d,c)}}this._handleMargins(),a?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,s,i){const{ticks:{align:o,padding:r},position:a}=this.options,n=0!==this.labelRotation,l="top"!==a&&"x"===this.axis;if(this.isHorizontal()){const a=this.getPixelForTick(0)-this.left,c=this.right-this.getPixelForTick(this.ticks.length-1);let d=0,h=0;n?l?(d=i*e.width,h=s*t.height):(d=s*e.height,h=i*t.width):"start"===o?h=t.width:"end"===o?d=e.width:"inner"!==o&&(d=e.width/2,h=t.width/2),this.paddingLeft=Math.max((d-a+r)*this.width/(this.width-a),0),this.paddingRight=Math.max((h-c+r)*this.width/(this.width-c),0)}else{let s=t.height/2,i=e.height/2;"start"===o?(s=0,i=e.height):"end"===o&&(s=t.height,i=0),this.paddingTop=s+r,this.paddingBottom=i+r}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){is(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return"top"===t||"bottom"===t||"x"===e}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){let t,s;for(this.beforeTickToLabelConversion(),this.generateTickLabels(e),t=0,s=e.length;t<s;t++)Jt(e[t].label)&&(e.splice(t,1),s--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let s=this.ticks;t<s.length&&(s=aa(s,t)),this._labelSizes=e=this._computeLabelSizes(s,s.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,s){const{ctx:i,_longestTextCache:o}=this,r=[],a=[],n=Math.floor(t/ra(t,s));let l,c,d,h,u,p,g,m,f,v,b,y=0,w=0;for(l=0;l<t;l+=n){if(h=e[l].label,u=this._resolveTickFontOptions(l),i.font=p=u.string,g=o[p]=o[p]||{data:{},gc:[]},m=u.lineHeight,f=v=0,Jt(h)||Yt(h)){if(Yt(h))for(c=0,d=h.length;c<d;++c)b=h[c],Jt(b)||Yt(b)||(f=yi(i,g.data,g.gc,f,b),v+=m)}else f=yi(i,g.data,g.gc,f,h),v=m;r.push(f),a.push(v),y=Math.max(f,y),w=Math.max(v,w)}!function(e,t){os(e,e=>{const s=e.gc,i=s.length/2;let o;if(i>t){for(o=0;o<i;++o)delete e.data[s[o]];s.splice(0,i)}})}(o,t);const x=r.indexOf(y),_=a.indexOf(w),k=e=>({width:r[e]||0,height:a[e]||0});return{first:k(0),last:k(t-1),widest:k(x),highest:k(_),widths:r,heights:a}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return zs(this._alignToPixels?xi(this.chart,t,0):t,-32768,32767)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const s=t[e];return s.$context||(s.$context=function(e,t,s){return Hi(e,{tick:s,index:t,type:"tick"})}(this.getContext(),e,s))}return this.$context||(this.$context=Hi(this.chart.getContext(),{scale:this,type:"scale"}))}_tickSize(){const e=this.options.ticks,t=Ts(this.labelRotation),s=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t)),o=this._getLabelSizes(),r=e.autoSkipPadding||0,a=o?o.widest.width+r:0,n=o?o.highest.height+r:0;return this.isHorizontal()?n*s>a*i?a/s:n/i:n*i<a*s?n/s:a/i}_isVisible(){const e=this.options.display;return"auto"!==e?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,s=this.chart,i=this.options,{grid:o,position:r,border:a}=i,n=o.offset,l=this.isHorizontal(),c=this.ticks.length+(n?1:0),d=la(o),h=[],u=a.setContext(this.getContext()),p=u.display?u.width:0,g=p/2,m=function(e){return xi(s,e,p)};let f,v,b,y,w,x,_,k,S,C,$,D;if("top"===r)f=m(this.bottom),x=this.bottom-d,k=f-g,C=m(e.top)+g,D=e.bottom;else if("bottom"===r)f=m(this.top),C=e.top,D=m(e.bottom)-g,x=f+g,k=this.top+d;else if("left"===r)f=m(this.right),w=this.right-d,_=f-g,S=m(e.left)+g,$=e.right;else if("right"===r)f=m(this.left),S=e.left,$=m(e.right)-g,w=f+g,_=this.left+d;else if("x"===t){if("center"===r)f=m((e.top+e.bottom)/2+.5);else if(Xt(r)){const e=Object.keys(r)[0],t=r[e];f=m(this.chart.scales[e].getPixelForValue(t))}C=e.top,D=e.bottom,x=f+g,k=x+d}else if("y"===t){if("center"===r)f=m((e.left+e.right)/2);else if(Xt(r)){const e=Object.keys(r)[0],t=r[e];f=m(this.chart.scales[e].getPixelForValue(t))}w=f-g,_=w-d,S=e.left,$=e.right}const E=ts(i.ticks.maxTicksLimit,c),M=Math.max(1,Math.ceil(c/E));for(v=0;v<c;v+=M){const e=this.getContext(v),t=o.setContext(e),i=a.setContext(e),r=t.lineWidth,c=t.color,d=i.dash||[],u=i.dashOffset,p=t.tickWidth,g=t.tickColor,m=t.tickBorderDash||[],f=t.tickBorderDashOffset;b=na(this,v,n),void 0!==b&&(y=xi(s,b,r),l?w=_=S=$=y:x=k=C=D=y,h.push({tx1:w,ty1:x,tx2:_,ty2:k,x1:S,y1:C,x2:$,y2:D,width:r,color:c,borderDash:d,borderDashOffset:u,tickWidth:p,tickColor:g,tickBorderDash:m,tickBorderDashOffset:f}))}return this._ticksLength=c,this._borderValue=f,h}_computeLabelItems(e){const t=this.axis,s=this.options,{position:i,ticks:o}=s,r=this.isHorizontal(),a=this.ticks,{align:n,crossAlign:l,padding:c,mirror:d}=o,h=la(s.grid),u=h+c,p=d?-c:u,g=-Ts(this.labelRotation),m=[];let f,v,b,y,w,x,_,k,S,C,$,D,E="middle";if("top"===i)x=this.bottom-p,_=this._getXAxisLabelAlignment();else if("bottom"===i)x=this.top+p,_=this._getXAxisLabelAlignment();else if("left"===i){const e=this._getYAxisLabelAlignment(h);_=e.textAlign,w=e.x}else if("right"===i){const e=this._getYAxisLabelAlignment(h);_=e.textAlign,w=e.x}else if("x"===t){if("center"===i)x=(e.top+e.bottom)/2+u;else if(Xt(i)){const e=Object.keys(i)[0],t=i[e];x=this.chart.scales[e].getPixelForValue(t)+u}_=this._getXAxisLabelAlignment()}else if("y"===t){if("center"===i)w=(e.left+e.right)/2-u;else if(Xt(i)){const e=Object.keys(i)[0],t=i[e];w=this.chart.scales[e].getPixelForValue(t)}_=this._getYAxisLabelAlignment(h).textAlign}"y"===t&&("start"===n?E="top":"end"===n&&(E="bottom"));const M=this._getLabelSizes();for(f=0,v=a.length;f<v;++f){b=a[f],y=b.label;const e=o.setContext(this.getContext(f));k=this.getPixelForTick(f)+o.labelOffset,S=this._resolveTickFontOptions(f),C=S.lineHeight,$=Yt(y)?y.length:1;const t=$/2,s=e.color,n=e.textStrokeColor,c=e.textStrokeWidth;let h,u=_;if(r?(w=k,"inner"===_&&(u=f===v-1?this.options.reverse?"left":"right":0===f?this.options.reverse?"right":"left":"center"),D="top"===i?"near"===l||0!==g?-$*C+C/2:"center"===l?-M.highest.height/2-t*C+C:-M.highest.height+C/2:"near"===l||0!==g?C/2:"center"===l?M.highest.height/2-t*C:M.highest.height-$*C,d&&(D*=-1),0===g||e.showLabelBackdrop||(w+=C/2*Math.sin(g))):(x=k,D=(1-$)*C/2),e.showLabelBackdrop){const t=Ui(e.backdropPadding),s=M.heights[f],i=M.widths[f];let o=D-t.top,r=0-t.left;switch(E){case"middle":o-=s/2;break;case"bottom":o-=s}switch(_){case"center":r-=i/2;break;case"right":r-=i;break;case"inner":f===v-1?r-=i:f>0&&(r-=i/2)}h={left:r,top:o,width:i+t.width,height:s+t.height,color:e.backdropColor}}m.push({label:y,font:S,textOffset:D,options:{rotation:g,color:s,strokeColor:n,strokeWidth:c,textAlign:u,textBaseline:E,translation:[w,x],backdrop:h}})}return m}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-Ts(this.labelRotation))return"top"===e?"left":"right";let s="center";return"start"===t.align?s="left":"end"===t.align?s="right":"inner"===t.align&&(s="inner"),s}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:s,mirror:i,padding:o}}=this.options,r=e+o,a=this._getLabelSizes().widest.width;let n,l;return"left"===t?i?(l=this.right+o,"near"===s?n="left":"center"===s?(n="center",l+=a/2):(n="right",l+=a)):(l=this.right-r,"near"===s?n="right":"center"===s?(n="center",l-=a/2):(n="left",l=this.left)):"right"===t?i?(l=this.left+o,"near"===s?n="right":"center"===s?(n="center",l-=a/2):(n="left",l-=a)):(l=this.left+r,"near"===s?n="left":"center"===s?(n="center",l+=a/2):(n="right",l=this.right)):n="right",{textAlign:n,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;return"left"===t||"right"===t?{top:0,left:this.left,bottom:e.height,right:this.right}:"top"===t||"bottom"===t?{top:this.top,left:0,bottom:this.bottom,right:e.width}:void 0}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:s,top:i,width:o,height:r}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(s,i,o,r),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const s=this.ticks.findIndex(t=>t.value===e);if(s>=0){return t.setContext(this.getContext(s)).lineWidth}return 0}drawGrid(e){const t=this.options.grid,s=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let o,r;const a=(e,t,i)=>{i.width&&i.color&&(s.save(),s.lineWidth=i.width,s.strokeStyle=i.color,s.setLineDash(i.borderDash||[]),s.lineDashOffset=i.borderDashOffset,s.beginPath(),s.moveTo(e.x,e.y),s.lineTo(t.x,t.y),s.stroke(),s.restore())};if(t.display)for(o=0,r=i.length;o<r;++o){const e=i[o];t.drawOnChartArea&&a({x:e.x1,y:e.y1},{x:e.x2,y:e.y2},e),t.drawTicks&&a({x:e.tx1,y:e.ty1},{x:e.tx2,y:e.ty2},{color:e.tickColor,width:e.tickWidth,borderDash:e.tickBorderDash,borderDashOffset:e.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{border:s,grid:i}}=this,o=s.setContext(this.getContext()),r=s.display?o.width:0;if(!r)return;const a=i.setContext(this.getContext(0)).lineWidth,n=this._borderValue;let l,c,d,h;this.isHorizontal()?(l=xi(e,this.left,r)-r/2,c=xi(e,this.right,a)+a/2,d=h=n):(d=xi(e,this.top,r)-r/2,h=xi(e,this.bottom,a)+a/2,l=c=n),t.save(),t.lineWidth=o.width,t.strokeStyle=o.color,t.beginPath(),t.moveTo(l,d),t.lineTo(c,h),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const t=this.ctx,s=this._computeLabelArea();s&&$i(t,s);const i=this.getLabelItems(e);for(const o of i){const e=o.options,s=o.font;Ti(t,o.label,0,o.textOffset,s,e)}s&&Di(t)}drawTitle(){const{ctx:e,options:{position:t,title:s,reverse:i}}=this;if(!s.display)return;const o=Vi(s.font),r=Ui(s.padding),a=s.align;let n=o.lineHeight/2;"bottom"===t||"center"===t||Xt(t)?(n+=r.bottom,Yt(s.text)&&(n+=o.lineHeight*(s.text.length-1))):n+=r.top;const{titleX:l,titleY:c,maxWidth:d,rotation:h}=function(e,t,s,i){const{top:o,left:r,bottom:a,right:n,chart:l}=e,{chartArea:c,scales:d}=l;let h,u,p,g=0;const m=a-o,f=n-r;if(e.isHorizontal()){if(u=Ys(i,r,n),Xt(s)){const e=Object.keys(s)[0],i=s[e];p=d[e].getPixelForValue(i)+m-t}else p="center"===s?(c.bottom+c.top)/2+m-t:oa(e,s,t);h=n-r}else{if(Xt(s)){const e=Object.keys(s)[0],i=s[e];u=d[e].getPixelForValue(i)-f+t}else u="center"===s?(c.left+c.right)/2-f+t:oa(e,s,t);p=Ys(i,a,o),g="left"===s?-ks:ks}return{titleX:u,titleY:p,maxWidth:h,rotation:g}}(this,n,t,a);Ti(e,s.text,0,0,o,{color:s.color,maxWidth:d,rotation:h,textAlign:da(a,t,i),textBaseline:"middle",translation:[l,c]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,s=ts(e.grid&&e.grid.z,-1),i=ts(e.border&&e.border.z,0);return this._isVisible()&&this.draw===ha.prototype.draw?[{z:s,draw:e=>{this.drawBackground(),this.drawGrid(e),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:t,draw:e=>{this.drawLabels(e)}}]:[{z:t,draw:e=>{this.draw(e)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),s=this.axis+"AxisID",i=[];let o,r;for(o=0,r=t.length;o<r;++o){const r=t[o];r[s]!==this.id||e&&r.type!==e||i.push(r)}return i}_resolveTickFontOptions(e){return Vi(this.options.ticks.setContext(this.getContext(e)).font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class ua{constructor(e,t,s){this.type=e,this.scope=t,this.override=s,this.items=/* @__PURE__ */Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let s;(function(e){return"id"in e&&"defaults"in e})(t)&&(s=this.register(t));const i=this.items,o=e.id,r=this.scope+"."+o;if(!o)throw new Error("class does not have id: "+e);return o in i||(i[o]=e,function(e,t,s){const i=cs(/* @__PURE__ */Object.create(null),[s?bi.get(s):{},bi.get(t),e.defaults]);bi.set(t,i),e.defaultRoutes&&function(e,t){Object.keys(t).forEach(s=>{const i=s.split("."),o=i.pop(),r=[e].concat(i).join("."),a=t[s].split("."),n=a.pop(),l=a.join(".");bi.route(r,o,l,n)})}(t,e.defaultRoutes);e.descriptors&&bi.describe(t,e.descriptors)}(e,r,s),this.override&&bi.override(e.id,e.overrides)),r}get(e){return this.items[e]}unregister(e){const t=this.items,s=e.id,i=this.scope;s in t&&delete t[s],i&&s in bi[i]&&(delete bi[i][s],this.override&&delete pi[s])}}class pa{constructor(){this.controllers=new ua(ir,"datasets",!0),this.elements=new ua(ta,"elements"),this.plugins=new ua(Object,"plugins"),this.scales=new ua(ha,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,s){[...t].forEach(t=>{const i=s||this._getRegistryForType(t);s||i.isForType(t)||i===this.plugins&&t.id?this._exec(e,i,t):os(t,t=>{const i=s||this._getRegistryForType(t);this._exec(e,i,t)})})}_exec(e,t,s){const i=gs(e);is(s["before"+i],[],s),t[e](s),is(s["after"+i],[],s)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const s=this._typedRegistries[t];if(s.isForType(e))return s}return this.plugins}_get(e,t,s){const i=t.get(e);if(void 0===i)throw new Error('"'+e+'" is not a registered '+s+".");return i}}var ga=/* @__PURE__ */new pa;class ma{constructor(){this._init=void 0}notify(e,t,s,i){if("beforeInit"===t&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install")),void 0===this._init)return;const o=i?this._descriptors(e).filter(i):this._descriptors(e),r=this._notify(o,e,t,s);return"afterDestroy"===t&&(this._notify(o,e,"stop"),this._notify(this._init,e,"uninstall"),this._init=void 0),r}_notify(e,t,s,i){i=i||{};for(const o of e){const e=o.plugin;if(!1===is(e[s],[t,i,o.options],e)&&i.cancelable)return!1}return!0}invalidate(){Jt(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const s=e&&e.config,i=ts(s.options&&s.options.plugins,{}),o=function(e){const t={},s=[],i=Object.keys(ga.plugins.items);for(let r=0;r<i.length;r++)s.push(ga.getPlugin(i[r]));const o=e.plugins||[];for(let r=0;r<o.length;r++){const e=o[r];-1===s.indexOf(e)&&(s.push(e),t[e.id]=!0)}return{plugins:s,localIds:t}}(s);return!1!==i||t?function(e,{plugins:t,localIds:s},i,o){const r=[],a=e.getContext();for(const n of t){const t=n.id,l=fa(i[t],o);null!==l&&r.push({plugin:n,options:va(e.config,{plugin:n,local:s[t]},l,a)})}return r}(e,o,i,t):[]}_notifyStateChanges(e){const t=this._oldCache||[],s=this._cache,i=(e,t)=>e.filter(e=>!t.some(t=>e.plugin.id===t.plugin.id));this._notify(i(t,s),e,"stop"),this._notify(i(s,t),e,"start")}}function fa(e,t){return t||!1!==e?!0===e?{}:e:null}function va(e,{plugin:t,local:s},i,o){const r=e.pluginScopeKeys(t),a=e.getOptionScopes(i,r);return s&&t.defaults&&a.push(t.defaults),e.createResolver(a,o,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function ba(e,t){const s=bi.datasets[e]||{};return((t.datasets||{})[e]||{}).indexAxis||t.indexAxis||s.indexAxis||"x"}function ya(e){if("x"===e||"y"===e||"r"===e)return e}function wa(e){return"top"===e||"bottom"===e?"x":"left"===e||"right"===e?"y":void 0}function xa(e,...t){if(ya(e))return e;for(const s of t){const t=s.axis||wa(s.position)||e.length>1&&ya(e[0].toLowerCase());if(t)return t}throw new Error(`Cannot determine type of '${e}' axis. Please provide 'axis' or 'position' option.`)}function _a(e,t,s){if(s[t+"AxisID"]===e)return{axis:t}}function ka(e,t){const s=pi[e.type]||{scales:{}},i=t.scales||{},o=ba(e.type,t),r=/* @__PURE__ */Object.create(null);return Object.keys(i).forEach(t=>{const a=i[t];if(!Xt(a))return console.error(`Invalid scale configuration for scale: ${t}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${t}`);const n=xa(t,a,function(e,t){if(t.data&&t.data.datasets){const s=t.data.datasets.filter(t=>t.xAxisID===e||t.yAxisID===e);if(s.length)return _a(e,"x",s[0])||_a(e,"y",s[0])}return{}}(t,e),bi.scales[a.type]),l=function(e,t){return e===t?"_index_":"_value_"}(n,o),c=s.scales||{};r[t]=ds(/* @__PURE__ */Object.create(null),[{axis:n},a,c[n],c[l]])}),e.data.datasets.forEach(s=>{const o=s.type||e.type,a=s.indexAxis||ba(o,t),n=(pi[o]||{}).scales||{};Object.keys(n).forEach(e=>{const t=function(e,t){let s=e;return"_index_"===e?s=t:"_value_"===e&&(s="x"===t?"y":"x"),s}(e,a),o=s[t+"AxisID"]||t;r[o]=r[o]||/* @__PURE__ */Object.create(null),ds(r[o],[{axis:t},i[o],n[e]])})}),Object.keys(r).forEach(e=>{const t=r[e];ds(t,[bi.scales[t.type],bi.scale])}),r}function Sa(e){const t=e.options||(e.options={});t.plugins=ts(t.plugins,{}),t.scales=ka(e,t)}function Ca(e){return(e=e||{}).datasets=e.datasets||[],e.labels=e.labels||[],e}const $a=/* @__PURE__ */new Map,Da=/* @__PURE__ */new Set;function Ea(e,t){let s=$a.get(e);return s||(s=t(),$a.set(e,s),Da.add(s)),s}const Ma=(e,t,s)=>{const i=ps(t,s);void 0!==i&&e.add(i)};class Aa{constructor(e){this._config=function(e){return(e=e||{}).data=Ca(e.data),Sa(e),e}(e),this._scopeCache=/* @__PURE__ */new Map,this._resolverCache=/* @__PURE__ */new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=Ca(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),Sa(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Ea(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return Ea(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return Ea(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){const t=e.id;return Ea(`${this.type}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const s=this._scopeCache;let i=s.get(e);return i&&!t||(i=/* @__PURE__ */new Map,s.set(e,i)),i}getOptionScopes(e,t,s){const{options:i,type:o}=this,r=this._cachedScopes(e,s),a=r.get(t);if(a)return a;const n=/* @__PURE__ */new Set;t.forEach(t=>{e&&(n.add(e),t.forEach(t=>Ma(n,e,t))),t.forEach(e=>Ma(n,i,e)),t.forEach(e=>Ma(n,pi[o]||{},e)),t.forEach(e=>Ma(n,bi,e)),t.forEach(e=>Ma(n,gi,e))});const l=Array.from(n);return 0===l.length&&l.push(/* @__PURE__ */Object.create(null)),Da.has(t)&&r.set(t,l),l}chartOptionScopes(){const{options:e,type:t}=this;return[e,pi[t]||{},bi.datasets[t]||{},{type:t},bi,gi]}resolveNamedOptions(e,t,s,i=[""]){const o={$shared:!0},{resolver:r,subPrefixes:a}=Ia(this._resolverCache,e,i);let n=r;if(function(e,t){const{isScriptable:s,isIndexable:i}=Ki(e);for(const o of t){const t=s(o),r=i(o),a=(r||t)&&e[o];if(t&&(fs(a)||Ta(a))||r&&Yt(a))return!0}return!1}(r,t)){o.$shared=!1;n=qi(r,s=fs(s)?s():s,this.createResolver(e,s,a))}for(const l of t)o[l]=n[l];return o}createResolver(e,t,s=[""],i){const{resolver:o}=Ia(this._resolverCache,e,s);return Xt(t)?qi(o,t,void 0,i):o}}function Ia(e,t,s){let i=e.get(t);i||(i=/* @__PURE__ */new Map,e.set(t,i));const o=s.join();let r=i.get(o);if(!r){r={resolver:Wi(t,s),subPrefixes:s.filter(e=>!e.toLowerCase().includes("hover"))},i.set(o,r)}return r}const Ta=e=>Xt(e)&&Object.getOwnPropertyNames(e).some(t=>fs(e[t]));const Pa=["top","bottom","left","right","chartArea"];function La(e,t){return"top"===e||"bottom"===e||-1===Pa.indexOf(e)&&"x"===t}function Ra(e,t){return function(s,i){return s[e]===i[e]?s[t]-i[t]:s[e]-i[e]}}function Oa(e){const t=e.chart,s=t.options.animation;t.notifyPlugins("afterRender"),is(s&&s.onComplete,[e],t)}function Na(e){const t=e.chart,s=t.options.animation;is(s&&s.onProgress,[e],t)}function Ba(e){return po()&&"string"==typeof e?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}const Fa={},za=e=>{const t=Ba(e);return Object.values(Fa).filter(e=>e.canvas===t).pop()};function Ua(e,t,s){const i=Object.keys(e);for(const o of i){const i=+o;if(i>=t){const r=e[o];delete e[o],(s>0||i>t)&&(e[i+s]=r)}}}class Va{static defaults=bi;static instances=Fa;static overrides=pi;static registry=ga;static version="4.5.1";static getChart=za;static register(...e){ga.add(...e),ja()}static unregister(...e){ga.remove(...e),ja()}constructor(e,t){const s=this.config=new Aa(t),i=Ba(e),o=za(i);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas with ID '"+o.canvas.id+"' can be reused.");const r=s.createResolver(s.chartOptionScopes(),this.getContext());this.platform=new(s.platform||function(e){return!po()||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas?Fr:ea}(i)),this.platform.updateConfig(s);const a=this.platform.acquireContext(i,r.aspectRatio),n=a&&a.canvas,l=n&&n.height,c=n&&n.width;this.id=Qt(),this.ctx=a,this.canvas=n,this.width=c,this.height=l,this._options=r,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new ma,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(e,t){let s;return function(...i){return t?(clearTimeout(s),s=setTimeout(e,t,i)):e.apply(this,i),t}}(e=>this.update(e),r.resizeDelay||0),this._dataChanges=[],Fa[this.id]=this,a&&n?(Uo.listen(this,"complete",Oa),Uo.listen(this,"progress",Na),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:s,height:i,_aspectRatio:o}=this;return Jt(e)?t&&o?o:i?s/i:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return ga}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():_o(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return _i(this.canvas,this.ctx),this}stop(){return Uo.stop(this),this}resize(e,t){Uo.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const s=this.options,i=this.canvas,o=s.maintainAspectRatio&&this.aspectRatio,r=this.platform.getMaximumSize(i,e,t,o),a=s.devicePixelRatio||this.platform.getDevicePixelRatio(),n=this.width?"resize":"attach";this.width=r.width,this.height=r.height,this._aspectRatio=this.aspectRatio,_o(this,a,!0)&&(this.notifyPlugins("resize",{size:r}),is(s.onResize,[this,r],this),this.attached&&this._doResize(n)&&this.render())}ensureScalesHaveIDs(){os(this.options.scales||{},(e,t)=>{e.id=t})}buildOrUpdateScales(){const e=this.options,t=e.scales,s=this.scales,i=Object.keys(s).reduce((e,t)=>(e[t]=!1,e),{});let o=[];t&&(o=o.concat(Object.keys(t).map(e=>{const s=t[e],i=xa(e,s),o="r"===i,r="x"===i;return{options:s,dposition:o?"chartArea":r?"bottom":"left",dtype:o?"radialLinear":r?"category":"linear"}}))),os(o,t=>{const o=t.options,r=o.id,a=xa(r,o),n=ts(o.type,t.dtype);void 0!==o.position&&La(o.position,a)===La(t.dposition)||(o.position=t.dposition),i[r]=!0;let l=null;if(r in s&&s[r].type===n)l=s[r];else{l=new(ga.getScale(n))({id:r,type:n,ctx:this.ctx,chart:this}),s[l.id]=l}l.init(o,e)}),os(i,(e,t)=>{e||delete s[t]}),os(s,e=>{Nr.configure(this,e,e.options),Nr.addBox(this,e)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,s=e.length;if(e.sort((e,t)=>e.index-t.index),s>t){for(let e=t;e<s;++e)this._destroyDatasetMeta(e);e.splice(t,s-t)}this._sortedMetasets=e.slice(0).sort(Ra("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((e,s)=>{0===t.filter(t=>t===e._dataset).length&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let s,i;for(this._removeUnreferencedMetasets(),s=0,i=t.length;s<i;s++){const i=t[s];let o=this.getDatasetMeta(s);const r=i.type||this.config.type;if(o.type&&o.type!==r&&(this._destroyDatasetMeta(s),o=this.getDatasetMeta(s)),o.type=r,o.indexAxis=i.indexAxis||ba(r,this.options),o.order=i.order||0,o.index=s,o.label=""+i.label,o.visible=this.isDatasetVisible(s),o.controller)o.controller.updateIndex(s),o.controller.linkScales();else{const t=ga.getController(r),{datasetElementType:i,dataElementType:a}=bi.datasets[r];Object.assign(t,{dataElementType:ga.getElement(a),datasetElementType:i&&ga.getElement(i)}),o.controller=new t(this,s),e.push(o.controller)}}return this._updateMetasets(),e}_resetElements(){os(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const s=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!s.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0}))return;const o=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let r=0;for(let l=0,c=this.data.datasets.length;l<c;l++){const{controller:e}=this.getDatasetMeta(l),t=!i&&-1===o.indexOf(e);e.buildOrUpdateElements(t),r=Math.max(+e.getMaxOverflow(),r)}r=this._minPadding=s.layout.autoPadding?r:0,this._updateLayout(r),i||os(o,e=>{e.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(Ra("z","_idx"));const{_active:a,_lastEvent:n}=this;n?this._eventHandler(n,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){os(this.scales,e=>{Nr.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),s=new Set(e.events);vs(t,s)&&!!this._responsiveListeners===e.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:s,start:i,count:o}of t){Ua(e,i,"_removeElements"===s?-o:o)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,s=t=>new Set(e.filter(e=>e[0]===t).map((e,t)=>t+","+e.splice(1).join(","))),i=s(0);for(let o=1;o<t;o++)if(!vs(i,s(o)))return;return Array.from(i).map(e=>e.split(",")).map(e=>({method:e[1],start:+e[2],count:+e[3]}))}_updateLayout(e){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;Nr.update(this,this.width,this.height,e);const t=this.chartArea,s=t.width<=0||t.height<=0;this._layers=[],os(this.boxes,e=>{s&&"chartArea"===e.position||(e.configure&&e.configure(),this._layers.push(...e._layers()))},this),this._layers.forEach((e,t)=>{e._idx=t}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})){for(let e=0,t=this.data.datasets.length;e<t;++e)this.getDatasetMeta(e).controller.configure();for(let t=0,s=this.data.datasets.length;t<s;++t)this._updateDataset(t,fs(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const s=this.getDatasetMeta(e),i={meta:s,index:e,mode:t,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",i)&&(s.controller._update(t),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(Uo.has(this)?this.attached&&!Uo.running(this)&&Uo.start(this):(this.draw(),Oa({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:e,height:t}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(e,t)}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,s=[];let i,o;for(i=0,o=t.length;i<o;++i){const o=t[i];e&&!o.visible||s.push(o)}return s}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,s={meta:e,index:e.index,cancelable:!0},i=Fo(this,e);!1!==this.notifyPlugins("beforeDatasetDraw",s)&&(i&&$i(t,i),e.controller.draw(),i&&Di(t),s.cancelable=!1,this.notifyPlugins("afterDatasetDraw",s))}isPointInArea(e){return Ci(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,s,i){const o=Sr.modes[t];return"function"==typeof o?o(this,e,s,i):[]}getDatasetMeta(e){const t=this.data.datasets[e],s=this._metasets;let i=s.filter(e=>e&&e._dataset===t).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},s.push(i)),i}getContext(){return this.$context||(this.$context=Hi(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const s=this.getDatasetMeta(e);return"boolean"==typeof s.hidden?!s.hidden:!t.hidden}setDatasetVisibility(e,t){this.getDatasetMeta(e).hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,s){const i=s?"show":"hide",o=this.getDatasetMeta(e),r=o.controller._resolveAnimations(void 0,i);ms(t)?(o.data[t].hidden=!s,this.update()):(this.setDatasetVisibility(e,s),r.update(o,{visible:s}),this.update(t=>t.datasetIndex===e?i:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),Uo.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),_i(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete Fa[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,s=(s,i)=>{t.addEventListener(this,s,i),e[s]=i},i=(e,t,s)=>{e.offsetX=t,e.offsetY=s,this._eventHandler(e)};os(this.options.events,e=>s(e,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,s=(s,i)=>{t.addEventListener(this,s,i),e[s]=i},i=(s,i)=>{e[s]&&(t.removeEventListener(this,s,i),delete e[s])},o=(e,t)=>{this.canvas&&this.resize(e,t)};let r;const a=()=>{i("attach",a),this.attached=!0,this.resize(),s("resize",o),s("detach",r)};r=()=>{this.attached=!1,i("resize",o),this._stop(),this._resize(0,0),s("attach",a)},t.isAttached(this.canvas)?a():r()}unbindEvents(){os(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},os(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,s){const i=s?"set":"remove";let o,r,a,n;for("dataset"===t&&(o=this.getDatasetMeta(e[0].datasetIndex),o.controller["_"+i+"DatasetHoverStyle"]()),a=0,n=e.length;a<n;++a){r=e[a];const t=r&&this.getDatasetMeta(r.datasetIndex).controller;t&&t[i+"HoverStyle"](r.element,r.datasetIndex,r.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],s=e.map(({datasetIndex:e,index:t})=>{const s=this.getDatasetMeta(e);if(!s)throw new Error("No dataset found at index "+e);return{datasetIndex:e,element:s.data[t],index:t}});!rs(s,t)&&(this._active=s,this._lastEvent=null,this._updateHoverStyles(s,t))}notifyPlugins(e,t,s){return this._plugins.notify(this,e,t,s)}isPluginEnabled(e){return 1===this._plugins._cache.filter(t=>t.plugin.id===e).length}_updateHoverStyles(e,t,s){const i=this.options.hover,o=(e,t)=>e.filter(e=>!t.some(t=>e.datasetIndex===t.datasetIndex&&e.index===t.index)),r=o(t,e),a=s?e:o(e,t);r.length&&this.updateHoverStyle(r,i.mode,!1),a.length&&i.mode&&this.updateHoverStyle(a,i.mode,!0)}_eventHandler(e,t){const s={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},i=t=>(t.options.events||this.options.events).includes(e.native.type);if(!1===this.notifyPlugins("beforeEvent",s,i))return;const o=this._handleEvent(e,t,s.inChartArea);return s.cancelable=!1,this.notifyPlugins("afterEvent",s,i),(o||s.changed)&&this.render(),this}_handleEvent(e,t,s){const{_active:i=[],options:o}=this,r=t,a=this._getActiveElements(e,i,s,r),n=function(e){return"mouseup"===e.type||"click"===e.type||"contextmenu"===e.type}(e),l=function(e,t,s,i){return s&&"mouseout"!==e.type?i?t:e:null}(e,this._lastEvent,s,n);s&&(this._lastEvent=null,is(o.onHover,[e,a,this],this),n&&is(o.onClick,[e,a,this],this));const c=!rs(a,i);return(c||t)&&(this._active=a,this._updateHoverStyles(a,i,t)),this._lastEvent=l,c}_getActiveElements(e,t,s,i){if("mouseout"===e.type)return[];if(!s)return t;const o=this.options.hover;return this.getElementsAtEventForMode(e,o.mode,o,i)}}function ja(){return os(Va.instances,e=>e._plugins.invalidate())}function Ha(e,t,s,i){const o=Bi(e.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]);const r=(s-t)/2,a=Math.min(r,i*t/2),n=e=>{const t=(s-Math.min(r,e))*i/2;return zs(e,0,Math.min(r,t))};return{outerStart:n(o.outerStart),outerEnd:n(o.outerEnd),innerStart:zs(o.innerStart,0,a),innerEnd:zs(o.innerEnd,0,a)}}function Wa(e,t,s,i){return{x:s+e*Math.cos(t),y:i+e*Math.sin(t)}}function qa(e,t,s,i,o,r){const{x:a,y:n,startAngle:l,pixelMargin:c,innerRadius:d}=t,h=Math.max(t.outerRadius+i+s-c,0),u=d>0?d+i+s+c:0;let p=0;const g=o-l;if(i){const e=((d>0?d-i:0)+(h>0?h-i:0))/2;p=(g-(0!==e?g*e/(e+i):g))/2}const m=(g-Math.max(.001,g*h-s/bs)/h)/2,f=l+m+p,v=o-m-p,{outerStart:b,outerEnd:y,innerStart:w,innerEnd:x}=Ha(t,u,h,v-f),_=h-b,k=h-y,S=f+b/_,C=v-y/k,$=u+w,D=u+x,E=f+w/$,M=v-x/D;if(e.beginPath(),r){const t=(S+C)/2;if(e.arc(a,n,h,S,t),e.arc(a,n,h,t,C),y>0){const t=Wa(k,C,a,n);e.arc(t.x,t.y,y,C,v+ks)}const s=Wa(D,v,a,n);if(e.lineTo(s.x,s.y),x>0){const t=Wa(D,M,a,n);e.arc(t.x,t.y,x,v+ks,M+Math.PI)}const i=(v-x/u+(f+w/u))/2;if(e.arc(a,n,u,v-x/u,i,!0),e.arc(a,n,u,i,f+w/u,!0),w>0){const t=Wa($,E,a,n);e.arc(t.x,t.y,w,E+Math.PI,f-ks)}const o=Wa(_,f,a,n);if(e.lineTo(o.x,o.y),b>0){const t=Wa(_,S,a,n);e.arc(t.x,t.y,b,f-ks,S)}}else{e.moveTo(a,n);const t=Math.cos(S)*h+a,s=Math.sin(S)*h+n;e.lineTo(t,s);const i=Math.cos(C)*h+a,o=Math.sin(C)*h+n;e.lineTo(i,o)}e.closePath()}function Ka(e,t,s,i,o){const{fullCircles:r,startAngle:a,circumference:n,options:l}=t,{borderWidth:c,borderJoinStyle:d,borderDash:h,borderDashOffset:u,borderRadius:p}=l,g="inner"===l.borderAlign;if(!c)return;e.setLineDash(h||[]),e.lineDashOffset=u,g?(e.lineWidth=2*c,e.lineJoin=d||"round"):(e.lineWidth=c,e.lineJoin=d||"bevel");let m=t.endAngle;if(r){qa(e,t,s,i,m,o);for(let t=0;t<r;++t)e.stroke();isNaN(n)||(m=a+(n%ys||ys))}g&&function(e,t,s){const{startAngle:i,pixelMargin:o,x:r,y:a,outerRadius:n,innerRadius:l}=t;let c=o/n;e.beginPath(),e.arc(r,a,n,i-c,s+c),l>o?(c=o/l,e.arc(r,a,l,s+c,i-c,!0)):e.arc(r,a,o,s+ks,i-ks),e.closePath(),e.clip()}(e,t,m),l.selfJoin&&m-a>=bs&&0===p&&"miter"!==d&&function(e,t,s){const{startAngle:i,x:o,y:r,outerRadius:a,innerRadius:n,options:l}=t,{borderWidth:c,borderJoinStyle:d}=l,h=Math.min(c/a,Bs(i-s));if(e.beginPath(),e.arc(o,r,a-c/2,i+h/2,s-h/2),n>0){const t=Math.min(c/n,Bs(i-s));e.arc(o,r,n+c/2,s-t/2,i+t/2,!0)}else{const t=Math.min(c/2,a*Bs(i-s));if("round"===d)e.arc(o,r,t,s-bs/2,i+bs/2,!0);else if("bevel"===d){const a=2*t*t,n=-a*Math.cos(s+bs/2)+o,l=-a*Math.sin(s+bs/2)+r,c=a*Math.cos(i+bs/2)+o,d=a*Math.sin(i+bs/2)+r;e.lineTo(n,l),e.lineTo(c,d)}}e.closePath(),e.moveTo(0,0),e.rect(0,0,e.canvas.width,e.canvas.height),e.clip("evenodd")}(e,t,m),r||(qa(e,t,s,i,m,o),e.stroke())}function Ga(e,t,s=t){e.lineCap=ts(s.borderCapStyle,t.borderCapStyle),e.setLineDash(ts(s.borderDash,t.borderDash)),e.lineDashOffset=ts(s.borderDashOffset,t.borderDashOffset),e.lineJoin=ts(s.borderJoinStyle,t.borderJoinStyle),e.lineWidth=ts(s.borderWidth,t.borderWidth),e.strokeStyle=ts(s.borderColor,t.borderColor)}function Qa(e,t,s){e.lineTo(s.x,s.y)}function Ja(e,t,s={}){const i=e.length,{start:o=0,end:r=i-1}=s,{start:a,end:n}=t,l=Math.max(o,a),c=Math.min(r,n),d=o<a&&r<a||o>n&&r>n;return{count:i,start:l,loop:t.loop,ilen:c<l&&!d?i+c-l:c-l}}function Ya(e,t,s,i){const{points:o,options:r}=t,{count:a,start:n,loop:l,ilen:c}=Ja(o,s,i),d=function(e){return e.stepped?Ei:e.tension||"monotone"===e.cubicInterpolationMode?Mi:Qa}(r);let h,u,p,{move:g=!0,reverse:m}=i||{};for(h=0;h<=c;++h)u=o[(n+(m?c-h:h))%a],u.skip||(g?(e.moveTo(u.x,u.y),g=!1):d(e,p,u,m,r.stepped),p=u);return l&&(u=o[(n+(m?c:0))%a],d(e,p,u,m,r.stepped)),!!l}function Xa(e,t,s,i){const o=t.points,{count:r,start:a,ilen:n}=Ja(o,s,i),{move:l=!0,reverse:c}=i||{};let d,h,u,p,g,m,f=0,v=0;const b=e=>(a+(c?n-e:e))%r,y=()=>{p!==g&&(e.lineTo(f,g),e.lineTo(f,p),e.lineTo(f,m))};for(l&&(h=o[b(0)],e.moveTo(h.x,h.y)),d=0;d<=n;++d){if(h=o[b(d)],h.skip)continue;const t=h.x,s=h.y,i=0|t;i===u?(s<p?p=s:s>g&&(g=s),f=(v*f+t)/++v):(y(),e.lineTo(t,s),u=i,v=0,p=g=s),m=s}y()}function Za(e){const t=e.options,s=t.borderDash&&t.borderDash.length;return!(e._decimated||e._loop||t.tension||"monotone"===t.cubicInterpolationMode||t.stepped||s)?Xa:Ya}const en="function"==typeof Path2D;function tn(e,t,s,i){en&&!t.options.segment?function(e,t,s,i){let o=t._path;o||(o=t._path=new Path2D,t.path(o,s,i)&&o.closePath()),Ga(e,t.options),e.stroke(o)}(e,t,s,i):function(e,t,s,i){const{segments:o,options:r}=t,a=Za(t);for(const n of o)Ga(e,r,n.style),e.beginPath(),a(e,t,n,{start:s,end:s+i-1})&&e.closePath(),e.stroke()}(e,t,s,i)}class sn extends ta{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:e=>"borderDash"!==e&&"fill"!==e};constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const s=this.options;if((s.tension||"monotone"===s.cubicInterpolationMode)&&!s.stepped&&!this._pointsUpdated){const i=s.spanGaps?this._loop:this._fullLoop;uo(this._points,s,e,i,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(e,t){const s=e.points,i=e.options.spanGaps,o=s.length;if(!o)return[];const r=!!e._loop,{start:a,end:n}=function(e,t,s,i){let o=0,r=t-1;if(s&&!i)for(;o<t&&!e[o].skip;)o++;for(;o<t&&e[o].skip;)o++;for(o%=t,s&&(r+=o);r>o&&e[r%t].skip;)r--;return r%=t,{start:o,end:r}}(s,o,r,i);return Ro(e,!0===i?[{start:a,end:n,loop:r}]:function(e,t,s,i){const o=e.length,r=[];let a,n=t,l=e[t];for(a=t+1;a<=s;++a){const s=e[a%o];s.skip||s.stop?l.skip||(i=!1,r.push({start:t%o,end:(a-1)%o,loop:i}),t=n=s.stop?a:null):(n=a,l.skip&&(t=a)),l=s}return null!==n&&r.push({start:t%o,end:n%o,loop:i}),r}(s,a,n<a?n+o:n,!!e._fullLoop&&0===a&&n===o-1),s,t)}(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,s=e.length;return s&&t[e[s-1].end]}interpolate(e,t){const s=this.options,i=e[t],o=this.points,r=Lo(this,{property:t,start:i,end:i});if(!r.length)return;const a=[],n=function(e){return e.stepped?$o:e.tension||"monotone"===e.cubicInterpolationMode?Do:Co}(s);let l,c;for(l=0,c=r.length;l<c;++l){const{start:c,end:d}=r[l],h=o[c],u=o[d];if(h===u){a.push(h);continue}const p=n(h,u,Math.abs((i-h[t])/(u[t]-h[t])),s.stepped);p[t]=e[t],a.push(p)}return 1===a.length?a[0]:a}pathSegment(e,t,s){return Za(this)(e,this,t,s)}path(e,t,s){const i=this.segments,o=Za(this);let r=this._loop;t=t||0,s=s||this.points.length-t;for(const a of i)r&=o(e,this,a,{start:t,end:t+s-1});return!!r}draw(e,t,s,i){const o=this.options||{};(this.points||[]).length&&o.borderWidth&&(e.save(),tn(e,this,s,i),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function on(e,t,s,i){const o=e.options,{[s]:r}=e.getProps([s],i);return Math.abs(t-r)<o.radius+o.hitRadius}function rn(e,t){const{x:s,y:i,base:o,width:r,height:a}=e.getProps(["x","y","base","width","height"],t);let n,l,c,d,h;return e.horizontal?(h=a/2,n=Math.min(s,o),l=Math.max(s,o),c=i-h,d=i+h):(h=r/2,n=s-h,l=s+h,c=Math.min(i,o),d=Math.max(i,o)),{left:n,top:c,right:l,bottom:d}}function an(e,t,s,i){return e?0:zs(t,s,i)}function nn(e){const t=rn(e),s=t.right-t.left,i=t.bottom-t.top,o=function(e,t,s){const i=e.options.borderWidth,o=e.borderSkipped,r=Fi(i);return{t:an(o.top,r.top,0,s),r:an(o.right,r.right,0,t),b:an(o.bottom,r.bottom,0,s),l:an(o.left,r.left,0,t)}}(e,s/2,i/2),r=function(e,t,s){const{enableBorderRadius:i}=e.getProps(["enableBorderRadius"]),o=e.options.borderRadius,r=zi(o),a=Math.min(t,s),n=e.borderSkipped,l=i||Xt(o);return{topLeft:an(!l||n.top||n.left,r.topLeft,0,a),topRight:an(!l||n.top||n.right,r.topRight,0,a),bottomLeft:an(!l||n.bottom||n.left,r.bottomLeft,0,a),bottomRight:an(!l||n.bottom||n.right,r.bottomRight,0,a)}}(e,s/2,i/2);return{outer:{x:t.left,y:t.top,w:s,h:i,radius:r},inner:{x:t.left+o.l,y:t.top+o.t,w:s-o.l-o.r,h:i-o.t-o.b,radius:{topLeft:Math.max(0,r.topLeft-Math.max(o.t,o.l)),topRight:Math.max(0,r.topRight-Math.max(o.t,o.r)),bottomLeft:Math.max(0,r.bottomLeft-Math.max(o.b,o.l)),bottomRight:Math.max(0,r.bottomRight-Math.max(o.b,o.r))}}}}function ln(e,t,s,i){const o=null===t,r=null===s,a=e&&!(o&&r)&&rn(e,i);return a&&(o||Us(t,a.left,a.right))&&(r||Us(s,a.top,a.bottom))}function cn(e,t){e.rect(t.x,t.y,t.w,t.h)}function dn(e,t,s={}){const i=e.x!==s.x?-t:0,o=e.y!==s.y?-t:0,r=(e.x+e.w!==s.x+s.w?t:0)-i,a=(e.y+e.h!==s.y+s.h?t:0)-o;return{x:e.x+i,y:e.y+o,w:e.w+r,h:e.h+a,radius:e.radius}}var hn=/* @__PURE__ */Object.freeze({__proto__:null,ArcElement:class extends ta{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:e=>"borderDash"!==e};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(e){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,t,s){const i=this.getProps(["x","y"],s),{angle:o,distance:r}=Rs(i,{x:e,y:t}),{startAngle:a,endAngle:n,innerRadius:l,outerRadius:c,circumference:d}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],s),h=(this.options.spacing+this.options.borderWidth)/2,u=ts(d,n-a),p=Fs(o,a,n)&&a!==n,g=u>=ys||p,m=Us(r,l+h,c+h);return g&&m}getCenterPoint(e){const{x:t,y:s,startAngle:i,endAngle:o,innerRadius:r,outerRadius:a}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:n,spacing:l}=this.options,c=(i+o)/2,d=(r+a+l+n)/2;return{x:t+Math.cos(c)*d,y:s+Math.sin(c)*d}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:t,circumference:s}=this,i=(t.offset||0)/4,o=(t.spacing||0)/2,r=t.circular;if(this.pixelMargin="inner"===t.borderAlign?.33:0,this.fullCircles=s>ys?Math.floor(s/ys):0,0===s||this.innerRadius<0||this.outerRadius<0)return;e.save();const a=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(a)*i,Math.sin(a)*i);const n=i*(1-Math.sin(Math.min(bs,s||0)));e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor,function(e,t,s,i,o){const{fullCircles:r,startAngle:a,circumference:n}=t;let l=t.endAngle;if(r){qa(e,t,s,i,l,o);for(let t=0;t<r;++t)e.fill();isNaN(n)||(l=a+(n%ys||ys))}qa(e,t,s,i,l,o),e.fill()}(e,this,n,o,r),Ka(e,this,n,o,r),e.restore()}},BarElement:class extends ta{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:s,backgroundColor:i}}=this,{inner:o,outer:r}=nn(this),a=(n=r.radius).topLeft||n.topRight||n.bottomLeft||n.bottomRight?Pi:cn;var n;e.save(),r.w===o.w&&r.h===o.h||(e.beginPath(),a(e,dn(r,t,o)),e.clip(),a(e,dn(o,-t,r)),e.fillStyle=s,e.fill("evenodd")),e.beginPath(),a(e,dn(o,t)),e.fillStyle=i,e.fill(),e.restore()}inRange(e,t,s){return ln(this,e,t,s)}inXRange(e,t){return ln(this,e,null,t)}inYRange(e,t){return ln(this,null,e,t)}getCenterPoint(e){const{x:t,y:s,base:i,horizontal:o}=this.getProps(["x","y","base","horizontal"],e);return{x:o?(t+i)/2:t,y:o?s:(s+i)/2}}getRange(e){return"x"===e?this.width/2:this.height/2}},LineElement:sn,PointElement:class extends ta{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,t,s){const i=this.options,{x:o,y:r}=this.getProps(["x","y"],s);return Math.pow(e-o,2)+Math.pow(t-r,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(e,t){return on(this,e,"x",t)}inYRange(e,t){return on(this,e,"y",t)}getCenterPoint(e){const{x:t,y:s}=this.getProps(["x","y"],e);return{x:t,y:s}}size(e){let t=(e=e||this.options||{}).radius||0;t=Math.max(t,t&&e.hoverRadius||0);return 2*(t+(t&&e.borderWidth||0))}draw(e,t){const s=this.options;this.skip||s.radius<.1||!Ci(this,t,this.size(s)/2)||(e.strokeStyle=s.borderColor,e.lineWidth=s.borderWidth,e.fillStyle=s.backgroundColor,ki(e,s,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}});const un=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],pn=/* @__PURE__ */un.map(e=>e.replace("rgb(","rgba(").replace(")",", 0.5)"));function gn(e){return un[e%un.length]}function mn(e){return pn[e%pn.length]}function fn(e){let t=0;return(s,i)=>{const o=e.getDatasetMeta(i).controller;o instanceof ur?t=function(e,t){return e.backgroundColor=e.data.map(()=>gn(t++)),t}(s,t):o instanceof pr?t=function(e,t){return e.backgroundColor=e.data.map(()=>mn(t++)),t}(s,t):o&&(t=function(e,t){return e.borderColor=gn(t),e.backgroundColor=mn(t),++t}(s,t))}}function vn(e){let t;for(t in e)if(e[t].borderColor||e[t].backgroundColor)return!0;return!1}var bn={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(e,t,s){if(!s.enabled)return;const{data:{datasets:i},options:o}=e.config,{elements:r}=o,a=vn(i)||(n=o)&&(n.borderColor||n.backgroundColor)||r&&vn(r)||"rgba(0,0,0,0.1)"!==bi.borderColor||"rgba(0,0,0,0.1)"!==bi.backgroundColor;var n;if(!s.forceOverride&&a)return;const l=fn(e);i.forEach(l)}};function yn(e){if(e._decimated){const t=e._data;delete e._decimated,delete e._data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function wn(e){e.data.datasets.forEach(e=>{yn(e)})}var xn={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(e,t,s)=>{if(!s.enabled)return void wn(e);const i=e.width;e.data.datasets.forEach((t,o)=>{const{_data:r,indexAxis:a}=t,n=e.getDatasetMeta(o),l=r||t.data;if("y"===ji([a,e.options.indexAxis]))return;if(!n.controller.supportsDecimation)return;const c=e.scales[n.xAxisID];if("linear"!==c.type&&"time"!==c.type)return;if(e.options.parsing)return;let{start:d,count:h}=function(e,t){const s=t.length;let i,o=0;const{iScale:r}=e,{min:a,max:n,minDefined:l,maxDefined:c}=r.getUserBounds();return l&&(o=zs(js(t,r.axis,a).lo,0,s-1)),i=c?zs(js(t,r.axis,n).hi+1,o,s)-o:s-o,{start:o,count:i}}(n,l);if(h<=(s.threshold||4*i))return void yn(t);let u;switch(Jt(r)&&(t._data=l,delete t.data,Object.defineProperty(t,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(e){this._data=e}})),s.algorithm){case"lttb":u=function(e,t,s,i,o){const r=o.samples||i;if(r>=s)return e.slice(t,t+s);const a=[],n=(s-2)/(r-2);let l=0;const c=t+s-1;let d,h,u,p,g,m=t;for(a[l++]=e[m],d=0;d<r-2;d++){let i,o=0,r=0;const c=Math.floor((d+1)*n)+1+t,f=Math.min(Math.floor((d+2)*n)+1,s)+t,v=f-c;for(i=c;i<f;i++)o+=e[i].x,r+=e[i].y;o/=v,r/=v;const b=Math.floor(d*n)+1+t,y=Math.min(Math.floor((d+1)*n)+1,s)+t,{x:w,y:x}=e[m];for(u=p=-1,i=b;i<y;i++)p=.5*Math.abs((w-o)*(e[i].y-x)-(w-e[i].x)*(r-x)),p>u&&(u=p,h=e[i],g=i);a[l++]=h,m=g}return a[l++]=e[c],a}(l,d,h,i,s);break;case"min-max":u=function(e,t,s,i){let o,r,a,n,l,c,d,h,u,p,g=0,m=0;const f=[],v=t+s-1,b=e[t].x,y=e[v].x-b;for(o=t;o<t+s;++o){r=e[o],a=(r.x-b)/y*i,n=r.y;const t=0|a;if(t===l)n<u?(u=n,c=o):n>p&&(p=n,d=o),g=(m*g+r.x)/++m;else{const s=o-1;if(!Jt(c)&&!Jt(d)){const t=Math.min(c,d),i=Math.max(c,d);t!==h&&t!==s&&f.push({...e[t],x:g}),i!==h&&i!==s&&f.push({...e[i],x:g})}o>0&&s!==h&&f.push(e[s]),f.push(r),l=t,m=0,u=p=n,c=d=h=o}}return f}(l,d,h,i);break;default:throw new Error(`Unsupported decimation algorithm '${s.algorithm}'`)}t._decimated=u})},destroy(e){wn(e)}};function _n(e,t,s,i){if(i)return;let o=t[e],r=s[e];return"angle"===e&&(o=Bs(o),r=Bs(r)),{property:e,start:o,end:r}}function kn(e,t,s){for(;t>e;t--){const e=s[t];if(!isNaN(e.x)&&!isNaN(e.y))break}return t}function Sn(e,t,s,i){return e&&t?i(e[s],t[s]):e?e[s]:t?t[s]:0}function Cn(e,t){let s=[],i=!1;return Yt(e)?(i=!0,s=e):s=function(e,t){const{x:s=null,y:i=null}=e||{},o=t.points,r=[];return t.segments.forEach(({start:e,end:t})=>{t=kn(e,t,o);const a=o[e],n=o[t];null!==i?(r.push({x:a.x,y:i}),r.push({x:n.x,y:i})):null!==s&&(r.push({x:s,y:a.y}),r.push({x:s,y:n.y}))}),r}(e,t),s.length?new sn({points:s,options:{tension:0},_loop:i,_fullLoop:i}):null}function $n(e){return e&&!1!==e.fill}function Dn(e,t,s){let i=e[t].fill;const o=[t];let r;if(!s)return i;for(;!1!==i&&-1===o.indexOf(i);){if(!Zt(i))return i;if(r=e[i],!r)return!1;if(r.visible)return i;o.push(i),i=r.fill}return!1}function En(e,t,s){const i=function(e){const t=e.options,s=t.fill;let i=ts(s&&s.target,s);void 0===i&&(i=!!t.backgroundColor);if(!1===i||null===i)return!1;if(!0===i)return"origin";return i}(e);if(Xt(i))return!isNaN(i.value)&&i;let o=parseFloat(i);return Zt(o)&&Math.floor(o)===o?function(e,t,s,i){"-"!==e&&"+"!==e||(s=t+s);if(s===t||s<0||s>=i)return!1;return s}(i[0],t,o,s):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function Mn(e,t,s){const i=[];for(let o=0;o<s.length;o++){const r=s[o],{first:a,last:n,point:l}=An(r,t,"x");if(!(!l||a&&n))if(a)i.unshift(l);else if(e.push(l),!n)break}e.push(...i)}function An(e,t,s){const i=e.interpolate(t,s);if(!i)return{};const o=i[s],r=e.segments,a=e.points;let n=!1,l=!1;for(let c=0;c<r.length;c++){const e=r[c],t=a[e.start][s],i=a[e.end][s];if(Us(o,t,i)){n=o===t,l=o===i;break}}return{first:n,last:l,point:i}}class In{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,s){const{x:i,y:o,radius:r}=this;return t=t||{start:0,end:ys},e.arc(i,o,r,t.end,t.start,!0),!s.bounds}interpolate(e){const{x:t,y:s,radius:i}=this,o=e.angle;return{x:t+Math.cos(o)*i,y:s+Math.sin(o)*i,angle:o}}}function Tn(e){const{chart:t,fill:s,line:i}=e;if(Zt(s))return function(e,t){const s=e.getDatasetMeta(t),i=s&&e.isDatasetVisible(t);return i?s.dataset:null}(t,s);if("stack"===s)return function(e){const{scale:t,index:s,line:i}=e,o=[],r=i.segments,a=i.points,n=function(e,t){const s=[],i=e.getMatchingVisibleMetas("line");for(let o=0;o<i.length;o++){const e=i[o];if(e.index===t)break;e.hidden||s.unshift(e.dataset)}return s}(t,s);n.push(Cn({x:null,y:t.bottom},i));for(let l=0;l<r.length;l++){const e=r[l];for(let t=e.start;t<=e.end;t++)Mn(o,a[t],n)}return new sn({points:o,options:{}})}(e);if("shape"===s)return!0;const o=function(e){const t=e.scale||{};if(t.getPointPositionForValue)return function(e){const{scale:t,fill:s}=e,i=t.options,o=t.getLabels().length,r=i.reverse?t.max:t.min,a=function(e,t,s){let i;return i="start"===e?s:"end"===e?t.options.reverse?t.min:t.max:Xt(e)?e.value:t.getBaseValue(),i}(s,t,r),n=[];if(i.grid.circular){const e=t.getPointPositionForValue(0,r);return new In({x:e.x,y:e.y,radius:t.getDistanceFromCenterForValue(a)})}for(let l=0;l<o;++l)n.push(t.getPointPositionForValue(l,a));return n}(e);return function(e){const{scale:t={},fill:s}=e,i=function(e,t){let s=null;return"start"===e?s=t.bottom:"end"===e?s=t.top:Xt(e)?s=t.getPixelForValue(e.value):t.getBasePixel&&(s=t.getBasePixel()),s}(s,t);if(Zt(i)){const e=t.isHorizontal();return{x:e?i:null,y:e?null:i}}return null}(e)}(e);return o instanceof In?o:Cn(o,i)}function Pn(e,t,s){const i=Tn(t),{chart:o,index:r,line:a,scale:n,axis:l}=t,c=a.options,d=c.fill,h=c.backgroundColor,{above:u=h,below:p=h}=d||{},g=o.getDatasetMeta(r),m=Fo(o,g);i&&a.points.length&&($i(e,s),function(e,t){const{line:s,target:i,above:o,below:r,area:a,scale:n,clip:l}=t,c=s._loop?"angle":t.axis;e.save();let d=r;r!==o&&("x"===c?(Ln(e,i,a.top),On(e,{line:s,target:i,color:o,scale:n,property:c,clip:l}),e.restore(),e.save(),Ln(e,i,a.bottom)):"y"===c&&(Rn(e,i,a.left),On(e,{line:s,target:i,color:r,scale:n,property:c,clip:l}),e.restore(),e.save(),Rn(e,i,a.right),d=o));On(e,{line:s,target:i,color:d,scale:n,property:c,clip:l}),e.restore()}(e,{line:a,target:i,above:u,below:p,area:s,scale:n,axis:l,clip:m}),Di(e))}function Ln(e,t,s){const{segments:i,points:o}=t;let r=!0,a=!1;e.beginPath();for(const n of i){const{start:i,end:l}=n,c=o[i],d=o[kn(i,l,o)];r?(e.moveTo(c.x,c.y),r=!1):(e.lineTo(c.x,s),e.lineTo(c.x,c.y)),a=!!t.pathSegment(e,n,{move:a}),a?e.closePath():e.lineTo(d.x,s)}e.lineTo(t.first().x,s),e.closePath(),e.clip()}function Rn(e,t,s){const{segments:i,points:o}=t;let r=!0,a=!1;e.beginPath();for(const n of i){const{start:i,end:l}=n,c=o[i],d=o[kn(i,l,o)];r?(e.moveTo(c.x,c.y),r=!1):(e.lineTo(s,c.y),e.lineTo(c.x,c.y)),a=!!t.pathSegment(e,n,{move:a}),a?e.closePath():e.lineTo(s,d.y)}e.lineTo(s,t.first().y),e.closePath(),e.clip()}function On(e,t){const{line:s,target:i,property:o,color:r,scale:a,clip:n}=t,l=function(e,t,s){const i=e.segments,o=e.points,r=t.points,a=[];for(const n of i){let{start:e,end:i}=n;i=kn(e,i,o);const l=_n(s,o[e],o[i],n.loop);if(!t.segments){a.push({source:n,target:l,start:o[e],end:o[i]});continue}const c=Lo(t,l);for(const t of c){const e=_n(s,r[t.start],r[t.end],t.loop),i=Po(n,o,e);for(const o of i)a.push({source:o,target:t,start:{[s]:Sn(l,e,"start",Math.max)},end:{[s]:Sn(l,e,"end",Math.min)}})}}return a}(s,i,o);for(const{source:c,target:d,start:h,end:u}of l){const{style:{backgroundColor:t=r}={}}=c,l=!0!==i;e.save(),e.fillStyle=t,Nn(e,a,n,l&&_n(o,h,u)),e.beginPath();const p=!!s.pathSegment(e,c);let g;if(l){p?e.closePath():Bn(e,i,u,o);const t=!!i.pathSegment(e,d,{move:p,reverse:!0});g=p&&t,g||Bn(e,i,h,o)}e.closePath(),e.fill(g?"evenodd":"nonzero"),e.restore()}}function Nn(e,t,s,i){const o=t.chart.chartArea,{property:r,start:a,end:n}=i||{};if("x"===r||"y"===r){let t,i,l,c;"x"===r?(t=a,i=o.top,l=n,c=o.bottom):(t=o.left,i=a,l=o.right,c=n),e.beginPath(),s&&(t=Math.max(t,s.left),l=Math.min(l,s.right),i=Math.max(i,s.top),c=Math.min(c,s.bottom)),e.rect(t,i,l-t,c-i),e.clip()}}function Bn(e,t,s,i){const o=t.interpolate(s,i);o&&e.lineTo(o.x,o.y)}var Fn={id:"filler",afterDatasetsUpdate(e,t,s){const i=(e.data.datasets||[]).length,o=[];let r,a,n,l;for(a=0;a<i;++a)r=e.getDatasetMeta(a),n=r.dataset,l=null,n&&n.options&&n instanceof sn&&(l={visible:e.isDatasetVisible(a),index:a,fill:En(n,a,i),chart:e,axis:r.controller.options.indexAxis,scale:r.vScale,line:n}),r.$filler=l,o.push(l);for(a=0;a<i;++a)l=o[a],l&&!1!==l.fill&&(l.fill=Dn(o,a,s.propagate))},beforeDraw(e,t,s){const i="beforeDraw"===s.drawTime,o=e.getSortedVisibleDatasetMetas(),r=e.chartArea;for(let a=o.length-1;a>=0;--a){const t=o[a].$filler;t&&(t.line.updateControlPoints(r,t.axis),i&&t.fill&&Pn(e.ctx,t,r))}},beforeDatasetsDraw(e,t,s){if("beforeDatasetsDraw"!==s.drawTime)return;const i=e.getSortedVisibleDatasetMetas();for(let o=i.length-1;o>=0;--o){const t=i[o].$filler;$n(t)&&Pn(e.ctx,t,e.chartArea)}},beforeDatasetDraw(e,t,s){const i=t.meta.$filler;$n(i)&&"beforeDatasetDraw"===s.drawTime&&Pn(e.ctx,i,e.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const zn=(e,t)=>{let{boxHeight:s=t,boxWidth:i=t}=e;return e.usePointStyle&&(s=Math.min(s,t),i=e.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:s,itemHeight:Math.max(t,s)}};class Un extends ta{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,s){this.maxWidth=e,this.maxHeight=t,this._margins=s,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=is(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(t=>e.filter(t,this.chart.data))),e.sort&&(t=t.sort((t,s)=>e.sort(t,s,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display)return void(this.width=this.height=0);const s=e.labels,i=Vi(s.font),o=i.size,r=this._computeTitleHeight(),{boxWidth:a,itemHeight:n}=zn(s,o);let l,c;t.font=i.string,this.isHorizontal()?(l=this.maxWidth,c=this._fitRows(r,o,a,n)+10):(c=this.maxHeight,l=this._fitCols(r,i,a,n)+10),this.width=Math.min(l,e.maxWidth||this.maxWidth),this.height=Math.min(c,e.maxHeight||this.maxHeight)}_fitRows(e,t,s,i){const{ctx:o,maxWidth:r,options:{labels:{padding:a}}}=this,n=this.legendHitBoxes=[],l=this.lineWidths=[0],c=i+a;let d=e;o.textAlign="left",o.textBaseline="middle";let h=-1,u=-c;return this.legendItems.forEach((e,p)=>{const g=s+t/2+o.measureText(e.text).width;(0===p||l[l.length-1]+g+2*a>r)&&(d+=c,l[l.length-(p>0?0:1)]=0,u+=c,h++),n[p]={left:0,top:u,row:h,width:g,height:i},l[l.length-1]+=g+a}),d}_fitCols(e,t,s,i){const{ctx:o,maxHeight:r,options:{labels:{padding:a}}}=this,n=this.legendHitBoxes=[],l=this.columnSizes=[],c=r-e;let d=a,h=0,u=0,p=0,g=0;return this.legendItems.forEach((e,r)=>{const{itemWidth:m,itemHeight:f}=function(e,t,s,i,o){const r=function(e,t,s,i){let o=e.text;o&&"string"!=typeof o&&(o=o.reduce((e,t)=>e.length>t.length?e:t));return t+s.size/2+i.measureText(o).width}(i,e,t,s),a=function(e,t,s){let i=e;"string"!=typeof t.text&&(i=Vn(t,s));return i}(o,i,t.lineHeight);return{itemWidth:r,itemHeight:a}}(s,t,o,e,i);r>0&&u+f+2*a>c&&(d+=h+a,l.push({width:h,height:u}),p+=h+a,g++,h=u=0),n[r]={left:p,top:u,col:g,width:m,height:f},h=Math.max(h,m),u+=f+a}),d+=h,l.push({width:h,height:u}),d}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:s,labels:{padding:i},rtl:o}}=this,r=Eo(o,this.left,this.width);if(this.isHorizontal()){let o=0,a=Ys(s,this.left+i,this.right-this.lineWidths[o]);for(const n of t)o!==n.row&&(o=n.row,a=Ys(s,this.left+i,this.right-this.lineWidths[o])),n.top+=this.top+e+i,n.left=r.leftForLtr(r.x(a),n.width),a+=n.width+i}else{let o=0,a=Ys(s,this.top+e+i,this.bottom-this.columnSizes[o].height);for(const n of t)n.col!==o&&(o=n.col,a=Ys(s,this.top+e+i,this.bottom-this.columnSizes[o].height)),n.top=a,n.left+=this.left+i,n.left=r.leftForLtr(r.x(n.left),n.width),a+=n.height+i}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const e=this.ctx;$i(e,this),this._draw(),Di(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:s,ctx:i}=this,{align:o,labels:r}=e,a=bi.color,n=Eo(e.rtl,this.left,this.width),l=Vi(r.font),{padding:c}=r,d=l.size,h=d/2;let u;this.drawTitle(),i.textAlign=n.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=l.string;const{boxWidth:p,boxHeight:g,itemHeight:m}=zn(r,d),f=this.isHorizontal(),v=this._computeTitleHeight();u=f?{x:Ys(o,this.left+c,this.right-s[0]),y:this.top+c+v,line:0}:{x:this.left+c,y:Ys(o,this.top+v+c,this.bottom-t[0].height),line:0},Mo(this.ctx,e.textDirection);const b=m+c;this.legendItems.forEach((y,w)=>{i.strokeStyle=y.fontColor,i.fillStyle=y.fontColor;const x=i.measureText(y.text).width,_=n.textAlign(y.textAlign||(y.textAlign=r.textAlign)),k=p+h+x;let S=u.x,C=u.y;n.setWidth(this.width),f?w>0&&S+k+c>this.right&&(C=u.y+=b,u.line++,S=u.x=Ys(o,this.left+c,this.right-s[u.line])):w>0&&C+b>this.bottom&&(S=u.x=S+t[u.line].width+c,u.line++,C=u.y=Ys(o,this.top+v+c,this.bottom-t[u.line].height));if(function(e,t,s){if(isNaN(p)||p<=0||isNaN(g)||g<0)return;i.save();const o=ts(s.lineWidth,1);if(i.fillStyle=ts(s.fillStyle,a),i.lineCap=ts(s.lineCap,"butt"),i.lineDashOffset=ts(s.lineDashOffset,0),i.lineJoin=ts(s.lineJoin,"miter"),i.lineWidth=o,i.strokeStyle=ts(s.strokeStyle,a),i.setLineDash(ts(s.lineDash,[])),r.usePointStyle){const a={radius:g*Math.SQRT2/2,pointStyle:s.pointStyle,rotation:s.rotation,borderWidth:o},l=n.xPlus(e,p/2);Si(i,a,l,t+h,r.pointStyleWidth&&p)}else{const r=t+Math.max((d-g)/2,0),a=n.leftForLtr(e,p),l=zi(s.borderRadius);i.beginPath(),Object.values(l).some(e=>0!==e)?Pi(i,{x:a,y:r,w:p,h:g,radius:l}):i.rect(a,r,p,g),i.fill(),0!==o&&i.stroke()}i.restore()}(n.x(S),C,y),S=((e,t,s,i)=>e===(i?"left":"right")?s:"center"===e?(t+s)/2:t)(_,S+p+h,f?S+k:this.right,e.rtl),function(e,t,s){Ti(i,s.text,e,t+m/2,l,{strikethrough:s.hidden,textAlign:n.textAlign(s.textAlign)})}(n.x(S),C,y),f)u.x+=k+c;else if("string"!=typeof y.text){const e=l.lineHeight;u.y+=Vn(y,e)+c}else u.y+=b}),Ao(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,s=Vi(t.font),i=Ui(t.padding);if(!t.display)return;const o=Eo(e.rtl,this.left,this.width),r=this.ctx,a=t.position,n=s.size/2,l=i.top+n;let c,d=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),c=this.top+l,d=Ys(e.align,d,this.right-h);else{const t=this.columnSizes.reduce((e,t)=>Math.max(e,t.height),0);c=l+Ys(e.align,this.top,this.bottom-t-e.labels.padding-this._computeTitleHeight())}const u=Ys(a,d,d+h);r.textAlign=o.textAlign(Js(a)),r.textBaseline="middle",r.strokeStyle=t.color,r.fillStyle=t.color,r.font=s.string,Ti(r,t.text,u,c,s)}_computeTitleHeight(){const e=this.options.title,t=Vi(e.font),s=Ui(e.padding);return e.display?t.lineHeight+s.height:0}_getLegendItemAt(e,t){let s,i,o;if(Us(e,this.left,this.right)&&Us(t,this.top,this.bottom))for(o=this.legendHitBoxes,s=0;s<o.length;++s)if(i=o[s],Us(e,i.left,i.left+i.width)&&Us(t,i.top,i.top+i.height))return this.legendItems[s];return null}handleEvent(e){const t=this.options;if(!function(e,t){if(("mousemove"===e||"mouseout"===e)&&(t.onHover||t.onLeave))return!0;if(t.onClick&&("click"===e||"mouseup"===e))return!0;return!1}(e.type,t))return;const s=this._getLegendItemAt(e.x,e.y);if("mousemove"===e.type||"mouseout"===e.type){const r=this._hoveredItem,a=(o=s,null!==(i=r)&&null!==o&&i.datasetIndex===o.datasetIndex&&i.index===o.index);r&&!a&&is(t.onLeave,[e,r,this],this),this._hoveredItem=s,s&&!a&&is(t.onHover,[e,s,this],this)}else s&&is(t.onClick,[e,s,this],this);var i,o}}function Vn(e,t){return t*(e.text?e.text.length:0)}var jn={id:"legend",_element:Un,start(e,t,s){const i=e.legend=new Un({ctx:e.ctx,options:s,chart:e});Nr.configure(e,i,s),Nr.addBox(e,i)},stop(e){Nr.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,t,s){const i=e.legend;Nr.configure(e,i,s),i.options=s},afterUpdate(e){const t=e.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(e,t){t.replay||e.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,t,s){const i=t.datasetIndex,o=s.chart;o.isDatasetVisible(i)?(o.hide(i),t.hidden=!0):(o.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){const t=e.data.datasets,{labels:{usePointStyle:s,pointStyle:i,textAlign:o,color:r,useBorderRadius:a,borderRadius:n}}=e.legend.options;return e._getSortedDatasetMetas().map(e=>{const l=e.controller.getStyle(s?0:void 0),c=Ui(l.borderWidth);return{text:t[e.index].label,fillStyle:l.backgroundColor,fontColor:r,hidden:!e.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(c.width+c.height)/4,strokeStyle:l.borderColor,pointStyle:i||l.pointStyle,rotation:l.rotation,textAlign:o||l.textAlign,borderRadius:a&&(n||l.borderRadius),datasetIndex:e.index}},this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class Hn extends ta{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const s=this.options;if(this.left=0,this.top=0,!s.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=e,this.height=this.bottom=t;const i=Yt(s.text)?s.text.length:1;this._padding=Ui(s.padding);const o=i*Vi(s.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=o:this.width=o}isHorizontal(){const e=this.options.position;return"top"===e||"bottom"===e}_drawArgs(e){const{top:t,left:s,bottom:i,right:o,options:r}=this,a=r.align;let n,l,c,d=0;return this.isHorizontal()?(l=Ys(a,s,o),c=t+e,n=o-s):("left"===r.position?(l=s+e,c=Ys(a,i,t),d=-.5*bs):(l=o-e,c=Ys(a,t,i),d=.5*bs),n=i-t),{titleX:l,titleY:c,maxWidth:n,rotation:d}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const s=Vi(t.font),i=s.lineHeight/2+this._padding.top,{titleX:o,titleY:r,maxWidth:a,rotation:n}=this._drawArgs(i);Ti(e,t.text,0,0,s,{color:t.color,maxWidth:a,rotation:n,textAlign:Js(t.align),textBaseline:"middle",translation:[o,r]})}}var Wn={id:"title",_element:Hn,start(e,t,s){!function(e,t){const s=new Hn({ctx:e.ctx,options:t,chart:e});Nr.configure(e,s,t),Nr.addBox(e,s),e.titleBlock=s}(e,s)},stop(e){const t=e.titleBlock;Nr.removeBox(e,t),delete e.titleBlock},beforeUpdate(e,t,s){const i=e.titleBlock;Nr.configure(e,i,s),i.options=s},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const qn=/* @__PURE__ */new WeakMap;var Kn={id:"subtitle",start(e,t,s){const i=new Hn({ctx:e.ctx,options:s,chart:e});Nr.configure(e,i,s),Nr.addBox(e,i),qn.set(e,i)},stop(e){Nr.removeBox(e,qn.get(e)),qn.delete(e)},beforeUpdate(e,t,s){const i=qn.get(e);Nr.configure(e,i,s),i.options=s},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Gn={average(e){if(!e.length)return!1;let t,s,i=/* @__PURE__ */new Set,o=0,r=0;for(t=0,s=e.length;t<s;++t){const s=e[t].element;if(s&&s.hasValue()){const e=s.tooltipPosition();i.add(e.x),o+=e.y,++r}}if(0===r||0===i.size)return!1;return{x:[...i].reduce((e,t)=>e+t)/i.size,y:o/r}},nearest(e,t){if(!e.length)return!1;let s,i,o,r=t.x,a=t.y,n=Number.POSITIVE_INFINITY;for(s=0,i=e.length;s<i;++s){const i=e[s].element;if(i&&i.hasValue()){const e=Os(t,i.getCenterPoint());e<n&&(n=e,o=i)}}if(o){const e=o.tooltipPosition();r=e.x,a=e.y}return{x:r,y:a}}};function Qn(e,t){return t&&(Yt(t)?Array.prototype.push.apply(e,t):e.push(t)),e}function Jn(e){return("string"==typeof e||e instanceof String)&&e.indexOf("\n")>-1?e.split("\n"):e}function Yn(e,t){const{element:s,datasetIndex:i,index:o}=t,r=e.getDatasetMeta(i).controller,{label:a,value:n}=r.getLabelAndValue(o);return{chart:e,label:a,parsed:r.getParsed(o),raw:e.data.datasets[i].data[o],formattedValue:n,dataset:r.getDataset(),dataIndex:o,datasetIndex:i,element:s}}function Xn(e,t){const s=e.chart.ctx,{body:i,footer:o,title:r}=e,{boxWidth:a,boxHeight:n}=t,l=Vi(t.bodyFont),c=Vi(t.titleFont),d=Vi(t.footerFont),h=r.length,u=o.length,p=i.length,g=Ui(t.padding);let m=g.height,f=0,v=i.reduce((e,t)=>e+t.before.length+t.lines.length+t.after.length,0);if(v+=e.beforeBody.length+e.afterBody.length,h&&(m+=h*c.lineHeight+(h-1)*t.titleSpacing+t.titleMarginBottom),v){m+=p*(t.displayColors?Math.max(n,l.lineHeight):l.lineHeight)+(v-p)*l.lineHeight+(v-1)*t.bodySpacing}u&&(m+=t.footerMarginTop+u*d.lineHeight+(u-1)*t.footerSpacing);let b=0;const y=function(e){f=Math.max(f,s.measureText(e).width+b)};return s.save(),s.font=c.string,os(e.title,y),s.font=l.string,os(e.beforeBody.concat(e.afterBody),y),b=t.displayColors?a+2+t.boxPadding:0,os(i,e=>{os(e.before,y),os(e.lines,y),os(e.after,y)}),b=0,s.font=d.string,os(e.footer,y),s.restore(),f+=g.width,{width:f,height:m}}function Zn(e,t,s,i){const{x:o,width:r}=s,{width:a,chartArea:{left:n,right:l}}=e;let c="center";return"center"===i?c=o<=(n+l)/2?"left":"right":o<=r/2?c="left":o>=a-r/2&&(c="right"),function(e,t,s,i){const{x:o,width:r}=i,a=s.caretSize+s.caretPadding;return"left"===e&&o+r+a>t.width||"right"===e&&o-r-a<0||void 0}(c,e,t,s)&&(c="center"),c}function el(e,t,s){const i=s.yAlign||t.yAlign||function(e,t){const{y:s,height:i}=t;return s<i/2?"top":s>e.height-i/2?"bottom":"center"}(e,s);return{xAlign:s.xAlign||t.xAlign||Zn(e,t,s,i),yAlign:i}}function tl(e,t,s,i){const{caretSize:o,caretPadding:r,cornerRadius:a}=e,{xAlign:n,yAlign:l}=s,c=o+r,{topLeft:d,topRight:h,bottomLeft:u,bottomRight:p}=zi(a);let g=function(e,t){let{x:s,width:i}=e;return"right"===t?s-=i:"center"===t&&(s-=i/2),s}(t,n);const m=function(e,t,s){let{y:i,height:o}=e;return"top"===t?i+=s:i-="bottom"===t?o+s:o/2,i}(t,l,c);return"center"===l?"left"===n?g+=c:"right"===n&&(g-=c):"left"===n?g-=Math.max(d,u)+o:"right"===n&&(g+=Math.max(h,p)+o),{x:zs(g,0,i.width-t.width),y:zs(m,0,i.height-t.height)}}function sl(e,t,s){const i=Ui(s.padding);return"center"===t?e.x+e.width/2:"right"===t?e.x+e.width-i.right:e.x+i.left}function il(e){return Qn([],Jn(e))}function ol(e,t){const s=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return s?e.override(s):e}const rl={beforeTitle:Gt,title(e){if(e.length>0){const t=e[0],s=t.chart.data.labels,i=s?s.length:0;if(this&&this.options&&"dataset"===this.options.mode)return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return s[t.dataIndex]}return""},afterTitle:Gt,beforeBody:Gt,beforeLabel:Gt,label(e){if(this&&this.options&&"dataset"===this.options.mode)return e.label+": "+e.formattedValue||e.formattedValue;let t=e.dataset.label||"";t&&(t+=": ");const s=e.formattedValue;return Jt(s)||(t+=s),t},labelColor(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:Gt,afterBody:Gt,beforeFooter:Gt,footer:Gt,afterFooter:Gt};function al(e,t,s,i){const o=e[t].call(s,i);return void 0===o?rl[t].call(s,i):o}class nl extends ta{static positioners=Gn;constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,s=this.options.setContext(this.getContext()),i=s.enabled&&t.options.animation&&s.animations,o=new Wo(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(o)),o}getContext(){return this.$context||(this.$context=(e=this.chart.getContext(),t=this,s=this._tooltipItems,Hi(e,{tooltip:t,tooltipItems:s,type:"tooltip"})));var e,t,s}getTitle(e,t){const{callbacks:s}=t,i=al(s,"beforeTitle",this,e),o=al(s,"title",this,e),r=al(s,"afterTitle",this,e);let a=[];return a=Qn(a,Jn(i)),a=Qn(a,Jn(o)),a=Qn(a,Jn(r)),a}getBeforeBody(e,t){return il(al(t.callbacks,"beforeBody",this,e))}getBody(e,t){const{callbacks:s}=t,i=[];return os(e,e=>{const t={before:[],lines:[],after:[]},o=ol(s,e);Qn(t.before,Jn(al(o,"beforeLabel",this,e))),Qn(t.lines,al(o,"label",this,e)),Qn(t.after,Jn(al(o,"afterLabel",this,e))),i.push(t)}),i}getAfterBody(e,t){return il(al(t.callbacks,"afterBody",this,e))}getFooter(e,t){const{callbacks:s}=t,i=al(s,"beforeFooter",this,e),o=al(s,"footer",this,e),r=al(s,"afterFooter",this,e);let a=[];return a=Qn(a,Jn(i)),a=Qn(a,Jn(o)),a=Qn(a,Jn(r)),a}_createItems(e){const t=this._active,s=this.chart.data,i=[],o=[],r=[];let a,n,l=[];for(a=0,n=t.length;a<n;++a)l.push(Yn(this.chart,t[a]));return e.filter&&(l=l.filter((t,i,o)=>e.filter(t,i,o,s))),e.itemSort&&(l=l.sort((t,i)=>e.itemSort(t,i,s))),os(l,t=>{const s=ol(e.callbacks,t);i.push(al(s,"labelColor",this,t)),o.push(al(s,"labelPointStyle",this,t)),r.push(al(s,"labelTextColor",this,t))}),this.labelColors=i,this.labelPointStyles=o,this.labelTextColors=r,this.dataPoints=l,l}update(e,t){const s=this.options.setContext(this.getContext()),i=this._active;let o,r=[];if(i.length){const e=Gn[s.position].call(this,i,this._eventPosition);r=this._createItems(s),this.title=this.getTitle(r,s),this.beforeBody=this.getBeforeBody(r,s),this.body=this.getBody(r,s),this.afterBody=this.getAfterBody(r,s),this.footer=this.getFooter(r,s);const t=this._size=Xn(this,s),a=Object.assign({},e,t),n=el(this.chart,s,a),l=tl(s,a,n,this.chart);this.xAlign=n.xAlign,this.yAlign=n.yAlign,o={opacity:1,x:l.x,y:l.y,width:t.width,height:t.height,caretX:e.x,caretY:e.y}}else 0!==this.opacity&&(o={opacity:0});this._tooltipItems=r,this.$context=void 0,o&&this._resolveAnimations().update(this,o),e&&s.external&&s.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,s,i){const o=this.getCaretPosition(e,s,i);t.lineTo(o.x1,o.y1),t.lineTo(o.x2,o.y2),t.lineTo(o.x3,o.y3)}getCaretPosition(e,t,s){const{xAlign:i,yAlign:o}=this,{caretSize:r,cornerRadius:a}=s,{topLeft:n,topRight:l,bottomLeft:c,bottomRight:d}=zi(a),{x:h,y:u}=e,{width:p,height:g}=t;let m,f,v,b,y,w;return"center"===o?(y=u+g/2,"left"===i?(m=h,f=m-r,b=y+r,w=y-r):(m=h+p,f=m+r,b=y-r,w=y+r),v=m):(f="left"===i?h+Math.max(n,c)+r:"right"===i?h+p-Math.max(l,d)-r:this.caretX,"top"===o?(b=u,y=b-r,m=f-r,v=f+r):(b=u+g,y=b+r,m=f+r,v=f-r),w=b),{x1:m,x2:f,x3:v,y1:b,y2:y,y3:w}}drawTitle(e,t,s){const i=this.title,o=i.length;let r,a,n;if(o){const l=Eo(s.rtl,this.x,this.width);for(e.x=sl(this,s.titleAlign,s),t.textAlign=l.textAlign(s.titleAlign),t.textBaseline="middle",r=Vi(s.titleFont),a=s.titleSpacing,t.fillStyle=s.titleColor,t.font=r.string,n=0;n<o;++n)t.fillText(i[n],l.x(e.x),e.y+r.lineHeight/2),e.y+=r.lineHeight+a,n+1===o&&(e.y+=s.titleMarginBottom-a)}}_drawColorBox(e,t,s,i,o){const r=this.labelColors[s],a=this.labelPointStyles[s],{boxHeight:n,boxWidth:l}=o,c=Vi(o.bodyFont),d=sl(this,"left",o),h=i.x(d),u=n<c.lineHeight?(c.lineHeight-n)/2:0,p=t.y+u;if(o.usePointStyle){const t={radius:Math.min(l,n)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},s=i.leftForLtr(h,l)+l/2,c=p+n/2;e.strokeStyle=o.multiKeyBackground,e.fillStyle=o.multiKeyBackground,ki(e,t,s,c),e.strokeStyle=r.borderColor,e.fillStyle=r.backgroundColor,ki(e,t,s,c)}else{e.lineWidth=Xt(r.borderWidth)?Math.max(...Object.values(r.borderWidth)):r.borderWidth||1,e.strokeStyle=r.borderColor,e.setLineDash(r.borderDash||[]),e.lineDashOffset=r.borderDashOffset||0;const t=i.leftForLtr(h,l),s=i.leftForLtr(i.xPlus(h,1),l-2),a=zi(r.borderRadius);Object.values(a).some(e=>0!==e)?(e.beginPath(),e.fillStyle=o.multiKeyBackground,Pi(e,{x:t,y:p,w:l,h:n,radius:a}),e.fill(),e.stroke(),e.fillStyle=r.backgroundColor,e.beginPath(),Pi(e,{x:s,y:p+1,w:l-2,h:n-2,radius:a}),e.fill()):(e.fillStyle=o.multiKeyBackground,e.fillRect(t,p,l,n),e.strokeRect(t,p,l,n),e.fillStyle=r.backgroundColor,e.fillRect(s,p+1,l-2,n-2))}e.fillStyle=this.labelTextColors[s]}drawBody(e,t,s){const{body:i}=this,{bodySpacing:o,bodyAlign:r,displayColors:a,boxHeight:n,boxWidth:l,boxPadding:c}=s,d=Vi(s.bodyFont);let h=d.lineHeight,u=0;const p=Eo(s.rtl,this.x,this.width),g=function(s){t.fillText(s,p.x(e.x+u),e.y+h/2),e.y+=h+o},m=p.textAlign(r);let f,v,b,y,w,x,_;for(t.textAlign=r,t.textBaseline="middle",t.font=d.string,e.x=sl(this,m,s),t.fillStyle=s.bodyColor,os(this.beforeBody,g),u=a&&"right"!==m?"center"===r?l/2+c:l+2+c:0,y=0,x=i.length;y<x;++y){for(f=i[y],v=this.labelTextColors[y],t.fillStyle=v,os(f.before,g),b=f.lines,a&&b.length&&(this._drawColorBox(t,e,y,p,s),h=Math.max(d.lineHeight,n)),w=0,_=b.length;w<_;++w)g(b[w]),h=d.lineHeight;os(f.after,g)}u=0,h=d.lineHeight,os(this.afterBody,g),e.y-=o}drawFooter(e,t,s){const i=this.footer,o=i.length;let r,a;if(o){const n=Eo(s.rtl,this.x,this.width);for(e.x=sl(this,s.footerAlign,s),e.y+=s.footerMarginTop,t.textAlign=n.textAlign(s.footerAlign),t.textBaseline="middle",r=Vi(s.footerFont),t.fillStyle=s.footerColor,t.font=r.string,a=0;a<o;++a)t.fillText(i[a],n.x(e.x),e.y+r.lineHeight/2),e.y+=r.lineHeight+s.footerSpacing}}drawBackground(e,t,s,i){const{xAlign:o,yAlign:r}=this,{x:a,y:n}=e,{width:l,height:c}=s,{topLeft:d,topRight:h,bottomLeft:u,bottomRight:p}=zi(i.cornerRadius);t.fillStyle=i.backgroundColor,t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.beginPath(),t.moveTo(a+d,n),"top"===r&&this.drawCaret(e,t,s,i),t.lineTo(a+l-h,n),t.quadraticCurveTo(a+l,n,a+l,n+h),"center"===r&&"right"===o&&this.drawCaret(e,t,s,i),t.lineTo(a+l,n+c-p),t.quadraticCurveTo(a+l,n+c,a+l-p,n+c),"bottom"===r&&this.drawCaret(e,t,s,i),t.lineTo(a+u,n+c),t.quadraticCurveTo(a,n+c,a,n+c-u),"center"===r&&"left"===o&&this.drawCaret(e,t,s,i),t.lineTo(a,n+d),t.quadraticCurveTo(a,n,a+d,n),t.closePath(),t.fill(),i.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,s=this.$animations,i=s&&s.x,o=s&&s.y;if(i||o){const s=Gn[e.position].call(this,this._active,this._eventPosition);if(!s)return;const r=this._size=Xn(this,e),a=Object.assign({},s,this._size),n=el(t,e,a),l=tl(e,a,n,t);i._to===l.x&&o._to===l.y||(this.xAlign=n.xAlign,this.yAlign=n.yAlign,this.width=r.width,this.height=r.height,this.caretX=s.x,this.caretY=s.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let s=this.opacity;if(!s)return;this._updateAnimationTarget(t);const i={width:this.width,height:this.height},o={x:this.x,y:this.y};s=Math.abs(s)<.001?0:s;const r=Ui(t.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&a&&(e.save(),e.globalAlpha=s,this.drawBackground(o,e,i,t),Mo(e,t.textDirection),o.y+=r.top,this.drawTitle(o,e,t),this.drawBody(o,e,t),this.drawFooter(o,e,t),Ao(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const s=this._active,i=e.map(({datasetIndex:e,index:t})=>{const s=this.chart.getDatasetMeta(e);if(!s)throw new Error("Cannot find a dataset at index "+e);return{datasetIndex:e,element:s.data[t],index:t}}),o=!rs(s,i),r=this._positionChanged(i,t);(o||r)&&(this._active=i,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,s=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,o=this._active||[],r=this._getActiveElements(e,o,t,s),a=this._positionChanged(r,e),n=t||!rs(r,o)||a;return n&&(this._active=r,(i.enabled||i.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),n}_getActiveElements(e,t,s,i){const o=this.options;if("mouseout"===e.type)return[];if(!i)return t.filter(e=>this.chart.data.datasets[e.datasetIndex]&&void 0!==this.chart.getDatasetMeta(e.datasetIndex).controller.getParsed(e.index));const r=this.chart.getElementsAtEventForMode(e,o.mode,o,s);return o.reverse&&r.reverse(),r}_positionChanged(e,t){const{caretX:s,caretY:i,options:o}=this,r=Gn[o.position].call(this,e,t);return!1!==r&&(s!==r.x||i!==r.y)}}var ll={id:"tooltip",_element:nl,positioners:Gn,afterInit(e,t,s){s&&(e.tooltip=new nl({chart:e,options:s}))},beforeUpdate(e,t,s){e.tooltip&&e.tooltip.initialize(s)},reset(e,t,s){e.tooltip&&e.tooltip.initialize(s)},afterDraw(e){const t=e.tooltip;if(t&&t._willRender()){const s={tooltip:t};if(!1===e.notifyPlugins("beforeTooltipDraw",{...s,cancelable:!0}))return;t.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",s)}},afterEvent(e,t){if(e.tooltip){const s=t.replay;e.tooltip.handleEvent(t.event,s,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,t)=>t.bodyFont.size,boxWidth:(e,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:rl},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>"filter"!==e&&"itemSort"!==e&&"external"!==e,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},cl=/* @__PURE__ */Object.freeze({__proto__:null,Colors:bn,Decimation:xn,Filler:Fn,Legend:jn,SubTitle:Kn,Title:Wn,Tooltip:ll});function dl(e,t,s,i){const o=e.indexOf(t);if(-1===o)return((e,t,s,i)=>("string"==typeof t?(s=e.push(t)-1,i.unshift({index:s,label:t})):isNaN(t)&&(s=null),s))(e,t,s,i);return o!==e.lastIndexOf(t)?s:o}function hl(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}function ul(e,t){const s=[],{bounds:i,step:o,min:r,max:a,precision:n,count:l,maxTicks:c,maxDigits:d,includeBounds:h}=e,u=o||1,p=c-1,{min:g,max:m}=t,f=!Jt(r),v=!Jt(a),b=!Jt(l),y=(m-g)/(d+1);let w,x,_,k,S=Ms((m-g)/p/u)*u;if(S<1e-14&&!f&&!v)return[{value:g},{value:m}];k=Math.ceil(m/S)-Math.floor(g/S),k>p&&(S=Ms(k*S/p/u)*u),Jt(n)||(w=Math.pow(10,n),S=Math.ceil(S*w)/w),"ticks"===i?(x=Math.floor(g/S)*S,_=Math.ceil(m/S)*S):(x=g,_=m),f&&v&&o&&function(e,t){const s=Math.round(e);return s-t<=e&&s+t>=e}((a-r)/o,S/1e3)?(k=Math.round(Math.min((a-r)/S,c)),S=(a-r)/k,x=r,_=a):b?(x=f?r:x,_=v?a:_,k=l-1,S=(_-x)/k):(k=(_-x)/S,k=Es(k,Math.round(k),S/1e3)?Math.round(k):Math.ceil(k));const C=Math.max(Ls(S),Ls(x));w=Math.pow(10,Jt(n)?C:n),x=Math.round(x*w)/w,_=Math.round(_*w)/w;let $=0;for(f&&(h&&x!==r?(s.push({value:r}),x<r&&$++,Es(Math.round((x+$*S)*w)/w,r,pl(r,y,e))&&$++):x<r&&$++);$<k;++$){const e=Math.round((x+$*S)*w)/w;if(v&&e>a)break;s.push({value:e})}return v&&h&&_!==a?s.length&&Es(s[s.length-1].value,a,pl(a,y,e))?s[s.length-1].value=a:s.push({value:a}):v&&_!==a||s.push({value:_}),s}function pl(e,t,{horizontal:s,minRotation:i}){const o=Ts(i),r=(s?Math.sin(o):Math.cos(o))||.001,a=.75*t*(""+e).length;return Math.min(t/r,a)}class gl extends ha{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return Jt(e)||("number"==typeof e||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:s}=this.getUserBounds();let{min:i,max:o}=this;const r=e=>i=t?i:e,a=e=>o=s?o:e;if(e){const e=Ds(i),t=Ds(o);e<0&&t<0?a(0):e>0&&t>0&&r(0)}if(i===o){let t=0===o?1:Math.abs(.05*o);a(o+t),e||r(i-t)}this.min=i,this.max=o}getTickLimit(){const e=this.options.ticks;let t,{maxTicksLimit:s,stepSize:i}=e;return i?(t=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,t>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${t} ticks. Limiting to 1000.`),t=1e3)):(t=this.computeTickLimit(),s=s||11),s&&(t=Math.min(s,t)),t}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let s=this.getTickLimit();s=Math.max(2,s);const i=ul({maxTicks:s,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:!1!==t.includeBounds},this._range||this);return"ticks"===e.bounds&&Is(i,this,"value"),e.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}configure(){const e=this.ticks;let t=this.min,s=this.max;if(super.configure(),this.options.offset&&e.length){const i=(s-t)/Math.max(e.length-1,1)/2;t-=i,s+=i}this._startValue=t,this._endValue=s,this._valueRange=s-t}getLabelForValue(e){return di(e,this.chart.options.locale,this.options.ticks.format)}}class ml extends gl{static id="linear";static defaults={ticks:{callback:ui.formatters.numeric}};determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=Zt(e)?e:0,this.max=Zt(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,s=Ts(this.options.ticks.minRotation),i=(e?Math.sin(s):Math.cos(s))||.001,o=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,o.lineHeight/i))}getPixelForValue(e){return null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}const fl=e=>Math.floor($s(e)),vl=(e,t)=>Math.pow(10,fl(e)+t);function bl(e){return 1===e/Math.pow(10,fl(e))}function yl(e,t,s){const i=Math.pow(10,s),o=Math.floor(e/i);return Math.ceil(t/i)-o}function wl(e,{min:t,max:s}){t=es(e.min,t);const i=[],o=fl(t);let r=function(e,t){let s=fl(t-e);for(;yl(e,t,s)>10;)s++;for(;yl(e,t,s)<10;)s--;return Math.min(s,fl(e))}(t,s),a=r<0?Math.pow(10,Math.abs(r)):1;const n=Math.pow(10,r),l=o>r?Math.pow(10,o):0,c=Math.round((t-l)*a)/a,d=Math.floor((t-l)/n/10)*n*10;let h=Math.floor((c-d)/Math.pow(10,r)),u=es(e.min,Math.round((l+d+h*Math.pow(10,r))*a)/a);for(;u<s;)i.push({value:u,major:bl(u),significand:h}),h>=10?h=h<15?15:20:h++,h>=20&&(r++,h=2,a=r>=0?1:a),u=Math.round((l+d+h*Math.pow(10,r))*a)/a;const p=es(e.max,u);return i.push({value:p,major:bl(p),significand:h}),i}class xl extends ha{static id="logarithmic";static defaults={ticks:{callback:ui.formatters.logarithmic,major:{enabled:!0}}};constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){const s=gl.prototype.parse.apply(this,[e,t]);if(0!==s)return Zt(s)&&s>0?s:null;this._zero=!0}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=Zt(e)?Math.max(0,e):null,this.max=Zt(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Zt(this._userMin)&&(this.min=e===vl(this.min,0)?vl(this.min,-1):vl(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let s=this.min,i=this.max;const o=t=>s=e?s:t,r=e=>i=t?i:e;s===i&&(s<=0?(o(1),r(10)):(o(vl(s,-1)),r(vl(i,1)))),s<=0&&o(vl(i,-1)),i<=0&&r(vl(s,1)),this.min=s,this.max=i}buildTicks(){const e=this.options,t=wl({min:this._userMin,max:this._userMax},this);return"ticks"===e.bounds&&Is(t,this,"value"),e.reverse?(t.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),t}getLabelForValue(e){return void 0===e?"0":di(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=$s(e),this._valueRange=$s(this.max)-$s(e)}getPixelForValue(e){return void 0!==e&&0!==e||(e=this.min),null===e||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:($s(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}}function _l(e){const t=e.ticks;if(t.display&&e.display){const e=Ui(t.backdropPadding);return ts(t.font&&t.font.size,bi.font.size)+e.height}return 0}function kl(e,t,s){return s=Yt(s)?s:[s],{w:wi(e,t.string,s),h:s.length*t.lineHeight}}function Sl(e,t,s,i,o){return e===i||e===o?{start:t-s/2,end:t+s/2}:e<i||e>o?{start:t-s,end:t}:{start:t,end:t+s}}function Cl(e){const t={l:e.left+e._padding.left,r:e.right-e._padding.right,t:e.top+e._padding.top,b:e.bottom-e._padding.bottom},s=Object.assign({},t),i=[],o=[],r=e._pointLabels.length,a=e.options.pointLabels,n=a.centerPointLabels?bs/r:0;for(let l=0;l<r;l++){const r=a.setContext(e.getPointLabelContext(l));o[l]=r.padding;const c=e.getPointPosition(l,e.drawingArea+o[l],n),d=Vi(r.font),h=kl(e.ctx,d,e._pointLabels[l]);i[l]=h;const u=Bs(e.getIndexAngle(l)+n),p=Math.round(Ps(u));$l(s,t,u,Sl(p,c.x,h.w,0,180),Sl(p,c.y,h.h,90,270))}e.setCenterPoint(t.l-s.l,s.r-t.r,t.t-s.t,s.b-t.b),e._pointLabelItems=function(e,t,s){const i=[],o=e._pointLabels.length,r=e.options,{centerPointLabels:a,display:n}=r.pointLabels,l={extra:_l(r)/2,additionalAngle:a?bs/o:0};let c;for(let d=0;d<o;d++){l.padding=s[d],l.size=t[d];const o=Dl(e,d,l);i.push(o),"auto"===n&&(o.visible=El(o,c),o.visible&&(c=o))}return i}(e,i,o)}function $l(e,t,s,i,o){const r=Math.abs(Math.sin(s)),a=Math.abs(Math.cos(s));let n=0,l=0;i.start<t.l?(n=(t.l-i.start)/r,e.l=Math.min(e.l,t.l-n)):i.end>t.r&&(n=(i.end-t.r)/r,e.r=Math.max(e.r,t.r+n)),o.start<t.t?(l=(t.t-o.start)/a,e.t=Math.min(e.t,t.t-l)):o.end>t.b&&(l=(o.end-t.b)/a,e.b=Math.max(e.b,t.b+l))}function Dl(e,t,s){const i=e.drawingArea,{extra:o,additionalAngle:r,padding:a,size:n}=s,l=e.getPointPosition(t,i+o+a,r),c=Math.round(Ps(Bs(l.angle+ks))),d=function(e,t,s){90===s||270===s?e-=t/2:(s>270||s<90)&&(e-=t);return e}(l.y,n.h,c),h=function(e){if(0===e||180===e)return"center";if(e<180)return"left";return"right"}(c),u=function(e,t,s){"right"===s?e-=t:"center"===s&&(e-=t/2);return e}(l.x,n.w,h);return{visible:!0,x:l.x,y:d,textAlign:h,left:u,top:d,right:u+n.w,bottom:d+n.h}}function El(e,t){if(!t)return!0;const{left:s,top:i,right:o,bottom:r}=e;return!(Ci({x:s,y:i},t)||Ci({x:s,y:r},t)||Ci({x:o,y:i},t)||Ci({x:o,y:r},t))}function Ml(e,t,s){const{left:i,top:o,right:r,bottom:a}=s,{backdropColor:n}=t;if(!Jt(n)){const s=zi(t.borderRadius),l=Ui(t.backdropPadding);e.fillStyle=n;const c=i-l.left,d=o-l.top,h=r-i+l.width,u=a-o+l.height;Object.values(s).some(e=>0!==e)?(e.beginPath(),Pi(e,{x:c,y:d,w:h,h:u,radius:s}),e.fill()):e.fillRect(c,d,h,u)}}function Al(e,t,s,i){const{ctx:o}=e;if(s)o.arc(e.xCenter,e.yCenter,t,0,ys);else{let s=e.getPointPosition(0,t);o.moveTo(s.x,s.y);for(let r=1;r<i;r++)s=e.getPointPosition(r,t),o.lineTo(s.x,s.y)}}class Il extends gl{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:ui.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:e=>e,padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=Ui(_l(this.options)/2),t=this.width=this.maxWidth-e.width,s=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+s/2+e.top),this.drawingArea=Math.floor(Math.min(t,s)/2)}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!1);this.min=Zt(e)&&!isNaN(e)?e:0,this.max=Zt(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/_l(this.options))}generateTickLabels(e){gl.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((e,t)=>{const s=is(this.options.pointLabels.callback,[e,t],this);return s||0===s?s:""}).filter((e,t)=>this.chart.getDataVisibility(t))}fit(){const e=this.options;e.display&&e.pointLabels.display?Cl(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,s,i){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((s-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,s,i))}getIndexAngle(e){return Bs(e*(ys/(this._pointLabels.length||1))+Ts(this.options.startAngle||0))}getDistanceFromCenterForValue(e){if(Jt(e))return NaN;const t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(Jt(e))return NaN;const t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){const t=this._pointLabels||[];if(e>=0&&e<t.length){const s=t[e];return function(e,t,s){return Hi(e,{label:s,index:t,type:"pointLabel"})}(this.getContext(),e,s)}}getPointPosition(e,t,s=0){const i=this.getIndexAngle(e)-ks+s;return{x:Math.cos(i)*t+this.xCenter,y:Math.sin(i)*t+this.yCenter,angle:i}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:t,top:s,right:i,bottom:o}=this._pointLabelItems[e];return{left:t,top:s,right:i,bottom:o}}drawBackground(){const{backgroundColor:e,grid:{circular:t}}=this.options;if(e){const s=this.ctx;s.save(),s.beginPath(),Al(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),s.closePath(),s.fillStyle=e,s.fill(),s.restore()}}drawGrid(){const e=this.ctx,t=this.options,{angleLines:s,grid:i,border:o}=t,r=this._pointLabels.length;let a,n,l;if(t.pointLabels.display&&function(e,t){const{ctx:s,options:{pointLabels:i}}=e;for(let o=t-1;o>=0;o--){const t=e._pointLabelItems[o];if(!t.visible)continue;const r=i.setContext(e.getPointLabelContext(o));Ml(s,r,t);const a=Vi(r.font),{x:n,y:l,textAlign:c}=t;Ti(s,e._pointLabels[o],n,l+a.lineHeight/2,a,{color:r.color,textAlign:c,textBaseline:"middle"})}}(this,r),i.display&&this.ticks.forEach((e,t)=>{if(0!==t||0===t&&this.min<0){n=this.getDistanceFromCenterForValue(e.value);const s=this.getContext(t),a=i.setContext(s),l=o.setContext(s);!function(e,t,s,i,o){const r=e.ctx,a=t.circular,{color:n,lineWidth:l}=t;!a&&!i||!n||!l||s<0||(r.save(),r.strokeStyle=n,r.lineWidth=l,r.setLineDash(o.dash||[]),r.lineDashOffset=o.dashOffset,r.beginPath(),Al(e,s,a,i),r.closePath(),r.stroke(),r.restore())}(this,a,n,r,l)}}),s.display){for(e.save(),a=r-1;a>=0;a--){const i=s.setContext(this.getPointLabelContext(a)),{color:o,lineWidth:r}=i;r&&o&&(e.lineWidth=r,e.strokeStyle=o,e.setLineDash(i.borderDash),e.lineDashOffset=i.borderDashOffset,n=this.getDistanceFromCenterForValue(t.reverse?this.min:this.max),l=this.getPointPosition(a,n),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(l.x,l.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,t=this.options,s=t.ticks;if(!s.display)return;const i=this.getIndexAngle(0);let o,r;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(i),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((i,a)=>{if(0===a&&this.min>=0&&!t.reverse)return;const n=s.setContext(this.getContext(a)),l=Vi(n.font);if(o=this.getDistanceFromCenterForValue(this.ticks[a].value),n.showLabelBackdrop){e.font=l.string,r=e.measureText(i.label).width,e.fillStyle=n.backdropColor;const t=Ui(n.backdropPadding);e.fillRect(-r/2-t.left,-o-l.size/2-t.top,r+t.width,l.size+t.height)}Ti(e,i.label,0,-o,l,{color:n.color,strokeColor:n.textStrokeColor,strokeWidth:n.textStrokeWidth})}),e.restore()}drawTitle(){}}const Tl={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Pl=/* @__PURE__ */Object.keys(Tl);function Ll(e,t){return e-t}function Rl(e,t){if(Jt(t))return null;const s=e._adapter,{parser:i,round:o,isoWeekday:r}=e._parseOpts;let a=t;return"function"==typeof i&&(a=i(a)),Zt(a)||(a="string"==typeof i?s.parse(a,i):s.parse(a)),null===a?null:(o&&(a="week"!==o||!As(r)&&!0!==r?s.startOf(a,o):s.startOf(a,"isoWeek",r)),+a)}function Ol(e,t,s,i){const o=Pl.length;for(let r=Pl.indexOf(e);r<o-1;++r){const e=Tl[Pl[r]],o=e.steps?e.steps:Number.MAX_SAFE_INTEGER;if(e.common&&Math.ceil((s-t)/(o*e.size))<=i)return Pl[r]}return Pl[o-1]}function Nl(e,t,s){if(s){if(s.length){const{lo:i,hi:o}=Vs(s,t);e[s[i]>=t?s[i]:s[o]]=!0}}else e[t]=!0}function Bl(e,t,s){const i=[],o={},r=t.length;let a,n;for(a=0;a<r;++a)n=t[a],o[n]=a,i.push({value:n,major:!1});return 0!==r&&s?function(e,t,s,i){const o=e._adapter,r=+o.startOf(t[0].value,i),a=t[t.length-1].value;let n,l;for(n=r;n<=a;n=+o.add(n,1,i))l=s[n],l>=0&&(t[l].major=!0);return t}(e,i,o,s):i}class Fl extends ha{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t={}){const s=e.time||(e.time={}),i=this._adapter=new vr(e.adapters.date);i.init(t),ds(s.displayFormats,i.formats()),this._parseOpts={parser:s.parser,round:s.round,isoWeekday:s.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return void 0===e?null:Rl(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,s=e.time.unit||"day";let{min:i,max:o,minDefined:r,maxDefined:a}=this.getUserBounds();function n(e){r||isNaN(e.min)||(i=Math.min(i,e.min)),a||isNaN(e.max)||(o=Math.max(o,e.max))}r&&a||(n(this._getLabelBounds()),"ticks"===e.bounds&&"labels"===e.ticks.source||n(this.getMinMax(!1))),i=Zt(i)&&!isNaN(i)?i:+t.startOf(Date.now(),s),o=Zt(o)&&!isNaN(o)?o:+t.endOf(Date.now(),s)+1,this.min=Math.min(i,o-1),this.max=Math.max(i+1,o)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],s=e[e.length-1]),{min:t,max:s}}buildTicks(){const e=this.options,t=e.time,s=e.ticks,i="labels"===s.source?this.getLabelTimestamps():this._generate();"ticks"===e.bounds&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const o=this.min,r=function(e,t,s){let i=0,o=e.length;for(;i<o&&e[i]<t;)i++;for(;o>i&&e[o-1]>s;)o--;return i>0||o<e.length?e.slice(i,o):e}(i,o,this.max);return this._unit=t.unit||(s.autoSkip?Ol(t.minUnit,this.min,this.max,this._getLabelCapacity(o)):function(e,t,s,i,o){for(let r=Pl.length-1;r>=Pl.indexOf(s);r--){const s=Pl[r];if(Tl[s].common&&e._adapter.diff(o,i,s)>=t-1)return s}return Pl[s?Pl.indexOf(s):0]}(this,r.length,t.minUnit,this.min,this.max)),this._majorUnit=s.major.enabled&&"year"!==this._unit?function(e){for(let t=Pl.indexOf(e)+1,s=Pl.length;t<s;++t)if(Tl[Pl[t]].common)return Pl[t]}(this._unit):void 0,this.initOffsets(i),e.reverse&&r.reverse(),Bl(this,r,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let t,s,i=0,o=0;this.options.offset&&e.length&&(t=this.getDecimalForValue(e[0]),i=1===e.length?1-t:(this.getDecimalForValue(e[1])-t)/2,s=this.getDecimalForValue(e[e.length-1]),o=1===e.length?s:(s-this.getDecimalForValue(e[e.length-2]))/2);const r=e.length<3?.5:.25;i=zs(i,0,r),o=zs(o,0,r),this._offsets={start:i,end:o,factor:1/(i+1+o)}}_generate(){const e=this._adapter,t=this.min,s=this.max,i=this.options,o=i.time,r=o.unit||Ol(o.minUnit,t,s,this._getLabelCapacity(t)),a=ts(i.ticks.stepSize,1),n="week"===r&&o.isoWeekday,l=As(n)||!0===n,c={};let d,h,u=t;if(l&&(u=+e.startOf(u,"isoWeek",n)),u=+e.startOf(u,l?"day":r),e.diff(s,t,r)>1e5*a)throw new Error(t+" and "+s+" are too far apart with stepSize of "+a+" "+r);const p="data"===i.ticks.source&&this.getDataTimestamps();for(d=u,h=0;d<s;d=+e.add(d,a,r),h++)Nl(c,d,p);return d!==s&&"ticks"!==i.bounds&&1!==h||Nl(c,d,p),Object.keys(c).sort(Ll).map(e=>+e)}getLabelForValue(e){const t=this._adapter,s=this.options.time;return s.tooltipFormat?t.format(e,s.tooltipFormat):t.format(e,s.displayFormats.datetime)}format(e,t){const s=this.options.time.displayFormats,i=this._unit,o=t||s[i];return this._adapter.format(e,o)}_tickFormatFunction(e,t,s,i){const o=this.options,r=o.ticks.callback;if(r)return is(r,[e,t,s],this);const a=o.time.displayFormats,n=this._unit,l=this._majorUnit,c=n&&a[n],d=l&&a[l],h=s[t],u=l&&d&&h&&h.major;return this._adapter.format(e,i||(u?d:c))}generateTickLabels(e){let t,s,i;for(t=0,s=e.length;t<s;++t)i=e[t],i.label=this._tickFormatFunction(i.value,t,e)}getDecimalForValue(e){return null===e?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,s=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+s)*t.factor)}getValueForPixel(e){const t=this._offsets,s=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+s*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,s=this.ctx.measureText(e).width,i=Ts(this.isHorizontal()?t.maxRotation:t.minRotation),o=Math.cos(i),r=Math.sin(i),a=this._resolveTickFontOptions(0).size;return{w:s*o+a*r,h:s*r+a*o}}_getLabelCapacity(e){const t=this.options.time,s=t.displayFormats,i=s[t.unit]||s.millisecond,o=this._tickFormatFunction(e,0,Bl(this,[e],this._majorUnit),i),r=this._getLabelSize(o),a=Math.floor(this.isHorizontal()?this.width/r.w:this.height/r.h)-1;return a>0?a:1}getDataTimestamps(){let e,t,s=this._cache.data||[];if(s.length)return s;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(e=0,t=i.length;e<t;++e)s=s.concat(i[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(s)}getLabelTimestamps(){const e=this._cache.labels||[];let t,s;if(e.length)return e;const i=this.getLabels();for(t=0,s=i.length;t<s;++t)e.push(Rl(this,i[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return Ks(e.sort(Ll))}}function zl(e,t,s){let i,o,r,a,n=0,l=e.length-1;s?(t>=e[n].pos&&t<=e[l].pos&&({lo:n,hi:l}=js(e,"pos",t)),({pos:i,time:r}=e[n]),({pos:o,time:a}=e[l])):(t>=e[n].time&&t<=e[l].time&&({lo:n,hi:l}=js(e,"time",t)),({time:i,pos:r}=e[n]),({time:o,pos:a}=e[l]));const c=o-i;return c?r+(a-r)*(t-i)/c:r}const Ul=[gr,hn,cl,/* @__PURE__ */Object.freeze({__proto__:null,CategoryScale:class extends ha{static id="category";static defaults={ticks:{callback:hl}};constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const e=this.getLabels();for(const{index:s,label:i}of t)e[s]===i&&e.splice(s,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(Jt(e))return null;const s=this.getLabels();return((e,t)=>null===e?null:zs(Math.round(e),0,t))(t=isFinite(t)&&s[t]===e?t:dl(s,e,ts(t,e),this._addedLabels),s.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:s,max:i}=this.getMinMax(!0);"ticks"===this.options.bounds&&(e||(s=0),t||(i=this.getLabels().length-1)),this.min=s,this.max=i}buildTicks(){const e=this.min,t=this.max,s=this.options.offset,i=[];let o=this.getLabels();o=0===e&&t===o.length-1?o:o.slice(e,t+1),this._valueRange=Math.max(o.length-(s?0:1),1),this._startValue=this.min-(s?.5:0);for(let r=e;r<=t;r++)i.push({value:r});return i}getLabelForValue(e){return hl.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return"number"!=typeof e&&(e=this.parse(e)),null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}},LinearScale:ml,LogarithmicScale:xl,RadialLinearScale:Il,TimeScale:Fl,TimeSeriesScale:class extends Fl{static id="timeseries";static defaults=Fl.defaults;constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=zl(t,this.min),this._tableRange=zl(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:s}=this,i=[],o=[];let r,a,n,l,c;for(r=0,a=e.length;r<a;++r)l=e[r],l>=t&&l<=s&&i.push(l);if(i.length<2)return[{time:t,pos:0},{time:s,pos:1}];for(r=0,a=i.length;r<a;++r)c=i[r+1],n=i[r-1],l=i[r],Math.round((c+n)/2)!==l&&o.push({time:l,pos:r/(a-1)});return o}_generate(){const e=this.min,t=this.max;let s=super.getDataTimestamps();return s.includes(e)&&s.length||s.splice(0,0,e),s.includes(t)&&1!==s.length||s.push(t),s.sort((e,t)=>e-t)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),s=this.getLabelTimestamps();return e=t.length&&s.length?this.normalize(t.concat(s)):t.length?t:s,e=this._cache.all=e,e}getDecimalForValue(e){return(zl(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,s=this.getDecimalForPixel(e)/t.factor-t.end;return zl(this._table,s*this._tableRange+this._minPos,!0)}}})];Va.register(...Ul);var Vl,jl={},Hl={};var Wl,ql={};function Kl(){if(Wl)return ql;Wl=1,Object.defineProperty(ql,"__esModule",{value:!0}),ql.MultiStoreController=void 0;return ql.MultiStoreController=class{constructor(e,t){this.host=e,this.atoms=t,e.addController(this)}hostConnected(){this.unsubscribes=this.atoms.map(e=>e.subscribe(()=>this.host.requestUpdate()))}hostDisconnected(){var e;null===(e=this.unsubscribes)||void 0===e||e.forEach(e=>e())}get values(){return this.atoms.map(e=>e.get())}},ql}var Gl,Ql={};var Jl,Yl,Xl={};var Zl=(Yl||(Yl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.withStores=e.useStores=e.MultiStoreController=e.StoreController=void 0;var t=(Vl||(Vl=1,Object.defineProperty(Hl,"__esModule",{value:!0}),Hl.StoreController=void 0,Hl.StoreController=class{constructor(e,t){this.host=e,this.atom=t,e.addController(this)}hostConnected(){this.unsubscribe=this.atom.subscribe(()=>{this.host.requestUpdate()})}hostDisconnected(){var e;null===(e=this.unsubscribe)||void 0===e||e.call(this)}get value(){return this.atom.get()}}),Hl);Object.defineProperty(e,"StoreController",{enumerable:!0,get:function(){return t.StoreController}});var s=Kl();Object.defineProperty(e,"MultiStoreController",{enumerable:!0,get:function(){return s.MultiStoreController}});var i=function(){if(Gl)return Ql;Gl=1,Object.defineProperty(Ql,"__esModule",{value:!0}),Ql.useStores=void 0;const e=Kl();return Ql.useStores=function(...t){return s=>class extends s{constructor(...s){super(...s),new e.MultiStoreController(this,t)}}},Ql}();Object.defineProperty(e,"useStores",{enumerable:!0,get:function(){return i.useStores}});var o=function(){if(Jl)return Xl;Jl=1,Object.defineProperty(Xl,"__esModule",{value:!0}),Xl.withStores=void 0;const e=Kl();return Xl.withStores=(t,s)=>class extends t{constructor(...t){super(...t),new e.MultiStoreController(this,s)}},Xl}();Object.defineProperty(e,"withStores",{enumerable:!0,get:function(){return o.withStores}})}(jl)),jl);class ec extends Zl.StoreController{constructor(e,t,s){super(e,t),this._store=t,this.subscription=s}hostConnected(){super.hostConnected(),this.subscription?.onChange&&(this._unsubscribe=this._store.subscribe(this.subscription.onChange))}hostDisconnected(){super.hostDisconnected(),this._unsubscribe&&(this._unsubscribe(),this._unsubscribe=void 0)}get value(){const e=super.value;return this.subscription?.transform?this.subscription.transform(e):e}}let tc=e=>e,sc={},ic={addEventListener(){},removeEventListener(){}};(function(){try{return"undefined"!=typeof localStorage}catch{return!1}})()&&(sc=localStorage);let oc={addEventListener(e,t,s){window.addEventListener("storage",t),window.addEventListener("pageshow",s)},removeEventListener(e,t,s){window.removeEventListener("storage",t),window.removeEventListener("pageshow",s)}};function rc(e,t=void 0,s={}){let i=s.encode||tc,o=s.decode||tc,r=Be(t),a=r.set;function n(s){s.key===e?null===s.newValue?a(t):a(o(s.newValue)):sc[e]||a(t)}function l(){r.set(sc[e]?o(sc[e]):t)}return r.set=t=>{let s=i(t);void 0===s?delete sc[e]:sc[e]=s,a(t)},Fe(r,()=>{if(l(),!1!==s.listen)return ic.addEventListener(e,n,l),()=>{ic.removeEventListener(e,n,l)}}),r}"undefined"!=typeof window&&(ic=oc);var ac=/* @__PURE__ */(e=>(e.CONNECTED="ws:connected",e.DISCONNECTED="ws:disconnected",e.MESSAGE="ws:message",e.ERROR="ws:error",e.RECONNECTING="ws:reconnecting",e.RECONNECTED="ws:reconnected",e.QUEUE_FULL="ws:queue_full",e))(ac||{});const nc={terminal:{maxAttempts:5,initialDelay:1e3,maxDelay:5e3,backoffMultiplier:1.2,jitter:!1,timeout:5e3},default:{maxAttempts:10,initialDelay:2e3,maxDelay:2e4,backoffMultiplier:1.5,jitter:!0,timeout:1e4}};const lc=class e{constructor(){this.sharedConnections={events:null,notifications:null},this.isolatedConnections={terminals:/* @__PURE__ */new Map,fileTransfers:/* @__PURE__ */new Map,executions:/* @__PURE__ */new Map,containerLogs:/* @__PURE__ */new Map},this.connectionStatus=/* @__PURE__ */new Map,this.reconnectStrategies=/* @__PURE__ */new Map,this.messageRouters=/* @__PURE__ */new Map,this.messageQueues=/* @__PURE__ */new Map,this.reconnectTimers=/* @__PURE__ */new Map,this.healthCheckIntervals=/* @__PURE__ */new Map,this.debug=!1,nc.terminal&&this.reconnectStrategies.set("terminal",nc.terminal),nc.default&&this.reconnectStrategies.set("default",nc.default),window.addEventListener("auth:logout",()=>this.closeAll()),this.debug&&console.log("[WebSocketManager] Initialized")}static getInstance(){return e.instance||(e.instance=new e),e.instance}subscribeToShared(e,t){const s=`shared:${e}`;return this.messageRouters.has(s)||this.messageRouters.set(s,/* @__PURE__ */new Set),this.messageRouters.get(s).add(t),this.sharedConnections[e]||this.createSharedConnection(e),()=>{const i=this.messageRouters.get(s);i&&(i.delete(t),0===i.size&&this.closeSharedConnection(e))}}createSharedConnection(e){const s=`shared:${e}`,i=this.getEndpointPath(e);this.debug&&console.log(`[WebSocketManager] Creating shared connection: ${s}`);const o=new WebSocket(t(i));this.updateConnectionStatus(s,{endpoint:i,status:"connecting",reconnectAttempts:0}),this.setupWebSocketHandlers(o,s,e),this.sharedConnections[e]=o,this.startHealthMonitoring(s)}forceReconnectShared(e){const t=`shared:${e}`,s=this.sharedConnections[e];if(s){this.debug&&console.log(`[WebSocketManager] Force reconnecting shared connection: ${t}`),s.close(1e3,"Force reconnect"),this.sharedConnections[e]=null;const i=this.messageRouters.get(t);i&&i.size>0&&setTimeout(()=>{this.createSharedConnection(e)},100)}}closeSharedConnection(e){const t=`shared:${e}`,s=this.sharedConnections[e];s&&(this.debug&&console.log(`[WebSocketManager] Closing shared connection: ${t}`),this.stopHealthMonitoring(t),this.cancelReconnection(t),s.close(1e3,"Normal closure"),this.sharedConnections[e]=null,this.updateConnectionStatus(t,{...this.getConnectionStatus(t),status:"disconnected"}),this.messageQueues.delete(t))}createIsolated(e,s,i){const o=`isolated:${e}:${s}`,r=this.getEndpointPath(e,s);this.debug&&console.log(`[WebSocketManager] Creating isolated connection: ${o}`);const a=this.isolatedConnections[e].get(s);if(a&&a.readyState===WebSocket.OPEN)return a;let n=t(r);if(i?.params){n+=`?${new URLSearchParams(i.params).toString()}`}const l=new WebSocket(n,i?.protocols);return this.updateConnectionStatus(o,{endpoint:r,status:"connecting",reconnectAttempts:0}),this.setupWebSocketHandlers(l,o,e,s),this.isolatedConnections[e].set(s,l),"terminals"!==e&&"executions"!==e||this.startHealthMonitoring(o),l}closeIsolated(e,t){const s=`isolated:${e}:${t}`,i=this.isolatedConnections[e].get(t);i&&(this.debug&&console.log(`[WebSocketManager] Closing isolated connection: ${s}`),this.stopHealthMonitoring(s),this.cancelReconnection(s),i.close(1e3,"Normal closure"),this.isolatedConnections[e].delete(t),this.connectionStatus.delete(s),this.messageQueues.delete(s))}setupWebSocketHandlers(e,t,s,i){e.addEventListener("open",()=>{if(this.debug&&console.log(`[WebSocketManager] Connection opened: ${t}`),this.updateConnectionStatus(t,{...this.getConnectionStatus(t),status:"connected",lastConnected:Date.now(),lastActivityAt:Date.now(),reconnectAttempts:0,messageCount:0}),o.isAuthenticated()){const t=o.getToken();t&&e.send(JSON.stringify({type:"auth",payload:{token:t}}))}this.processQueuedMessages(t),this.emitEvent({type:ac.CONNECTED,connectionId:t,timestamp:Date.now()})}),e.addEventListener("message",e=>{try{const s="string"==typeof e.data?JSON.parse(e.data):e.data,i=this.getConnectionStatus(t);i&&(i.messageCount=(i.messageCount||0)+1,i.lastActivityAt=Date.now());try{r("ws_message_total"),r(`ws_message_${t}`)}catch{}this.routeMessage(t,s),this.emitEvent({type:ac.MESSAGE,connectionId:t,data:s,timestamp:Date.now()})}catch(s){console.error(`[WebSocketManager] Failed to parse message: ${t}`,s)}}),e.addEventListener("error",e=>{console.error(`[WebSocketManager] Connection error: ${t}`,e),this.updateConnectionStatus(t,{...this.getConnectionStatus(t),status:"error",lastError:new Error("WebSocket error")}),this.emitEvent({type:ac.ERROR,connectionId:t,error:new Error("WebSocket error"),timestamp:Date.now()})}),e.addEventListener("close",e=>{this.debug&&console.log(`[WebSocketManager] Connection closed: ${t}`,{code:e.code,reason:e.reason}),this.updateConnectionStatus(t,{...this.getConnectionStatus(t),status:"disconnected",lastDisconnected:Date.now()}),this.emitEvent({type:ac.DISCONNECTED,connectionId:t,timestamp:Date.now()}),1e3!==e.code&&this.scheduleReconnection(t,s,i)})}scheduleReconnection(e,t,s){try{r("ws_reconnect_total"),r(`ws_reconnect_${e}`)}catch{}const i=this.getConnectionStatus(e);if(!i)return;const o=this.getReconnectStrategy(t);if(i.reconnectAttempts>=o.maxAttempts)return void console.error(`[WebSocketManager] Max reconnection attempts reached: ${e}`);let a=Math.min(o.initialDelay*Math.pow(o.backoffMultiplier,i.reconnectAttempts),o.maxDelay);o.jitter&&(a*=.5+.5*Math.random()),this.debug&&console.log(`[WebSocketManager] Scheduling reconnection: ${e} in ${a}ms`),this.updateConnectionStatus(e,{...i,status:"reconnecting",reconnectAttempts:i.reconnectAttempts+1}),this.emitEvent({type:ac.RECONNECTING,connectionId:e,data:{attempt:i.reconnectAttempts+1,delay:a},timestamp:Date.now()});const n=setTimeout(()=>{if(this.reconnectTimers.delete(e),e.startsWith("shared:")){const e=t;this.createSharedConnection(e)}else if(s){const e=t;this.createIsolated(e,s)}},a);this.reconnectTimers.set(e,n)}cancelReconnection(e){const t=this.reconnectTimers.get(e);t&&(clearTimeout(t),this.reconnectTimers.delete(e))}routeMessage(e,t){const s=this.messageRouters.get(e);s&&s.forEach(e=>{try{if(e.messageType){if(!(Array.isArray(e.messageType)?e.messageType:[e.messageType]).includes(t.type))return}if(e.filter&&!e.filter(t))return;e.handler(t)}catch(s){console.error(`[WebSocketManager] Router error: ${e.routeId}`,s),e.onError&&e.onError(s)}})}getConnectionStatus(e){return this.connectionStatus.get(e)}updateConnectionStatus(e,t){this.connectionStatus.set(e,t),this.updateConnectionHealth()}send(e,t){const s=this.getWebSocket(e);if(s&&s.readyState===WebSocket.OPEN){const e="string"==typeof t?t:JSON.stringify(t);s.send(e)}else this.queueMessage(e,t)}queueMessage(e,t){this.messageQueues.has(e)||this.messageQueues.set(e,[]);const s=this.messageQueues.get(e);s.length>=100&&(console.warn(`[WebSocketManager] Message queue full: ${e}`),this.emitEvent({type:ac.QUEUE_FULL,connectionId:e,timestamp:Date.now()}),s.shift()),s.push({message:t,timestamp:Date.now(),attempts:0})}processQueuedMessages(e){const t=this.messageQueues.get(e);if(!t||0===t.length)return;const s=this.getWebSocket(e);if(s&&s.readyState===WebSocket.OPEN)for(this.debug&&console.log(`[WebSocketManager] Processing ${t.length} queued messages: ${e}`);t.length>0;){const e=t.shift(),i="string"==typeof e.message?e.message:JSON.stringify(e.message);s.send(i)}}async reconnect(e){const t=this.getWebSocket(e);if(t&&t.close(1e3,"Manual reconnection"),await new Promise(e=>setTimeout(e,100)),e.startsWith("shared:")){const t=e.split(":")[1];this.createSharedConnection(t)}else if(e.startsWith("isolated:")){const[,t,s]=e.split(":");t&&s&&this.createIsolated(t,s)}}closeAll(){this.debug&&console.log("[WebSocketManager] Closing all connections"),Object.keys(this.sharedConnections).forEach(e=>{this.closeSharedConnection(e)}),Object.entries(this.isolatedConnections).forEach(([e,t])=>{t.forEach((t,s)=>{this.closeIsolated(e,s)})}),this.connectionStatus.clear(),this.messageRouters.clear(),this.messageQueues.clear(),this.reconnectTimers.forEach(e=>clearTimeout(e)),this.reconnectTimers.clear(),this.healthCheckIntervals.forEach(e=>clearInterval(e)),this.healthCheckIntervals.clear()}getWebSocket(e){if(e.startsWith("shared:")){const t=e.split(":")[1];return this.sharedConnections[t]}if(e.startsWith("isolated:")){const[,t,s]=e.split(":");return t&&s&&this.isolatedConnections[t]?.get(s)||null}return null}getEndpointPath(e,t){return{events:"/ws/events",notifications:"/ws/notifications",terminals:"/ws/terminal"+(t?`?id=${t}`:""),fileTransfers:"/ws/upload"+(t?`?id=${t}`:""),executions:"/ws/ansible-exec"+(t?`?id=${t}`:""),containerLogs:"/ws/container/logs"+(t?`?id=${t}`:"")}[e]||"/ws/default"}getReconnectStrategy(e){return this.reconnectStrategies.get(e)||this.reconnectStrategies.get("default")||nc.default||nc.default}startHealthMonitoring(e){this.stopHealthMonitoring(e);const t=setInterval(()=>{const t=this.getWebSocket(e),s=this.getConnectionStatus(e);if(!t||!s)return;if("connected"!==s.status)return;if(t.readyState===WebSocket.OPEN)try{t.send(JSON.stringify({type:"ping"}))}catch(o){this.debug&&console.error(`[WebSocketManager] Failed to send ping: ${e}`,o)}const i=s.lastActivityAt??s.lastConnected??0;i&&Date.now()-i>18e4&&(this.debug&&console.warn(`[WebSocketManager] Stale connection detected: ${e}`),this.reconnect(e))},3e4);this.healthCheckIntervals.set(e,t)}stopHealthMonitoring(e){const t=this.healthCheckIntervals.get(e);t&&(clearInterval(t),this.healthCheckIntervals.delete(e))}emitEvent(e){window.dispatchEvent(new CustomEvent("websocket:event",{detail:e}))}updateConnectionHealth(){const e=[];this.connectionStatus.forEach((t,s)=>{e.push({connectionId:s,status:t.status,reconnectCount:t.reconnectAttempts,lastError:t.lastError?.message})}),cc.set(e)}}.getInstance(),cc=Be([]);ze(cc,e=>e.filter(e=>"connected"===e.status).length),ze(cc,e=>e.length),i(()=>{const e={};try{const t=cc.get();e.ws_connections=t.length,e.ws_reconnecting=t.filter(e=>"reconnecting"===e.status).length,e.ws_errors=t.filter(e=>e.lastError).length}catch{}return e});const dc="shared:events";function hc(e){const t=()=>{lc.send(dc,{type:"subscribe",payload:{channel:e.channel,...e.subscribePayload||{}}})},s={routeId:e.routeId,messageType:e.messageType??"event",handler:t=>{e.onEvent(t.payload,t)}},i=lc.subscribeToShared("events",s);t();const o=lc.getConnectionStatus(dc);e.onConnectionChange?.("connected"===o?.status);const r=s=>{const i=s.detail;i&&i.connectionId===dc&&(i.type===ac.CONNECTED?(e.onConnectionChange?.(!0),t()):i.type!==ac.DISCONNECTED&&i.type!==ac.ERROR&&i.type!==ac.RECONNECTING||e.onConnectionChange?.(!1))};return window.addEventListener("websocket:event",r),()=>{try{lc.send(dc,{type:"unsubscribe",payload:{channel:e.channel}})}catch(t){console.warn("Failed to send unsubscribe:",t)}window.removeEventListener("websocket:event",r),i()}}class uc extends Error{constructor(e,t,s,i){super(e),this.code=t,this.details=s,this.status=i,this.name="ApiError"}}class pc{static async request(t,s={}){const{method:i="GET",body:o,headers:a={},params:n}=s;try{r("http_total"),t.startsWith("/virtualization")?r("http_virtualization"):t.startsWith("/system")?r("http_system"):t.startsWith("/kubernetes")&&r("http_kubernetes")}catch{}let l=e(t);if(n){const e=new URLSearchParams(Object.entries(n).map(([e,t])=>[e,String(t)])).toString();e&&(l+=`?${e}`)}const c="/auth/login"===t?{}:tt(),d={"Content-Type":"application/json",...c,...a};console.log("[API Request]",i,l,{headers:d,hasAuth:!!c.Authorization});try{const e=await fetch(l,{method:i,headers:d,body:o?JSON.stringify(o):void 0}),t=e.headers||{},s="function"==typeof t.get?t.get("content-type"):void 0;if(s&&!s.includes("application/json")){if(!e.ok)throw new uc(`HTTP error! status: ${e.status}`,void 0,void 0,e.status);return await e.text()}const r=await e.json();if(!e.ok||"error"===r.status)throw new uc(r.error?.message||"An error occurred",r.error?.code,r.error?.details,e.status);return r.data}catch(h){if(h instanceof uc)throw h;throw new uc(h instanceof Error?h.message:"Network error","NETWORK_ERROR")}}static get(e,t){return this.request(e,{method:"GET",params:t})}static post(e,t){return this.request(e,{method:"POST",body:t})}static put(e,t){return this.request(e,{method:"PUT",body:t})}static delete(e,t){return this.request(e,{method:"DELETE",params:t})}static patch(e,t){return this.request(e,{method:"PATCH",body:t})}static async postResource(t,s,i){const o=tt(),r=e(t);try{const e=await fetch(r,{method:"POST",headers:{"Content-Type":i,...o},body:s}),t=e.headers||{},a="function"==typeof t.get?t.get("content-type"):void 0;if(a&&!a.includes("application/json")){if(!e.ok)throw new uc(`HTTP error! status: ${e.status}`,void 0,void 0,e.status);return await e.text()}const n=await e.json();if(!e.ok||"error"===n.status)throw new uc(n.error?.message||"An error occurred",n.error?.code,n.error?.details,e.status);return n.data}catch(a){if(a instanceof uc)throw a;throw new uc(a instanceof Error?a.message:"Network error","NETWORK_ERROR")}}static async putResource(t,s,i){const o=tt(),r=e(t);try{const e=await fetch(r,{method:"PUT",headers:{"Content-Type":i,...o},body:s}),t=e.headers||{},a="function"==typeof t.get?t.get("content-type"):void 0;if(a&&!a.includes("application/json")){if(!e.ok)throw new uc(`HTTP error! status: ${e.status}`,void 0,void 0,e.status);return await e.text()}const n=await e.json();if(!e.ok||"error"===n.status)throw new uc(n.error?.message||"An error occurred",n.error?.code,n.error?.details,e.status);return n.data}catch(a){if(a instanceof uc)throw a;throw new uc(a instanceof Error?a.message:"Network error","NETWORK_ERROR")}}}class gc{constructor(e="/ws"){this.path=e,this.ws=null,this.reconnectInterval=5e3,this.maxReconnectAttempts=5,this.reconnectAttempts=0,this.messageHandlers=/* @__PURE__ */new Map,this.reconnectTimer=null,this.intentionalDisconnect=!1}connect(){return new Promise((e,s)=>{try{this.intentionalDisconnect=!1,this.ws=new WebSocket(t(this.path)),this.ws.onopen=()=>{console.log(`WebSocket connected to ${this.path}`),this.reconnectAttempts=0,this.authenticate().then(()=>{e()}).catch(s)},this.ws.onmessage=e=>{try{const t=JSON.parse(e.data);this.handleMessage(t)}catch(t){console.error("Failed to parse WebSocket message:",t)}},this.ws.onerror=e=>{console.error("WebSocket error:",e),s(e)},this.ws.onclose=e=>{console.log("WebSocket closed",{code:e.code,reason:e.reason}),this.intentionalDisconnect||1e3===e.code?console.log("WebSocket closed intentionally or normally, not reconnecting"):this.scheduleReconnect()}}catch(i){s(i)}})}async authenticate(){const e=Qe.get();if(!e)throw new Error("No authentication token available");return new Promise((t,s)=>{const i=setTimeout(()=>{s(new Error("Authentication timeout"))},5e3),o=e=>{"auth"===e.type&&!0===e.payload?.authenticated&&(clearTimeout(i),this.off("auth",o),this.off("error",r),console.log(`WebSocket authenticated as ${e.payload.username}`),t())},r=e=>{"error"===e.type&&"AUTH_FAILED"===e.code&&(clearTimeout(i),this.off("auth_success",o),this.off("error",r),s(new Error(e.error||"Authentication failed")))};this.on("auth",o),this.on("error",r),this.send({type:"auth",payload:{token:e}})})}scheduleReconnect(){this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectAttempts<this.maxReconnectAttempts&&(this.reconnectAttempts++,console.log(`Scheduling reconnect attempt ${this.reconnectAttempts}...`),this.reconnectTimer=window.setTimeout(()=>{Ge.get()&&this.connect().catch(console.error)},this.reconnectInterval))}handleMessage(e){const t=this.messageHandlers.get(e.type);t&&t.forEach(t=>t(e)),"error"===e.type&&console.error("WebSocket error:",e.error)}send(e){this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(e)):console.error("WebSocket is not connected")}on(e,t){this.messageHandlers.has(e)||this.messageHandlers.set(e,/* @__PURE__ */new Set),this.messageHandlers.get(e).add(t)}off(e,t){const s=this.messageHandlers.get(e);s&&s.delete(t)}disconnect(){this.intentionalDisconnect=!0,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws&&(this.ws.close(1e3,"Normal closure"),this.ws=null),this.messageHandlers.clear()}isConnected(){return null!==this.ws&&this.ws.readyState===WebSocket.OPEN}}const mc=pc,fc=60,vc=rc("vapor.metrics.systemSummary",null,{encode:JSON.stringify,decode:JSON.parse}),bc=rc("vapor.metrics.cpuInfo",null,{encode:JSON.stringify,decode:JSON.parse}),yc=rc("vapor.metrics.memoryInfo",null,{encode:JSON.stringify,decode:JSON.parse}),wc=Be(null),xc=Be(null),_c=Be(null),kc=Be(null),Sc=Be([]),Cc=Be([]),$c=Be([]),Dc=Be([]),Ec=Be(!1),Mc=Be(null),Ac=Be(null),Ic=ze(wc,e=>e?.usage_percent??0),Tc=ze(xc,e=>e?.used_percent??0);ze(xc,e=>e?.available??0),ze(wc,e=>({load1:e?.load1??0,load5:e?.load5??0,load15:e?.load15??0}));const Pc=ze(Sc,e=>{if(e.length<2)return"stable";const t=e.slice(-10),s=t.reduce((e,t)=>e+t.value,0)/t.length,i=t[t.length-1]?.value??0;return i>s+10?"increasing":i<s-10?"decreasing":"stable"}),Lc=ze(Cc,e=>{if(e.length<2)return"stable";const t=e.slice(-10),s=t.reduce((e,t)=>e+t.value,0)/t.length,i=t[t.length-1]?.value??0;return i>s+10?"increasing":i<s-10?"decreasing":"stable"}),Rc=ze([Ic,Tc],(e,t)=>{const s=[];return e>90?s.push({type:"error",message:`CPU usage critical: ${e.toFixed(1)}%`}):e>75&&s.push({type:"warning",message:`CPU usage high: ${e.toFixed(1)}%`}),t>90?s.push({type:"error",message:`Memory usage critical: ${t.toFixed(1)}%`}):t>75&&s.push({type:"warning",message:`Memory usage high: ${t.toFixed(1)}%`}),s}),Oc=ze([vc,bc,yc,wc,xc,_c,kc,Sc,Cc,$c,Dc,Ec,Mc,Ac],(e,t,s,i,o,r,a,n,l,c,d,h,u,p)=>({systemSummary:e,cpuInfo:t,memoryInfo:s,currentCpu:i,currentMemory:o,currentDisk:r,currentNetwork:a,cpuHistory:n,memoryHistory:l,diskHistory:c,networkHistory:d,isConnected:h,lastUpdate:u,error:p}));function Nc(e,t,s=fc){const i=e.get(),o=Date.now(),r=new Date(o).toLocaleTimeString(),a=i.slice();a.push({timestamp:o,value:t,label:r}),a.length>s&&a.splice(0,a.length-s),e.set(a)}function Bc(e){wc.set(e),Nc(Sc,e.usage_percent),Mc.set(Date.now())}function Fc(e){xc.set(e),Nc(Cc,e.used_percent),Mc.set(Date.now())}function zc(e){if(_c.set(e),e&&e.disks&&e.disks.length>0){const t=e.disks.reduce((e,t)=>e+t.used_percent,0)/e.disks.length;Nc($c,t)}Mc.set(Date.now())}function Uc(e){if(kc.set(e),e&&e.interfaces&&e.interfaces.length>0){const t=e.interfaces.reduce((e,t)=>e+t.rx_bytes_per_sec+t.tx_bytes_per_sec,0);Nc(Dc,t/1024/1024)}Mc.set(Date.now())}async function Vc(){const{auth:e}=await import("./index-BUiOeSBK.js").then(e=>e.d);if(e.isAuthenticated())try{const[e,t,s]=await Promise.all([pc.get("/system/summary"),pc.get("/system/cpu"),pc.get("/system/memory")]);vc.set(e),bc.set(t),yc.set(s),Ac.set(null)}catch(t){const e=t instanceof Error?t.message:"Failed to fetch system info";Ac.set(e),console.error("Failed to fetch system info:",t)}else console.log("[MetricsStore] User not authenticated, skipping system info fetch")}function jc(e){switch(e){case"cpu":return Sc.get();case"memory":return Cc.get();case"disk":return $c.get();case"network":return Dc.get();default:return[]}}function Hc(e,t=6e4){const s=jc(e),i=Date.now()-t,o=s.filter(e=>e.timestamp>=i);return 0===o.length?0:o.reduce((e,t)=>e+t.value,0)/o.length}let Wc=null;async function qc(){const{auth:e}=await import("./index-BUiOeSBK.js").then(e=>e.d);if(!e.isAuthenticated())return;if(Wc)return void lc.forceReconnectShared("events");const t=/* @__PURE__ */new Map;Wc=hc({channel:"metrics",routeId:"metrics-store",onConnectionChange:e=>{Ec.set(e),e||Ac.set(null)},onEvent:e=>{const s=e?.kind;if(s&&"metrics"!==s)return;const i=e?.data??e;if(i){try{r("metrics_data")}catch{}if(i.cpu){const e=Array.isArray(i.cpu.load_average)?i.cpu.load_average:[],t=(Array.isArray(i.cpu.per_core)?i.cpu.per_core:[]).map((e,t)=>({core:t,usage_percent:e}));Bc({usage_percent:Number(i.cpu.usage??0),load1:Number(e[0]??0),load5:Number(e[1]??0),load15:Number(e[2]??0),cores:t})}if(i.memory){const e=Number(i.memory.swap_total??0),t=Number(i.memory.swap_used??0),s=e>0?t/e*100:0;Fc({total:Number(i.memory.total??0),used:Number(i.memory.used??0),free:Number(i.memory.free??0),available:Number(i.memory.available??0),used_percent:Number(i.memory.used_percent??0),swap_total:e,swap_used:t,swap_free:Number(i.memory.swap_free??0),swap_used_percent:s})}if(Array.isArray(i.disk)){zc({disks:i.disk.map(e=>({device:String(e.device??""),mount_point:String(e.mountpoint??e.mount_point??""),filesystem:String(e.fstype??e.filesystem??""),total:Number(e.total??0),used:Number(e.used??0),free:Number(e.free??0),used_percent:Number(e.used_percent??0)}))})}if(Array.isArray(i.network)){const e=Date.now(),s=e=>{const t=Number(e);return Number.isFinite(t)?t:0};Uc({interfaces:i.network.map(i=>{const o=String(i.interface??i.name??""),r=s(i.rx_bytes_per_sec??i.rxBytesPerSec??i.bytes_recv_per_sec??i.bytesRecvPerSec),a=s(i.tx_bytes_per_sec??i.txBytesPerSec??i.bytes_sent_per_sec??i.bytesSentPerSec),n=s(i.rx_packets_per_sec??i.rxPacketsPerSec??i.packets_recv_per_sec??i.packetsRecvPerSec),l=s(i.tx_packets_per_sec??i.txPacketsPerSec??i.packets_sent_per_sec??i.packetsSentPerSec),c=s(i.bytes_recv??i.rx_bytes??i.rxBytes??i.rxbytes),d=s(i.bytes_sent??i.tx_bytes??i.txBytes??i.txbytes),h=s(i.packets_recv??i.rx_packets??i.rxPackets??i.rxpackets),u=s(i.packets_sent??i.tx_packets??i.txPackets??i.txpackets);let p=r,g=a,m=n,f=l;if(o&&(0===p||0===g||0===m||0===f)){const s=t.get(o);if(s){const t=Math.max(.001,(e-s.ts)/1e3),i=c>=s.rxBytes?c-s.rxBytes:0,o=d>=s.txBytes?d-s.txBytes:0,r=h>=s.rxPackets?h-s.rxPackets:0,a=u>=s.txPackets?u-s.txPackets:0;0===p&&(p=i/t),0===g&&(g=o/t),0===m&&(m=r/t),0===f&&(f=a/t)}t.set(o,{ts:e,rxBytes:c,txBytes:d,rxPackets:h,txPackets:u})}return{name:o,rx_bytes_per_sec:p,tx_bytes_per_sec:g,rx_packets_per_sec:m,tx_packets_per_sec:f,rx_errors:s(i.errin??i.rx_errors??i.rxErrors),tx_errors:s(i.errout??i.tx_errors??i.txErrors),rx_dropped:s(i.dropin??i.rx_dropped??i.rxDropped),tx_dropped:s(i.dropout??i.tx_dropped??i.txDropped)}})})}Ac.set(null)}}}),vc.get()||Vc()}function Kc(){Wc&&(console.log("[MetricsStore] Disconnecting from metrics WebSocket"),Wc(),Wc=null,Ec.set(!1))}async function Gc(){const{auth:e}=await import("./index-BUiOeSBK.js").then(e=>e.d);e.isAuthenticated()?(console.log("[MetricsStore] Initializing metrics store"),await Vc(),await qc()):console.log("[MetricsStore] User not authenticated, skipping initialization")}function Qc(){Kc()}function Jc(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB"][t]}function Yc(e){const t=Math.floor(e/86400),s=Math.floor(e%86400/3600),i=Math.floor(e%3600/60),o=[];return t>0&&o.push(`${t} days`),s>0&&o.push(`${s} hours`),i>0&&o.push(`${i} minutes`),o.join(", ")||"0 minutes"}"undefined"!=typeof window&&window.addEventListener("beforeunload",Qc),i(()=>{const e={};try{const t=Oc.get();e.metrics_cpuHistory=t.cpuHistory.length,e.metrics_memoryHistory=t.memoryHistory.length,e.metrics_diskHistory=t.diskHistory.length,e.metrics_networkHistory=t.networkHistory.length}catch{}return e});const Xc=/* @__PURE__ */Object.freeze(/* @__PURE__ */Object.defineProperty({__proto__:null,$cpuHistory:Sc,$cpuInfo:bc,$cpuTrend:Pc,$cpuUsage:Ic,$currentCpu:wc,$currentDisk:_c,$currentMemory:xc,$currentNetwork:kc,$diskHistory:$c,$lastMetricUpdate:Mc,$memoryHistory:Cc,$memoryInfo:yc,$memoryTrend:Lc,$memoryUsage:Tc,$metricsAlerts:Rc,$metricsConnected:Ec,$metricsError:Ac,$metricsState:Oc,$networkHistory:Dc,$systemSummary:vc,calculateAverage:Hc,cleanupMetrics:Qc,connectMetrics:qc,disconnectMetrics:Kc,fetchSystemInfo:Vc,formatBytes:Jc,formatUptime:Yc,getMetricHistory:jc,initializeMetrics:Gc,reinitializeMetricsAfterLogin:async function(){console.log("[MetricsStore] Re-initializing after login"),Ac.set(null),Ec.set(!1),Kc(),wc.set(null),xc.set(null),_c.set(null),kc.set(null),await new Promise(e=>setTimeout(e,200)),await Gc()},updateCpuMetrics:Bc,updateDiskMetrics:zc,updateMemoryMetrics:Fc,updateNetworkMetrics:Uc},Symbol.toStringTag,{value:"Module"}));var Zc=Object.getOwnPropertyDescriptor;let ed=class extends(function(e){return class extends e{constructor(...e){super(...e),this.storeControllers=/* @__PURE__ */new Map,this._storeIdCounter=0,this._debug=!1,this._autoUnsubscribe=!0}subscribeToStore(e,t){const s="store_"+ ++this._storeIdCounter;this._debug&&console.log(`[StoreMixin] Subscribing to store: ${s}`);const i=new ec(this,e,t);return this.storeControllers.set(s,i),t?.property&&Object.defineProperty(this,t.property,{get:()=>i.value,configurable:!0}),i}unsubscribeFromStore(e){for(const[t,s]of this.storeControllers.entries())if(s===e){this._debug&&console.log(`[StoreMixin] Unsubscribing from store: ${t}`),this.storeControllers.delete(t);break}}getStoreValue(e){return e.get()}setStoreValue(e,t){e.set(t),this._debug&&console.log("[StoreMixin] Store value updated:",t)}cleanupStores(){this._debug&&console.log(`[StoreMixin] Cleaning up ${this.storeControllers.size} store subscriptions`),this.storeControllers.clear()}connectedCallback(){super.connectedCallback(),this._debug&&console.log("[StoreMixin] Component connected")}disconnectedCallback(){this._autoUnsubscribe&&this.cleanupStores(),this._debug&&console.log("[StoreMixin] Component disconnected"),super.disconnectedCallback()}firstUpdated(e){super.firstUpdated(e),this._debug&&console.log("[StoreMixin] Component first updated")}}}(dt)){constructor(){super(...arguments),this.cpuChart=null,this.memoryChart=null,this.updateThrottle=null,this.lastChartUpdate=0,this.CHART_UPDATE_INTERVAL=2e3,this.systemSummary=this.subscribeToStore(vc),this.cpuInfo=this.subscribeToStore(bc),this.memoryInfo=this.subscribeToStore(yc),this.currentCpu=this.subscribeToStore(wc),this.currentMemory=this.subscribeToStore(xc),this.cpuHistory=this.subscribeToStore(Sc),this.memoryHistory=this.subscribeToStore(Cc),this.metricsConnected=this.subscribeToStore(Ec),this.metricsError=this.subscribeToStore(Ac),this.cpuUsage=this.subscribeToStore(Ic),this.memoryUsage=this.subscribeToStore(Tc),this.cpuTrend=this.subscribeToStore(Pc),this.memoryTrend=this.subscribeToStore(Lc),this.metricsAlerts=this.subscribeToStore(Rc),this.handleThemeChange=e=>{this.updateChartTheme(e.detail.theme)}}async connectedCallback(){super.connectedCallback();const{auth:e}=await import("./index-BUiOeSBK.js").then(e=>e.d);if(e.isAuthenticated()){await new Promise(e=>setTimeout(e,500));try{await qc()}catch(t){console.error("[DashboardTabV2] Failed to connect metrics:",t)}}window.addEventListener("theme-changed",this.handleThemeChange)}disconnectedCallback(){super.disconnectedCallback(),this.cleanup(),window.removeEventListener("theme-changed",this.handleThemeChange)}firstUpdated(){this.initCharts(),this.updateChartsFromHistory()}updated(e){if(super.updated(e),this.cpuChart&&this.memoryChart){const e=Date.now();e-this.lastChartUpdate>=this.CHART_UPDATE_INTERVAL?(this.lastChartUpdate=e,this.updateChartsFromHistory()):this.updateThrottle||(this.updateThrottle=window.setTimeout(()=>{this.updateThrottle=null,this.lastChartUpdate=Date.now(),this.updateChartsFromHistory()},this.CHART_UPDATE_INTERVAL-(e-this.lastChartUpdate)))}}cleanup(){this.updateThrottle&&(clearTimeout(this.updateThrottle),this.updateThrottle=null),this.cpuChart&&(this.cpuChart.destroy(),this.cpuChart=null),this.memoryChart&&(this.memoryChart.destroy(),this.memoryChart=null)}initCharts(){const e=this.shadowRoot?.querySelector("#cpuChart"),t=this.shadowRoot?.querySelector("#memoryChart");if(!e||!t)return;const s=this.cpuHistory.value||[],i="dark"===a.getTheme(),o=i?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)",r=i?"#cccccc":"#666666";this.cpuChart=new Va(e,{type:"line",data:{labels:s.map(e=>e.label||""),datasets:[{label:n("dashboard.cpuUsage"),data:s.map(e=>e.value),borderColor:"rgba(75, 192, 192, 1)",backgroundColor:"rgba(75, 192, 192, 0.1)",tension:.1,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{display:!0,grid:{color:o},ticks:{color:r,maxTicksLimit:10,autoSkip:!0}},y:{beginAtZero:!0,max:100,grid:{color:o},ticks:{color:r,callback:e=>`${e}%`}}}}});const l=this.memoryHistory.value||[];this.memoryChart=new Va(t,{type:"line",data:{labels:l.map(e=>e.label||""),datasets:[{label:n("dashboard.memoryUsage"),data:l.map(e=>e.value),borderColor:"rgba(153, 102, 255, 1)",backgroundColor:"rgba(153, 102, 255, 0.1)",tension:.1,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{display:!0,grid:{color:o},ticks:{color:r,maxTicksLimit:10,autoSkip:!0}},y:{beginAtZero:!0,max:100,grid:{color:o},ticks:{color:r,callback:e=>`${e}%`}}}}})}updateChartTheme(e){if(!this.cpuChart&&!this.memoryChart)return;const t="dark"===e,s=t?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)",i=t?"#cccccc":"#666666",o=e=>{e&&(e.options.scales&&e.options.scales.x&&(e.options.scales.x.grid={...e.options.scales.x.grid,color:s},e.options.scales.x.ticks={...e.options.scales.x.ticks,color:i}),e.options.scales&&e.options.scales.y&&(e.options.scales.y.grid={...e.options.scales.y.grid,color:s},e.options.scales.y.ticks={...e.options.scales.y.ticks,color:i,callback:e=>`${e}%`}),e.update("none"))};o(this.cpuChart),o(this.memoryChart)}updateChartsFromHistory(){if(this.cpuChart&&this.cpuHistory.value){const e=this.cpuHistory.value;this.cpuChart.data.labels=e.map(e=>e.label||""),this.cpuChart.data.datasets[0]&&(this.cpuChart.data.datasets[0].data=e.map(e=>e.value)),this.cpuChart.update("none")}if(this.memoryChart&&this.memoryHistory.value){const e=this.memoryHistory.value;this.memoryChart.data.labels=e.map(e=>e.label||""),this.memoryChart.data.datasets[0]&&(this.memoryChart.data.datasets[0].data=e.map(e=>e.value)),this.memoryChart.update("none")}}renderTrendIndicator(e){return J`
      <span class="trend-indicator ${e}">
        <span class="trend-arrow">${{increasing:"â",decreasing:"â",stable:"â"}[e]}</span>
        ${{increasing:"Increasing",decreasing:"Decreasing",stable:"Stable"}[e]}
      </span>
    `}render(){return J`
      <div class="dashboard">
        <!-- Header with title and connection status -->
        <div class="dashboard-header">
          <h1>${n("dashboard.title")}</h1>
          <div class="connection-status ${this.metricsConnected.value?"connected":"disconnected"}">
            <span class="status-dot ${this.metricsConnected.value?"connected":"disconnected"}"></span>
            ${this.metricsConnected.value?"Connected":"Disconnected"}
          </div>
        </div>
        
        <!-- Alerts Section -->
        ${this.metricsAlerts.value&&this.metricsAlerts.value.length>0?J`
          <div class="alerts-section">
            ${this.metricsAlerts.value.map(e=>J`
              <div class="alert ${e.type}">
                <span class="alert-icon">â ï¸</span>
                ${e.message}
              </div>
            `)}
          </div>
        `:""}

        <!-- System Info Cards -->
        ${this.systemSummary.value?J`
          <div class="system-info">
            <div class="info-card">
              <h3>${n("dashboard.overview")}</h3>
              <div class="info-grid">
                <span class="info-label">${n("dashboard.hostname")}:</span>
                <span class="info-value">${this.systemSummary.value.hostname}</span>
                
                <span class="info-label">${n("dashboard.os")}:</span>
                <span class="info-value">${this.systemSummary.value.os}</span>
                
                <span class="info-label">${n("dashboard.kernel")}:</span>
                <span class="info-value">${this.systemSummary.value.kernel_version}</span>
                
                <span class="info-label">${n("dashboard.uptime")}:</span>
                <span class="info-value">${Yc(this.systemSummary.value.uptime)}</span>
                
                <span class="info-label">${n("dashboard.architecture")}:</span>
                <span class="info-value">${this.systemSummary.value.platform}</span>
              </div>
            </div>
            
            ${this.cpuInfo.value?J`
              <div class="info-card">
                <h3>${n("dashboard.cpu")}</h3>
                <div class="info-grid">
                  <span class="info-label">Model:</span>
                  <span class="info-value">${this.cpuInfo.value.model_name}</span>
                  
                  <span class="info-label">Cores:</span>
                  <span class="info-value">${this.cpuInfo.value.cores}</span>
                  
                  <span class="info-label">${n("dashboard.loadAverage")}:</span>
                  <span class="info-value">
                    ${this.cpuInfo.value.load1.toFixed(2)}, 
                    ${this.cpuInfo.value.load5.toFixed(2)}, 
                    ${this.cpuInfo.value.load15.toFixed(2)}
                  </span>
                  
                  ${this.currentCpu.value?J`
                    <span class="info-label">Current Usage:</span>
                    <span class="info-value">${this.currentCpu.value.usage_percent.toFixed(1)}%</span>
                  `:""}
                </div>
              </div>
            `:""}
            
            ${this.memoryInfo.value?J`
              <div class="info-card">
                <h3>${n("dashboard.memory")}</h3>
                <div class="info-grid">
                  <span class="info-label">Total:</span>
                  <span class="info-value">${Jc(this.memoryInfo.value.total)}</span>
                  
                  <span class="info-label">Used:</span>
                  <span class="info-value">
                    ${Jc(this.memoryInfo.value.used)} 
                    (${this.memoryInfo.value.used_percent.toFixed(1)}%)
                  </span>
                  
                  <span class="info-label">Free:</span>
                  <span class="info-value">${Jc(this.memoryInfo.value.free)}</span>
                  
                  ${this.currentMemory.value?J`
                    <span class="info-label">Available:</span>
                    <span class="info-value">${Jc(this.currentMemory.value.available)}</span>
                  `:""}
                </div>
              </div>
            `:""}
          </div>
        `:J`
          <div class="loading">${n("common.loading")}</div>
        `}
        
        <!-- Metrics Charts -->
        <div class="metrics-section">
          <div class="metrics-grid">
            <!-- CPU Chart -->
            <div class="metric-card">
              <div class="metric-header">
                <h3 class="metric-title">
                  ${n("dashboard.cpuUsage")}
                  ${this.renderTrendIndicator(this.cpuTrend.value)}
                </h3>
                ${this.currentCpu.value?J`
                  <div>
                    <div class="metric-value">${this.cpuUsage.value.toFixed(1)}%</div>
                    <div class="metric-subtitle">
                      Load: ${this.currentCpu.value.load1.toFixed(2)}
                    </div>
                  </div>
                `:""}
              </div>
              <div class="chart-container">
                <canvas id="cpuChart"></canvas>
              </div>
              <div class="metric-stats">
                <div class="stat-item">
                  <span class="stat-label">1m Avg</span>
                  <span class="stat-value">${Hc("cpu",6e4).toFixed(1)}%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">5m Avg</span>
                  <span class="stat-value">${Hc("cpu",3e5).toFixed(1)}%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Data Points</span>
                  <span class="stat-value">${this.cpuHistory.value.length}/120</span>
                </div>
              </div>
            </div>
            
            <!-- Memory Chart -->
            <div class="metric-card">
              <div class="metric-header">
                <h3 class="metric-title">
                  ${n("dashboard.memoryUsage")}
                  ${this.renderTrendIndicator(this.memoryTrend.value)}
                </h3>
                ${this.currentMemory.value?J`
                  <div>
                    <div class="metric-value">${this.memoryUsage.value.toFixed(1)}%</div>
                    <div class="metric-subtitle">
                      ${Jc(this.currentMemory.value.used)} / 
                      ${Jc(this.currentMemory.value.total)}
                    </div>
                  </div>
                `:""}
              </div>
              <div class="chart-container">
                <canvas id="memoryChart"></canvas>
              </div>
              <div class="metric-stats">
                <div class="stat-item">
                  <span class="stat-label">1m Avg</span>
                  <span class="stat-value">${Hc("memory",6e4).toFixed(1)}%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">5m Avg</span>
                  <span class="stat-value">${Hc("memory",3e5).toFixed(1)}%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Data Points</span>
                  <span class="stat-value">${this.memoryHistory.value.length}/120</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Error Display -->
        ${this.metricsError.value?J`
          <div class="error">
            Error: ${this.metricsError.value}
          </div>
        `:""}
      </div>
    `}};ed.styles=g`
    :host {
      display: block;
      height: 100%;
      overflow-y: auto;
    }

    .dashboard {
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 300;
    }

    /* Alerts section */
    .alerts-section {
      margin-bottom: 20px;
    }

    .alert {
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 13px;
    }

    .alert.warning {
      background: rgba(255, 193, 7, 0.1);
      border: 1px solid rgba(255, 193, 7, 0.3);
      color: #ffc107;
    }

    .alert.error {
      background: rgba(244, 67, 54, 0.1);
      border: 1px solid rgba(244, 67, 54, 0.3);
      color: #f44336;
    }

    .alert-icon {
      font-size: 18px;
    }

    /* Connection status */
    .connection-status {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      background: var(--vscode-bg-light);
      border: 1px solid var(--vscode-border);
    }

    .connection-status.connected {
      border-color: rgba(76, 175, 80, 0.5);
      background: rgba(76, 175, 80, 0.05);
    }

    .connection-status.disconnected {
      border-color: rgba(244, 67, 54, 0.5);
      background: rgba(244, 67, 54, 0.05);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    .status-dot.connected {
      background: #4caf50;  /* Improved green color */
      box-shadow: 0 0 4px rgba(76, 175, 80, 0.4);
    }

    .status-dot.disconnected {
      background: #f44336;
      box-shadow: 0 0 4px rgba(244, 67, 54, 0.4);
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    /* Trend indicators */
    .trend-indicator {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 12px;
      background: var(--vscode-bg);
    }

    .trend-indicator.increasing {
      color: #f44336;
    }

    .trend-indicator.decreasing {
      color: #4caf50;
    }

    .trend-indicator.stable {
      color: var(--vscode-text-dim);
    }

    .trend-arrow {
      font-size: 10px;
    }

    /* Average display */
    .metric-stats {
      display: flex;
      gap: 16px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--vscode-border);
      font-size: 12px;
      color: var(--vscode-text-dim);
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .stat-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-value {
      color: var(--vscode-text);
      font-family: var(--vscode-font-family-mono);
      font-size: 13px;
    }

    /* Rest of the styles from original dashboard */
    .system-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .info-card {
      background: var(--vscode-bg-light);
      border: 1px solid var(--vscode-border);
      border-radius: 8px;
      padding: 16px;
    }

    .info-card h3 {
      margin: 0 0 12px 0;
      font-size: 14px;
      font-weight: 500;
      color: var(--vscode-text-dim);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .info-grid {
      display: grid;
      grid-template-columns: max-content 1fr;
      gap: 8px 16px;
      font-size: 13px;
    }

    .info-label {
      color: var(--vscode-text-dim);
    }

    .info-value {
      color: var(--vscode-text);
      font-family: var(--vscode-font-family-mono);
    }

    .metrics-section {
      margin-bottom: 24px;
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
    }

    .metric-card {
      background: var(--vscode-bg-light);
      border: 1px solid var(--vscode-border);
      border-radius: 8px;
      padding: 20px;
    }

    .metric-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .metric-title {
      font-size: 16px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .metric-value {
      font-size: 24px;
      font-weight: 300;
      color: var(--vscode-accent);
      font-family: var(--vscode-font-family-mono);
    }

    .metric-subtitle {
      font-size: 12px;
      color: var(--vscode-text-dim);
      margin-top: 4px;
    }

    .chart-container {
      height: 200px;
      position: relative;
    }

    canvas {
      max-width: 100%;
      max-height: 100%;
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 200px;
      color: var(--vscode-text-dim);
    }

    .error {
      color: var(--vscode-error);
      padding: 16px;
      background: var(--vscode-bg-light);
      border-radius: 8px;
      margin-bottom: 16px;
    }
  `,ed=((e,t,s,i)=>{for(var o,r=i>1?void 0:i?Zc(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=o(r)||r);return r})([ve("dashboard-tab-v2")],ed);const td=Be([]),sd=Be(!1),id=Be(null),od=Be([]),rd=Be(!1),ad=Be(null),nd=Be([]),ld=Be(!1),cd=Be(null),dd=Be([]),hd=Be(!1),ud=Be(null),pd=Be(null),gd=Be(""),md=Be("all"),fd=Be(""),vd=Be(""),bd=Be("");ze(td,e=>{const t=/* @__PURE__ */new Set;return e.forEach(e=>{e.type&&t.add(e.type)}),Array.from(t).sort()});const yd=ze([td,gd,md],(e,t,s)=>{let i=e;if("all"!==s&&(i=i.filter(e=>e.type===s)),t){const e=t.toLowerCase();i=i.filter(t=>t.name.toLowerCase().includes(e))}return i}),wd=ze([od,fd],(e,t)=>{if(!t)return e;const s=t.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(s))}),xd=ze([nd,vd],(e,t)=>{if(!t)return e;const s=t.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(s))}),_d=ze([dd,bd],(e,t)=>{if(!t)return e;const s=t.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(s))});ze([td,od,nd,dd],(e,t,s,i)=>{const o=e.length,r=e.filter(e=>"up"===e.state).length,a=e.filter(e=>"down"===e.state).length,n=e.reduce((e,t)=>e+(t.statistics?.rx_bytes||0),0),l=e.reduce((e,t)=>e+(t.statistics?.tx_bytes||0),0);return{totalInterfaces:o,upInterfaces:r,downInterfaces:a,totalBridges:t.length,totalBonds:s.length,totalVlans:i.length,totalRxBytes:n,totalTxBytes:l}});const kd={async fetchAll(){await Promise.all([this.fetchInterfaces(),this.fetchBridges(),this.fetchBonds(),this.fetchVlans()])},async fetchInterfaces(e){sd.set(!0),id.set(null);try{const t=e?`/network/interfaces?type=${e}`:"/network/interfaces",s=await mc.get(t);td.set(s.interfaces||[])}catch(t){const e=t instanceof Error?t.message:"Failed to fetch interfaces";id.set(e),console.error("Error fetching network interfaces:",t)}finally{sd.set(!1)}},async fetchBridges(){rd.set(!0),ad.set(null);try{const e=await mc.get("/network/bridges");od.set(e.bridges||[])}catch(e){const t=e instanceof Error?e.message:"Failed to fetch bridges";ad.set(t),console.error("Error fetching bridges:",e)}finally{rd.set(!1)}},async fetchBonds(){ld.set(!0),cd.set(null);try{const e=await mc.get("/network/bonds");nd.set(e.bonds||[])}catch(e){const t=e instanceof Error?e.message:"Failed to fetch bonds";cd.set(t),console.error("Error fetching bonds:",e)}finally{ld.set(!1)}},async fetchVlans(){hd.set(!0),ud.set(null);try{const e=await mc.get("/network/vlans");dd.set(e.vlans||[])}catch(e){const t=e instanceof Error?e.message:"Failed to fetch VLANs";ud.set(t),console.error("Error fetching VLANs:",e)}finally{hd.set(!1)}},async toggleInterfaceState(e){const t="up"===e.state?"down":"up",s=`/network/interfaces/${e.name}/${t}`;try{return await mc.put(s),await this.fetchInterfaces(),!0}catch(i){return console.error(`Error bringing interface ${t}:`,i),!1}},async configureAddress(e,t){try{return await mc.post(`/network/interfaces/${e}/address`,t),await this.fetchInterfaces(),!0}catch(s){return console.error("Error configuring address:",s),!1}},async addIpAddress(e,t){try{await mc.post(`/network/interfaces/${e}/address`,t),await this.fetchInterfaces();const s=pd.get();if(s&&s.name===e){const t=td.get().find(t=>t.name===e);t&&pd.set(t)}return!0}catch(s){return console.error("Error adding IP address:",s),!1}},async updateIpAddress(e,t,s){try{await mc.delete(`/network/interfaces/${e}/address?address=${encodeURIComponent(t)}`),await mc.post(`/network/interfaces/${e}/address`,s),await this.fetchInterfaces();const i=pd.get();if(i&&i.name===e){const t=td.get().find(t=>t.name===e);t&&pd.set(t)}return!0}catch(i){return console.error("Error updating IP address:",i),!1}},async deleteIpAddress(e,t){try{await mc.delete(`/network/interfaces/${e}/address?address=${encodeURIComponent(t)}`),await this.fetchInterfaces();const s=pd.get();if(s&&s.name===e){const t=td.get().find(t=>t.name===e);t&&pd.set(t)}return!0}catch(s){return console.error("Error deleting IP address:",s),!1}},async createBridge(e){try{const t=await mc.post("/network/bridge",e);return await Promise.all([this.fetchBridges(),this.fetchInterfaces()]),t||{}}catch(t){throw console.error("Error creating bridge:",t),t}},async deleteBridge(e){try{return await mc.delete(`/network/bridge/${e}`),await this.fetchBridges(),!0}catch(t){return console.error("Error deleting bridge:",t),!1}},async createBond(e){try{const t=await mc.post("/network/bond",e);return await Promise.all([this.fetchBonds(),this.fetchInterfaces()]),t||{}}catch(t){throw console.error("Error creating bond:",t),t}},async deleteBond(e){try{return await mc.delete(`/network/bond/${e}`),await this.fetchBonds(),!0}catch(t){return console.error("Error deleting bond:",t),!1}},async createVlan(e){try{const t=await mc.post("/network/vlan",e);return await Promise.all([this.fetchVlans(),this.fetchInterfaces()]),t||{}}catch(t){throw console.error("Error creating VLAN:",t),t}},async deleteVlan(e){try{return await mc.delete(`/network/vlan/${e}`),await this.fetchVlans(),!0}catch(t){return console.error("Error deleting VLAN:",t),!1}},async updateBridge(e,t){try{const s=await mc.put(`/network/bridge/${e}`,t);return await Promise.all([this.fetchBridges(),this.fetchInterfaces()]),s||{}}catch(s){throw console.error("Error updating bridge:",s),s}},async updateBond(e,t){try{const s=await mc.put(`/network/bond/${e}`,t);return await Promise.all([this.fetchBonds(),this.fetchInterfaces()]),s||{}}catch(s){throw console.error("Error updating bond:",s),s}},async updateVlan(e,t){try{const s=await mc.put(`/network/vlan/${e}`,t);return await Promise.all([this.fetchVlans(),this.fetchInterfaces()]),s||{}}catch(s){throw console.error("Error updating VLAN:",s),s}},async updateInterfaceAddress(e,t){try{const s=await mc.put(`/network/interfaces/${e}/address`,t);return await this.fetchInterfaces(),s||{}}catch(s){throw console.error("Error updating interface address:",s),s}},selectInterface(e){pd.set(e)},setSearchQuery(e){gd.set(e)},setSelectedType(e){md.set(e)},setBridgeSearchQuery(e){fd.set(e)},setBondSearchQuery(e){vd.set(e)},setVlanSearchQuery(e){bd.set(e)},clearErrors(){id.set(null),ad.set(null),cd.set(null),ud.set(null)},resetUIState(){pd.set(null),gd.set(""),md.set("all"),fd.set(""),vd.set(""),bd.set("")}};async function Sd(){try{await kd.fetchAll()}catch(e){console.error("Failed to initialize network store:",e)}}var Cd=Object.defineProperty,$d=(e,t,s,i)=>{for(var o,r=void 0,a=e.length-1;a>=0;a--)(o=e[a])&&(r=o(t,s,r)||r);return r&&Cd(t,s,r),r};class Dd extends dt{constructor(){super(...arguments),this.originalParent=null,this.originalNextSibling=null,this.open=!1,this.title="",this.size="medium",this.showFooter=!0,this.center=!1,this._isMovingToBody=!1,this.handleKeydown=e=>{"Escape"===e.key&&this.open&&this.close()}}static{this.styles=g`
    :host {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10000;
      overflow: auto;
    }

    :host([open]) {
      display: block;
    }

    .overlay.centered { display: flex; align-items: center; justify-content: center; }
    .overlay.centered .modal { margin: 0; }
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.2s ease-out;
    }

    .modal {
      position: relative;
      background-color: var(--vscode-bg-light, #252526);
      color: var(--vscode-text, #cccccc);
      margin: 40px auto;
      border: 1px solid var(--vscode-border, #464647);
      border-radius: 6px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.2s ease-out;
      max-height: calc(100vh - 80px);
      display: flex;
      flex-direction: column;
    }

    .modal.small {
      width: 90%;
      max-width: 400px;
    }

    .modal.medium {
      width: 90%;
      max-width: 600px;
    }

    .modal.large {
      width: 90%;
      max-width: 900px;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid var(--vscode-border, #464647);
      background-color: var(--vscode-bg-lighter, #2d2d30);
    }

    .modal-title {
      margin: 0;
      font-size: 16px;
      font-weight: 500;
    }

    .modal-close {
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: none;
      background: none;
      color: var(--vscode-text-dim, #9d9d9d);
      border-radius: 4px;
      transition: all 0.2s;
    }

    .modal-close:hover {
      background-color: var(--vscode-bg-light, #252526);
      color: var(--vscode-text, #cccccc);
    }

    .modal-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      padding: 16px 20px;
      border-top: 1px solid var(--vscode-border, #464647);
      background-color: var(--vscode-bg, #1e1e1e);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .modal {
        margin: 20px;
        width: calc(100% - 40px);
        max-width: none;
      }
    }

    /* ============================================
       Form styles for slotted content
       ============================================ */
    
    /* Form groups */
    ::slotted(.form-group) {
      margin-bottom: 14px;
      width: 100%;
      box-sizing: border-box;
    }
    
    ::slotted(.form-group.checkbox) {
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    /* Form hint text */
    ::slotted(.form-hint) {
      font-size: 11px;
      color: var(--vscode-text-dim, #9d9d9d);
      margin-top: 4px;
    }

    /* Footer actions container */
    ::slotted([slot="footer"]) {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }
  `}connectedCallback(){super.connectedCallback(),document.addEventListener("keydown",this.handleKeydown)}disconnectedCallback(){this._isMovingToBody||(window.removeEventListener("keydown",this.handleKeydown),this.returnToOriginalPosition()),super.disconnectedCallback()}handleOverlayClick(e){e.target===e.currentTarget&&this.close()}close(){this.open=!1,this.dispatchEvent(new CustomEvent("modal-close",{bubbles:!0,composed:!0}))}moveToBody(){if(!this.originalParent&&this.parentNode){const e=this.getRootNode();e instanceof ShadowRoot?this.originalParent=e.host:this.originalParent=this.parentNode,this.originalNextSibling=this.nextSibling,this._isMovingToBody=!0,document.body.appendChild(this),this._isMovingToBody=!1}}returnToOriginalPosition(){if(this.originalParent&&this.parentNode===document.body){const e=this.originalParent.shadowRoot||this.originalParent;this.originalNextSibling?e.insertBefore(this,this.originalNextSibling):e.appendChild(this),this.originalParent=null,this.originalNextSibling=null}}updated(e){super.updated(e),(e.has("open")||e.has("center"))&&(this.open&&this.center?this.moveToBody():!this.open&&this.originalParent&&this.returnToOriginalPosition())}render(){return this.open?J`
      <div class="overlay ${this.center?"centered":""}" @click=${this.handleOverlayClick}>
        <div class="modal ${this.size}">
          <div class="modal-header">
            <h2 class="modal-title">${this.title}</h2>
            <button class="modal-close" @click=${this.close} aria-label="Close">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 8.707l3.646 3.647.708-.707L8.707 8l3.647-3.646-.707-.708L8 7.293 4.354 3.646l-.707.708L7.293 8l-3.647 3.646.708.708L8 8.707z"/>
              </svg>
            </button>
          </div>
          <div class="modal-content">
            <slot></slot>
          </div>
          ${this.showFooter?J`
            <div class="modal-footer">
              <slot name="footer">
                <button class="btn btn-secondary" @click=${this.close}>
                  ${n("common.close")}
                </button>
              </slot>
            </div>
          `:""}
        </div>
      </div>
    `:J``}}$d([we({type:Boolean,reflect:!0})],Dd.prototype,"open"),$d([we({type:String})],Dd.prototype,"title"),$d([we({type:String})],Dd.prototype,"size"),$d([we({type:Boolean})],Dd.prototype,"showFooter"),$d([we({type:Boolean})],Dd.prototype,"center"),customElements.define("modal-dialog",Dd);var Ed=Object.defineProperty,Md=Object.getOwnPropertyDescriptor,Ad=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Md(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Ed(t,s,r),r};let Id=class extends me{constructor(){super(...arguments),this.type="warning",this.message="",this.failures=[],this.successfulItems=[],this.dismissible=!0}handleClose(){this.dispatchEvent(new CustomEvent("close",{bubbles:!0,composed:!0}))}renderIcon(){return"partial-success"===this.type?J`
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
      `:J`
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
        <line x1="12" y1="9" x2="12" y2="13"></line>
        <line x1="12" y1="17" x2="12.01" y2="17"></line>
      </svg>
    `}render(){return J`
      <div class="warning-container ${this.type}">
        <div class="warning-icon" style="color: ${"partial-success"===this.type?"var(--info-color, #2196f3)":"persistence"===this.type?"var(--caution-color, #ffc107)":"var(--warning-color, #ff9800)"}">
          ${this.renderIcon()}
        </div>
        <div class="warning-content">
          ${this.message?J`
            <div class="warning-message">${this.message}</div>
          `:""}
          
          ${this.successfulItems.length>0?J`
            <div class="success-list">
              Successfully processed: ${this.successfulItems.join(", ")}
            </div>
          `:""}
          
          ${this.failures.length>0?J`
            <div class="failures-list">
              ${this.failures.map(e=>J`
                <div class="failure-item">
                  <span class="failure-interface">${e.interface}:</span>
                  <span class="failure-reason">${e.reason}</span>
                </div>
              `)}
            </div>
          `:""}
        </div>
        ${this.dismissible?J`
          <button class="close-button" @click=${this.handleClose} title="Dismiss">Ã</button>
        `:""}
      </div>
    `}};Id.styles=g`
    :host {
      display: block;
      margin: 12px 0;
    }

    .warning-container {
      background: var(--warning-bg, rgba(255, 152, 0, 0.1));
      border: 1px solid var(--warning-border, rgba(255, 152, 0, 0.3));
      border-left: 4px solid var(--warning-color, #ff9800);
      border-radius: 4px;
      padding: 12px 16px;
      display: flex;
      gap: 12px;
      align-items: flex-start;
      animation: slideIn 0.3s ease-out;
    }

    .warning-container.partial-success {
      background: var(--info-bg, rgba(33, 150, 243, 0.1));
      border-color: var(--info-border, rgba(33, 150, 243, 0.3));
      border-left-color: var(--info-color, #2196f3);
    }

    .warning-container.persistence {
      background: var(--caution-bg, rgba(255, 193, 7, 0.1));
      border-color: var(--caution-border, rgba(255, 193, 7, 0.3));
      border-left-color: var(--caution-color, #ffc107);
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .warning-icon {
      flex-shrink: 0;
      width: 20px;
      height: 20px;
      margin-top: 2px;
    }

    .warning-icon svg {
      width: 100%;
      height: 100%;
    }

    .warning-content {
      flex: 1;
      color: var(--text-primary, var(--vscode-foreground, #cccccc));
      font-size: 0.875rem;
      line-height: 1.5;
    }

    .warning-title {
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text-primary, var(--vscode-foreground, #cccccc));
    }

    .warning-message {
      margin-bottom: 8px;
    }

    .failures-list {
      margin-top: 8px;
      padding-left: 16px;
    }

    .failure-item {
      margin: 4px 0;
      display: flex;
      gap: 8px;
    }

    .failure-interface {
      font-weight: 500;
      color: var(--text-primary, var(--vscode-foreground, #cccccc));
    }

    .failure-reason {
      color: var(--text-secondary, var(--vscode-descriptionForeground, #999999));
    }

    .success-list {
      margin-top: 8px;
      color: var(--text-secondary, var(--vscode-descriptionForeground, #999999));
    }

    .close-button {
      flex-shrink: 0;
      background: none;
      border: none;
      cursor: pointer;
      color: var(--text-secondary, var(--vscode-descriptionForeground, #999999));
      font-size: 18px;
      padding: 0;
      width: 20px;
      height: 20px;
      border-radius: 4px;
      transition: all 0.2s;
      line-height: 1;
    }

    .close-button:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color: var(--text-primary, var(--vscode-foreground, #cccccc));
    }
  `,Ad([we({type:String})],Id.prototype,"type",2),Ad([we({type:String})],Id.prototype,"message",2),Ad([we({type:Array})],Id.prototype,"failures",2),Ad([we({type:Array})],Id.prototype,"successfulItems",2),Ad([we({type:Boolean})],Id.prototype,"dismissible",2),Id=Ad([ve("operation-warning")],Id);var Td=Object.defineProperty,Pd=(e,t,s,i)=>{for(var o,r=void 0,a=e.length-1;a>=0;a--)(o=e[a])&&(r=o(t,s,r)||r);return r&&Td(t,s,r),r};class Ld extends dt{constructor(){super(),this.subRoute=null,this.interfacesController=new Zl.StoreController(this,yd),this.bridgesController=new Zl.StoreController(this,wd),this.bondsController=new Zl.StoreController(this,xd),this.vlansController=new Zl.StoreController(this,_d),this.selectedInterfaceController=new Zl.StoreController(this,pd),this.searchQueryController=new Zl.StoreController(this,gd),this.selectedTypeController=new Zl.StoreController(this,md),this.bridgeSearchController=new Zl.StoreController(this,fd),this.bondSearchController=new Zl.StoreController(this,vd),this.vlanSearchController=new Zl.StoreController(this,bd),this.activeTab="interfaces",this.showConfigureDrawer=!1,this.showDetailsDrawer=!1,this.editingIpIndex=null,this.showAddIpModal=!1,this.showEditIpModal=!1,this.editIpAddress="",this.editIpNetmask=24,this.editIpGateway="",this.originalIpAddress="",this.newIpAddress="",this.newIpNetmask=24,this.newIpGateway="",this.showBridgeDrawer=!1,this.isEditingBridge=!1,this.editingBridgeName=null,this.bridgeFormData={name:"",interfaces:""},this.showBondDrawer=!1,this.isEditingBond=!1,this.editingBondName=null,this.bondFormData={name:"",mode:"balance-rr",interfaces:""},this.vlanFormData={interface:"",vlanId:0,name:""},this.showVLANDrawer=!1,this.interfaceTypes=[],this.isEditingVlan=!1,this.editingVlanName=null,this.operationWarning=null,this.configureNetworkInterface=null,this.configureFormData={address:"",netmask:24,gateway:""},this.showConfirmModal=!1,this.confirmAction=null,this.confirmTitle="",this.confirmMessage="",this.availableInterfacesForBridge=[],this.showBridgeInterfacesSuggestions=!1,this.bridgeInterfaceInputValue="",this.selectedSuggestionIndex=-1,this.bondInterfaceInputValue="",this.showBondInterfacesSuggestions=!1,this.selectedBondSuggestionIndex=-1,this.vlanInterfaceInputValue="",this.showVlanInterfacesSuggestions=!1,this.selectedVlanSuggestionIndex=-1,this.handlePopState=this.handlePopState.bind(this)}static{this.styles=g`
    :host {
      display: block;
      padding: 16px;
    }

    .tab-container {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .tab-header {
      display: flex;
      border-bottom: 2px solid var(--vscode-border);
      margin-bottom: 1rem;
    }

    .tab-button {
      padding: 0.75rem 1.5rem;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 0.875rem;
      color: var(--text-secondary);
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
      transition: all 0.2s;
    }

    .tab-button:hover {
      color: var(--text-primary);
    }

    .tab-button.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }

    .tab-content {
      flex: 1;
      overflow-y: auto;
    }

    .network-interface {
      background-color: var(--surface-1);
      padding: 16px;
      border-radius: 6px;
      margin-bottom: 12px;
      border: 1px solid var(--vscode-border);
    }

    .interface-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .interface-name {
      font-size: 1.1rem;
      font-weight: 500;
    }

    .interface-state {
      padding: 0.25rem 0.75rem;
      border-radius: 16px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .state-up {
      background-color: var(--success-bg);
      color: var(--success);
    }

    .state-down {
      background-color: var(--error-bg);
      color: var(--error);
    }

    .interface-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .detail-item {
      display: flex;
      flex-direction: column;
    }

    .detail-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: 0.25rem;
    }

    .detail-value {
      font-size: 0.875rem;
      color: var(--text-primary);
    }

    .interface-actions {
      display: flex;
      gap: 0.5rem;
    }

    .action-button {
      padding: 0.5rem 1rem;
      background-color: var(--surface-2);
      color: var(--text-primary);
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    .action-button:hover {
      background-color: var(--surface-3);
      border-color: var(--primary);
    }

    .action-button.primary {
      background-color: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .action-button.primary:hover {
      background-color: var(--primary-hover);
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }

    .create-form {
      background-color: var(--surface-1);
      padding: 1.5rem;
      border-radius: 6px;
      border: 1px solid var(--vscode-border);
      margin-bottom: 1rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
      color: var(--text-primary);
    }

    .form-input,
    .form-select {
      width: 100%;
      padding: 0.5rem;
      background-color: var(--surface-0);
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      color: var(--text-primary);
      font-size: 0.875rem;
      box-sizing: border-box;
    }

    .form-input:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--primary);
    }

    .form-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
      margin-top: 1.5rem;
    }

    h1 {
      margin: 0 0 24px 0;
      font-size: 24px;
      font-weight: 300;
    }

    h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: var(--text-primary);
    }

    h3 {
      font-size: 1.2rem;
      margin: 1.5rem 0 1rem 0;
      color: var(--text-primary);
    }

    .network-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background-color: var(--vscode-bg-light);
      border: 1px solid var(--vscode-border);
      border-radius: 1px;
      overflow: visible;
      margin-bottom: 1rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .network-table thead {
      background-color: var(--vscode-bg-lighter);
    }

    .network-table th {
      background: var(--vscode-bg-dark);
      color: var(--vscode-text);
      font-weight: 600;
      text-align: left;
      padding: 12px 16px;
      font-size: 0.875rem;
      border-bottom: 1px solid var(--vscode-border);
    }

    .network-table td {
      padding: 12px 16px;
      font-size: 0.875rem;
      color: var(--vscode-text);
      border-bottom: 1px solid var(--vscode-border);
    }

    .network-table tbody tr:last-child td {
      border-bottom: none;
    }

    .network-table tbody tr:hover {
      background-color: var(--surface-0);
    }

    .network-table td.state-up,
    .network-table td.state-down {
      font-weight: 500;
    }

    .network-table td:last-child {
      text-align: right;
    }

    .network-table td button {
      margin-right: 0.5rem;
    }

    .network-table td button:last-child {
      margin-right: 0;
    }

    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-icon {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      position: relative;
    }

    .status-icon.up {
      background-color: #4caf50;
      box-shadow: 0 0 4px #4caf50;
    }

    .status-icon.down {
      background-color: #9e9e9e;
    }

    .status-icon[data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      padding: 6px 12px;
      background-color: var(--surface-1);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 14px;
      white-space: nowrap;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .action-menu {
      position: relative;
      display: inline-block;
    }

    .action-dots {
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 8px;
      color: var(--text-secondary);
      font-size: 18px;
      line-height: 1;
      transition: background-color 0.2s;
      border-radius: 4px;
    }

    .action-dots:hover {
      background-color: var(--vscode-toolbar-hoverBackground, var(--vscode-list-hoverBackground, rgba(90, 93, 94, 0.1)));
    }

    .action-dropdown {
      position: absolute;
      right: 0;
      top: 100%;
      margin-top: 4px;
      background-color: var(--surface-1);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      min-width: 150px;
      display: none;
    }

    .action-dropdown.show {
      display: block;
    }

    .action-dropdown button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 8px 16px;
      border: none;
      background: none;
      color: var(--text-primary);
      cursor: pointer;
      font-size: 13px;
      transition: background-color 0.2s;
    }

    .action-dropdown button:hover {
      background-color: var(--vscode-list-hoverBackground, rgba(255, 255, 255, 0.08));
    }

    .action-dropdown button.danger {
      color: var(--vscode-error, #f44336);
    }

    .autocomplete-container {
      position: relative;
    }

    .autocomplete-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      margin-top: 4px;
      background-color: var(--surface-1);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      max-height: 200px;
      overflow-y: auto;
      z-index: 1001;
    }

    .autocomplete-suggestion {
      padding: 8px 12px;
      cursor: pointer;
      font-size: 13px;
      color: var(--text-primary);
      transition: background-color 0.2s;
    }

    .autocomplete-suggestion:hover,
    .autocomplete-suggestion.selected {
      background-color: var(--vscode-list-hoverBackground, rgba(255, 255, 255, 0.08));
    }

    .autocomplete-suggestion.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .autocomplete-suggestion.disabled:hover {
      background-color: transparent;
    }
    .drawer {
      position: fixed;
      top: 0;
      right: 0;
      width: 400px;
      max-width: 90%;
      height: 100%;
      background: var(--vscode-bg-light);
      border-left: 1px solid var(--vscode-border);
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      z-index: 1001;
      overflow-y: auto;
      padding: 24px;
      animation: slideIn 0.3s ease-out;
    }

    @media (max-width: 768px) {
      .drawer {
        width: 100%;
        max-width: 100%;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
      }
      to {
        transform: translateX(0);
      }
    }

    .drawer h2 {
      margin-top: 0;
    }

    .drawer button.close-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      background: var(--vscode-toolbar-hoverBackground, rgba(90, 93, 94, 0.1));
      color: var(--vscode-foreground, var(--vscode-editor-foreground));
      border: 1px solid var(--vscode-widget-border, rgba(0, 0, 0, 0.1));
      transition: all 0.2s;
    }

    .drawer button.close-btn:hover {
      background: var(--vscode-list-hoverBackground, rgba(90, 93, 94, 0.2));
      border-color: var(--vscode-widget-border, rgba(0, 0, 0, 0.2));
    }

    .drawer-content {
      margin-top: 40px;
    }

    .search-container {
      position: relative;
      display: inline-block;
      width: 200px;
    }

    .search-icon {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      pointer-events: none;
      opacity: 0.5;
    }

    .search-input {
      padding-left: 35px !important;
      width: 100%;
    }

    .ip-addresses-cell {
      position: relative;
    }

    .ip-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .ip-address {
      font-size: 0.85rem;
    }

    .ip-more-indicator {
      font-size: 0.85rem;
      color: var(--primary);
      cursor: pointer;
      font-weight: 500;
    }

    .ip-addresses-cell:hover .ip-list-collapsed {
      display: none;
    }

    .ip-addresses-cell:hover .ip-list-expanded {
      display: flex;
    }

    .ip-list-expanded {
      display: none;
      flex-direction: column;
      gap: 4px;
      position: absolute;
      top: 0;
      left: 0;
      background: var(--surface-1);
      padding: 12px 16px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      z-index: 100;
      min-width: 200px;
      max-height: 300px;
      overflow-y: auto;
    }

    .ip-list-collapsed {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .filter-container {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 12px;
    }

    .type-filter-select {
      padding: 0.5rem 2.5rem 0.5rem 0.75rem;
      background-color: var(--surface-0);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      color: var(--text-primary);
      font-size: 0.875rem;
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23999' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
      min-width: 150px;
    }

    .type-filter-select:hover {
      border-color: var(--primary);
    }

    .type-filter-select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(var(--primary-rgb), 0.2);
    }

    }

    .interface-name-link {
      color: var(--primary);
      cursor: pointer;
      text-decoration: none;
      transition: opacity 0.2s;
    }

    .interface-name-link:hover {
      opacity: 0.8;
      text-decoration: underline;
    }

    .details-table {
      width: 100%;
      border-collapse: collapse;
      background-color: var(--surface-0);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 1rem;
    }

    .details-table thead {
      background-color: var(--surface-1);
    }

    .details-table th {
      text-align: left;
      padding: 10px 12px;
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border-color);
    }

    .details-table td {
      padding: 10px 12px;
      font-size: 0.85rem;
      color: var(--text-primary);
      border-bottom: 1px solid var(--border-color);
    }

    .details-table tbody tr:last-child td {
      border-bottom: none;
    }

    .details-table tbody tr:hover {
      background-color: var(--surface-1);
    }

    .ip-edit-input {
      padding: 0.25rem 0.5rem;
      background-color: var(--surface-0);
      border: 1px solid var(--primary);
      border-radius: 3px;
      color: var(--text-primary);
      font-size: 0.85rem;
      width: 100%;
    }

    .ip-actions {
      display: flex;
      gap: 4px;
    }

    .ip-action-btn {
      padding: 4px 8px;
      background: none;
      border: 1px solid transparent;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }

    .ip-action-btn:hover {
      background-color: var(--surface-2);
      border-color: var(--border-color);
    }

    .ip-action-btn.edit {
      color: var(--primary);
    }

    .ip-action-btn.delete {
      color: var(--error);
    }

    .ip-action-btn.save {
      background-color: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .ip-action-btn.save:hover {
      background-color: var(--primary-hover);
    }

    .add-ip-form {
      margin-top: 1rem;
      padding: 1rem;
      background-color: var(--surface-0);
      border: 1px solid var(--border-color);
      border-radius: 4px;
    }

    .add-ip-form .form-row {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .add-ip-form .form-row input {
      flex: 1;
    }

    .interface-info-section {
      margin-bottom: 1.5rem;
    }

    .interface-info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 0.5rem;
    }

    .info-item {
      padding: 0.75rem;
      background-color: var(--surface-0);
      border: 1px solid var(--border-color);
      border-radius: 4px;
    }

    .info-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: 0.25rem;
    }

    .info-value {
      font-size: 0.9rem;
      color: var(--text-primary);
      font-weight: 500;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .section-title {
      font-size: 1.1rem;
      font-weight: 500;
      color: var(--text-primary);
    }

    .add-btn {
      padding: 0.4rem 0.8rem;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: background-color 0.2s;
    }

    .add-btn:hover {
      background-color: var(--primary-hover);
    }
  `}get interfaces(){return this.interfacesController.value||[]}get bridges(){return this.bridgesController.value||[]}get bonds(){return this.bondsController.value||[]}get vlans(){return this.vlansController.value||[]}get selectedInterface(){return this.selectedInterfaceController.value}set selectedInterface(e){kd.selectInterface(e)}get searchQuery(){return this.searchQueryController.value||""}set searchQuery(e){kd.setSearchQuery(e)}get selectedType(){return this.selectedTypeController.value||"all"}set selectedType(e){kd.setSelectedType(e)}get bridgeSearchQuery(){return this.bridgeSearchController.value||""}set bridgeSearchQuery(e){kd.setBridgeSearchQuery(e)}get bondSearchQuery(){return this.bondSearchController.value||""}set bondSearchQuery(e){kd.setBondSearchQuery(e)}get vlanSearchQuery(){return this.vlanSearchController.value||""}set vlanSearchQuery(e){kd.setVlanSearchQuery(e)}handlePopState(){const e=window.location.pathname.split("/"),t=e[e.length-1];t&&["interfaces","bridges","bonds","vlans"].includes(t)&&(this.activeTab=t)}firstUpdated(){Sd(),document.addEventListener("click",this.handleDocumentClick.bind(this)),document.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("popstate",this.handlePopState),this.fetchInterfaceTypes();const e=window.location.pathname.split("/"),t=e[e.length-1];t&&["interfaces","bridges","bonds","vlans"].includes(t)?this.activeTab=t:this.handleSubRoute()}updated(e){super.updated(e),e.has("subRoute")&&this.handleSubRoute()}handleSubRoute(){this.subRoute&&["interfaces","bridges","bonds","vlans"].includes(this.subRoute)?this.activeTab=this.subRoute:this.activeTab="interfaces"}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("click",this.handleDocumentClick.bind(this)),document.removeEventListener("keydown",this.handleKeyDown.bind(this)),window.removeEventListener("popstate",this.handlePopState)}async fetchInterfaceTypes(){try{const e=await mc.get("/network/interface-types");e&&e.types&&(this.interfaceTypes=e.types)}catch(e){console.error("Error fetching interface types:",e)}}async fetchAvailableInterfacesForBridge(){try{const e=await mc.get("/network/interfaces?type=device,vlan,bond");e&&e.interfaces&&(this.availableInterfacesForBridge=e.interfaces.map(e=>e.name))}catch(e){console.error("Error fetching available interfaces:",e)}}handleBridgeInterfaceInput(e){const t=e.target.value;this.bridgeInterfaceInputValue=t;const s=t.split(",").map(e=>e.trim()),i=(s[s.length-1]||"").toLowerCase();this.showBridgeInterfacesSuggestions=i.length>0,this.selectedSuggestionIndex=-1}handleBridgeInterfaceKeyDown(e){if(!this.showBridgeInterfacesSuggestions)return;const t=this.getFilteredSuggestions();if("ArrowDown"===e.key)e.preventDefault(),this.selectedSuggestionIndex=Math.min(this.selectedSuggestionIndex+1,t.length-1);else if("ArrowUp"===e.key)e.preventDefault(),this.selectedSuggestionIndex=Math.max(this.selectedSuggestionIndex-1,0);else if("Enter"===e.key&&this.selectedSuggestionIndex>=0){e.preventDefault();const s=t[this.selectedSuggestionIndex];s&&this.selectSuggestion(s)}else"Escape"===e.key&&(this.showBridgeInterfacesSuggestions=!1)}getFilteredSuggestions(){const e=this.bridgeInterfaceInputValue.split(",").map(e=>e.trim()),t=(e[e.length-1]||"").toLowerCase(),s=e.slice(0,-1).map(e=>e.toLowerCase());return this.availableInterfacesForBridge.filter(e=>{const i=e.toLowerCase();return i.includes(t)&&!s.includes(i)})}selectSuggestion(e){const t=this.bridgeInterfaceInputValue.split(",").map(e=>e.trim());t[t.length-1]=e,this.bridgeInterfaceInputValue=t.join(", ")+", ",this.bridgeFormData.interfaces=this.bridgeInterfaceInputValue,this.showBridgeInterfacesSuggestions=!1,this.selectedSuggestionIndex=-1;const s=document.getElementById("bridge-interfaces");s&&s.focus()}closeBridgeInterfacesSuggestions(){setTimeout(()=>{this.showBridgeInterfacesSuggestions=!1},200)}handleBondInterfaceInput(e){const t=e.target.value;this.bondInterfaceInputValue=t;const s=t.split(",").map(e=>e.trim()),i=s[s.length-1]||"";this.showBondInterfacesSuggestions=i.length>0,this.selectedBondSuggestionIndex=-1}handleBondInterfaceKeyDown(e){if(!this.showBondInterfacesSuggestions)return;const t=this.getFilteredBondSuggestions();if("ArrowDown"===e.key)e.preventDefault(),this.selectedBondSuggestionIndex=Math.min(this.selectedBondSuggestionIndex+1,t.length-1);else if("ArrowUp"===e.key)e.preventDefault(),this.selectedBondSuggestionIndex=Math.max(this.selectedBondSuggestionIndex-1,0);else if("Enter"===e.key&&this.selectedBondSuggestionIndex>=0){e.preventDefault();const s=t[this.selectedBondSuggestionIndex];s&&this.selectBondSuggestion(s)}else"Escape"===e.key&&(this.showBondInterfacesSuggestions=!1)}getFilteredBondSuggestions(){const e=this.bondInterfaceInputValue.split(",").map(e=>e.trim()),t=e[e.length-1]||"",s=e.slice(0,-1).map(e=>e.toLowerCase());return this.availableInterfacesForBridge.filter(e=>e.toLowerCase().includes(t.toLowerCase())&&!s.includes(e.toLowerCase())).slice(0,10)}selectBondSuggestion(e){const t=this.bondInterfaceInputValue.split(",").map(e=>e.trim());t[t.length-1]=e,this.bondInterfaceInputValue=t.join(", ")+", ",this.bondFormData.interfaces=this.bondInterfaceInputValue,this.showBondInterfacesSuggestions=!1,this.selectedBondSuggestionIndex=-1;const s=this.shadowRoot?.querySelector("#bond-interfaces");s&&s.focus()}closeBondInterfacesSuggestions(){setTimeout(()=>{this.showBondInterfacesSuggestions=!1},200)}handleVlanInterfaceInput(e){const t=e.target.value;this.vlanInterfaceInputValue=t,this.showVlanInterfacesSuggestions=t.length>0,this.selectedVlanSuggestionIndex=-1}handleVlanInterfaceKeyDown(e){if(!this.showVlanInterfacesSuggestions)return;const t=this.getFilteredVlanSuggestions();if("ArrowDown"===e.key)e.preventDefault(),this.selectedVlanSuggestionIndex=Math.min(this.selectedVlanSuggestionIndex+1,t.length-1);else if("ArrowUp"===e.key)e.preventDefault(),this.selectedVlanSuggestionIndex=Math.max(this.selectedVlanSuggestionIndex-1,0);else if("Enter"===e.key&&this.selectedVlanSuggestionIndex>=0){e.preventDefault();const s=t[this.selectedVlanSuggestionIndex];s&&this.selectVlanSuggestion(s)}else"Escape"===e.key&&(this.showVlanInterfacesSuggestions=!1)}getFilteredVlanSuggestions(){const e=this.vlanInterfaceInputValue.trim().toLowerCase();return this.availableInterfacesForBridge.filter(t=>t.toLowerCase().includes(e)).slice(0,10)}selectVlanSuggestion(e){this.vlanInterfaceInputValue=e,this.vlanFormData.interface=e,this.showVlanInterfacesSuggestions=!1,this.selectedVlanSuggestionIndex=-1;const t=this.shadowRoot?.querySelector("#vlan-interface");t&&t.focus()}closeVlanInterfacesSuggestions(){setTimeout(()=>{this.showVlanInterfacesSuggestions=!1},200)}handleDocumentClick(e){e.target.closest(".action-menu")||this.closeAllMenus()}handleKeyDown(e){"Escape"===e.key&&(this.closeAllMenus(),this.showDetailsDrawer&&this.closeDetailsDrawer(),this.showConfigureDrawer&&this.closeConfigureDrawer(),this.showBridgeDrawer&&this.closeBridgeDrawer(),this.showBondDrawer&&this.closeBondDrawer(),this.showVLANDrawer&&this.closeVLANDrawer(),this.showConfirmModal&&this.handleCancel())}toggleActionMenu(e,t){e.stopPropagation();const s=this.shadowRoot?.getElementById(t);if(s){const e=s.classList.contains("show");if(this.closeAllMenus(),!e){s.classList.add("show");const e=s.querySelector("button");e&&setTimeout(()=>e.focus(),10)}}}closeAllMenus(){const e=this.shadowRoot?.querySelectorAll(".action-dropdown");e?.forEach(e=>e.classList.remove("show"))}async fetchNetworkData(){kd.fetchInterfaces(),kd.fetchBridges(),kd.fetchBonds(),kd.fetchVlans()}async fetchInterfaces(){const e="all"!==this.selectedType?this.selectedType:void 0;await kd.fetchInterfaces(e)}async fetchBridges(){await kd.fetchBridges()}async fetchBonds(){await kd.fetchBonds()}async fetchVlans(){await kd.fetchVlans()}toggleInterfaceState(e){const t="up"===e.state,s=n(t?"network.downInterface":"network.upInterface"),i=n(t?"network.confirmBringDown":"network.confirmBringUp",{name:e.name});this.showConfirmDialog(s,i,async()=>{await kd.toggleInterfaceState(e)})}async deleteBridge(e){this.showConfirmDialog(n("network.deleteBridge"),n("network.confirmDeleteBridge",{name:e}),async()=>{await kd.deleteBridge(e)})}async deleteBond(e){this.showConfirmDialog(n("network.deleteBond"),n("network.confirmDeleteBond",{name:e}),async()=>{await kd.deleteBond(e)})}async deleteVlan(e){this.showConfirmDialog(n("network.deleteVlan"),n("network.confirmDeleteVlan",{name:e}),async()=>{await kd.deleteVlan(e)})}showOperationWarning(e,t,s,i){this.operationWarning={type:e,message:t,failures:s,successItems:i},setTimeout(()=>{this.operationWarning=null},1e4)}dismissOperationWarning(){this.operationWarning=null}showConfirmDialog(e,t,s){this.confirmTitle=e,this.confirmMessage=t,this.confirmAction=s,this.showConfirmModal=!0,this.updateComplete.then(()=>{const e=this.shadowRoot?.querySelector("modal-dialog button.btn-secondary");e&&setTimeout(()=>e.focus(),50)})}handleConfirm(){this.confirmAction&&this.confirmAction(),this.showConfirmModal=!1,this.confirmAction=null}handleCancel(){this.showConfirmModal=!1,this.confirmAction=null}openVLANDrawer(){this.showVLANDrawer=!0,this.vlanFormData={interface:"",vlanId:0,name:""},this.vlanInterfaceInputValue="",this.showVlanInterfacesSuggestions=!1,this.selectedVlanSuggestionIndex=-1,this.fetchAvailableInterfacesForBridge()}closeVLANDrawer(){this.showVLANDrawer=!1,this.isEditingVlan=!1,this.editingVlanName=null,this.vlanFormData={interface:"",vlanId:0,name:""}}handleConfigureAddress(e){this.showVlanInterfacesSuggestions=!1,this.vlanInterfaceInputValue="",this.selectedVlanSuggestionIndex=-1,this.configureNetworkInterface=e,this.configureFormData={address:"",netmask:24,gateway:""},this.showConfigureDrawer=!0}async submitConfigureAddress(){if(!this.configureNetworkInterface||!this.configureFormData.address)return;const e={address:this.configureFormData.address,netmask:this.configureFormData.netmask,gateway:this.configureFormData.gateway||void 0};try{await mc.post(`/network/interfaces/${this.configureNetworkInterface.name}/address`,e),this.showConfigureDrawer=!1,this.configureNetworkInterface=null,await this.fetchInterfaces()}catch(t){console.error("Error configuring address:",t)}}closeConfigureDrawer(){this.showConfigureDrawer=!1,this.configureNetworkInterface=null,this.configureFormData={address:"",netmask:24,gateway:""}}openDetailsDrawer(e){this.selectedInterface=e,this.showDetailsDrawer=!0,this.editingIpIndex=null,this.newIpAddress="",this.newIpNetmask=24,this.newIpGateway=""}closeDetailsDrawer(){this.showDetailsDrawer=!1,this.selectedInterface=null,this.editingIpIndex=null,this.newIpAddress="",this.newIpNetmask=24,this.newIpGateway="",this.showEditIpModal=!1}openEditIpModal(e,t){this.editingIpIndex=e,this.originalIpAddress=t;const[s,i]=t.split("/");this.editIpAddress=s||t,this.editIpNetmask=i?parseInt(i):24,this.editIpGateway="",this.showEditIpModal=!0}closeEditIpModal(){this.showEditIpModal=!1,this.editingIpIndex=null,this.editIpAddress="",this.editIpNetmask=24,this.editIpGateway="",this.originalIpAddress=""}async saveEditedIp(){if(!this.selectedInterface||null===this.editingIpIndex||!this.editIpAddress)return;const e=this.selectedInterface.addresses?.[this.editingIpIndex];if(e)try{const e={address:this.editIpAddress,netmask:this.editIpNetmask,gateway:this.editIpGateway||void 0},t=await kd.updateInterfaceAddress(this.selectedInterface.name,e);t.warning&&this.showOperationWarning("warning",t.warning),t.persistence_warning&&this.showOperationWarning("persistence",t.persistence_warning),t.failed&&t.failed.length>0&&this.showOperationWarning("partial-success",t.warning||"Some operations failed",t.failed,t.successfully_added),await this.fetchInterfaces();const s=this.interfaces.find(e=>e.name===this.selectedInterface?.name);s&&(this.selectedInterface=s),this.closeEditIpModal()}catch(t){console.error("Error updating IP address:",t)}}async deleteIpAddress(e){this.selectedInterface&&this.showConfirmDialog(n("network.deleteIpAddress"),n("network.confirmDeleteIp",{address:e}),async()=>{try{await mc.delete(`/network/interfaces/${this.selectedInterface.name}/address?address=${encodeURIComponent(e)}`),await this.fetchInterfaces();const t=this.interfaces.find(e=>e.name===this.selectedInterface?.name);t&&(this.selectedInterface=t)}catch(t){console.error("Error deleting IP address:",t)}})}openAddIpModal(){this.showAddIpModal=!0,this.newIpAddress="",this.newIpNetmask=24,this.newIpGateway=""}closeAddIpModal(){this.showAddIpModal=!1,this.newIpAddress="",this.newIpNetmask=24,this.newIpGateway=""}async addNewIpAddress(){if(!this.selectedInterface||!this.newIpAddress)return;const e={address:this.newIpAddress,netmask:this.newIpNetmask,gateway:this.newIpGateway||void 0};try{const t=await mc.post(`/network/interfaces/${this.selectedInterface.name}/address`,e);t?.warning&&this.showOperationWarning("warning",t.warning),t?.persistence_warning&&this.showOperationWarning("persistence",t.persistence_warning),await this.fetchInterfaces();const s=this.interfaces.find(e=>e.name===this.selectedInterface?.name);s&&(this.selectedInterface=s),this.closeAddIpModal()}catch(t){console.error("Error adding IP address:",t)}}openBridgeDrawer(){this.showBridgeDrawer=!0,this.bridgeFormData={name:"",interfaces:""},this.bridgeInterfaceInputValue="",this.fetchAvailableInterfacesForBridge()}closeBridgeDrawer(){this.showBridgeDrawer=!1,this.isEditingBridge=!1,this.editingBridgeName=null,this.bridgeFormData={name:"",interfaces:""},this.showBridgeInterfacesSuggestions=!1,this.bridgeInterfaceInputValue="",this.selectedSuggestionIndex=-1}openBondDrawer(){this.showBondDrawer=!0,this.bondFormData={name:"",mode:"balance-rr",interfaces:""},this.bondInterfaceInputValue="",this.showBondInterfacesSuggestions=!1,this.selectedBondSuggestionIndex=-1,this.fetchAvailableInterfacesForBridge()}closeBondDrawer(){this.showBondDrawer=!1,this.isEditingBond=!1,this.editingBondName=null,this.bondFormData={name:"",mode:"balance-rr",interfaces:""},this.showBondInterfacesSuggestions=!1,this.bondInterfaceInputValue="",this.selectedBondSuggestionIndex=-1}openEditBridgeDrawer(e){this.isEditingBridge=!0,this.editingBridgeName=e.name,this.showBridgeDrawer=!0;const t=e.interfaces?e.interfaces.join(", "):"";this.bridgeFormData={name:e.name,interfaces:t},this.bridgeInterfaceInputValue=t,this.fetchAvailableInterfacesForBridge()}openEditBondDrawer(e){this.isEditingBond=!0,this.editingBondName=e.name,this.showBondDrawer=!0,this.bondFormData={name:e.name,mode:e.mode||"balance-rr",interfaces:e.interfaces?e.interfaces.join(","):""};const t=e.interfaces?e.interfaces.join(", "):"";this.bondInterfaceInputValue=t}openEditVlanDrawer(e){this.isEditingVlan=!0,this.editingVlanName=e.name,this.showVLANDrawer=!0,this.vlanFormData={interface:e.interface||"",vlanId:e.vlan_id||0,name:e.name},this.vlanInterfaceInputValue=e.interface||""}async handleCreateBridge(){if(!this.bridgeFormData.name||!this.bridgeFormData.interfaces)return;const e={name:this.bridgeFormData.name,interfaces:this.bridgeFormData.interfaces.split(",").map(e=>e.trim()).filter(Boolean)};let t;t=this.isEditingBridge?await kd.updateBridge(this.editingBridgeName,{interfaces:e.interfaces}):await kd.createBridge(e),t?.warning&&this.showOperationWarning("warning",t.warning),t?.persistence_warning&&this.showOperationWarning("persistence",t.persistence_warning),t?.failed&&t.failed.length>0&&this.showOperationWarning("partial-success",t.warning||"Some interfaces failed to add",t.failed,t.successfully_added),this.closeBridgeDrawer()}async handleCreateBond(){if(!this.bondFormData.name||!this.bondFormData.mode||!this.bondFormData.interfaces)return;const e={name:this.bondFormData.name,mode:this.bondFormData.mode,interfaces:this.bondFormData.interfaces.split(",").map(e=>e.trim()).filter(Boolean)};let t;t=this.isEditingBond?await kd.updateBond(this.editingBondName,{mode:e.mode,interfaces:e.interfaces}):await kd.createBond(e),t?.warning&&this.showOperationWarning("warning",t.warning),t?.persistence_warning&&this.showOperationWarning("persistence",t.persistence_warning),t?.failed&&t.failed.length>0&&this.showOperationWarning("partial-success",t.warning||"Some interfaces failed to add",t.failed,t.successfully_added),this.closeBondDrawer()}async handleCreateVLANInterface(){if(!this.vlanFormData.interface||this.vlanFormData.vlanId<=0)return;const e={interface:this.vlanFormData.interface,vlan_id:this.vlanFormData.vlanId,name:this.vlanFormData.name||`${this.vlanFormData.interface}.${this.vlanFormData.vlanId}`};let t;t=this.isEditingVlan?await kd.updateVlan(this.editingVlanName,{vlan_id:e.vlan_id}):await kd.createVlan(e),t?.warning&&this.showOperationWarning("warning",t.warning),t?.persistence_warning&&this.showOperationWarning("persistence",t.persistence_warning),t?.failed&&t.failed.length>0&&this.showOperationWarning("partial-success",t.warning||"Some operations failed",t.failed,t.successfully_added),this.closeVLANDrawer()}renderInterface(e){return J`
      <div class="network-interface">
        <div class="interface-header">
          <span class="interface-name">
            ${e.name}
          </span>
          <span class="interface-state ${"up"===e.state?"state-up":"state-down"}">
            ${e.state}
          </span>
        </div>
        <div class="interface-details">
          <div class="detail-item">
            <span class="detail-label">${n("network.rxBytes")}</span>
            <span class="detail-value">${e.statistics.rx_bytes}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">${n("network.txBytes")}</span>
            <span class="detail-value">${e.statistics.tx_bytes}</span>
          </div>
        </div>
        <div class="interface-actions">
          <button class="action-button primary" @click="${()=>this.toggleInterfaceState(e)}">
            ${n("up"===e.state?"network.bringDown":"network.bringUp")}
          </button>
          <button class="action-button" @click="${()=>this.handleConfigureAddress(e)}">
            ${n("network.configure")}
          </button>
        </div>
      </div>
    `}getPageTitle(){switch(this.activeTab){case"interfaces":return n("network.interfaces");case"bridges":return n("network.bridges");case"bonds":return n("network.bonds");case"vlans":return n("network.vlans");default:return n("network.title")}}filterInterfaces(){let e=this.interfaces;return"all"!==this.selectedType&&(e=e.filter(e=>e.type===this.selectedType)),this.searchQuery&&(e=e.filter(e=>e.name.toLowerCase().includes(this.searchQuery.toLowerCase()))),e}render(){return J`
      <div class="tab-container">
        <h1>${this.getPageTitle()}</h1>

        ${this.operationWarning?J`
          <operation-warning
            .type=${this.operationWarning.type}
            .message=${this.operationWarning.message}
            .failures=${this.operationWarning.failures||[]}
            .successfulItems=${this.operationWarning.successItems||[]}
            @close=${this.dismissOperationWarning}
          ></operation-warning>
        `:""}
        <div class="tab-content">
          ${"interfaces"===this.activeTab?J`
            <div class="filter-container">
              <select 
                class="type-filter-select"
                .value=${this.selectedType}
                @change=${async e=>{this.selectedType=e.target.value,await this.fetchInterfaces()}}
              >
                <option value="all">All Types</option>
                ${this.interfaceTypes.map(e=>J`
                  <option value="${e}">${e}</option>
                `)}
              </select>
              
              <div class="search-container">
                <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input 
                  class="form-input search-input"
                  type="text"
                  placeholder="${n("network.searchInterfaces")}"
                  .value=${this.searchQuery}
                  @input=${e=>this.searchQuery=e.target.value}
                />
              </div>
            </div>
${this.interfaces.length>0?J`
              <table class="network-table">
                <thead>
                  <tr>
                    <th>${n("common.name")}</th>
                    <th>${n("common.state")}</th>
                    <th>IPs</th>
                    <th>${n("network.rxBytes")}</th>
                    <th>${n("network.txBytes")}</th>
                    <th>${n("common.actions")}</th>
                  </tr>
                </thead>
                <tbody>
                  ${this.filterInterfaces().map((e,t)=>J`
                    <tr>
                      <td>
                        <span class="interface-name-link" @click=${()=>this.openDetailsDrawer(e)}>
                          ${e.name}
                        </span>
                      </td>
                      <td>
                        <div class="status-indicator">
                          <span class="status-icon ${"up"===e.state?"up":"down"}" data-tooltip="${"up"===e.state?"Up":"Down"}"></span>
                        </div>
                      </td>
                      <td class="ip-addresses-cell">
                        ${e.addresses&&e.addresses.length>0?e.addresses.length<=3?J`
                                <div class="ip-list">
                                  ${e.addresses.map(e=>J`
                                    <div class="ip-address">${e}</div>
                                  `)}
                                </div>
                              `:J`
                                <div class="ip-list-collapsed">
                                  ${e.addresses.slice(0,2).map(e=>J`
                                    <div class="ip-address">${e}</div>
                                  `)}
                                  <div class="ip-more-indicator">+${e.addresses.length-2} more...</div>
                                </div>
                                <div class="ip-list-expanded">
                                  ${e.addresses.map(e=>J`
                                    <div class="ip-address">${e}</div>
                                  `)}
                                </div>
                              `:J`<span style="color: var(--text-secondary); font-size: 0.85rem;">-</span>`}
                      </td>
                      <td>${e.statistics.rx_bytes}</td>
                      <td>${e.statistics.tx_bytes}</td>
                      <td>
                        <div class="action-menu">
                          <button class="action-dots" @click=${e=>this.toggleActionMenu(e,`interface-${t}`)}>â®</button>
                          <div class="action-dropdown" id="interface-${t}">
                            <button @click=${()=>{this.closeAllMenus(),this.toggleInterfaceState(e)}}>
                              ${"up"===e.state?"Down":"Up"}
                            </button>
                            <button @click=${()=>{this.closeAllMenus(),this.handleConfigureAddress(e)}}>
                              ${n("network.configure")}
                            </button>
                            <button @click=${()=>{this.closeAllMenus(),this.openDetailsDrawer(e)}}>
                              View Details
                            </button>
                          </div>
                        </div>
                      </td>
                    </tr>
                  `)}
                </tbody>
              </table>
            `:J`<div class="empty-state">${n("network.noInterfaces")}</div>`}
          `:""}

          ${"bridges"===this.activeTab?J`
            <div class="interface-search" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <div class="search-container">
                <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input 
                  class="form-input search-input"
                  type="text"
                  placeholder="${n("network.searchBridges")}"
                  .value=${this.bridgeSearchQuery}
                  @input=${e=>this.bridgeSearchQuery=e.target.value}
                />
              </div>
              <button class="action-button primary" @click="${this.openBridgeDrawer}">
                ${this.isEditingBridge?n("common.update"):n("network.createBridge")}
              </button>
            </div>
            
            ${this.bridges.length>0?J`
              <table class="network-table">
                <thead>
                  <tr>
                    <th>${n("common.name")}</th>
                    <th>${n("common.state")}</th>
                    <th>${n("common.actions")}</th>
                  </tr>
                </thead>
                <tbody>
                  ${this.bridges.filter(e=>e.name.toLowerCase().includes(this.bridgeSearchQuery.toLowerCase())).map((e,t)=>J`
                    <tr>
                      <td>
                        <span class="interface-name-link" @click=${()=>this.openDetailsDrawer(e)}>
                          ${e.name}
                        </span>
                      </td>
                      <td>
                        <div class="status-indicator">
                          <span class="status-icon ${"up"===e.state?"up":"down"}" data-tooltip="${"up"===e.state?"Up":"Down"}"></span>
                        </div>
                      </td>
                      <td>
                        <div class="action-menu">
                          <button class="action-dots" @click=${e=>this.toggleActionMenu(e,`bridge-${t}`)}>${"â®"}</button>
                          <div class="action-dropdown" id="bridge-${t}">
                            <button @click=${()=>{this.closeAllMenus(),this.openEditBridgeDrawer(e)}}>
                              ${n("common.edit")}
                            </button>
                            <button class="danger" @click=${()=>{this.closeAllMenus(),this.deleteBridge(e.name)}}>
                              ${n("common.delete")}
                            </button>
                          </div>
                        </div>
                      </td>
                    </tr>
                  `)}
                </tbody>
              </table>
            `:J`<div class="empty-state">${n("network.noBridges")}</div>`}
          `:""}

          ${"bonds"===this.activeTab?J`
            <div class="interface-search" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <div class="search-container">
                <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input 
                  class="form-input search-input"
                  type="text"
                  placeholder="${n("network.searchBonds")}"
                  .value=${this.bondSearchQuery}
                  @input=${e=>this.bondSearchQuery=e.target.value}
                />
              </div>
              <button class="action-button primary" @click="${this.openBondDrawer}">
                ${this.isEditingBond?n("common.update"):n("network.createBond")}
              </button>
            </div>
            
            ${this.bonds.length>0?J`
              <table class="network-table">
                <thead>
                  <tr>
                    <th>${n("common.name")}</th>
                    <th>${n("common.state")}</th>
                    <th>${n("network.mode")}</th>
                    <th>${n("common.actions")}</th>
                  </tr>
                </thead>
                <tbody>
                  ${this.bonds.filter(e=>e.name.toLowerCase().includes(this.bondSearchQuery.toLowerCase())).map((e,t)=>J`
                    <tr>
                      <td>${e.name}</td>
                      <td>
                        <div class="status-indicator">
                          <span class="status-icon ${"up"===e.state?"up":"down"}" data-tooltip="${"up"===e.state?"Up":"Down"}"></span>
                        </div>
                      </td>
                      <td>${e.mode||"N/A"}</td>
                      <td>
                        <div class="action-menu">
                          <button class="action-dots" @click=${e=>this.toggleActionMenu(e,`bond-${t}`)}>${"â®"}</button>
                          <div class="action-dropdown" id="bond-${t}">
                            <button @click=${()=>{this.closeAllMenus(),this.openEditBondDrawer(e)}}>
                              ${n("common.edit")}
                            </button>
                            <button class="danger" @click=${()=>{this.closeAllMenus(),this.deleteBond(e.name)}}>
                              ${n("common.delete")}
                            </button>
                          </div>
                        </div>
                      </td>
                    </tr>
                  `)}
                </tbody>
              </table>
            `:J`<div class="empty-state">${n("network.noBonds")}</div>`}
          `:""}

          ${"vlans"===this.activeTab?J`
            <div class="interface-search" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <div class="search-container">
                <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input 
                  class="form-input search-input"
                  type="text"
                  placeholder="${n("network.searchVLANs")}"
                  .value=${this.vlanSearchQuery}
                  @input=${e=>this.vlanSearchQuery=e.target.value}
                />
              </div>
              <button class="action-button primary" @click="${this.openVLANDrawer}">
                ${this.isEditingVlan?n("common.update"):n("network.createVLAN")}
              </button>
            </div>
            
            ${this.vlans.length>0?J`
              <table class="network-table">
                <thead>
                  <tr>
                    <th>${n("common.name")}</th>
                    <th>${n("common.state")}</th>
                    <th>${n("common.actions")}</th>
                  </tr>
                </thead>
                <tbody>
                  ${this.vlans.filter(e=>e.name.toLowerCase().includes(this.vlanSearchQuery.toLowerCase())).map((e,t)=>J`
                    <tr>
                      <td>${e.name}</td>
                      <td>
                        <div class="status-indicator">
                          <span class="status-icon ${"up"===e.state?"up":"down"}" data-tooltip="${"up"===e.state?"Up":"Down"}"></span>
                        </div>
                      </td>
                      <td>
                        <div class="action-menu">
                          <button class="action-dots" @click=${e=>this.toggleActionMenu(e,`vlan-${t}`)}>${"â®"}</button>
                          <div class="action-dropdown" id="vlan-${t}">
                            <button @click=${()=>{this.closeAllMenus(),this.openEditVlanDrawer(e)}}>
                              ${n("common.edit")}
                            </button>
                            <button class="danger" @click=${()=>{this.closeAllMenus(),this.deleteVlan(e.name)}}>
                              ${n("common.delete")}
                            </button>
                          </div>
                        </div>
                      </td>
                    </tr>
                  `)}
                </tbody>
              </table>
            `:J`<div class="empty-state">${n("network.noVLANs")}</div>`}
          `:""}
        </div>
      </div>

      <modal-dialog
        ?open=${this.showConfirmModal}
        .title=${this.confirmTitle}
        size="small"
        @modal-close=${this.handleCancel}
      >
        <p>${this.confirmMessage}</p>
        <div slot="footer" style="display: flex; gap: 8px; justify-content: flex-end;">
          <button class="action-button" @click=${this.handleCancel}>
            ${n("common.cancel")}
          </button>
          <button class="action-button primary" @click=${this.handleConfirm}>
            ${n("common.confirm")}
          </button>
        </div>
      </modal-dialog>

      ${this.showConfigureDrawer?J`
        <div class="drawer">
          <button class="close-btn" @click="${()=>this.closeConfigureDrawer()}">Ã</button>
          <div class="drawer-content">
            <h2>${n("network.configureInterface")}</h2>
            ${this.configureNetworkInterface?J`
              <form @submit=${e=>{e.preventDefault(),this.submitConfigureAddress()}}>
                <div class="detail-item" style="margin-bottom: 16px;">
                  <span class="detail-label">${n("network.interfaceName")}</span>
                  <span class="detail-value">${this.configureNetworkInterface.name}</span>
                </div>
                <div class="detail-item" style="margin-bottom: 16px;">
                  <span class="detail-label">${n("network.currentState")}</span>
                  <span class="detail-value">${this.configureNetworkInterface.state}</span>
                </div>
                
                <div class="form-group">
                  <label class="form-label" for="address">${n("network.ipAddressRequired")}</label>
                  <input 
                    id="address"
                    class="form-input" 
                    type="text" 
                    placeholder="192.168.1.100"
                    .value=${this.configureFormData.address}
                    @input=${e=>this.configureFormData.address=e.target.value}
                    required
                  />
                </div>
                
                <div class="form-group">
                  <label class="form-label" for="netmask">${n("network.netmaskCidrRequired")}</label>
                  <input 
                    id="netmask"
                    class="form-input" 
                    type="number" 
                    min="0" 
                    max="32" 
                    placeholder="24"
                    .value=${this.configureFormData.netmask}
                    @input=${e=>this.configureFormData.netmask=parseInt(e.target.value)||24}
                    required
                  />
                </div>
                
                <div class="form-group">
                  <label class="form-label" for="gateway">${n("network.gatewayOptional")}</label>
                  <input 
                    id="gateway"
                    class="form-input" 
                    type="text" 
                    placeholder="192.168.1.1"
                    .value=${this.configureFormData.gateway}
                    @input=${e=>this.configureFormData.gateway=e.target.value}
                  />
                </div>
                
                <div class="form-actions">
                  <button type="button" class="action-button" @click="${()=>this.closeConfigureDrawer()}">
                    ${n("common.cancel")}
                  </button>
                  <button type="submit" class="action-button primary">
                    ${n("network.applyConfiguration")}
                  </button>
                </div>
              </form>
            `:null}
          </div>
        </div>
      `:null}

      ${this.showBridgeDrawer?J`
        <div class="drawer">
          <button class="close-btn" @click="${()=>this.closeBridgeDrawer()}">Ã</button>
          <div class="drawer-content">
            <h2>${this.isEditingBridge?n("network.editBridgeTitle"):n("network.createBridgeTitle")}</h2>
            <form @submit=${e=>{e.preventDefault(),this.handleCreateBridge()}}>
              <div class="form-group">
                <label class="form-label" for="bridge-name">${n("network.bridgeNameRequired")}</label>
                <input 
                  id="bridge-name"
                  class="form-input" 
                  type="text" 
                  placeholder="br0"
                  .value=${this.bridgeFormData.name}
                  @input=${e=>this.bridgeFormData.name=e.target.value}
                  required
                  ?disabled=${this.isEditingBridge}
                />
              </div>
              
              <div class="form-group">
                <label class="form-label" for="bridge-interfaces">${n("network.interfacesRequired")}</label>
                <div class="autocomplete-container">
                  <input 
                    id="bridge-interfaces"
                    class="form-input" 
                    type="text" 
                    placeholder="eth0, eth1"
                    .value=${this.bridgeInterfaceInputValue}
                    @input=${e=>{this.bridgeFormData.interfaces=e.target.value,this.handleBridgeInterfaceInput(e)}}
                    @keydown=${e=>this.handleBridgeInterfaceKeyDown(e)}
                    @blur=${()=>this.closeBridgeInterfacesSuggestions()}
                    autocomplete="off"
                    required
                  />
                  ${this.showBridgeInterfacesSuggestions&&this.getFilteredSuggestions().length>0?J`
                    <div class="autocomplete-suggestions">
                      ${this.getFilteredSuggestions().map((e,t)=>J`
                        <div 
                          class="autocomplete-suggestion ${t===this.selectedSuggestionIndex?"selected":""}"
                          @mousedown=${t=>{t.preventDefault(),this.selectSuggestion(e)}}
                        >
                          ${e}
                        </div>
                      `)}
                    </div>
                  `:""}
                </div>
                <small style="display: block; margin-top: 0.25rem; color: var(--text-secondary); font-size: 0.75rem;">
                  ${n("network.commaSeparatedInterfaces")}
                </small>
              </div>
              
              <div class="form-actions">
                <button type="button" class="action-button" @click="${()=>this.closeBridgeDrawer()}">
                  ${n("common.cancel")}
                </button>
                <button type="submit" class="action-button primary">
                  ${this.isEditingBridge?n("common.update"):n("network.createBridge")}
                </button>
              </div>
            </form>
          </div>
        </div>
      `:null}

      ${this.showBondDrawer?J`
        <div class="drawer">
          <button class="close-btn" @click="${()=>this.closeBondDrawer()}">Ã</button>
          <div class="drawer-content">
            <h2>${this.isEditingBond?n("network.editBondTitle"):n("network.createBondTitle")}</h2>
            <form @submit=${e=>{e.preventDefault(),this.handleCreateBond()}}>
              <div class="form-group">
                <label class="form-label" for="bond-name">${n("network.bondNameRequired")}</label>
                <input 
                  id="bond-name"
                  class="form-input" 
                  type="text" 
                  placeholder="bond0"
                  .value=${this.bondFormData.name}
                  @input=${e=>this.bondFormData.name=e.target.value}
                  required
                  ?disabled=${this.isEditingBond}
                />
              </div>
              
              <div class="form-group">
                <label class="form-label" for="bond-mode">${n("network.modeRequired")}</label>
                <select 
                  id="bond-mode"
                  class="form-select" 
                  .value=${this.bondFormData.mode}
                  @input=${e=>this.bondFormData.mode=e.target.value}
                  required
                >
                  <option value="balance-rr">balance-rr (Round-robin)</option>
                  <option value="active-backup">active-backup</option>
                  <option value="balance-xor">balance-xor</option>
                  <option value="broadcast">broadcast</option>
                  <option value="802.3ad">802.3ad (LACP)</option>
                  <option value="balance-tlb">balance-tlb</option>
                  <option value="balance-alb">balance-alb</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="bond-interfaces">${n("network.interfacesRequired")}</label>
                <div class="autocomplete-container">
                  <input 
                    id="bond-interfaces"
                    class="form-input" 
                    type="text" 
                    placeholder="eth2, eth3"
                    .value=${this.bondInterfaceInputValue}
                    @input=${e=>{this.bondFormData.interfaces=e.target.value,this.handleBondInterfaceInput(e)}}
                    @keydown=${e=>this.handleBondInterfaceKeyDown(e)}
                    @blur=${()=>this.closeBondInterfacesSuggestions()}
                    autocomplete="off"
                    required
                  />
                  ${this.showBondInterfacesSuggestions&&this.getFilteredBondSuggestions().length>0?J`
                    <div class="autocomplete-suggestions">
                      ${this.getFilteredBondSuggestions().map((e,t)=>J`
                        <div 
                          class="autocomplete-suggestion ${t===this.selectedBondSuggestionIndex?"selected":""}"
                          @mousedown=${t=>{t.preventDefault(),this.selectBondSuggestion(e)}}
                        >
                          ${e}
                        </div>
                      `)}
                    </div>
                  `:""}
                </div>
                <small style="display: block; margin-top: 0.25rem; color: var(--text-secondary); font-size: 0.75rem;">
                  ${n("network.commaSeparatedInterfaces")}
                </small>
              </div>
              
              
              <div class="form-actions">
                <button type="button" class="action-button" @click="${()=>this.closeBondDrawer()}">
                  ${n("common.cancel")}
                </button>
                <button type="submit" class="action-button primary">
                  ${this.isEditingBond?n("common.update"):n("network.createBond")}
                </button>
              </div>
            </form>
          </div>
        </div>
      `:null}

      ${this.showVLANDrawer?J`
        <div class="drawer">
          <button class="close-btn" @click="${()=>this.closeVLANDrawer()}">Ã</button>
          <div class="drawer-content">
            <h2>${this.isEditingVlan?n("network.editVlanTitle"):n("network.createVlanTitle")}</h2>
            <form @submit=${e=>{e.preventDefault(),this.handleCreateVLANInterface()}}>
              <div class="form-group">
                <label class="form-label" for="vlan-interface">${n("network.baseInterfaceRequired")}</label>
                <div class="autocomplete-container">
                  <input 
                    id="vlan-interface"
                    class="form-input" 
                    type="text" 
                    placeholder="eth0"
                    .value=${this.vlanInterfaceInputValue}
                    ?disabled=${this.isEditingVlan}
                    @input=${e=>{this.vlanFormData.interface=e.target.value,this.handleVlanInterfaceInput(e)}}
                    @keydown=${e=>this.handleVlanInterfaceKeyDown(e)}
                    @blur=${()=>this.closeVlanInterfacesSuggestions()}
                    autocomplete="off"
                    required
                  />
                  ${this.showVlanInterfacesSuggestions&&this.getFilteredVlanSuggestions().length>0?J`
                    <div class="autocomplete-suggestions">
                      ${this.getFilteredVlanSuggestions().map((e,t)=>J`
                        <div 
                          class="autocomplete-suggestion ${t===this.selectedVlanSuggestionIndex?"selected":""}"
                          @mousedown=${t=>{t.preventDefault(),this.selectVlanSuggestion(e)}}
                        >
                          ${e}
                        </div>
                      `)}
                    </div>
                  `:""}
                </div>
              </div>
              
              
              <div class="form-group">
                <label class="form-label" for="vlan-id">${n("network.vlanIdRequired")}</label>
                <input 
                  id="vlan-id"
                  class="form-input" 
                  type="number"
                  min="1"
                  max="4094"
                  placeholder="100"
                  .value=${this.vlanFormData.vlanId}
                  @input=${e=>this.vlanFormData.vlanId=parseInt(e.target.value)||0}
                  required
                />
              </div>

              <div class="form-group">
                <label class="form-label" for="vlan-name">${n("network.vlanNameOptional")}</label>
                <input 
                  id="vlan-name"
                  class="form-input" 
                  type="text"
                  placeholder="eth0.100"
                  .value=${this.vlanFormData.name}
                  @input=${e=>this.vlanFormData.name=e.target.value}
                  ?disabled=${this.isEditingVlan}
                />
                <small style="display: block; margin-top: 0.25rem; color: var(--text-secondary); font-size: 0.75rem;">
                  ${n("network.vlanNameDefault")}
                </small>
              </div>

              <div class="form-actions">
                <button type="button" class="action-button" @click="${()=>this.closeVLANDrawer()}">
                  ${n("common.cancel")}
                </button>
                <button type="submit" class="action-button primary">
                  ${this.isEditingVlan?n("common.update"):n("network.createVLAN")}
                </button>
              </div>
            </form>
          </div>
        </div>
      `:null}

      ${this.showDetailsDrawer&&this.selectedInterface?J`
        <div class="drawer">
          <button class="close-btn" @click="${()=>this.closeDetailsDrawer()}">Ã</button>
          <div class="drawer-content">
            <h2>Interface Details: ${this.selectedInterface.name}</h2>
            
            <!-- Interface Information Section -->
            <div class="interface-info-section">
              <div class="interface-info-grid">
                <div class="info-item">
                  <div class="info-label">Status</div>
                  <div class="info-value">
                    <span class="interface-state ${"up"===this.selectedInterface.state?"state-up":"state-down"}">
                      ${this.selectedInterface.state}
                    </span>
                  </div>
                </div>
                <div class="info-item">
                  <div class="info-label">Type</div>
                  <div class="info-value">${this.selectedInterface.type||"Unknown"}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">MAC Address</div>
                  <div class="info-value">${this.selectedInterface.mac||"N/A"}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">MTU</div>
                  <div class="info-value">${this.selectedInterface.mtu||"N/A"}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">RX Bytes</div>
                  <div class="info-value">${this.selectedInterface.statistics.rx_bytes}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">TX Bytes</div>
                  <div class="info-value">${this.selectedInterface.statistics.tx_bytes}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">RX Packets</div>
                  <div class="info-value">${this.selectedInterface.statistics.rx_packets}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">TX Packets</div>
                  <div class="info-value">${this.selectedInterface.statistics.tx_packets}</div>
                </div>
              </div>
            </div>

            <!-- IP Addresses Section -->
            <div class="section-header">
              <h3 class="section-title">IP Addresses</h3>
              <button class="add-btn" @click="${()=>this.openAddIpModal()}">
                + Add IP
              </button>
            </div>

            <!-- IP Addresses Table -->
            ${this.selectedInterface.addresses&&this.selectedInterface.addresses.length>0?J`
              <table class="details-table">
                <thead>
                  <tr>
                    <th>IP Address</th>
                    <th style="text-align: right;">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  ${this.selectedInterface.addresses.map((e,t)=>J`
                    <tr>
                      <td>${e}</td>
                      <td style="text-align: right;">
                        <div class="action-menu">
                          <button class="action-dots" @click=${e=>this.toggleActionMenu(e,`ip-${t}`)}>
                            â®
                          </button>
                          <div class="action-dropdown" id="ip-${t}">
                            <button @click=${()=>{this.closeAllMenus(),this.openEditIpModal(t,e)}}>
                              Edit
                            </button>
                            <button class="danger" @click=${()=>{this.closeAllMenus(),this.deleteIpAddress(e)}}>
                              Delete
                            </button>
                          </div>
                        </div>
                      </td>
                    </tr>
                  `)}
                </tbody>
              </table>
            `:J`
              <div class="empty-state" style="padding: 2rem; text-align: center;">
                <p style="color: var(--text-secondary); margin-bottom: 1rem;">No IP addresses configured</p>
                <button class="action-button primary" @click="${()=>this.openAddIpModal()}">
                  Add First IP Address
                </button>
              </div>
            `}

            <!-- Member Interfaces Section (for bridges/bonds) -->
            ${this.selectedInterface.interfaces&&this.selectedInterface.interfaces.length>0?J`
              <div class="section-header" style="margin-top: 2rem;">
                <h3 class="section-title">Member Interfaces</h3>
              </div>
              <table class="details-table">
                <thead>
                  <tr>
                    <th>Interface Name</th>
                  </tr>
                </thead>
                <tbody>
                  ${this.selectedInterface.interfaces.map(e=>J`
                    <tr>
                      <td>${e}</td>
                    </tr>
                  `)}
                </tbody>
              </table>
            `:""}

            <!-- Interface Actions -->
            <div class="form-actions" style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
              <button class="action-button" @click="${()=>this.closeDetailsDrawer()}">
                Close
              </button>
              <button class="action-button ${"up"===this.selectedInterface.state?"":"primary"}" 
                      @click="${()=>{this.toggleInterfaceState(this.selectedInterface),this.closeDetailsDrawer()}}">
                ${"up"===this.selectedInterface.state?"Bring Down":"Bring Up"}
              </button>
            </div>
          </div>
        </div>
      `:null}

      <!-- Add IP Modal -->
      <modal-dialog
        ?open=${this.showAddIpModal}
        .title="Add IP Address"
        size="medium"
        .showFooter=${!1}
        @modal-close=${()=>this.closeAddIpModal()}
      >
        <form @submit=${e=>{e.preventDefault(),this.addNewIpAddress()}}>
          <div class="form-group">
            <label class="form-label" for="modal-ip-address">IP Address *</label>
            <input 
              id="modal-ip-address"
              class="form-input" 
              type="text" 
              placeholder="192.168.1.100"
              .value=${this.newIpAddress}
              @input=${e=>this.newIpAddress=e.target.value}
              required
              autofocus
            />
          </div>
          
          <div class="form-group">
            <label class="form-label" for="modal-netmask">Netmask (CIDR) *</label>
            <input 
              id="modal-netmask"
              class="form-input" 
              type="number" 
              min="0" 
              max="32" 
              placeholder="24"
              .value=${this.newIpNetmask}
              @input=${e=>this.newIpNetmask=parseInt(e.target.value)||24}
              required
            />
          </div>
          
          <div class="form-group">
            <label class="form-label" for="modal-gateway">Gateway (Optional)</label>
            <input 
              id="modal-gateway"
              class="form-input" 
              type="text" 
              placeholder="192.168.1.1"
              .value=${this.newIpGateway}
              @input=${e=>this.newIpGateway=e.target.value}
            />
          </div>
          
          <div slot="footer" style="display: flex; gap: 8px; justify-content: flex-end;">
            <button type="button" class="action-button" @click=${()=>this.closeAddIpModal()}>
              ${n("common.cancel")}
            </button>
            <button type="submit" class="action-button primary">
              Add IP Address
            </button>
          </div>
        </form>
      </modal-dialog>

      <!-- Edit IP Modal -->
      <modal-dialog
        ?open=${this.showEditIpModal}
        .title="Edit IP Address"
        size="medium"
        .showFooter=${!1}
        @modal-close=${()=>this.closeEditIpModal()}
      >
        <form @submit=${e=>{e.preventDefault(),this.saveEditedIp()}}>
          <div class="form-group">
            <label class="form-label" for="edit-ip-address">IP Address *</label>
            <input 
              id="edit-ip-address"
              class="form-input" 
              type="text" 
              placeholder="192.168.1.100"
              .value=${this.editIpAddress}
              @input=${e=>this.editIpAddress=e.target.value}
              required
              autofocus
            />
          </div>
          
          <div class="form-group">
            <label class="form-label" for="edit-netmask">Netmask (CIDR) *</label>
            <input 
              id="edit-netmask"
              class="form-input" 
              type="number" 
              min="0" 
              max="32" 
              placeholder="24"
              .value=${this.editIpNetmask}
              @input=${e=>this.editIpNetmask=parseInt(e.target.value)||24}
              required
            />
          </div>
          
          <div class="form-group">
            <label class="form-label" for="edit-gateway">Gateway (Optional)</label>
            <input 
              id="edit-gateway"
              class="form-input" 
              type="text" 
              placeholder="192.168.1.1"
              .value=${this.editIpGateway}
              @input=${e=>this.editIpGateway=e.target.value}
            />
          </div>

          <div class="form-group" style="background-color: var(--surface-0); padding: 0.75rem; border-radius: 4px; border: 1px solid var(--border-color);">
            <div class="info-label" style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Original IP Address</div>
            <div class="info-value" style="font-size: 0.9rem; color: var(--text-primary);">${this.originalIpAddress}</div>
          </div>
          
          <div slot="footer" style="display: flex; gap: 8px; justify-content: flex-end;">
            <button type="button" class="action-button" @click=${()=>this.closeEditIpModal()}>
              ${n("common.cancel")}
            </button>
            <button type="submit" class="action-button primary">
              Save Changes
            </button>
          </div>
        </form>
      </modal-dialog>
    `}}Pd([we({type:String})],Ld.prototype,"subRoute"),Pd([xe()],Ld.prototype,"activeTab"),Pd([xe()],Ld.prototype,"showConfigureDrawer"),Pd([xe()],Ld.prototype,"showDetailsDrawer"),Pd([xe()],Ld.prototype,"editingIpIndex"),Pd([xe(),xe()],Ld.prototype,"showAddIpModal"),Pd([xe()],Ld.prototype,"showEditIpModal"),Pd([xe()],Ld.prototype,"editIpAddress"),Pd([xe()],Ld.prototype,"editIpNetmask"),Pd([xe()],Ld.prototype,"editIpGateway"),Pd([xe()],Ld.prototype,"originalIpAddress"),Pd([xe()],Ld.prototype,"newIpAddress"),Pd([xe()],Ld.prototype,"newIpNetmask"),Pd([xe()],Ld.prototype,"newIpGateway"),Pd([xe()],Ld.prototype,"showBridgeDrawer"),Pd([xe()],Ld.prototype,"isEditingBridge"),Pd([xe()],Ld.prototype,"editingBridgeName"),Pd([xe()],Ld.prototype,"bridgeFormData"),Pd([xe()],Ld.prototype,"showBondDrawer"),Pd([xe()],Ld.prototype,"isEditingBond"),Pd([xe()],Ld.prototype,"editingBondName"),Pd([xe()],Ld.prototype,"bondFormData"),Pd([xe()],Ld.prototype,"vlanFormData"),Pd([xe()],Ld.prototype,"showVLANDrawer"),Pd([xe()],Ld.prototype,"interfaceTypes"),Pd([xe()],Ld.prototype,"isEditingVlan"),Pd([xe()],Ld.prototype,"editingVlanName"),Pd([xe()],Ld.prototype,"operationWarning"),Pd([xe()],Ld.prototype,"configureNetworkInterface"),Pd([xe()],Ld.prototype,"configureFormData"),Pd([xe()],Ld.prototype,"showConfirmModal"),Pd([xe()],Ld.prototype,"confirmAction"),Pd([xe()],Ld.prototype,"confirmTitle"),Pd([xe()],Ld.prototype,"confirmMessage"),Pd([xe()],Ld.prototype,"availableInterfacesForBridge"),Pd([xe()],Ld.prototype,"showBridgeInterfacesSuggestions"),Pd([xe()],Ld.prototype,"bridgeInterfaceInputValue"),Pd([xe()],Ld.prototype,"selectedSuggestionIndex"),Pd([xe()],Ld.prototype,"bondInterfaceInputValue"),Pd([xe()],Ld.prototype,"showBondInterfacesSuggestions"),Pd([xe()],Ld.prototype,"selectedBondSuggestionIndex"),Pd([xe()],Ld.prototype,"vlanInterfaceInputValue"),Pd([xe()],Ld.prototype,"showVlanInterfacesSuggestions"),Pd([xe()],Ld.prototype,"selectedVlanSuggestionIndex"),customElements.define("network-tab",Ld);var Rd=Object.defineProperty,Od=(e,t,s,i)=>{for(var o,r=void 0,a=e.length-1;a>=0;a--)(o=e[a])&&(r=o(t,s,r)||r);return r&&Rd(t,s,r),r};class Nd extends dt{constructor(){super(...arguments),this.disks=[],this.volumeGroups=[],this.logicalVolumes=[],this.physicalVolumes=[],this.raidDevices=[],this.availableRaidDisks=[],this.iscsiTargets=[],this.iscsiSessions=[],this.multipathDevices=[],this.btrfsSubvolumes=[],this.activeSection="disks",this.subRoute=null,this.loading=!1,this.error=""}static{this.styles=g`
    :host {
      display: block;
      height: 100%;
      overflow-y: auto;
    }

    .storage-container {
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      margin: 0 0 24px 0;
      font-size: 24px;
      font-weight: 300;
    }


    .card {
      background: var(--vscode-bg-light);
      border: 1px solid var(--vscode-border);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 500;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      font-size: 13px;
    }

    .info-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .info-label {
      color: var(--vscode-text-dim);
      font-size: 12px;
    }

    .info-value {
      color: var(--vscode-text);
      font-family: var(--vscode-font-family-mono);
    }

    .actions {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--vscode-bg);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 4px;
    }

    .progress-fill {
      height: 100%;
      background: var(--vscode-accent);
      transition: width 0.3s ease;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .table th,
    .table td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid var(--vscode-border);
    }

    .table th {
      font-weight: 500;
      color: var(--vscode-text-dim);
    }

    .status-badge {
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
    }

    .status-badge.active {
      background: var(--vscode-success);
      color: white;
    }

    .status-badge.inactive {
      background: var(--vscode-text-dim);
      color: white;
    }

    .status-badge.error {
      background: var(--vscode-error);
      color: white;
    }

    button {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--vscode-accent);
      color: white;
    }

    .btn-primary:hover {
      background: var(--vscode-accent-hover);
    }

    .btn-secondary {
      background: var(--vscode-bg);
      color: var(--vscode-text);
      border: 1px solid var(--vscode-border);
    }

    .btn-secondary:hover {
      background: var(--vscode-bg-light);
    }

    .btn-danger {
      background: var(--vscode-error);
      color: white;
    }

    .btn-danger:hover {
      opacity: 0.9;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: var(--vscode-text-dim);
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: var(--vscode-text-dim);
    }

    .error {
      color: var(--vscode-error);
      padding: 16px;
      background: var(--vscode-bg-light);
      border-radius: 8px;
      margin-bottom: 16px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      margin-bottom: 4px;
      font-size: 13px;
      color: var(--vscode-text-dim);
    }

    .form-input {
      width: 100%;
      padding: 6px 8px;
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      background: var(--vscode-bg);
      color: var(--vscode-text);
      font-size: 13px;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--vscode-accent);
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-content {
      background: var(--vscode-bg-light);
      border-radius: 8px;
      padding: 24px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 500;
    }

    .close-button {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: var(--vscode-text-dim);
    }

    .disk-row-flat {
      background: var(--vscode-sidebar);
      border-left: 3px solid var(--vscode-accent);
    }

    .disk-row-flat td:first-child {
      font-weight: 500;
    }

    .disk-row-flat td:first-child strong {
      font-size: 1.05em;
    }

    .partition-row-flat {
      background: var(--vscode-editor);
      border-left: 3px solid var(--vscode-border);
    }

    .partition-row-flat:hover {
      background: var(--vscode-sidebar-hover);
    }
  `}static get properties(){return{subRoute:{type:String,attribute:"sub-route"}}}connectedCallback(){super.connectedCallback(),this.handlePopState=this.handlePopState.bind(this),window.addEventListener("popstate",this.handlePopState),this.updateActiveSection(),this.loadData()}updated(e){e.has("subRoute")&&(this.updateActiveSection(),this.loadData())}updateActiveSection(){if(this.subRoute&&["disks","lvm","raid","iscsi","multipath","btrfs"].includes(this.subRoute))return void(this.activeSection=this.subRoute);const e=window.location.pathname.split("/"),t=e[e.length-1];t&&["disks","lvm","raid","iscsi","multipath","btrfs"].includes(t)&&(this.activeSection=t)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("popstate",this.handlePopState)}handlePopState(){const e=window.location.pathname.split("/"),t=e[e.length-1];t&&["disks","lvm","raid","iscsi","multipath","btrfs"].includes(t)&&(this.activeSection=t,this.loadData())}async loadData(){this.loading=!0,this.error="";try{switch(this.activeSection){case"disks":await this.fetchDisks();break;case"lvm":await this.fetchLVM();break;case"raid":await this.fetchRAID();break;case"iscsi":await this.fetchiSCSI();break;case"multipath":await this.fetchMultipath();break;case"btrfs":await this.fetchBTRFS()}}catch(e){const t=e?.message||"Failed to load data",s=e?.details||"";this.error=s?`${t}: ${s}`:t,console.error("Storage tab error:",e)}finally{this.loading=!1}}async fetchDisks(){try{const e=await mc.get("/storage/disks");this.disks=e?.disks||[]}catch(e){throw console.error("Error fetching disks:",e),this.disks=[],e}}async fetchLVM(){try{const[e,t,s]=await Promise.all([mc.get("/storage/lvm/vgs"),mc.get("/storage/lvm/lvs"),mc.get("/storage/lvm/pvs")]);this.volumeGroups=e?.volume_groups||[],this.logicalVolumes=t?.logical_volumes||[],this.physicalVolumes=s?.physical_volumes||[]}catch(e){throw console.error("Error fetching LVM data:",e),this.volumeGroups=[],this.logicalVolumes=[],this.physicalVolumes=[],e}}async fetchRAID(){try{const[e,t]=await Promise.all([mc.get("/storage/raid/devices"),mc.get("/storage/raid/available-disks")]);this.raidDevices=e?.devices||[],this.availableRaidDisks=t?.disks||[]}catch(e){throw console.error("Error fetching RAID data:",e),this.raidDevices=[],this.availableRaidDisks=[],e}}async fetchiSCSI(){try{const e=await mc.get("/storage/iscsi/sessions");this.iscsiSessions=e?.sessions||[]}catch(e){throw console.error("Error fetching iSCSI data:",e),this.iscsiSessions=[],e}}async fetchMultipath(){try{const e=await mc.get("/storage/multipath/devices");this.multipathDevices=e?.devices||[]}catch(e){throw console.error("Error fetching multipath data:",e),this.multipathDevices=[],e}}async fetchBTRFS(){this.btrfsSubvolumes=[]}formatBytes(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB"][t]}renderDisksSection(){return 0===this.disks.length?J`<div class="empty-state">${n("storage.disks.empty")}</div>`:J`
      ${this.disks.map(e=>J`
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">${e.name} - ${e.model||"Unknown Model"}</h3>
            <span>${this.formatBytes(e.size)}</span>
          </div>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">${n("storage.disks.type")}</span>
              <span class="info-value">${e.type}</span>
            </div>
            <div class="info-item">
              <span class="info-label">${n("storage.disks.serial")}</span>
              <span class="info-value">${e.serial||"N/A"}</span>
            </div>
            <div class="info-item">
              <span class="info-label">${n("storage.disks.removable")}</span>
              <span class="info-value">${e.removable?n("common.yes"):n("common.no")}</span>
            </div>
          </div>
          
          ${e.partitions&&e.partitions.length>0?J`
            <h4>${n("storage.disks.partitions")}</h4>
            <table class="table">
              <thead>
                <tr>
                  <th>${n("storage.disks.partition")}</th>
                  <th>${n("storage.disks.filesystem")}</th>
                  <th>${n("storage.disks.size")}</th>
                  <th>${n("storage.disks.used")}</th>
                  <th>${n("storage.disks.mountpoint")}</th>
                  <th>${n("common.actions")}</th>
                </tr>
              </thead>
              <tbody>
                ${e.partitions.map(e=>J`
                  <tr>
                    <td>${e.name}</td>
                    <td>${e.filesystem||"Unknown"}</td>
                    <td>${this.formatBytes(e.size)}</td>
                    <td>
                      ${e.used?J`
                        <div>
                          ${this.formatBytes(e.used)} (${e.use_percent?.toFixed(1)}%)
                          <div class="progress-bar">
                            <div class="progress-fill" style="width: ${e.use_percent}%"></div>
                          </div>
                        </div>
                      `:"N/A"}
                    </td>
                    <td>${e.mount_point||"Not mounted"}</td>
                    <td>
                      ${e.mount_point?J`
                        <button class="btn-danger" @click=${()=>this.unmountPartition(e.mount_point)}>
                          ${n("storage.disks.unmount")}
                        </button>
                      `:J`
                        <button class="btn-primary" @click=${()=>this.mountPartition(e.path,`/mnt/${e.name}`)}>
                          ${n("storage.disks.mount")}
                        </button>
                      `}
                    </td>
                  </tr>
                `)}
              </tbody>
            </table>
          `:""}
        </div>
      `)}
    `}renderDisksFlatSection(){return 0===this.disks.length?J`<div class="empty-state">${n("storage.disks.empty")}</div>`:J`
      <table class="table">
        <thead>
          <tr>
            <th>${n("common.name")}</th>
            <th>${n("storage.disks.size")}</th>
            <th>${n("storage.disks.type")}</th>
            <th>${n("storage.disks.serial")}</th>
            <th>${n("storage.disks.removable")}</th>
            <th>${n("storage.disks.filesystem")}</th>
            <th>${n("storage.disks.used")}</th>
            <th>${n("storage.disks.mountpoint")}</th>
          </tr>
        </thead>
        <tbody>
          ${this.disks.map(e=>{const t=e.partitions&&e.partitions.length>0;return J`
              <tr class="disk-row-flat">
                <td>
                  <strong>${e.name}</strong>
                  <div style="font-size: 0.85em; color: var(--text-secondary); margin-top: 2px;">
                    ${e.model||"Unknown Model"}
                  </div>
                </td>
                <td>${this.formatBytes(e.size)}</td>
                <td>${e.type}</td>
                <td>${e.serial||"N/A"}</td>
                <td>${e.removable?n("common.yes"):n("common.no")}</td>
                <td colspan="3" style="color: var(--text-secondary); font-style: italic;">
                  ${t?`${e.partitions.length} partition(s)`:"No partitions"}
                </td>
              </tr>
              ${t?e.partitions.map(e=>J`
                <tr class="partition-row-flat">
                  <td style="padding-left: 32px;">
                    â ${e.name}
                  </td>
                  <td>${this.formatBytes(e.size)}</td>
                  <td>-</td>
                  <td>-</td>
                  <td>-</td>
                  <td>${e.filesystem||"Unknown"}</td>
                  <td>
                    ${e.used?J`
                      <div>
                        ${this.formatBytes(e.used)} (${e.use_percent?.toFixed(1)}%)
                        <div class="progress-bar">
                          <div class="progress-fill" style="width: ${e.use_percent}%"></div>
                        </div>
                      </div>
                    `:"N/A"}
                  </td>
                  <td>${e.mount_point||"Not mounted"}</td>
                </tr>
              `):""}
            `})}
        </tbody>
      </table>
    `}renderLVMSection(){return J`
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">${n("storage.lvm.volumeGroups")}</h3>
          <button class="btn-primary" @click=${this.showCreateVGDialog}>
            ${n("storage.lvm.createVG")}
          </button>
        </div>
        
        ${0===this.volumeGroups.length?J`
          <div class="empty-state">${n("storage.lvm.noVolumeGroups")}</div>
        `:J`
          <table class="table">
            <thead>
              <tr>
                <th>${n("common.name")}</th>
                <th>${n("storage.lvm.size")}</th>
                <th>${n("storage.lvm.free")}</th>
                <th>${n("storage.lvm.pvCount")}</th>
                <th>${n("storage.lvm.lvCount")}</th>
              </tr>
            </thead>
            <tbody>
              ${this.volumeGroups.map(e=>J`
                <tr>
                  <td>${e.name}</td>
                  <td>${this.formatBytes(e.size)}</td>
                  <td>${this.formatBytes(e.free)}</td>
                  <td>${e.pv_count}</td>
                  <td>${e.lv_count}</td>
                </tr>
              `)}
            </tbody>
          </table>
        `}
      </div>

      <div class="card">
        <div class="card-header">
          <h3 class="card-title">${n("storage.lvm.logicalVolumes")}</h3>
          <button class="btn-primary" @click=${this.showCreateLVDialog}>
            ${n("storage.lvm.createLV")}
          </button>
        </div>
        
        ${0===this.logicalVolumes.length?J`
          <div class="empty-state">${n("storage.lvm.noLogicalVolumes")}</div>
        `:J`
          <table class="table">
            <thead>
              <tr>
                <th>${n("common.name")}</th>
                <th>${n("storage.lvm.volumeGroup")}</th>
                <th>${n("storage.lvm.size")}</th>
                <th>${n("storage.lvm.path")}</th>
              </tr>
            </thead>
            <tbody>
              ${this.logicalVolumes.map(e=>J`
                <tr>
                  <td>${e.name}</td>
                  <td>${e.vg_name}</td>
                  <td>${this.formatBytes(e.size)}</td>
                  <td>${e.path}</td>
                </tr>
              `)}
            </tbody>
          </table>
        `}
      </div>

      <div class="card">
        <h3 class="card-title">${n("storage.lvm.physicalVolumes")}</h3>
        
        ${0===this.physicalVolumes.length?J`
          <div class="empty-state">${n("storage.lvm.noPhysicalVolumes")}</div>
        `:J`
          <table class="table">
            <thead>
              <tr>
                <th>${n("common.name")}</th>
                <th>${n("storage.lvm.volumeGroup")}</th>
                <th>${n("storage.lvm.size")}</th>
                <th>${n("storage.lvm.free")}</th>
              </tr>
            </thead>
            <tbody>
              ${this.physicalVolumes.map(e=>J`
                <tr>
                  <td>${e.name}</td>
                  <td>${e.vg_name||"N/A"}</td>
                  <td>${this.formatBytes(e.size)}</td>
                  <td>${this.formatBytes(e.free)}</td>
                </tr>
              `)}
            </tbody>
          </table>
        `}
      </div>
    `}renderRAIDSection(){return J`
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">${n("storage.raid.devices")}</h3>
          <button class="btn-primary" @click=${this.showCreateRAIDDialog}>
            ${n("storage.raid.createRAID")}
          </button>
        </div>
        
        ${0===this.raidDevices.length?J`
          <div class="empty-state">${n("storage.raid.noDevices")}</div>
        `:J`
          <table class="table">
            <thead>
              <tr>
                <th>${n("common.name")}</th>
                <th>${n("storage.raid.level")}</th>
                <th>${n("storage.raid.state")}</th>
                <th>${n("storage.raid.size")}</th>
                <th>${n("storage.raid.devices")}</th>
                <th>${n("common.actions")}</th>
              </tr>
            </thead>
            <tbody>
              ${this.raidDevices.map(e=>J`
                <tr>
                  <td>${e.name}</td>
                  <td>RAID ${e.level}</td>
                  <td>
                    <span class="status-badge ${"active"===e.state?"active":"error"}">
                      ${e.state}
                    </span>
                  </td>
                  <td>${this.formatBytes(e.size)}</td>
                  <td>${e.active_disks}/${e.total_disks}</td>
                  <td>
                    <button class="btn-danger" @click=${()=>this.destroyRAID(e.path)}>
                      ${n("storage.raid.destroy")}
                    </button>
                  </td>
                </tr>
              `)}
            </tbody>
          </table>
        `}
      </div>

      <div class="card">
        <h3 class="card-title">${n("storage.raid.availableDisks")}</h3>
        
        ${0===this.availableRaidDisks.length?J`
          <div class="empty-state">${n("storage.raid.noAvailableDisks")}</div>
        `:J`
          <table class="table">
            <thead>
              <tr>
                <th>${n("storage.raid.device")}</th>
                <th>${n("storage.raid.size")}</th>
                <th>${n("storage.raid.partition")}</th>
              </tr>
            </thead>
            <tbody>
              ${this.availableRaidDisks.map(e=>J`
                <tr>
                  <td>${e.path}</td>
                  <td>${this.formatBytes(e.size)}</td>
                  <td>${e.partition?n("common.yes"):n("common.no")}</td>
                </tr>
              `)}
            </tbody>
          </table>
        `}
      </div>
    `}renderISCSISection(){return J`
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">${n("storage.iscsi.sessions")}</h3>
          <button class="btn-primary" @click=${this.showDiscoverISCSIDialog}>
            ${n("storage.iscsi.discover")}
          </button>
        </div>
        
        ${0===this.iscsiSessions.length?J`
          <div class="empty-state">${n("storage.iscsi.noSessions")}</div>
        `:J`
          <table class="table">
            <thead>
              <tr>
                <th>${n("storage.iscsi.target")}</th>
                <th>${n("storage.iscsi.portal")}</th>
                <th>${n("storage.iscsi.sessionId")}</th>
                <th>${n("storage.iscsi.state")}</th>
                <th>${n("common.actions")}</th>
              </tr>
            </thead>
            <tbody>
              ${this.iscsiSessions.map(e=>J`
                <tr>
                  <td>${e.target}</td>
                  <td>${e.portal}</td>
                  <td>${e.session_id}</td>
                  <td>
                    <span class="status-badge ${"logged_in"===e.state?"active":"inactive"}">
                      ${e.state}
                    </span>
                  </td>
                  <td>
                    <button class="btn-danger" @click=${()=>this.logoutISCSI(e.target)}>
                      ${n("storage.iscsi.logout")}
                    </button>
                  </td>
                </tr>
              `)}
            </tbody>
          </table>
        `}
      </div>

      ${this.iscsiTargets.length>0?J`
        <div class="card">
          <h3 class="card-title">${n("storage.iscsi.discoveredTargets")}</h3>
          <table class="table">
            <thead>
              <tr>
                <th>${n("storage.iscsi.iqn")}</th>
                <th>${n("storage.iscsi.portal")}</th>
                <th>${n("storage.iscsi.connected")}</th>
                <th>${n("common.actions")}</th>
              </tr>
            </thead>
            <tbody>
              ${this.iscsiTargets.map(e=>J`
                <tr>
                  <td>${e.iqn}</td>
                  <td>${e.portal}</td>
                  <td>${e.connected?n("common.yes"):n("common.no")}</td>
                  <td>
                    ${e.connected?"":J`
                      <button class="btn-primary" @click=${()=>this.loginISCSI(e)}>
                        ${n("storage.iscsi.login")}
                      </button>
                    `}
                  </td>
                </tr>
              `)}
            </tbody>
          </table>
        </div>
      `:""}
    `}renderMultipathSection(){return J`
      <div class="card">
        <h3 class="card-title">${n("storage.multipath.devices")}</h3>
        
        ${0===this.multipathDevices.length?J`
          <div class="empty-state">${n("storage.multipath.noDevices")}</div>
        `:J`
          ${this.multipathDevices.map(e=>J`
            <div class="card">
              <div class="card-header">
                <h4 class="card-title">${e.name} - ${e.product}</h4>
                <span class="status-badge ${"active"===e.state?"active":"error"}">
                  ${e.state}
                </span>
              </div>
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">${n("storage.multipath.wwid")}</span>
                  <span class="info-value">${e.wwid}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">${n("storage.multipath.vendor")}</span>
                  <span class="info-value">${e.vendor}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">${n("storage.multipath.size")}</span>
                  <span class="info-value">${e.size}</span>
                </div>
              </div>
              
              <h5>${n("storage.multipath.paths")}</h5>
              <table class="table">
                <thead>
                  <tr>
                    <th>${n("storage.multipath.device")}</th>
                    <th>${n("storage.multipath.host")}</th>
                    <th>${n("storage.multipath.state")}</th>
                    <th>${n("storage.multipath.priority")}</th>
                  </tr>
                </thead>
                <tbody>
                  ${e.paths.map(e=>J`
                    <tr>
                      <td>${e.device}</td>
                      <td>${e.host}</td>
                      <td>
                        <span class="status-badge ${"active"===e.state?"active":"inactive"}">
                          ${e.state}
                        </span>
                      </td>
                      <td>${e.priority}</td>
                    </tr>
                  `)}
                </tbody>
              </table>
            </div>
          `)}
        `}
      </div>
    `}renderBTRFSSection(){return J`
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">${n("storage.btrfs.subvolumes")}</h3>
          <button class="btn-primary" @click=${this.showCreateSubvolumeDialog}>
            ${n("storage.btrfs.createSubvolume")}
          </button>
        </div>
        
        ${0===this.btrfsSubvolumes.length?J`
          <div class="empty-state">${n("storage.btrfs.noSubvolumes")}</div>
        `:J`
          <ul>
            ${this.btrfsSubvolumes.map(e=>J`
              <li>${e}</li>
            `)}
          </ul>
        `}
      </div>
    `}renderContent(){if(this.loading)return J`<div class="loading">${n("common.loading")}</div>`;if(this.error)return J`<div class="error">${this.error}</div>`;switch(this.activeSection){case"disks":return this.renderDisksFlatSection();case"lvm":return this.renderLVMSection();case"raid":return this.renderRAIDSection();case"iscsi":return this.renderISCSISection();case"multipath":return this.renderMultipathSection();case"btrfs":return this.renderBTRFSSection();default:return J``}}render(){return J`
      <div class="storage-container">
        <h1>${n(`storage.${this.activeSection}.title`)}</h1>
        <div class="content">
          ${this.renderContent()}
        </div>
      </div>
    `}async mountPartition(e,t){try{await mc.post("/storage/mount",{device:e,mount_point:t}),await this.fetchDisks()}catch(s){console.error("Error mounting partition:",s)}}async unmountPartition(e){try{await mc.post("/storage/unmount",{mount_point:e}),await this.fetchDisks()}catch(t){console.error("Error unmounting partition:",t)}}async destroyRAID(e){if(confirm(n("storage.raid.confirmDestroy")))try{await mc.post("/storage/raid/destroy",{device:e}),await this.fetchRAID()}catch(t){console.error("Error destroying RAID:",t)}}async logoutISCSI(e){try{await mc.post("/storage/iscsi/logout",{target:e}),await this.fetchiSCSI()}catch(t){console.error("Error logging out from iSCSI:",t)}}async loginISCSI(e){try{await mc.post("/storage/iscsi/login",{target:e.iqn,portal:e.portal}),await this.fetchiSCSI()}catch(t){console.error("Error logging in to iSCSI:",t)}}showCreateVGDialog(){console.log("Show create VG dialog")}showCreateLVDialog(){console.log("Show create LV dialog")}showCreateRAIDDialog(){console.log("Show create RAID dialog")}showDiscoverISCSIDialog(){console.log("Show discover iSCSI dialog")}showCreateSubvolumeDialog(){console.log("Show create subvolume dialog")}}function Bd(){return"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}Od([we({type:Array})],Nd.prototype,"disks"),Od([we({type:Array})],Nd.prototype,"volumeGroups"),Od([we({type:Array})],Nd.prototype,"logicalVolumes"),Od([we({type:Array})],Nd.prototype,"physicalVolumes"),Od([we({type:Array})],Nd.prototype,"raidDevices"),Od([we({type:Array})],Nd.prototype,"availableRaidDisks"),Od([we({type:Array})],Nd.prototype,"iscsiTargets"),Od([we({type:Array})],Nd.prototype,"iscsiSessions"),Od([we({type:Array})],Nd.prototype,"multipathDevices"),Od([we({type:Array})],Nd.prototype,"btrfsSubvolumes"),Od([we({type:String})],Nd.prototype,"activeSection"),Od([we({type:String})],Nd.prototype,"subRoute"),Od([we({type:Boolean})],Nd.prototype,"loading"),Od([we({type:String})],Nd.prototype,"error"),customElements.define("storage-tab",Nd);const Fd=1,zd=2,Ud=e=>(...t)=>({_$litDirective$:e,values:t});let Vd=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,s){this._$Ct=e,this._$AM=t,this._$Ci=s}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}},jd=class extends Vd{constructor(e){if(super(e),this.it=X,e.type!==zd)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(e){if(e===X||null==e)return this._t=void 0,this.it=e;if(e===Y)return e;if("string"!=typeof e)throw Error(this.constructor.directiveName+"() called with a non-string value");if(e===this.it)return this._t;this.it=e;const t=[e];return t.raw=t,this._t={_$litType$:this.constructor.resultType,strings:t,values:[]}}};jd.directiveName="unsafeHTML",jd.resultType=1;const Hd=Ud(jd),Wd="function"==typeof Buffer,qd=("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder?new TextEncoder:void 0),Kd=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),Gd=(()=>{let e={};return Kd.forEach((t,s)=>e[t]=s),e})(),Qd=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Jd=String.fromCharCode.bind(String),Yd=("function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),e=>e.replace(/=/g,"").replace(/[+\/]/g,e=>"+"==e?"-":"_")),Xd=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),Zd=e=>{let t,s,i,o,r="";const a=e.length%3;for(let n=0;n<e.length;){if((s=e.charCodeAt(n++))>255||(i=e.charCodeAt(n++))>255||(o=e.charCodeAt(n++))>255)throw new TypeError("invalid character found");t=s<<16|i<<8|o,r+=Kd[t>>18&63]+Kd[t>>12&63]+Kd[t>>6&63]+Kd[63&t]}return a?r.slice(0,a-3)+"===".substring(a):r},eh="function"==typeof btoa?e=>btoa(e):Wd?e=>Buffer.from(e,"binary").toString("base64"):Zd,th=Wd?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let s=0,i=e.length;s<i;s+=4096)t.push(Jd.apply(null,e.subarray(s,s+4096)));return eh(t.join(""))},sh=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?Jd(192|t>>>6)+Jd(128|63&t):Jd(224|t>>>12&15)+Jd(128|t>>>6&63)+Jd(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return Jd(240|t>>>18&7)+Jd(128|t>>>12&63)+Jd(128|t>>>6&63)+Jd(128|63&t)},ih=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,oh=e=>e.replace(ih,sh),rh=Wd?e=>Buffer.from(e,"utf8").toString("base64"):qd?e=>th(qd.encode(e)):e=>eh(oh(e)),ah=(e,t=!1)=>t?Yd(rh(e)):rh(e),nh=e=>{if(e=e.replace(/\s+/g,""),!Qd.test(e))throw new TypeError("malformed base64.");let t,s,i;e+="==".slice(2-(3&e.length));let o=[];for(let r=0;r<e.length;)t=Gd[e.charAt(r++)]<<18|Gd[e.charAt(r++)]<<12|(s=Gd[e.charAt(r++)])<<6|(i=Gd[e.charAt(r++)]),64===s?o.push(Jd(t>>16&255)):64===i?o.push(Jd(t>>16&255,t>>8&255)):o.push(Jd(t>>16&255,t>>8&255,255&t));return o.join("")},lh=ah;var ch,dh;var hh,uh,ph,gh={};var mh=function(){if(ph)return uh;ph=1;var e=dh?ch:(dh=1,ch=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}),t=function(){if(hh)return gh;hh=1;var e=Object.prototype.hasOwnProperty;function t(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return null}}function s(e){try{return encodeURIComponent(e)}catch(t){return null}}return gh.stringify=function(t,i){i=i||"";var o,r,a=[];for(r in"string"!=typeof i&&(i="?"),t)if(e.call(t,r)){if((o=t[r])||null!=o&&!isNaN(o)||(o=""),r=s(r),o=s(o),null===r||null===o)continue;a.push(r+"="+o)}return a.length?i+a.join("&"):""},gh.parse=function(e){for(var s,i=/([^=?#&]+)=?([^&]*)/g,o={};s=i.exec(e);){var r=t(s[1]),a=t(s[2]);null===r||null===a||r in o||(o[r]=a)}return o},gh}(),s=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,i=/[\n\r\t]/g,o=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,r=/:\d+$/,a=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,n=/^[a-zA-Z]:/;function l(e){return(e||"").toString().replace(s,"")}var c=[["#","hash"],["?","query"],function(e,t){return u(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],d={hash:1,query:1};function h(e){var t,s=("undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).location||{},i={},r=typeof(e=e||s);if("blob:"===e.protocol)i=new g(unescape(e.pathname),{});else if("string"===r)for(t in i=new g(e,{}),d)delete i[t];else if("object"===r){for(t in e)t in d||(i[t]=e[t]);void 0===i.slashes&&(i.slashes=o.test(e.href))}return i}function u(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function p(e,t){e=(e=l(e)).replace(i,""),t=t||{};var s,o=a.exec(e),r=o[1]?o[1].toLowerCase():"",n=!!o[2],c=!!o[3],d=0;return n?c?(s=o[2]+o[3]+o[4],d=o[2].length+o[3].length):(s=o[2]+o[4],d=o[2].length):c?(s=o[3]+o[4],d=o[3].length):s=o[4],"file:"===r?d>=2&&(s=s.slice(2)):u(r)?s=o[4]:r?n&&(s=s.slice(2)):d>=2&&u(t.protocol)&&(s=o[4]),{protocol:r,slashes:n||u(r),slashesCount:d,rest:s}}function g(s,o,r){if(s=(s=l(s)).replace(i,""),!(this instanceof g))return new g(s,o,r);var a,d,m,f,v,b,y=c.slice(),w=typeof o,x=this,_=0;for("object"!==w&&"string"!==w&&(r=o,o=null),r&&"function"!=typeof r&&(r=t.parse),a=!(d=p(s||"",o=h(o))).protocol&&!d.slashes,x.slashes=d.slashes||a&&o.slashes,x.protocol=d.protocol||o.protocol||"",s=d.rest,("file:"===d.protocol&&(2!==d.slashesCount||n.test(s))||!d.slashes&&(d.protocol||d.slashesCount<2||!u(x.protocol)))&&(y[3]=[/(.*)/,"pathname"]);_<y.length;_++)"function"!=typeof(f=y[_])?(m=f[0],b=f[1],m!=m?x[b]=s:"string"==typeof m?~(v="@"===m?s.lastIndexOf(m):s.indexOf(m))&&("number"==typeof f[2]?(x[b]=s.slice(0,v),s=s.slice(v+f[2])):(x[b]=s.slice(v),s=s.slice(0,v))):(v=m.exec(s))&&(x[b]=v[1],s=s.slice(0,v.index)),x[b]=x[b]||a&&f[3]&&o[b]||"",f[4]&&(x[b]=x[b].toLowerCase())):s=f(s,x);r&&(x.query=r(x.query)),a&&o.slashes&&"/"!==x.pathname.charAt(0)&&(""!==x.pathname||""!==o.pathname)&&(x.pathname=function(e,t){if(""===e)return t;for(var s=(t||"/").split("/").slice(0,-1).concat(e.split("/")),i=s.length,o=s[i-1],r=!1,a=0;i--;)"."===s[i]?s.splice(i,1):".."===s[i]?(s.splice(i,1),a++):a&&(0===i&&(r=!0),s.splice(i,1),a--);return r&&s.unshift(""),"."!==o&&".."!==o||s.push(""),s.join("/")}(x.pathname,o.pathname)),"/"!==x.pathname.charAt(0)&&u(x.protocol)&&(x.pathname="/"+x.pathname),e(x.port,x.protocol)||(x.host=x.hostname,x.port=""),x.username=x.password="",x.auth&&(~(v=x.auth.indexOf(":"))?(x.username=x.auth.slice(0,v),x.username=encodeURIComponent(decodeURIComponent(x.username)),x.password=x.auth.slice(v+1),x.password=encodeURIComponent(decodeURIComponent(x.password))):x.username=encodeURIComponent(decodeURIComponent(x.auth)),x.auth=x.password?x.username+":"+x.password:x.username),x.origin="file:"!==x.protocol&&u(x.protocol)&&x.host?x.protocol+"//"+x.host:"null",x.href=x.toString()}return g.prototype={set:function(s,i,o){var a=this;switch(s){case"query":"string"==typeof i&&i.length&&(i=(o||t.parse)(i)),a[s]=i;break;case"port":a[s]=i,e(i,a.protocol)?i&&(a.host=a.hostname+":"+i):(a.host=a.hostname,a[s]="");break;case"hostname":a[s]=i,a.port&&(i+=":"+a.port),a.host=i;break;case"host":a[s]=i,r.test(i)?(i=i.split(":"),a.port=i.pop(),a.hostname=i.join(":")):(a.hostname=i,a.port="");break;case"protocol":a.protocol=i.toLowerCase(),a.slashes=!o;break;case"pathname":case"hash":if(i){var n="pathname"===s?"/":"#";a[s]=i.charAt(0)!==n?n+i:i}else a[s]=i;break;case"username":case"password":a[s]=encodeURIComponent(i);break;case"auth":var l=i.indexOf(":");~l?(a.username=i.slice(0,l),a.username=encodeURIComponent(decodeURIComponent(a.username)),a.password=i.slice(l+1),a.password=encodeURIComponent(decodeURIComponent(a.password))):a.username=encodeURIComponent(decodeURIComponent(i))}for(var d=0;d<c.length;d++){var h=c[d];h[4]&&(a[h[1]]=a[h[1]].toLowerCase())}return a.auth=a.password?a.username+":"+a.password:a.username,a.origin="file:"!==a.protocol&&u(a.protocol)&&a.host?a.protocol+"//"+a.host:"null",a.href=a.toString(),a},toString:function(e){e&&"function"==typeof e||(e=t.stringify);var s,i=this,o=i.host,a=i.protocol;a&&":"!==a.charAt(a.length-1)&&(a+=":");var n=a+(i.protocol&&i.slashes||u(i.protocol)?"//":"");return i.username?(n+=i.username,i.password&&(n+=":"+i.password),n+="@"):i.password?(n+=":"+i.password,n+="@"):"file:"!==i.protocol&&u(i.protocol)&&!o&&"/"!==i.pathname&&(n+="@"),(":"===o[o.length-1]||r.test(i.hostname)&&!i.port)&&(o+=":"),n+=o+i.pathname,(s="object"==typeof i.query?e(i.query):i.query)&&(n+="?"!==s.charAt(0)?"?"+s:s),i.hash&&(n+=i.hash),n}},g.extractProtocol=p,g.location=h,g.trimLeft=l,g.qs=t,uh=g}();const fh=/* @__PURE__ */ke(mh);function vh(e){return(vh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bh(e){var t=xh();return function(){var s,i=kh(e);if(t){var o=kh(this).constructor;s=Reflect.construct(i,arguments,o)}else s=i.apply(this,arguments);return function(e,t){if(t&&("object"===vh(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,s)}}function yh(e){var t="function"==typeof Map?/* @__PURE__ */new Map:void 0;return yh=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,s)}function s(){return wh(e,arguments,kh(this).constructor)}return s.prototype=Object.create(e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),_h(s,e)},yh(e)}function wh(e,t,s){return(wh=xh()?Reflect.construct.bind():function(e,t,s){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return s&&_h(o,s.prototype),o}).apply(null,arguments)}function xh(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _h(e,t){return(_h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function kh(e){return(kh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Sh=/* @__PURE__ */function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_h(e,t)}(s,/* @__PURE__ */yh(Error));var e,t=bh(s);function s(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(i=t.call(this,e)).originalRequest=r,i.originalResponse=a,i.causingError=o,null!=o&&(e+=", caused by ".concat(o.toString())),null!=r){var n=r.getHeader("X-Request-ID")||"n/a",l=r.getMethod(),c=r.getURL(),d=a?a.getStatus():"n/a",h=a?a.getBody()||"":"n/a";e+=", originated from request (method: ".concat(l,", url: ").concat(c,", response code: ").concat(d,", response text: ").concat(h,", request id: ").concat(n,")")}return i.message=e,i}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}();function Ch(){Ch=function(){return t};var e,t={},s=Object.prototype,i=s.hasOwnProperty,o=Object.defineProperty||function(e,t,s){e[t]=s.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",n=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(e,t,s){return Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(T){c=function(e,t,s){return e[t]=s}}function d(e,t,s,i){var r=t&&t.prototype instanceof v?t:v,a=Object.create(r.prototype),n=new A(i||[]);return o(a,"_invoke",{value:$(e,s,n)}),a}function h(e,t,s){try{return{type:"normal",arg:e.call(t,s)}}catch(i){return{type:"throw",arg:i}}}t.wrap=d;var u="suspendedStart",p="suspendedYield",g="executing",m="completed",f={};function v(){}function b(){}function y(){}var w={};c(w,a,function(){return this});var x=Object.getPrototypeOf,_=x&&x(x(I([])));_&&_!==s&&i.call(_,a)&&(w=_);var k=y.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function C(e,t){function s(o,r,a,n){var l=h(e[o],e,r);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==Mh(d)&&i.call(d,"__await")?t.resolve(d.__await).then(function(e){s("next",e,a,n)},function(e){s("throw",e,a,n)}):t.resolve(d).then(function(e){c.value=e,a(c)},function(e){return s("throw",e,a,n)})}n(l.arg)}var r;o(this,"_invoke",{value:function(e,i){function o(){return new t(function(t,o){s(e,i,t,o)})}return r=r?r.then(o,o):o()}})}function $(t,s,i){var o=u;return function(r,a){if(o===g)throw new Error("Generator is already running");if(o===m){if("throw"===r)throw a;return{value:e,done:!0}}for(i.method=r,i.arg=a;;){var n=i.delegate;if(n){var l=D(n,i);if(l){if(l===f)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(o===u)throw o=m,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o=g;var c=h(t,s,i);if("normal"===c.type){if(o=i.done?m:p,c.arg===f)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(o=m,i.method="throw",i.arg=c.arg)}}}function D(t,s){var i=s.method,o=t.iterator[i];if(o===e)return s.delegate=null,"throw"===i&&t.iterator.return&&(s.method="return",s.arg=e,D(t,s),"throw"===s.method)||"return"!==i&&(s.method="throw",s.arg=new TypeError("The iterator does not provide a '"+i+"' method")),f;var r=h(o,t.iterator,s.arg);if("throw"===r.type)return s.method="throw",s.arg=r.arg,s.delegate=null,f;var a=r.arg;return a?a.done?(s[t.resultName]=a.value,s.next=t.nextLoc,"return"!==s.method&&(s.method="next",s.arg=e),s.delegate=null,f):a:(s.method="throw",s.arg=new TypeError("iterator result is not an object"),s.delegate=null,f)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function I(t){if(t||""===t){var s=t[a];if(s)return s.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,r=function s(){for(;++o<t.length;)if(i.call(t,o))return s.value=t[o],s.done=!1,s;return s.value=e,s.done=!0,s};return r.next=r}}throw new TypeError(Mh(t)+" is not iterable")}return b.prototype=y,o(k,"constructor",{value:y,configurable:!0}),o(y,"constructor",{value:b,configurable:!0}),b.displayName=c(y,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,l,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},S(C.prototype),c(C.prototype,n,function(){return this}),t.AsyncIterator=C,t.async=function(e,s,i,o,r){void 0===r&&(r=Promise);var a=new C(d(e,s,i,o),r);return t.isGeneratorFunction(s)?a:a.next().then(function(e){return e.done?e.value:a.next()})},S(k),c(k,l,"Generator"),c(k,a,function(){return this}),c(k,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),s=[];for(var i in t)s.push(i);return s.reverse(),function e(){for(;s.length;){var i=s.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=I,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(M),!t)for(var s in this)"t"===s.charAt(0)&&i.call(this,s)&&!isNaN(+s.slice(1))&&(this[s]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var s=this;function o(i,o){return n.type="throw",n.arg=t,s.next=i,o&&(s.method="next",s.arg=e),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],n=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=i.call(a,"catchLoc"),c=i.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s];if(o.tryLoc<=this.prev&&i.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.finallyLoc===e)return this.complete(s.completion,s.afterLoc),M(s),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.tryLoc===e){var i=s.completion;if("throw"===i.type){var o=i.arg;M(s)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,s,i){return this.delegate={iterator:I(t),resultName:s,nextLoc:i},"next"===this.method&&(this.arg=e),f}},t}function $h(e,t,s,i,o,r,a){try{var n=e[r](a),l=n.value}catch(c){return void s(c)}n.done?t(l):Promise.resolve(l).then(i,o)}function Dh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var s=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=s){var i,o,r,a,n=[],l=!0,c=!1;try{if(r=(s=s.call(e)).next,0===t);else for(;!(l=(i=r.call(s)).done)&&(n.push(i.value),n.length!==t);l=!0);}catch(d){c=!0,o=d}finally{try{if(!l&&null!=s.return&&(a=s.return(),Object(a)!==a))return}finally{if(c)throw o}}return n}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Eh(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(e);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Eh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Eh(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,i=new Array(t);s<t;s++)i[s]=e[s];return i}function Mh(e){return(Mh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ah(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,i)}return s}function Ih(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Ah(Object(s),!0).forEach(function(t){Th(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Ah(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function Th(e,t,s){return(t=Lh(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function Ph(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Lh(i.key),i)}}function Lh(e){var t=function(e,t){if("object"!==Mh(e)||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t);if("object"!==Mh(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"===Mh(t)?t:String(t)}var Rh={endpoint:null,uploadUrl:null,metadata:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:jh,chunkSize:1/0,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null},Oh=/* @__PURE__ */function(){function e(t,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"resume"in s&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=s,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=t,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}var t,s,i;return t=e,s=[{key:"findPreviousUploads",value:function(){var e=this;return this.options.fingerprint(this.file,this.options).then(function(t){return e._urlStorage.findUploadsByFingerprint(t)})}},{key:"resumeFromPreviousUpload",value:function(e){this.url=e.uploadUrl||null,this._parallelUploadUrls=e.parallelUploadUrls||null,this._urlStorageKey=e.urlStorageKey}},{key:"start",value:function(){var e=this,t=this.file;if(t)if(this.options.endpoint||this.options.uploadUrl||this.url){var s=this.options.retryDelays;if(null==s||"[object Array]"===Object.prototype.toString.call(s)){if(this.options.parallelUploads>1)for(var i=0,o=["uploadUrl","uploadSize","uploadLengthDeferred"];i<o.length;i++){var r=o[i];if(this.options[r])return void this._emitError(new Error("tus: cannot use the ".concat(r," option when parallelUploads is enabled")))}if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1)return void this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length)return void this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"))}this.options.fingerprint(t,this.options).then(function(s){return e._fingerprint=s,e._source?e._source:e.options.fileReader.openFile(t,e.options.chunkSize)}).then(function(t){if(e._source=t,e.options.uploadLengthDeferred)e._size=null;else if(null!=e.options.uploadSize){if(e._size=Number(e.options.uploadSize),Number.isNaN(e._size))return void e._emitError(new Error("tus: cannot convert `uploadSize` option into a number"))}else if(e._size=e._source.size,null==e._size)return void e._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));e.options.parallelUploads>1||null!=e._parallelUploadUrls?e._startParallelUpload():e._startSingleUpload()}).catch(function(t){e._emitError(t)})}else this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"))}else this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));else this._emitError(new Error("tus: no file or stream to upload provided"))}},{key:"_startParallelUpload",value:function(){var t,s=this,i=this._size,o=0;this._parallelUploads=[];var r=null!=this._parallelUploadUrls?this._parallelUploadUrls.length:this.options.parallelUploads,a=null!==(t=this.options.parallelUploadBoundaries)&&void 0!==t?t:function(e,t){for(var s=Math.floor(e/t),i=[],o=0;o<t;o++)i.push({start:s*o,end:s*(o+1)});return i[t-1].end=e,i}(this._source.size,r);this._parallelUploadUrls&&a.forEach(function(e,t){e.uploadUrl=s._parallelUploadUrls[t]||null}),this._parallelUploadUrls=new Array(a.length);var n,l=a.map(function(t,r){var n=0;return s._source.slice(t.start,t.end).then(function(l){var c=l.value;return new Promise(function(l,d){var h=Ih(Ih({},s.options),{},{uploadUrl:t.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:{},headers:Ih(Ih({},s.options.headers),{},{"Upload-Concat":"partial"}),onSuccess:l,onError:d,onProgress:function(e){o=o-n+e,n=e,s._emitProgress(o,i)},onUploadUrlAvailable:function(){s._parallelUploadUrls[r]=u.url,s._parallelUploadUrls.filter(function(e){return Boolean(e)}).length===a.length&&s._saveUploadInUrlStorage()}}),u=new e(c,h);u.start(),s._parallelUploads.push(u)})})});Promise.all(l).then(function(){(n=s._openRequest("POST",s.options.endpoint)).setHeader("Upload-Concat","final;".concat(s._parallelUploadUrls.join(" ")));var e=Nh(s.options.metadata);return""!==e&&n.setHeader("Upload-Metadata",e),s._sendRequest(n,null)}).then(function(e){if(Bh(e.getStatus(),200)){var t=e.getHeader("Location");null!=t?(s.url=Hh(s.options.endpoint,t),"Created upload at ".concat(s.url),s._emitSuccess()):s._emitHttpError(n,e,"tus: invalid or missing Location header")}else s._emitHttpError(n,e,"tus: unexpected response while creating upload")}).catch(function(e){s._emitError(e)})}},{key:"_startSingleUpload",value:function(){return this._aborted=!1,null!=this.url?("Resuming upload from previous URL: ".concat(this.url),void this._resumeUpload()):null!=this.options.uploadUrl?("Resuming upload from provided URL: ".concat(this.options.uploadUrl),this.url=this.options.uploadUrl,void this._resumeUpload()):void this._createUpload()}},{key:"abort",value:function(t){var s=this;return null!=this._parallelUploads&&this._parallelUploads.forEach(function(e){e.abort(t)}),null!==this._req&&this._req.abort(),this._aborted=!0,null!=this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),t&&null!=this.url?e.terminate(this.url,this.options).then(function(){return s._removeFromUrlStorage()}):Promise.resolve()}},{key:"_emitHttpError",value:function(e,t,s,i){this._emitError(new Sh(s,i,e,t))}},{key:"_emitError",value:function(e){var t=this;if(!this._aborted){if(null!=this.options.retryDelays&&(null!=this._offset&&this._offset>this._offsetBeforeRetry&&(this._retryAttempt=0),Vh(e,this._retryAttempt,this.options))){var s=this.options.retryDelays[this._retryAttempt++];return this._offsetBeforeRetry=this._offset,void(this._retryTimeout=setTimeout(function(){t.start()},s))}if("function"!=typeof this.options.onError)throw e;this.options.onError(e)}}},{key:"_emitSuccess",value:function(){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),"function"==typeof this.options.onSuccess&&this.options.onSuccess()}},{key:"_emitProgress",value:function(e,t){"function"==typeof this.options.onProgress&&this.options.onProgress(e,t)}},{key:"_emitChunkComplete",value:function(e,t,s){"function"==typeof this.options.onChunkComplete&&this.options.onChunkComplete(e,t,s)}},{key:"_createUpload",value:function(){var e=this;if(this.options.endpoint){var t=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?t.setHeader("Upload-Defer-Length",1):t.setHeader("Upload-Length",this._size);var s,i=Nh(this.options.metadata);""!==i&&t.setHeader("Upload-Metadata",i),this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,s=this._addChunkToRequest(t)):s=this._sendRequest(t,null),s.then(function(s){if(Bh(s.getStatus(),200)){var i=s.getHeader("Location");if(null!=i){if(e.url=Hh(e.options.endpoint,i),"Created upload at ".concat(e.url),"function"==typeof e.options.onUploadUrlAvailable&&e.options.onUploadUrlAvailable(),0===e._size)return e._emitSuccess(),void e._source.close();e._saveUploadInUrlStorage().then(function(){e.options.uploadDataDuringCreation?e._handleUploadResponse(t,s):(e._offset=0,e._performUpload())})}else e._emitHttpError(t,s,"tus: invalid or missing Location header")}else e._emitHttpError(t,s,"tus: unexpected response while creating upload")}).catch(function(s){e._emitHttpError(t,null,"tus: failed to create upload",s)})}else this._emitError(new Error("tus: unable to create upload because no endpoint is provided"))}},{key:"_resumeUpload",value:function(){var e=this,t=this._openRequest("HEAD",this.url);this._sendRequest(t,null).then(function(s){var i=s.getStatus();if(!Bh(i,200))return 423===i?void e._emitHttpError(t,s,"tus: upload is currently locked; retry later"):(Bh(i,400)&&e._removeFromUrlStorage(),e.options.endpoint?(e.url=null,void e._createUpload()):void e._emitHttpError(t,s,"tus: unable to resume upload (new upload cannot be created without an endpoint)"));var o=parseInt(s.getHeader("Upload-Offset"),10);if(Number.isNaN(o))e._emitHttpError(t,s,"tus: invalid or missing offset value");else{var r=parseInt(s.getHeader("Upload-Length"),10);!Number.isNaN(r)||e.options.uploadLengthDeferred?("function"==typeof e.options.onUploadUrlAvailable&&e.options.onUploadUrlAvailable(),e._saveUploadInUrlStorage().then(function(){if(o===r)return e._emitProgress(r,r),void e._emitSuccess();e._offset=o,e._performUpload()})):e._emitHttpError(t,s,"tus: invalid or missing length value")}}).catch(function(s){e._emitHttpError(t,null,"tus: failed to resume upload",s)})}},{key:"_performUpload",value:function(){var e,t=this;this._aborted||(this.options.overridePatchMethod?(e=this._openRequest("POST",this.url)).setHeader("X-HTTP-Method-Override","PATCH"):e=this._openRequest("PATCH",this.url),e.setHeader("Upload-Offset",this._offset),this._addChunkToRequest(e).then(function(s){Bh(s.getStatus(),200)?t._handleUploadResponse(e,s):t._emitHttpError(e,s,"tus: unexpected response while uploading chunk")}).catch(function(s){t._aborted||t._emitHttpError(e,null,"tus: failed to upload chunk at offset ".concat(t._offset),s)}))}},{key:"_addChunkToRequest",value:function(e){var t=this,s=this._offset,i=this._offset+this.options.chunkSize;return e.setProgressHandler(function(e){t._emitProgress(s+e,t._size)}),e.setHeader("Content-Type","application/offset+octet-stream"),(i===1/0||i>this._size)&&!this.options.uploadLengthDeferred&&(i=this._size),this._source.slice(s,i).then(function(s){var i=s.value,o=s.done,r=i&&i.size?i.size:0;t.options.uploadLengthDeferred&&o&&(t._size=t._offset+r,e.setHeader("Upload-Length",t._size));var a=t._offset+r;return!t.options.uploadLengthDeferred&&o&&a!==t._size?Promise.reject(new Error("upload was configured with a size of ".concat(t._size," bytes, but the source is done after ").concat(a," bytes"))):null===i?t._sendRequest(e):(t._emitProgress(t._offset,t._size),t._sendRequest(e,i))})}},{key:"_handleUploadResponse",value:function(e,t){var s=parseInt(t.getHeader("Upload-Offset"),10);if(Number.isNaN(s))this._emitHttpError(e,t,"tus: invalid or missing offset value");else{if(this._emitProgress(s,this._size),this._emitChunkComplete(s-this._offset,s,this._size),this._offset=s,s===this._size)return this._emitSuccess(),void this._source.close();this._performUpload()}}},{key:"_openRequest",value:function(e,t){var s=Fh(e,t,this.options);return this._req=s,s}},{key:"_removeFromUrlStorage",value:function(){var e=this;this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch(function(t){e._emitError(t)}),this._urlStorageKey=null)}},{key:"_saveUploadInUrlStorage",value:function(){var e=this;if(!this.options.storeFingerprintForResuming||!this._fingerprint||null!==this._urlStorageKey)return Promise.resolve();var t={size:this._size,metadata:this.options.metadata,creationTime:/* @__PURE__ */(new Date).toString()};return this._parallelUploads?t.parallelUploadUrls=this._parallelUploadUrls:t.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,t).then(function(t){e._urlStorageKey=t})}},{key:"_sendRequest",value:function(e){return zh(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,this.options)}}],i=[{key:"terminate",value:function(t){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Fh("DELETE",t,s);return zh(i,null,s).then(function(e){if(204!==e.getStatus())throw new Sh("tus: unexpected response while terminating upload",null,i,e)}).catch(function(o){if(o instanceof Sh||(o=new Sh("tus: failed to terminate upload",o,i,null)),!Vh(o,0,s))throw o;var r=s.retryDelays[0],a=s.retryDelays.slice(1),n=Ih(Ih({},s),{},{retryDelays:a});return new Promise(function(e){return setTimeout(e,r)}).then(function(){return e.terminate(t,n)})})}}],s&&Ph(t.prototype,s),i&&Ph(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Nh(e){return Object.entries(e).map(function(e){var t=Dh(e,2),s=t[0],i=t[1];return"".concat(s," ").concat(lh(String(i)))}).join(",")}function Bh(e,t){return e>=t&&e<t+100}function Fh(e,t,s){var i=s.httpStack.createRequest(e,t);i.setHeader("Tus-Resumable","1.0.0");var o=s.headers||{};if(Object.entries(o).forEach(function(e){var t=Dh(e,2),s=t[0],o=t[1];i.setHeader(s,o)}),s.addRequestId){var r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});i.setHeader("X-Request-ID",r)}return i}function zh(e,t,s){return Uh.apply(this,arguments)}function Uh(){var e;return e=/* @__PURE__ */Ch().mark(function e(t,s,i){var o;return Ch().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof i.onBeforeRequest){e.next=3;break}return e.next=3,i.onBeforeRequest(t);case 3:return e.next=5,t.send(s);case 5:if(o=e.sent,"function"!=typeof i.onAfterResponse){e.next=9;break}return e.next=9,i.onAfterResponse(t,o);case 9:return e.abrupt("return",o);case 10:case"end":return e.stop()}},e)}),Uh=function(){var t=this,s=arguments;return new Promise(function(i,o){var r=e.apply(t,s);function a(e){$h(r,i,o,a,n,"next",e)}function n(e){$h(r,i,o,a,n,"throw",e)}a(void 0)})},Uh.apply(this,arguments)}function Vh(e,t,s){return!(null==s.retryDelays||t>=s.retryDelays.length||null==e.originalRequest)&&(s&&"function"==typeof s.onShouldRetry?s.onShouldRetry(e,t,s):jh(e))}function jh(e){var t,s=e.originalResponse?e.originalResponse.getStatus():0;return(!Bh(s,400)||409===s||423===s)&&(t=!0,"undefined"!=typeof window&&"navigator"in window&&!1===window.navigator.onLine&&(t=!1),t)}function Hh(e,t){return new fh(t,e).toString()}function Wh(e){return(Wh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qh(e,t,s){return t&&function(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Kh(i.key),i)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Kh(e){var t=function(e,t){if("object"!==Wh(e)||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t);if("object"!==Wh(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"===Wh(t)?t:String(t)}Oh.defaultOptions=Rh;var Gh=/* @__PURE__ */function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return qh(e,[{key:"listAllUploads",value:function(){return Promise.resolve([])}},{key:"findUploadsByFingerprint",value:function(e){return Promise.resolve([])}},{key:"removeUpload",value:function(e){return Promise.resolve()}},{key:"addUpload",value:function(e,t){return Promise.resolve(null)}}]),e}();function Qh(e){return(Qh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jh(e,t,s){return t&&function(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Yh(i.key),i)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Yh(e){var t=function(e,t){if("object"!==Qh(e)||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t);if("object"!==Qh(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"===Qh(t)?t:String(t)}var Xh=!1;try{Xh="localStorage"in window;var Zh="tusSupport",eu=localStorage.getItem(Zh);localStorage.setItem(Zh,eu),null===eu&&localStorage.removeItem(Zh)}catch(U_){if(U_.code!==U_.SECURITY_ERR&&U_.code!==U_.QUOTA_EXCEEDED_ERR)throw U_;Xh=!1}var tu=Xh,su=/* @__PURE__ */function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return Jh(e,[{key:"findAllUploads",value:function(){var e=this._findEntries("tus::");return Promise.resolve(e)}},{key:"findUploadsByFingerprint",value:function(e){var t=this._findEntries("tus::".concat(e,"::"));return Promise.resolve(t)}},{key:"removeUpload",value:function(e){return localStorage.removeItem(e),Promise.resolve()}},{key:"addUpload",value:function(e,t){var s=Math.round(1e12*Math.random()),i="tus::".concat(e,"::").concat(s);return localStorage.setItem(i,JSON.stringify(t)),Promise.resolve(i)}},{key:"_findEntries",value:function(e){for(var t=[],s=0;s<localStorage.length;s++){var i=localStorage.key(s);if(0===i.indexOf(e))try{var o=JSON.parse(localStorage.getItem(i));o.urlStorageKey=i,t.push(o)}catch(U_){}}return t}}]),e}();function iu(e){return(iu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ou(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ru(e,t,s){return t&&function(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,au(i.key),i)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function au(e){var t=function(e,t){if("object"!==iu(e)||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t);if("object"!==iu(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"===iu(t)?t:String(t)}var nu=/* @__PURE__ */function(){function e(){ou(this,e)}return ru(e,[{key:"createRequest",value:function(e,t){return new lu(e,t)}},{key:"getName",value:function(){return"XHRHttpStack"}}]),e}(),lu=/* @__PURE__ */function(){function e(t,s){ou(this,e),this._xhr=new XMLHttpRequest,this._xhr.open(t,s,!0),this._method=t,this._url=s,this._headers={}}return ru(e,[{key:"getMethod",value:function(){return this._method}},{key:"getURL",value:function(){return this._url}},{key:"setHeader",value:function(e,t){this._xhr.setRequestHeader(e,t),this._headers[e]=t}},{key:"getHeader",value:function(e){return this._headers[e]}},{key:"setProgressHandler",value:function(e){"upload"in this._xhr&&(this._xhr.upload.onprogress=function(t){t.lengthComputable&&e(t.loaded)})}},{key:"send",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise(function(s,i){e._xhr.onload=function(){s(new cu(e._xhr))},e._xhr.onerror=function(e){i(e)},e._xhr.send(t)})}},{key:"abort",value:function(){return this._xhr.abort(),Promise.resolve()}},{key:"getUnderlyingObject",value:function(){return this._xhr}}]),e}(),cu=/* @__PURE__ */function(){function e(t){ou(this,e),this._xhr=t}return ru(e,[{key:"getStatus",value:function(){return this._xhr.status}},{key:"getHeader",value:function(e){return this._xhr.getResponseHeader(e)}},{key:"getBody",value:function(){return this._xhr.responseText}},{key:"getUnderlyingObject",value:function(){return this._xhr}}]),e}(),du=function(){return"undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase()};function hu(e){return new Promise(function(t,s){var i=new XMLHttpRequest;i.responseType="blob",i.onload=function(){var e=i.response;t(e)},i.onerror=function(e){s(e)},i.open("GET",e),i.send()})}function uu(e){return(uu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pu(e,t,s){return t&&function(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,gu(i.key),i)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function gu(e){var t=function(e,t){if("object"!==uu(e)||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t);if("object"!==uu(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"===uu(t)?t:String(t)}var mu=/* @__PURE__ */function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._file=t,this.size=t.size}return pu(e,[{key:"slice",value:function(e,t){if("undefined"!=typeof window&&(void 0!==window.PhoneGap||void 0!==window.Cordova||void 0!==window.cordova))return s=this._file.slice(e,t),new Promise(function(e,t){var i=new FileReader;i.onload=function(){var t=new Uint8Array(i.result);e({value:t})},i.onerror=function(e){t(e)},i.readAsArrayBuffer(s)});var s,i=this._file.slice(e,t),o=t>=this.size;return Promise.resolve({value:i,done:o})}},{key:"close",value:function(){}}]),e}();function fu(e){return(fu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vu(e,t,s){return t&&function(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,bu(i.key),i)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function bu(e){var t=function(e,t){if("object"!==fu(e)||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t);if("object"!==fu(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"===fu(t)?t:String(t)}function yu(e){return void 0===e?0:void 0!==e.size?e.size:e.length}var wu=/* @__PURE__ */function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._buffer=void 0,this._bufferOffset=0,this._reader=t,this._done=!1}return vu(e,[{key:"slice",value:function(e,t){return e<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(e,t)}},{key:"_readUntilEnoughDataOrDone",value:function(e,t){var s=this,i=t<=this._bufferOffset+yu(this._buffer);if(this._done||i){var o=this._getDataFromBuffer(e,t),r=null==o&&this._done;return Promise.resolve({value:o,done:r})}return this._reader.read().then(function(i){var o=i.value;return i.done?s._done=!0:void 0===s._buffer?s._buffer=o:s._buffer=function(e,t){if(e.concat)return e.concat(t);if(e instanceof Blob)return new Blob([e,t],{type:e.type});if(e.set){var s=new e.constructor(e.length+t.length);return s.set(e),s.set(t,e.length),s}throw new Error("Unknown data type")}(s._buffer,o),s._readUntilEnoughDataOrDone(e,t)})}},{key:"_getDataFromBuffer",value:function(e,t){e>this._bufferOffset&&(this._buffer=this._buffer.slice(e-this._bufferOffset),this._bufferOffset=e);var s=0===yu(this._buffer);return this._done&&s?null:this._buffer.slice(0,t-e)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}]),e}();function xu(e){return(xu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _u(){_u=function(){return t};var e,t={},s=Object.prototype,i=s.hasOwnProperty,o=Object.defineProperty||function(e,t,s){e[t]=s.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",n=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(e,t,s){return Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(T){c=function(e,t,s){return e[t]=s}}function d(e,t,s,i){var r=t&&t.prototype instanceof v?t:v,a=Object.create(r.prototype),n=new A(i||[]);return o(a,"_invoke",{value:$(e,s,n)}),a}function h(e,t,s){try{return{type:"normal",arg:e.call(t,s)}}catch(i){return{type:"throw",arg:i}}}t.wrap=d;var u="suspendedStart",p="suspendedYield",g="executing",m="completed",f={};function v(){}function b(){}function y(){}var w={};c(w,a,function(){return this});var x=Object.getPrototypeOf,_=x&&x(x(I([])));_&&_!==s&&i.call(_,a)&&(w=_);var k=y.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function C(e,t){function s(o,r,a,n){var l=h(e[o],e,r);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==xu(d)&&i.call(d,"__await")?t.resolve(d.__await).then(function(e){s("next",e,a,n)},function(e){s("throw",e,a,n)}):t.resolve(d).then(function(e){c.value=e,a(c)},function(e){return s("throw",e,a,n)})}n(l.arg)}var r;o(this,"_invoke",{value:function(e,i){function o(){return new t(function(t,o){s(e,i,t,o)})}return r=r?r.then(o,o):o()}})}function $(t,s,i){var o=u;return function(r,a){if(o===g)throw new Error("Generator is already running");if(o===m){if("throw"===r)throw a;return{value:e,done:!0}}for(i.method=r,i.arg=a;;){var n=i.delegate;if(n){var l=D(n,i);if(l){if(l===f)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(o===u)throw o=m,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o=g;var c=h(t,s,i);if("normal"===c.type){if(o=i.done?m:p,c.arg===f)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(o=m,i.method="throw",i.arg=c.arg)}}}function D(t,s){var i=s.method,o=t.iterator[i];if(o===e)return s.delegate=null,"throw"===i&&t.iterator.return&&(s.method="return",s.arg=e,D(t,s),"throw"===s.method)||"return"!==i&&(s.method="throw",s.arg=new TypeError("The iterator does not provide a '"+i+"' method")),f;var r=h(o,t.iterator,s.arg);if("throw"===r.type)return s.method="throw",s.arg=r.arg,s.delegate=null,f;var a=r.arg;return a?a.done?(s[t.resultName]=a.value,s.next=t.nextLoc,"return"!==s.method&&(s.method="next",s.arg=e),s.delegate=null,f):a:(s.method="throw",s.arg=new TypeError("iterator result is not an object"),s.delegate=null,f)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function I(t){if(t||""===t){var s=t[a];if(s)return s.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,r=function s(){for(;++o<t.length;)if(i.call(t,o))return s.value=t[o],s.done=!1,s;return s.value=e,s.done=!0,s};return r.next=r}}throw new TypeError(xu(t)+" is not iterable")}return b.prototype=y,o(k,"constructor",{value:y,configurable:!0}),o(y,"constructor",{value:b,configurable:!0}),b.displayName=c(y,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,l,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},S(C.prototype),c(C.prototype,n,function(){return this}),t.AsyncIterator=C,t.async=function(e,s,i,o,r){void 0===r&&(r=Promise);var a=new C(d(e,s,i,o),r);return t.isGeneratorFunction(s)?a:a.next().then(function(e){return e.done?e.value:a.next()})},S(k),c(k,l,"Generator"),c(k,a,function(){return this}),c(k,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),s=[];for(var i in t)s.push(i);return s.reverse(),function e(){for(;s.length;){var i=s.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=I,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(M),!t)for(var s in this)"t"===s.charAt(0)&&i.call(this,s)&&!isNaN(+s.slice(1))&&(this[s]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var s=this;function o(i,o){return n.type="throw",n.arg=t,s.next=i,o&&(s.method="next",s.arg=e),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],n=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=i.call(a,"catchLoc"),c=i.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s];if(o.tryLoc<=this.prev&&i.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.finallyLoc===e)return this.complete(s.completion,s.afterLoc),M(s),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.tryLoc===e){var i=s.completion;if("throw"===i.type){var o=i.arg;M(s)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,s,i){return this.delegate={iterator:I(t),resultName:s,nextLoc:i},"next"===this.method&&(this.arg=e),f}},t}function ku(e,t,s,i,o,r,a){try{var n=e[r](a),l=n.value}catch(c){return void s(c)}n.done?t(l):Promise.resolve(l).then(i,o)}function Su(e,t,s){return t&&function(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Cu(i.key),i)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Cu(e){var t=function(e,t){if("object"!==xu(e)||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t);if("object"!==xu(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"===xu(t)?t:String(t)}var $u=/* @__PURE__ */function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,s;return Su(e,[{key:"openFile",value:(t=/* @__PURE__ */_u().mark(function e(t,s){var i;return _u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!du()||!t||void 0===t.uri){e.next=11;break}return e.prev=1,e.next=4,hu(t.uri);case 4:return i=e.sent,e.abrupt("return",new mu(i));case 8:throw e.prev=8,e.t0=e.catch(1),new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. ".concat(e.t0));case 11:if("function"!=typeof t.slice||void 0===t.size){e.next=13;break}return e.abrupt("return",Promise.resolve(new mu(t)));case 13:if("function"!=typeof t.read){e.next=18;break}if(s=Number(s),Number.isFinite(s)){e.next=17;break}return e.abrupt("return",Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option")));case 17:return e.abrupt("return",Promise.resolve(new wu(t,s)));case 18:return e.abrupt("return",Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment")));case 19:case"end":return e.stop()}},e,null,[[1,8]])}),s=function(){var e=this,s=arguments;return new Promise(function(i,o){var r=t.apply(e,s);function a(e){ku(r,i,o,a,n,"next",e)}function n(e){ku(r,i,o,a,n,"throw",e)}a(void 0)})},function(e,t){return s.apply(this,arguments)})}]),e}();function Du(e){return(Du="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Eu(e,t,s){return s&&function(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Ru(i.key),i)}}(e,s),Object.defineProperty(e,"prototype",{writable:!1}),e}function Mu(e,t){return(Mu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Au(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(U_){return!1}}();return function(){var s,i=Iu(e);if(t){var o=Iu(this).constructor;s=Reflect.construct(i,arguments,o)}else s=i.apply(this,arguments);return function(e,t){if(t&&("object"===Du(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,s)}}function Iu(e){return(Iu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Tu(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,i)}return s}function Pu(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Tu(Object(s),!0).forEach(function(t){Lu(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Tu(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function Lu(e,t,s){return(t=Ru(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function Ru(e){var t=function(e,t){if("object"!==Du(e)||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t);if("object"!==Du(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Du(t)?t:String(t)}var Ou=Pu(Pu({},Oh.defaultOptions),{},{httpStack:new nu,fileReader:new $u,urlStorage:tu?new su:new Gh,fingerprint:function(e,t){return du()?Promise.resolve(function(e,t){var s=e.exif?function(e){var t=0;if(0===e.length)return t;for(var s=0;s<e.length;s++){t=(t<<5)-t+e.charCodeAt(s),t&=t}return t}(JSON.stringify(e.exif)):"noexif";return["tus-rn",e.name||"noname",e.size||"nosize",s,t.endpoint].join("/")}(e,t)):Promise.resolve(["tus-br",e.name,e.type,e.size,e.lastModified,t.endpoint].join("-"))}}),Nu=/* @__PURE__ */function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Mu(e,t)}(t,Oh);var e=Au(t);function t(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=Pu(Pu({},Ou),i),e.call(this,s,i)}return Eu(t,0,[{key:"terminate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=Pu(Pu({},Ou),t),Oh.terminate(e,t)}}]),t}(),Bu=Object.defineProperty,Fu=Object.getOwnPropertyDescriptor,zu=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Fu(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Bu(t,s,r),r};let Uu=class extends me{constructor(){super(...arguments),this.show=!1,this.containerId="",this.containerName="",this.runtime="docker"}handleClose(){this.dispatchEvent(new CustomEvent("close"))}handleNewTab(){if(!this.containerId)return;const e=this.containerName?`&name=${encodeURIComponent(this.containerName)}`:"",t=`/containers/terminal?container=${encodeURIComponent(this.containerId)}&runtime=${encodeURIComponent(this.runtime)}${e}`;window.open(t,"_blank"),this.handleClose()}render(){if(!this.show)return null;const e=this.containerName||this.containerId||"Container";return J`
      <div class="modal-overlay" @click="${e=>e.target===this.shadowRoot?.querySelector(".modal-overlay")&&this.handleClose()}">
        <div class="modal-content">
          <div class="modal-header">
            <div class="header-left">
              <span>Terminal: ${e}</span>
            </div>
            <div class="btn-group">
              <button class="btn" @click="${this.handleNewTab}">Open in New Tab</button>
              <button class="btn btn-close" @click="${this.handleClose}">Close</button>
            </div>
          </div>
          <div class="modal-body">
            ${this.containerId?J`
              <container-terminal
                .containerId="${this.containerId}"
                .containerName="${this.containerName}"
                .runtime="${this.runtime}"
              ></container-terminal>
            `:J`<div style="padding: 20px; color: #ccc;">No container selected.</div>`}
          </div>
        </div>
      </div>
    `}};Uu.styles=g`
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #1e1e1e;
      width: 90%;
      height: 90%;
      display: flex;
      flex-direction: column;
      border-radius: 4px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      border: 1px solid #333;
    }
    .modal-header {
      padding: 10px 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #252526;
      border-bottom: 1px solid #333;
      color: #cccccc;
      font-size: 14px;
      font-weight: 500;
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .modal-body {
      flex: 1;
      overflow: hidden;
      position: relative;
      background: #1e1e1e;
    }
    .btn-group {
      display: flex;
      gap: 8px;
    }
    .btn {
      background: #3c3c3c;
      border: 1px solid #3c3c3c;
      color: #cccccc;
      cursor: pointer;
      padding: 4px 12px;
      border-radius: 2px;
      font-size: 12px;
    }
    .btn:hover {
      background: #4b4b4b;
    }
    .btn-close {
      background: #cc3333;
    }
    .btn-close:hover {
      background: #e63333;
    }
  `,zu([we({type:Boolean})],Uu.prototype,"show",2),zu([we({type:String})],Uu.prototype,"containerId",2),zu([we({type:String})],Uu.prototype,"containerName",2),zu([we({type:String})],Uu.prototype,"runtime",2),Uu=zu([ve("container-terminal-modal")],Uu);var Vu=Object.defineProperty,ju=Object.getOwnPropertyDescriptor,Hu=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?ju(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Vu(t,s,r),r};let Wu=class extends me{constructor(){super(...arguments),this.value="",this.suggestions=[],this.placeholder="e.g. nginx:latest",this.disabled=!1,this.open=!1,this.highlightIndex=-1}dispatchChange(){this.dispatchEvent(new CustomEvent("image-change",{detail:{value:this.value},bubbles:!0,composed:!0}))}handleFocus(){this.open=!0}handleBlur(){window.setTimeout(()=>{this.open=!1,this.highlightIndex=-1},150)}handleInput(e){const t=e.target;this.value=t.value,this.open=!0,this.highlightIndex=-1,this.dispatchChange()}handleKeydown(e){if(this.open&&0!==this.filteredSuggestions.length)if("ArrowDown"===e.key)e.preventDefault(),this.highlightIndex=(this.highlightIndex+1)%this.filteredSuggestions.length;else if("ArrowUp"===e.key)e.preventDefault(),this.highlightIndex=(this.highlightIndex-1+this.filteredSuggestions.length)%this.filteredSuggestions.length;else if("Enter"===e.key){if(this.highlightIndex>=0&&this.highlightIndex<this.filteredSuggestions.length){e.preventDefault();const t=this.filteredSuggestions[this.highlightIndex];t&&this.selectSuggestion(t)}}else"Escape"===e.key&&(this.open=!1,this.highlightIndex=-1)}selectSuggestion(e){this.value=e,this.dispatchChange(),this.open=!1,this.highlightIndex=-1}get filteredSuggestions(){const e=(this.suggestions||[]).filter(Boolean),t=(this.value||"").trim().toLowerCase();if(!t)return e.slice(0,20);const s=e=>{const s=e.toLowerCase();return s===t?0:s.startsWith(t)?1:s.includes(t)?2:3},i=e.filter(e=>e.toLowerCase().includes(t));return i.sort((e,t)=>s(e)-s(t)),i.slice(0,20)}render(){const e=this.filteredSuggestions;return J`
      <div class="wrapper">
        <input
          class="input"
          .value=${this.value}
          .placeholder=${this.placeholder}
          ?disabled=${this.disabled}
          @focus=${this.handleFocus}
          @blur=${this.handleBlur}
          @input=${this.handleInput}
          @keydown=${this.handleKeydown}
        />
        ${this.open?J`
          <div class="dropdown">
            ${0===e.length?J`<div class="status">No matches</div>`:e.map((e,t)=>J`
                  <div
                    class="row ${t===this.highlightIndex?"highlight":""}"
                    @mousedown=${()=>this.selectSuggestion(e)}
                  >
                    <div class="primary">${e}</div>
                  </div>
                `)}
          </div>
        `:""}
      </div>
    `}};Wu.styles=g`
    :host {
      display: block;
    }

    .wrapper {
      position: relative;
    }

    .input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid var(--vscode-input-border, #858585);
      border-radius: 4px;
      background: var(--vscode-input-background, #3c3c3c);
      color: var(--vscode-input-foreground, #cccccc);
      font-size: 13px;
      font-family: inherit;
      transition: all 0.2s;
      outline: none;
      box-sizing: border-box;
    }

    .input:focus {
      outline: none;
      border-color: var(--vscode-focusBorder, #007acc);
      box-shadow: 0 0 0 1px var(--vscode-focusBorder, #007acc);
    }

    .input:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .input::placeholder {
      color: var(--vscode-input-placeholderForeground, rgba(204, 204, 204, 0.6));
    }

    .dropdown {
      position: absolute;
      top: calc(100% + 4px);
      left: 0;
      right: 0;
      background: var(--vscode-editorWidget-background, var(--vscode-editor-background, #1e1e1e));
      border: 1px solid var(--vscode-input-border, #858585);
      border-radius: 4px;
      max-height: 260px;
      overflow: auto;
      z-index: 1000;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
    }

    .row {
      padding: 8px 10px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .row:hover,
    .row.highlight {
      background: var(--vscode-list-hoverBackground, rgba(255, 255, 255, 0.08));
    }

    .primary {
      font-size: 13px;
      color: var(--vscode-foreground, #e0e0e0);
      line-height: 1.2;
      word-break: break-all;
    }

    .secondary {
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #b5b5b5);
      line-height: 1.2;
    }

    .status {
      padding: 8px 10px;
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #b5b5b5);
    }
  `,Hu([we({type:String})],Wu.prototype,"value",2),Hu([we({type:Array})],Wu.prototype,"suggestions",2),Hu([we({type:String})],Wu.prototype,"placeholder",2),Hu([we({type:Boolean})],Wu.prototype,"disabled",2),Hu([xe()],Wu.prototype,"open",2),Hu([xe()],Wu.prototype,"highlightIndex",2),Wu=Hu([ve("container-image-autocomplete")],Wu);var qu=Object.defineProperty,Ku=Object.getOwnPropertyDescriptor,Gu=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Ku(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&qu(t,s,r),r};let Qu=class extends me{constructor(){super(...arguments),this.notifications=[],this.defaultDuration=5e3,this.maxNotifications=5,this.closingIds=/* @__PURE__ */new Set,this.timers=/* @__PURE__ */new Map}render(){const e=this.notifications.slice(-this.maxNotifications);return J`
      <div class="container" part="container">
        ${e.map(e=>this.renderNotification(e))}
      </div>
    `}renderNotification(e){const t=this.closingIds.has(e.id),s=this.getIcon(e.type);return J`
      <div
        class="notification ${e.type} ${t?"closing":""}"
        part="notification notification-${e.type}"
        @animationend=${t=>this.handleAnimationEnd(t,e.id)}
      >
        <svg class="notification-icon" viewBox="0 0 20 20" fill="currentColor">
          ${s}
        </svg>
        
        <div class="notification-content">
          <div class="notification-message">${e.message}</div>
          
          ${e.actions&&e.actions.length>0?J`
            <div class="notification-actions">
              ${e.actions.map(t=>J`
                <button
                  class="notification-action"
                  @click=${()=>{t.handler(),this.closeNotification(e.id)}}
                >
                  ${t.label}
                </button>
              `)}
            </div>
          `:""}
        </div>
        
        <button
          class="close-button"
          @click=${()=>this.closeNotification(e.id)}
          aria-label="Close notification"
        >
          <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
            <path d="M9 3L3 9M3 3l6 6" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
        
        ${e.duration?J`
          <div
            class="progress-bar"
            style="width: 100%; transition-duration: ${e.duration}ms;"
          ></div>
        `:""}
      </div>
    `}getIcon(e){switch(e){case"info":return J`<path d="M10 2a8 8 0 100 16 8 8 0 000-16zM9 7h2v7H9zm0-2h2v1.5H9z"/>`;case"success":return J`<path d="M10 2a8 8 0 100 16 8 8 0 000-16zm4 6l-5 5-3-3 1-1 2 2 4-4 1 1z"/>`;case"warning":return J`<path d="M10 2l8 14H2L10 2zm0 4l-4 7h8l-4-7zm-1 3h2v3H9zm0 4h2v1H9z"/>`;case"error":return J`<path d="M10 2a8 8 0 100 16 8 8 0 000-16zm3 4L10 9l-3-3-1 1 3 3-3 3 1 1 3-3 3 3 1-1-3-3 3-3-1-1z"/>`}}closeNotification(e){this.closingIds.add(e),this.requestUpdate();const t=this.timers.get(e);t&&(clearTimeout(t),this.timers.delete(e))}handleAnimationEnd(e,t){"slideOut"===e.animationName&&this.removeNotification(t)}removeNotification(e){this.notifications=this.notifications.filter(t=>t.id!==e),this.closingIds.delete(e),this.timers.delete(e),this.dispatchEvent(new CustomEvent("notification-closed",{detail:{id:e},bubbles:!0,composed:!0}))}addNotification(e){const t=`notification-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s={...e,id:t,duration:e.duration??("error"===e.type?0:this.defaultDuration)};if(this.notifications=[...this.notifications,s],s.duration&&s.duration>0){const e=setTimeout(()=>{this.closeNotification(t)},s.duration);this.timers.set(t,e)}return t}removeAllNotifications(){this.timers.forEach(e=>clearTimeout(e)),this.timers.clear(),this.notifications.forEach(e=>this.closingIds.add(e.id)),this.requestUpdate(),setTimeout(()=>{this.notifications=[],this.closingIds.clear()},300)}disconnectedCallback(){super.disconnectedCallback(),this.timers.forEach(e=>clearTimeout(e)),this.timers.clear()}};Qu.styles=g`
    :host {
      display: block;
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      pointer-events: none;
    }

    .container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-width: 400px;
    }

    .notification {
      background: var(--notification-bg, #2c2f3a);
      border: 1px solid var(--notification-border, #3a3d4a);
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: flex-start;
      gap: 12px;
      pointer-events: auto;
      animation: slideIn 0.3s ease-out;
      position: relative;
    }

    .notification.closing {
      animation: slideOut 0.3s ease-out forwards;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }

    .notification-icon {
      flex-shrink: 0;
      width: 20px;
      height: 20px;
    }

    .notification.info {
      border-color: var(--info-border, #2196f3);
    }

    .notification.info .notification-icon {
      color: var(--info-color, #2196f3);
    }

    .notification.success {
      border-color: var(--success-border, #4caf50);
    }

    .notification.success .notification-icon {
      color: var(--success-color, #4caf50);
    }

    .notification.warning {
      border-color: var(--warning-border, #ff9800);
    }

    .notification.warning .notification-icon {
      color: var(--warning-color, #ff9800);
    }

    .notification.error {
      border-color: var(--error-border, #f44336);
    }

    .notification.error .notification-icon {
      color: var(--error-color, #f44336);
    }

    .notification-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .notification-message {
      color: var(--message-color, #e0e0e0);
      font-size: 14px;
      line-height: 1.5;
      word-break: break-word;
    }

    .notification-actions {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }

    .notification-action {
      background: none;
      border: 1px solid var(--action-border, #4a4d5a);
      color: var(--action-color, #e0e0e0);
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .notification-action:hover {
      background: var(--action-hover-bg, rgba(255, 255, 255, 0.1));
      border-color: var(--action-hover-border, #5a5d6a);
    }

    .close-button {
      position: absolute;
      top: 8px;
      right: 8px;
      background: none;
      border: none;
      color: var(--close-color, #999);
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      transition: all 0.2s;
      opacity: 0.7;
    }

    .close-button:hover {
      background: var(--close-hover-bg, rgba(255, 255, 255, 0.1));
      opacity: 1;
    }

    .progress-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      background: var(--progress-color, currentColor);
      border-radius: 0 0 8px 8px;
      transition: width linear;
      opacity: 0.3;
    }
  `,Gu([we({type:Array})],Qu.prototype,"notifications",2),Gu([we({type:Number})],Qu.prototype,"defaultDuration",2),Gu([we({type:Number})],Qu.prototype,"maxNotifications",2),Gu([xe()],Qu.prototype,"closingIds",2),Qu=Gu([ve("notification-container")],Qu);var Ju=Object.defineProperty,Yu=(e,t,s,i)=>{for(var o,r=void 0,a=e.length-1;a>=0;a--)(o=e[a])&&(r=o(t,s,r)||r);return r&&Ju(t,s,r),r};class Xu extends me{constructor(){super(...arguments),this.activeTab="containers",this.containers=[],this.images=[],this.searchTerm="",this.error=null,this.runtime=null,this.containerEventsLive=!1,this.showTerminalModal=!1,this.terminalContainerId="",this.terminalContainerName="",this.unsubscribeContainerEvents=null,this.containerPollingTimer=null,this.containerRefetchTimer=null,this.containerDropNotified=!1,this.containerHasConnectedOnce=!1,this.showConfirmModal=!1,this.confirmAction=null,this.selectedContainer=null,this.selectedImage=null,this.showDrawer=!1,this.detailError=null,this.confirmTitle="",this.confirmMessage="",this.showLogsDrawer=!1,this.containerLogs="",this.logsError=null,this.logsSearchTerm="",this.showImageActionsDropdown=!1,this.showPullImageModal=!1,this.imageName="",this.isPullingImage=!1,this.selectedFile=null,this.showUploadDrawer=!1,this.uploadQueue=[],this.isUploading=!1,this.currentUpload=null,this.showCreateDrawer=!1,this.isClosingCreateDrawer=!1,this.createError=null,this.isCreating=!1,this.createName="",this.createImage="",this.createEntrypoint="",this.createCmd="",this.createEnv="",this.createLabels="",this.createWorkingDir="",this.createCpuCores="",this.createMemoryMB="",this.createHostNetwork=!1,this.createPorts=[],this.createVolumes=[],this.handleLocationChange=()=>{window.location.pathname.endsWith("/containers/images")?this.activeTab="images":this.activeTab="containers",this.fetchData()}}static{this.styles=g`
    :host {
      display: block;
      padding: 16px;
    }

    .tab-container {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .tab-header {
      display: flex;
      border-bottom: 2px solid var(--border-color);
      margin-bottom: 1rem;
    }

    .tab-button {
      padding: 0.75rem 1.5rem;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 0.875rem;
      color: var(--text-secondary);
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
      transition: all 0.2s;
    }

    .tab-button:hover {
      color: var(--text-primary);
    }

    .tab-button.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }

    .tab-content {
      flex: 1;
      overflow-y: auto;
    }

    .container {
      background: var(--vscode-bg-light);
      color: var(--vscode-text);
      padding: 16px;
      border-radius: 6px;
      margin-bottom: 16px;
    }

    .container-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      margin-bottom: 8px;
    }

    .container-info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 16px;
      font-size: 13px;
    }

    .container-actions {
      display: flex;
      gap: 8px;
    }

    button {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--vscode-accent);
      color: white;
    }

    .btn-primary:hover {
      background: var(--vscode-accent-hover);
    }

    .btn-danger {
      background: var(--vscode-error);
      color: white;
    }

    .btn-danger:hover {
      opacity: 0.9;
    }

    .size-info {
      font-size: 12px;
      color: var(--vscode-text-dim);
    }


    .title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .live-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--vscode-widget-border, var(--vscode-panel-border, #454545));
      font-size: 11px;
      color: var(--vscode-descriptionForeground);
      user-select: none;
    }

    .live-indicator .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(204, 204, 204, 0.5);
    }

    .live-indicator.on {
      border-color: rgba(137, 209, 133, 0.6);
      color: rgba(137, 209, 133, 1);
    }

    .live-indicator.on .dot {
      background: rgba(137, 209, 133, 1);
    }

    .live-indicator.off {
      opacity: 0.75;
    }
    h1 {
      margin: 0 0 24px 0;
      font-size: 24px;
      font-weight: 300;
    }

    h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: var(--text-primary);
    }

    .image {
      background: var(--vscode-bg-light);
      color: var(--vscode-text);
      padding: 16px;
      border-radius: 6px;
      margin-bottom: 16px;
    }

    .image-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      margin-bottom: 8px;
    }

    .image-info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 16px;
      font-size: 13px;
    }

    .image-actions {
      display: flex;
      gap: 8px;
    }

    .search-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      gap: 1rem;
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .section-header h2 {
      margin: 0;
    }

    .search-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      max-width: 400px;
    }

    .search-icon {
      position: absolute;
      left: 12px;
      color: var(--vscode-input-placeholderForeground, #999);
      pointer-events: none;
      width: 16px;
      height: 16px;
    }

    .search-input {
      padding: 6px 12px 6px 32px;
      border: 1px solid var(--vscode-widget-border, var(--vscode-input-border, var(--vscode-panel-border, #454545)));
      border-radius: 4px;
      background-color: var(--vscode-input-background);
      color: var(--vscode-input-foreground);
      font-size: 0.875rem;
      width: 250px;
      transition: all 0.2s;
      outline: none;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.08);
    }

    .search-input:hover {
      border-color: var(--vscode-inputOption-hoverBorder, var(--vscode-widget-border, #858585));
    }

    .search-input:focus {
      border-color: var(--vscode-focusBorder, #007acc);
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1), 0 0 0 1px var(--vscode-focusBorder, #007acc);
    }

    .search-input::placeholder {
      color: var(--vscode-input-placeholderForeground, #999);
      opacity: 0.7;
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }

    .error-state {
      text-align: center;
      padding: 3rem;
      color: var(--vscode-error);
      background: var(--vscode-bg-light);
      border-radius: 6px;
      margin: 2rem 0;
    }


    .table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: var(--vscode-bg-light);
      border-radius: 1px;
      overflow: visible;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      border: 1px solid var(--vscode-border);
    }

    .table thead {
      background: var(--vscode-bg-lighter);
    }

    .table th {
      background: var(--vscode-bg-dark);
      color: var(--vscode-text);
      font-weight: 600;
      text-align: left;
      padding: 12px 16px;
      font-size: 0.875rem;
      border-bottom: 1px solid var(--vscode-border);
    }

    .table td {
      padding: 12px 16px;
      color: var(--vscode-text);
      font-size: 0.875rem;
      border-bottom: 1px solid var(--vscode-border);
      position: relative;
    }

    .table td:last-child {
      text-align: right;
    }

    .table tr:last-child td {
      border-bottom: none;
    }

    .table tr:hover td {
      background: rgba(255, 255, 255, 0.02);
    }

    .table td button {
      margin-right: 8px;
    }

    .table td button:last-child {
      margin-right: 0;
    }

    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-icon {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      position: relative;
    }

    .status-icon.running {
      background-color: #4caf50;
      box-shadow: 0 0 4px #4caf50;
    }

    .status-icon.stopped {
      background-color: #9e9e9e;
    }

    .status-icon.paused {
      background-color: #ff9800;
    }

    .status-icon.exited {
      background-color: #f44336;
    }

    .status-icon[data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      padding: 6px 12px;
      background-color: var(--vscode-editorWidget-background, var(--vscode-dropdown-background, #252526));
      color: var(--vscode-editorWidget-foreground, var(--vscode-foreground, #cccccc));
      border: 1px solid var(--vscode-editorWidget-border, var(--vscode-widget-border, #454545));
      border-radius: 4px;
      font-size: 14px;
      white-space: nowrap;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .truncate {
      max-width: 200px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: inline-block;
      position: relative;
    }

    .truncate[title]:hover::after {
      content: attr(title);
      position: absolute;
      left: 0;
      top: 100%;
      margin-top: 4px;
      padding: 6px 12px;
      background-color: var(--vscode-editorWidget-background, var(--vscode-dropdown-background, #252526));
      color: var(--vscode-editorWidget-foreground, var(--vscode-foreground, #cccccc));
      border: 1px solid var(--vscode-editorWidget-border, var(--vscode-widget-border, #454545));
      border-radius: 4px;
      font-size: 14px;
      white-space: nowrap;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      pointer-events: none;
    }

    .action-menu {
      position: relative;
      display: inline-block;
    }

    .action-dots {
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 8px;
      color: var(--text-secondary);
      font-size: 18px;
      line-height: 1;
      transition: background-color 0.2s;
      border-radius: 4px;
    }

    .action-dots:hover {
      background-color: var(--vscode-toolbar-hoverBackground, var(--vscode-list-hoverBackground, rgba(90, 93, 94, 0.1)));
    }

    .action-dropdown {
      position: absolute;
      right: 0;
      top: 100%;
      margin-top: 4px;
      background: var(--vscode-dropdown-background, var(--vscode-menu-background, var(--vscode-bg-light, #252526)));
      border: 1px solid var(--vscode-dropdown-border, var(--vscode-menu-border, var(--border-color, #454545)));
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      min-width: 160px;
      z-index: 1000;
      display: none;
    }

    .action-dropdown.show {
      display: block;
    }

    .action-dropdown.open-up {
      top: auto;
      bottom: 100%;
      margin-top: 0;
      margin-bottom: 4px;
    }

    .action-dropdown button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 8px 16px;
      border: none;
      background: none;
      color: var(--vscode-menu-foreground, var(--vscode-foreground, var(--vscode-text, #cccccc)));
      cursor: pointer;
      font-size: 13px;
      transition: background-color 0.2s;
    }

    .action-dropdown button:hover {
      background-color: var(--vscode-list-hoverBackground, var(--vscode-toolbar-hoverBackground, rgba(255, 255, 255, 0.08)));
      color: var(--vscode-list-hoverForeground, var(--vscode-foreground));
    }

    .action-dropdown button.danger {
      color: var(--vscode-error);
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--vscode-accent, #007acc);
      color: white;
    }

    .btn-primary:hover {
      background: var(--vscode-accent-hover, #005a9e);
    }

    .btn-secondary {
      background: var(--vscode-button-secondary-bg, #3c3c3c);
      color: var(--vscode-button-secondary-foreground, #cccccc);
      border: 1px solid var(--vscode-button-secondary-border, #5a5a5a);
    }

    .btn-secondary:hover {
      background: var(--vscode-button-secondary-hover-bg, #484848);
    }

    .drawer {
      position: fixed;
      top: 0;
      right: 0;
      width: 50%;
      height: 100%;
      background: var(--vscode-bg-light);
      border-left: 1px solid var(--vscode-border);
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      z-index: 1001;
      overflow-y: auto;
      padding: 24px;
      animation: slideIn 0.3s ease-out;
    }

    /* Make drawer full width on smaller screens */
    @media (max-width: 1024px) {
      .drawer {
        width: 80%;
      }
    }

    @media (max-width: 768px) {
      .drawer {
        width: 100%;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
      }
      to {
        transform: translateX(0);
      }
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
      }
      to {
        transform: translateX(100%);
      }
    }

    .create-drawer {
      position: fixed;
      top: 0;
      right: 0;
      width: 50%;
      height: 100%;
      background: var(--vscode-editor-background, var(--vscode-bg));
      border-left: 1px solid var(--vscode-border);
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      z-index: 1001;
      overflow-y: auto;
      animation: slideIn 0.3s ease-out;
      display: flex;
      flex-direction: column;
    }

    @media (max-width: 1024px) {
      .create-drawer {
        width: 80%;
      }
    }

    @media (max-width: 768px) {
      .create-drawer {
        width: 100%;
      }
    }

    .create-drawer.closing {
      animation: slideOut 0.3s ease-in forwards;
    }

    .create-drawer-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--vscode-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--vscode-bg-lighter, #252526);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .create-drawer-title {
      font-size: 18px;
      font-weight: 500;
      color: var(--vscode-foreground);
      margin: 0;
    }

    .create-drawer-content {
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    .create-drawer-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--vscode-border);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      background: var(--vscode-bg-lighter, #252526);
      position: sticky;
      bottom: 0;
      z-index: 10;
    }

    .create-close-btn {
      background: transparent;
      border: none;
      color: var(--vscode-foreground, #cccccc);
      cursor: pointer;
      padding: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      font-size: 20px;
      line-height: 1;
      transition: all 0.2s;
    }

    .create-close-btn:hover {
      background: var(--vscode-toolbar-hoverBackground, rgba(90, 93, 94, 0.31));
      color: var(--vscode-icon-foreground, #c5c5c5);
    }

    .drawer h2 {
      margin-top: 0;
    }

    .drawer pre {
      background: var(--vscode-bg-dark);
      border: 1px solid var(--vscode-widget-border, var(--vscode-panel-border, #454545));
      border-radius: 4px;
      padding: 16px;
      overflow-x: auto;
      font-size: 0.875rem;
      color: var(--vscode-text);
    }

    .drawer button.close-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      background: var(--vscode-toolbar-hoverBackground, rgba(90, 93, 94, 0.1));
      color: var(--vscode-foreground, var(--vscode-editor-foreground));
      border: 1px solid var(--vscode-widget-border, rgba(0, 0, 0, 0.1));
      transition: all 0.2s;
    }

    .drawer button.close-btn:hover {
      background: var(--vscode-list-hoverBackground, rgba(90, 93, 94, 0.2));
      border-color: var(--vscode-widget-border, rgba(0, 0, 0, 0.2));
    }

    .drawer button.close-btn:active {
      background: var(--vscode-list-activeSelectionBackground, rgba(90, 93, 94, 0.3));
    }

    .drawer button.close-btn:focus {
      outline: 1px solid var(--vscode-focusBorder, #007acc);
      outline-offset: 2px;
    }

    .drawer-content {
      margin-top: 40px;
      padding-bottom: 80px;
    }

    .form-section {
      margin-bottom: 24px;
    }

    .form-section h3 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-primary);
      border-bottom: 1px solid var(--vscode-border);
      padding-bottom: 8px;
    }

    .form-field {
      margin-bottom: 12px;
    }

    .form-label {
      display: block;
      font-size: 0.8125rem;
      color: var(--text-secondary);
      margin-bottom: 4px;
      font-weight: 500;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid var(--vscode-widget-border, var(--vscode-input-border, var(--vscode-panel-border, #454545)));
      border-radius: 4px;
      background-color: var(--vscode-input-background);
      color: var(--vscode-input-foreground);
      font-size: 0.875rem;
      font-family: inherit;
      outline: none;
      box-sizing: border-box;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      border-color: var(--vscode-focusBorder, #007acc);
    }

    .form-textarea {
      min-height: 80px;
      resize: vertical;
    }

    .form-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .form-row .form-input,
    .form-row .form-select {
      flex: 1;
    }

    .toggle-row {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      margin: 8px 0 6px;
    }

    .toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border: 1px solid var(--vscode-widget-border, var(--vscode-panel-border, #454545));
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.02);
    }

    .toggle input {
      width: 14px;
      height: 14px;
    }

    .form-hint {
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #999);
      margin-top: 4px;
    }

    .btn-small {
      padding: 6px 10px;
      font-size: 12px;
    }

    .list-item {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
    }

    .detail-section {
      margin-bottom: 24px;
    }

    .detail-section h3 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-primary);
      border-bottom: 1px solid var(--vscode-border);
      padding-bottom: 8px;
    }

    .detail-item {
      display: flex;
      flex-direction: column;
      margin-bottom: 12px;
    }

    .detail-label {
      font-size: 0.8125rem;
      color: var(--text-secondary);
      margin-bottom: 4px;
      font-weight: 500;
    }

    .detail-value {
      font-size: 0.875rem;
      color: var(--vscode-text);
      word-break: break-word;
    }

    .detail-value.monospace {
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      background: var(--vscode-textCodeBlock-background, rgba(255, 255, 255, 0.04));
      padding: 4px 8px;
      border-radius: 3px;
      font-size: 0.8125rem;
    }

    .tag-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .tag {
      background: var(--vscode-badge-background);
      color: var(--vscode-badge-foreground);
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: 16px;
      font-size: 0.875rem;
      font-weight: 500;
    }

    .status-badge.running {
      background: rgba(76, 175, 80, 0.1);
      color: #4caf50;
      border: 1px solid rgba(76, 175, 80, 0.3);
    }

    .status-badge.stopped {
      background: rgba(158, 158, 158, 0.1);
      color: #9e9e9e;
      border: 1px solid rgba(158, 158, 158, 0.3);
    }

    .status-badge.paused {
      background: rgba(255, 152, 0, 0.1);
      color: #ff9800;
      border: 1px solid rgba(255, 152, 0, 0.3);
    }

    .status-badge.exited {
      background: rgba(244, 67, 54, 0.1);
      color: #f44336;
      border: 1px solid rgba(244, 67, 54, 0.3);
    }

    a {
      color: var(--vscode-textLink-foreground, #3794ff);
      text-decoration: none;
      cursor: pointer;
    }

    a:hover {
      text-decoration: underline;
    }

    /* Link-style buttons for clickable items */
    button.link-button,
    td button {
      background: none;
      border: none;
      color: var(--vscode-textLink-foreground, #3794ff);
      cursor: pointer;
      font-size: inherit;
      font-family: inherit;
      text-align: left;
      padding: 0;
      text-decoration: none;
      transition: text-decoration 0.2s;
    }

    button.link-button:hover,
    td button:hover {
      text-decoration: underline;
    }

    td button:focus {
      outline: 1px solid var(--vscode-focusBorder, #007acc);
      outline-offset: 2px;
    }

    .error-container {
      padding: 40px 20px;
      text-align: center;
    }

    .error-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.7;
    }

    .error-message {
      color: var(--vscode-errorForeground, #f48771);
      font-size: 14px;
      line-height: 1.5;
      margin: 0;
    }

    .logs-container {
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 0.875rem;
      line-height: 1.5;
      background: var(--vscode-editor-background, #1e1e1e);
      color: var(--vscode-editor-foreground, #d4d4d4);
      padding: 16px;
      border-radius: 4px;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
      max-height: calc(100vh - 200px);
      overflow-y: auto;
    }

    .logs-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--vscode-border);
    }

    .logs-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--vscode-foreground);
    }

    /* Upload drawer styles */
    .upload-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--vscode-border);
    }

    .upload-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--vscode-foreground);
    }

    .upload-zone {
      border: 2px dashed var(--vscode-widget-border, #454545);
      border-radius: 8px;
      padding: 40px 20px;
      text-align: center;
      margin-bottom: 24px;
      transition: all 0.2s;
      cursor: pointer;
    }

    .upload-zone:hover {
      border-color: var(--vscode-focusBorder, #007acc);
      background: rgba(0, 122, 204, 0.05);
    }

    .upload-zone.dragover {
      border-color: var(--vscode-focusBorder, #007acc);
      background: rgba(0, 122, 204, 0.1);
    }

    .upload-icon {
      font-size: 48px;
      margin-bottom: 16px;
      color: var(--vscode-descriptionForeground, #999);
    }

    .upload-text {
      font-size: 16px;
      margin-bottom: 8px;
      color: var(--vscode-foreground);
    }

    .upload-hint {
      font-size: 14px;
      color: var(--vscode-descriptionForeground, #999);
    }

    .upload-queue {
      margin-top: 24px;
    }

    .upload-item {
      background: var(--vscode-bg-dark);
      border: 1px solid var(--vscode-widget-border, #454545);
      border-radius: 6px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .upload-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .upload-item-name {
      font-weight: 500;
      color: var(--vscode-foreground);
      flex: 1;
      margin-right: 12px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .upload-item-size {
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #999);
      margin-right: 12px;
    }

    .upload-item-status {
      font-size: 12px;
      font-weight: 500;
      padding: 2px 8px;
      border-radius: 4px;
    }

    .upload-item-status.pending {
      background: rgba(255, 193, 7, 0.2);
      color: #ffc107;
    }

    .upload-item-status.uploading {
      background: rgba(0, 122, 204, 0.2);
      color: #007acc;
    }

    .upload-item-status.completed {
      background: rgba(76, 175, 80, 0.2);
      color: #4caf50;
    }

    .upload-item-status.error {
      background: rgba(244, 67, 54, 0.2);
      color: #f44336;
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      background: var(--vscode-widget-border, #454545);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 8px;
    }

    .progress-fill {
      height: 100%;
      background: var(--vscode-focusBorder, #007acc);
      border-radius: 3px;
      transition: width 0.3s ease;
    }

    .progress-fill.completed {
      background: #4caf50;
    }

    .progress-fill.error {
      background: #f44336;
    }

    .progress-text {
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #999);
      display: flex;
      justify-content: space-between;
    }

    .upload-error {
      color: var(--vscode-errorForeground, #f48771);
      font-size: 12px;
      margin-top: 4px;
    }

    .upload-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid var(--vscode-widget-border, #454545);
    }

    .hidden-file-input {
      display: none;
    }
  `}connectedCallback(){super.connectedCallback(),this.startContainerEventStream(),this.handleLocationChange(),window.addEventListener("popstate",this.handleLocationChange),this.addEventListener("click",this.handleOutsideClick.bind(this)),this.handleKeyDown=this.handleKeyDown.bind(this),document.addEventListener("keydown",this.handleKeyDown)}disconnectedCallback(){super.disconnectedCallback(),this.stopContainerEventStream(),window.removeEventListener("popstate",this.handleLocationChange),this.removeEventListener("click",this.handleOutsideClick.bind(this)),document.removeEventListener("keydown",this.handleKeyDown)}handleTabClick(e,t){e.preventDefault(),this.activeTab=t;const s="images"===t?"/containers/cri/images":"/containers/cri";window.history.pushState({},"",s),this.fetchData()}async fetchData(){"containers"===this.activeTab?await this.fetchContainers():"images"===this.activeTab&&await this.fetchImages()}showToast(e,t="info"){const s=this.renderRoot?.querySelector("notification-container");s&&"function"==typeof s.addNotification&&s.addNotification({type:t,message:e})}startContainerEventStream(){this.unsubscribeContainerEvents||(this.unsubscribeContainerEvents=hc({channel:"container-events",routeId:"containers:container-events",onEvent:e=>this.handleContainerEvent(e),onConnectionChange:e=>this.handleContainerEventsConnectionChange(e)}))}stopContainerEventStream(){this.unsubscribeContainerEvents&&(this.unsubscribeContainerEvents(),this.unsubscribeContainerEvents=null),this.containerPollingTimer&&(window.clearInterval(this.containerPollingTimer),this.containerPollingTimer=null),this.containerRefetchTimer&&(window.clearTimeout(this.containerRefetchTimer),this.containerRefetchTimer=null),this.containerEventsLive=!1,this.containerDropNotified=!1}handleContainerEventsConnectionChange(e){if(this.containerEventsLive=e,!e)return this.containerHasConnectedOnce&&!this.containerDropNotified&&(this.showToast("Live container updates disconnected â falling back to polling","warning"),this.containerDropNotified=!0),void this.ensureContainerPolling();this.containerHasConnectedOnce=!0,this.containerDropNotified=!1,this.containerPollingTimer&&(window.clearInterval(this.containerPollingTimer),this.containerPollingTimer=null),this.scheduleContainersRefetch("reconnected")}ensureContainerPolling(){this.containerPollingTimer||(this.containerPollingTimer=window.setInterval(()=>{"containers"===this.activeTab&&this.fetchContainers()},3e4))}scheduleContainersRefetch(e){this.containerRefetchTimer||(this.containerRefetchTimer=window.setTimeout(async()=>{if(this.containerRefetchTimer=null,"containers"===this.activeTab)try{await this.fetchContainers()}catch{}},600))}handleContainerEvent(e){if(!e||"container"!==e.kind)return;const t=e.id?String(e.id):"";if(!t)return;const s=String(e.action||"").toLowerCase();"destroy"!==s?("start"===s?this.containers=this.containers.map(e=>e.id===t?{...e,state:"running",status:e.status||"running"}:e):"stop"!==s&&"die"!==s||(this.containers=this.containers.map(e=>e.id===t?{...e,state:"exited",status:e.status||"exited"}:e)),this.scheduleContainersRefetch(s)):this.containers=this.containers.filter(e=>e.id!==t)}async fetchContainerDetails(e){try{this.detailError=null;const t=await mc.get(`/containers/${e}`);console.log("Full container details response:",t);let s=null;t?.data?.container?s=t.data.container:t?.container?s=t.container:t?.id&&(s=t),console.log("Extracted container:",s),this.selectedContainer=s,this.selectedImage=null,this.showDrawer=!0}catch(t){console.error("Error fetching container details:",t),this.detailError=t instanceof uc?t.message:"Failed to fetch container details",this.selectedContainer=null,this.selectedImage=null,this.showDrawer=!0}}async fetchImageDetails(e){try{this.detailError=null;const t=await mc.get(`/containers/images/${e}`);console.log("Full image details response:",t);let s=null;t?.data?.image?s=t.data.image:t?.image?s=t.image:t?.id&&(s=t),console.log("Extracted image:",s),this.selectedImage=s,this.selectedContainer=null,this.showDrawer=!0}catch(t){console.error("Error fetching image details:",t),this.detailError=t instanceof uc?t.message:"Failed to fetch image details",this.selectedImage=null,this.selectedContainer=null,this.showDrawer=!0}}async fetchContainers(){try{const e=await mc.get("/containers");this.containers=e.containers||[],this.runtime=e.runtime||null,this.error=null}catch(e){console.error("Error fetching containers:",e),e instanceof uc&&"NO_RUNTIME_AVAILABLE"===e.code?(this.error=e.message||"No container runtime found",this.containers=[],this.runtime=null):this.error=e instanceof uc?e.message||"Failed to fetch containers":"Error connecting to server"}}async fetchImages(){try{const e=await mc.get("/containers/images");this.images=e.images||[],this.runtime=e.runtime||null,this.error=null}catch(e){console.error("Error fetching images:",e),e instanceof uc&&"NO_RUNTIME_AVAILABLE"===e.code?(this.error=e.message||"No container runtime found",this.images=[],this.runtime=null):this.error=e instanceof uc?e.message||"Failed to fetch images":"Error connecting to server"}}showConfirmDialog(e,t,s){this.confirmTitle=e,this.confirmMessage=t,this.confirmAction=s,this.showConfirmModal=!0,this.updateComplete.then(()=>{const e=this.shadowRoot?.querySelector("modal-dialog button.btn-secondary");e&&setTimeout(()=>e.focus(),50)})}handleConfirm(){this.confirmAction&&this.confirmAction(),this.showConfirmModal=!1,this.confirmAction=null}handleCancel(){this.showConfirmModal=!1,this.confirmAction=null}async startContainer(e,t){this.showConfirmDialog("Start Container",`Are you sure you want to start container "${t||e}"?`,async()=>{try{await mc.post(`/containers/${e}/start`),this.fetchContainers()}catch(t){console.error("Error starting container:",t)}})}async stopContainer(e,t){this.showConfirmDialog("Stop Container",`Are you sure you want to stop container "${t||e}"?`,async()=>{try{await mc.post(`/containers/${e}/stop`),this.fetchContainers()}catch(t){console.error("Error stopping container:",t)}})}async removeContainer(e,t){this.showConfirmDialog("Remove Container",`Are you sure you want to remove container "${t||e}"? This action cannot be undone.`,async()=>{try{await mc.delete(`/containers/${e}`),this.fetchContainers()}catch(t){console.error("Error removing container:",t)}})}async removeImage(e,t){this.showConfirmDialog("Remove Image",`Are you sure you want to remove image "${t||e}"? This action cannot be undone.`,async()=>{try{await mc.delete(`/containers/images/${e}`),this.fetchImages()}catch(t){console.error("Error removing image:",t)}})}async fetchContainerLogs(e,t){try{console.log("Fetching logs for container:",e,t),this.logsError=null,this.containerLogs="Loading logs...",this.logsSearchTerm="",this.showLogsDrawer=!0;const s=await mc.get(`/containers/${e}/logs`);console.log("Logs response:",s),this.containerLogs=s?.data?.logs?s.data.logs:s?.logs?s.logs:"No logs available"}catch(s){console.error("Error fetching container logs:",s),this.logsError=s instanceof uc?s.message:"Failed to fetch container logs",this.containerLogs=""}}openContainerTerminal(e){this.terminalContainerId=e.id,this.terminalContainerName=e.name||e.id,this.showTerminalModal=!0}openCreateContainerDrawer(){this.resetCreateForm(),this.isClosingCreateDrawer=!1,this.showCreateDrawer=!0,this.fetchImages()}closeCreateContainerDrawer(){this.isClosingCreateDrawer||(this.isClosingCreateDrawer=!0,window.setTimeout(()=>{this.showCreateDrawer=!1,this.isClosingCreateDrawer=!1,this.createError=null},300))}resetCreateForm(){this.createName="",this.createImage="",this.createEntrypoint="",this.createCmd="",this.createEnv="",this.createLabels="",this.createWorkingDir="",this.createCpuCores="",this.createMemoryMB="",this.createHostNetwork=!1,this.createPorts=[],this.createVolumes=[]}addPortMapping(){this.createPorts=[...this.createPorts,{containerPort:"",hostPort:"",protocol:"tcp"}]}removePortMapping(e){this.createPorts=this.createPorts.filter((t,s)=>s!==e)}addVolumeMapping(){this.createVolumes=[...this.createVolumes,{source:"",target:"",type:"bind",readOnly:!1,propagation:""}]}removeVolumeMapping(e){this.createVolumes=this.createVolumes.filter((t,s)=>s!==e)}parseCommandInput(e){const t=e.trim();if(!t)return[];if(t.startsWith("["))try{const e=JSON.parse(t);if(Array.isArray(e))return e.map(e=>String(e))}catch{}return t.split(/\s+/).filter(Boolean)}parseKeyValueLines(e){return e.split("\n").map(e=>e.trim()).filter(Boolean)}parseLabels(e){const t={};return this.parseKeyValueLines(e).forEach(e=>{const[s,...i]=e.split("=");s&&(t[s]=i.join("=")||"")}),t}getImageSuggestions(){const e=/* @__PURE__ */new Set;return this.images.forEach(t=>{(t.repo_tags||[]).forEach(t=>{t&&"<none>:<none>"!==t&&e.add(t)})}),Array.from(e)}async handleCreateContainer(){if(this.createName.trim()&&this.createImage.trim()){this.isCreating=!0,this.createError=null;try{const e=this.parseCommandInput(this.createCmd),t=this.parseCommandInput(this.createEntrypoint),s=this.parseKeyValueLines(this.createEnv),i=this.parseLabels(this.createLabels),o={},r={};this.createPorts.forEach(e=>{const t=e.containerPort.trim();if(!t)return;const s=`${t}/${e.protocol?.trim()||"tcp"}`;o[s]={},r[s]||(r[s]=[]),r[s].push({hostPort:e.hostPort.trim()})});const a=this.createVolumes.filter(e=>e.source.trim()&&e.target.trim()).map(e=>({source:e.source.trim(),target:e.target.trim(),type:e.type||"bind",readOnly:e.readOnly,bindOptions:e.propagation?{propagation:e.propagation}:void 0})),n=this.createCpuCores.trim(),l=this.createMemoryMB.trim(),c=n?Number.parseFloat(n):void 0,d=l?Number.parseInt(l,10):void 0,h=c&&!Number.isNaN(c)||d&&!Number.isNaN(d)?{cpuCores:Number.isNaN(c)?void 0:c,memoryMB:Number.isNaN(d)?void 0:d}:void 0,u={name:this.createName.trim(),image:this.createImage.trim(),cmd:e.length?e:void 0,entrypoint:t.length?t:void 0,env:s.length?s:void 0,labels:Object.keys(i).length?i:void 0,workingDir:this.createWorkingDir.trim()||void 0,resources:h,networkMode:this.createHostNetwork?"host":void 0,volumes:a.length?a:void 0,exposedPorts:Object.keys(o).length?o:void 0,portBindings:Object.keys(r).length?r:void 0};await mc.post("/containers",u),this.closeCreateContainerDrawer(),this.resetCreateForm(),this.fetchContainers()}catch(e){this.createError=e instanceof uc?e.message:"Failed to create container"}finally{this.isCreating=!1}}else this.createError="Name and image are required"}renderCreateContainerDrawer(){const e=this.getImageSuggestions();return J`
      <div class="create-drawer ${this.isClosingCreateDrawer?"closing":""}">
        <div class="create-drawer-header">
          <h2 class="create-drawer-title">Create Container</h2>
          <button class="create-close-btn" @click=${this.closeCreateContainerDrawer}>â</button>
        </div>

        <div class="create-drawer-content">
          ${this.createError?J`
            <div class="error-container">
              <div class="error-icon">â ï¸</div>
              <p class="error-message">${this.createError}</p>
            </div>
          `:""}
          <div class="form-section">
            <div class="form-field">
              <label class="form-label">Name *</label>
              <input
                class="form-input"
                type="text"
                placeholder="e.g., my-container"
                .value=${this.createName}
                @input=${e=>{this.createName=e.target.value}}
              />
            </div>
            <div class="form-field">
              <label class="form-label">Image *</label>
              <container-image-autocomplete
                .value=${this.createImage}
                .suggestions=${e}
                placeholder="e.g., nginx:latest"
                ?disabled=${this.isCreating}
                @image-change=${e=>{this.createImage=e.detail.value}}
              ></container-image-autocomplete>
              <div class="form-hint">Suggestions are based on existing images. You can enter any image.</div>
            </div>
            <div class="form-field">
              <label class="form-label">Entrypoint</label>
              <input
                class="form-input"
                type="text"
                placeholder="/bin/sh -c"
                .value=${this.createEntrypoint}
                @input=${e=>{this.createEntrypoint=e.target.value}}
              />
              <div class="form-hint">Space-separated or JSON array.</div>
            </div>
            <div class="form-field">
              <label class="form-label">Command</label>
              <input
                class="form-input"
                type="text"
                placeholder="echo hello"
                .value=${this.createCmd}
                @input=${e=>{this.createCmd=e.target.value}}
              />
              <div class="form-hint">Space-separated or JSON array.</div>
            </div>
            <div class="form-field">
              <label class="form-label">Working Directory</label>
              <input
                class="form-input"
                type="text"
                placeholder="/app"
                .value=${this.createWorkingDir}
                @input=${e=>{this.createWorkingDir=e.target.value}}
              />
            </div>
          </div>

          <div class="form-section">
            <h3>Environment</h3>
            <div class="form-field">
              <label class="form-label">Environment Variables</label>
              <textarea
                class="form-textarea"
                placeholder="KEY=value"
                .value=${this.createEnv}
                @input=${e=>{this.createEnv=e.target.value}}
              ></textarea>
            </div>
            <div class="form-field">
              <label class="form-label">Labels</label>
              <textarea
                class="form-textarea"
                placeholder="key=value"
                .value=${this.createLabels}
                @input=${e=>{this.createLabels=e.target.value}}
              ></textarea>
            </div>
          </div>

          <div class="form-section">
            <h3>Ports</h3>
            ${this.createPorts.map((e,t)=>J`
              <div class="list-item">
                <input
                  class="form-input"
                  type="number"
                  min="1"
                  placeholder="Container port"
                  .value=${e.containerPort}
                  @input=${e=>{const s=[...this.createPorts],i=s[t]??{containerPort:"",hostPort:"",protocol:"tcp"};s[t]={...i,containerPort:e.target.value},this.createPorts=s}}
                />
                <input
                  class="form-input"
                  type="number"
                  min="1"
                  placeholder="Host port"
                  .value=${e.hostPort}
                  @input=${e=>{const s=[...this.createPorts],i=s[t]??{containerPort:"",hostPort:"",protocol:"tcp"};s[t]={...i,hostPort:e.target.value},this.createPorts=s}}
                />
                <select
                  class="form-select"
                  .value=${e.protocol}
                  @change=${e=>{const s=[...this.createPorts],i=s[t]??{containerPort:"",hostPort:"",protocol:"tcp"};s[t]={...i,protocol:e.target.value},this.createPorts=s}}
                >
                  <option value="tcp">tcp</option>
                  <option value="udp">udp</option>
                  <option value="sctp">sctp</option>
                </select>
                <button class="btn btn-secondary btn-small" @click=${()=>this.removePortMapping(t)}>Remove</button>
              </div>
            `)}
            <button class="btn btn-secondary btn-small" @click=${this.addPortMapping}>+ Add Port</button>
          </div>

          <div class="form-section">
            <h3>Volumes</h3>
            ${this.createVolumes.map((e,t)=>J`
              <div class="list-item">
                <input
                  class="form-input"
                  type="text"
                  placeholder="/host/path"
                  .value=${e.source}
                  @input=${e=>{const s=[...this.createVolumes],i=s[t]??{source:"",target:"",type:"bind",readOnly:!1,propagation:""};s[t]={...i,source:e.target.value},this.createVolumes=s}}
                />
                <input
                  class="form-input"
                  type="text"
                  placeholder="/container/path"
                  .value=${e.target}
                  @input=${e=>{const s=[...this.createVolumes],i=s[t]??{source:"",target:"",type:"bind",readOnly:!1,propagation:""};s[t]={...i,target:e.target.value},this.createVolumes=s}}
                />
                <select
                  class="form-select"
                  .value=${e.type}
                  @change=${e=>{const s=[...this.createVolumes],i=s[t]??{source:"",target:"",type:"bind",readOnly:!1,propagation:""};s[t]={...i,type:e.target.value},this.createVolumes=s}}
                >
                  <option value="bind">bind</option>
                  <option value="volume">volume</option>
                  <option value="tmpfs">tmpfs</option>
                </select>
                <select
                  class="form-select"
                  .value=${e.propagation}
                  @change=${e=>{const s=[...this.createVolumes],i=s[t]??{source:"",target:"",type:"bind",readOnly:!1,propagation:""};s[t]={...i,propagation:e.target.value},this.createVolumes=s}}
                >
                  <option value="">propagation</option>
                  <option value="rprivate">rprivate</option>
                  <option value="rslave">rslave</option>
                  <option value="rshared">rshared</option>
                </select>
                <label style="display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-secondary);">
                  <input
                    type="checkbox"
                    .checked=${e.readOnly}
                    @change=${e=>{const s=[...this.createVolumes],i=s[t]??{source:"",target:"",type:"bind",readOnly:!1,propagation:""};s[t]={...i,readOnly:e.target.checked},this.createVolumes=s}}
                  />
                  Read-only
                </label>
                <button class="btn btn-secondary btn-small" @click=${()=>this.removeVolumeMapping(t)}>Remove</button>
              </div>
            `)}
            <button class="btn btn-secondary btn-small" @click=${this.addVolumeMapping}>+ Add Volume</button>
          </div>

          <div class="form-section">
            <h3>Resources</h3>
            <div class="form-row">
              <div class="form-field" style="flex: 1;">
                <label class="form-label">CPU Cores</label>
                <input
                  class="form-input"
                  type="number"
                  min="0"
                  step="0.1"
                  placeholder="e.g., 1.5"
                  .value=${this.createCpuCores}
                  @input=${e=>{this.createCpuCores=e.target.value}}
                />
              </div>
              <div class="form-field" style="flex: 1;">
                <label class="form-label">Memory (MB)</label>
                <input
                  class="form-input"
                  type="number"
                  min="0"
                  step="64"
                  placeholder="e.g., 512"
                  .value=${this.createMemoryMB}
                  @input=${e=>{this.createMemoryMB=e.target.value}}
                />
              </div>
            </div>
          </div>

          <div class="form-section">
            <h3>Advanced</h3>
            <div class="toggle-row">
              <label class="toggle">
                <input
                  type="checkbox"
                  .checked=${this.createHostNetwork}
                  @change=${e=>{this.createHostNetwork=e.target.checked}}
                />
                Host Network (CRI)
              </label>
            </div>
            <div class="form-hint">Uses the node network namespace and bypasses CNI. Ports are exposed directly on the host.</div>
          </div>
        </div>

        <div class="create-drawer-footer">
          <button class="btn btn-secondary" @click=${this.closeCreateContainerDrawer}>Cancel</button>
          <button class="btn btn-primary" ?disabled=${this.isCreating||!this.createName.trim()||!this.createImage.trim()} @click=${this.handleCreateContainer}>
            ${this.isCreating?"Creating...":"Create Container"}
          </button>
        </div>
      </div>
    `}renderContainersTable(){const e=this.containers.filter(e=>e.name?.toLowerCase().includes(this.searchTerm.toLowerCase()));return J`
    <div class="search-container">
      <div class="search-wrapper">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input 
          class="search-input"
          type="text" 
          placeholder="${n("containers.searchContainers")}"
          .value=${this.searchTerm}
          @input=${e=>this.searchTerm=e.target.value}
        />
      </div>
      <div class="action-menu">
        <button class="btn btn-primary" @click=${()=>this.openCreateContainerDrawer()}>+ Create Container</button>
      </div>
    </div>
      <table class="table">
        <thead>
          <tr>
            <th>${n("common.name")}</th>
            <th>${n("common.state")}</th>
            <th>ID</th>
            <th>${n("common.image")}</th>
            <th>${n("common.created")}</th>
            <th>${n("common.actions")}</th>
          </tr>
        </thead>
        <tbody>
          ${e.map((e,t)=>{const s=e.id?.substring(0,12)||"Unknown",i=e.created_at?new Date(e.created_at).toLocaleString():"Unknown",o=e.image||"Unknown",r=o.length>20?o.substring(0,20)+"...":o;return J`
              <tr>
<td>
<button class="link-button" @click=${()=>this.fetchContainerDetails(e.id)}>
    ${e.name||"Unnamed"}
  </button>
</td>
                <td>
                  <div class="status-indicator">
                    <span class="status-icon ${this.getStatusClass(e.state)}" data-tooltip="${this.getStatusTooltip(e.state)}"></span>
                  </div>
                </td>
                <td>${s}</td>
                <td>
                  <span class="truncate" title="${o}">${r}</span>
                </td>
                <td>${i}</td>
                <td>
                  <div class="action-menu">
                    <button class="action-dots" @click=${e=>this.toggleActionMenu(e,`container-${t}`)}>â®</button>
                    <div class="action-dropdown" id="container-${t}">
                      <button @click=${()=>{this.closeAllMenus(),this.fetchContainerLogs(e.id,e.name)}}>Logs</button>
                      <button @click=${()=>{this.closeAllMenus(),this.openContainerTerminal(e)}}>${n("terminal.title")}</button>
                      ${"CONTAINER_RUNNING"===e.state?J`<button @click=${()=>{this.closeAllMenus(),this.stopContainer(e.id,e.name)}}>${n("containers.stop")}</button>`:J`<button @click=${()=>{this.closeAllMenus(),this.startContainer(e.id,e.name)}}>${n("containers.start")}</button>`}
                      <button class="danger" @click=${()=>{this.closeAllMenus(),this.removeContainer(e.id,e.name)}}>${n("common.delete")}</button>
                    </div>
                  </div>
                </td>
              </tr>
            `})}
        </tbody>
      </table>
    `}renderImagesTable(){const e=this.images.filter(e=>e.repo_tags?.some(e=>e.toLowerCase().includes(this.searchTerm.toLowerCase())));return J`
    <div class="search-container">
      <div class="search-wrapper">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input 
          class="search-input"
          type="text" 
          placeholder="${n("containers.searchImages")}"
          .value=${this.searchTerm}
          @input=${e=>this.searchTerm=e.target.value}
        />
      </div>
      <div class="action-menu">
        <button class="btn btn-primary" @click=${e=>this.toggleImageActionsDropdown(e)}>+ Add Image</button>
        <div class="action-dropdown ${this.showImageActionsDropdown?"show":""}">
          <button @click=${()=>this.handleImageActionSelect("pull")}>Pull Image</button>
          <button @click=${()=>this.handleImageActionSelect("upload")}>Upload Image</button>
        </div>
      </div>
    </div>
      <table class="table">
        <thead>
          <tr>
            <th>${n("common.tags")}</th>
            <th>ID</th>
            <th>${n("common.size")}</th>
            <th>${n("common.runtime")}</th>
            <th>${n("common.created")}</th>
            <th>${n("common.actions")}</th>
          </tr>
        </thead>
        <tbody>
          ${e.map((e,t)=>{const s=e.id?.substring(0,12)||"Unknown",i=e.repo_tags&&e.repo_tags.length>0?e.repo_tags.join(", "):"No tags",o=e.created_at?new Date(e.created_at).toLocaleString():"Unknown";return J`
              <tr>
<td>
<button class="link-button" @click=${()=>this.fetchImageDetails(e.id)}>
    ${i}
  </button>
</td>
                <td>${s}</td>
                <td>${this.formatSize(e.size)}</td>
                <td>${e.runtime||"Unknown"}</td>
                <td>${o}</td>
                <td>
                  <div class="action-menu">
                    <button class="action-dots" @click=${e=>this.toggleActionMenu(e,`image-${t}`)}>â®</button>
                    <div class="action-dropdown" id="image-${t}">
                      <button class="danger" @click=${()=>{this.closeAllMenus(),this.removeImage(e.id,e.repo_tags?.join(", "))}}>${n("common.delete")}</button>
                    </div>
                  </div>
                </td>
              </tr>
            `})}
        </tbody>
      </table>
    `}formatSize(e){if(!e)return"Unknown";const t=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,t)).toFixed(2)} ${["B","KB","MB","GB"][t]}`}getStatusClass(e){switch(e){case"CONTAINER_RUNNING":return"running";case"CONTAINER_STOPPED":default:return"stopped";case"CONTAINER_PAUSED":return"paused";case"CONTAINER_EXITED":return"exited"}}getStatusTooltip(e){switch(e){case"CONTAINER_RUNNING":return"Running";case"CONTAINER_STOPPED":return"Stopped";case"CONTAINER_PAUSED":return"Paused";case"CONTAINER_EXITED":return"Exited";default:return e||"Unknown"}}toggleActionMenu(e,t){e.stopPropagation();const s=this.shadowRoot?.getElementById(t);if(s){const t=s.classList.contains("show");if(this.closeAllMenus(),!t){s.classList.add("show"),s.classList.remove("open-up");const t=e.currentTarget;requestAnimationFrame(()=>{if(t){const e=t.getBoundingClientRect(),i=s.getBoundingClientRect(),o=(window.innerHeight||document.documentElement.clientHeight)-e.bottom,r=e.top;o<i.height&&r>o&&s.classList.add("open-up")}const e=s.querySelector("button");e&&setTimeout(()=>e.focus(),10)})}}}closeAllMenus(){const e=this.shadowRoot?.querySelectorAll(".action-dropdown");e?.forEach(e=>e.classList.remove("show","open-up"))}renderTabs(){return J`
      <div class="tab-header">
        <a 
          href="/containers/cri"
          class="tab-button ${"containers"===this.activeTab?"active":""}" 
          @click="${e=>this.handleTabClick(e,"containers")}"
        >
          Containers
        </a>
        <a 
          href="/containers/cri/images"
          class="tab-button ${"images"===this.activeTab?"active":""}" 
          @click="${e=>this.handleTabClick(e,"images")}"
        >
          Images
        </a>
      </div>
    `}renderError(){return J`
      <div class="error-container">
        <div class="error-icon">â ï¸</div>
        <p class="error-message">${this.detailError}</p>
      </div>
    `}renderContainerDetails(){if(!this.selectedContainer)return;const e=this.selectedContainer;return J`
      <div class="drawer-content">
        <div class="detail-section">
          <h3>Container Details</h3>
          <div class="detail-item">
            <span class="detail-label">Name</span>
            <span class="detail-value">${e.name||"Unnamed"}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">ID</span>
            <span class="detail-value monospace">${e.id||"Unknown"}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Image</span>
            <span class="detail-value">${e.image||"Unknown"}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">State</span>
            <span class="detail-value">
              <span class="status-badge ${this.getStatusClass(e.state)}">${this.getStatusTooltip(e.state)}</span>
            </span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Status</span>
            <span class="detail-value">${e.status||"Unknown"}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Runtime</span>
            <span class="detail-value">${e.runtime||"Unknown"}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Created</span>
            <span class="detail-value">${e.created_at?new Date(e.created_at).toLocaleString():"Unknown"}</span>
          </div>
        </div>

        ${e.labels&&Object.keys(e.labels).length>0?J`
          <div class="detail-section">
            <h3>Labels</h3>
            <div class="tag-list">
              ${Object.entries(e.labels).map(([e,t])=>J`<div class="tag">${e}: ${t}</div>`)}
            </div>
          </div>
        `:""}
      </div>
    `}renderImageDetails(){if(!this.selectedImage)return;const e=this.selectedImage;return J`
      <div class="drawer-content">
        <div class="detail-section">
          <h3>Image Details</h3>
          <div class="detail-item">
            <span class="detail-label">ID</span>
            <span class="detail-value monospace">${e.id||"Unknown"}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Tags</span>
            ${e.repo_tags&&e.repo_tags.length>0?J`<div class="tag-list">${e.repo_tags.map(e=>J`<div class="tag">${e}</div>`)}</div>`:J`<span class="detail-value">No tags</span>`}
          </div>
          ${e.repo_digests&&e.repo_digests.length>0?J`
            <div class="detail-item">
              <span class="detail-label">Digests</span>
              <div class="detail-value">
                ${e.repo_digests.map(e=>J`<div class="monospace">${e}</div>`)}
              </div>
            </div>
          `:""}
          <div class="detail-item">
            <span class="detail-label">Size</span>
            <span class="detail-value">${this.formatSize(e.size)}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Runtime</span>
            <span class="detail-value">${e.runtime||"Unknown"}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Created</span>
            <span class="detail-value">${e.created_at?new Date(e.created_at).toLocaleString():"Unknown"}</span>
          </div>
        </div>
      </div>
    `}render(){return J`
      <div class="tab-container">
        <div class="title-row">
          <h1>
            ${n("containers.title")}
            ${this.runtime?J` <span style="font-size: 0.875rem; color: var(--text-secondary); font-weight: normal;">(${this.runtime})</span>`:""}
          </h1>
          <span class="live-indicator ${this.containerEventsLive?"on":"off"}" title="${this.containerEventsLive?"Live updates connected":"Live updates disconnected"}">
            <span class="dot"></span>
            Live
          </span>
        </div>
        ${this.renderTabs()}
        <div class="tab-content">
          ${this.error?J`
            <div class="error-state">
              <h3>${this.error.includes("No container runtime found")?"Container Runtime Not Available":"Error"}</h3>
              <p>${this.error.includes("No container runtime found")?"Container management features are not available. Please install Docker or a CRI-compatible container runtime (containerd, CRI-O) to use this feature.":this.error}</p>
            </div>
          `:""}


          ${"containers"!==this.activeTab||this.error?"":J`
            ${this.containers.length>0?this.renderContainersTable():J`
                <div class="empty-state">No containers found.</div>
              `}
          `}

          ${"images"!==this.activeTab||this.error?"":J`
            ${this.images.length>0?this.renderImagesTable():J`
                <div class="empty-state">No images found.</div>
              `}
          `}
        </div>
      </div>

      <notification-container></notification-container>

      <modal-dialog
        ?open=${this.showConfirmModal}
        .title=${this.confirmTitle}
        size="small"
        @modal-close=${this.handleCancel}
      >
        <p>${this.confirmMessage}</p>
        <div slot="footer" style="display: flex; gap: 8px; justify-content: flex-end;">
          <button class="btn btn-secondary" @click=${this.handleCancel}>
            ${n("common.cancel")}
          </button>
          <button class="btn btn-primary" @click=${this.handleConfirm}>
            ${n("common.confirm")}
          </button>
        </div>
      </modal-dialog>

      <container-terminal-modal
        .show=${this.showTerminalModal}
        .containerId=${this.terminalContainerId}
        .containerName=${this.terminalContainerName}
        .runtime=${"cri"}
        @close=${()=>{this.showTerminalModal=!1}}
      ></container-terminal-modal>

      ${this.showCreateDrawer?this.renderCreateContainerDrawer():""}

      <modal-dialog
        ?open=${this.showPullImageModal}
        .title="Pull Image"
        size="medium"
        @modal-close=${this.handleCancelPullImage}
      >
        <div style="margin-bottom: 1rem;">
          <label for="imageName" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--vscode-foreground);">Image Name:</label>
          <input 
            id="imageName"
            class="form-input"
            type="text" 
            placeholder="e.g., nginx:latest, ubuntu:20.04"
            .value=${this.imageName}
            @input=${e=>this.imageName=e.target.value}
            @keydown=${e=>{"Enter"===e.key&&this.handleConfirmPullImage()}}
          />
        </div>
        <div slot="footer" style="display: flex; gap: 8px; justify-content: flex-end;">
          <button class="btn btn-secondary" ?disabled=${this.isPullingImage} @click=${this.handleCancelPullImage}>
            Cancel
          </button>
          <button class="btn btn-primary" @click=${this.handleConfirmPullImage} ?disabled=${!this.imageName.trim()||this.isPullingImage}>
            ${this.isPullingImage?"Pulling...":"Pull Image"}
          </button>
        </div>
      </modal-dialog>

      ${this.showDrawer?J`
        <div class="drawer">
          <button class="close-btn" @click=${()=>{this.showDrawer=!1,this.detailError=null}}>â</button>
          
          ${this.detailError?this.renderError():this.selectedContainer?this.renderContainerDetails():this.selectedImage?this.renderImageDetails():""}
        </div>
      `:""}

      ${this.showLogsDrawer?J`
        <div class="drawer">
          <button class="close-btn" @click=${()=>{this.showLogsDrawer=!1,this.logsError=null,this.containerLogs="",this.logsSearchTerm=""}}>â</button>
          
          <div class="drawer-content">
            <div class="logs-header">
              <h2 class="logs-title">Container Logs</h2>
              <div class="search-wrapper">
                <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input
                  class="search-input"
                  type="text"
                  placeholder="${n("containers.searchLogs")}"
                  .value=${this.logsSearchTerm}
                  @input=${e=>this.logsSearchTerm=e.target.value}
                />
              </div>
            </div>
            
            ${this.logsError?J`
              <div class="error-container">
                <div class="error-icon">â ï¸</div>
                <p class="error-message">${this.logsError}</p>
              </div>
            `:J`
              <div class="logs-container">${Hd(this.highlightSearchTerm(this.containerLogs,this.logsSearchTerm))}</div>
            `}
          </div>
        </div>
      `:""}

      ${this.showUploadDrawer?J`
        <div class="drawer">
          <button class="close-btn" @click=${this.closeUploadDrawer}>â</button>
          ${this.renderUploadDrawer()}
        </div>
      `:""}
    `}highlightSearchTerm(e,t){if(!t||!e)return e;const s=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=new RegExp(`(${s})`,"gi");return e.replace(i,'<mark style="background-color: #ffeb3b; color: #000; padding: 0 2px;">$1</mark>')}handleOutsideClick(e){this.closeAllMenus(),this.showImageActionsDropdown=!1}handleKeyDown(e){"Escape"===e.key&&(this.closeAllMenus(),this.showImageActionsDropdown=!1,this.showDrawer&&(this.showDrawer=!1),this.showLogsDrawer&&(this.showLogsDrawer=!1),this.showPullImageModal&&this.handleCancelPullImage())}toggleImageActionsDropdown(e){e.stopPropagation(),this.showImageActionsDropdown=!this.showImageActionsDropdown}handleImageActionSelect(e){this.showImageActionsDropdown=!1,"pull"===e?(this.showPullImageModal=!0,this.imageName="",this.updateComplete.then(()=>{const e=this.shadowRoot?.querySelector(".modal-input");e&&setTimeout(()=>e.focus(),50)})):"upload"===e&&this.openUploadDrawer()}triggerFileUpload(){const e=document.createElement("input");e.type="file",e.accept=".tar,.tar.gz,.tgz",e.style.display="none",e.addEventListener("change",t=>{const s=t.target.files;s&&s.length>0&&s[0]&&(this.selectedFile=s[0],this.handleFileUpload()),document.body.removeChild(e)}),document.body.appendChild(e),e.click()}async handleFileUpload(){if(this.selectedFile)try{(new FormData).append("image",this.selectedFile),console.log("Uploading image file:",this.selectedFile.name),this.fetchImages(),this.selectedFile=null}catch(e){console.error("Error uploading image file:",e)}}async handleConfirmPullImage(){if(this.imageName.trim()&&!this.isPullingImage){this.isPullingImage=!0;try{await this.pullImage(this.imageName.trim()),this.showPullImageModal=!1,this.imageName=""}finally{this.isPullingImage=!1}}}handleCancelPullImage(){this.showPullImageModal=!1,this.imageName=""}async pullImage(e){try{await mc.post("/containers/images/pull",{image:e}),this.fetchImages()}catch(t){console.error("Error pulling image:",t)}}openUploadDrawer(){this.showUploadDrawer=!0,this.uploadQueue=[]}closeUploadDrawer(){this.currentUpload&&(this.currentUpload.abort(),this.currentUpload=null),this.showUploadDrawer=!1,this.uploadQueue=[],this.isUploading=!1}handleUploadZoneClick(){const e=this.shadowRoot?.querySelector("#uploadFileInput");e?.click()}handleFileInputChange(e){const t=e.target,s=t.files;s&&s.length>0&&this.addFilesToQueue(Array.from(s)),t.value=""}handleDragOver(e){e.preventDefault(),e.stopPropagation();e.currentTarget.classList.add("dragover")}handleDragLeave(e){e.preventDefault(),e.stopPropagation();e.currentTarget.classList.remove("dragover")}handleDrop(e){e.preventDefault(),e.stopPropagation();e.currentTarget.classList.remove("dragover");const t=Array.from(e.dataTransfer?.files||[]);t.length>0&&this.addFilesToQueue(t)}addFilesToQueue(e){const t=e.filter(e=>[".tar",".tar.gz",".tgz"].some(t=>e.name.toLowerCase().endsWith(t))).map(e=>({id:Bd(),file:e,progress:0,status:"pending"}));this.uploadQueue=[...this.uploadQueue,...t]}removeFromQueue(e){this.uploadQueue=this.uploadQueue.filter(t=>t.id!==e)}async startUploads(){if(this.isUploading)return;this.isUploading=!0;const e=this.uploadQueue.filter(e=>"pending"===e.status);for(const t of e)await this.uploadSingleFile(t);this.isUploading=!1,this.fetchImages()}async uploadSingleFile(t){return new Promise((s,i)=>{const o=this.uploadQueue.findIndex(e=>e.id===t.id);-1!==o&&(this.uploadQueue[o]={...t,status:"uploading",progress:0},this.requestUpdate());const r=e("/containers/images/upload");this.currentUpload=new Nu(t.file,{endpoint:r,chunkSize:4194304,retryDelays:[0,1e3,3e3,5e3],metadata:{filename:t.file.name,filetype:t.file.type||"application/octet-stream"},headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")||localStorage.getItem("auth_token")}`},onError:e=>{console.error("TUS upload error:",e);const s=this.uploadQueue.findIndex(e=>e.id===t.id);if(-1!==s&&this.uploadQueue[s]){const t=this.uploadQueue[s];this.uploadQueue[s]={...t,status:"error",error:e.message||"Upload failed"},this.requestUpdate()}this.currentUpload=null,i(e)},onProgress:(e,s)=>{const i=Math.round(e/s*100);this.updateUploadProgress(t.id,i)},onSuccess:async()=>{try{const e=this.currentUpload?.url;if(e){const t=e.split("/").pop();t&&await mc.post(`/containers/images/upload/${t}/complete`,{})}const i=this.uploadQueue.findIndex(e=>e.id===t.id);if(-1!==i&&this.uploadQueue[i]){const e=this.uploadQueue[i];this.uploadQueue[i]={...e,status:"completed",progress:100},this.requestUpdate()}this.currentUpload=null,s()}catch(e){console.error("Failed to complete upload:",e);const s=this.uploadQueue.findIndex(e=>e.id===t.id);if(-1!==s&&this.uploadQueue[s]){const e=this.uploadQueue[s];this.uploadQueue[s]={...e,status:"error",error:"Failed to complete upload"},this.requestUpdate()}this.currentUpload=null,i(e)}}}),this.currentUpload.start()})}updateUploadProgress(e,t){const s=this.uploadQueue.findIndex(t=>t.id===e);if(-1!==s&&this.uploadQueue[s]){const e=this.uploadQueue[s];this.uploadQueue[s]={...e,progress:t},this.requestUpdate()}}clearCompletedUploads(){this.uploadQueue=this.uploadQueue.filter(e=>"completed"!==e.status)}formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}renderUploadDrawer(){return J`
      <div class="drawer-content">
        <div class="upload-header">
          <h2 class="upload-title">Upload Images</h2>
        </div>
        
        <div class="upload-zone" 
             @click=${this.handleUploadZoneClick}
             @dragover=${this.handleDragOver}
             @dragleave=${this.handleDragLeave}
             @drop=${this.handleDrop}>
          <div class="upload-icon">ð¦</div>
          <div class="upload-text">Drop image files here or click to browse</div>
          <div class="upload-hint">Supported formats: .tar, .tar.gz, .tgz</div>
        </div>
        
        <input id="uploadFileInput" 
               class="hidden-file-input" 
               type="file" 
               accept=".tar,.tar.gz,.tgz" 
               multiple
               @change=${this.handleFileInputChange}>
        
        ${this.uploadQueue.length>0?J`
          <div class="upload-queue">
            <h3>Upload Queue (${this.uploadQueue.length} files)</h3>
            ${this.uploadQueue.map(e=>this.renderUploadItem(e))}
          </div>
          
          <div class="upload-actions">
            ${this.isUploading?J`
              <button class="btn btn-secondary" disabled>
                Uploading...
              </button>
            `:J`
              <button class="btn btn-primary" 
                      @click=${this.startUploads}
                      ?disabled=${0===this.uploadQueue.filter(e=>"pending"===e.status).length}>
                Start Upload${this.uploadQueue.filter(e=>"pending"===e.status).length>1?"s":""}
              </button>
            `}
            
            <button class="btn btn-secondary" @click=${this.clearCompletedUploads}>
              Clear Completed
            </button>
            
            <button class="btn btn-secondary" @click=${this.closeUploadDrawer}>
              Close
            </button>
          </div>
        `:""}
      </div>
    `}renderUploadItem(e){return J`
      <div class="upload-item">
        <div class="upload-item-header">
          <span class="upload-item-name" title="${e.file.name}">${e.file.name}</span>
          <span class="upload-item-size">${this.formatFileSize(e.file.size)}</span>
          <span class="upload-item-status ${e.status}">${e.status.toUpperCase()}</span>
          ${"pending"===e.status?J`
            <button class="btn btn-danger" @click=${()=>this.removeFromQueue(e.id)} style="padding: 2px 6px; font-size: 10px; margin-left: 8px;">â</button>
          `:""}
        </div>
        
        ${"uploading"===e.status||"completed"===e.status||"error"===e.status?J`
          <div class="progress-bar">
            <div class="progress-fill ${e.status}" style="width: ${e.progress}%"></div>
          </div>
          <div class="progress-text">
            <span>${e.progress}%</span>
            <span>${"completed"===e.status?"Complete":"error"===e.status?"Failed":"Uploading..."}</span>
          </div>
        `:""}
        
        ${e.error?J`
          <div class="upload-error">${e.error}</div>
        `:""}
      </div>
    `}}Yu([xe()],Xu.prototype,"activeTab"),Yu([xe()],Xu.prototype,"containers"),Yu([xe()],Xu.prototype,"images"),Yu([xe()],Xu.prototype,"searchTerm"),Yu([xe()],Xu.prototype,"error"),Yu([xe()],Xu.prototype,"runtime"),Yu([xe()],Xu.prototype,"containerEventsLive"),Yu([xe()],Xu.prototype,"showTerminalModal"),Yu([xe()],Xu.prototype,"terminalContainerId"),Yu([xe()],Xu.prototype,"terminalContainerName"),Yu([xe()],Xu.prototype,"showConfirmModal"),Yu([xe()],Xu.prototype,"confirmAction"),Yu([xe()],Xu.prototype,"selectedContainer"),Yu([xe()],Xu.prototype,"selectedImage"),Yu([xe()],Xu.prototype,"showDrawer"),Yu([xe()],Xu.prototype,"detailError"),Yu([xe()],Xu.prototype,"confirmTitle"),Yu([xe()],Xu.prototype,"confirmMessage"),Yu([xe()],Xu.prototype,"showLogsDrawer"),Yu([xe()],Xu.prototype,"containerLogs"),Yu([xe()],Xu.prototype,"logsError"),Yu([xe()],Xu.prototype,"logsSearchTerm"),Yu([xe()],Xu.prototype,"showImageActionsDropdown"),Yu([xe()],Xu.prototype,"showPullImageModal"),Yu([xe()],Xu.prototype,"imageName"),Yu([xe()],Xu.prototype,"isPullingImage"),Yu([xe()],Xu.prototype,"selectedFile"),Yu([xe()],Xu.prototype,"showUploadDrawer"),Yu([xe()],Xu.prototype,"uploadQueue"),Yu([xe()],Xu.prototype,"isUploading"),Yu([xe()],Xu.prototype,"showCreateDrawer"),Yu([xe()],Xu.prototype,"isClosingCreateDrawer"),Yu([xe()],Xu.prototype,"createError"),Yu([xe()],Xu.prototype,"isCreating"),Yu([xe()],Xu.prototype,"createName"),Yu([xe()],Xu.prototype,"createImage"),Yu([xe()],Xu.prototype,"createEntrypoint"),Yu([xe()],Xu.prototype,"createCmd"),Yu([xe()],Xu.prototype,"createEnv"),Yu([xe()],Xu.prototype,"createLabels"),Yu([xe()],Xu.prototype,"createWorkingDir"),Yu([xe()],Xu.prototype,"createCpuCores"),Yu([xe()],Xu.prototype,"createMemoryMB"),Yu([xe()],Xu.prototype,"createHostNetwork"),Yu([xe()],Xu.prototype,"createPorts"),Yu([xe()],Xu.prototype,"createVolumes"),customElements.define("containers-tab",Xu);var Zu=Object.defineProperty,ep=(e,t,s,i)=>{for(var o,r=void 0,a=e.length-1;a>=0;a--)(o=e[a])&&(r=o(t,s,r)||r);return r&&Zu(t,s,r),r};class tp extends dt{constructor(){super(...arguments),this.logs=[],this.serviceFilter="",this.priorityFilter="info",this.sinceFilter="",this.follow=!0,this.connected=!1,this.autoScroll=!0,this.unsubscribeLogs=null,this.logsContainer=null,this.maxLogs=1e3}buildFilters(){const e={follow:this.follow};if(this.serviceFilter){const t=this.serviceFilter.trim();t&&(e.unit=t)}return this.priorityFilter&&"all"!==this.priorityFilter&&(e.priority=this.priorityFilter),this.sinceFilter&&(e.since=this.sinceFilter),e}static{this.styles=g`
    :host {
      display: block;
      padding: 16px;
      height: 100%;
      display: flex;
      flex-direction: column;
      box-sizing: border-box;
    }

    h1 {
      margin: 0 0 24px 0;
      font-size: 24px;
      font-weight: 300;
      flex-shrink: 0;
    }

    .controls {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
      align-items: center;
      flex-wrap: wrap;
      flex-shrink: 0;
    }

    .filter-group {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .filter-input {
      padding: 8px;
      border: 1px solid var(--vscode-border);
      background: var(--vscode-bg);
      color: var(--vscode-text);
      border-radius: 4px;
      font-size: 13px;
      min-width: 200px;
    }

    .priority-select {
      padding: 8px;
      border: 1px solid var(--vscode-border);
      background: var(--vscode-bg);
      color: var(--vscode-text);
      border-radius: 4px;
      font-size: 13px;
    }

    .toggle-follow {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }

    .toggle-follow input[type="checkbox"] {
      cursor: pointer;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--vscode-text-dim);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--vscode-error);
    }

    .status-dot.connected {
      background: var(--vscode-success);
    }

    .logs-container {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      background: var(--vscode-bg);
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      padding: 8px;
      font-family: var(--vscode-font-family-mono);
      font-size: 12px;
      min-height: 0; /* Important for flexbox overflow */
      position: relative;
    }

    .log-entry {
      padding: 4px 8px;
      margin-bottom: 2px;
      border-radius: 2px;
      display: grid;
      grid-template-columns: 160px 80px 100px 1fr;
      gap: 16px;
      align-items: start;
    }

    .log-entry:hover {
      background: var(--vscode-bg-light);
    }

    .log-timestamp {
      color: var(--vscode-text-dim);
      white-space: nowrap;
    }

    .log-service {
      color: var(--vscode-accent);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .log-priority {
      font-weight: 500;
      white-space: nowrap;
    }

    .priority-emerg,
    .priority-emergency,
    .priority-0 {
      color: var(--vscode-error);
      background: rgba(255, 0, 0, 0.1);
    }

    .priority-alert,
    .priority-1 {
      color: var(--vscode-error);
    }

    .priority-crit,
    .priority-critical,
    .priority-2 {
      color: var(--vscode-error);
    }

    .priority-err,
    .priority-error,
    .priority-3 {
      color: var(--error);
    }

    .priority-warning,
    .priority-4 {
      color: var(--warning);
    }

    .priority-notice,
    .priority-5 {
      color: var(--vscode-text);
    }

    .priority-info,
    .priority-6 {
      color: var(--vscode-text);
    }

    .priority-debug,
    .priority-7 {
      color: var(--vscode-text-dim);
    }

    .log-message {
      white-space: pre-wrap;
      word-break: break-word;
    }

    .empty-state {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 200px;
      color: var(--vscode-text-dim);
    }

    button {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
      background: var(--vscode-accent);
      color: white;
    }

    button:hover {
      background: var(--vscode-accent-hover);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  `}connectedCallback(){super.connectedCallback(),this.initWebSocket()}disconnectedCallback(){super.disconnectedCallback(),this.cleanup()}firstUpdated(){this.logsContainer=this.shadowRoot?.querySelector(".logs-container")}async initWebSocket(){this.subscribeToLogs()}subscribeToLogs(){this.unsubscribeLogs&&(this.unsubscribeLogs(),this.unsubscribeLogs=null);const e=this.buildFilters();this.unsubscribeLogs=hc({channel:"log-events",routeId:"logs-tab",subscribePayload:{filters:e},onConnectionChange:e=>{this.connected=e},onEvent:e=>{const t=e?.kind,s=e?.entry??e;if(t&&"log"!==t)return;if(!s)return;const i=s.message??s.msg??"";if(!i)return;const o={type:"log",timestamp:s.timestamp||/* @__PURE__ */(new Date).toISOString(),service:s.unit||s.service||"system",priority:String(s.level||s.priority||"info").toLowerCase(),message:String(i),hostname:s.hostname,pid:s.pid};this.addLog(o)}})}addLog(e){const t=[...this.logs,e];this.logs=t.length>this.maxLogs?t.slice(-this.maxLogs):t,this.autoScroll&&this.logsContainer&&this.updateComplete.then(()=>{this.logsContainer&&(this.logsContainer.scrollTop=this.logsContainer.scrollHeight)})}handleServiceFilterChange(e){this.serviceFilter=e.target.value,this.logs=[],this.subscribeToLogs()}handlePriorityChange(e){this.priorityFilter=e.target.value,this.logs=[],this.subscribeToLogs()}handleSinceFilterChange(e){this.sinceFilter=e.target.value,this.logs=[],this.subscribeToLogs()}handleFollowChange(e){this.follow=e.target.checked,this.subscribeToLogs()}handleAutoScrollChange(e){this.autoScroll=e.target.checked,this.autoScroll&&this.logsContainer&&(this.logsContainer.scrollTop=this.logsContainer.scrollHeight)}clearLogs(){this.logs=[]}cleanup(){this.unsubscribeLogs&&(this.unsubscribeLogs(),this.unsubscribeLogs=null),this.connected=!1}formatTimestamp(e){return new Date(e).toLocaleString()}renderLog(e){return J`
      <div class="log-entry">
        <span class="log-timestamp">${this.formatTimestamp(e.timestamp)}</span>
        <span class="log-service" title="${e.service||"system"}">${e.service||"system"}</span>
        <span class="log-priority priority-${e.priority||"info"}">${(e.priority||"info").toUpperCase()}</span>
        <span class="log-message">${e.message}</span>
      </div>
    `}render(){return J`
      <h1>${n("logs.title")}</h1>
      
      <div class="controls">
        <div class="filter-group">
          <input 
            class="filter-input" 
            type="text" 
            placeholder="${n("logs.filterServices")} (e.g., 'systemd', 'nginx')" 
            .value="${this.serviceFilter}"
            @input="${this.handleServiceFilterChange}"
          />
        </div>
        
        <div class="filter-group">
          <label for="priority">${n("logs.priority")}:</label>
          <select 
            id="priority" 
            class="priority-select" 
            .value="${this.priorityFilter}"
            @change="${this.handlePriorityChange}"
          >
            <option value="all">All</option>
            <option value="debug">Debug (7)</option>
            <option value="info">Info (6) and above</option>
            <option value="notice">Notice (5) and above</option>
            <option value="warning">Warning (4) and above</option>
            <option value="err">Error (3) and above</option>
            <option value="crit">Critical (2) and above</option>
            <option value="alert">Alert (1) and above</option>
            <option value="emerg">Emergency (0) only</option>
          </select>
        </div>
        
        <div class="filter-group">
          <input 
            class="filter-input" 
            type="text" 
            placeholder="${n("logs.since")} (e.g., '10 minutes ago', '1 hour ago')" 
            .value="${this.sinceFilter}"
            @input="${this.handleSinceFilterChange}"
          />
        </div>
        
        <div class="toggle-follow">
          <input 
            type="checkbox" 
            id="follow" 
            .checked="${this.follow}"
            @change="${this.handleFollowChange}"
          />
          <label for="follow">${n("logs.follow")}</label>
        </div>
        
        <div class="toggle-follow">
          <input 
            type="checkbox" 
            id="autoscroll" 
            .checked="${this.autoScroll}"
            @change="${this.handleAutoScrollChange}"
          />
          <label for="autoscroll">Auto-scroll</label>
        </div>
        
        <button @click="${this.clearLogs}" ?disabled="${0===this.logs.length}">
          ${n("logs.clear")}
        </button>
        
        <div class="status-indicator">
          <div class="status-dot ${this.connected?"connected":""}"></div>
          <span>${this.connected?n("common.connected"):n("common.disconnected")}</span>
        </div>
      </div>
      
      <div class="logs-container">
        ${this.logs.length>0?this.logs.map(e=>this.renderLog(e)):J`<div class="empty-state">${n("logs.noLogs")}</div>`}
      </div>
    `}}ep([xe()],tp.prototype,"logs"),ep([xe()],tp.prototype,"serviceFilter"),ep([xe()],tp.prototype,"priorityFilter"),ep([xe()],tp.prototype,"sinceFilter"),ep([xe()],tp.prototype,"follow"),ep([xe()],tp.prototype,"connected"),ep([xe()],tp.prototype,"autoScroll"),customElements.define("logs-tab",tp);const{I:sp}=ue,ip=()=>document.createComment(""),op=(e,t,s)=>{const i=e._$AA.parentNode,o=void 0===t?e._$AB:t._$AA;if(void 0===s){const t=i.insertBefore(ip(),o),r=i.insertBefore(ip(),o);s=new sp(t,r,e,e.options)}else{const t=s._$AB.nextSibling,r=s._$AM,a=r!==e;if(a){let t;s._$AQ?.(e),s._$AM=e,void 0!==s._$AP&&(t=e._$AU)!==r._$AU&&s._$AP(t)}if(t!==o||a){let e=s._$AA;for(;e!==t;){const t=e.nextSibling;i.insertBefore(e,o),e=t}}}return s},rp=(e,t,s=e)=>(e._$AI(t,s),e),ap={},np=(e,t=ap)=>e._$AH=t,lp=e=>{e._$AR(),e._$AA.remove()},cp=(e,t,s)=>{const i=/* @__PURE__ */new Map;for(let o=t;o<=s;o++)i.set(e[o],o);return i},dp=Ud(class extends Vd{constructor(e){if(super(e),e.type!==zd)throw Error("repeat() can only be used in text expressions")}dt(e,t,s){let i;void 0===s?s=t:void 0!==t&&(i=t);const o=[],r=[];let a=0;for(const n of e)o[a]=i?i(n,a):a,r[a]=s(n,a),a++;return{values:r,keys:o}}render(e,t,s){return this.dt(e,t,s).values}update(e,[t,s,i]){const o=e._$AH,{values:r,keys:a}=this.dt(t,s,i);if(!Array.isArray(o))return this.ut=a,r;const n=this.ut??=[],l=[];let c,d,h=0,u=o.length-1,p=0,g=r.length-1;for(;h<=u&&p<=g;)if(null===o[h])h++;else if(null===o[u])u--;else if(n[h]===a[p])l[p]=rp(o[h],r[p]),h++,p++;else if(n[u]===a[g])l[g]=rp(o[u],r[g]),u--,g--;else if(n[h]===a[g])l[g]=rp(o[h],r[g]),op(e,l[g+1],o[h]),h++,g--;else if(n[u]===a[p])l[p]=rp(o[u],r[p]),op(e,o[h],o[u]),u--,p++;else if(void 0===c&&(c=cp(a,p,g),d=cp(n,h,u)),c.has(n[h]))if(c.has(n[u])){const t=d.get(a[p]),s=void 0!==t?o[t]:null;if(null===s){const t=op(e,o[h]);rp(t,r[p]),l[p]=t}else l[p]=rp(s,r[p]),op(e,o[h],s),o[t]=null;p++}else lp(o[u]),u--;else lp(o[h]),h++;for(;p<=g;){const t=op(e,l[g+1]);rp(t,r[p]),l[p++]=t}for(;h<=u;){const e=o[h++];null!==e&&lp(e)}return this.ut=a,np(e,l),Y}}),hp=Ud(class extends Vd{constructor(e){if(super(e),e.type!==Fd||"class"!==e.name||e.strings?.length>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(e){return" "+Object.keys(e).filter(t=>e[t]).join(" ")+" "}update(e,[t]){if(void 0===this.st){this.st=/* @__PURE__ */new Set,void 0!==e.strings&&(this.nt=new Set(e.strings.join(" ").split(/\s/).filter(e=>""!==e)));for(const e in t)t[e]&&!this.nt?.has(e)&&this.st.add(e);return this.render(t)}const s=e.element.classList;for(const i of this.st)i in t||(s.remove(i),this.st.delete(i));for(const i in t){const e=!!t[i];e===this.st.has(i)||this.nt?.has(i)||(e?(s.add(i),this.st.add(i)):(s.remove(i),this.st.delete(i)))}return Y}});var up,pp={exports:{}};var gp=(up||(up=1,function(e){!function(t,s){e.exports=s()}(self,()=>(()=>{var e={345:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.forwardEvent=t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=e=>(this._listeners.push(e),{dispose:()=>{if(!this._disposed)for(let t=0;t<this._listeners.length;t++)if(this._listeners[t]===e)return void this._listeners.splice(t,1)}})),this._event}fire(e,t){const s=[];for(let i=0;i<this._listeners.length;i++)s.push(this._listeners[i]);for(let i=0;i<s.length;i++)s[i].call(void 0,e,t)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},t.forwardEvent=function(e,t){return e(e=>t.fire(e))}},859:(e,t)=>{function s(e){for(const t of e)t.dispose();e.length=0}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisposeArrayDisposable=t.disposeArray=t.toDisposable=t.MutableDisposable=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const e of this._disposables)e.dispose();this._disposables.length=0}register(e){return this._disposables.push(e),e}unregister(e){const t=this._disposables.indexOf(e);-1!==t&&this._disposables.splice(t,1)}},t.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(e){var t;this._isDisposed||e===this._value||(null===(t=this._value)||void 0===t||t.dispose(),this._value=e)}clear(){this.value=void 0}dispose(){var e;this._isDisposed=!0,null===(e=this._value)||void 0===e||e.dispose(),this._value=void 0}},t.toDisposable=function(e){return{dispose:e}},t.disposeArray=s,t.getDisposeArrayDisposable=function(e){return{dispose:()=>s(e)}}}},t={};function s(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,s),r.exports}var i={};return(()=>{var e=i;Object.defineProperty(e,"__esModule",{value:!0}),e.SearchAddon=void 0;const t=s(345),o=s(859),r=" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?";class a extends o.Disposable{constructor(e){var s;super(),this._highlightedLines=/* @__PURE__ */new Set,this._highlightDecorations=[],this._selectedDecoration=this.register(new o.MutableDisposable),this._linesCacheTimeoutId=0,this._onDidChangeResults=this.register(new t.EventEmitter),this.onDidChangeResults=this._onDidChangeResults.event,this._highlightLimit=null!==(s=null==e?void 0:e.highlightLimit)&&void 0!==s?s:1e3}activate(e){this._terminal=e,this.register(this._terminal.onWriteParsed(()=>this._updateMatches())),this.register(this._terminal.onResize(()=>this._updateMatches())),this.register((0,o.toDisposable)(()=>this.clearDecorations()))}_updateMatches(){var e;this._highlightTimeout&&window.clearTimeout(this._highlightTimeout),this._cachedSearchTerm&&(null===(e=this._lastSearchOptions)||void 0===e?void 0:e.decorations)&&(this._highlightTimeout=setTimeout(()=>{const e=this._cachedSearchTerm;this._cachedSearchTerm=void 0,this.findPrevious(e,Object.assign(Object.assign({},this._lastSearchOptions),{incremental:!0,noScroll:!0}))},200))}clearDecorations(e){this._selectedDecoration.clear(),(0,o.disposeArray)(this._highlightDecorations),this._highlightDecorations=[],this._highlightedLines.clear(),e||(this._cachedSearchTerm=void 0)}findNext(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");this._lastSearchOptions=t,(null==t?void 0:t.decorations)&&(void 0!==this._cachedSearchTerm&&e===this._cachedSearchTerm||this._highlightAllMatches(e,t));const s=this._findNextAndSelect(e,t);return this._fireResults(t),this._cachedSearchTerm=e,s}_highlightAllMatches(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!e||0===e.length)return void this.clearDecorations();t=t||{},this.clearDecorations(!0);const s=[];let i,o=this._find(e,0,0,t);for(;o&&((null==i?void 0:i.row)!==o.row||(null==i?void 0:i.col)!==o.col)&&!(s.length>=this._highlightLimit);)i=o,s.push(i),o=this._find(e,i.col+i.term.length>=this._terminal.cols?i.row+1:i.row,i.col+i.term.length>=this._terminal.cols?0:i.col+1,t);for(const r of s){const e=this._createResultDecoration(r,t.decorations);e&&(this._highlightedLines.add(e.marker.line),this._highlightDecorations.push({decoration:e,match:r,dispose(){e.dispose()}}))}}_find(e,t,s,i){var o;if(!this._terminal||!e||0===e.length)return null===(o=this._terminal)||void 0===o||o.clearSelection(),void this.clearDecorations();if(s>this._terminal.cols)throw new Error(`Invalid col: ${s} to search in terminal of ${this._terminal.cols} cols`);let r;this._initLinesCache();const a={startRow:t,startCol:s};if(r=this._findInLine(e,a,i),!r)for(let n=t+1;n<this._terminal.buffer.active.baseY+this._terminal.rows&&(a.startRow=n,a.startCol=0,r=this._findInLine(e,a,i),!r);n++);return r}_findNextAndSelect(e,t){var s;if(!this._terminal||!e||0===e.length)return null===(s=this._terminal)||void 0===s||s.clearSelection(),this.clearDecorations(),!1;const i=this._terminal.getSelectionPosition();this._terminal.clearSelection();let o=0,r=0;i&&(this._cachedSearchTerm===e?(o=i.end.x,r=i.end.y):(o=i.start.x,r=i.start.y)),this._initLinesCache();const a={startRow:r,startCol:o};let n=this._findInLine(e,a,t);if(!n)for(let l=r+1;l<this._terminal.buffer.active.baseY+this._terminal.rows&&(a.startRow=l,a.startCol=0,n=this._findInLine(e,a,t),!n);l++);if(!n&&0!==r)for(let l=0;l<r&&(a.startRow=l,a.startCol=0,n=this._findInLine(e,a,t),!n);l++);return!n&&i&&(a.startRow=i.start.y,a.startCol=0,n=this._findInLine(e,a,t)),this._selectResult(n,null==t?void 0:t.decorations,null==t?void 0:t.noScroll)}findPrevious(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");this._lastSearchOptions=t,(null==t?void 0:t.decorations)&&(void 0!==this._cachedSearchTerm&&e===this._cachedSearchTerm||this._highlightAllMatches(e,t));const s=this._findPreviousAndSelect(e,t);return this._fireResults(t),this._cachedSearchTerm=e,s}_fireResults(e){if(null==e?void 0:e.decorations){let e=-1;if(this._selectedDecoration.value){const t=this._selectedDecoration.value.match;for(let s=0;s<this._highlightDecorations.length;s++){const i=this._highlightDecorations[s].match;if(i.row===t.row&&i.col===t.col&&i.size===t.size){e=s;break}}}this._onDidChangeResults.fire({resultIndex:e,resultCount:this._highlightDecorations.length})}}_findPreviousAndSelect(e,t){var s;if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!this._terminal||!e||0===e.length)return null===(s=this._terminal)||void 0===s||s.clearSelection(),this.clearDecorations(),!1;const i=this._terminal.getSelectionPosition();this._terminal.clearSelection();let o=this._terminal.buffer.active.baseY+this._terminal.rows-1,r=this._terminal.cols;const a=!0;this._initLinesCache();const n={startRow:o,startCol:r};let l;if(i&&(n.startRow=o=i.start.y,n.startCol=r=i.start.x,this._cachedSearchTerm!==e&&(l=this._findInLine(e,n,t,!1),l||(n.startRow=o=i.end.y,n.startCol=r=i.end.x))),l||(l=this._findInLine(e,n,t,a)),!l){n.startCol=Math.max(n.startCol,this._terminal.cols);for(let s=o-1;s>=0&&(n.startRow=s,l=this._findInLine(e,n,t,a),!l);s--);}if(!l&&o!==this._terminal.buffer.active.baseY+this._terminal.rows-1)for(let c=this._terminal.buffer.active.baseY+this._terminal.rows-1;c>=o&&(n.startRow=c,l=this._findInLine(e,n,t,a),!l);c--);return this._selectResult(l,null==t?void 0:t.decorations,null==t?void 0:t.noScroll)}_initLinesCache(){const e=this._terminal;this._linesCache||(this._linesCache=new Array(e.buffer.active.length),this._cursorMoveListener=e.onCursorMove(()=>this._destroyLinesCache()),this._resizeListener=e.onResize(()=>this._destroyLinesCache())),window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=window.setTimeout(()=>this._destroyLinesCache(),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._cursorMoveListener&&(this._cursorMoveListener.dispose(),this._cursorMoveListener=void 0),this._resizeListener&&(this._resizeListener.dispose(),this._resizeListener=void 0),this._linesCacheTimeoutId&&(window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=0)}_isWholeWord(e,t,s){return(0===e||r.includes(t[e-1]))&&(e+s.length===t.length||r.includes(t[e+s.length]))}_findInLine(e,t,s={},i=!1){var o;const r=this._terminal,a=t.startRow,n=t.startCol,l=r.buffer.active.getLine(a);if(null==l?void 0:l.isWrapped)return i?void(t.startCol+=r.cols):(t.startRow--,t.startCol+=r.cols,this._findInLine(e,t,s));let c=null===(o=this._linesCache)||void 0===o?void 0:o[a];c||(c=this._translateBufferLineToStringWithWrap(a,!0),this._linesCache&&(this._linesCache[a]=c));const[d,h]=c,u=this._bufferColsToStringOffset(a,n),p=s.caseSensitive?e:e.toLowerCase(),g=s.caseSensitive?d:d.toLowerCase();let m=-1;if(s.regex){const t=RegExp(p,"g");let s;if(i)for(;s=t.exec(g.slice(0,u));)m=t.lastIndex-s[0].length,e=s[0],t.lastIndex-=e.length-1;else s=t.exec(g.slice(u)),s&&s[0].length>0&&(m=u+(t.lastIndex-s[0].length),e=s[0])}else i?u-p.length>=0&&(m=g.lastIndexOf(p,u-p.length)):m=g.indexOf(p,u);if(m>=0){if(s.wholeWord&&!this._isWholeWord(m,g,e))return;let t=0;for(;t<h.length-1&&m>=h[t+1];)t++;let i=t;for(;i<h.length-1&&m+e.length>=h[i+1];)i++;const o=m-h[t],n=m+e.length-h[i],l=this._stringLengthToBufferSize(a+t,o);return{term:e,col:l,row:a+t,size:this._stringLengthToBufferSize(a+i,n)-l+r.cols*(i-t)}}}_stringLengthToBufferSize(e,t){const s=this._terminal.buffer.active.getLine(e);if(!s)return 0;for(let i=0;i<t;i++){const e=s.getCell(i);if(!e)break;const o=e.getChars();o.length>1&&(t-=o.length-1);const r=s.getCell(i+1);r&&0===r.getWidth()&&t++}return t}_bufferColsToStringOffset(e,t){const s=this._terminal;let i=e,o=0,r=s.buffer.active.getLine(i);for(;t>0&&r;){for(let e=0;e<t&&e<s.cols;e++){const t=r.getCell(e);if(!t)break;t.getWidth()&&(o+=0===t.getCode()?1:t.getChars().length)}if(i++,r=s.buffer.active.getLine(i),r&&!r.isWrapped)break;t-=s.cols}return o}_translateBufferLineToStringWithWrap(e,t){var s;const i=this._terminal,o=[],r=[0];let a=i.buffer.active.getLine(e);for(;a;){const n=i.buffer.active.getLine(e+1),l=!!n&&n.isWrapped;let c=a.translateToString(!l&&t);if(l&&n){const e=a.getCell(a.length-1);e&&0===e.getCode()&&1===e.getWidth()&&2===(null===(s=n.getCell(0))||void 0===s?void 0:s.getWidth())&&(c=c.slice(0,-1))}if(o.push(c),!l)break;r.push(r[r.length-1]+c.length),e++,a=n}return[o.join(""),r]}_selectResult(e,t,s){const i=this._terminal;if(this._selectedDecoration.clear(),!e)return i.clearSelection(),!1;if(i.select(e.col,e.row,e.size),t){const s=i.registerMarker(-i.buffer.active.baseY-i.buffer.active.cursorY+e.row);if(s){const r=i.registerDecoration({marker:s,x:e.col,width:e.size,backgroundColor:t.activeMatchBackground,layer:"top",overviewRulerOptions:{color:t.activeMatchColorOverviewRuler}});if(r){const i=[];i.push(s),i.push(r.onRender(e=>this._applyStyles(e,t.activeMatchBorder,!0))),i.push(r.onDispose(()=>(0,o.disposeArray)(i))),this._selectedDecoration.value={decoration:r,match:e,dispose(){r.dispose()}}}}}if(!s&&(e.row>=i.buffer.active.viewportY+i.rows||e.row<i.buffer.active.viewportY)){let t=e.row-i.buffer.active.viewportY;t-=Math.floor(i.rows/2),i.scrollLines(t)}return!0}_applyStyles(e,t,s){e.classList.contains("xterm-find-result-decoration")||(e.classList.add("xterm-find-result-decoration"),t&&(e.style.outline=`1px solid ${t}`)),s&&e.classList.add("xterm-find-active-result-decoration")}_createResultDecoration(e,t){const s=this._terminal,i=s.registerMarker(-s.buffer.active.baseY-s.buffer.active.cursorY+e.row);if(!i)return;const r=s.registerDecoration({marker:i,x:e.col,width:e.size,backgroundColor:t.matchBackground,overviewRulerOptions:this._highlightedLines.has(i.line)?void 0:{color:t.matchOverviewRuler,position:"center"}});if(r){const e=[];e.push(i),e.push(r.onRender(e=>this._applyStyles(e,t.matchBorder,!1))),e.push(r.onDispose(()=>(0,o.disposeArray)(e)))}return r}}e.SearchAddon=a})(),i})())}(pp)),pp.exports);const mp={cursorBlink:!0,fontSize:14,fontFamily:'Consolas, "Courier New", monospace',scrollback:1e4,convertEol:!0,screenReaderMode:!1,theme:{background:"#1e1e1e",foreground:"#cccccc",cursor:"#ffffff",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"}},fp=Be(/* @__PURE__ */new Map),vp=Be(null),bp=Be(0),yp=ze([fp,vp],(e,t)=>t&&e.get(t)||null),wp=ze(fp,e=>Array.from(e.values()).sort((e,t)=>e.createdAt-t.createdAt)),xp=ze(fp,e=>Array.from(e.values()).filter(e=>"connected"===e.connectionStatus).length);const _p=new class{constructor(){this.resizeObservers=/* @__PURE__ */new Map,this.scrollbackBufferLimit=1e3}async createSession(e){const t=bp.get()+1;bp.set(t);const s=`session-${t}`,i={id:s,name:e||`Terminal ${t}`,connectionStatus:"disconnected",scrollbackBuffer:[],createdAt:Date.now(),lastActiveAt:Date.now(),cols:80,rows:24},o=new Map(fp.get());return o.set(s,i),fp.set(o),vp.set(s),s}async initializeTerminal(e,t){const s=fp.get().get(e);if(!s)return;s.terminal&&s.element!==t&&this.disposeTerminalInstance(s),s.terminal||(s.terminal=new Ee.Terminal(mp),s.fitAddon=new Ie.FitAddon,s.searchAddon=new gp.SearchAddon,s.webLinksAddon=new Pe.WebLinksAddon,s.terminal.loadAddon(s.fitAddon),s.terminal.loadAddon(s.searchAddon),s.terminal.loadAddon(s.webLinksAddon),s.scrollbackBuffer&&s.scrollbackBuffer.length>0&&s.scrollbackBuffer.forEach(e=>{s.terminal.write(e)}),s.terminal.onData(e=>{if(s.wsManager&&"connected"===s.connectionStatus){const t={type:"input",data:e};s.wsManager.send(t)}}),s.terminal.onResize(e=>{if(s.cols=e.cols,s.rows=e.rows,s.wsManager&&"connected"===s.connectionStatus){const t={type:"resize",payload:{cols:e.cols,rows:e.rows}};s.wsManager.send(t)}})),s.terminal.open(t),s.element=t,this.setupResizeObserver(e,t),setTimeout(()=>{s.fitAddon&&s.fitAddon.fit()},100);const i=new Map(fp.get());i.set(e,s),fp.set(i),"disconnected"===s.connectionStatus&&await this.connectSession(e)}async connectSession(e){const t=fp.get(),s=t.get(e);if(!s)return;s.connectionStatus="connecting";const i=new Map(t);i.set(e,s),fp.set(i);try{s.wsManager=new gc("/ws/terminal"),s.wsManager.on("output",e=>{if(s.terminal&&e.payload?.data){const t=e.payload.data;s.terminal.write(t),s.scrollbackBuffer||(s.scrollbackBuffer=[]),s.scrollbackBuffer.push(t),s.scrollbackBuffer.length>this.scrollbackBufferLimit&&(s.scrollbackBuffer=s.scrollbackBuffer.slice(-this.scrollbackBufferLimit))}}),s.wsManager.on("error",t=>{console.error("Terminal error:",t.error),s.connectionStatus="disconnected";const i=new Map(fp.get());i.set(e,s),fp.set(i)}),await s.wsManager.connect();const t={type:"subscribe",payload:{cols:s.cols,rows:s.rows,shell:"/bin/bash"}};s.wsManager.send(t),s.connectionStatus="connected",s.lastActiveAt=Date.now();const i=new Map(fp.get());i.set(e,s),fp.set(i)}catch(o){console.error("Failed to connect terminal:",o),s.connectionStatus="disconnected";const t=new Map(fp.get());t.set(e,s),fp.set(t)}}disconnectSession(e){const t=fp.get(),s=t.get(e);if(!s)return;s.wsManager&&(s.wsManager.disconnect(),s.wsManager=void 0),s.connectionStatus="disconnected";const i=new Map(t);i.set(e,s),fp.set(i)}closeSession(e){const t=new Map(fp.get()),s=t.get(e);if(!s)return;this.disconnectSession(e),this.disposeTerminalInstance(s);const i=this.resizeObservers.get(e);if(i&&(i.disconnect(),this.resizeObservers.delete(e)),t.delete(e),fp.set(t),vp.get()===e){const e=Array.from(t.keys()),s=e.length>0?e[0]:null;void 0!==s&&vp.set(s)}}detachTerminal(e){const t=fp.get().get(e);if(!t)return;const s=this.resizeObservers.get(e);s&&t.element&&s.unobserve(t.element),t.element=void 0}clearTerminal(e){const t=fp.get(),s=t.get(e);if(s?.terminal){s.terminal.clear(),s.scrollbackBuffer=[];const i=new Map(t);i.set(e,s),fp.set(i)}}fitTerminal(e){const t=fp.get().get(e);t?.fitAddon&&t.fitAddon.fit()}focusTerminal(e){const t=fp.get(),s=t.get(e);if(s?.terminal){s.terminal.focus(),s.lastActiveAt=Date.now();const i=new Map(t);i.set(e,s),fp.set(i)}}sendInput(e,t){const s=fp.get().get(e);if(s?.wsManager&&"connected"===s.connectionStatus){const e={type:"input",data:t};s.wsManager.send(e)}}getSelection(e){const t=fp.get().get(e);return t?.terminal&&t.terminal.hasSelection()?t.terminal.getSelection():null}scrollToTop(e){const t=fp.get().get(e);t?.terminal&&t.terminal.scrollToTop()}scrollToBottom(e){const t=fp.get().get(e);t?.terminal&&t.terminal.scrollToBottom()}renameSession(e,t){const s=new Map(fp.get()),i=s.get(e);i&&(i.name=t,s.set(e,i),fp.set(s))}setupResizeObserver(e,t){const s=this.resizeObservers.get(e);s&&s.disconnect();const i=new ResizeObserver(()=>{requestAnimationFrame(()=>{this.fitTerminal(e)})});i.observe(t),this.resizeObservers.set(e,i)}disposeTerminalInstance(e){e.terminal&&(e.terminal.dispose(),e.terminal=void 0),e.fitAddon=void 0,e.searchAddon=void 0,e.webLinksAddon=void 0,e.element=void 0}dispose(){fp.get().forEach((e,t)=>{this.closeSession(t)}),fp.set(/* @__PURE__ */new Map),vp.set(null),bp.set(0)}};var kp=Object.defineProperty,Sp=Object.getOwnPropertyDescriptor,Cp=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Sp(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&kp(t,s,r),r};let $p=class extends me{constructor(){super(...arguments),this.activeSessionController=new Zl.StoreController(this,vp),this.sessionListController=new Zl.StoreController(this,wp),this.activeSessionStateController=new Zl.StoreController(this,yp),this.connectedCountController=new Zl.StoreController(this,xp),this.isFullscreen=!1,this.localSessions=[],this.localActiveSessionId=null,this.localActiveSession=null,this.handleWindowResize=()=>{this.localActiveSessionId&&_p.fitTerminal(this.localActiveSessionId)},this.handleFullscreenChange=()=>{const e=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);this.isFullscreen=e,e?this.classList.add("fullscreen"):this.classList.remove("fullscreen"),setTimeout(()=>{this.localActiveSessionId&&(_p.fitTerminal(this.localActiveSessionId),_p.focusTerminal(this.localActiveSessionId))},300)}}connectedCallback(){super.connectedCallback(),this.updateLocalState(),this.initializeTerminals(),window.addEventListener("resize",this.handleWindowResize),document.addEventListener("fullscreenchange",this.handleFullscreenChange),document.addEventListener("webkitfullscreenchange",this.handleFullscreenChange)}disconnectedCallback(){super.disconnectedCallback(),this.localSessions.forEach(e=>{_p.detachTerminal(e.id)}),window.removeEventListener("resize",this.handleWindowResize),document.removeEventListener("fullscreenchange",this.handleFullscreenChange),document.removeEventListener("webkitfullscreenchange",this.handleFullscreenChange)}firstUpdated(){this.setupTerminals()}updated(e){super.updated(e),this.updateLocalState(),(e.has("localSessions")||e.has("localActiveSessionId"))&&this.setupTerminals()}updateLocalState(){this.localSessions=this.sessionListController.value||[],this.localActiveSessionId=this.activeSessionController.value,this.localActiveSession=this.activeSessionStateController.value}async initializeTerminals(){0===this.localSessions.length&&await _p.createSession()}async setupTerminals(){await this.updateComplete;for(const e of this.localSessions){const t=this.shadowRoot?.querySelector(`#${e.id} .terminal-wrapper`);!t||e.element&&e.element===t||(await _p.initializeTerminal(e.id,t),e.id===this.localActiveSessionId&&setTimeout(()=>{_p.focusTerminal(e.id),_p.fitTerminal(e.id)},100))}}async createNewSession(){const e=await _p.createSession();await this.updateComplete;const t=this.shadowRoot?.querySelector(`#${e} .terminal-wrapper`);t&&(await _p.initializeTerminal(e,t),_p.focusTerminal(e))}closeSession(e,t){t.stopPropagation(),this.localSessions.length<=1||_p.closeSession(e)}switchToSession(e){vp.set(e),setTimeout(()=>{_p.focusTerminal(e),_p.fitTerminal(e)},50)}async reconnectSession(e){await _p.connectSession(e)}clearTerminal(){this.localActiveSessionId&&_p.clearTerminal(this.localActiveSessionId)}async copySelection(){if(!this.localActiveSessionId)return;const e=_p.getSelection(this.localActiveSessionId);if(e)try{await navigator.clipboard.writeText(e)}catch(t){console.error("Failed to copy to clipboard:",t)}}async pasteFromClipboard(){if(this.localActiveSessionId)try{const e=await navigator.clipboard.readText();e&&_p.sendInput(this.localActiveSessionId,e)}catch(e){console.error("Failed to paste from clipboard:",e)}}scrollToTop(){this.localActiveSessionId&&_p.scrollToTop(this.localActiveSessionId)}scrollToBottom(){this.localActiveSessionId&&_p.scrollToBottom(this.localActiveSessionId)}toggleFullscreen(){if(document.fullscreenElement)document.exitFullscreen().then(()=>{this.isFullscreen=!1,this.classList.remove("fullscreen"),setTimeout(()=>{this.localActiveSessionId&&(_p.fitTerminal(this.localActiveSessionId),_p.focusTerminal(this.localActiveSessionId))},300)}).catch(e=>{console.error("Failed to exit fullscreen:",e)});else{const e=this,t=e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen;t&&t.call(e).then(()=>{this.isFullscreen=!0,this.classList.add("fullscreen"),setTimeout(()=>{this.localActiveSessionId&&(_p.fitTerminal(this.localActiveSessionId),_p.focusTerminal(this.localActiveSessionId))},300)}).catch(e=>{console.error("Failed to enter fullscreen:",e)})}}render(){const e=this.connectedCountController.value||0,t=this.localSessions.length>0,s="connected"===this.localActiveSession?.connectionStatus;return J`
      <div class="terminal-header">
        <div class="terminal-tabs">
          ${dp(this.localSessions,e=>e.id,e=>J`
              <button 
                class=${hp({"terminal-tab":!0,active:e.id===this.localActiveSessionId})}
                @click=${()=>this.switchToSession(e.id)}
              >
                <span class=${hp({"terminal-tab-status":!0,connected:"connected"===e.connectionStatus,connecting:"connecting"===e.connectionStatus,disconnected:"disconnected"===e.connectionStatus})}></span>
                <span class="terminal-tab-name">${e.name}</span>
                ${this.localSessions.length>1?J`
                  <button 
                    class="terminal-tab-close" 
                    @click=${t=>this.closeSession(e.id,t)}
                    title="${n("terminal.closeTab")}"
                  >
                    Ã
                  </button>
                `:""}
              </button>
            `)}
          <button 
            class="add-terminal-btn" 
            @click=${()=>this.createNewSession()}
            title="${n("terminal.newTab")}"
          >
            +
          </button>
        </div>
        <div class="terminal-controls">
          <div class="terminal-info">
            <h3>${n("terminal.title")}</h3>
            <span class="terminal-stats">
              ${this.localSessions.length} ${n("terminal.sessions")} Â· 
              ${e} ${n("terminal.active")}
            </span>
          </div>
          <div class="terminal-actions">
            <button 
              class="terminal-action" 
              @click=${this.clearTerminal}
              ?disabled=${!t}
              title="${n("terminal.clear")}"
            >
              ${n("terminal.clear")}
            </button>
            <button 
              class="terminal-action" 
              @click=${this.copySelection}
              ?disabled=${!t}
              title="${n("terminal.copy")}"
            >
              ${n("terminal.copy")}
            </button>
            <button 
              class="terminal-action" 
              @click=${this.pasteFromClipboard}
              ?disabled=${!s}
              title="${n("terminal.paste")}"
            >
              ${n("terminal.paste")}
            </button>
            <button 
              class="terminal-action" 
              @click=${this.toggleFullscreen}
              title="${n("terminal.fullscreen")}"
            >
              ${this.isFullscreen?n("terminal.exitFullscreen"):n("terminal.fullscreen")}
            </button>
            <button 
              class="terminal-action" 
              @click=${this.scrollToTop}
              ?disabled=${!t}
              title="Scroll to Top"
            >
              â Top
            </button>
            <button 
              class="terminal-action" 
              @click=${this.scrollToBottom}
              ?disabled=${!t}
              title="Scroll to Bottom"
            >
              â Bottom
            </button>
          </div>
        </div>
      </div>
      <div class="terminal-container">
        ${0===this.localSessions.length?J`
          <div class="terminal-message">
            <h4>${n("terminal.noSessions")}</h4>
            <p>${n("terminal.createFirst")}</p>
            <button @click=${()=>this.createNewSession()}>
              ${n("terminal.createNew")}
            </button>
          </div>
        `:dp(this.localSessions,e=>e.id,e=>J`
            <div 
              id="${e.id}" 
              class=${hp({"terminal-session":!0,active:e.id===this.localActiveSessionId})}
            >
              ${"disconnected"===e.connectionStatus?J`
                <div class="terminal-message">
                  <h4>${n("terminal.disconnected")}</h4>
                  <p>${n("terminal.sessionDisconnected")}</p>
                  <button @click=${()=>this.reconnectSession(e.id)}>
                    ${n("terminal.reconnect")}
                  </button>
                </div>
              `:J`
                <div class="terminal-wrapper"></div>
              `}
            </div>
          `)}
      </div>
      <div class="status-bar">
        <div class="status-left">
          ${this.localActiveSession?J`
            <div class="status-indicator">
              <span class=${hp({"status-dot":!0,connected:"connected"===this.localActiveSession.connectionStatus,connecting:"connecting"===this.localActiveSession.connectionStatus,disconnected:"disconnected"===this.localActiveSession.connectionStatus})}></span>
              <span>
                ${"connected"===this.localActiveSession.connectionStatus?n("terminal.connected"):"connecting"===this.localActiveSession.connectionStatus?n("terminal.connecting"):n("terminal.disconnected")}
              </span>
            </div>
            <span>${this.localActiveSession.name}</span>
          `:J`
            <span>${n("terminal.noActiveSession")}</span>
          `}
        </div>
        <div class="status-right">
          ${this.localActiveSession?J`
            <span>${this.localActiveSession.cols}Ã${this.localActiveSession.rows}</span>
          `:""}
        </div>
      </div>
    `}};$p.styles=[p(Le),g`
    :host {
      display: flex;
      flex-direction: column;
      height: 100%;
      background-color: var(--vscode-bg);
      border: 1px solid var(--vscode-border);
      box-sizing: border-box;
    }

    .terminal-header {
      display: flex;
      flex-direction: column;
      background-color: var(--vscode-bg-lighter);
      border-bottom: 1px solid var(--vscode-border);
    }

    .terminal-tabs {
      display: flex;
      align-items: center;
      background-color: var(--vscode-bg);
      border-bottom: 1px solid var(--vscode-border);
      min-height: 35px;
      overflow-x: auto;
      overflow-y: hidden;
    }

    .terminal-tab {
      display: flex;
      align-items: center;
      padding: 6px 12px;
      background-color: transparent;
      border: none;
      border-right: 1px solid var(--vscode-border);
      color: var(--vscode-text-dim);
      cursor: pointer;
      font-size: 13px;
      min-width: 100px;
      max-width: 200px;
      transition: all 0.2s;
      position: relative;
    }

    .terminal-tab:hover {
      background-color: var(--vscode-bg-light);
    }

    .terminal-tab.active {
      background-color: var(--vscode-bg-lighter);
      color: var(--vscode-text);
      border-bottom: 2px solid var(--vscode-primary);
    }

    .terminal-tab-name {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      margin-right: 8px;
    }

    .terminal-tab-status {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 6px;
      flex-shrink: 0;
    }

    .terminal-tab-status.connected {
      background-color: var(--vscode-success);
    }

    .terminal-tab-status.connecting {
      background-color: var(--vscode-warning);
      animation: pulse 1.5s infinite;
    }

    .terminal-tab-status.disconnected {
      background-color: var(--vscode-error);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .terminal-tab-close {
      display: none;
      width: 16px;
      height: 16px;
      border: none;
      background: transparent;
      color: var(--vscode-text-dim);
      cursor: pointer;
      padding: 0;
      margin: 0;
      line-height: 1;
      font-size: 16px;
      border-radius: 3px;
    }

    .terminal-tab:hover .terminal-tab-close {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .terminal-tab-close:hover {
      background-color: var(--vscode-bg-light);
      color: var(--vscode-text);
    }

    .add-terminal-btn {
      padding: 6px 12px;
      background: transparent;
      border: none;
      color: var(--vscode-text-dim);
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 35px;
      transition: all 0.2s;
    }

    .add-terminal-btn:hover {
      background-color: var(--vscode-bg-light);
      color: var(--vscode-text);
    }

    .terminal-controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 16px;
    }

    .terminal-info {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .terminal-controls h3 {
      margin: 0;
      font-size: 14px;
      font-weight: normal;
      color: var(--vscode-text);
    }

    .terminal-stats {
      font-size: 12px;
      color: var(--vscode-text-dim);
    }

    .terminal-actions {
      display: flex;
      gap: 8px;
    }

    .terminal-action {
      padding: 4px 8px;
      border: none;
      background-color: transparent;
      color: var(--vscode-text-dim);
      cursor: pointer;
      font-size: 12px;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .terminal-action:hover {
      background-color: var(--vscode-bg-light);
      color: var(--vscode-text);
    }

    .terminal-action:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .terminal-container {
      flex: 1;
      overflow: hidden;
      position: relative;
    }

    .terminal-session {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: none;
      padding: 8px;
    }

    .terminal-session.active {
      display: flex;
      flex-direction: column;
    }

    .terminal-wrapper {
      flex: 1;
      position: relative;
      overflow: hidden;
      background-color: #1e1e1e;
    }

    /* Message overlays */
    .terminal-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: var(--vscode-text-dim);
      font-size: 14px;
    }

    .terminal-message h4 {
      margin: 0 0 8px 0;
      font-size: 16px;
      color: var(--vscode-text);
    }

    .terminal-message button {
      margin-top: 12px;
      padding: 6px 12px;
      background-color: var(--vscode-primary);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
    }

    .terminal-message button:hover {
      background-color: var(--vscode-primary-hover);
    }

    .status-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 4px 16px;
      background-color: var(--vscode-bg-lighter);
      border-top: 1px solid var(--vscode-border);
      font-size: 12px;
    }

    .status-left {
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--vscode-text);
    }

    .status-right {
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--vscode-text-dim);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .status-dot.connected {
      background-color: var(--vscode-success);
    }

    .status-dot.connecting {
      background-color: var(--vscode-warning);
      animation: pulse 1.5s infinite;
    }

    .status-dot.disconnected {
      background-color: var(--vscode-error);
    }

    /* Ensure xterm terminal fills the container */
    .xterm {
      height: 100%;
      width: 100%;
    }

    /* Fullscreen styles */
    :host(.fullscreen) {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 9999 !important;
      margin: 0 !important;
      padding: 0 !important;
      border: none !important;
    }

    :host(.fullscreen) .terminal-header {
      background-color: rgba(37, 37, 38, 0.95);
    }

    :host(.fullscreen) .terminal-container {
      background-color: #1e1e1e;
    }

    /* Hide xterm helper elements */
    .xterm-char-measure-element {
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      visibility: hidden !important;
    }
    
    .xterm-helper-textarea {
      position: absolute !important;
      left: -9999px !important;
      top: 0 !important;
      width: 0 !important;
      height: 0 !important;
      z-index: -10 !important;
      opacity: 0 !important;
    }
  `],Cp([xe()],$p.prototype,"isFullscreen",2),Cp([xe()],$p.prototype,"localSessions",2),Cp([xe()],$p.prototype,"localActiveSessionId",2),Cp([xe()],$p.prototype,"localActiveSession",2),$p=Cp([ve("terminal-tab-v2")],$p);var Dp=Object.defineProperty,Ep=(e,t,s,i)=>{for(var o,r=void 0,a=e.length-1;a>=0;a--)(o=e[a])&&(r=o(t,s,r)||r);return r&&Dp(t,s,r),r};class Mp extends me{constructor(){super(...arguments),this.users=[],this.showCreateForm=!1,this.showEditForm=!1,this.showResetPasswordForm=!1,this.newUser={username:"",password:"",groups:"",shell:""},this.editingUser=null,this.userToDelete=null,this.resetPasswordUsername=null,this.newPassword="",this.confirmPassword="",this.searchQuery="",this.handleDocumentClick=e=>{this.shadowRoot?.contains(e.target)||this.closeAllMenus()},this.handleKeyDown=e=>{"Escape"===e.key&&(this.closeAllMenus(),this.showCreateForm&&this.closeCreateDrawer(),this.showEditForm&&this.closeEditDrawer(),this.showResetPasswordForm&&this.closeResetPasswordDrawer())}}static{this.styles=g`
    :host {
      display: block;
      padding: 16px;
    }

    .header {
      margin-bottom: 20px;
    }

    .actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .search-box {
      position: relative;
      flex: 1;
      max-width: 250px;
    }

    .search-box input {
      width: 100%;
      padding: 8px 36px 8px 36px;
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      background: var(--vscode-bg-light);
      color: var(--vscode-text);
      font-size: 14px;
      transition: border-color 0.2s;
    }

    .search-box input:focus {
      outline: none;
      border-color: var(--vscode-accent);
    }

    .search-box input::placeholder {
      color: var(--vscode-text-dim);
    }

    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--vscode-text-dim);
      pointer-events: none;
      width: 16px;
      height: 16px;
    }

    .clear-search {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--vscode-text-dim);
      cursor: pointer;
      padding: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 3px;
      transition: background-color 0.2s;
    }

    .clear-search:hover {
      background-color: var(--vscode-toolbar-hoverBackground, rgba(90, 93, 94, 0.1));
    }

    h1 {
      margin: 0 0 24px 0;
      font-size: 24px;
      font-weight: 300;
    }

    .users-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--vscode-bg-light);
      border-radius: 1px;
      border: 1px solid var(--vscode-border);
    }

    .users-table thead {
      background: var(--vscode-bg-lighter);
    }

    .users-table th {
      padding: 12px;
      text-align: left;
      font-weight: 500;
      font-size: 13px;
      border-bottom: 1px solid var(--vscode-border);
    }

    .users-table td {
      padding: 12px;
      font-size: 14px;
      border-bottom: 1px solid var(--vscode-border);
    }

    .users-table tbody tr:last-child td {
      border-bottom: none;
    }

    .users-table tbody tr:hover {
      background: var(--vscode-bg-lighter);
    }

    .users-table td:last-child {
      text-align: right;
    }

    .action-menu {
      position: relative;
      display: inline-block;
    }

    .action-dots {
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 8px;
      color: var(--vscode-text-dim);
      font-size: 18px;
      line-height: 1;
      transition: background-color 0.2s;
      border-radius: 4px;
    }

    .action-dots:hover {
      background-color: var(--vscode-toolbar-hoverBackground, rgba(90, 93, 94, 0.1));
    }

    .action-dropdown {
      position: absolute;
      right: 0;
      top: 100%;
      margin-top: 4px;
      background: var(--vscode-dropdown-background, var(--vscode-bg-light));
      border: 1px solid var(--vscode-dropdown-border, var(--vscode-border));
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      min-width: 160px;
      z-index: 1000;
      display: none;
    }

    .action-dropdown.show {
      display: block;
    }

    .action-dropdown button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 8px 16px;
      border: none;
      background: none;
      color: var(--vscode-text);
      cursor: pointer;
      font-size: 13px;
      transition: background-color 0.2s;
    }

    .action-dropdown button:hover {
      background-color: var(--vscode-list-hoverBackground, rgba(255, 255, 255, 0.08));
    }

    .action-dropdown button.danger {
      color: var(--vscode-error);
    }

    .action-dropdown button.danger:hover {
      background-color: rgba(244, 67, 54, 0.1);
    }

    button {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--vscode-accent);
      color: white;
    }

    .btn-primary:hover {
      background: var(--vscode-accent-hover);
    }

    .btn-danger {
      background: var(--vscode-error);
      color: white;
    }

    .btn-danger:hover {
      opacity: 0.9;
    }

    .btn-secondary {
      background: var(--vscode-bg-lighter);
      color: var(--vscode-text);
      border: 1px solid var(--vscode-border);
    }

    .btn-secondary:hover {
      background: var(--vscode-border);
    }

    .create-form {
      background: var(--vscode-bg-light);
      padding: 20px;
      border-radius: 6px;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    label {
      display: block;
      margin-bottom: 4px;
      font-weight: 500;
      font-size: 13px;
    }

    input {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--vscode-border);
      background: var(--vscode-bg);
      color: var(--vscode-text);
      border-radius: 4px;
      font-size: 14px;
    }

    input:focus {
      outline: none;
      border-color: var(--vscode-accent);
    }

    .form-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      margin-top: 20px;
    }

    .icon {
      width: 16px;
      height: 16px;
      display: inline-block;
      margin-right: 4px;
    }

    .drawer {
      position: fixed;
      top: 0;
      right: 0;
      width: 400px;
      height: 100%;
      background: var(--vscode-bg-light);
      border-left: 1px solid var(--vscode-border);
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      z-index: 1001;
      overflow-y: auto;
      padding: 24px;
      animation: slideIn 0.3s ease-out;
    }

    @media (max-width: 768px) {
      .drawer {
        width: 100%;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
      }
      to {
        transform: translateX(0);
      }
    }

    .drawer h2 {
      margin-top: 0;
      margin-bottom: 24px;
      font-size: 20px;
      font-weight: 500;
    }

    .drawer .close-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      padding: 8px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 20px;
      color: var(--vscode-text-dim);
      transition: color 0.2s;
    }

    .drawer .close-btn:hover {
      color: var(--vscode-text);
    }

    .drawer-form {
      margin-top: 40px;
    }
  `}connectedCallback(){super.connectedCallback(),this.fetchUsers(),this.addEventListener("click",e=>{e.target.closest(".action-menu")||this.closeAllMenus()}),document.addEventListener("click",this.handleDocumentClick),document.addEventListener("keydown",this.handleKeyDown)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("click",this.handleDocumentClick),document.removeEventListener("keydown",this.handleKeyDown)}async fetchUsers(){try{const e=await mc.get("/users");this.users=e.users}catch(e){console.error("Error fetching users:",e)}}async createUser(){const e=this.newUser.username;try{await mc.post("/users",this.newUser),this.showCreateForm=!1,this.newUser={username:"",password:"",groups:"",shell:""},this.fetchUsers(),this.showToast(n("users.createSuccess",{username:e}),"success")}catch(t){console.error("Error creating user:",t),this.showToast(n("users.createError"),"error")}}async deleteUser(){if(!this.userToDelete)return;const e=this.userToDelete;try{await mc.delete(`/users/${e}`),this.userToDelete=null,this.fetchUsers(),this.closeDeleteModal(),this.showToast(n("users.deleteSuccess",{username:e}),"success")}catch(t){console.error("Error deleting user:",t);const e=t instanceof uc?t.details||t.message:"",s=e?`${n("users.deleteError")}: ${e}`:n("users.deleteError");this.showToast(s,"error")}}openDeleteModal(e){this.userToDelete=e;const t=this.shadowRoot?.querySelector("#deleteModal");t&&(t.open=!0)}closeDeleteModal(){this.userToDelete=null;const e=this.shadowRoot?.querySelector("#deleteModal");e&&(e.open=!1)}openResetPasswordDrawer(e){this.resetPasswordUsername=e,this.newPassword="",this.confirmPassword="",this.showResetPasswordForm=!0}closeResetPasswordDrawer(){this.showResetPasswordForm=!1,this.resetPasswordUsername=null,this.newPassword="",this.confirmPassword=""}showToast(e,t="info"){const s=this.renderRoot?.querySelector("notification-container");s&&"function"==typeof s.addNotification&&s.addNotification({message:e,type:t})}async resetPassword(){if(this.resetPasswordUsername)if(this.newPassword===this.confirmPassword)if(this.newPassword)try{await mc.post(`/users/${this.resetPasswordUsername}/reset-password`,{password:this.newPassword});const e=this.resetPasswordUsername;this.closeResetPasswordDrawer(),this.showToast(n("users.resetPasswordSuccess",{username:e}),"success")}catch(e){console.error("Error resetting password:",e),this.showToast(n("users.resetPasswordError",{default:"Failed to reset password"}),"error")}else this.showToast(n("users.passwordRequired",{default:"Password is required"}),"error");else this.showToast(n("users.passwordMismatch"),"error")}openEditDrawer(e){const t=this.users.find(t=>t.username===e);t&&(this.editingUser={...t},this.showEditForm=!0)}closeEditDrawer(){this.showEditForm=!1,this.editingUser=null}async updateUser(){if(!this.editingUser)return;const e=Array.isArray(this.editingUser.groups)?this.editingUser.groups.join(","):"",t={};e&&(t.groups=e),this.editingUser.shell&&(t.shell=this.editingUser.shell);try{await mc.put(`/users/${this.editingUser.username}`,t);const e=this.editingUser.username;this.showEditForm=!1,this.editingUser=null,this.fetchUsers(),this.showToast(n("users.updateSuccess",{username:e}),"success")}catch(s){console.error("Error updating user:",s),this.showToast(n("users.updateError"),"error")}}updateEditingUser(e,t){this.editingUser&&(this.editingUser="groups"===e?{...this.editingUser,groups:t.split(",").map(e=>e.trim()).filter(Boolean)}:{...this.editingUser,[e]:t})}toggleActionMenu(e,t){e.stopPropagation();const s=this.shadowRoot?.getElementById(t);if(s){const e=s.classList.contains("show");if(this.closeAllMenus(),!e){s.classList.add("show");const e=s.querySelector("button");e&&setTimeout(()=>e.focus(),10)}}}closeAllMenus(){const e=this.shadowRoot?.querySelectorAll(".action-dropdown");e?.forEach(e=>e.classList.remove("show"))}updateNewUser(e,t){this.newUser={...this.newUser,[e]:t}}closeCreateDrawer(){this.showCreateForm=!1,this.newUser={username:"",password:"",groups:"",shell:""}}handleSearch(e){this.searchQuery=e.target.value}clearSearch(){this.searchQuery=""}get filteredUsers(){if(!this.searchQuery.trim())return this.users;const e=this.searchQuery.toLowerCase();return this.users.filter(t=>t.username.toLowerCase().includes(e)||t.uid.toString().includes(e)||t.gid.toString().includes(e)||t.home.toLowerCase().includes(e)||t.shell.toLowerCase().includes(e)||t.groups&&Array.isArray(t.groups)&&t.groups.some(t=>t.toLowerCase().includes(e)))}render(){const e=this.filteredUsers;return J`
      <div class="header">
        <h1>${n("users.title")}</h1>
        <div class="actions">
          <div class="search-box">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input 
              type="text" 
              placeholder="${n("users.searchUsers")}"
              .value=${this.searchQuery}
              @input=${this.handleSearch}
            />
            ${this.searchQuery?J`
              <button class="clear-search" @click=${this.clearSearch}>
                â
              </button>
            `:""}
          </div>
          <button class="btn-primary" @click=${()=>this.showCreateForm=!0}>
            ${n("users.createUser")}
          </button>
        </div>
      </div>
      
      <table class="users-table">
          <thead>
            <tr>
              <th>${n("users.username")}</th>
              <th>${n("users.uid")}</th>
              <th>${n("users.gid")}</th>
              <th>${n("users.home")}</th>
              <th>${n("users.shell")}</th>
              <th>${n("common.actions")}</th>
            </tr>
          </thead>
          <tbody>
            ${e.map((e,t)=>J`
              <tr>
                <td>${e.username}</td>
                <td>${e.uid}</td>
                <td>${e.gid}</td>
                <td>${e.home}</td>
                <td>${e.shell}</td>
                <td>
                  <div class="action-menu">
                    <button class="action-dots" @click=${e=>this.toggleActionMenu(e,`user-${t}`)}>â®</button>
                    <div class="action-dropdown" id="user-${t}">
                      <button @click=${()=>{this.closeAllMenus(),this.openResetPasswordDrawer(e.username)}}>
                        ${n("users.resetPassword")}
                      </button>
                      <button @click=${()=>{this.closeAllMenus(),this.openEditDrawer(e.username)}}>
                        ${n("common.edit")}
                      </button>
                      <button class="danger" @click=${()=>{this.closeAllMenus(),this.openDeleteModal(e.username)}}>
                        ${n("common.delete")}
                      </button>
                    </div>
                  </div>
                </td>
              </tr>
            `)}
          </tbody>
        </table>

      <modal-dialog 
        id="deleteModal" 
        title="${n("users.confirmDelete",{default:"Delete User"})}" 
        size="small"
        @modal-close=${this.closeDeleteModal}
      >
        <p>
          ${this.userToDelete?n("users.confirmDeleteMessage",{username:this.userToDelete,default:`Are you sure you want to delete user "${this.userToDelete}"? This action cannot be undone.`}):""}
        </p>
        <div slot="footer">
          <button class="btn-secondary" @click=${this.closeDeleteModal}>
            ${n("common.cancel")}
          </button>
          <button class="btn-danger" @click=${this.deleteUser}>
            ${n("common.delete")}
          </button>
        </div>
      </modal-dialog>

      ${this.showCreateForm?J`
        <div class="drawer">
          <button class="close-btn" @click=${this.closeCreateDrawer}>â</button>
          <h2>${n("users.createUser")}</h2>
          <div class="drawer-form">
            <div class="form-group">
              <label for="username">${n("users.username")}</label>
              <input
                id="username"
                type="text"
                .value=${this.newUser.username}
                @input=${e=>this.updateNewUser("username",e.target.value)}
                placeholder="${n("users.username")}"
              />
            </div>
            <div class="form-group">
              <label for="password">${n("users.password")}</label>
              <input
                id="password"
                type="password"
                .value=${this.newUser.password}
                @input=${e=>this.updateNewUser("password",e.target.value)}
                placeholder="${n("users.password")}"
              />
            </div>
            <div class="form-group">
              <label for="shell">${n("users.shell")}</label>
              <input
                id="shell"
                type="text"
                .value=${this.newUser.shell}
                @input=${e=>this.updateNewUser("shell",e.target.value)}
                placeholder="/bin/bash"
              />
            </div>
            <div class="form-group">
              <label for="groups">${n("users.groups")}</label>
              <input
                id="groups"
                type="text"
                .value=${this.newUser.groups}
                @input=${e=>this.updateNewUser("groups",e.target.value)}
                placeholder="wheel,users"
              />
            </div>
            <div class="form-actions">
              <button class="btn-secondary" @click=${this.closeCreateDrawer}>
                ${n("common.cancel")}
              </button>
              <button class="btn-primary" @click=${this.createUser}>
                ${n("common.create")}
              </button>
            </div>
          </div>
        </div>
      `:""}

      ${this.showEditForm?J`
        <div class="drawer">
          <button class="close-btn" @click=${this.closeEditDrawer}>â</button>
          <h2>${n("users.editUser")}</h2>
          <div class="drawer-form">
            <div class="form-group">
              <label for="username">${n("users.username")}</label>
              <input
                id="username"
                type="text"
                .value=${this.editingUser?.username}
                @input=${e=>this.updateEditingUser("username",e.target.value)}
                placeholder="${n("users.username")}"
                disabled
              />
            </div>
            <div class="form-group">
              <label for="shell">${n("users.shell")}</label>
              <input
                id="shell"
                type="text"
                .value=${this.editingUser?.shell||""}
                @input=${e=>this.updateEditingUser("shell",e.target.value)}
                placeholder="/bin/bash"
              />
            </div>
            <div class="form-group">
              <label for="groups">${n("users.groups")}</label>
              <input
                id="groups"
                type="text"
                .value=${this.editingUser?.groups?.join(",")||""}
                @input=${e=>this.updateEditingUser("groups",e.target.value)}
                placeholder="wheel,users"
              />
            </div>
            <div class="form-actions">
              <button class="btn-secondary" @click=${this.closeEditDrawer}>
                ${n("common.cancel")}
              </button>
              <button class="btn-primary" @click=${this.updateUser}>
                ${n("common.save")}
              </button>
            </div>
          </div>
        </div>
      `:""}

      ${this.showResetPasswordForm?J`
        <div class="drawer">
          <button class="close-btn" @click=${this.closeResetPasswordDrawer}>â</button>
          <h2>${n("users.resetPassword")} - ${this.resetPasswordUsername}</h2>
          <div class="drawer-form">
            <div class="form-group">
              <label for="new-password">${n("users.newPassword",{default:"New Password"})}</label>
              <input
                id="new-password"
                type="password"
                .value=${this.newPassword}
                @input=${e=>this.newPassword=e.target.value}
                placeholder="${n("users.newPassword",{default:"New Password"})}"
              />
            </div>
            <div class="form-group">
              <label for="confirm-password">${n("users.confirmPassword")}</label>
              <input
                id="confirm-password"
                type="password"
                .value=${this.confirmPassword}
                @input=${e=>this.confirmPassword=e.target.value}
                placeholder="${n("users.confirmPassword")}"
              />
            </div>
            <div class="form-actions">
              <button class="btn-secondary" @click=${this.closeResetPasswordDrawer}>
                ${n("common.cancel")}
              </button>
              <button class="btn-primary" @click=${this.resetPassword}>
                ${n("users.resetPassword")}
              </button>
            </div>
          </div>
        </div>
      `:""}

      <notification-container></notification-container>
    `}}Ep([we({type:Array})],Mp.prototype,"users"),Ep([we({type:Boolean})],Mp.prototype,"showCreateForm"),Ep([we({type:Boolean})],Mp.prototype,"showEditForm"),Ep([we({type:Boolean})],Mp.prototype,"showResetPasswordForm"),Ep([we({type:Object})],Mp.prototype,"newUser"),Ep([we({type:Object})],Mp.prototype,"editingUser"),Ep([we({type:String})],Mp.prototype,"userToDelete"),Ep([we({type:String})],Mp.prototype,"resetPasswordUsername"),Ep([we({type:String})],Mp.prototype,"newPassword"),Ep([we({type:String})],Mp.prototype,"confirmPassword"),Ep([we({type:String})],Mp.prototype,"searchQuery"),customElements.define("users-tab",Mp);var Ap=Object.defineProperty,Ip=(e,t,s,i)=>{for(var o,r=void 0,a=e.length-1;a>=0;a--)(o=e[a])&&(r=o(t,s,r)||r);return r&&Ap(t,s,r),r};class Tp extends me{constructor(){super(...arguments),this.activeTab="processes",this.containers=[],this.images=[],this.volumes=[],this.networks=[],this.searchTerm="",this.error=null,this.showConfirmModal=!1,this.confirmAction=null,this.selectedContainer=null,this.selectedImage=null,this.showDrawer=!1,this.detailError=null,this.confirmTitle="",this.confirmMessage="",this.showLogsDrawer=!1,this.containerLogs="",this.logsError=null,this.logsSearchTerm="",this.showTerminalModal=!1,this.terminalContainerId="",this.terminalContainerName="",this.showImageActionsDropdown=!1,this.showPullImageModal=!1,this.imageName="",this.isPullingImage=!1,this.showUploadDrawer=!1,this.uploadQueue=[],this.isUploading=!1,this.currentUpload=null,this.showCreateDrawer=!1,this.isClosingCreateDrawer=!1,this.createError=null,this.isCreating=!1,this.createName="",this.createImage="",this.createEntrypoint="",this.createCmd="",this.createEnv="",this.createLabels="",this.createWorkingDir="",this.createNetworkMode="",this.createRestartPolicy="no",this.createRestartMaxRetry="",this.createCpuCores="",this.createMemoryMB="",this.createPorts=[],this.createVolumes=[],this.handleDocumentClick=e=>{e.target.closest(".action-menu")||this.closeAllMenus()},this.handleKeyDown=e=>{"Escape"===e.key&&(this.showConfirmModal?this.handleCancel():this.closeAllMenus())},this.handleLocationChange=()=>{const e=window.location.pathname;e.endsWith("/images")?this.activeTab="images":e.endsWith("/volumes")?this.activeTab="volumes":e.endsWith("/networks")?this.activeTab="networks":this.activeTab="processes",this.fetchData()},this.handleFileSelect=e=>{const t=e.target;if(t.files&&t.files.length>0){const e=t.files[0];e&&this.addToUploadQueue(e)}},this.handleDragOver=e=>{e.preventDefault();e.currentTarget.classList.add("dragover")},this.handleDragLeave=e=>{e.preventDefault();e.currentTarget.classList.remove("dragover")},this.handleDrop=e=>{e.preventDefault();if(e.currentTarget.classList.remove("dragover"),e.dataTransfer?.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];t&&this.addToUploadQueue(t)}}}static{this.styles=g`
    :host {
      display: block;
      padding: 16px;
      margin: 0;
    }

    .tab-container {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .tab-header {
      display: flex;
      border-bottom: 2px solid var(--border-color);
      margin-bottom: 1rem;
    }

    .tab-button {
      padding: 0.75rem 1.5rem;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 0.875rem;
      color: var(--text-secondary);
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
      transition: all 0.2s;
    }

    .tab-button:hover {
      color: var(--text-primary);
    }

    .tab-button.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }

    .tab-content {
      flex: 1;
      overflow-y: auto;
    }

    .container {
      background: var(--vscode-bg-light);
      color: var(--vscode-text);
      padding: 16px;
      border-radius: 6px;
      margin-bottom: 16px;
    }

    .container-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      margin-bottom: 8px;
    }

    .container-info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 16px;
      font-size: 13px;
    }

    .container-actions {
      display: flex;
      gap: 8px;
    }

    button {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--vscode-accent);
      color: white;
    }

    .btn-primary:hover {
      background: var(--vscode-accent-hover);
    }

    .btn-danger {
      background: var(--vscode-error);
      color: white;
    }

    .btn-danger:hover {
      opacity: 0.9;
    }

    .size-info {
      font-size: 12px;
      color: var(--vscode-text-dim);
    }

    h1 {
      margin: 0 0 24px 0;
      padding: 0;
      font-size: 24px;
      font-weight: 300;
    }

    h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: var(--text-primary);
    }

    .image {
      background: var(--vscode-bg-light);
      color: var(--vscode-text);
      padding: 16px;
      border-radius: 6px;
      margin-bottom: 16px;
    }

    .image-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      margin-bottom: 8px;
    }

    .image-info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 16px;
      font-size: 13px;
    }

    .image-actions {
      display: flex;
      gap: 8px;
    }

    .search-container {
      display: flex;
      align-items: center;
      margin-bottom: 1.5rem;
      gap: 1rem;
    }

    .search-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      gap: 1rem;
    }

    .section-header h2 {
      margin: 0;
    }

    .search-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      max-width: 400px;
    }

    .search-icon {
      position: absolute;
      left: 12px;
      color: var(--vscode-input-placeholderForeground, #999);
      pointer-events: none;
      width: 16px;
      height: 16px;
    }

    .search-input {
      padding: 6px 12px 6px 32px;
      border: 1px solid var(--vscode-widget-border, var(--vscode-input-border, var(--vscode-panel-border, #454545)));
      border-radius: 4px;
      background-color: var(--vscode-input-background);
      color: var(--vscode-input-foreground);
      font-size: 0.875rem;
      width: 250px;
      transition: all 0.2s;
      outline: none;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.08);
    }

    .search-input:hover {
      border-color: var(--vscode-inputOption-hoverBorder, var(--vscode-widget-border, #858585));
    }

    .search-input:focus {
      border-color: var(--vscode-focusBorder, #007acc);
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1), 0 0 0 1px var(--vscode-focusBorder, #007acc);
    }

    .search-input::placeholder {
      color: var(--vscode-input-placeholderForeground, #999);
      opacity: 0.7;
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }

    .error-state {
      text-align: center;
      padding: 3rem;
      color: var(--vscode-error);
      background: var(--vscode-bg-light);
      border-radius: 6px;
      margin: 2rem 0;
    }


    .table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: var(--vscode-bg-light);
      border-radius: 1px;
      overflow: visible;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      border: 1px solid var(--vscode-border);
    }

    .table thead {
      background: var(--vscode-bg-lighter);
    }

    .table th {
      background: var(--vscode-bg-dark);
      color: var(--vscode-text);
      font-weight: 600;
      text-align: left;
      padding: 12px 16px;
      font-size: 0.875rem;
      border-bottom: 1px solid var(--vscode-border);
    }

    .table td {
      padding: 12px 16px;
      color: var(--vscode-text);
      font-size: 0.875rem;
      border-bottom: 1px solid var(--vscode-border);
      position: relative;
    }

    .table td:last-child {
      text-align: right;
    }

    .table tr:last-child td {
      border-bottom: none;
    }

    .table tr:hover td {
      background: rgba(255, 255, 255, 0.02);
    }

    .table td button {
      margin-right: 8px;
    }

    .table td button:last-child {
      margin-right: 0;
    }

    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-icon {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      position: relative;
    }

    .status-icon.running {
      background-color: #4caf50;
      box-shadow: 0 0 4px #4caf50;
    }

    .status-icon.stopped {
      background-color: #9e9e9e;
    }

    .status-icon.paused {
      background-color: #ff9800;
    }

    .status-icon.exited {
      background-color: #f44336;
    }

    .status-icon[data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      padding: 6px 12px;
      background-color: var(--vscode-editorWidget-background, var(--vscode-dropdown-background, #252526));
      color: var(--vscode-editorWidget-foreground, var(--vscode-foreground, #cccccc));
      border: 1px solid var(--vscode-editorWidget-border, var(--vscode-widget-border, #454545));
      border-radius: 4px;
      font-size: 14px;
      white-space: nowrap;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .truncate {
      max-width: 200px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: inline-block;
      position: relative;
    }

    .truncate[title]:hover::after {
      content: attr(title);
      position: absolute;
      left: 0;
      top: 100%;
      margin-top: 4px;
      padding: 6px 12px;
      background-color: var(--vscode-editorWidget-background, var(--vscode-dropdown-background, #252526));
      color: var(--vscode-editorWidget-foreground, var(--vscode-foreground, #cccccc));
      border: 1px solid var(--vscode-editorWidget-border, var(--vscode-widget-border, #454545));
      border-radius: 4px;
      font-size: 14px;
      white-space: nowrap;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      pointer-events: none;
    }

    .action-menu {
      position: relative;
      display: inline-block;
    }

    .action-dots {
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 8px;
      color: var(--text-secondary);
      font-size: 18px;
      line-height: 1;
      transition: background-color 0.2s;
      border-radius: 4px;
    }

    .action-dots:hover {
      background-color: var(--vscode-toolbar-hoverBackground, var(--vscode-list-hoverBackground, rgba(90, 93, 94, 0.1)));
    }

    .action-dropdown {
      position: absolute;
      right: 0;
      top: 100%;
      margin-top: 4px;
      background: var(--vscode-dropdown-background, var(--vscode-menu-background, var(--vscode-bg-light, #252526)));
      border: 1px solid var(--vscode-dropdown-border, var(--vscode-menu-border, var(--border-color, #454545)));
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      min-width: 160px;
      z-index: 1000;
      display: none;
    }

    .action-dropdown.show {
      display: block;
    }

    .action-dropdown.open-up {
      top: auto;
      bottom: 100%;
      margin-top: 0;
      margin-bottom: 4px;
    }

    .action-dropdown button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 8px 16px;
      border: none;
      background: none;
      color: var(--vscode-menu-foreground, var(--vscode-foreground, var(--vscode-text, #cccccc)));
      cursor: pointer;
      font-size: 13px;
      transition: background-color 0.2s;
    }

    .action-dropdown button:hover {
      background-color: var(--vscode-list-hoverBackground, var(--vscode-toolbar-hoverBackground, rgba(255, 255, 255, 0.08)));
      color: var(--vscode-list-hoverForeground, var(--vscode-foreground));
    }

    .action-dropdown button.danger {
      color: var(--vscode-error);
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--vscode-accent, #007acc);
      color: white;
    }

    .btn-primary:hover {
      background: var(--vscode-accent-hover, #005a9e);
    }

    .btn-secondary {
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border: 1px solid var(--vscode-button-border, transparent);
    }

    .btn-secondary:hover {
      background: var(--vscode-button-secondaryHoverBackground, #484848);
    }

    a {
      color: var(--vscode-textLink-foreground, #3794ff);
      text-decoration: none;
      cursor: pointer;
    }

    a:hover {
      text-decoration: underline;
    }

    /* Link-style buttons for clickable items */
    button.link-button,
    td button {
      background: none;
      border: none;
      color: var(--vscode-textLink-foreground, #3794ff);
      cursor: pointer;
      font-size: inherit;
      font-family: inherit;
      text-align: left;
      padding: 0;
      text-decoration: none;
      transition: text-decoration 0.2s;
    }

    button.link-button:hover,
    td button:hover {
      text-decoration: underline;
    }

    td button:focus {
      outline: 1px solid var(--vscode-focusBorder, #007acc);
      outline-offset: 2px;
    }

    .drawer {
      position: fixed;
      top: 0;
      right: 0;
      width: 50%;
      height: 100%;
      background: var(--vscode-bg-light);
      border-left: 1px solid var(--vscode-border);
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      z-index: 1001;
      overflow-y: auto;
      padding: 24px;
      animation: slideIn 0.3s ease-out;
    }

    /* Make drawer full width on smaller screens */
    @media (max-width: 1024px) {
      .drawer {
        width: 80%;
      }
    }

    @media (max-width: 768px) {
      .drawer {
        width: 100%;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
      }
      to {
        transform: translateX(0);
      }
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
      }
      to {
        transform: translateX(100%);
      }
    }

    .create-drawer {
      position: fixed;
      top: 0;
      right: 0;
      width: 50%;
      height: 100%;
      background: var(--vscode-editor-background, #1e1e1e);
      border-left: 1px solid var(--vscode-border);
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      z-index: 1001;
      overflow-y: auto;
      animation: slideIn 0.3s ease-out;
      display: flex;
      flex-direction: column;
    }

    @media (max-width: 1024px) {
      .create-drawer {
        width: 80%;
      }
    }

    @media (max-width: 768px) {
      .create-drawer {
        width: 100%;
      }
    }

    .create-drawer.closing {
      animation: slideOut 0.3s ease-in forwards;
    }

    .create-drawer-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--vscode-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--vscode-bg-lighter, #252526);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .create-drawer-title {
      font-size: 18px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
      margin: 0;
    }

    .create-drawer-content {
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    .create-drawer-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--vscode-border);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      background: var(--vscode-bg-lighter, #252526);
      position: sticky;
      bottom: 0;
      z-index: 10;
    }

    .create-close-btn {
      background: transparent;
      border: none;
      color: var(--vscode-foreground, #cccccc);
      cursor: pointer;
      padding: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      font-size: 20px;
      line-height: 1;
      transition: all 0.2s;
    }

    .create-close-btn:hover {
      background: var(--vscode-toolbar-hoverBackground, rgba(90, 93, 94, 0.31));
      color: var(--vscode-icon-foreground, #c5c5c5);
    }

    .drawer h2 {
      margin-top: 0;
    }

    .drawer pre {
      background: var(--vscode-bg-dark);
      border: 1px solid var(--vscode-widget-border, var(--vscode-panel-border, #454545));
      border-radius: 4px;
      padding: 16px;
      overflow-x: auto;
      font-size: 0.875rem;
      color: var(--vscode-text);
    }

    .drawer button.close-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      background: var(--vscode-toolbar-hoverBackground, rgba(90, 93, 94, 0.1));
      color: var(--vscode-foreground, var(--vscode-editor-foreground));
      border: 1px solid var(--vscode-widget-border, rgba(0, 0, 0, 0.1));
      transition: all 0.2s;
    }

    .drawer button.close-btn:hover {
      background: var(--vscode-list-hoverBackground, rgba(90, 93, 94, 0.2));
      border-color: var(--vscode-widget-border, rgba(0, 0, 0, 0.2));
    }

    .drawer button.close-btn:active {
      background: var(--vscode-list-activeSelectionBackground, rgba(90, 93, 94, 0.3));
    }

    .drawer button.close-btn:focus {
      outline: 1px solid var(--vscode-focusBorder, #007acc);
      outline-offset: 2px;
    }

    .drawer-content {
      margin-top: 40px;
      padding-bottom: 80px;
    }

    .form-section {
      margin-bottom: 24px;
    }

    .form-section h3 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-primary);
      border-bottom: 1px solid var(--vscode-border);
      padding-bottom: 8px;
    }

    .form-field {
      margin-bottom: 12px;
    }

    .form-label {
      display: block;
      font-size: 0.8125rem;
      color: var(--text-secondary);
      margin-bottom: 4px;
      font-weight: 500;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid var(--vscode-widget-border, var(--vscode-input-border, var(--vscode-panel-border, #454545)));
      border-radius: 4px;
      background-color: var(--vscode-input-background);
      color: var(--vscode-input-foreground);
      font-size: 0.875rem;
      font-family: inherit;
      outline: none;
      box-sizing: border-box;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      border-color: var(--vscode-focusBorder, #007acc);
    }

    .form-textarea {
      min-height: 80px;
      resize: vertical;
    }

    .form-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .form-row .form-input,
    .form-row .form-select {
      flex: 1;
    }

    .form-hint {
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #999);
      margin-top: 4px;
    }

    .btn-small {
      padding: 6px 10px;
      font-size: 12px;
    }

    .list-item {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
    }

    .detail-section {
      margin-bottom: 24px;
    }

    .detail-section h3 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-primary);
      border-bottom: 1px solid var(--vscode-border);
      padding-bottom: 8px;
    }

    .detail-item {
      display: flex;
      flex-direction: column;
      margin-bottom: 12px;
    }

    .detail-label {
      font-size: 0.8125rem;
      color: var(--text-secondary);
      margin-bottom: 4px;
      font-weight: 500;
    }

    .detail-value {
      font-size: 0.875rem;
      color: var(--vscode-text);
      word-break: break-word;
    }

    .detail-value.monospace {
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      background: var(--vscode-textCodeBlock-background, rgba(255, 255, 255, 0.04));
      padding: 4px 8px;
      border-radius: 3px;
      font-size: 0.8125rem;
    }

    .tag-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .tag {
      background: var(--vscode-badge-background);
      color: var(--vscode-badge-foreground);
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: 16px;
      font-size: 0.875rem;
      font-weight: 500;
    }

    .status-badge.running {
      background: rgba(76, 175, 80, 0.1);
      color: #4caf50;
      border: 1px solid rgba(76, 175, 80, 0.3);
    }

    .status-badge.stopped {
      background: rgba(158, 158, 158, 0.1);
      color: #9e9e9e;
      border: 1px solid rgba(158, 158, 158, 0.3);
    }

    .status-badge.paused {
      background: rgba(255, 152, 0, 0.1);
      color: #ff9800;
      border: 1px solid rgba(255, 152, 0, 0.3);
    }

    .status-badge.exited {
      background: rgba(244, 67, 54, 0.1);
      color: #f44336;
      border: 1px solid rgba(244, 67, 54, 0.3);
    }

    .error-container {
      padding: 40px 20px;
      text-align: center;
    }

    .error-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.7;
    }

    .error-message {
      color: var(--vscode-errorForeground, #f48771);
      font-size: 14px;
      line-height: 1.5;
      margin: 0;
    }

    .logs-container {
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 0.875rem;
      line-height: 1.5;
      background: var(--vscode-editor-background, #1e1e1e);
      color: var(--vscode-editor-foreground, #d4d4d4);
      padding: 16px;
      border-radius: 4px;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
      max-height: calc(100vh - 200px);
      overflow-y: auto;
    }

    .logs-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--vscode-widget-border, var(--vscode-panel-border, #454545));
    }

    .logs-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--vscode-foreground);
    }

    /* Upload drawer styles */
    .upload-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--vscode-widget-border, var(--vscode-panel-border, #454545));
    }

    .upload-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--vscode-foreground);
    }

    .upload-zone {
      border: 2px dashed var(--vscode-widget-border, #454545);
      border-radius: 8px;
      padding: 40px 20px;
      text-align: center;
      margin-bottom: 24px;
      transition: all 0.2s;
      cursor: pointer;
    }

    .upload-zone:hover {
      border-color: var(--vscode-focusBorder, #007acc);
      background: rgba(0, 122, 204, 0.05);
    }

    .upload-zone.dragover {
      border-color: var(--vscode-focusBorder, #007acc);
      background: rgba(0, 122, 204, 0.1);
    }

    .upload-icon {
      font-size: 48px;
      margin-bottom: 16px;
      color: var(--vscode-descriptionForeground, #999);
    }

    .upload-text {
      font-size: 16px;
      margin-bottom: 8px;
      color: var(--vscode-foreground);
    }

    .upload-hint {
      font-size: 14px;
      color: var(--vscode-descriptionForeground, #999);
    }

    .upload-queue {
      margin-top: 24px;
    }

    .upload-item {
      background: var(--vscode-bg-dark);
      border: 1px solid var(--vscode-widget-border, #454545);
      border-radius: 6px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .upload-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .upload-item-name {
      font-weight: 500;
      color: var(--vscode-foreground);
      flex: 1;
      margin-right: 12px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .upload-item-size {
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #999);
      margin-right: 12px;
    }

    .upload-item-status {
      font-size: 12px;
      font-weight: 500;
      padding: 2px 8px;
      border-radius: 4px;
    }

    .upload-item-status.pending {
      background: rgba(255, 193, 7, 0.2);
      color: #ffc107;
    }

    .upload-item-status.uploading {
      background: rgba(0, 122, 204, 0.2);
      color: #007acc;
    }

    .upload-item-status.completed {
      background: rgba(76, 175, 80, 0.2);
      color: #4caf50;
    }

    .upload-item-status.error {
      background: rgba(244, 67, 54, 0.2);
      color: #f44336;
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      background: var(--vscode-widget-border, #454545);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 8px;
    }

    .progress-fill {
      height: 100%;
      background: var(--vscode-focusBorder, #007acc);
      border-radius: 3px;
      transition: width 0.3s ease;
    }

    .progress-fill.completed {
      background: #4caf50;
    }

    .progress-fill.error {
      background: #f44336;
    }

    .progress-text {
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #999);
      display: flex;
      justify-content: space-between;
    }

    .upload-error {
      color: var(--vscode-errorForeground, #f48771);
      font-size: 12px;
      margin-top: 4px;
    }

    .upload-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid var(--vscode-widget-border, #454545);
    }

    .hidden-file-input {
      display: none;
    }
  `}connectedCallback(){super.connectedCallback(),this.handleLocationChange(),window.addEventListener("popstate",this.handleLocationChange),document.addEventListener("click",this.handleDocumentClick),document.addEventListener("keydown",this.handleKeyDown)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("popstate",this.handleLocationChange),document.removeEventListener("click",this.handleDocumentClick),document.removeEventListener("keydown",this.handleKeyDown)}async fetchData(){switch(this.activeTab){case"processes":await this.fetchContainers();break;case"images":await this.fetchImages();break;case"volumes":await this.fetchVolumes();break;case"networks":await this.fetchNetworks()}}async fetchContainers(){try{const e=await mc.get("/docker/ps");this.containers=e.containers||[],this.error=null}catch(e){console.error("Error fetching containers:",e),this.error=e instanceof uc?e.message:"Failed to fetch containers"}}async fetchImages(){try{const e=await mc.get("/docker/images");this.images=e.images||[],this.error=null}catch(e){console.error("Error fetching images:",e),this.error=e instanceof uc?e.message:"Failed to fetch images"}}async fetchVolumes(){try{const e=await mc.get("/docker/volumes");this.volumes=e.volumes||[],this.error=null}catch(e){console.error("Error fetching volumes:",e),this.error=e instanceof uc?e.message:"Failed to fetch volumes"}}async fetchNetworks(){try{const e=await mc.get("/docker/networks");this.networks=e.networks||[],this.error=null}catch(e){console.error("Error fetching networks:",e),this.error=e instanceof uc?e.message:"Failed to fetch networks"}}handleTabClick(e,t){let s;switch(e.preventDefault(),this.activeTab=t,t){case"images":s="/docker/images";break;case"volumes":s="/docker/volumes";break;case"networks":s="/docker/networks";break;default:s="/docker/processes"}window.history.pushState({},"",s),this.fetchData()}renderTabs(){return J`
      <div class="tab-header">
        <a 
          href="/docker/processes"
          class="tab-button ${"processes"===this.activeTab?"active":""}" 
          @click="${e=>this.handleTabClick(e,"processes")}"
        >
          Processes
        </a>
        <a 
          href="/docker/images"
          class="tab-button ${"images"===this.activeTab?"active":""}" 
          @click="${e=>this.handleTabClick(e,"images")}"
        >
          Images
        </a>
        <a 
          href="/docker/volumes"
          class="tab-button ${"volumes"===this.activeTab?"active":""}" 
          @click="${e=>this.handleTabClick(e,"volumes")}"
        >
          Volumes
        </a>
        <a 
          href="/docker/networks"
          class="tab-button ${"networks"===this.activeTab?"active":""}" 
          @click="${e=>this.handleTabClick(e,"networks")}"
        >
          Networks
        </a>
      </div>
    `}render(){return J`
      <div class="tab-container">
        <h1>${n("Docker")}</h1>
        ${this.renderTabs()}
        <div class="tab-content">
          ${this.error?J`
            <div class="error-state">
              <h3>${this.error.includes("No container runtime found")?"Container Runtime Not Available":"Error"}</h3>
              <p>${this.error.includes("No container runtime found")?"Container management features are not available. Please install Docker or a CRI-compatible container runtime (containerd, CRI-O) to use this feature.":this.error}</p>
            </div>`:""}
          ${"processes"!==this.activeTab||this.error?"":J`
            ${this.containers.length>0?this.renderContainersTable():J`
                <div class="empty-state">No containers found.</div>`}
          `}
          ${"images"!==this.activeTab||this.error?"":J`
            ${this.images.length>0?this.renderImagesTable():J`
                <div class="empty-state">No images found.</div>`}
          `}
          ${"volumes"!==this.activeTab||this.error?"":J`
            ${this.volumes.length>0?this.renderVolumesTable():J`
                <div class="empty-state">No volumes found.</div>`}
          `}
          ${"networks"!==this.activeTab||this.error?"":J`
            ${this.networks.length>0?this.renderNetworksTable():J`
                <div class="empty-state">No networks found.</div>`}
          `}
        </div>
      </div>

      <modal-dialog
        ?open=${this.showConfirmModal}
        .title=${this.confirmTitle}
        size="small"
        @modal-close=${this.handleCancel}
      >
        <p>${this.confirmMessage}</p>
        <div slot="footer" style="display: flex; gap: 8px; justify-content: flex-end;">
          <button class="btn btn-secondary" @click=${this.handleCancel}>
            ${n("common.cancel")}
          </button>
          <button class="btn btn-primary" @click=${this.handleConfirm}>
            ${n("common.confirm")}
          </button>
        </div>
      </modal-dialog>

      <container-terminal-modal
        .show=${this.showTerminalModal}
        .containerId=${this.terminalContainerId}
        .containerName=${this.terminalContainerName}
        .runtime=${"docker"}
        @close=${()=>{this.showTerminalModal=!1}}
      ></container-terminal-modal>

      ${this.showCreateDrawer?this.renderCreateContainerDrawer():""}

      ${this.showDrawer?J`
        <div class="drawer">
          <button class="close-btn" @click=${()=>{this.showDrawer=!1,this.detailError=null}}>â</button>
          ${this.detailError?this.renderError():this.selectedContainer?this.renderContainerDetails():this.selectedImage?this.renderImageDetails():""}
        </div>`:""}

      ${this.showLogsDrawer?J`
        <div class="drawer">
          <button class="close-btn" @click=${()=>{this.showLogsDrawer=!1,this.logsError=null,this.containerLogs="",this.logsSearchTerm=""}}>â</button>
          <div class="drawer-content">
            <div class="logs-header">
              <h2 class="logs-title">Container Logs</h2>
              <div class="search-wrapper">
                <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input
                  class="search-input"
                  type="text"
                  placeholder="${n("containers.searchLogs")}"
                  .value=${this.logsSearchTerm}
                  @input=${e=>this.logsSearchTerm=e.target.value}
                />
              </div>
            </div>
            ${this.logsError?J`
              <div class="error-container">
                <div class="error-icon">â ï¸</div>
                <p class="error-message">${this.logsError}</p>
              </div>`:J`
              <div class="logs-container">${Hd(this.highlightSearchTerm(this.containerLogs,this.logsSearchTerm))}</div>`}
          </div>
        </div>`:""}

      ${this.showUploadDrawer?J`
        <div class="drawer">
          <button class="close-btn" @click=${()=>{this.showUploadDrawer=!1,this.uploadQueue=[],this.isUploading=!1}}>â</button>
          <div class="drawer-content">
            <div class="upload-header">
              <h2 class="upload-title">Upload Docker Image</h2>
            </div>
            
            <div class="upload-zone" 
                  @click=${()=>this.shadowRoot?.querySelector("#file-input")?.click()}
                 @dragover=${this.handleDragOver}
                 @dragleave=${this.handleDragLeave}
                 @drop=${this.handleDrop}>
              <div class="upload-icon">ð</div>
              <div class="upload-text">Drop image files here or click to browse</div>
              <div class="upload-hint">Supports .tar, .tar.gz, .tgz files</div>
            </div>
            
            <input 
              type="file" 
              id="file-input" 
              class="hidden-file-input"
              accept=".tar,.tar.gz,.tgz"
              @change=${this.handleFileSelect}
            />
            
            ${this.uploadQueue.length>0?J`
              <div class="upload-queue">
                <h3>Upload Queue</h3>
                ${this.uploadQueue.map(e=>J`
                  <div class="upload-item">
                    <div class="upload-item-header">
                      <span class="upload-item-name">${e.file.name}</span>
                      <span class="upload-item-size">${this.formatFileSize(e.file.size)}</span>
                      <span class="upload-item-status ${e.status}">${e.status}</span>
                    </div>
                    
                    ${"uploading"===e.status||"completed"===e.status?J`
                      <div class="progress-bar">
                        <div class="progress-fill ${e.status}" style="width: ${e.progress}%"></div>
                      </div>
                      <div class="progress-text">
                        <span>${e.progress}%</span>
                        <span>${"completed"===e.status?"Complete":"Uploading..."}</span>
                      </div>
                    `:""}
                    
                    ${e.error?J`
                      <div class="upload-error">${e.error}</div>
                    `:""}
                    
                    ${"pending"===e.status||"error"===e.status?J`
                      <button class="btn btn-secondary" style="margin-top: 8px; font-size: 12px;" 
                              @click=${()=>this.removeFromUploadQueue(e.id)}>Remove</button>
                    `:""}
                  </div>
                `)}
              </div>
              
              <div class="upload-actions">
                <button class="btn btn-primary" 
                        ?disabled=${this.isUploading||0===this.uploadQueue.filter(e=>"pending"===e.status).length}
                        @click=${this.startUpload}>
                  ${this.isUploading?"Uploading...":"Start Upload"}
                </button>
                <button class="btn btn-secondary" @click=${this.clearCompletedUploads}>Clear Completed</button>
              </div>
            `:""}
          </div>
        </div>`:""}

      <modal-dialog
        ?open=${this.showPullImageModal}
        .title="Pull Docker Image"
        size="medium"
        @modal-close=${()=>this.showPullImageModal=!1}
      >
        <div style="margin-bottom: 16px;">
          <label for="image-name" style="display: block; margin-bottom: 8px; font-weight: 500;">Image Name:</label>
          <input 
            id="image-name"
            type="text" 
            class="form-input"
            placeholder="e.g., nginx:latest or ubuntu:20.04"
            .value=${this.imageName}
            @input=${e=>this.imageName=e.target.value}
          />
          <div style="font-size: 12px; color: var(--vscode-descriptionForeground, #999); margin-top: 4px;">
            Enter the full image name including tag (if needed)
          </div>
        </div>
        <div slot="footer" style="display: flex; gap: 8px; justify-content: flex-end;">
          <button class="btn btn-secondary" ?disabled=${this.isPullingImage} @click=${()=>{this.showPullImageModal=!1,this.imageName=""}}>
            Cancel
          </button>
          <button class="btn btn-primary" 
                  ?disabled=${!this.imageName.trim()||this.isPullingImage}
                  @click=${this.handlePullImage}>
            ${this.isPullingImage?"Pulling...":"Pull Image"}
          </button>
        </div>
      </modal-dialog>
    `}handleCancel(){this.showConfirmModal=!1,this.confirmAction=null,this.selectedContainer=null,this.selectedImage=null}handleConfirm(){this.confirmAction&&this.confirmAction()}openCreateContainerDrawer(){this.resetCreateForm(),this.isClosingCreateDrawer=!1,this.showCreateDrawer=!0,this.fetchImages()}closeCreateContainerDrawer(){this.isClosingCreateDrawer||(this.isClosingCreateDrawer=!0,window.setTimeout(()=>{this.showCreateDrawer=!1,this.isClosingCreateDrawer=!1,this.createError=null},300))}resetCreateForm(){this.createName="",this.createImage="",this.createEntrypoint="",this.createCmd="",this.createEnv="",this.createLabels="",this.createWorkingDir="",this.createNetworkMode="",this.createRestartPolicy="no",this.createRestartMaxRetry="",this.createCpuCores="",this.createMemoryMB="",this.createPorts=[],this.createVolumes=[]}addPortMapping(){this.createPorts=[...this.createPorts,{containerPort:"",hostPort:"",protocol:"tcp"}]}removePortMapping(e){this.createPorts=this.createPorts.filter((t,s)=>s!==e)}addVolumeMapping(){this.createVolumes=[...this.createVolumes,{source:"",target:"",type:"bind",readOnly:!1,propagation:""}]}removeVolumeMapping(e){this.createVolumes=this.createVolumes.filter((t,s)=>s!==e)}parseCommandInput(e){const t=e.trim();if(!t)return[];if(t.startsWith("["))try{const e=JSON.parse(t);if(Array.isArray(e))return e.map(e=>String(e))}catch{}return t.split(/\s+/).filter(Boolean)}parseKeyValueLines(e){return e.split("\n").map(e=>e.trim()).filter(Boolean)}parseLabels(e){const t={};return this.parseKeyValueLines(e).forEach(e=>{const[s,...i]=e.split("=");s&&(t[s]=i.join("=")||"")}),t}getImageSuggestions(){const e=/* @__PURE__ */new Set;return this.images.forEach(t=>{(t.repoTags||[]).forEach(t=>{t&&"<none>:<none>"!==t&&e.add(t)})}),Array.from(e)}async handleCreateContainer(){if(this.createName.trim()&&this.createImage.trim()){this.isCreating=!0,this.createError=null;try{const e=this.parseCommandInput(this.createCmd),t=this.parseCommandInput(this.createEntrypoint),s=this.parseKeyValueLines(this.createEnv),i=this.parseLabels(this.createLabels),o={},r={};this.createPorts.forEach(e=>{const t=e.containerPort.trim();if(!t)return;const s=`${t}/${e.protocol?.trim()||"tcp"}`;o[s]={},r[s]||(r[s]=[]),r[s].push({hostPort:e.hostPort.trim()})});const a=this.createVolumes.filter(e=>e.source.trim()&&e.target.trim()).map(e=>({source:e.source.trim(),target:e.target.trim(),type:e.type||"bind",readOnly:e.readOnly,bindOptions:e.propagation?{propagation:e.propagation}:void 0})),n=this.createRestartPolicy.trim();let l;if(n&&"no"!==n){const e=this.createRestartMaxRetry.trim(),t=e?Number.parseInt(e,10):void 0;l={name:n,maximumRetryCount:Number.isNaN(t)?void 0:t}}const c=this.createCpuCores.trim(),d=this.createMemoryMB.trim(),h=c?Number.parseFloat(c):void 0,u=d?Number.parseInt(d,10):void 0,p=h&&!Number.isNaN(h)||u&&!Number.isNaN(u)?{cpuCores:Number.isNaN(h)?void 0:h,memoryMB:Number.isNaN(u)?void 0:u}:void 0,g={name:this.createName.trim(),image:this.createImage.trim(),cmd:e.length?e:void 0,entrypoint:t.length?t:void 0,env:s.length?s:void 0,labels:Object.keys(i).length?i:void 0,workingDir:this.createWorkingDir.trim()||void 0,networkMode:this.createNetworkMode.trim()||void 0,restartPolicy:l,resources:p,volumes:a.length?a:void 0,exposedPorts:Object.keys(o).length?o:void 0,portBindings:Object.keys(r).length?r:void 0};await mc.post("/docker/containers",g),this.closeCreateContainerDrawer(),this.resetCreateForm(),this.fetchContainers()}catch(e){this.createError=e instanceof uc?e.message:"Failed to create container"}finally{this.isCreating=!1}}else this.createError="Name and image are required"}renderCreateContainerDrawer(){const e=this.getImageSuggestions();return J`
      <div class="create-drawer ${this.isClosingCreateDrawer?"closing":""}">
        <div class="create-drawer-header">
          <h2 class="create-drawer-title">Create Container</h2>
          <button class="create-close-btn" @click=${this.closeCreateContainerDrawer}>â</button>
        </div>

        <div class="create-drawer-content">
          ${this.createError?J`
            <div class="error-container">
              <div class="error-icon">â ï¸</div>
              <p class="error-message">${this.createError}</p>
            </div>
          `:""}
          <div class="form-section">
            <div class="form-field">
              <label class="form-label">Name *</label>
              <input
                class="form-input"
                type="text"
                placeholder="e.g., my-container"
                .value=${this.createName}
                @input=${e=>{this.createName=e.target.value}}
              />
            </div>
            <div class="form-field">
              <label class="form-label">Image *</label>
              <container-image-autocomplete
                .value=${this.createImage}
                .suggestions=${e}
                placeholder="e.g., nginx:latest"
                ?disabled=${this.isCreating}
                @image-change=${e=>{this.createImage=e.detail.value}}
              ></container-image-autocomplete>
              <div class="form-hint">Suggestions are based on existing images. You can enter any image.</div>
            </div>
            <div class="form-field">
              <label class="form-label">Entrypoint</label>
              <input
                class="form-input"
                type="text"
                placeholder="/bin/sh -c"
                .value=${this.createEntrypoint}
                @input=${e=>{this.createEntrypoint=e.target.value}}
              />
              <div class="form-hint">Space-separated or JSON array.</div>
            </div>
            <div class="form-field">
              <label class="form-label">Command</label>
              <input
                class="form-input"
                type="text"
                placeholder="echo hello"
                .value=${this.createCmd}
                @input=${e=>{this.createCmd=e.target.value}}
              />
              <div class="form-hint">Space-separated or JSON array.</div>
            </div>
            <div class="form-field">
              <label class="form-label">Working Directory</label>
              <input
                class="form-input"
                type="text"
                placeholder="/app"
                .value=${this.createWorkingDir}
                @input=${e=>{this.createWorkingDir=e.target.value}}
              />
            </div>
          </div>

          <div class="form-section">
            <h3>Environment</h3>
            <div class="form-field">
              <label class="form-label">Environment Variables</label>
              <textarea
                class="form-textarea"
                placeholder="KEY=value"
                .value=${this.createEnv}
                @input=${e=>{this.createEnv=e.target.value}}
              ></textarea>
            </div>
            <div class="form-field">
              <label class="form-label">Labels</label>
              <textarea
                class="form-textarea"
                placeholder="key=value"
                .value=${this.createLabels}
                @input=${e=>{this.createLabels=e.target.value}}
              ></textarea>
            </div>
          </div>

          <div class="form-section">
            <h3>Ports</h3>
            ${this.createPorts.map((e,t)=>J`
              <div class="list-item">
                <input
                  class="form-input"
                  type="number"
                  min="1"
                  placeholder="Container port"
                  .value=${e.containerPort}
                  @input=${e=>{const s=[...this.createPorts],i=s[t]??{containerPort:"",hostPort:"",protocol:"tcp"};s[t]={...i,containerPort:e.target.value},this.createPorts=s}}
                />
                <input
                  class="form-input"
                  type="number"
                  min="1"
                  placeholder="Host port"
                  .value=${e.hostPort}
                  @input=${e=>{const s=[...this.createPorts],i=s[t]??{containerPort:"",hostPort:"",protocol:"tcp"};s[t]={...i,hostPort:e.target.value},this.createPorts=s}}
                />
                <select
                  class="form-select"
                  .value=${e.protocol}
                  @change=${e=>{const s=[...this.createPorts],i=s[t]??{containerPort:"",hostPort:"",protocol:"tcp"};s[t]={...i,protocol:e.target.value},this.createPorts=s}}
                >
                  <option value="tcp">tcp</option>
                  <option value="udp">udp</option>
                  <option value="sctp">sctp</option>
                </select>
                <button class="btn btn-secondary btn-small" @click=${()=>this.removePortMapping(t)}>Remove</button>
              </div>
            `)}
            <button class="btn btn-secondary btn-small" @click=${this.addPortMapping}>+ Add Port</button>
          </div>

          <div class="form-section">
            <h3>Volumes</h3>
            ${this.createVolumes.map((e,t)=>J`
              <div class="list-item">
                <input
                  class="form-input"
                  type="text"
                  placeholder="/host/path"
                  .value=${e.source}
                  @input=${e=>{const s=[...this.createVolumes],i=s[t]??{source:"",target:"",type:"bind",readOnly:!1,propagation:""};s[t]={...i,source:e.target.value},this.createVolumes=s}}
                />
                <input
                  class="form-input"
                  type="text"
                  placeholder="/container/path"
                  .value=${e.target}
                  @input=${e=>{const s=[...this.createVolumes],i=s[t]??{source:"",target:"",type:"bind",readOnly:!1,propagation:""};s[t]={...i,target:e.target.value},this.createVolumes=s}}
                />
                <select
                  class="form-select"
                  .value=${e.type}
                  @change=${e=>{const s=[...this.createVolumes],i=s[t]??{source:"",target:"",type:"bind",readOnly:!1,propagation:""};s[t]={...i,type:e.target.value},this.createVolumes=s}}
                >
                  <option value="bind">bind</option>
                  <option value="volume">volume</option>
                  <option value="tmpfs">tmpfs</option>
                </select>
                <select
                  class="form-select"
                  .value=${e.propagation}
                  @change=${e=>{const s=[...this.createVolumes],i=s[t]??{source:"",target:"",type:"bind",readOnly:!1,propagation:""};s[t]={...i,propagation:e.target.value},this.createVolumes=s}}
                >
                  <option value="">propagation</option>
                  <option value="rprivate">rprivate</option>
                  <option value="rslave">rslave</option>
                  <option value="rshared">rshared</option>
                </select>
                <label style="display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-secondary);">
                  <input
                    type="checkbox"
                    .checked=${e.readOnly}
                    @change=${e=>{const s=[...this.createVolumes],i=s[t]??{source:"",target:"",type:"bind",readOnly:!1,propagation:""};s[t]={...i,readOnly:e.target.checked},this.createVolumes=s}}
                  />
                  Read-only
                </label>
                <button class="btn btn-secondary btn-small" @click=${()=>this.removeVolumeMapping(t)}>Remove</button>
              </div>
            `)}
            <button class="btn btn-secondary btn-small" @click=${this.addVolumeMapping}>+ Add Volume</button>
          </div>

          <div class="form-section">
            <h3>Resources</h3>
            <div class="form-row">
              <div class="form-field" style="flex: 1;">
                <label class="form-label">CPU Cores</label>
                <input
                  class="form-input"
                  type="number"
                  min="0"
                  step="0.1"
                  placeholder="e.g., 1.5"
                  .value=${this.createCpuCores}
                  @input=${e=>{this.createCpuCores=e.target.value}}
                />
              </div>
              <div class="form-field" style="flex: 1;">
                <label class="form-label">Memory (MB)</label>
                <input
                  class="form-input"
                  type="number"
                  min="0"
                  step="64"
                  placeholder="e.g., 512"
                  .value=${this.createMemoryMB}
                  @input=${e=>{this.createMemoryMB=e.target.value}}
                />
              </div>
            </div>
          </div>

          <div class="form-section">
            <h3>Runtime</h3>
            <div class="form-row">
              <div class="form-field" style="flex: 1;">
                <label class="form-label">Network Mode</label>
                <input
                  class="form-input"
                  type="text"
                  placeholder="bridge"
                  .value=${this.createNetworkMode}
                  @input=${e=>{this.createNetworkMode=e.target.value}}
                />
              </div>
              <div class="form-field" style="flex: 1;">
                <label class="form-label">Restart Policy</label>
                <select
                  class="form-select"
                  .value=${this.createRestartPolicy}
                  @change=${e=>{this.createRestartPolicy=e.target.value}}
                >
                  <option value="no">no</option>
                  <option value="always">always</option>
                  <option value="on-failure">on-failure</option>
                  <option value="unless-stopped">unless-stopped</option>
                </select>
              </div>
              <div class="form-field" style="flex: 1;">
                <label class="form-label">Max Retries</label>
                <input
                  class="form-input"
                  type="number"
                  min="0"
                  placeholder="0"
                  .value=${this.createRestartMaxRetry}
                  @input=${e=>{this.createRestartMaxRetry=e.target.value}}
                />
              </div>
            </div>
          </div>
        </div>

        <div class="create-drawer-footer">
          <button class="btn btn-secondary" @click=${this.closeCreateContainerDrawer}>Cancel</button>
          <button class="btn btn-primary" ?disabled=${this.isCreating||!this.createName.trim()||!this.createImage.trim()} @click=${this.handleCreateContainer}>
            ${this.isCreating?"Creating...":"Create Container"}
          </button>
        </div>
      </div>
    `}renderContainersTable(){const e=this.containers.filter(e=>e.names.some(e=>e.toLowerCase().includes(this.searchTerm.toLowerCase())));return J`
    <div class="search-container">
      <div class="search-wrapper">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input 
          class="search-input"
          type="text" 
          placeholder="${n("containers.searchContainers")}"
          .value=${this.searchTerm}
          @input=${e=>this.searchTerm=e.target.value}
        />
      </div>
      <div class="action-menu">
        <button class="btn btn-primary" @click=${()=>this.openCreateContainerDrawer()}>+ Create Container</button>
      </div>
    </div>
      <table class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Status</th>
            <th>Image</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          ${e.map((e,t)=>{const s=e.state.toLowerCase().includes("running"),i=e.state.toLowerCase().includes("paused"),o=e.id?.substring(0,12)||"Unknown",r=e.names.join(", ");return J`
            <tr>
              <td>${o}</td>
              <td>
                <button class="link-button" @click=${()=>this.fetchContainerDetails(e.id)}>
                  ${r}
                </button>
              </td>
              <td>
                <div class="status-indicator">
                  <span class="status-icon ${this.getStatusClass(e.state)}" data-tooltip="${e.status}"></span>
                  ${e.status}
                </div>
              </td>
              <td>
                <span class="truncate" title="${e.image}">${this.truncateText(e.image,30)}</span>
              </td>
              <td>
                <div class="action-menu">
                  <button class="action-dots" @click=${e=>this.toggleActionMenu(e,`docker-container-${t}`)}>â®</button>
                  <div class="action-dropdown" id="docker-container-${t}">
                    <button @click=${()=>{this.closeAllMenus(),this.showContainerLogs(e)}}>View Logs</button>
                    <button @click=${()=>{this.closeAllMenus(),this.openContainerTerminal(e)}}>${n("terminal.title")}</button>
                    ${s?"":J`
                      <button @click=${()=>{this.closeAllMenus(),this.confirmStartContainer(e)}}>${n("containers.start")}</button>
                    `}
                    ${s&&!i?J`
                      <button @click=${()=>{this.closeAllMenus(),this.confirmStopContainer(e)}}>${n("containers.stop")}</button>
                    `:""}
                    ${i?J`
                      <button @click=${()=>{this.closeAllMenus(),this.confirmUnpauseContainer(e)}}>Unpause</button>
                    `:""}
                    ${s&&!i?J`
                      <button @click=${()=>{this.closeAllMenus(),this.confirmPauseContainer(e)}}>Pause</button>
                    `:""}
                    <button @click=${()=>{this.closeAllMenus(),this.confirmRestartContainer(e)}}>Restart</button>
                    <button class="danger" @click=${()=>{this.closeAllMenus(),this.confirmDeleteContainer(e)}}>${n("common.delete")}</button>
                  </div>
                </div>
              </td>
            </tr>
            `})}
        </tbody>
      </table>
    `}renderImagesTable(){const e=this.images.filter(e=>e.repoTags?.some(e=>e.toLowerCase().includes(this.searchTerm.toLowerCase())));return J`
    <div class="search-container">
      <div class="search-wrapper">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input 
          class="search-input"
          type="text" 
          placeholder="${n("containers.searchImages")}"
          .value=${this.searchTerm}
          @input=${e=>this.searchTerm=e.target.value}
        />
      </div>
      <div class="action-menu">
        <button class="btn btn-primary" @click=${e=>this.toggleImageActionsMenu(e)}>+ Add Image</button>
        <div class="action-dropdown ${this.showImageActionsDropdown?"show":""}">
          <button @click=${()=>{this.closeAllMenus(),this.showPullImageModal=!0}}>Pull Image</button>
          <button @click=${()=>{this.closeAllMenus(),this.showUploadImageDialog()}}>Upload Image</button>
        </div>
      </div>
    </div>
    <table class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Tags</th>
            <th>Created</th>
            <th>Size</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          ${e.map((e,t)=>{const s=e.id?.substring(0,12)||"Unknown",i=e.repoTags&&e.repoTags.length>0?e.repoTags.join(", "):"No tags",o="number"==typeof e.size?this.formatBytes(e.size):"Unknown";return J`
            <tr>
              <td>${s}</td>
              <td>${i}</td>
              <td>-</td>
              <td>${o}</td>
              <td>
                <div class="action-menu">
                  <button class="action-dots" @click=${e=>this.toggleActionMenu(e,`docker-image-${t}`)}>â®</button>
                  <div class="action-dropdown" id="docker-image-${t}">
                    <button @click=${()=>{this.closeAllMenus(),this.fetchImageDetails(e.id)}}>View Details</button>
                    <button class="danger" @click=${()=>{this.closeAllMenus(),this.confirmDeleteImage(e)}}>${n("common.delete")}</button>
                  </div>
                </div>
              </td>
            </tr>
            `})}
        </tbody>
      </table>
    `}confirmDeleteContainer(e){this.selectedContainer=e,this.confirmTitle="Confirm Delete",this.confirmMessage=`Are you sure you want to delete container ${e.names.join(", ")}?`,this.confirmAction=this.deleteSelectedContainer.bind(this),this.showConfirmModal=!0}confirmDeleteImage(e){this.selectedImage=e,this.confirmTitle="Confirm Delete";const t=e.repoTags&&e.repoTags.length>0?e.repoTags.join(", "):"Untagged image";this.confirmMessage=`Are you sure you want to delete image ${t}?`,this.confirmAction=this.deleteSelectedImage.bind(this),this.showConfirmModal=!0}async deleteSelectedContainer(){if(this.selectedContainer)try{await mc.delete(`/docker/containers/${this.selectedContainer.id}`),this.showConfirmModal=!1,this.fetchContainers(),this.selectedContainer=null}catch(e){console.error("Error deleting container:",e)}}async deleteSelectedImage(){if(this.selectedImage)try{await mc.delete(`/docker/images/${this.selectedImage.id}`),this.showConfirmModal=!1,this.fetchImages(),this.selectedImage=null}catch(e){console.error("Error deleting image:",e)}}renderVolumesTable(){const e=this.volumes.filter(e=>e.name.toLowerCase().includes(this.searchTerm.toLowerCase()));return J`
    <div class="search-container">
      <div class="search-wrapper">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input 
          class="search-input"
          type="text" 
          placeholder="${n("containers.searchVolumes")}"
          .value=${this.searchTerm}
          @input=${e=>this.searchTerm=e.target.value}
        />
      </div>
    </div>
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Driver</th>
            <th>Mount Point</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          ${e.map((e,t)=>J`
            <tr>
              <td>${e.name}</td>
              <td>${e.driver}</td>
              <td>${e.mountpoint}</td>
              <td>
                <div class="action-menu">
                  <button class="action-dots" @click=${e=>this.toggleActionMenu(e,`docker-volume-${t}`)}>â®</button>
                  <div class="action-dropdown" id="docker-volume-${t}">
                    <button class="danger" @click=${()=>{this.closeAllMenus(),this.confirmDeleteVolume(e)}}>${n("common.delete")}</button>
                  </div>
                </div>
              </td>
            </tr>
          `)}
        </tbody>
      </table>
    `}renderNetworksTable(){const e=this.networks.filter(e=>e.name.toLowerCase().includes(this.searchTerm.toLowerCase()));return J`
    <div class="search-container">
      <div class="search-wrapper">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input 
          class="search-input"
          type="text" 
          placeholder="${n("containers.searchNetworks")}"
          .value=${this.searchTerm}
          @input=${e=>this.searchTerm=e.target.value}
        />
      </div>
    </div>
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Driver</th>
            <th>Scope</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          ${e.map((e,t)=>J`
            <tr>
              <td>${e.name}</td>
              <td>${e.driver}</td>
              <td>${e.scope}</td>
              <td>
                <div class="action-menu">
                  <button class="action-dots" @click=${e=>this.toggleActionMenu(e,`docker-network-${t}`)}>â®</button>
                  <div class="action-dropdown" id="docker-network-${t}">
                    <button class="danger" @click=${()=>{this.closeAllMenus(),this.confirmDeleteNetwork(e)}}>${n("common.delete")}</button>
                  </div>
                </div>
              </td>
            </tr>
          `)}
        </tbody>
      </table>
    `}confirmDeleteVolume(e){this.confirmTitle="Confirm Delete",this.confirmMessage=`Are you sure you want to delete volume ${e.name}?`,this.confirmAction=async()=>{try{await mc.delete(`/docker/volumes/${e.name}`),this.showConfirmModal=!1,this.fetchVolumes()}catch(t){console.error("Error deleting volume:",t)}},this.showConfirmModal=!0}confirmDeleteNetwork(e){this.confirmTitle="Confirm Delete",this.confirmMessage=`Are you sure you want to delete network ${e.name}?`,this.confirmAction=async()=>{try{await mc.delete(`/docker/networks/${e.id}`),this.showConfirmModal=!1,this.fetchNetworks()}catch(t){console.error("Error deleting network:",t)}},this.showConfirmModal=!0}formatBytes(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB"][t]}toggleActionMenu(e,t){e.stopPropagation();const s=this.shadowRoot?.getElementById(t);if(s){const t=s.classList.contains("show");if(this.closeAllMenus(),!t){s.classList.add("show"),s.classList.remove("open-up");const t=e.currentTarget;requestAnimationFrame(()=>{if(t){const e=t.getBoundingClientRect(),i=s.getBoundingClientRect(),o=(window.innerHeight||document.documentElement.clientHeight)-e.bottom,r=e.top;o<i.height&&r>o&&s.classList.add("open-up")}const e=s.querySelector("button");e&&setTimeout(()=>e.focus(),10)})}}}closeAllMenus(){const e=this.shadowRoot?.querySelectorAll(".action-dropdown");e?.forEach(e=>e.classList.remove("show","open-up"))}confirmStartContainer(e){this.selectedContainer=e,this.confirmTitle="Start Container",this.confirmMessage=`Are you sure you want to start container "${e.names.join(", ")}"?`,this.confirmAction=this.startSelectedContainer.bind(this),this.showConfirmModal=!0}confirmStopContainer(e){this.selectedContainer=e,this.confirmTitle="Stop Container",this.confirmMessage=`Are you sure you want to stop container "${e.names.join(", ")}"?`,this.confirmAction=this.stopSelectedContainer.bind(this),this.showConfirmModal=!0}confirmRestartContainer(e){this.selectedContainer=e,this.confirmTitle="Restart Container",this.confirmMessage=`Are you sure you want to restart container "${e.names.join(", ")}"?`,this.confirmAction=this.restartSelectedContainer.bind(this),this.showConfirmModal=!0}confirmPauseContainer(e){this.selectedContainer=e,this.confirmTitle="Pause Container",this.confirmMessage=`Are you sure you want to pause container "${e.names.join(", ")}"?`,this.confirmAction=this.pauseSelectedContainer.bind(this),this.showConfirmModal=!0}confirmUnpauseContainer(e){this.selectedContainer=e,this.confirmTitle="Unpause Container",this.confirmMessage=`Are you sure you want to unpause container "${e.names.join(", ")}"?`,this.confirmAction=this.unpauseSelectedContainer.bind(this),this.showConfirmModal=!0}async startSelectedContainer(){if(this.selectedContainer)try{await mc.post(`/docker/containers/${this.selectedContainer.id}/start`),this.showConfirmModal=!1,this.fetchContainers(),this.selectedContainer=null}catch(e){console.error("Error starting container:",e)}}async stopSelectedContainer(){if(this.selectedContainer)try{await mc.post(`/docker/containers/${this.selectedContainer.id}/stop`),this.showConfirmModal=!1,this.fetchContainers(),this.selectedContainer=null}catch(e){console.error("Error stopping container:",e)}}async restartSelectedContainer(){if(this.selectedContainer)try{await mc.post(`/docker/containers/${this.selectedContainer.id}/restart`),this.showConfirmModal=!1,this.fetchContainers(),this.selectedContainer=null}catch(e){console.error("Error restarting container:",e)}}async pauseSelectedContainer(){if(this.selectedContainer)try{await mc.post(`/docker/containers/${this.selectedContainer.id}/pause`),this.showConfirmModal=!1,this.fetchContainers(),this.selectedContainer=null}catch(e){console.error("Error pausing container:",e)}}async unpauseSelectedContainer(){if(this.selectedContainer)try{await mc.post(`/docker/containers/${this.selectedContainer.id}/unpause`),this.showConfirmModal=!1,this.fetchContainers(),this.selectedContainer=null}catch(e){console.error("Error unpausing container:",e)}}async showContainerLogs(e){try{this.logsError=null,this.containerLogs="Loading logs...",this.showLogsDrawer=!0;const t=await mc.get(`/docker/containers/${e.id}/logs`);this.containerLogs=t.logs||"No logs available"}catch(t){console.error("Error fetching container logs:",t),this.logsError=t instanceof uc?t.message:"Failed to fetch logs"}}openContainerTerminal(e){this.terminalContainerId=e.id,this.terminalContainerName=e.names?.join(", ")||e.id,this.showTerminalModal=!0}async fetchContainerDetails(e){try{this.detailError=null;const t=await mc.get(`/docker/containers/${e}`);this.selectedContainer=t.container||t,this.selectedImage=null,this.showDrawer=!0}catch(t){console.error("Error fetching container details:",t),this.detailError=t instanceof uc?t.message:"Failed to fetch container details",this.selectedContainer=null,this.selectedImage=null,this.showDrawer=!0}}getStatusClass(e){switch(e.toLowerCase()){case"running":return"running";case"stopped":case"exited":case"created":default:return"stopped";case"paused":return"paused"}}truncateText(e,t){return e.length<=t?e:e.substring(0,t)+"..."}renderContainerDetails(){if(!this.selectedContainer)return J``;const e=this.selectedContainer;return J`
      <div class="drawer-content">
        <div class="detail-section">
          <h3>Container Details</h3>
          <div class="detail-item">
            <span class="detail-label">Name</span>
            <span class="detail-value">${e.names.join(", ")||"Unnamed"}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">ID</span>
            <span class="detail-value monospace">${e.id||"Unknown"}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Image</span>
            <span class="detail-value">${e.image||"Unknown"}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">State</span>
            <span class="detail-value">
              <span class="status-badge ${this.getStatusClass(e.state)}">${e.state}</span>
            </span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Status</span>
            <span class="detail-value">${e.status||"Unknown"}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Command</span>
            <span class="detail-value monospace">${e.command||"Unknown"}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Created</span>
            <span class="detail-value">${e.created?new Date(e.created).toLocaleString():"Unknown"}</span>
          </div>
        </div>

        ${e.labels&&Object.keys(e.labels).length>0?J`
          <div class="detail-section">
            <h3>Labels</h3>
            <div class="tag-list">
              ${Object.entries(e.labels).map(([e,t])=>J`<div class="tag">${e}: ${t}</div>`)}
            </div>
          </div>
        `:""}

        ${e.ports&&e.ports.length>0?J`
          <div class="detail-section">
            <h3>Ports</h3>
            ${e.ports.map(e=>J`
              <div class="detail-item">
                <span class="detail-value">${e.privatePort}${e.publicPort?` â ${e.publicPort}`:""} (${e.type})</span>
              </div>
            `)}
          </div>
        `:""}
      </div>
    `}renderImageDetails(){if(!this.selectedImage)return J``;const e=this.selectedImage,t=e.id?.replace("sha256:","").substring(0,12)||"Unknown",s=e.id||"Unknown",i=e.repoTags&&e.repoTags.length>0&&"<none>:<none>"!==e.repoTags[0]?e.repoTags:[],o=e.repoDigests&&e.repoDigests.length>0?e.repoDigests:[],r="number"==typeof e.size?this.formatBytes(e.size):"Unknown",a=e.created?new Date(e.created).toLocaleString():"Unknown";return J`
      <div class="drawer-content">
        <div class="detail-section">
          <h3>Image Details</h3>
          <div class="detail-item">
            <span class="detail-label">Short ID</span>
            <span class="detail-value monospace">${t}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Full ID</span>
            <span class="detail-value monospace" style="word-break: break-all;">${s}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Size</span>
            <span class="detail-value">${r}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Created</span>
            <span class="detail-value">${a}</span>
          </div>
        </div>

        ${i.length>0?J`
          <div class="detail-section">
            <h3>Tags</h3>
            <div class="tag-list">
              ${i.map(e=>J`<div class="tag">${e}</div>`)}
            </div>
          </div>
        `:J`
          <div class="detail-section">
            <h3>Tags</h3>
            <p style="color: var(--text-secondary); font-style: italic;">No tags</p>
          </div>
        `}

        ${o.length>0?J`
          <div class="detail-section">
            <h3>Digests</h3>
            ${o.map(e=>J`
              <div class="detail-item">
                <span class="detail-value monospace" style="word-break: break-all; font-size: 0.75rem;">${e}</span>
              </div>
            `)}
          </div>
        `:""}

        ${e.labels&&Object.keys(e.labels).length>0?J`
          <div class="detail-section">
            <h3>Labels</h3>
            <div class="tag-list">
              ${Object.entries(e.labels).map(([e,t])=>J`<div class="tag">${e}: ${t}</div>`)}
            </div>
          </div>
        `:""}
      </div>
    `}highlightSearchTerm(e,t){if(!t||!e)return e;const s=new RegExp(`(${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return e.replace(s,'<mark style="background-color: #ffeb3b; color: #000; padding: 0 2px;">$1</mark>')}renderError(){return J`
      <div class="error-container">
        <div class="error-icon">â ï¸</div>
        <p class="error-message">${this.detailError}</p>
      </div>
    `}toggleImageActionsMenu(e){e.stopPropagation(),this.showImageActionsDropdown=!this.showImageActionsDropdown}showUploadImageDialog(){this.showUploadDrawer=!0}fetchImageDetails(e){this.detailError=null;const t=this.images.find(t=>t.id===e);t?(this.selectedImage=t,this.selectedContainer=null,this.showDrawer=!0):(this.detailError="Image not found",this.selectedContainer=null,this.selectedImage=null,this.showDrawer=!0)}addToUploadQueue(e){const t={id:Bd(),file:e,progress:0,status:"pending"};this.uploadQueue=[...this.uploadQueue,t]}removeFromUploadQueue(e){this.uploadQueue=this.uploadQueue.filter(t=>t.id!==e)}async startUpload(){const e=this.uploadQueue.filter(e=>"pending"===e.status);if(0!==e.length){this.isUploading=!0;for(const t of e)await this.uploadFile(t);this.isUploading=!1}}async uploadFile(t){return new Promise((s,i)=>{this.updateUploadItem(t.id,{status:"uploading",progress:0});const o=e("/docker/images/upload");this.currentUpload=new Nu(t.file,{endpoint:o,chunkSize:4194304,retryDelays:[0,1e3,3e3,5e3],metadata:{filename:t.file.name,filetype:t.file.type||"application/octet-stream"},headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")||localStorage.getItem("auth_token")}`},onError:e=>{console.error("TUS upload error:",e),this.updateUploadItem(t.id,{status:"error",error:e.message||"Upload failed"}),this.currentUpload=null,i(e)},onProgress:(e,s)=>{const i=Math.round(e/s*100);this.updateUploadItem(t.id,{progress:i})},onSuccess:async()=>{try{const e=this.currentUpload?.url;if(e){const t=e.split("/").pop();t&&await mc.post(`/docker/images/upload/${t}/complete`,{})}this.updateUploadItem(t.id,{status:"completed",progress:100}),this.fetchImages(),this.currentUpload=null,s()}catch(e){console.error("Failed to complete upload:",e),this.updateUploadItem(t.id,{status:"error",error:"Failed to complete upload"}),this.currentUpload=null,i(e)}}}),this.currentUpload.start()})}updateUploadItem(e,t){this.uploadQueue=this.uploadQueue.map(s=>s.id===e?{...s,...t}:s)}clearCompletedUploads(){this.uploadQueue=this.uploadQueue.filter(e=>"completed"!==e.status&&"error"!==e.status)}formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}async handlePullImage(){if(this.imageName.trim()&&!this.isPullingImage){this.isPullingImage=!0;try{await mc.post("/docker/images/pull",{image:this.imageName.trim()}),this.showPullImageModal=!1,this.imageName="",this.fetchImages()}catch(e){console.error("Error pulling image:",e)}finally{this.isPullingImage=!1}}}}Ip([xe()],Tp.prototype,"activeTab"),Ip([xe()],Tp.prototype,"containers"),Ip([xe()],Tp.prototype,"images"),Ip([xe()],Tp.prototype,"volumes"),Ip([xe()],Tp.prototype,"networks"),Ip([xe()],Tp.prototype,"searchTerm"),Ip([xe()],Tp.prototype,"error"),Ip([xe()],Tp.prototype,"showConfirmModal"),Ip([xe()],Tp.prototype,"confirmAction"),Ip([xe()],Tp.prototype,"selectedContainer"),Ip([xe()],Tp.prototype,"selectedImage"),Ip([xe()],Tp.prototype,"showDrawer"),Ip([xe()],Tp.prototype,"detailError"),Ip([xe()],Tp.prototype,"confirmTitle"),Ip([xe()],Tp.prototype,"confirmMessage"),Ip([xe()],Tp.prototype,"showLogsDrawer"),Ip([xe()],Tp.prototype,"containerLogs"),Ip([xe()],Tp.prototype,"logsError"),Ip([xe()],Tp.prototype,"logsSearchTerm"),Ip([xe()],Tp.prototype,"showTerminalModal"),Ip([xe()],Tp.prototype,"terminalContainerId"),Ip([xe()],Tp.prototype,"terminalContainerName"),Ip([xe()],Tp.prototype,"showImageActionsDropdown"),Ip([xe()],Tp.prototype,"showPullImageModal"),Ip([xe()],Tp.prototype,"imageName"),Ip([xe()],Tp.prototype,"isPullingImage"),Ip([xe()],Tp.prototype,"showUploadDrawer"),Ip([xe()],Tp.prototype,"uploadQueue"),Ip([xe()],Tp.prototype,"isUploading"),Ip([xe()],Tp.prototype,"showCreateDrawer"),Ip([xe()],Tp.prototype,"isClosingCreateDrawer"),Ip([xe()],Tp.prototype,"createError"),Ip([xe()],Tp.prototype,"isCreating"),Ip([xe()],Tp.prototype,"createName"),Ip([xe()],Tp.prototype,"createImage"),Ip([xe()],Tp.prototype,"createEntrypoint"),Ip([xe()],Tp.prototype,"createCmd"),Ip([xe()],Tp.prototype,"createEnv"),Ip([xe()],Tp.prototype,"createLabels"),Ip([xe()],Tp.prototype,"createWorkingDir"),Ip([xe()],Tp.prototype,"createNetworkMode"),Ip([xe()],Tp.prototype,"createRestartPolicy"),Ip([xe()],Tp.prototype,"createRestartMaxRetry"),Ip([xe()],Tp.prototype,"createCpuCores"),Ip([xe()],Tp.prototype,"createMemoryMB"),Ip([xe()],Tp.prototype,"createPorts"),Ip([xe()],Tp.prototype,"createVolumes"),customElements.define("docker-tab",Tp);const Pp=Ud(class extends Vd{constructor(){super(...arguments),this.key=X}render(e,t){return this.key=e,t}update(e,[t,s]){return t!==this.key&&(np(e),this.key=t),s}});class Lp{static async getNamespaces(){return(await pc.get("/kubernetes/namespaces")).namespaces||[]}static async getPods(e){const t=e&&"all"!==e?`/kubernetes/pods/${e}`:"/kubernetes/pods";return(await pc.get(t)).pods||[]}static async getDeployments(e){const t=e&&"all"!==e?`/kubernetes/deployments/${e}`:"/kubernetes/deployments";return(await pc.get(t)).deployments||[]}static async getStatefulSets(e){const t=e&&"all"!==e?`/kubernetes/statefulsets/${e}`:"/kubernetes/statefulsets";return(await pc.get(t)).statefulsets||[]}static async getDaemonSets(e){const t=e&&"all"!==e?`/kubernetes/daemonsets/${e}`:"/kubernetes/daemonsets";return(await pc.get(t)).daemonsets||[]}static async getJobs(e){const t=e&&"all"!==e?`/kubernetes/jobs/${e}`:"/kubernetes/jobs";return(await pc.get(t)).jobs||[]}static async getCronJobs(e){const t=e&&"all"!==e?`/kubernetes/cronjobs/${e}`:"/kubernetes/cronjobs";return(await pc.get(t)).cronjobs||[]}static async getServices(e){const t=e&&"all"!==e?`/kubernetes/services/${e}`:"/kubernetes/services";return(await pc.get(t)).services||[]}static async getIngresses(e){const t=e&&"all"!==e?`/kubernetes/ingresses/${e}`:"/kubernetes/ingresses";return(await pc.get(t)).ingresses||[]}static async getIngressClasses(){return(await pc.get("/kubernetes/ingressclasses")).ingressClasses||[]}static async getNetworkPolicies(e){const t=e&&"all"!==e?`/kubernetes/networkpolicies/${e}`:"/kubernetes/networkpolicies";return(await pc.get(t)).networkPolicies||[]}static async getCRDs(){return(await pc.get("/kubernetes/customresourcedefinitions")).crds||[]}static async getPersistentVolumes(){return(await pc.get("/kubernetes/persistentvolumes")).pvs||[]}static async getPersistentVolumeClaims(e){const t=e&&"all"!==e?`/kubernetes/persistentvolumeclaims/${e}`:"/kubernetes/persistentvolumeclaims";return(await pc.get(t)).pvcs||[]}static async getConfigMaps(e){const t=e&&"all"!==e?`/kubernetes/configmaps/${e}`:"/kubernetes/configmaps";return(await pc.get(t)).configmaps||[]}static async getSecrets(e){const t=e&&"all"!==e?`/kubernetes/secrets/${e}`:"/kubernetes/secrets";return(await pc.get(t)).secrets||[]}static async getNodes(){return(await pc.get("/kubernetes/nodes")).nodes||[]}static async getNodeDetails(e){return pc.get(`/kubernetes/nodes/${e}`)}static async getCustomResources(e,t,s){const i={apiVersion:e,kind:t};s&&"all"!==s&&(i.namespace=s);return(await pc.get("/kubernetes/customresources",i)).items||[]}static async getHelmReleases(e){const t=e&&"all"!==e?`/kubernetes/helm/releases/${e}`:"/kubernetes/helm/releases";return(await pc.get(t)).items||[]}static async getResourceRaw(t,s,i,o="json"){const r=this.getResourceEndpoint(t,s,i),a="yaml"===o?"application/yaml":"application/json",n=tt(),l=e(r),c=await fetch(l,{method:"GET",headers:{Accept:a,...n}});if(!c.ok)throw new Error(`Failed to fetch resource: ${c.statusText}`);return c.text()}static getResourceEndpoint(e,t,s){switch(e.toLowerCase()){case"pod":return`/kubernetes/pods/${s}/${t}`;case"deployment":return`/kubernetes/deployments/${s}/${t}`;case"statefulset":return`/kubernetes/statefulsets/${s}/${t}`;case"daemonset":return`/kubernetes/daemonsets/${s}/${t}`;case"job":return`/kubernetes/jobs/${s}/${t}`;case"cronjob":return`/kubernetes/cronjobs/${s}/${t}`;case"service":return`/kubernetes/services/${s}/${t}`;case"ingress":return`/kubernetes/ingresses/${s}/${t}`;case"ingressclass":return`/kubernetes/ingressclasses/${t}`;case"networkpolicy":return`/kubernetes/networkpolicies/${s}/${t}`;case"crd":case"customresourcedefinition":return`/kubernetes/customresourcedefinitions/${t}`;case"persistentvolumeclaim":case"pvc":return`/kubernetes/persistentvolumeclaims/${s}/${t}`;case"persistentvolume":case"pv":return`/kubernetes/persistentvolumes/${t}`;case"configmap":return`/kubernetes/configmaps/${s}/${t}`;case"secret":return`/kubernetes/secrets/${s}/${t}`;default:throw new Error(`Unsupported resource kind: ${e}`)}}static async getResourceDetails(e,t,s){switch(e.toLowerCase()){case"pod":return this.getPodDetails(s,t);case"deployment":return this.getDeploymentDetails(s,t);case"statefulset":return this.getStatefulSetDetails(s,t);case"daemonset":return this.getDaemonSetDetails(s,t);case"job":return this.getJobDetails(s,t);case"cronjob":return this.getCronJobDetails(s,t);case"service":return this.getServiceDetails(s,t);case"ingress":return this.getIngressDetails(s,t);case"ingressclass":return this.getIngressClassDetails(t);case"networkpolicy":return this.getNetworkPolicyDetails(s,t);case"crd":case"customresourcedefinition":return this.getCRDDetails(t);case"persistentvolumeclaim":case"pvc":return this.getPVCDetails(s,t);case"persistentvolume":case"pv":return this.getPVDetails(t);case"configmap":return this.getConfigMapDetails(s,t);case"secret":return this.getSecretDetails(s,t);default:throw new Error(`Unsupported resource kind: ${e}`)}}static async getPodDetails(e,t){const s=await pc.get(`/kubernetes/pods/${e}/${t}`);return s.pod_detail||s}static async getDeploymentDetails(e,t){const s=await pc.get(`/kubernetes/deployments/${e}/${t}`);return s.deployment_detail||s}static async getServiceDetails(e,t){const s=await pc.get(`/kubernetes/services/${e}/${t}`);return s.service_detail||s}static async getStatefulSetDetails(e,t){const s=await pc.get(`/kubernetes/statefulsets/${e}/${t}`);return s.statefulset_detail||s}static async getDaemonSetDetails(e,t){const s=await pc.get(`/kubernetes/daemonsets/${e}/${t}`);return s.daemonset_detail||s}static async getJobDetails(e,t){const s=await pc.get(`/kubernetes/jobs/${e}/${t}`);return s.job_detail||s}static async getCronJobDetails(e,t){const s=await pc.get(`/kubernetes/cronjobs/${e}/${t}`);return s.cronjob_detail||s}static async getIngressDetails(e,t){const s=await pc.get(`/kubernetes/ingresses/${e}/${t}`);return s.ingress_detail||s}static async getIngressClassDetails(e){const t=await pc.get(`/kubernetes/ingressclasses/${e}`);return t.ingressclass_detail||t}static async getNetworkPolicyDetails(e,t){const s=await pc.get(`/kubernetes/networkpolicies/${e}/${t}`);return s.networkpolicy_detail||s}static async getCRDDetails(e){const t=await pc.get(`/kubernetes/customresourcedefinitions/${e}`);return t.crd_detail||t.crd||t}static async getPVCDetails(e,t){const s=await pc.get(`/kubernetes/persistentvolumeclaims/${e}/${t}`);return s.pvc_detail||s}static async getPVDetails(e){const t=await pc.get(`/kubernetes/persistentvolumes/${e}`);return t.pv_detail||t}static async getConfigMapDetails(e,t){const s=await pc.get(`/kubernetes/configmaps/${e}/${t}`);return s.configmap_detail||s}static async getSecretDetails(e,t){const s=await pc.get(`/kubernetes/secrets/${e}/${t}`);return s.secret_detail||s}static async restartDeployment(e,t){await pc.patch(`/kubernetes/deployments/${e}/${t}/rollout/restart`,{})}static async rollbackDeployment(e,t){await pc.patch(`/kubernetes/deployments/${e}/${t}/rollout/undo`,{})}static async setDeploymentImages(e,t,s){await pc.patch(`/kubernetes/deployments/${e}/${t}/rollout/images`,s)}static async getDeploymentContainers(e,t){const s=await this.getDeploymentDetails(e,t),i=[];if(s.spec?.template?.spec?.containers)for(const o of s.spec.template.spec.containers)i.push({name:o.name,image:o.image});return i}static async restartStatefulSet(e,t){await pc.patch(`/kubernetes/statefulsets/${e}/${t}/rollout/restart`,{})}static async rollbackStatefulSet(e,t){await pc.patch(`/kubernetes/statefulsets/${e}/${t}/rollout/undo`,{})}static async setStatefulSetImages(e,t,s){await pc.patch(`/kubernetes/statefulsets/${e}/${t}/rollout/images`,s)}static async getStatefulSetContainers(e,t){const s=await this.getStatefulSetDetails(e,t),i=[];if(s.spec?.template?.spec?.containers)for(const o of s.spec.template.spec.containers)i.push({name:o.name,image:o.image});return i}static async restartDaemonSet(e,t){await pc.patch(`/kubernetes/daemonsets/${e}/${t}/rollout/restart`,{})}static async rollbackDaemonSet(e,t){await pc.patch(`/kubernetes/daemonsets/${e}/${t}/rollout/undo`,{})}static async setDaemonSetImages(e,t,s){await pc.patch(`/kubernetes/daemonsets/${e}/${t}/rollout/images`,s)}static async getDaemonSetContainers(e,t){const s=await this.getDaemonSetDetails(e,t),i=[];if(s.spec?.template?.spec?.containers)for(const o of s.spec.template.spec.containers)i.push({name:o.name,image:o.image});return i}static async setPodImages(e,t,s){await pc.patch(`/kubernetes/pods/${e}/${t}/images`,s)}static async getPodContainers(e,t){const s=await this.getPodDetails(e,t),i=[];if(s.spec?.containers)for(const o of s.spec.containers)i.push({name:o.name,image:o.image});return i}static async deleteResource(e,t,s){let i;switch(e.toLowerCase()){case"pod":i=`/kubernetes/pods/${s}/${t}`;break;case"deployment":i=`/kubernetes/deployments/${s}/${t}`;break;case"statefulset":i=`/kubernetes/statefulsets/${s}/${t}`;break;case"daemonset":i=`/kubernetes/daemonsets/${s}/${t}`;break;case"job":i=`/kubernetes/jobs/${s}/${t}`;break;case"cronjob":i=`/kubernetes/cronjobs/${s}/${t}`;break;case"service":i=`/kubernetes/services/${s}/${t}`;break;case"ingress":i=`/kubernetes/ingresses/${s}/${t}`;break;case"ingressclass":i=`/kubernetes/ingressclasses/${t}`;break;case"networkpolicy":i=`/kubernetes/networkpolicies/${s}/${t}`;break;case"crd":case"customresourcedefinition":i=`/kubernetes/customresourcedefinitions/${t}`;break;case"persistentvolumeclaim":case"pvc":i=`/kubernetes/pvcs/${s}/${t}`;break;case"persistentvolume":case"pv":i=`/kubernetes/pvs/${t}`;break;case"configmap":i=`/kubernetes/configmaps/${s}/${t}`;break;case"secret":i=`/kubernetes/secrets/${s}/${t}`;break;default:throw new Error(`Unsupported resource kind for deletion: ${e}`)}await pc.delete(i)}static async createResource(e,t="yaml"){const s="json"===t?"application/json":"application/yaml";let i;try{if("json"===t)i=JSON.parse(e);else{i=(await import("./index-Cy0ZAiDr.js")).parse(e)}}catch(a){throw new Error(`Failed to parse ${t.toUpperCase()}: ${a}`)}const o=i?.kind?.toLowerCase();if(!o)throw new Error("Resource kind is required");let r;switch(o){case"pod":r="/kubernetes/pods";break;case"deployment":r="/kubernetes/deployments";break;case"statefulset":r="/kubernetes/statefulsets";break;case"daemonset":r="/kubernetes/daemonsets";break;case"job":r="/kubernetes/jobs";break;case"cronjob":r="/kubernetes/cronjobs";break;case"customresourcedefinition":case"crd":r="/kubernetes/customresourcedefinitions";break;case"service":r="/kubernetes/services";break;case"ingress":r="/kubernetes/ingresses";break;case"persistentvolumeclaim":case"pvc":r="/kubernetes/pvcs";break;case"persistentvolume":case"pv":r="/kubernetes/pvs";break;case"namespace":r="/kubernetes/namespaces";break;case"networkpolicy":r="/kubernetes/networkpolicies";break;case"ingressclass":r="/kubernetes/ingressclasses";break;default:throw new Error(`Creating ${o} resources is not supported. Supported types: Pod, Deployment, StatefulSet, DaemonSet, Job, CronJob, CRD, Service, Ingress, PVC, PV, Namespace, NetworkPolicy, IngressClass.`)}return pc.postResource(r,e,s)}static async updateResource(e,t,s,i,o="yaml"){const r=this.getResourceEndpoint(e,t,s),a="json"===o?"application/json":"application/yaml";return pc.putResource(r,i,a)}static async getPodLogs(e,t,s,i=!1,o=100){const r={follow:i,lines:o};s&&(r.container=s);return(await pc.get(`/kubernetes/pods/${t}/${e}/logs`,r)).logs||""}static async execPod(e,t,s,i){return pc.post(`/kubernetes/pods/${t}/${e}/exec`,{container:s,command:i})}static async getCRDInstances(e){const t=await pc.get(`/kubernetes/customresourcedefinitions/${e}/instances`);if(Array.isArray(t))return t;if(t&&"object"==typeof t){if(Array.isArray(t.instances))return t.instances;if(Array.isArray(t.items))return t.items;if(Array.isArray(t.resources))return t.resources}return[]}static async getCRDInstanceDetails(e,t,s){const i=s?`/kubernetes/customresourcedefinitions/${e}/instances/${s}/${t}`:`/kubernetes/customresourcedefinitions/${e}/instances/-/${t}`,o=await pc.get(i);return o.instance||o}static async deleteCRDInstance(e,t,s){const i=s?`/kubernetes/customresourcedefinitions/${e}/instances/${s}/${t}`:`/kubernetes/customresourcedefinitions/${e}/instances/-/${t}`;await pc.delete(i)}}var Rp=Object.defineProperty,Op=Object.getOwnPropertyDescriptor,Np=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Op(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Rp(t,s,r),r};let Bp=class extends me{constructor(){super(...arguments),this.value="",this.placeholder="Search...",this.width=250,this.disabled=!1}handleInput(e){const t=e.target;this.value=t.value,this.dispatchEvent(new CustomEvent("search-change",{detail:{value:this.value},bubbles:!0,composed:!0}))}render(){return J`
      <div class="search-wrapper">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input 
          class="search-input"
          type="text" 
          placeholder="${this.placeholder}"
          .value="${this.value}"
          ?disabled="${this.disabled}"
          @input="${this.handleInput}"
          style="width: ${this.width}px"
        />
      </div>
    `}};Bp.styles=g`
    .search-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      max-width: 400px;
    }

    .search-icon {
      position: absolute;
      left: 12px;
      color: var(--vscode-input-placeholderForeground, #999);
      pointer-events: none;
      width: 16px;
      height: 16px;
    }

    .search-input {
      padding: 6px 12px 6px 32px;
      border: 1px solid var(--vscode-widget-border, var(--vscode-input-border, var(--vscode-panel-border, #454545)));
      border-radius: 4px;
      background-color: var(--vscode-input-background);
      color: var(--vscode-input-foreground);
      font-size: 0.875rem;
      transition: all 0.2s;
      outline: none;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.08);
    }

    .search-input:hover:not(:disabled) {
      border-color: var(--vscode-inputOption-hoverBorder, var(--vscode-widget-border, #858585));
    }

    .search-input:focus {
      border-color: var(--vscode-focusBorder, #007acc);
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1), 0 0 0 1px var(--vscode-focusBorder, #007acc);
    }

    .search-input::placeholder {
      color: var(--vscode-input-placeholderForeground, #999);
      opacity: 0.7;
    }

    .search-input:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  `,Np([we({type:String})],Bp.prototype,"value",2),Np([we({type:String})],Bp.prototype,"placeholder",2),Np([we({type:Number})],Bp.prototype,"width",2),Np([we({type:Boolean})],Bp.prototype,"disabled",2),Bp=Np([ve("search-input")],Bp);var Fp=Object.defineProperty,zp=Object.getOwnPropertyDescriptor,Up=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?zp(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Fp(t,s,r),r};let Vp=class extends me{constructor(){super(...arguments),this.message="No data available",this.title="",this.description="",this.icon="ð­",this.actionLabel=""}handleAction(){this.dispatchEvent(new CustomEvent("action-click",{bubbles:!0,composed:!0}))}render(){const e=this.title||this.message,t=this.description;return J`
      <div class="empty-state">
        <div class="icon">${this.icon}</div>
        <div class="title">${e}</div>
        ${t?J`<div class="description">${t}</div>`:""}
        ${this.actionLabel?J`
              <div class="action">
                <button @click="${this.handleAction}">${this.actionLabel}</button>
              </div>
            `:""}
      </div>
    `}};Vp.styles=g`
    :host {
      display: block;
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }

    .icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-primary, var(--vscode-foreground));
    }

    .description {
      font-size: 0.9rem;
      margin-bottom: 1rem;
      color: var(--text-secondary);
      white-space: pre-wrap;
    }

    .action {
      margin-top: 1rem;
    }

    .action button {
      padding: 8px 16px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .action button:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }
  `,Up([we({type:String})],Vp.prototype,"message",2),Up([we({type:String})],Vp.prototype,"title",2),Up([we({type:String})],Vp.prototype,"description",2),Up([we({type:String})],Vp.prototype,"icon",2),Up([we({type:String})],Vp.prototype,"actionLabel",2),Vp=Up([ve("empty-state")],Vp);var jp=Object.defineProperty,Hp=Object.getOwnPropertyDescriptor,Wp=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Hp(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&jp(t,s,r),r};let qp=class extends me{constructor(){super(...arguments),this.message="Loading..."}render(){return J`
      <div class="loading-state">
        <div class="spinner"></div>
        <div>${this.message}</div>
      </div>
    `}};qp.styles=g`
    .loading-state {
      text-align: center;
      padding: 20px;
      color: var(--vscode-text);
      font-style: italic;
    }

    .spinner {
      display: inline-block;
      width: 24px;
      height: 24px;
      margin-bottom: 12px;
    }

    .spinner::after {
      content: ' ';
      display: block;
      width: 20px;
      height: 20px;
      margin: 2px;
      border-radius: 50%;
      border: 2px solid var(--vscode-focusBorder, #007acc);
      border-color: var(--vscode-focusBorder, #007acc) transparent var(--vscode-focusBorder, #007acc) transparent;
      animation: spinner 1.2s linear infinite;
    }

    @keyframes spinner {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
  `,Wp([we({type:String})],qp.prototype,"message",2),qp=Wp([ve("loading-state")],qp);var Kp=Object.defineProperty,Gp=Object.getOwnPropertyDescriptor,Qp=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Gp(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Kp(t,s,r),r};let Jp=class extends me{constructor(){super(...arguments),this.namespaces=[],this.selectedNamespace="default",this.loading=!1,this.placeholder="Select namespace",this.showCounts=!1,this.includeAllOption=!0,this.isOpen=!1,this.searchQuery="",this.handleClickOutside=e=>{this.contains(e.target)||this.closeDropdown()}}render(){const e=this.getFilteredNamespaces();return J`
      <div class="dropdown" part="dropdown">
        <button
          class="dropdown-toggle ${this.isOpen?"open":""}"
          part="toggle"
          @click=${this.toggleDropdown}
          aria-expanded=${this.isOpen}
          aria-haspopup="listbox"
        >
          <span class="dropdown-label">${this.selectedNamespace}</span>
          <svg class="dropdown-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M4 6l4 4 4-4z"/>
          </svg>
        </button>

        ${this.isOpen?J`
          <div class="dropdown-menu" part="menu" @click=${e=>e.stopPropagation()}>
            <div class="search-container">
              <input
                type="text"
                class="search-input"
                part="search"
                placeholder="Search namespaces..."
                .value=${this.searchQuery}
                @input=${this.handleSearch}
                @keydown=${this.handleKeydown}
              />
            </div>

            <div class="options-container">
              ${this.loading?J`
                <div class="loading">Loading namespaces...</div>
              `:0===e.length?J`
                <div class="no-results">No namespaces found</div>
              `:J`
                ${this.includeAllOption?J`
                  <div
                    class="namespace-option ${"All Namespaces"===this.selectedNamespace?"selected":""}"
                    part="option ${"All Namespaces"===this.selectedNamespace?"option-selected":""}"
                    @click=${()=>this.selectNamespace("All Namespaces")}
                    role="option"
                    aria-selected=${"All Namespaces"===this.selectedNamespace}
                  >
                    <svg class="namespace-icon" viewBox="0 0 16 16" fill="currentColor">
                      <path d="M8 1a7 7 0 100 14A7 7 0 008 1zM3 8a5 5 0 119.9.3H9v-1h3.8A5 5 0 0111 4.2V8h-1V4.2A5 5 0 018 3a5 5 0 00-5 5z"/>
                    </svg>
                    <span>All Namespaces</span>
                  </div>
                `:""}
                ${e.map(e=>J`
                  <div
                    class="namespace-option ${this.selectedNamespace===e.name?"selected":""}"
                    part="option ${this.selectedNamespace===e.name?"option-selected":""}"
                    @click=${()=>this.selectNamespace(e.name)}
                    role="option"
                    aria-selected=${this.selectedNamespace===e.name}
                  >
                    <svg class="namespace-icon" viewBox="0 0 16 16" fill="currentColor">
                      <path d="M2 2h12v12H2z" opacity="0.3"/>
                      <path d="M4 4h8v8H4z"/>
                    </svg>
                    <span>${e.name}</span>
                    ${this.showCounts&&void 0!==e.count?J`
                      <span class="namespace-count">${e.count}</span>
                    `:""}
                  </div>
                `)}
              `}
            </div>
          </div>
        `:""}
      </div>
    `}getFilteredNamespaces(){if(!this.searchQuery)return this.namespaces;const e=this.searchQuery.toLowerCase();return this.namespaces.filter(t=>t.name.toLowerCase().includes(e))}toggleDropdown(e){e.stopPropagation(),this.isOpen=!this.isOpen,this.isOpen?setTimeout(()=>{document.addEventListener("click",this.handleClickOutside)},0):document.removeEventListener("click",this.handleClickOutside)}closeDropdown(){this.isOpen=!1,this.searchQuery="",document.removeEventListener("click",this.handleClickOutside)}handleSearch(e){const t=e.target;this.searchQuery=t.value}handleKeydown(e){"Escape"===e.key&&this.closeDropdown()}selectNamespace(e){this.selectedNamespace!==e&&(this.selectedNamespace=e,this.dispatchEvent(new CustomEvent("namespace-change",{detail:{namespace:e},bubbles:!0,composed:!0}))),this.closeDropdown()}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("click",this.handleClickOutside)}};Jp.styles=g`
    :host {
      display: inline-block;
      position: relative;
    }

    .dropdown {
      position: relative;
    }

    .dropdown-toggle {
      background: var(--vscode-button-secondaryBackground, var(--vscode-bg-lighter, #eff1f3));
      color: var(--vscode-button-secondaryForeground, var(--vscode-foreground, #3b3b3b));
      border: 1px solid var(--vscode-button-border, var(--vscode-border, #cecece));
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 200px;
      font-size: 14px;
      transition: all 0.2s;
    }

    .dropdown-toggle:hover {
      background: var(--vscode-button-secondaryHoverBackground, var(--vscode-bg, #e5e5e5));
      border-color: var(--vscode-button-border, var(--vscode-border, #cecece));
    }

    .dropdown-toggle.open {
      background: var(--vscode-button-secondaryBackground, var(--vscode-bg-lighter, #eff1f3));
      color: var(--vscode-button-secondaryForeground, var(--vscode-foreground, #3b3b3b));
      border-color: var(--vscode-focusBorder, #007acc);
    }

    .dropdown-label {
      flex: 1;
      text-align: left;
    }

    .dropdown-icon {
      transition: transform 0.2s;
    }

    .dropdown-toggle.open .dropdown-icon {
      transform: rotate(180deg);
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      margin-top: 4px;
      margin-top: 4px;
      background: var(--vscode-dropdown-background, var(--vscode-editor-background, #ffffff));
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
      z-index: 1000;
      max-height: 400px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .search-container {
      padding: 12px;
      border-bottom: 1px solid var(--menu-border, #3a3d4a);
    }

    .search-input {
      width: 100%;
      padding: 6px 8px;
      background: var(--vscode-input-background, #ffffff);
      color: var(--vscode-input-foreground, #3b3b3b);
      border: 1px solid var(--vscode-input-border, #cecece);
      border-radius: 4px;
      font-size: 13px;
      outline: none;
    }

    .search-input:focus {
      border-color: var(--input-focus-border, var(--vscode-focusBorder, #007acc));
    }

    .search-input::placeholder {
      color: var(--input-placeholder, #999);
    }

    .options-container {
      overflow-y: auto;
      max-height: 300px;
    }

    .namespace-option {
      padding: 10px 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background-color 0.2s;
      font-size: 14px;
    }

    .namespace-option:hover {
      background: var(--vscode-list-hoverBackground, rgba(0, 0, 0, 0.04));
    }

    .namespace-option.selected {
      background: var(--vscode-list-activeSelectionBackground, #007acc);
      color: var(--vscode-list-activeSelectionForeground, #ffffff);
    }

    .namespace-icon {
      width: 16px;
      height: 16px;
      opacity: 0.8;
    }

    .namespace-count {
      margin-left: auto;
      font-size: 12px;
      opacity: 0.7;
      background: var(--count-bg, rgba(255, 255, 255, 0.1));
      padding: 2px 8px;
      border-radius: 12px;
    }

    .no-results {
      padding: 20px;
      text-align: center;
      color: var(--no-results-color, #999);
      font-size: 14px;
    }

    .loading {
      padding: 20px;
      text-align: center;
      color: var(--loading-color, #999);
    }

    /* Scrollbar styling */
    .options-container::-webkit-scrollbar {
      width: 8px;
    }

    .options-container::-webkit-scrollbar-track {
      background: var(--scrollbar-track, #1a1d23);
    }

    .options-container::-webkit-scrollbar-thumb {
      background: var(--scrollbar-thumb, #4a4d5a);
      border-radius: 4px;
    }

    .options-container::-webkit-scrollbar-thumb:hover {
      background: var(--scrollbar-thumb-hover, #5a5d6a);
    }
  `,Qp([we({type:Array})],Jp.prototype,"namespaces",2),Qp([we({type:String})],Jp.prototype,"selectedNamespace",2),Qp([we({type:Boolean})],Jp.prototype,"loading",2),Qp([we({type:String})],Jp.prototype,"placeholder",2),Qp([we({type:Boolean})],Jp.prototype,"showCounts",2),Qp([we({type:Boolean})],Jp.prototype,"includeAllOption",2),Qp([xe()],Jp.prototype,"isOpen",2),Qp([xe()],Jp.prototype,"searchQuery",2),Jp=Qp([ve("namespace-dropdown")],Jp);var Yp=Object.defineProperty,Xp=Object.getOwnPropertyDescriptor,Zp=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Xp(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Yp(t,s,r),r};let eg=class extends me{constructor(){super(...arguments),this.tabs=[],this.activeTab=""}handleTabClick(e){this.activeTab=e.id,this.dispatchEvent(new CustomEvent("tab-change",{detail:{tabId:e.id},bubbles:!0,composed:!0}))}render(){return J`
      <div class="tab-header">
        ${this.tabs.map(e=>J`
          <button 
            class="tab-button ${this.activeTab===e.id?"active":""}"
            @click=${()=>this.handleTabClick(e)}
          >
            ${e.icon?J`<span class="tab-icon">${e.icon}</span>`:""}
            ${e.label}
          </button>
        `)}
      </div>
    `}};eg.styles=g`
    .tab-header {
      display: flex;
      border-bottom: 2px solid var(--border-color);
      margin-bottom: 1rem;
    }

    .tab-button {
      padding: 0.75rem 1.5rem;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 0.875rem;
      color: var(--text-secondary);
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .tab-button:hover {
      color: var(--text-primary);
    }

    .tab-button.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }

    .tab-icon {
      font-size: 1rem;
    }
  `,Zp([we({type:Array})],eg.prototype,"tabs",2),Zp([we({type:String})],eg.prototype,"activeTab",2),eg=Zp([ve("tab-group")],eg);var tg=Object.defineProperty,sg=Object.getOwnPropertyDescriptor,ig=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?sg(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&tg(t,s,r),r};let og=class extends me{constructor(){super(...arguments),this.actions=[],this.menuId="",this.isOpen=!1,this.dropdownPosition={top:0,left:0},this.dropdownElement=null,this.anchorRect=null,this.viewportMargin=8,this.handleOutsideClick=e=>{const t=e.target;this.contains(t)||this.dropdownElement?.contains(t)||this.closeDropdown()},this.handleScroll=()=>{this.isOpen&&this.closeDropdown()},this.handleResize=()=>{this.isOpen&&this.closeDropdown()},this.toggleMenu=e=>{if(e.stopPropagation(),this.isOpen)this.closeDropdown();else{const t=e.currentTarget.getBoundingClientRect();this.anchorRect=t;const s=t.bottom+4,i=t.right;this.dropdownPosition={top:s,left:i},this.isOpen=!0,setTimeout(()=>this.createDropdown(),0)}}}connectedCallback(){super.connectedCallback(),document.addEventListener("click",this.handleOutsideClick),window.addEventListener("scroll",this.handleScroll,!0),window.addEventListener("resize",this.handleResize)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("click",this.handleOutsideClick),window.removeEventListener("scroll",this.handleScroll,!0),window.removeEventListener("resize",this.handleResize),this.removeDropdown()}createDropdown(){this.dropdownElement||(this.dropdownElement=document.createElement("div"),this.dropdownElement.className="action-dropdown-portal",this.dropdownElement.style.cssText=`\n      position: fixed;\n      top: ${this.dropdownPosition.top}px;\n      left: ${this.dropdownPosition.left}px;\n      background: var(--vscode-menu-background, var(--vscode-editorWidget-background, var(--vscode-bg-light)));\n      border: 1px solid var(--vscode-menu-border, #464647);\n      border-radius: 4px;\n      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);\n      min-width: 160px;\n      z-index: 99999;\n      display: block;\n      overflow: auto;\n      max-height: calc(100vh - 16px);\n    `,this.dropdownElement.innerHTML=this.actions.map(e=>`\n      <button \n        data-action="${e.action}"\n        class="${e.danger?"danger":""}"\n        ${e.disabled?"disabled":""}\n        style="\n          display: block;\n          width: 100%;\n          text-align: left;\n          padding: 8px 16px;\n          border: none;\n          background: none;\n          color: ${e.danger?"var(--vscode-inputValidation-errorForeground, #f14c4c)":"var(--vscode-foreground, #cccccc)"};\n          cursor: ${e.disabled?"not-allowed":"pointer"};\n          font-size: 13px;\n          opacity: ${e.disabled?"0.5":"1"};\n        "\n      >\n        ${e.icon?`<span style="margin-right: 8px;">${e.icon}</span>`:""}\n        ${e.label}\n      </button>\n    `).join(""),this.dropdownElement.querySelectorAll("button").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const s=e.getAttribute("data-action");s&&!e.hasAttribute("disabled")&&this.handleActionClick(s)}),e.addEventListener("mouseenter",()=>{e.hasAttribute("disabled")||(e.style.backgroundColor="var(--vscode-list-hoverBackground, rgba(0, 0, 0, 0.08))")}),e.addEventListener("mouseleave",()=>{e.style.backgroundColor="transparent"})}),document.body.appendChild(this.dropdownElement),requestAnimationFrame(()=>this.adjustDropdownPosition()))}adjustDropdownPosition(){if(!this.dropdownElement||!this.anchorRect)return;const e=this.viewportMargin,t=this.dropdownElement.getBoundingClientRect(),s=this.anchorRect;let i=s.right-t.width;i=Math.max(e,Math.min(i,window.innerWidth-t.width-e));const o=window.innerHeight-s.bottom,r=s.top;let a;if(t.height+e<=o)a=s.bottom+4;else if(t.height+e<=r)a=s.top-t.height-4;else{const i=s.bottom+4;a=Math.max(e,Math.min(i,window.innerHeight-t.height-e))}this.dropdownElement.style.left=`${i}px`,this.dropdownElement.style.top=`${a}px`}removeDropdown(){this.dropdownElement&&(this.dropdownElement.remove(),this.dropdownElement=null)}closeDropdown(){this.isOpen=!1,this.anchorRect=null,this.removeDropdown()}handleActionClick(e){this.closeDropdown(),this.dispatchEvent(new CustomEvent("action-click",{detail:{action:e},bubbles:!0,composed:!0}))}render(){return J`
      <button class="action-dots" @click=${this.toggleMenu}>â®</button>
    `}};og.styles=g`
    :host {
      position: relative;
      display: inline-block;
    }

    .action-dots {
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 8px;
      color: var(--vscode-foreground, #cccccc);
      font-size: 18px;
      line-height: 1;
      transition: background-color 0.2s;
      border-radius: 4px;
      position: relative;
      z-index: 1;
    }

    .action-dots:hover {
      background-color: var(--vscode-toolbar-hoverBackground, var(--vscode-list-hoverBackground, rgba(90, 93, 94, 0.1)));
    }
  `,ig([we({type:Array})],og.prototype,"actions",2),ig([we({type:String})],og.prototype,"menuId",2),ig([xe()],og.prototype,"isOpen",2),ig([xe()],og.prototype,"dropdownPosition",2),og=ig([ve("action-dropdown")],og);var rg=Object.defineProperty,ag=Object.getOwnPropertyDescriptor,ng=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?ag(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&rg(t,s,r),r};let lg=class extends me{constructor(){super(...arguments),this.status="unknown"}render(){const e=this.text||this.status,t=this.status.toLowerCase();return J`
      <span class="status ${t}">${e}</span>
    `}};lg.styles=g`
    .status {
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
      display: inline-block;
    }

    .status.running,
    .status.active,
    .status.deployed,
    .status.bound,
    .status.available,
    .status.ready {
      background-color: rgba(34, 197, 94, 0.1);
      color: rgb(34, 197, 94);
    }

    .status.pending {
      background-color: rgba(251, 191, 36, 0.1);
      color: rgb(251, 191, 36);
    }

    .status.failed,
    .status.error {
      background-color: rgba(239, 68, 68, 0.1);
      color: rgb(239, 68, 68);
    }

    .status.enforced {
      background-color: rgba(59, 130, 246, 0.1);
      color: rgb(59, 130, 246);
    }

    .status.suspended {
      background-color: rgba(156, 163, 175, 0.1);
      color: rgb(156, 163, 175);
    }

    .status.stopped,
    .status.shutoff {
      background-color: rgba(239, 68, 68, 0.1);
      color: rgb(239, 68, 68);
    }

    .status.paused {
      background-color: rgba(251, 191, 36, 0.1);
      color: rgb(251, 191, 36);
    }

    .status.crashed {
      background-color: rgba(220, 38, 38, 0.1);
      color: rgb(220, 38, 38);
    }

    .status.starting,
    .status.stopping {
      background-color: rgba(59, 130, 246, 0.1);
      color: rgb(59, 130, 246);
    }

    .status.unknown {
      background-color: rgba(107, 114, 128, 0.1);
      color: rgb(107, 114, 128);
    }
  `,ng([we({type:String})],lg.prototype,"status",2),ng([we({type:String})],lg.prototype,"text",2),lg=ng([ve("status-badge")],lg);var cg=Object.defineProperty,dg=Object.getOwnPropertyDescriptor,hg=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?dg(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&cg(t,s,r),r};let ug=class extends me{constructor(){super(...arguments),this.columns=[],this.data=[],this.emptyMessage="No resources found",this.showActions=!0,this.getActions=null,this.customRenderers={}}handleCellClick(e,t,s){"link"===s.type&&this.dispatchEvent(new CustomEvent("cell-click",{detail:{item:t,column:s},bubbles:!0,composed:!0}))}handleActionClick(e,t){this.dispatchEvent(new CustomEvent("action",{detail:{action:e.detail.action,item:t},bubbles:!0,composed:!0}))}renderCell(e,t){const s=e[t.key],i=this.customRenderers?.[t.key];if(i)return i(s);switch(t.type){case"status":return J`<status-badge status="${s?.toLowerCase()||"unknown"}"></status-badge>`;case"link":return J`
          <span class="link" @click="${s=>this.handleCellClick(s,e,t)}">
            ${s||"-"}
          </span>
        `;case"custom":return J`<slot name="cell-${t.key}" .data="${e}"></slot>`;default:return J`${s||"-"}`}}render(){if(0===this.data.length)return J`<empty-state message="${this.emptyMessage}"></empty-state>`;const e=[{label:"View Details",action:"view"},{label:"Edit",action:"edit"},{label:"Delete",action:"delete",danger:!0}];return J`
      <table class="table">
        <thead>
          <tr>
            ${this.columns.map(e=>J`
              <th style="${e.width?`width: ${e.width}`:""}">${e.label}</th>
            `)}
            ${this.showActions?J`<th class="actions-cell">Actions</th>`:""}
          </tr>
        </thead>
        <tbody>
          ${this.data.map((t,s)=>J`
            <tr>
              ${this.columns.map(e=>J`
                <td>${this.renderCell(t,e)}</td>
              `)}
              ${this.showActions?J`
                <td class="actions-cell">
                  <action-dropdown
                    .actions=${this.getActions?this.getActions(t):e}
                    .menuId=${`menu-${s}`}
                    @action-click=${e=>this.handleActionClick(e,t)}
                  ></action-dropdown>
                </td>
              `:""}
            </tr>
          `)}
        </tbody>
      </table>
    `}};ug.styles=g`
    .table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: var(--vscode-bg-light);
      border-radius: 1px;
      overflow: visible;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      border: 1px solid var(--vscode-border);
    }

    .table thead {
      background: var(--vscode-bg-lighter);
    }

    .table th {
      background: var(--vscode-bg-dark);
      color: var(--vscode-text);
      font-weight: 600;
      text-align: left;
      padding: 12px 16px;
      font-size: 0.875rem;
      border-bottom: 1px solid var(--vscode-border);
    }

    .table td {
      padding: 12px 16px;
      color: var(--vscode-text);
      font-size: 0.875rem;
      border-bottom: 1px solid var(--vscode-border);
      position: relative;
    }

    .table tr:hover td {
      background: rgba(255, 255, 255, 0.02);
    }

    .table tr:last-child td {
      border-bottom: none;
    }

    .table td:last-child {
      text-align: right;
    }

    .link {
      color: var(--vscode-link-foreground, #0096ff);
      cursor: pointer;
      text-decoration: none;
      border-bottom: 1px solid transparent;
      transition: all 0.2s ease;
    }

    .link:hover {
      color: var(--vscode-link-activeForeground, #0096ff);
      text-decoration: none;
      border-bottom-color: var(--vscode-link-foreground, #0096ff);
    }

    .actions-cell {
      width: 50px;
      text-align: center;
    }
  `,hg([we({type:Array})],ug.prototype,"columns",2),hg([we({type:Array})],ug.prototype,"data",2),hg([we({type:String})],ug.prototype,"emptyMessage",2),hg([we({type:Boolean})],ug.prototype,"showActions",2),hg([we({type:Function})],ug.prototype,"getActions",2),hg([we({type:Object})],ug.prototype,"customRenderers",2),ug=hg([ve("resource-table")],ug);var pg=Object.defineProperty,gg=Object.getOwnPropertyDescriptor,mg=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?gg(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&pg(t,s,r),r};let fg=class extends me{constructor(){super(...arguments),this.title="",this.show=!1,this.loading=!1,this.width=600,this.isClosing=!1,this.animationFinished=!1,this.handleKeyDown=e=>{"Escape"===e.key&&this.show&&(e.stopPropagation(),this.handleClose())}}updated(e){e.has("show")&&this.show&&(this.animationFinished=!1,setTimeout(()=>{this.animationFinished=!0},300))}handleClose(e){e&&e.stopPropagation(),this.isClosing||(this.isClosing=!0,setTimeout(()=>{this.isClosing=!1,this.dispatchEvent(new CustomEvent("close",{bubbles:!1,composed:!0}))},300))}connectedCallback(){super.connectedCallback(),window.addEventListener("keydown",this.handleKeyDown)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("keydown",this.handleKeyDown)}render(){return this.show||this.isClosing?J`
      <div class="drawer ${this.isClosing?"closing":""} ${this.animationFinished?"animation-finished":""}" style="width: ${this.width}px">
        <div class="drawer-header">
          <button class="close-button" @click=${e=>this.handleClose(e)}>Ã</button>
          <h2>${this.title}</h2>
        </div>
        <div class="drawer-content">
          ${this.loading?J`
            <loading-state message="Loading details..."></loading-state>
          `:J`
            <slot></slot>
          `}
        </div>
      </div>
    `:null}};fg.styles=g`
    .drawer {
      position: fixed;
      top: 0;
      right: 0;
      height: 100vh;
      background: var(--vscode-editor-background, var(--vscode-bg-light));
      border-left: 1px solid var(--vscode-border);
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      z-index: 2000;
      display: flex;
      flex-direction: column;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
      }
      to {
        transform: translateX(0);
      }
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
      }
      to {
        transform: translateX(100%);
      }
    }

    .drawer.animation-finished { animation: none !important; transform: none !important; }
    .drawer.closing {
      animation: slideOut 0.3s ease-in forwards;
    }

    .close-button {
      position: absolute;
      top: 16px;
      right: 16px;
      background: none;
      border: none;
      cursor: pointer;
      color: var(--vscode-text);
      font-size: 18px;
      padding: 4px;
      border-radius: 4px;
      transition: background-color 0.2s;
    }

    .close-button:hover {
      background-color: var(--hover-bg);
    }

    .drawer-header {
      padding: 20px;
      border-bottom: 1px solid var(--vscode-border);
      flex-shrink: 0;
    }

    h2 {
      margin: 0;
      padding: 0;
      font-size: 18px;
      font-weight: 600;
      color: var(--vscode-text);
    }

    .drawer-content {
      font-size: 0.875rem;
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      padding-bottom: 40px; /* Extra padding at bottom to ensure last content is visible */
    }
  `,mg([we({type:String})],fg.prototype,"title",2),mg([we({type:Boolean})],fg.prototype,"show",2),mg([we({type:Boolean})],fg.prototype,"loading",2),mg([we({type:Number})],fg.prototype,"width",2),mg([xe()],fg.prototype,"isClosing",2),mg([xe()],fg.prototype,"animationFinished",2),fg=mg([ve("detail-drawer")],fg);var vg=Object.defineProperty,bg=Object.getOwnPropertyDescriptor,yg=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?bg(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&vg(t,s,r),r};let wg=class extends me{constructor(){super(...arguments),this.show=!1,this.title="Logs",this.subtitle="",this.logs="",this.loading=!1,this.error="",this.autoScroll=!0,this.showTimestamps=!0,this.colorize=!0,this.searchQuery="",this.isFollowing=!0}render(){return this.show?J`
      <div class="drawer" part="drawer">
        <div class="drawer-header" part="header">
          <div>
            <div class="header-title">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path d="M4 4h12v2H4zm0 3h12v2H4zm0 3h12v2H4zm0 3h8v2H4z"/>
              </svg>
              ${this.title}
            </div>
            ${this.subtitle?J`
              <div class="header-subtitle">${this.subtitle}</div>
            `:""}
          </div>
          <button class="close-button" @click=${this.handleClose} aria-label="Close">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>

        <div class="controls" part="controls">
          <div class="search-container" part="search">
            <svg class="search-icon" viewBox="0 0 16 16" fill="currentColor">
              <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
            </svg>
            <input
              type="text"
              class="search-input"
              placeholder="Search logs..."
              .value=${this.searchQuery}
              @input=${this.handleSearch}
            />
          </div>

          <button
            class="control-button ${this.isFollowing?"active":""}"
            @click=${this.toggleFollow}
            ?disabled=${this.loading}
          >
            ${this.isFollowing?J`
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 4v8m-4-4l4 4 4-4"/>
              </svg>
              Following
            `:J`
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M6 6h4v4H6z"/>
              </svg>
              Paused
            `}
          </button>

          <button
            class="control-button"
            @click=${this.handleRefresh}
            ?disabled=${this.loading}
          >
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M13.65 2.35a8 8 0 1 0 0 11.3M13 2v4h-4"/>
            </svg>
            Refresh
          </button>

          <button
            class="control-button"
            @click=${this.clearLogs}
            ?disabled=${this.loading||!this.logs}
          >
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M3 5h10M5 5V3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2m2 0v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5"/>
            </svg>
            Clear
          </button>
        </div>

        <div class="content" part="content" @scroll=${this.handleScroll}>
          ${this.loading?J`
            <div class="loading">Loading logs...</div>
          `:this.error?J`
            <div class="error">
              <p>Error loading logs:</p>
              <p>${this.error}</p>
            </div>
          `:this.logs?this.renderLogs():J`
            <div class="no-logs">No logs available</div>
          `}
        </div>
      </div>
    `:null}renderLogs(){const e=this.logs.split("\n").filter(e=>e.trim()),t=this.searchQuery?e.filter(e=>e.toLowerCase().includes(this.searchQuery.toLowerCase())):e;return J`
      ${t.map(e=>this.renderLogLine(e))}
    `}renderLogLine(e){const t=this.searchQuery&&e.toLowerCase().includes(this.searchQuery.toLowerCase());if(!this.colorize)return J`<div class="log-line ${t?"highlighted":""}">${e}</div>`;const s=e.match(/^(\d{4}-\d{2}-\d{2}[T\s]\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|[+-]\d{2}:\d{2})?)/),i=e.match(/\b(ERROR|WARN|WARNING|INFO|DEBUG|TRACE)\b/i);let o=e;const r=[];if(this.showTimestamps&&s&&(r.push(J`<span class="log-timestamp">${s[1]}</span>`),o=o.substring(s[0].length)),i&&i[1]){const e=i[1].toLowerCase(),s=e.includes("error")?"error":e.includes("warn")?"warn":e.includes("info")?"info":"debug",a=o.substring(0,o.indexOf(i[0])),n=o.substring(o.indexOf(i[0])+i[0].length);return J`
        <div class="log-line ${t?"highlighted":""}">
          ${r}
          ${a}
          <span class="log-level ${s}">${i[0]}</span>
          ${n}
        </div>
      `}return J`
      <div class="log-line ${t?"highlighted":""}">
        ${r}
        ${o}
      </div>
    `}handleClose(){this.show=!1,this.dispatchEvent(new CustomEvent("close",{bubbles:!0,composed:!0}))}handleRefresh(){this.dispatchEvent(new CustomEvent("refresh",{bubbles:!0,composed:!0}))}handleSearch(e){const t=e.target;this.searchQuery=t.value}toggleFollow(){this.isFollowing=!this.isFollowing,this.isFollowing&&this.autoScroll&&this.scrollToBottom()}clearLogs(){this.logs="",this.searchQuery=""}handleScroll(e){const t=e.target;!(t.scrollTop+t.clientHeight>=t.scrollHeight-10)&&this.isFollowing&&(this.isFollowing=!1)}scrollToBottom(){const e=this.shadowRoot?.querySelector(".content");e&&(e.scrollTop=e.scrollHeight)}updated(e){super.updated(e),e.has("logs")&&this.isFollowing&&this.autoScroll&&setTimeout(()=>this.scrollToBottom(),0)}};wg.styles=g`
    :host {
      display: block;
      position: fixed;
      top: 0;
      right: 0;
      width: 600px;
      height: 100vh;
      z-index: 1000;
      pointer-events: none;
    }

    :host([show]) {
      pointer-events: auto;
    }

    .drawer {
      width: 100%;
      height: 100%;
      background: var(--vscode-editor-background, var(--vscode-bg-light, #252526));
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      border-left: 1px solid var(--vscode-border);
    }

    :host([show]) .drawer {
      transform: translateX(0);
    }

    .drawer-header {
      padding: 20px;
      background: var(--vscode-sideBar-background, var(--vscode-bg-light, #252526));
      border-bottom: 1px solid var(--vscode-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .header-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--vscode-foreground, var(--vscode-text, #cccccc));
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header-subtitle {
      font-size: 13px;
      color: var(--vscode-descriptionForeground, var(--vscode-text-dim, #9d9d9d));
      margin-top: 4px;
    }

    .close-button {
      background: none;
      border: none;
      color: var(--vscode-icon-foreground, var(--vscode-text-dim, #9d9d9d));
      cursor: pointer;
      padding: 8px;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .close-button:hover {
      background: var(--vscode-toolbar-hoverBackground, rgba(90, 93, 94, 0.31));
      color: var(--vscode-foreground, var(--vscode-text, #cccccc));
    }

    .controls {
      padding: 12px 20px;
      background: var(--vscode-sideBar-background, var(--vscode-bg-light, #252526));
      border-bottom: 1px solid var(--vscode-border);
      display: flex;
      gap: 8px;
      align-items: center;
      flex-shrink: 0;
      flex-wrap: wrap;
    }

    .search-container {
      flex: 1;
      min-width: 200px;
      position: relative;
      display: flex;
      align-items: center;
    }

    .search-input {
      width: 100%;
      padding: 6px 12px 6px 32px;
      background: var(--vscode-input-background, #3c3c3c);
      color: var(--vscode-input-foreground, var(--vscode-text, #cccccc));
      border: 1px solid var(--vscode-input-border, rgba(255, 255, 255, 0.1));
      border-radius: 4px;
      font-size: 13px;
      outline: none;
      height: 32px;
      box-sizing: border-box;
      transition: border-color 0.2s ease;
    }

    .search-input:focus {
      border-color: var(--vscode-focusBorder, #007acc);
      background: var(--vscode-input-background, #3c3c3c);
    }

    .search-input::placeholder {
      color: var(--vscode-input-placeholderForeground, rgba(204, 204, 204, 0.5));
    }

    .search-icon {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      width: 14px;
      height: 14px;
      color: var(--vscode-input-placeholderForeground, rgba(204, 204, 204, 0.5));
      pointer-events: none;
    }

    .control-button {
      background: var(--vscode-button-secondaryBackground, transparent);
      color: var(--vscode-button-secondaryForeground, var(--vscode-text, #cccccc));
      border: 1px solid var(--vscode-button-border, rgba(255, 255, 255, 0.1));
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s ease;
      white-space: nowrap;
      height: 32px;
      box-sizing: border-box;
      font-family: var(--vscode-font-family, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif);
    }

    .control-button svg {
      width: 14px;
      height: 14px;
      flex-shrink: 0;
    }

    .control-button:hover:not(:disabled) {
      background: var(--vscode-button-secondaryHoverBackground, rgba(90, 93, 94, 0.31));
      border-color: var(--vscode-button-hoverBorder, rgba(255, 255, 255, 0.2));
    }

    .control-button:active:not(:disabled) {
      background: var(--vscode-button-secondaryHoverBackground, rgba(90, 93, 94, 0.5));
    }

    .control-button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .control-button.active {
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border-color: var(--vscode-button-background, #007acc);
    }

    .control-button.active:hover:not(:disabled) {
      background: var(--vscode-button-hoverBackground, #0098ff);
      border-color: var(--vscode-button-hoverBackground, #0098ff);
    }

    .content {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      font-family: var(--vscode-editor-font-family, 'Consolas', 'Monaco', 'Courier New', monospace);
      font-size: 13px;
      line-height: 1.6;
      color: var(--vscode-foreground, var(--vscode-text, #cccccc));
      background: var(--vscode-editor-background, #1e1e1e);
    }

    .log-line {
      word-break: break-all;
      margin: 0;
    }

    .log-line:hover {
      background: var(--vscode-list-hoverBackground, rgba(90, 93, 94, 0.31));
    }

    .log-line.highlighted {
      background: var(--vscode-editor-findMatchHighlightBackground, rgba(234, 92, 0, 0.33));
      border-left: 3px solid var(--vscode-editorWarning-foreground, #cca700);
      padding-left: 8px;
    }

    .log-timestamp {
      color: var(--vscode-descriptionForeground, var(--vscode-text-dim, #9d9d9d));
      margin-right: 8px;
    }

    .log-level {
      font-weight: bold;
      margin-right: 8px;
    }

    .log-level.error {
      color: var(--vscode-errorForeground, #f14c4c);
    }

    .log-level.warn {
      color: var(--vscode-editorWarning-foreground, #cca700);
    }

    .log-level.info {
      color: var(--vscode-editorInfo-foreground, #3794ff);
    }

    .log-level.debug {
      color: var(--vscode-descriptionForeground, var(--vscode-text-dim, #9d9d9d));
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 200px;
      color: var(--vscode-descriptionForeground, var(--vscode-text-dim, #9d9d9d));
    }

    .error {
      padding: 40px;
      text-align: center;
      color: var(--vscode-errorForeground, #f14c4c);
    }

    .no-logs {
      padding: 40px;
      text-align: center;
      color: var(--vscode-descriptionForeground, var(--vscode-text-dim, #9d9d9d));
    }

    /* Scrollbar styling */
    .content::-webkit-scrollbar {
      width: 10px;
    }

    .content::-webkit-scrollbar-track {
      background: var(--vscode-scrollbarSlider-background, transparent);
    }

    .content::-webkit-scrollbar-thumb {
      background: var(--vscode-scrollbarSlider-background, rgba(121, 121, 121, 0.4));
      border-radius: 4px;
    }

    .content::-webkit-scrollbar-thumb:hover {
      background: var(--vscode-scrollbarSlider-hoverBackground, rgba(100, 100, 100, 0.7));
    }
  `,yg([we({type:Boolean,reflect:!0})],wg.prototype,"show",2),yg([we({type:String})],wg.prototype,"title",2),yg([we({type:String})],wg.prototype,"subtitle",2),yg([we({type:String})],wg.prototype,"logs",2),yg([we({type:Boolean})],wg.prototype,"loading",2),yg([we({type:String})],wg.prototype,"error",2),yg([we({type:Boolean})],wg.prototype,"autoScroll",2),yg([we({type:Boolean})],wg.prototype,"showTimestamps",2),yg([we({type:Boolean})],wg.prototype,"colorize",2),yg([xe()],wg.prototype,"searchQuery",2),yg([xe()],wg.prototype,"isFollowing",2),wg=yg([ve("logs-drawer")],wg);var xg=Object.defineProperty,_g=Object.getOwnPropertyDescriptor,kg=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?_g(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&xg(t,s,r),r};let Sg=class extends me{constructor(){super(...arguments),this.item=null,this.show=!1,this.loading=!1,this.modalTitle="Confirm Delete",this.message="",this.confirmLabel="Delete",this.confirmButtonClass="delete",this.hasVolumes=!1,this.volumeCount=0,this.deleteVolumes=!1,this.acknowledge=!1}handleOverlayClick(e){e.target!==e.currentTarget||this.loading||this.handleCancel()}handleConfirm(){this.dispatchEvent(new CustomEvent("confirm-delete",{detail:{item:this.item,deleteVolumes:this.deleteVolumes},bubbles:!0,composed:!0}))}handleCancel(){this.dispatchEvent(new CustomEvent("cancel-delete",{bubbles:!0,composed:!0}))}willUpdate(e){e.has("show")&&this.show&&console.log("Modal opening with properties:",{modalTitle:this.modalTitle,message:this.message,confirmLabel:this.confirmLabel,confirmButtonClass:this.confirmButtonClass})}render(){return this.show&&this.item?(console.log("Delete Modal Rendering with:",{modalTitle:this.modalTitle,message:this.message,confirmLabel:this.confirmLabel,confirmButtonClass:this.confirmButtonClass,item:this.item}),J`
      <div class="modal-overlay" @click=${this.handleOverlayClick}>
        <div class="modal">
          <div class="modal-header">
            <span class="modal-icon warning">â ï¸</span>
            <h3 class="modal-title">${this.modalTitle}</h3>
          </div>
          <div class="modal-body">
            ${this.message&&this.message.length>0?J`
              <p>${this.message}</p>
            `:J`
              <p>Are you sure you want to delete this ${this.item.type.toLowerCase()}?</p>
            `}
            <div class="modal-resource-info">
              <div><strong>Type:</strong> ${this.item.type}</div>
              <div><strong>Name:</strong> ${this.item.name}</div>
              ${this.item.namespace?J`<div><strong>Namespace:</strong> ${this.item.namespace}</div>`:""}
            </div>
            ${this.hasVolumes?J`
              <div style="margin:12px 0; padding:12px; border:1px solid var(--vscode-widget-border); border-radius:4px; background: rgba(255, 193, 7, 0.08);">
                <div style="color: var(--vscode-notificationsWarningIcon-foreground,#ff9800); font-weight:600; margin-bottom:6px;">
                  â ï¸ Warning: This resource contains ${this.volumeCount} volume(s).
                </div>
                <label style="display:flex; align-items:center; gap:8px; margin-top:6px;">
                  <input type="checkbox" .checked=${this.deleteVolumes} @change=${e=>{this.deleteVolumes=e.target.checked}} />
                  Delete all volumes with this resource (dangerous - permanent data loss)
                </label>
                ${this.deleteVolumes?J`
                  <label style="display:flex; align-items:center; gap:8px; margin-top:8px;">
                    <input type="checkbox" .checked=${this.acknowledge} @change=${e=>{this.acknowledge=e.target.checked}} />
                    I understand this will permanently delete all data
                  </label>
                `:""}
              </div>
            `:""}
            ${"delete"===this.confirmButtonClass?J`
              <p><strong>This action cannot be undone.</strong></p>
            `:""}
          </div>
          <div class="modal-footer">
            <button 
              class="modal-button cancel" 
              @click=${this.handleCancel}
              ?disabled=${this.loading}
            >
              Cancel
            </button>
            <button 
              class="modal-button ${this.confirmButtonClass}" 
              @click=${this.handleConfirm}
              ?disabled=${this.loading}
            >
              ${this.loading?J`${this.confirmLabel}ing...`:this.confirmLabel}
            </button>
          </div>
        </div>
      </div>
    `):""}};Sg.styles=g`
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      z-index: 2000;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding-top: 80px;
      animation: fadeIn 0.2s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .modal {
      background: var(--vscode-editor-background, var(--vscode-bg-light));
      border: 1px solid var(--vscode-widget-border, var(--vscode-panel-border, #454545));
      border-radius: 8px;
      padding: 24px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      animation: modalFadeIn 0.3s ease-out;
    }

    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-header {
      display: flex;
      align-items: center;
      margin-bottom: 16px;
    }

    .modal-icon {
      font-size: 24px;
      margin-right: 12px;
    }

    .modal-icon.warning {
      color: var(--vscode-notificationsWarningIcon-foreground, #ff9800);
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--vscode-foreground);
    }

    .modal-body {
      margin-bottom: 24px;
      color: var(--vscode-foreground);
      line-height: 1.5;
    }

    .modal-resource-info {
      background: var(--vscode-editor-inactiveSelectionBackground, rgba(255, 255, 255, 0.05));
      border: 1px solid var(--vscode-widget-border, rgba(255, 255, 255, 0.1));
      border-radius: 4px;
      padding: 12px;
      margin: 12px 0;
      font-family: var(--vscode-editor-font-family, monospace);
      font-size: 14px;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    .modal-button {
      padding: 8px 16px;
      border: 1px solid var(--vscode-button-border, transparent);
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .modal-button.cancel {
      background: var(--vscode-button-secondaryBackground, rgba(255, 255, 255, 0.1));
      color: var(--vscode-button-secondaryForeground, var(--vscode-foreground));
    }

    .modal-button.cancel:hover {
      background: var(--vscode-button-secondaryHoverBackground, rgba(255, 255, 255, 0.15));
    }

    .modal-button.delete {
      background: var(--vscode-notificationsErrorIcon-foreground, #f44336);
      color: white;
      border-color: var(--vscode-notificationsErrorIcon-foreground, #f44336);
    }

    .modal-button.delete:hover {
      background: #d32f2f;
      border-color: #d32f2f;
    }

    .modal-button.confirm {
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border-color: var(--vscode-button-background, #007acc);
    }

    .modal-button.confirm:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
      border-color: var(--vscode-button-hoverBackground, #005a9e);
    }

    .modal-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  `,kg([we({type:Object})],Sg.prototype,"item",2),kg([we({type:Boolean,reflect:!0})],Sg.prototype,"show",2),kg([we({type:Boolean})],Sg.prototype,"loading",2),kg([we({type:String,attribute:"modal-title"})],Sg.prototype,"modalTitle",2),kg([we({type:String,attribute:"message"})],Sg.prototype,"message",2),kg([we({type:String,attribute:"confirm-label"})],Sg.prototype,"confirmLabel",2),kg([we({type:String,attribute:"confirm-button-class"})],Sg.prototype,"confirmButtonClass",2),kg([we({type:Boolean,attribute:"has-volumes"})],Sg.prototype,"hasVolumes",2),kg([we({type:Number,attribute:"volume-count"})],Sg.prototype,"volumeCount",2),kg([we({type:Boolean,attribute:"delete-volumes"})],Sg.prototype,"deleteVolumes",2),kg([we({type:Boolean,attribute:"acknowledge"})],Sg.prototype,"acknowledge",2),Sg=kg([ve("delete-modal")],Sg);var Cg=Object.defineProperty,$g=Object.getOwnPropertyDescriptor,Dg=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?$g(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Cg(t,s,r),r};let Eg=class extends me{constructor(){super(...arguments),this.show=!1,this.loading=!1,this.deploymentName="",this.namespace="",this.containers=[],this.containerImages={}}updated(e){e.has("containers")&&(this.containerImages={},this.containers.forEach(e=>{this.containerImages[e.name]=e.image}))}handleInputChange(e,t){const s=t.target;this.containerImages={...this.containerImages,[e]:s.value}}handleCancel(){this.dispatchEvent(new CustomEvent("cancel-set-image"))}handleConfirm(){const e=Object.entries(this.containerImages).map(([e,t])=>({[e]:t}));this.dispatchEvent(new CustomEvent("confirm-set-image",{detail:{images:e}}))}handleOverlayClick(e){e.target!==e.currentTarget||this.loading||this.handleCancel()}render(){return this.show?J`
      <div class="overlay" @click="${this.handleOverlayClick}">
        <div class="modal" @click="${e=>e.stopPropagation()}">
          <div class="modal-header">
            <div>
              <h2 class="modal-title">Set Container Images</h2>
              <div class="modal-subtitle">${this.deploymentName} (${this.namespace})</div>
            </div>
            <button 
              class="modal-close" 
              @click="${this.handleCancel}"
              ?disabled="${this.loading}"
              aria-label="Close"
            >
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 8.707l3.646 3.647.708-.707L8.707 8l3.647-3.646-.707-.708L8 7.293 4.354 3.646l-.707.708L7.293 8l-3.647 3.646.708.708L8 8.707z"/>
              </svg>
            </button>
          </div>
          
          <div class="modal-content">
            ${0===this.containers.length?J`
              <div class="form-hint">No containers found in this deployment.</div>
            `:J`
              <div class="form-hint" style="margin-bottom: 16px;">
                Update the image for each container in the deployment. Leave unchanged to keep the current image.
              </div>
              ${this.containers.map(e=>J`
                <div class="container-item">
                  <div class="container-name">Container: ${e.name}</div>
                  <input
                    type="text"
                    class="form-input"
                    .value="${this.containerImages[e.name]||e.image}"
                    @input="${t=>this.handleInputChange(e.name,t)}"
                    ?disabled="${this.loading}"
                    placeholder="e.g., nginx:1.21.0"
                  />
                  <div class="current-image">Current: ${e.image}</div>
                </div>
              `)}
            `}
          </div>
          
          <div class="modal-footer">
            <button 
              class="btn btn-cancel" 
              @click="${this.handleCancel}"
              ?disabled="${this.loading}"
            >
              Cancel
            </button>
            <button 
              class="btn btn-primary" 
              @click="${this.handleConfirm}"
              ?disabled="${this.loading||0===this.containers.length}"
            >
              ${this.loading?J`<span class="spinner"></span>`:""}
              ${this.loading?"Updating...":"Update Images"}
            </button>
          </div>
        </div>
      </div>
    `:J``}};Eg.styles=g`
    :host {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1000;
    }

    :host([show]) {
      display: block;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.2s ease-out;
    }

    .modal {
      position: relative;
      background-color: var(--vscode-editor-background, #1e1e1e);
      color: var(--vscode-editor-foreground, #cccccc);
      margin: 50px auto;
      border: 1px solid var(--vscode-panel-border, #464647);
      border-radius: 6px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.2s ease-out;
      width: 90%;
      max-width: 600px;
      max-height: calc(100vh - 100px);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid var(--vscode-panel-border, #464647);
      background-color: var(--vscode-editor-background, #252526);
    }

    .modal-title {
      margin: 0;
      font-size: 16px;
      font-weight: 500;
      color: var(--vscode-editor-foreground, #cccccc);
    }

    .modal-subtitle {
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #969696);
      margin-top: 4px;
    }

    .modal-close {
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: none;
      background: none;
      color: var(--vscode-icon-foreground, #cccccc);
      border-radius: 4px;
      transition: all 0.2s;
    }

    .modal-close:hover {
      background-color: var(--vscode-toolbar-hoverBackground, #2a2a2a);
    }

    .modal-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-size: 13px;
      color: var(--vscode-editor-foreground, #cccccc);
      font-weight: 500;
    }

    .form-hint {
      font-size: 11px;
      color: var(--vscode-descriptionForeground, #969696);
      margin-top: 4px;
    }

    .form-input {
      width: 100%;
      padding: 8px 12px;
      background: var(--vscode-input-background, #3c3c3c);
      color: var(--vscode-input-foreground, #cccccc);
      border: 1px solid var(--vscode-input-border, #3c3c3c);
      border-radius: 4px;
      font-size: 13px;
      font-family: inherit;
      box-sizing: border-box;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--vscode-focusBorder, #007acc);
    }

    .form-input:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .container-item {
      padding: 12px;
      background: var(--vscode-editor-background, #1e1e1e);
      border: 1px solid var(--vscode-panel-border, #464647);
      border-radius: 4px;
      margin-bottom: 12px;
    }

    .container-name {
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #969696);
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .current-image {
      font-size: 11px;
      color: var(--vscode-descriptionForeground, #969696);
      margin-top: 4px;
      font-family: var(--vscode-editor-font-family, 'Monaco', 'Courier New', monospace);
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      padding: 16px 20px;
      border-top: 1px solid var(--vscode-panel-border, #464647);
      background-color: var(--vscode-editor-background, #1e1e1e);
    }

    .btn {
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 500;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
      font-family: inherit;
    }

    .btn-cancel {
      background: transparent;
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border-color: var(--vscode-button-border, #464647);
    }

    .btn-cancel:hover {
      background: var(--vscode-button-secondaryHoverBackground, #2a2a2a);
    }

    .btn-primary {
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border-color: var(--vscode-button-background, #007acc);
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideIn {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .spinner {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  `,Dg([we({type:Boolean,reflect:!0})],Eg.prototype,"show",2),Dg([we({type:Boolean})],Eg.prototype,"loading",2),Dg([we({type:String})],Eg.prototype,"deploymentName",2),Dg([we({type:String})],Eg.prototype,"namespace",2),Dg([we({type:Array})],Eg.prototype,"containers",2),Dg([xe()],Eg.prototype,"containerImages",2),Eg=Dg([ve("set-image-modal")],Eg);var Mg=Object.defineProperty,Ag=Object.getOwnPropertyDescriptor,Ig=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Ag(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Mg(t,s,r),r};let Tg=class extends me{constructor(){super(...arguments),this.show=!1,this.pod="",this.namespace="",this.container="",this.containers=[],this.selectedContainer="",this.loading=!1}updated(e){e.has("show")&&this.show&&this.fetchContainers(),(e.has("pod")||e.has("namespace"))&&this.show&&this.fetchContainers()}async fetchContainers(){if(this.pod&&this.namespace){this.loading=!0,this.containers=[],this.selectedContainer=this.container;try{const e=await Lp.getPodContainers(this.namespace,this.pod);this.containers=e.map(e=>e.name),(!this.selectedContainer&&this.containers.length>0||this.selectedContainer&&!this.containers.includes(this.selectedContainer))&&(this.selectedContainer=this.containers[0]||"")}catch(U_){console.error("Failed to fetch containers",U_),this.selectedContainer}finally{this.loading=!1}}}handleClose(){this.dispatchEvent(new CustomEvent("close"))}handleNewTab(){const e=this.selectedContainer?`&container=${this.selectedContainer}`:"",t=`/kubernetes/terminal?pod=${this.pod}&namespace=${this.namespace}${e}`;window.open(t,"_blank"),this.handleClose()}handleContainerChange(e){const t=e.target;this.selectedContainer=t.value}render(){return this.show?J`
      <div class="modal-overlay" @click="${e=>e.target===this.shadowRoot?.querySelector(".modal-overlay")&&this.handleClose()}">
        <div class="modal-content">
          <div class="modal-header">
            <div class="header-left">
                <span>Terminal: ${this.pod}</span>
                ${this.containers.length>1?J`
                    <select @change="${this.handleContainerChange}" .value="${this.selectedContainer}">
                        ${this.containers.map(e=>J`<option value="${e}">${e}</option>`)}
                    </select>
                `:this.selectedContainer?J`<span style="color: #888; font-size: 12px;">(${this.selectedContainer})</span>`:""}
            </div>
            <div class="btn-group">
                <button class="btn" @click="${this.handleNewTab}">Open in New Tab</button>
                <button class="btn btn-close" @click="${this.handleClose}">Close</button>
            </div>
          </div>
          <div class="modal-body">
            ${this.loading?J`<div style="padding: 20px; color: #ccc;">Loading container details...</div>`:J`
                <pod-terminal 
                    .pod="${this.pod}" 
                    .namespace="${this.namespace}" 
                    .container="${this.selectedContainer}"
                ></pod-terminal>
            `}
          </div>
        </div>
      </div>
    `:null}};Tg.styles=g`
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #1e1e1e;
      width: 90%;
      height: 90%;
      display: flex;
      flex-direction: column;
      border-radius: 4px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      border: 1px solid #333;
    }
    .modal-header {
      padding: 10px 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #252526;
      border-bottom: 1px solid #333;
      color: #cccccc;
      font-size: 14px;
      font-weight: 500;
    }
    .header-left {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    .modal-body {
      flex: 1;
      overflow: hidden;
      position: relative;
      background: #1e1e1e;
    }
    .btn-group {
      display: flex;
      gap: 8px;
    }
    .btn {
      background: #3c3c3c;
      border: 1px solid #3c3c3c;
      color: #cccccc;
      cursor: pointer;
      padding: 4px 12px;
      border-radius: 2px;
      font-size: 12px;
    }
    .btn:hover {
      background: #4b4b4b;
    }
    .btn-close {
        background: #cc3333;
    }
    .btn-close:hover {
        background: #e63333;
    }
    select {
        background: #3c3c3c;
        border: 1px solid #3c3c3c;
        color: #cccccc;
        padding: 4px;
        border-radius: 2px;
        outline: none;
    }
  `,Ig([we({type:Boolean})],Tg.prototype,"show",2),Ig([we({type:String})],Tg.prototype,"pod",2),Ig([we({type:String})],Tg.prototype,"namespace",2),Ig([we({type:String})],Tg.prototype,"container",2),Ig([xe()],Tg.prototype,"containers",2),Ig([xe()],Tg.prototype,"selectedContainer",2),Ig([xe()],Tg.prototype,"loading",2),Tg=Ig([ve("terminal-modal")],Tg);var Pg=Object.defineProperty,Lg=Object.getOwnPropertyDescriptor,Rg=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Lg(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Pg(t,s,r),r};let Og=class extends me{constructor(){super(...arguments),this.resource=null}render(){if(!this.resource)return J`<div class="empty-value">No data available</div>`;return"Pod"===this.resource.kind||this.resource.metadata&&this.resource.spec&&this.resource.status&&"containers"in(this.resource.spec||{})?this.renderPodDetails():J`
      <div class="pod-details-content">
        <div class="detail-sections">
          ${this.renderMetadata()}
          ${this.renderSpec()}
          ${this.renderStatus()}
          ${this.renderData()}
          ${this.renderAdditionalSections()}
        </div>
      </div>
    `}renderMetadata(){const e=this.resource.metadata;if(!e)return null;const t=e.labels&&Object.keys(e.labels).length>0,s=e.annotations&&Object.keys(e.annotations).length>0;return J`
      <!-- Basic Metadata -->
      <div class="detail-section">
        <h3>Basic Information</h3>
        ${this.renderDetailItem("Name",e.name)}
        ${e.namespace?this.renderDetailItem("Namespace",e.namespace):""}
        ${e.uid?this.renderDetailItem("UID",e.uid):""}
        ${e.resourceVersion?this.renderDetailItem("Resource Version",e.resourceVersion):""}
        ${e.creationTimestamp?this.renderDetailItem("Creation Timestamp",this.formatTimestamp(e.creationTimestamp)):""}
        ${e.creationTimestamp?this.renderDetailItem("Age",this.formatTimestamp(e.creationTimestamp)):""}
      </div>

      <!-- Labels -->
      ${t?J`
        <div class="detail-section">
          <h3>Labels</h3>
          ${Object.entries(e.labels).map(([e,t])=>this.renderDetailItem(e,t))}
        </div>
      `:""}

      <!-- Annotations -->
      ${s?J`
        <div class="detail-section">
          <h3>Annotations</h3>
          ${Object.entries(e.annotations).map(([e,t])=>this.renderDetailItem(e,t))}
        </div>
      `:""}
    `}renderSpec(){const e=this.resource.spec;return e&&0!==Object.keys(e).length?J`
      <div class="detail-section">
        <h3>Specification</h3>
        ${this.renderObjectAsDetailItems(e)}
      </div>
    `:null}renderStatus(){const e=this.resource.status;if(!e||0===Object.keys(e).length)return null;const t=e.conditions,s={...e};return delete s.conditions,J`
      <div class="detail-section">
        <h3>Status</h3>
        ${this.renderObjectAsDetailItems(s,!0)}
      </div>
      
      ${t&&t.length>0?J`
        <div class="detail-section">
          <h3>Conditions</h3>
          ${t.map(e=>this.renderConditionDetails(e))}
        </div>
      `:""}
    `}renderData(){const e=this.resource.data;return e&&0!==Object.keys(e).length?J`
      <div class="detail-section">
        <h3>Data</h3>
        ${this.renderObjectAsDetailItems(e)}
      </div>
    `:null}renderAdditionalSections(){const e=["metadata","spec","status","data","kind","apiVersion"],t=[];Object.entries(this.resource).forEach(([s,i])=>{!e.includes(s)&&i&&"object"==typeof i&&t.push(J`
          <div class="detail-section">
            <h3>${this.formatKey(s)}</h3>
            ${this.renderObjectAsDetailItems(i)}
          </div>
        `)});const s={...this.resource};return s.metadata?.managedFields&&(s.metadata={...s.metadata},delete s.metadata.managedFields),t.push(J`
      <div class="detail-section">
        <h3>Raw Data</h3>
        <details>
          <summary>View raw resource data</summary>
          <pre class="raw-data">${JSON.stringify(s,null,2)}</pre>
        </details>
      </div>
    `),t}renderObject(e,t=!1){if(!e||"object"!=typeof e){const t=this.renderValue(e);return"string"==typeof t?J`${t}`:t}const s=Object.entries(e);return 0===s.length?J`<span class="empty-value">Empty</span>`:J`
      ${s.map(([e,s])=>this.renderProperty(e,s,t))}
    `}renderProperty(e,t,s=!1){const i=this.formatKey(e);return"conditions"===e&&Array.isArray(t)?this.renderConditions(t):Array.isArray(t)?J`
        <div class="detail-item">
          <span class="detail-key">${i}:</span>
          <div class="detail-value">
            ${0===t.length?J`
              <span class="empty-value">Empty array</span>
            `:J`
              <div class="array-container">
                ${t.map((e,t)=>J`
                  <div class="array-item">
                    <span class="array-index">[${t}]</span>
                    ${"object"==typeof e?this.renderObject(e):this.renderValue(e)}
                  </div>
                `)}
              </div>
            `}
          </div>
        </div>
      `:t&&"object"==typeof t?J`
        <div class="detail-item">
          <span class="detail-key">${i}:</span>
          <div class="detail-value">
            <div class="nested-object">
              ${this.renderObject(t)}
            </div>
          </div>
        </div>
      `:!s||"phase"!==e&&"state"!==e&&"status"!==e?J`
      <div class="detail-item">
        <span class="detail-key">${i}:</span>
        <span class="detail-value ${this.getValueClass(t)}">${this.renderValue(t)}</span>
      </div>
    `:J`
        <div class="detail-item">
          <span class="detail-key">${i}:</span>
          <span class="detail-value">
            <span class="status-badge ${t.toString().toLowerCase()}">${t}</span>
          </span>
        </div>
      `}renderConditions(e){return J`
      <div class="detail-item">
        <span class="detail-key">Conditions:</span>
        <div class="detail-value">
          <div class="array-container">
            ${e.map(e=>J`
              <div class="array-item">
                <div class="detail-item">
                  <span class="detail-key">Type:</span>
                  <span class="detail-value">${e.type}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-key">Status:</span>
                  <span class="detail-value">
                    <span class="status-badge ${e.status.toLowerCase()}">${e.status}</span>
                  </span>
                </div>
                ${e.reason?J`
                  <div class="detail-item">
                    <span class="detail-key">Reason:</span>
                    <span class="detail-value">${e.reason}</span>
                  </div>
                `:""}
                ${e.message?J`
                  <div class="detail-item">
                    <span class="detail-key">Message:</span>
                    <span class="detail-value">${e.message}</span>
                  </div>
                `:""}
                ${e.lastTransitionTime?J`
                  <div class="detail-item">
                    <span class="detail-key">Last Transition:</span>
                    <span class="detail-value timestamp">
                      ${this.formatTimestamp(e.lastTransitionTime)}
                    </span>
                  </div>
                `:""}
              </div>
            `)}
          </div>
        </div>
      </div>
    `}renderValue(e){return null==e?J`<span class="value-null">null</span>`:"boolean"==typeof e?J`<span class="value-boolean">${e}</span>`:"number"==typeof e?J`<span class="value-number">${e}</span>`:"string"==typeof e?this.isTimestamp(e)?J`<span class="timestamp">${this.formatTimestamp(e)}</span>`:e.includes("\n")?J`<div class="code-block">${e}</div>`:e:JSON.stringify(e)}getValueClass(e){return null==e?"value-null":"boolean"==typeof e?"value-boolean":"number"==typeof e?"value-number":"string"==typeof e?"value-string":""}formatKey(e){return e.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/^./,e=>e.toUpperCase()).trim()}formatTimestamp(e){const t=new Date(e),s=(/* @__PURE__ */new Date).getTime()-t.getTime();if(s<864e5){const e=Math.floor(s/36e5),i=Math.floor(s%36e5/6e4);return e>0?`${e}h ${i}m ago (${t.toLocaleString()})`:i>0?`${i}m ago (${t.toLocaleString()})`:`Just now (${t.toLocaleString()})`}return t.toLocaleString()}isTimestamp(e){return/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/.test(e)}renderObjectAsDetailItems(e,t=!1){const s=[];return Object.entries(e).forEach(([e,i])=>{null==i?s.push(this.renderDetailItem(this.formatKey(e),null)):Array.isArray(i)?0===i.length?s.push(this.renderDetailItem(this.formatKey(e),"Empty array")):"object"==typeof i[0]?s.push(J`
            <div class="detail-item nested">
              <strong class="detail-key">${this.formatKey(e)}:</strong>
              <div class="nested-content">
                ${i.map((e,t)=>J`
                  <div class="detail-item nested">
                    <strong class="detail-key">Item ${t+1}:</strong>
                    <div class="nested-content">
                      ${this.renderObjectAsDetailItems(e)}
                    </div>
                  </div>
                `)}
              </div>
            </div>
          `):s.push(this.renderDetailItem(this.formatKey(e),i.join(", "))):"object"==typeof i?s.push(this.renderNestedObject(this.formatKey(e),i)):!t||"phase"!==e&&"state"!==e&&"status"!==e?s.push(this.renderDetailItem(this.formatKey(e),i)):s.push(J`
            <div class="detail-item">
              <strong class="detail-key">${this.formatKey(e)}:</strong>
              <span class="detail-value">
                <span class="status-badge ${i.toString().toLowerCase()}">${i}</span>
              </span>
            </div>
          `)}),s}renderPodDetails(){const e=this.resource.metadata||{},t=this.resource.spec||{},s=this.resource.status||{};return J`
      <div class="pod-details-content">
        <div class="detail-sections">
          <!-- Basic Information -->
          <div class="detail-section">
            <h3>Basic Information</h3>
            ${this.renderDetailItem("Name",e.name)}
            ${this.renderDetailItem("Namespace",e.namespace)}
            ${this.renderDetailItem("UID",e.uid)}
            ${this.renderDetailItem("Resource Version",e.resourceVersion)}
            ${this.renderDetailItem("Creation Timestamp",e.creationTimestamp?this.formatTimestamp(e.creationTimestamp):null)}
            ${this.renderDetailItem("Age",e.creationTimestamp?this.formatTimestamp(e.creationTimestamp):null)}
          </div>

          <!-- Status Information -->
          <div class="detail-section">
            <h3>Status</h3>
            ${this.renderDetailItem("Phase",s.phase)}
            ${this.renderDetailItem("QoS Class",s.qosClass)}
            ${this.renderDetailItem("Start Time",s.startTime?this.formatTimestamp(s.startTime):null)}
          </div>

          <!-- Network Information -->
          <div class="detail-section">
            <h3>Network</h3>
            ${this.renderDetailItem("Pod IP",s.podIP)}
            ${this.renderDetailItem("Host IP",s.hostIP)}
            ${t.nodeName?this.renderDetailItem("Node",t.nodeName):""}
          </div>

          <!-- Configuration -->
          <div class="detail-section">
            <h3>Configuration</h3>
            ${this.renderDetailItem("Restart Policy",t.restartPolicy)}
            ${this.renderDetailItem("DNS Policy",t.dnsPolicy)}
            ${this.renderDetailItem("Service Account",t.serviceAccount||t.serviceAccountName||"default")}
            ${t.nodeSelector&&Object.keys(t.nodeSelector).length>0?this.renderNestedObject("Node Selector",t.nodeSelector):""}
          </div>

          <!-- Labels -->
          ${e.labels&&Object.keys(e.labels).length>0?J`
            <div class="detail-section">
              <h3>Labels</h3>
              ${Object.entries(e.labels).map(([e,t])=>this.renderDetailItem(e,t))}
            </div>
          `:""}

          <!-- Annotations -->
          ${e.annotations&&Object.keys(e.annotations).length>0?J`
            <div class="detail-section">
              <h3>Annotations</h3>
              ${Object.entries(e.annotations).map(([e,t])=>this.renderDetailItem(e,t))}
            </div>
          `:""}

          <!-- Containers -->
          ${t.containers&&t.containers.length>0?J`
            <div class="detail-section">
              <h3>Containers</h3>
              ${t.containers.map((e,t)=>this.renderContainerDetails(e,t+1,s.containerStatuses))}
            </div>
          `:""}

          <!-- Conditions -->
          ${s.conditions&&s.conditions.length>0?J`
            <div class="detail-section">
              <h3>Conditions</h3>
              ${s.conditions.map(e=>this.renderConditionDetails(e))}
            </div>
          `:""}

          <!-- Raw Data -->
          <div class="detail-section">
            <h3>Raw Data</h3>
            <details>
              <summary>View raw pod data</summary>
              <pre class="raw-data">${JSON.stringify(this.resource,null,2)}</pre>
            </details>
          </div>
        </div>
      </div>
    `}renderDetailItem(e,t){return null==t?J`
        <div class="detail-item">
          <strong class="detail-key">${e}:</strong>
          <span class="detail-value null">null</span>
        </div>
      `:J`
      <div class="detail-item">
        <strong class="detail-key">${e}:</strong>
        <span class="detail-value">${t}</span>
      </div>
    `}renderNestedObject(e,t){return J`
      <div class="detail-item nested">
        <strong class="detail-key">${e}:</strong>
        <div class="nested-content">
          ${Object.entries(t).map(([e,t])=>J`
            <div class="detail-item">
              <strong class="detail-key">${e}:</strong>
              <span class="detail-value">${t}</span>
            </div>
          `)}
        </div>
      </div>
    `}renderContainerDetails(e,t,s=[]){const i=s?.find(t=>t.name===e.name);return J`
      <div class="detail-item nested">
        <strong class="detail-key">Container ${t}:</strong>
        <div class="nested-content">
          ${this.renderDetailItem("Name",e.name)}
          ${this.renderDetailItem("Image",e.image)}
          ${i?J`
            ${this.renderDetailItem("Ready",i.ready)}
            ${this.renderDetailItem("Restart Count",i.restartCount)}
            ${i.state?this.renderDetailItem("State",Object.keys(i.state)[0]):""}
          `:J`
            ${this.renderDetailItem("Ready",null)}
            ${this.renderDetailItem("Restart Count",null)}
            ${this.renderDetailItem("State",null)}
          `}
        </div>
      </div>
    `}renderConditionDetails(e){return J`
      <div class="detail-item nested">
        <strong class="detail-key">${e.type}:</strong>
        <div class="nested-content">
          ${this.renderDetailItem("Status",e.status)}
          ${e.lastProbeTime?this.renderDetailItem("Last Probe Time",this.formatTimestamp(e.lastProbeTime)):""}
          ${this.renderDetailItem("Last Transition Time",e.lastTransitionTime?this.formatTimestamp(e.lastTransitionTime):null)}
          ${this.renderDetailItem("Reason",e.reason||null)}
          ${this.renderDetailItem("Message",e.message||null)}
        </div>
      </div>
    `}};Og.styles=g`
    :host {
      display: block;
      font-family: var(--vscode-font-family, system-ui, -apple-system, sans-serif);
      font-size: 13px;
      color: var(--vscode-foreground);
    }

    .pod-details-content {
      font-size: 0.875rem;
    }

    .detail-sections {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .detail-section {
      margin-bottom: 24px;
      position: relative;
    }

    .detail-section:last-child {
      margin-bottom: 40px; /* Extra space for last section */
    }

    .detail-section h3 {
      margin: 0px 0px 16px;
      padding: 0px 0px 6px;
      font-size: 16px;
      font-weight: 600;
      color: var(--vscode-foreground);
      border-bottom: 2px solid var(--vscode-focusBorder, var(--vscode-accent, #007acc));
    }

    .section-title {
      margin: 0px 0px 16px;
      padding: 0px 0px 6px;
      font-size: 16px;
      font-weight: 600;
      color: var(--vscode-foreground);
      border-bottom: 2px solid var(--vscode-focusBorder, var(--vscode-accent, #007acc));
      text-transform: capitalize;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-icon {
      width: 16px;
      height: 16px;
      opacity: 0.8;
    }

    .detail-item {
      margin-bottom: 8px;
      padding: 4px 0px;
      border-bottom: 1px solid var(--vscode-widget-border, rgba(128, 128, 128, 0.2));
      display: flex;
      align-items: flex-start;
      gap: 8px;
      line-height: 1.5;
    }

    .detail-item.nested {
      border-left: 3px solid var(--vscode-focusBorder, var(--vscode-accent, #007acc));
      margin-left: 0px;
      background: var(--vscode-list-hoverBackground, rgba(0, 122, 204, 0.05));
      border-radius: 4px;
      padding: 12px;
      margin-bottom: 12px;
      flex-direction: column;
      align-items: stretch;
      border-bottom: none;
    }

    .detail-key {
      font-weight: 600;
      display: inline-block;
      min-width: 140px;
      flex-shrink: 0;
      color: var(--vscode-symbolIcon-variableForeground, var(--vscode-foreground));
    }

    .detail-value {
      flex: 1;
      color: var(--vscode-foreground);
      word-break: break-word;
      display: inline;
    }

    .detail-value.mono {
      font-family: var(--vscode-editor-font-family, 'Consolas', 'Monaco', monospace);
      font-size: 12px;
    }

    /* Nested object styles */
    .nested-object {
      margin-top: 8px;
      padding-left: 16px;
      border-left: 2px solid var(--vscode-widget-border, rgba(128, 128, 128, 0.35));
    }

    .nested-content {
      margin-top: 4px;
    }

    .nested-title {
      font-weight: 500;
      color: var(--vscode-textLink-foreground);
      margin-bottom: 8px;
      font-size: 12px;
      text-transform: capitalize;
    }

    /* Array styles */
    .array-container {
      margin-top: 8px;
    }

    .array-item {
      background: var(--vscode-list-inactiveSelectionBackground, var(--vscode-editor-background, #f3f3f3));
      border: 1px solid var(--vscode-widget-border, rgba(128, 128, 128, 0.35));
      border-radius: 4px;
      padding: 12px;
      margin-bottom: 8px;
      position: relative;
    }

    .array-item:last-child {
      margin-bottom: 0;
    }

    .array-index {
      position: absolute;
      top: 4px;
      right: 8px;
      font-size: 11px;
      color: var(--vscode-badge-foreground, white);
      background: var(--vscode-badge-background, #007acc);
      padding: 2px 6px;
      border-radius: 10px;
    }

    /* Special value styles */
    .value-null,
    .detail-value.null {
      color: var(--vscode-descriptionForeground);
      font-style: italic;
      opacity: 0.7;
    }

    .value-boolean {
      color: var(--vscode-debugTokenExpression-boolean);
    }

    .value-number {
      color: var(--vscode-debugTokenExpression-number);
    }

    .value-string {
      color: var(--vscode-debugTokenExpression-string);
    }

    /* Labels and annotations */
    .label-container,
    .annotation-container {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .label-item,
    .annotation-item {
      background: var(--vscode-badge-background, #007acc);
      color: var(--vscode-badge-foreground, white);
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .annotation-item {
      background: var(--vscode-textBlockQuote-background, rgba(127, 127, 127, 0.1));
      color: var(--vscode-foreground);
      border: 1px solid var(--vscode-widget-border, rgba(128, 128, 128, 0.2));
    }

    .label-key,
    .annotation-key {
      opacity: 0.8;
    }

    /* Status badges */
    .status-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
    }

    .status-badge.running,
    .status-badge.active,
    .status-badge.true {
      background: var(--vscode-testing-iconPassed, #73c991);
      color: var(--vscode-badge-foreground, white);
    }

    .status-badge.pending,
    .status-badge.progressing {
      background: var(--vscode-testing-iconQueued, #cca700);
      color: var(--vscode-badge-foreground, white);
    }

    .status-badge.failed,
    .status-badge.error,
    .status-badge.false {
      background: var(--vscode-testing-iconFailed, #f14c4c);
      color: var(--vscode-badge-foreground, white);
    }

    /* Timestamp */
    .timestamp {
      color: var(--vscode-descriptionForeground);
      font-size: 12px;
      opacity: 0.8;
    }

    /* Code block */
    .code-block,
    .raw-data {
      background: var(--vscode-textCodeBlock-background, var(--vscode-editor-background, #1e1e1e));
      border: 1px solid var(--vscode-widget-border, rgba(128, 128, 128, 0.35));
      border-radius: 4px;
      padding: 12px;
      margin-top: 8px;
      font-family: var(--vscode-editor-font-family, monospace);
      font-size: 12px;
      overflow-x: auto;
      white-space: pre-wrap;
      max-height: 600px;
      overflow-y: auto;
      color: var(--vscode-editor-foreground, var(--vscode-foreground, #d4d4d4));
    }

    details {
      margin-top: 8px;
      position: relative;
      z-index: 1;
    }

    details summary {
      cursor: pointer;
      padding: 8px 12px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border-radius: 4px;
      font-size: 13px;
      font-weight: 500;
      user-select: none;
      transition: all 0.2s;
      display: block;
      outline: none;
      border: 1px solid transparent;
    }

    details summary::-webkit-details-marker {
      display: none;
    }

    details summary::before {
      content: 'â¶';
      display: inline-block;
      margin-right: 8px;
      transition: transform 0.2s;
    }

    details[open] summary::before {
      transform: rotate(90deg);
    }

    details summary:hover {
      background: var(--vscode-button-hoverBackground, #0062a3);
      border-color: var(--vscode-button-border, transparent);
    }

    details[open] summary {
      margin-bottom: 12px;
      border-radius: 4px 4px 0 0;
    }

    /* Collapsible sections */
    .collapsible {
      cursor: pointer;
      user-select: none;
    }

    .collapsible:hover {
      opacity: 0.8;
    }

    .collapse-icon {
      display: inline-block;
      width: 12px;
      height: 12px;
      margin-right: 4px;
      transition: transform 0.2s;
    }

    .collapsed .collapse-icon {
      transform: rotate(-90deg);
    }

    .collapsed-content {
      display: none;
    }

    /* Empty state */
    .empty-value {
      color: var(--vscode-descriptionForeground);
      font-style: italic;
      opacity: 0.7;
    }
  `,Rg([we({type:Object})],Og.prototype,"resource",2),Og=Rg([ve("resource-detail-view")],Og);const Ng=Symbol.for("yaml.alias"),Bg=Symbol.for("yaml.document"),Fg=Symbol.for("yaml.map"),zg=Symbol.for("yaml.pair"),Ug=Symbol.for("yaml.scalar"),Vg=Symbol.for("yaml.seq"),jg=Symbol.for("yaml.node.type"),Hg=e=>!!e&&"object"==typeof e&&e[jg]===Ng,Wg=e=>!!e&&"object"==typeof e&&e[jg]===Bg,qg=e=>!!e&&"object"==typeof e&&e[jg]===Fg,Kg=e=>!!e&&"object"==typeof e&&e[jg]===zg,Gg=e=>!!e&&"object"==typeof e&&e[jg]===Ug,Qg=e=>!!e&&"object"==typeof e&&e[jg]===Vg;function Jg(e){if(e&&"object"==typeof e)switch(e[jg]){case Fg:case Vg:return!0}return!1}function Yg(e){if(e&&"object"==typeof e)switch(e[jg]){case Ng:case Fg:case Ug:case Vg:return!0}return!1}const Xg=e=>(Gg(e)||Jg(e))&&!!e.anchor,Zg=Symbol("break visit"),em=Symbol("skip children"),tm=Symbol("remove node");function sm(e,t){const s=am(t);if(Wg(e)){im(null,e.contents,s,Object.freeze([e]))===tm&&(e.contents=null)}else im(null,e,s,Object.freeze([]))}function im(e,t,s,i){const o=nm(e,t,s,i);if(Yg(o)||Kg(o))return lm(e,i,o),im(e,o,s,i);if("symbol"!=typeof o)if(Jg(t)){i=Object.freeze(i.concat(t));for(let e=0;e<t.items.length;++e){const o=im(e,t.items[e],s,i);if("number"==typeof o)e=o-1;else{if(o===Zg)return Zg;o===tm&&(t.items.splice(e,1),e-=1)}}}else if(Kg(t)){i=Object.freeze(i.concat(t));const e=im("key",t.key,s,i);if(e===Zg)return Zg;e===tm&&(t.key=null);const o=im("value",t.value,s,i);if(o===Zg)return Zg;o===tm&&(t.value=null)}return o}async function om(e,t){const s=am(t);if(Wg(e)){await rm(null,e.contents,s,Object.freeze([e]))===tm&&(e.contents=null)}else await rm(null,e,s,Object.freeze([]))}async function rm(e,t,s,i){const o=await nm(e,t,s,i);if(Yg(o)||Kg(o))return lm(e,i,o),rm(e,o,s,i);if("symbol"!=typeof o)if(Jg(t)){i=Object.freeze(i.concat(t));for(let e=0;e<t.items.length;++e){const o=await rm(e,t.items[e],s,i);if("number"==typeof o)e=o-1;else{if(o===Zg)return Zg;o===tm&&(t.items.splice(e,1),e-=1)}}}else if(Kg(t)){i=Object.freeze(i.concat(t));const e=await rm("key",t.key,s,i);if(e===Zg)return Zg;e===tm&&(t.key=null);const o=await rm("value",t.value,s,i);if(o===Zg)return Zg;o===tm&&(t.value=null)}return o}function am(e){return"object"==typeof e&&(e.Collection||e.Node||e.Value)?Object.assign({Alias:e.Node,Map:e.Node,Scalar:e.Node,Seq:e.Node},e.Value&&{Map:e.Value,Scalar:e.Value,Seq:e.Value},e.Collection&&{Map:e.Collection,Seq:e.Collection},e):e}function nm(e,t,s,i){return"function"==typeof s?s(e,t,i):qg(t)?s.Map?.(e,t,i):Qg(t)?s.Seq?.(e,t,i):Kg(t)?s.Pair?.(e,t,i):Gg(t)?s.Scalar?.(e,t,i):Hg(t)?s.Alias?.(e,t,i):void 0}function lm(e,t,s){const i=t[t.length-1];if(Jg(i))i.items[e]=s;else if(Kg(i))"key"===e?i.key=s:i.value=s;else{if(!Wg(i)){const e=Hg(i)?"alias":"scalar";throw new Error(`Cannot replace node with ${e} parent`)}i.contents=s}}sm.BREAK=Zg,sm.SKIP=em,sm.REMOVE=tm,om.BREAK=Zg,om.SKIP=em,om.REMOVE=tm;const cm={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},dm=e=>e.replace(/[!,[\]{}]/g,e=>cm[e]);class hm{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},hm.defaultYaml,e),this.tags=Object.assign({},hm.defaultTags,t)}clone(){const e=new hm(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){const e=new hm(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:hm.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},hm.defaultTags)}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:hm.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},hm.defaultTags),this.atNextDocument=!1);const s=e.trim().split(/[ \t]+/),i=s.shift();switch(i){case"%TAG":{if(2!==s.length&&(t(0,"%TAG directive should contain exactly two parts"),s.length<2))return!1;const[e,i]=s;return this.tags[e]=i,!0}case"%YAML":{if(this.yaml.explicit=!0,1!==s.length)return t(0,"%YAML directive should contain exactly one part"),!1;const[e]=s;if("1.1"===e||"1.2"===e)return this.yaml.version=e,!0;return t(6,`Unsupported YAML version ${e}`,/^\d+\.\d+$/.test(e)),!1}default:return t(0,`Unknown directive ${i}`,!0),!1}}tagName(e,t){if("!"===e)return"!";if("!"!==e[0])return t(`Not a valid tag: ${e}`),null;if("<"===e[1]){const s=e.slice(2,-1);return"!"===s||"!!"===s?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(">"!==e[e.length-1]&&t("Verbatim tags must end with a >"),s)}const[,s,i]=e.match(/^(.*!)([^!]*)$/s);i||t(`The ${e} tag has no suffix`);const o=this.tags[s];if(o)try{return o+decodeURIComponent(i)}catch(r){return t(String(r)),null}return"!"===s?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(const[t,s]of Object.entries(this.tags))if(e.startsWith(s))return t+dm(e.substring(s.length));return"!"===e[0]?e:`!<${e}>`}toString(e){const t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],s=Object.entries(this.tags);let i;if(e&&s.length>0&&Yg(e.contents)){const t={};sm(e.contents,(e,s)=>{Yg(s)&&s.tag&&(t[s.tag]=!0)}),i=Object.keys(t)}else i=[];for(const[o,r]of s)"!!"===o&&"tag:yaml.org,2002:"===r||e&&!i.some(e=>e.startsWith(r))||t.push(`%TAG ${o} ${r}`);return t.join("\n")}}function um(e){if(/[\x00-\x19\s,[\]{}]/.test(e)){const t=JSON.stringify(e);throw new Error(`Anchor must not contain whitespace or control characters: ${t}`)}return!0}function pm(e){const t=/* @__PURE__ */new Set;return sm(e,{Value(e,s){s.anchor&&t.add(s.anchor)}}),t}function gm(e,t){for(let s=1;;++s){const i=`${e}${s}`;if(!t.has(i))return i}}function mm(e,t,s,i){if(i&&"object"==typeof i)if(Array.isArray(i))for(let o=0,r=i.length;o<r;++o){const t=i[o],s=mm(e,i,String(o),t);void 0===s?delete i[o]:s!==t&&(i[o]=s)}else if(i instanceof Map)for(const o of Array.from(i.keys())){const t=i.get(o),s=mm(e,i,o,t);void 0===s?i.delete(o):s!==t&&i.set(o,s)}else if(i instanceof Set)for(const o of Array.from(i)){const t=mm(e,i,o,o);void 0===t?i.delete(o):t!==o&&(i.delete(o),i.add(t))}else for(const[o,r]of Object.entries(i)){const t=mm(e,i,o,r);void 0===t?delete i[o]:t!==r&&(i[o]=t)}return e.call(t,s,i)}function fm(e,t,s){if(Array.isArray(e))return e.map((e,t)=>fm(e,String(t),s));if(e&&"function"==typeof e.toJSON){if(!s||!Xg(e))return e.toJSON(t,s);const i={aliasCount:0,count:1,res:void 0};s.anchors.set(e,i),s.onCreate=e=>{i.res=e,delete s.onCreate};const o=e.toJSON(t,s);return s.onCreate&&s.onCreate(o),o}return"bigint"!=typeof e||s?.keep?e:Number(e)}hm.defaultYaml={explicit:!1,version:"1.2"},hm.defaultTags={"!!":"tag:yaml.org,2002:"};class vm{constructor(e){Object.defineProperty(this,jg,{value:e})}clone(){const e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:t,maxAliasCount:s,onAnchor:i,reviver:o}={}){if(!Wg(e))throw new TypeError("A document argument is required");const r={anchors:/* @__PURE__ */new Map,doc:e,keep:!0,mapAsMap:!0===t,mapKeyWarned:!1,maxAliasCount:"number"==typeof s?s:100},a=fm(this,"",r);if("function"==typeof i)for(const{count:n,res:l}of r.anchors.values())i(l,n);return"function"==typeof o?mm(o,{"":a},"",a):a}}class bm extends vm{constructor(e){super(Ng),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e,t){let s,i;t?.aliasResolveCache?s=t.aliasResolveCache:(s=[],sm(e,{Node:(e,t)=>{(Hg(t)||Xg(t))&&s.push(t)}}),t&&(t.aliasResolveCache=s));for(const o of s){if(o===this)break;o.anchor===this.source&&(i=o)}return i}toJSON(e,t){if(!t)return{source:this.source};const{anchors:s,doc:i,maxAliasCount:o}=t,r=this.resolve(i,t);if(!r){const e=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(e)}let a=s.get(r);if(a||(fm(r,null,t),a=s.get(r)),!a||void 0===a.res){throw new ReferenceError("This should not happen: Alias anchor was not resolved?")}if(o>=0&&(a.count+=1,0===a.aliasCount&&(a.aliasCount=ym(i,r,s)),a.count*a.aliasCount>o)){throw new ReferenceError("Excessive alias count indicates a resource exhaustion attack")}return a.res}toString(e,t,s){const i=`*${this.source}`;if(e){if(um(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){const e=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(e)}if(e.implicitKey)return`${i} `}return i}}function ym(e,t,s){if(Hg(t)){const i=t.resolve(e),o=s&&i&&s.get(i);return o?o.count*o.aliasCount:0}if(Jg(t)){let i=0;for(const o of t.items){const t=ym(e,o,s);t>i&&(i=t)}return i}if(Kg(t)){const i=ym(e,t.key,s),o=ym(e,t.value,s);return Math.max(i,o)}return 1}const wm=e=>!e||"function"!=typeof e&&"object"!=typeof e;class xm extends vm{constructor(e){super(Ug),this.value=e}toJSON(e,t){return t?.keep?this.value:fm(this.value,e,t)}toString(){return String(this.value)}}xm.BLOCK_FOLDED="BLOCK_FOLDED",xm.BLOCK_LITERAL="BLOCK_LITERAL",xm.PLAIN="PLAIN",xm.QUOTE_DOUBLE="QUOTE_DOUBLE",xm.QUOTE_SINGLE="QUOTE_SINGLE";function _m(e,t,s){if(Wg(e)&&(e=e.contents),Yg(e))return e;if(Kg(e)){const t=s.schema[Fg].createNode?.(s.schema,null,s);return t.items.push(e),t}(e instanceof String||e instanceof Number||e instanceof Boolean||"undefined"!=typeof BigInt&&e instanceof BigInt)&&(e=e.valueOf());const{aliasDuplicateObjects:i,onAnchor:o,onTagObj:r,schema:a,sourceObjects:n}=s;let l;if(i&&e&&"object"==typeof e){if(l=n.get(e),l)return l.anchor??(l.anchor=o(e)),new bm(l.anchor);l={anchor:null,node:null},n.set(e,l)}t?.startsWith("!!")&&(t="tag:yaml.org,2002:"+t.slice(2));let c=function(e,t,s){if(t){const e=s.filter(e=>e.tag===t),i=e.find(e=>!e.format)??e[0];if(!i)throw new Error(`Tag ${t} not found`);return i}return s.find(t=>t.identify?.(e)&&!t.format)}(e,t,a.tags);if(!c){if(e&&"function"==typeof e.toJSON&&(e=e.toJSON()),!e||"object"!=typeof e){const t=new xm(e);return l&&(l.node=t),t}c=e instanceof Map?a[Fg]:Symbol.iterator in Object(e)?a[Vg]:a[Fg]}r&&(r(c),delete s.onTagObj);const d=c?.createNode?c.createNode(s.schema,e,s):"function"==typeof c?.nodeClass?.from?c.nodeClass.from(s.schema,e,s):new xm(e);return t?d.tag=t:c.default||(d.tag=c.tag),l&&(l.node=d),d}function km(e,t,s){let i=s;for(let o=t.length-1;o>=0;--o){const e=t[o];if("number"==typeof e&&Number.isInteger(e)&&e>=0){const t=[];t[e]=i,i=t}else i=/* @__PURE__ */new Map([[e,i]])}return _m(i,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:e,sourceObjects:/* @__PURE__ */new Map})}const Sm=e=>null==e||"object"==typeof e&&!!e[Symbol.iterator]().next().done;class Cm extends vm{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){const t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map(t=>Yg(t)||Kg(t)?t.clone(e):t),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(Sm(e))this.add(t);else{const[s,...i]=e,o=this.get(s,!0);if(Jg(o))o.addIn(i,t);else{if(void 0!==o||!this.schema)throw new Error(`Expected YAML collection at ${s}. Remaining path: ${i}`);this.set(s,km(this.schema,i,t))}}}deleteIn(e){const[t,...s]=e;if(0===s.length)return this.delete(t);const i=this.get(t,!0);if(Jg(i))return i.deleteIn(s);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${s}`)}getIn(e,t){const[s,...i]=e,o=this.get(s,!0);return 0===i.length?!t&&Gg(o)?o.value:o:Jg(o)?o.getIn(i,t):void 0}hasAllNullValues(e){return this.items.every(t=>{if(!Kg(t))return!1;const s=t.value;return null==s||e&&Gg(s)&&null==s.value&&!s.commentBefore&&!s.comment&&!s.tag})}hasIn(e){const[t,...s]=e;if(0===s.length)return this.has(t);const i=this.get(t,!0);return!!Jg(i)&&i.hasIn(s)}setIn(e,t){const[s,...i]=e;if(0===i.length)this.set(s,t);else{const e=this.get(s,!0);if(Jg(e))e.setIn(i,t);else{if(void 0!==e||!this.schema)throw new Error(`Expected YAML collection at ${s}. Remaining path: ${i}`);this.set(s,km(this.schema,i,t))}}}}const $m=e=>e.replace(/^(?!$)(?: $)?/gm,"#");function Dm(e,t){return/^\n+$/.test(e)?e.substring(1):t?e.replace(/^(?! *$)/gm,t):e}const Em=(e,t,s)=>e.endsWith("\n")?Dm(s,t):s.includes("\n")?"\n"+Dm(s,t):(e.endsWith(" ")?"":" ")+s,Mm="flow",Am="block",Im="quoted";function Tm(e,t,s="flow",{indentAtStart:i,lineWidth:o=80,minContentWidth:r=20,onFold:a,onOverflow:n}={}){if(!o||o<0)return e;o<r&&(r=0);const l=Math.max(1+r,1+o-t.length);if(e.length<=l)return e;const c=[],d={};let h,u,p=o-t.length;"number"==typeof i&&(i>o-Math.max(2,r)?c.push(0):p=o-i);let g=!1,m=-1,f=-1,v=-1;s===Am&&(m=Pm(e,m,t.length),-1!==m&&(p=m+l));for(let y;y=e[m+=1];){if(s===Im&&"\\"===y){switch(f=m,e[m+1]){case"x":m+=3;break;case"u":m+=5;break;case"U":m+=9;break;default:m+=1}v=m}if("\n"===y)s===Am&&(m=Pm(e,m,t.length)),p=m+t.length+l,h=void 0;else{if(" "===y&&u&&" "!==u&&"\n"!==u&&"\t"!==u){const t=e[m+1];t&&" "!==t&&"\n"!==t&&"\t"!==t&&(h=m)}if(m>=p)if(h)c.push(h),p=h+l,h=void 0;else if(s===Im){for(;" "===u||"\t"===u;)u=y,y=e[m+=1],g=!0;const t=m>v+1?m-2:f-1;if(d[t])return e;c.push(t),d[t]=!0,p=t+l,h=void 0}else g=!0}u=y}if(g&&n&&n(),0===c.length)return e;a&&a();let b=e.slice(0,c[0]);for(let y=0;y<c.length;++y){const i=c[y],o=c[y+1]||e.length;0===i?b=`\n${t}${e.slice(0,o)}`:(s===Im&&d[i]&&(b+=`${e[i]}\\`),b+=`\n${t}${e.slice(i+1,o)}`)}return b}function Pm(e,t,s){let i=t,o=t+1,r=e[o];for(;" "===r||"\t"===r;)if(t<o+s)r=e[++t];else{do{r=e[++t]}while(r&&"\n"!==r);i=t,o=t+1,r=e[o]}return i}const Lm=(e,t)=>({indentAtStart:t?e.indent.length:e.indentAtStart,lineWidth:e.options.lineWidth,minContentWidth:e.options.minContentWidth}),Rm=e=>/^(%|---|\.\.\.)/m.test(e);function Om(e,t){const s=JSON.stringify(e);if(t.options.doubleQuotedAsJSON)return s;const{implicitKey:i}=t,o=t.options.doubleQuotedMinMultiLineLength,r=t.indent||(Rm(e)?"  ":"");let a="",n=0;for(let l=0,c=s[l];c;c=s[++l])if(" "===c&&"\\"===s[l+1]&&"n"===s[l+2]&&(a+=s.slice(n,l)+"\\ ",l+=1,n=l,c="\\"),"\\"===c)switch(s[l+1]){case"u":{a+=s.slice(n,l);const e=s.substr(l+2,4);switch(e){case"0000":a+="\\0";break;case"0007":a+="\\a";break;case"000b":a+="\\v";break;case"001b":a+="\\e";break;case"0085":a+="\\N";break;case"00a0":a+="\\_";break;case"2028":a+="\\L";break;case"2029":a+="\\P";break;default:"00"===e.substr(0,2)?a+="\\x"+e.substr(2):a+=s.substr(l,6)}l+=5,n=l+1}break;case"n":if(i||'"'===s[l+2]||s.length<o)l+=1;else{for(a+=s.slice(n,l)+"\n\n";"\\"===s[l+2]&&"n"===s[l+3]&&'"'!==s[l+4];)a+="\n",l+=2;a+=r," "===s[l+2]&&(a+="\\"),l+=1,n=l+1}break;default:l+=1}return a=n?a+s.slice(n):s,i?a:Tm(a,r,Im,Lm(t,!1))}function Nm(e,t){if(!1===t.options.singleQuote||t.implicitKey&&e.includes("\n")||/[ \t]\n|\n[ \t]/.test(e))return Om(e,t);const s=t.indent||(Rm(e)?"  ":""),i="'"+e.replace(/'/g,"''").replace(/\n+/g,`$&\n${s}`)+"'";return t.implicitKey?i:Tm(i,s,Mm,Lm(t,!1))}function Bm(e,t){const{singleQuote:s}=t.options;let i;if(!1===s)i=Om;else{const t=e.includes('"'),o=e.includes("'");i=t&&!o?Nm:o&&!t?Om:s?Nm:Om}return i(e,t)}let Fm;try{Fm=new RegExp("(^|(?<!\n))\n+(?!\n|$)","g")}catch{Fm=/\n+(?!\n|$)/g}function zm({comment:e,type:t,value:s},i,o,r){const{blockQuote:a,commentString:n,lineWidth:l}=i.options;if(!a||/\n[\t ]+$/.test(s))return Bm(s,i);const c=i.indent||(i.forceBlockIndent||Rm(s)?"  ":""),d="literal"===a||"folded"!==a&&t!==xm.BLOCK_FOLDED&&(t===xm.BLOCK_LITERAL||!function(e,t,s){if(!t||t<0)return!1;const i=t-s,o=e.length;if(o<=i)return!1;for(let r=0,a=0;r<o;++r)if("\n"===e[r]){if(r-a>i)return!0;if(a=r+1,o-a<=i)return!1}return!0}(s,l,c.length));if(!s)return d?"|\n":">\n";let h,u;for(u=s.length;u>0;--u){const e=s[u-1];if("\n"!==e&&"\t"!==e&&" "!==e)break}let p=s.substring(u);const g=p.indexOf("\n");-1===g?h="-":s===p||g!==p.length-1?(h="+",r&&r()):h="",p&&(s=s.slice(0,-p.length),"\n"===p[p.length-1]&&(p=p.slice(0,-1)),p=p.replace(Fm,`$&${c}`));let m,f=!1,v=-1;for(m=0;m<s.length;++m){const e=s[m];if(" "===e)f=!0;else{if("\n"!==e)break;v=m}}let b=s.substring(0,v<m?v+1:m);b&&(s=s.substring(b.length),b=b.replace(/\n+/g,`$&${c}`));let y=(f?c?"2":"1":"")+h;if(e&&(y+=" "+n(e.replace(/ ?[\r\n]+/g," ")),o&&o()),!d){const e=s.replace(/\n+/g,"\n$&").replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${c}`);let o=!1;const r=Lm(i,!0);"folded"!==a&&t!==xm.BLOCK_FOLDED&&(r.onOverflow=()=>{o=!0});const n=Tm(`${b}${e}${p}`,c,Am,r);if(!o)return`>${y}\n${c}${n}`}return`|${y}\n${c}${b}${s=s.replace(/\n+/g,`$&${c}`)}${p}`}function Um(e,t,s,i){const{implicitKey:o,inFlow:r}=t,a="string"==typeof e.value?e:Object.assign({},e,{value:String(e.value)});let{type:n}=e;n!==xm.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(a.value)&&(n=xm.QUOTE_DOUBLE);const l=e=>{switch(e){case xm.BLOCK_FOLDED:case xm.BLOCK_LITERAL:return o||r?Bm(a.value,t):zm(a,t,s,i);case xm.QUOTE_DOUBLE:return Om(a.value,t);case xm.QUOTE_SINGLE:return Nm(a.value,t);case xm.PLAIN:return function(e,t,s,i){const{type:o,value:r}=e,{actualString:a,implicitKey:n,indent:l,indentStep:c,inFlow:d}=t;if(n&&r.includes("\n")||d&&/[[\]{},]/.test(r))return Bm(r,t);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(r))return n||d||!r.includes("\n")?Bm(r,t):zm(e,t,s,i);if(!n&&!d&&o!==xm.PLAIN&&r.includes("\n"))return zm(e,t,s,i);if(Rm(r)){if(""===l)return t.forceBlockIndent=!0,zm(e,t,s,i);if(n&&l===c)return Bm(r,t)}const h=r.replace(/\n+/g,`$&\n${l}`);if(a){const e=e=>e.default&&"tag:yaml.org,2002:str"!==e.tag&&e.test?.test(h),{compat:s,tags:i}=t.doc.schema;if(i.some(e)||s?.some(e))return Bm(r,t)}return n?h:Tm(h,l,Mm,Lm(t,!1))}(a,t,s,i);default:return null}};let c=l(n);if(null===c){const{defaultKeyType:e,defaultStringType:s}=t.options,i=o&&e||s;if(c=l(i),null===c)throw new Error(`Unsupported default string type ${i}`)}return c}function Vm(e,t){const s=Object.assign({blockQuote:!0,commentString:$m,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},e.schema.toStringOptions,t);let i;switch(s.collectionStyle){case"block":i=!1;break;case"flow":i=!0;break;default:i=null}return{anchors:/* @__PURE__ */new Set,doc:e,flowCollectionPadding:s.flowCollectionPadding?" ":"",indent:"",indentStep:"number"==typeof s.indent?" ".repeat(s.indent):"  ",inFlow:i,options:s}}function jm(e,t,s,i){if(Kg(e))return e.toString(t,s,i);if(Hg(e)){if(t.doc.directives)return e.toString(t);if(t.resolvedAliases?.has(e))throw new TypeError("Cannot stringify circular structure without alias nodes");t.resolvedAliases?t.resolvedAliases.add(e):t.resolvedAliases=/* @__PURE__ */new Set([e]),e=e.resolve(t.doc)}let o;const r=Yg(e)?e:t.doc.createNode(e,{onTagObj:e=>o=e});o??(o=function(e,t){if(t.tag){const s=e.filter(e=>e.tag===t.tag);if(s.length>0)return s.find(e=>e.format===t.format)??s[0]}let s,i;if(Gg(t)){i=t.value;let o=e.filter(e=>e.identify?.(i));if(o.length>1){const e=o.filter(e=>e.test);e.length>0&&(o=e)}s=o.find(e=>e.format===t.format)??o.find(e=>!e.format)}else i=t,s=e.find(e=>e.nodeClass&&i instanceof e.nodeClass);if(!s)throw new Error(`Tag not resolved for ${i?.constructor?.name??(null===i?"null":typeof i)} value`);return s}(t.doc.schema.tags,r));const a=function(e,t,{anchors:s,doc:i}){if(!i.directives)return"";const o=[],r=(Gg(e)||Jg(e))&&e.anchor;r&&um(r)&&(s.add(r),o.push(`&${r}`));const a=e.tag??(t.default?null:t.tag);return a&&o.push(i.directives.tagString(a)),o.join(" ")}(r,o,t);a.length>0&&(t.indentAtStart=(t.indentAtStart??0)+a.length+1);const n="function"==typeof o.stringify?o.stringify(r,t,s,i):Gg(r)?Um(r,t,s,i):r.toString(t,s,i);return a?Gg(r)||"{"===n[0]||"["===n[0]?`${a} ${n}`:`${a}\n${t.indent}${n}`:n}function Hm(e,t){"debug"!==e&&"warn"!==e||console.warn(t)}const Wm="<<",qm={identify:e=>e===Wm||"symbol"==typeof e&&e.description===Wm,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new xm(Symbol(Wm)),{addToJSMap:Km}),stringify:()=>Wm};function Km(e,t,s){if(s=e&&Hg(s)?s.resolve(e.doc):s,Qg(s))for(const i of s.items)Gm(e,t,i);else if(Array.isArray(s))for(const i of s)Gm(e,t,i);else Gm(e,t,s)}function Gm(e,t,s){const i=e&&Hg(s)?s.resolve(e.doc):s;if(!qg(i))throw new Error("Merge sources must be maps or map aliases");const o=i.toJSON(null,e,Map);for(const[r,a]of o)t instanceof Map?t.has(r)||t.set(r,a):t instanceof Set?t.add(r):Object.prototype.hasOwnProperty.call(t,r)||Object.defineProperty(t,r,{value:a,writable:!0,enumerable:!0,configurable:!0});return t}function Qm(e,t,{key:s,value:i}){if(Yg(s)&&s.addToJSMap)s.addToJSMap(e,t,i);else if(((e,t)=>(qm.identify(t)||Gg(t)&&(!t.type||t.type===xm.PLAIN)&&qm.identify(t.value))&&e?.doc.schema.tags.some(e=>e.tag===qm.tag&&e.default))(e,s))Km(e,t,i);else{const o=fm(s,"",e);if(t instanceof Map)t.set(o,fm(i,o,e));else if(t instanceof Set)t.add(o);else{const r=function(e,t,s){if(null===t)return"";if("object"!=typeof t)return String(t);if(Yg(e)&&s?.doc){const t=Vm(s.doc,{});t.anchors=/* @__PURE__ */new Set;for(const e of s.anchors.keys())t.anchors.add(e.anchor);t.inFlow=!0,t.inStringifyKey=!0;const i=e.toString(t);if(!s.mapKeyWarned){let e=JSON.stringify(i);e.length>40&&(e=e.substring(0,36)+'..."'),Hm(s.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${e}. Set mapAsMap: true to use object keys.`),s.mapKeyWarned=!0}return i}return JSON.stringify(t)}(s,o,e),a=fm(i,r,e);r in t?Object.defineProperty(t,r,{value:a,writable:!0,enumerable:!0,configurable:!0}):t[r]=a}}return t}function Jm(e,t,s){const i=_m(e,void 0,s),o=_m(t,void 0,s);return new Ym(i,o)}class Ym{constructor(e,t=null){Object.defineProperty(this,jg,{value:zg}),this.key=e,this.value=t}clone(e){let{key:t,value:s}=this;return Yg(t)&&(t=t.clone(e)),Yg(s)&&(s=s.clone(e)),new Ym(t,s)}toJSON(e,t){return Qm(t,t?.mapAsMap?/* @__PURE__ */new Map:{},this)}toString(e,t,s){return e?.doc?function({key:e,value:t},s,i,o){const{allNullValues:r,doc:a,indent:n,indentStep:l,options:{commentString:c,indentSeq:d,simpleKeys:h}}=s;let u=Yg(e)&&e.comment||null;if(h){if(u)throw new Error("With simple keys, key nodes cannot have comments");if(Jg(e)||!Yg(e)&&"object"==typeof e)throw new Error("With simple keys, collection cannot be used as a key value")}let p=!h&&(!e||u&&null==t&&!s.inFlow||Jg(e)||(Gg(e)?e.type===xm.BLOCK_FOLDED||e.type===xm.BLOCK_LITERAL:"object"==typeof e));s=Object.assign({},s,{allNullValues:!1,implicitKey:!p&&(h||!r),indent:n+l});let g,m,f,v=!1,b=!1,y=jm(e,s,()=>v=!0,()=>b=!0);if(!p&&!s.inFlow&&y.length>1024){if(h)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");p=!0}if(s.inFlow){if(r||null==t)return v&&i&&i(),""===y?"?":p?`? ${y}`:y}else if(r&&!h||null==t&&p)return y=`? ${y}`,u&&!v?y+=Em(y,s.indent,c(u)):b&&o&&o(),y;v&&(u=null),p?(u&&(y+=Em(y,s.indent,c(u))),y=`? ${y}\n${n}:`):(y=`${y}:`,u&&(y+=Em(y,s.indent,c(u)))),Yg(t)?(g=!!t.spaceBefore,m=t.commentBefore,f=t.comment):(g=!1,m=null,f=null,t&&"object"==typeof t&&(t=a.createNode(t))),s.implicitKey=!1,p||u||!Gg(t)||(s.indentAtStart=y.length+1),b=!1,d||!(l.length>=2)||s.inFlow||p||!Qg(t)||t.flow||t.tag||t.anchor||(s.indent=s.indent.substring(2));let w=!1;const x=jm(t,s,()=>w=!0,()=>b=!0);let _=" ";if(u||g||m)_=g?"\n":"",m&&(_+=`\n${Dm(c(m),s.indent)}`),""!==x||s.inFlow?_+=`\n${s.indent}`:"\n"===_&&(_="\n\n");else if(!p&&Jg(t)){const e=x[0],i=x.indexOf("\n"),o=-1!==i,r=s.inFlow??t.flow??0===t.items.length;if(o||!r){let t=!1;if(o&&("&"===e||"!"===e)){let s=x.indexOf(" ");"&"===e&&-1!==s&&s<i&&"!"===x[s+1]&&(s=x.indexOf(" ",s+1)),(-1===s||i<s)&&(t=!0)}t||(_=`\n${s.indent}`)}}else""!==x&&"\n"!==x[0]||(_="");return y+=_+x,s.inFlow?w&&i&&i():f&&!w?y+=Em(y,s.indent,c(f)):b&&o&&o(),y}(this,e,t,s):JSON.stringify(this)}}function Xm(e,t,s){return(t.inFlow??e.flow?ef:Zm)(e,t,s)}function Zm({comment:e,items:t},s,{blockItemPrefix:i,flowChars:o,itemIndent:r,onChompKeep:a,onComment:n}){const{indent:l,options:{commentString:c}}=s,d=Object.assign({},s,{indent:r,type:null});let h=!1;const u=[];for(let g=0;g<t.length;++g){const e=t[g];let o=null;if(Yg(e))!h&&e.spaceBefore&&u.push(""),tf(s,u,e.commentBefore,h),e.comment&&(o=e.comment);else if(Kg(e)){const t=Yg(e.key)?e.key:null;t&&(!h&&t.spaceBefore&&u.push(""),tf(s,u,t.commentBefore,h))}h=!1;let a=jm(e,d,()=>o=null,()=>h=!0);o&&(a+=Em(a,r,c(o))),h&&o&&(h=!1),u.push(i+a)}let p;if(0===u.length)p=o.start+o.end;else{p=u[0];for(let e=1;e<u.length;++e){const t=u[e];p+=t?`\n${l}${t}`:"\n"}}return e?(p+="\n"+Dm(c(e),l),n&&n()):h&&a&&a(),p}function ef({items:e},t,{flowChars:s,itemIndent:i}){const{indent:o,indentStep:r,flowCollectionPadding:a,options:{commentString:n}}=t;i+=r;const l=Object.assign({},t,{indent:i,inFlow:!0,type:null});let c=!1,d=0;const h=[];for(let g=0;g<e.length;++g){const s=e[g];let o=null;if(Yg(s))s.spaceBefore&&h.push(""),tf(t,h,s.commentBefore,!1),s.comment&&(o=s.comment);else if(Kg(s)){const e=Yg(s.key)?s.key:null;e&&(e.spaceBefore&&h.push(""),tf(t,h,e.commentBefore,!1),e.comment&&(c=!0));const i=Yg(s.value)?s.value:null;i?(i.comment&&(o=i.comment),i.commentBefore&&(c=!0)):null==s.value&&e?.comment&&(o=e.comment)}o&&(c=!0);let r=jm(s,l,()=>o=null);g<e.length-1&&(r+=","),o&&(r+=Em(r,i,n(o))),!c&&(h.length>d||r.includes("\n"))&&(c=!0),h.push(r),d=h.length}const{start:u,end:p}=s;if(0===h.length)return u+p;if(!c){const e=h.reduce((e,t)=>e+t.length+2,2);c=t.options.lineWidth>0&&e>t.options.lineWidth}if(c){let e=u;for(const t of h)e+=t?`\n${r}${o}${t}`:"\n";return`${e}\n${o}${p}`}return`${u}${a}${h.join(" ")}${a}${p}`}function tf({indent:e,options:{commentString:t}},s,i,o){if(i&&o&&(i=i.replace(/^\n+/,"")),i){const o=Dm(t(i),e);s.push(o.trimStart())}}function sf(e,t){const s=Gg(t)?t.value:t;for(const i of e)if(Kg(i)){if(i.key===t||i.key===s)return i;if(Gg(i.key)&&i.key.value===s)return i}}class of extends Cm{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(Fg,e),this.items=[]}static from(e,t,s){const{keepUndefined:i,replacer:o}=s,r=new this(e),a=(e,a)=>{if("function"==typeof o)a=o.call(t,e,a);else if(Array.isArray(o)&&!o.includes(e))return;(void 0!==a||i)&&r.items.push(Jm(e,a,s))};if(t instanceof Map)for(const[n,l]of t)a(n,l);else if(t&&"object"==typeof t)for(const n of Object.keys(t))a(n,t[n]);return"function"==typeof e.sortMapEntries&&r.items.sort(e.sortMapEntries),r}add(e,t){let s;s=Kg(e)?e:e&&"object"==typeof e&&"key"in e?new Ym(e.key,e.value):new Ym(e,e?.value);const i=sf(this.items,s.key),o=this.schema?.sortMapEntries;if(i){if(!t)throw new Error(`Key ${s.key} already set`);Gg(i.value)&&wm(s.value)?i.value.value=s.value:i.value=s.value}else if(o){const e=this.items.findIndex(e=>o(s,e)<0);-1===e?this.items.push(s):this.items.splice(e,0,s)}else this.items.push(s)}delete(e){const t=sf(this.items,e);if(!t)return!1;return this.items.splice(this.items.indexOf(t),1).length>0}get(e,t){const s=sf(this.items,e),i=s?.value;return(!t&&Gg(i)?i.value:i)??void 0}has(e){return!!sf(this.items,e)}set(e,t){this.add(new Ym(e,t),!0)}toJSON(e,t,s){const i=s?new s:t?.mapAsMap?/* @__PURE__ */new Map:{};t?.onCreate&&t.onCreate(i);for(const o of this.items)Qm(t,i,o);return i}toString(e,t,s){if(!e)return JSON.stringify(this);for(const i of this.items)if(!Kg(i))throw new Error(`Map items must all be pairs; found ${JSON.stringify(i)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),Xm(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:s,onComment:t})}}const rf={collection:"map",default:!0,nodeClass:of,tag:"tag:yaml.org,2002:map",resolve:(e,t)=>(qg(e)||t("Expected a mapping for this tag"),e),createNode:(e,t,s)=>of.from(e,t,s)};class af extends Cm{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(Vg,e),this.items=[]}add(e){this.items.push(e)}delete(e){const t=nf(e);if("number"!=typeof t)return!1;return this.items.splice(t,1).length>0}get(e,t){const s=nf(e);if("number"!=typeof s)return;const i=this.items[s];return!t&&Gg(i)?i.value:i}has(e){const t=nf(e);return"number"==typeof t&&t<this.items.length}set(e,t){const s=nf(e);if("number"!=typeof s)throw new Error(`Expected a valid index, not ${e}.`);const i=this.items[s];Gg(i)&&wm(t)?i.value=t:this.items[s]=t}toJSON(e,t){const s=[];t?.onCreate&&t.onCreate(s);let i=0;for(const o of this.items)s.push(fm(o,String(i++),t));return s}toString(e,t,s){return e?Xm(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:s,onComment:t}):JSON.stringify(this)}static from(e,t,s){const{replacer:i}=s,o=new this(e);if(t&&Symbol.iterator in Object(t)){let e=0;for(let r of t){if("function"==typeof i){const s=t instanceof Set?r:String(e++);r=i.call(t,s,r)}o.items.push(_m(r,void 0,s))}}return o}}function nf(e){let t=Gg(e)?e.value:e;return t&&"string"==typeof t&&(t=Number(t)),"number"==typeof t&&Number.isInteger(t)&&t>=0?t:null}const lf={collection:"seq",default:!0,nodeClass:af,tag:"tag:yaml.org,2002:seq",resolve:(e,t)=>(Qg(e)||t("Expected a sequence for this tag"),e),createNode:(e,t,s)=>af.from(e,t,s)},cf={identify:e=>"string"==typeof e,default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify:(e,t,s,i)=>Um(e,t=Object.assign({actualString:!0},t),s,i)},df={identify:e=>null==e,createNode:()=>new xm(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new xm(null),stringify:({source:e},t)=>"string"==typeof e&&df.test.test(e)?e:t.options.nullStr},hf={identify:e=>"boolean"==typeof e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:e=>new xm("t"===e[0]||"T"===e[0]),stringify({source:e,value:t},s){if(e&&hf.test.test(e)){if(t===("t"===e[0]||"T"===e[0]))return e}return t?s.options.trueStr:s.options.falseStr}};function uf({format:e,minFractionDigits:t,tag:s,value:i}){if("bigint"==typeof i)return String(i);const o="number"==typeof i?i:Number(i);if(!isFinite(o))return isNaN(o)?".nan":o<0?"-.inf":".inf";let r=JSON.stringify(i);if(!e&&t&&(!s||"tag:yaml.org,2002:float"===s)&&/^\d/.test(r)){let e=r.indexOf(".");e<0&&(e=r.length,r+=".");let s=t-(r.length-e-1);for(;s-- >0;)r+="0"}return r}const pf={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:e=>"nan"===e.slice(-3).toLowerCase()?NaN:"-"===e[0]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:uf},gf={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e),stringify(e){const t=Number(e.value);return isFinite(t)?t.toExponential():uf(e)}},mf={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(e){const t=new xm(parseFloat(e)),s=e.indexOf(".");return-1!==s&&"0"===e[e.length-1]&&(t.minFractionDigits=e.length-s-1),t},stringify:uf},ff=e=>"bigint"==typeof e||Number.isInteger(e),vf=(e,t,s,{intAsBigInt:i})=>i?BigInt(e):parseInt(e.substring(t),s);function bf(e,t,s){const{value:i}=e;return ff(i)&&i>=0?s+i.toString(t):uf(e)}const yf={identify:e=>ff(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(e,t,s)=>vf(e,2,8,s),stringify:e=>bf(e,8,"0o")},wf={identify:ff,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(e,t,s)=>vf(e,0,10,s),stringify:uf},xf={identify:e=>ff(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(e,t,s)=>vf(e,2,16,s),stringify:e=>bf(e,16,"0x")},_f=[rf,lf,cf,df,hf,yf,wf,xf,pf,gf,mf];function kf(e){return"bigint"==typeof e||Number.isInteger(e)}const Sf=({value:e})=>JSON.stringify(e),Cf=[rf,lf].concat([{identify:e=>"string"==typeof e,default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify:Sf},{identify:e=>null==e,createNode:()=>new xm(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:Sf},{identify:e=>"boolean"==typeof e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:e=>"true"===e,stringify:Sf},{identify:kf,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(e,t,{intAsBigInt:s})=>s?BigInt(e):parseInt(e,10),stringify:({value:e})=>kf(e)?e.toString():JSON.stringify(e)},{identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:e=>parseFloat(e),stringify:Sf}],{default:!0,tag:"",test:/^/,resolve:(e,t)=>(t(`Unresolved plain scalar ${JSON.stringify(e)}`),e)}),$f={identify:e=>e instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(e,t){if("function"==typeof atob){const t=atob(e.replace(/[\n\r]/g,"")),s=new Uint8Array(t.length);for(let e=0;e<t.length;++e)s[e]=t.charCodeAt(e);return s}return t("This environment does not support reading binary tags; either Buffer or atob is required"),e},stringify({comment:e,type:t,value:s},i,o,r){if(!s)return"";const a=s;let n;if("function"!=typeof btoa)throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");{let e="";for(let t=0;t<a.length;++t)e+=String.fromCharCode(a[t]);n=btoa(e)}if(t??(t=xm.BLOCK_LITERAL),t!==xm.QUOTE_DOUBLE){const e=Math.max(i.options.lineWidth-i.indent.length,i.options.minContentWidth),s=Math.ceil(n.length/e),o=new Array(s);for(let t=0,i=0;t<s;++t,i+=e)o[t]=n.substr(i,e);n=o.join(t===xm.BLOCK_LITERAL?"\n":" ")}return Um({comment:e,type:t,value:n},i,o,r)}};function Df(e,t){if(Qg(e))for(let s=0;s<e.items.length;++s){let i=e.items[s];if(!Kg(i)){if(qg(i)){i.items.length>1&&t("Each pair must have its own sequence indicator");const e=i.items[0]||new Ym(new xm(null));if(i.commentBefore&&(e.key.commentBefore=e.key.commentBefore?`${i.commentBefore}\n${e.key.commentBefore}`:i.commentBefore),i.comment){const t=e.value??e.key;t.comment=t.comment?`${i.comment}\n${t.comment}`:i.comment}i=e}e.items[s]=Kg(i)?i:new Ym(i)}}else t("Expected a sequence for this tag");return e}function Ef(e,t,s){const{replacer:i}=s,o=new af(e);o.tag="tag:yaml.org,2002:pairs";let r=0;if(t&&Symbol.iterator in Object(t))for(let a of t){let e,n;if("function"==typeof i&&(a=i.call(t,String(r++),a)),Array.isArray(a)){if(2!==a.length)throw new TypeError(`Expected [key, value] tuple: ${a}`);e=a[0],n=a[1]}else if(a&&a instanceof Object){const t=Object.keys(a);if(1!==t.length)throw new TypeError(`Expected tuple with one key, not ${t.length} keys`);e=t[0],n=a[e]}else e=a;o.items.push(Jm(e,n,s))}return o}const Mf={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:Df,createNode:Ef};class Af extends af{constructor(){super(),this.add=of.prototype.add.bind(this),this.delete=of.prototype.delete.bind(this),this.get=of.prototype.get.bind(this),this.has=of.prototype.has.bind(this),this.set=of.prototype.set.bind(this),this.tag=Af.tag}toJSON(e,t){if(!t)return super.toJSON(e);const s=/* @__PURE__ */new Map;t?.onCreate&&t.onCreate(s);for(const i of this.items){let e,o;if(Kg(i)?(e=fm(i.key,"",t),o=fm(i.value,e,t)):e=fm(i,"",t),s.has(e))throw new Error("Ordered maps must not include duplicate keys");s.set(e,o)}return s}static from(e,t,s){const i=Ef(e,t,s),o=new this;return o.items=i.items,o}}Af.tag="tag:yaml.org,2002:omap";const If={collection:"seq",identify:e=>e instanceof Map,nodeClass:Af,default:!1,tag:"tag:yaml.org,2002:omap",resolve(e,t){const s=Df(e,t),i=[];for(const{key:o}of s.items)Gg(o)&&(i.includes(o.value)?t(`Ordered maps must not include duplicate keys: ${o.value}`):i.push(o.value));return Object.assign(new Af,s)},createNode:(e,t,s)=>Af.from(e,t,s)};function Tf({value:e,source:t},s){return t&&(e?Pf:Lf).test.test(t)?t:e?s.options.trueStr:s.options.falseStr}const Pf={identify:e=>!0===e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new xm(!0),stringify:Tf},Lf={identify:e=>!1===e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new xm(!1),stringify:Tf},Rf={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:e=>"nan"===e.slice(-3).toLowerCase()?NaN:"-"===e[0]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:uf},Of={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e.replace(/_/g,"")),stringify(e){const t=Number(e.value);return isFinite(t)?t.toExponential():uf(e)}},Nf={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(e){const t=new xm(parseFloat(e.replace(/_/g,""))),s=e.indexOf(".");if(-1!==s){const i=e.substring(s+1).replace(/_/g,"");"0"===i[i.length-1]&&(t.minFractionDigits=i.length)}return t},stringify:uf},Bf=e=>"bigint"==typeof e||Number.isInteger(e);function Ff(e,t,s,{intAsBigInt:i}){const o=e[0];if("-"!==o&&"+"!==o||(t+=1),e=e.substring(t).replace(/_/g,""),i){switch(s){case 2:e=`0b${e}`;break;case 8:e=`0o${e}`;break;case 16:e=`0x${e}`}const t=BigInt(e);return"-"===o?BigInt(-1)*t:t}const r=parseInt(e,s);return"-"===o?-1*r:r}function zf(e,t,s){const{value:i}=e;if(Bf(i)){const e=i.toString(t);return i<0?"-"+s+e.substr(1):s+e}return uf(e)}const Uf={identify:Bf,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(e,t,s)=>Ff(e,2,2,s),stringify:e=>zf(e,2,"0b")},Vf={identify:Bf,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(e,t,s)=>Ff(e,1,8,s),stringify:e=>zf(e,8,"0")},jf={identify:Bf,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(e,t,s)=>Ff(e,0,10,s),stringify:uf},Hf={identify:Bf,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(e,t,s)=>Ff(e,2,16,s),stringify:e=>zf(e,16,"0x")};class Wf extends of{constructor(e){super(e),this.tag=Wf.tag}add(e){let t;t=Kg(e)?e:e&&"object"==typeof e&&"key"in e&&"value"in e&&null===e.value?new Ym(e.key,null):new Ym(e,null);sf(this.items,t.key)||this.items.push(t)}get(e,t){const s=sf(this.items,e);return!t&&Kg(s)?Gg(s.key)?s.key.value:s.key:s}set(e,t){if("boolean"!=typeof t)throw new Error("Expected boolean value for set(key, value) in a YAML set, not "+typeof t);const s=sf(this.items,e);s&&!t?this.items.splice(this.items.indexOf(s),1):!s&&t&&this.items.push(new Ym(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,s){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,s);throw new Error("Set items must all have null values")}static from(e,t,s){const{replacer:i}=s,o=new this(e);if(t&&Symbol.iterator in Object(t))for(let r of t)"function"==typeof i&&(r=i.call(t,r,r)),o.items.push(Jm(r,null,s));return o}}Wf.tag="tag:yaml.org,2002:set";const qf={collection:"map",identify:e=>e instanceof Set,nodeClass:Wf,default:!1,tag:"tag:yaml.org,2002:set",createNode:(e,t,s)=>Wf.from(e,t,s),resolve(e,t){if(qg(e)){if(e.hasAllNullValues(!0))return Object.assign(new Wf,e);t("Set items must all have null values")}else t("Expected a mapping for this tag");return e}};function Kf(e,t){const s=e[0],i="-"===s||"+"===s?e.substring(1):e,o=e=>t?BigInt(e):Number(e),r=i.replace(/_/g,"").split(":").reduce((e,t)=>e*o(60)+o(t),o(0));return"-"===s?o(-1)*r:r}function Gf(e){let{value:t}=e,s=e=>e;if("bigint"==typeof t)s=e=>BigInt(e);else if(isNaN(t)||!isFinite(t))return uf(e);let i="";t<0&&(i="-",t*=s(-1));const o=s(60),r=[t%o];return t<60?r.unshift(0):(t=(t-r[0])/o,r.unshift(t%o),t>=60&&(t=(t-r[0])/o,r.unshift(t))),i+r.map(e=>String(e).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const Qf={identify:e=>"bigint"==typeof e||Number.isInteger(e),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(e,t,{intAsBigInt:s})=>Kf(e,s),stringify:Gf},Jf={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:e=>Kf(e,!1),stringify:Gf},Yf={identify:e=>e instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(e){const t=e.match(Yf.test);if(!t)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,s,i,o,r,a,n]=t.map(Number),l=t[7]?Number((t[7]+"00").substr(1,3)):0;let c=Date.UTC(s,i-1,o,r||0,a||0,n||0,l);const d=t[8];if(d&&"Z"!==d){let e=Kf(d,!1);Math.abs(e)<30&&(e*=60),c-=6e4*e}return new Date(c)},stringify:({value:e})=>e?.toISOString().replace(/(T00:00:00)?\.000Z$/,"")??""},Xf=[rf,lf,cf,df,Pf,Lf,Uf,Vf,jf,Hf,Rf,Of,Nf,$f,qm,If,Mf,qf,Qf,Jf,Yf],Zf=/* @__PURE__ */new Map([["core",_f],["failsafe",[rf,lf,cf]],["json",Cf],["yaml11",Xf],["yaml-1.1",Xf]]),ev={binary:$f,bool:hf,float:mf,floatExp:gf,floatNaN:pf,floatTime:Jf,int:wf,intHex:xf,intOct:yf,intTime:Qf,map:rf,merge:qm,null:df,omap:If,pairs:Mf,seq:lf,set:qf,timestamp:Yf},tv={"tag:yaml.org,2002:binary":$f,"tag:yaml.org,2002:merge":qm,"tag:yaml.org,2002:omap":If,"tag:yaml.org,2002:pairs":Mf,"tag:yaml.org,2002:set":qf,"tag:yaml.org,2002:timestamp":Yf};function sv(e,t,s){const i=Zf.get(t);if(i&&!e)return s&&!i.includes(qm)?i.concat(qm):i.slice();let o=i;if(!o){if(!Array.isArray(e)){const e=Array.from(Zf.keys()).filter(e=>"yaml11"!==e).map(e=>JSON.stringify(e)).join(", ");throw new Error(`Unknown schema "${t}"; use one of ${e} or define customTags array`)}o=[]}if(Array.isArray(e))for(const r of e)o=o.concat(r);else"function"==typeof e&&(o=e(o.slice()));return s&&(o=o.concat(qm)),o.reduce((e,t)=>{const s="string"==typeof t?ev[t]:t;if(!s){const e=JSON.stringify(t),s=Object.keys(ev).map(e=>JSON.stringify(e)).join(", ");throw new Error(`Unknown custom tag ${e}; use one of ${s}`)}return e.includes(s)||e.push(s),e},[])}const iv=(e,t)=>e.key<t.key?-1:e.key>t.key?1:0;class ov{constructor({compat:e,customTags:t,merge:s,resolveKnownTags:i,schema:o,sortMapEntries:r,toStringDefaults:a}){this.compat=Array.isArray(e)?sv(e,"compat"):e?sv(null,e):null,this.name="string"==typeof o&&o||"core",this.knownTags=i?tv:{},this.tags=sv(t,this.name,s),this.toStringOptions=a??null,Object.defineProperty(this,Fg,{value:rf}),Object.defineProperty(this,Ug,{value:cf}),Object.defineProperty(this,Vg,{value:lf}),this.sortMapEntries="function"==typeof r?r:!0===r?iv:null}clone(){const e=Object.create(ov.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}}let rv=class e{constructor(e,t,s){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,jg,{value:Bg});let i=null;"function"==typeof t||Array.isArray(t)?i=t:void 0===s&&t&&(s=t,t=void 0);const o=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},s);this.options=o;let{version:r}=o;s?._directives?(this.directives=s._directives.atDocument(),this.directives.yaml.explicit&&(r=this.directives.yaml.version)):this.directives=new hm({version:r}),this.setSchema(r,s),this.contents=void 0===e?null:this.createNode(e,i,s)}clone(){const t=Object.create(e.prototype,{[jg]:{value:Bg}});return t.commentBefore=this.commentBefore,t.comment=this.comment,t.errors=this.errors.slice(),t.warnings=this.warnings.slice(),t.options=Object.assign({},this.options),this.directives&&(t.directives=this.directives.clone()),t.schema=this.schema.clone(),t.contents=Yg(this.contents)?this.contents.clone(t.schema):this.contents,this.range&&(t.range=this.range.slice()),t}add(e){av(this.contents)&&this.contents.add(e)}addIn(e,t){av(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){const s=pm(this);e.anchor=!t||s.has(t)?gm(t||"a",s):t}return new bm(e.anchor)}createNode(e,t,s){let i;if("function"==typeof t)e=t.call({"":e},"",e),i=t;else if(Array.isArray(t)){const e=e=>"number"==typeof e||e instanceof String||e instanceof Number,s=t.filter(e).map(String);s.length>0&&(t=t.concat(s)),i=t}else void 0===s&&t&&(s=t,t=void 0);const{aliasDuplicateObjects:o,anchorPrefix:r,flow:a,keepUndefined:n,onTagObj:l,tag:c}=s??{},{onAnchor:d,setAnchors:h,sourceObjects:u}=function(e,t){const s=[],i=/* @__PURE__ */new Map;let o=null;return{onAnchor:i=>{s.push(i),o??(o=pm(e));const r=gm(t,o);return o.add(r),r},setAnchors:()=>{for(const e of s){const t=i.get(e);if("object"!=typeof t||!t.anchor||!Gg(t.node)&&!Jg(t.node)){const t=new Error("Failed to resolve repeated object (this should not happen)");throw t.source=e,t}t.node.anchor=t.anchor}},sourceObjects:i}}(this,r||"a"),p=_m(e,c,{aliasDuplicateObjects:o??!0,keepUndefined:n??!1,onAnchor:d,onTagObj:l,replacer:i,schema:this.schema,sourceObjects:u});return a&&Jg(p)&&(p.flow=!0),h(),p}createPair(e,t,s={}){const i=this.createNode(e,null,s),o=this.createNode(t,null,s);return new Ym(i,o)}delete(e){return!!av(this.contents)&&this.contents.delete(e)}deleteIn(e){return Sm(e)?null!=this.contents&&(this.contents=null,!0):!!av(this.contents)&&this.contents.deleteIn(e)}get(e,t){return Jg(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return Sm(e)?!t&&Gg(this.contents)?this.contents.value:this.contents:Jg(this.contents)?this.contents.getIn(e,t):void 0}has(e){return!!Jg(this.contents)&&this.contents.has(e)}hasIn(e){return Sm(e)?void 0!==this.contents:!!Jg(this.contents)&&this.contents.hasIn(e)}set(e,t){null==this.contents?this.contents=km(this.schema,[e],t):av(this.contents)&&this.contents.set(e,t)}setIn(e,t){Sm(e)?this.contents=t:null==this.contents?this.contents=km(this.schema,Array.from(e),t):av(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){let s;switch("number"==typeof e&&(e=String(e)),e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new hm({version:"1.1"}),s={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new hm({version:e}),s={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,s=null;break;default:{const t=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${t}`)}}if(t.schema instanceof Object)this.schema=t.schema;else{if(!s)throw new Error("With a null YAML version, the { schema: Schema } option is required");this.schema=new ov(Object.assign(s,t))}}toJS({json:e,jsonArg:t,mapAsMap:s,maxAliasCount:i,onAnchor:o,reviver:r}={}){const a={anchors:/* @__PURE__ */new Map,doc:this,keep:!e,mapAsMap:!0===s,mapKeyWarned:!1,maxAliasCount:"number"==typeof i?i:100},n=fm(this.contents,t??"",a);if("function"==typeof o)for(const{count:l,res:c}of a.anchors.values())o(c,l);return"function"==typeof r?mm(r,{"":n},"",n):n}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){const t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return function(e,t){const s=[];let i=!0===t.directives;if(!1!==t.directives&&e.directives){const t=e.directives.toString(e);t?(s.push(t),i=!0):e.directives.docStart&&(i=!0)}i&&s.push("---");const o=Vm(e,t),{commentString:r}=o.options;if(e.commentBefore){1!==s.length&&s.unshift("");const t=r(e.commentBefore);s.unshift(Dm(t,""))}let a=!1,n=null;if(e.contents){if(Yg(e.contents)){if(e.contents.spaceBefore&&i&&s.push(""),e.contents.commentBefore){const t=r(e.contents.commentBefore);s.push(Dm(t,""))}o.forceBlockIndent=!!e.comment,n=e.contents.comment}const t=n?void 0:()=>a=!0;let l=jm(e.contents,o,()=>n=null,t);n&&(l+=Em(l,"",r(n))),"|"!==l[0]&&">"!==l[0]||"---"!==s[s.length-1]?s.push(l):s[s.length-1]=`--- ${l}`}else s.push(jm(e.contents,o));if(e.directives?.docEnd)if(e.comment){const t=r(e.comment);t.includes("\n")?(s.push("..."),s.push(Dm(t,""))):s.push(`... ${t}`)}else s.push("...");else{let t=e.comment;t&&a&&(t=t.replace(/^\n+/,"")),t&&(a&&!n||""===s[s.length-1]||s.push(""),s.push(Dm(r(t),"")))}return s.join("\n")+"\n"}(this,e)}};function av(e){if(Jg(e))return!0;throw new Error("Expected a YAML collection as document contents")}class nv extends Error{constructor(e,t,s,i){super(),this.name=e,this.code=s,this.message=i,this.pos=t}}class lv extends nv{constructor(e,t,s){super("YAMLParseError",e,t,s)}}class cv extends nv{constructor(e,t,s){super("YAMLWarning",e,t,s)}}const dv=(e,t)=>s=>{if(-1===s.pos[0])return;s.linePos=s.pos.map(e=>t.linePos(e));const{line:i,col:o}=s.linePos[0];s.message+=` at line ${i}, column ${o}`;let r=o-1,a=e.substring(t.lineStarts[i-1],t.lineStarts[i]).replace(/[\n\r]+$/,"");if(r>=60&&a.length>80){const e=Math.min(r-39,a.length-79);a="â¦"+a.substring(e),r-=e-1}if(a.length>80&&(a=a.substring(0,79)+"â¦"),i>1&&/^ *$/.test(a.substring(0,r))){let s=e.substring(t.lineStarts[i-2],t.lineStarts[i-1]);s.length>80&&(s=s.substring(0,79)+"â¦\n"),a=s+a}if(/[^ ]/.test(a)){let e=1;const t=s.linePos[1];t&&t.line===i&&t.col>o&&(e=Math.max(1,Math.min(t.col-o,80-r)));const n=" ".repeat(r)+"^".repeat(e);s.message+=`:\n\n${a}\n${n}\n`}};function hv(e,{flow:t,indicator:s,next:i,offset:o,onError:r,parentIndent:a,startOnNewline:n}){let l=!1,c=n,d=n,h="",u="",p=!1,g=!1,m=null,f=null,v=null,b=null,y=null,w=null,x=null;for(const S of e)switch(g&&("space"!==S.type&&"newline"!==S.type&&"comma"!==S.type&&r(S.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),g=!1),m&&(c&&"comment"!==S.type&&"newline"!==S.type&&r(m,"TAB_AS_INDENT","Tabs are not allowed as indentation"),m=null),S.type){case"space":t||"doc-start"===s&&"flow-collection"===i?.type||!S.source.includes("\t")||(m=S),d=!0;break;case"comment":{d||r(S,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const e=S.source.substring(1)||" ";h?h+=u+e:h=e,u="",c=!1;break}case"newline":c?h?h+=S.source:w&&"seq-item-ind"===s||(l=!0):u+=S.source,c=!0,p=!0,(f||v)&&(b=S),d=!0;break;case"anchor":f&&r(S,"MULTIPLE_ANCHORS","A node can have at most one anchor"),S.source.endsWith(":")&&r(S.offset+S.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),f=S,x??(x=S.offset),c=!1,d=!1,g=!0;break;case"tag":v&&r(S,"MULTIPLE_TAGS","A node can have at most one tag"),v=S,x??(x=S.offset),c=!1,d=!1,g=!0;break;case s:(f||v)&&r(S,"BAD_PROP_ORDER",`Anchors and tags must be after the ${S.source} indicator`),w&&r(S,"UNEXPECTED_TOKEN",`Unexpected ${S.source} in ${t??"collection"}`),w=S,c="seq-item-ind"===s||"explicit-key-ind"===s,d=!1;break;case"comma":if(t){y&&r(S,"UNEXPECTED_TOKEN",`Unexpected , in ${t}`),y=S,c=!1,d=!1;break}default:r(S,"UNEXPECTED_TOKEN",`Unexpected ${S.type} token`),c=!1,d=!1}const _=e[e.length-1],k=_?_.offset+_.source.length:o;return g&&i&&"space"!==i.type&&"newline"!==i.type&&"comma"!==i.type&&("scalar"!==i.type||""!==i.source)&&r(i.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),m&&(c&&m.indent<=a||"block-map"===i?.type||"block-seq"===i?.type)&&r(m,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:y,found:w,spaceBefore:l,comment:h,hasNewline:p,anchor:f,tag:v,newlineAfterProp:b,end:k,start:x??k}}function uv(e){if(!e)return null;switch(e.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(e.source.includes("\n"))return!0;if(e.end)for(const t of e.end)if("newline"===t.type)return!0;return!1;case"flow-collection":for(const t of e.items){for(const e of t.start)if("newline"===e.type)return!0;if(t.sep)for(const e of t.sep)if("newline"===e.type)return!0;if(uv(t.key)||uv(t.value))return!0}return!1;default:return!0}}function pv(e,t,s){if("flow-collection"===t?.type){const i=t.end[0];if(i.indent===e&&("]"===i.source||"}"===i.source)&&uv(t)){s(i,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}}function gv(e,t,s){const{uniqueKeys:i}=e.options;if(!1===i)return!1;const o="function"==typeof i?i:(e,t)=>e===t||Gg(e)&&Gg(t)&&e.value===t.value;return t.some(e=>o(e.key,s))}const mv="All mapping items must start at the same column";function fv(e,t,s,i){let o="";if(e){let r=!1,a="";for(const n of e){const{source:e,type:l}=n;switch(l){case"space":r=!0;break;case"comment":{s&&!r&&i(n,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const t=e.substring(1)||" ";o?o+=a+t:o=t,a="";break}case"newline":o&&(a+=e),r=!0;break;default:i(n,"UNEXPECTED_TOKEN",`Unexpected ${l} at node end`)}t+=e.length}}return{comment:o,offset:t}}const vv="Block collections are not allowed within flow collections",bv=e=>e&&("block-map"===e.type||"block-seq"===e.type);function yv(e,t,s,i,o,r){const a="block-map"===s.type?function({composeNode:e,composeEmptyNode:t},s,i,o,r){const a=new(r?.nodeClass??of)(s.schema);s.atRoot&&(s.atRoot=!1);let n=i.offset,l=null;for(const c of i.items){const{start:r,key:d,sep:h,value:u}=c,p=hv(r,{indicator:"explicit-key-ind",next:d??h?.[0],offset:n,onError:o,parentIndent:i.indent,startOnNewline:!0}),g=!p.found;if(g){if(d&&("block-seq"===d.type?o(n,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in d&&d.indent!==i.indent&&o(n,"BAD_INDENT",mv)),!p.anchor&&!p.tag&&!h){l=p.end,p.comment&&(a.comment?a.comment+="\n"+p.comment:a.comment=p.comment);continue}(p.newlineAfterProp||uv(d))&&o(d??r[r.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else p.found?.indent!==i.indent&&o(n,"BAD_INDENT",mv);s.atKey=!0;const m=p.end,f=d?e(s,d,p,o):t(s,m,r,null,p,o);s.schema.compat&&pv(i.indent,d,o),s.atKey=!1,gv(s,a.items,f)&&o(m,"DUPLICATE_KEY","Map keys must be unique");const v=hv(h??[],{indicator:"map-value-ind",next:u,offset:f.range[2],onError:o,parentIndent:i.indent,startOnNewline:!d||"block-scalar"===d.type});if(n=v.end,v.found){g&&("block-map"!==u?.type||v.hasNewline||o(n,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),s.options.strict&&p.start<v.found.offset-1024&&o(f.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const r=u?e(s,u,v,o):t(s,n,h,null,v,o);s.schema.compat&&pv(i.indent,u,o),n=r.range[2];const l=new Ym(f,r);s.options.keepSourceTokens&&(l.srcToken=c),a.items.push(l)}else{g&&o(f.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),v.comment&&(f.comment?f.comment+="\n"+v.comment:f.comment=v.comment);const e=new Ym(f);s.options.keepSourceTokens&&(e.srcToken=c),a.items.push(e)}}return l&&l<n&&o(l,"IMPOSSIBLE","Map comment with trailing content"),a.range=[i.offset,n,l??n],a}(e,t,s,i,r):"block-seq"===s.type?function({composeNode:e,composeEmptyNode:t},s,i,o,r){const a=new(r?.nodeClass??af)(s.schema);s.atRoot&&(s.atRoot=!1),s.atKey&&(s.atKey=!1);let n=i.offset,l=null;for(const{start:c,value:d}of i.items){const r=hv(c,{indicator:"seq-item-ind",next:d,offset:n,onError:o,parentIndent:i.indent,startOnNewline:!0});if(!r.found){if(!(r.anchor||r.tag||d)){l=r.end,r.comment&&(a.comment=r.comment);continue}d&&"block-seq"===d.type?o(r.end,"BAD_INDENT","All sequence items must start at the same column"):o(n,"MISSING_CHAR","Sequence item without - indicator")}const h=d?e(s,d,r,o):t(s,r.end,c,null,r,o);s.schema.compat&&pv(i.indent,d,o),n=h.range[2],a.items.push(h)}return a.range=[i.offset,n,l??n],a}(e,t,s,i,r):function({composeNode:e,composeEmptyNode:t},s,i,o,r){const a="{"===i.start.source,n=a?"flow map":"flow sequence",l=new(r?.nodeClass??(a?of:af))(s.schema);l.flow=!0;const c=s.atRoot;c&&(s.atRoot=!1),s.atKey&&(s.atKey=!1);let d=i.offset+i.start.source.length;for(let m=0;m<i.items.length;++m){const r=i.items[m],{start:c,key:h,sep:u,value:p}=r,g=hv(c,{flow:n,indicator:"explicit-key-ind",next:h??u?.[0],offset:d,onError:o,parentIndent:i.indent,startOnNewline:!1});if(!g.found){if(!(g.anchor||g.tag||u||p)){0===m&&g.comma?o(g.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${n}`):m<i.items.length-1&&o(g.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${n}`),g.comment&&(l.comment?l.comment+="\n"+g.comment:l.comment=g.comment),d=g.end;continue}!a&&s.options.strict&&uv(h)&&o(h,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(0===m)g.comma&&o(g.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${n}`);else if(g.comma||o(g.start,"MISSING_CHAR",`Missing , between ${n} items`),g.comment){let e="";e:for(const t of c)switch(t.type){case"comma":case"space":break;case"comment":e=t.source.substring(1);break e;default:break e}if(e){let t=l.items[l.items.length-1];Kg(t)&&(t=t.value??t.key),t.comment?t.comment+="\n"+e:t.comment=e,g.comment=g.comment.substring(e.length+1)}}if(a||u||g.found){s.atKey=!0;const m=g.end,f=h?e(s,h,g,o):t(s,m,c,null,g,o);bv(h)&&o(f.range,"BLOCK_IN_FLOW",vv),s.atKey=!1;const v=hv(u??[],{flow:n,indicator:"map-value-ind",next:p,offset:f.range[2],onError:o,parentIndent:i.indent,startOnNewline:!1});if(v.found){if(!a&&!g.found&&s.options.strict){if(u)for(const e of u){if(e===v.found)break;if("newline"===e.type){o(e,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}g.start<v.found.offset-1024&&o(v.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else p&&("source"in p&&p.source&&":"===p.source[0]?o(p,"MISSING_CHAR",`Missing space after : in ${n}`):o(v.start,"MISSING_CHAR",`Missing , or : between ${n} items`));const b=p?e(s,p,v,o):v.found?t(s,v.end,u,null,v,o):null;b?bv(p)&&o(b.range,"BLOCK_IN_FLOW",vv):v.comment&&(f.comment?f.comment+="\n"+v.comment:f.comment=v.comment);const y=new Ym(f,b);if(s.options.keepSourceTokens&&(y.srcToken=r),a){const e=l;gv(s,e.items,f)&&o(m,"DUPLICATE_KEY","Map keys must be unique"),e.items.push(y)}else{const e=new of(s.schema);e.flow=!0,e.items.push(y);const t=(b??f).range;e.range=[f.range[0],t[1],t[2]],l.items.push(e)}d=b?b.range[2]:v.end}else{const i=p?e(s,p,g,o):t(s,g.end,u,null,g,o);l.items.push(i),d=i.range[2],bv(p)&&o(i.range,"BLOCK_IN_FLOW",vv)}}const h=a?"}":"]",[u,...p]=i.end;let g=d;if(u&&u.source===h)g=u.offset+u.source.length;else{const e=n[0].toUpperCase()+n.substring(1);o(d,c?"MISSING_CHAR":"BAD_INDENT",c?`${e} must end with a ${h}`:`${e} in block collection must be sufficiently indented and end with a ${h}`),u&&1!==u.source.length&&p.unshift(u)}if(p.length>0){const e=fv(p,g,s.options.strict,o);e.comment&&(l.comment?l.comment+="\n"+e.comment:l.comment=e.comment),l.range=[i.offset,g,e.offset]}else l.range=[i.offset,g,g];return l}(e,t,s,i,r),n=a.constructor;return"!"===o||o===n.tagName?(a.tag=n.tagName,a):(o&&(a.tag=o),a)}function wv(e,t,s){const i=t.offset,o=function({offset:e,props:t},s,i){if("block-scalar-header"!==t[0].type)return i(t[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:o}=t[0],r=o[0];let a=0,n="",l=-1;for(let u=1;u<o.length;++u){const t=o[u];if(n||"-"!==t&&"+"!==t){const s=Number(t);!a&&s?a=s:-1===l&&(l=e+u)}else n=t}-1!==l&&i(l,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${o}`);let c=!1,d="",h=o.length;for(let u=1;u<t.length;++u){const e=t[u];switch(e.type){case"space":c=!0;case"newline":h+=e.source.length;break;case"comment":if(s&&!c){i(e,"MISSING_CHAR","Comments must be separated from other tokens by white space characters")}h+=e.source.length,d=e.source.substring(1);break;case"error":i(e,"UNEXPECTED_TOKEN",e.message),h+=e.source.length;break;default:{i(e,"UNEXPECTED_TOKEN",`Unexpected token in block scalar header: ${e.type}`);const t=e.source;t&&"string"==typeof t&&(h+=t.length)}}}return{mode:r,indent:a,chomp:n,comment:d,length:h}}(t,e.options.strict,s);if(!o)return{value:"",type:null,comment:"",range:[i,i,i]};const r=">"===o.mode?xm.BLOCK_FOLDED:xm.BLOCK_LITERAL,a=t.source?function(e){const t=e.split(/\n( *)/),s=t[0],i=s.match(/^( *)/),o=[i?.[1]?[i[1],s.slice(i[1].length)]:["",s]];for(let r=1;r<t.length;r+=2)o.push([t[r],t[r+1]]);return o}(t.source):[];let n=a.length;for(let m=a.length-1;m>=0;--m){const e=a[m][1];if(""!==e&&"\r"!==e)break;n=m}if(0===n){const e="+"===o.chomp&&a.length>0?"\n".repeat(Math.max(1,a.length-1)):"";let s=i+o.length;return t.source&&(s+=t.source.length),{value:e,type:r,comment:o.comment,range:[i,s,s]}}let l=t.indent+o.indent,c=t.offset+o.length,d=0;for(let m=0;m<n;++m){const[t,i]=a[m];if(""!==i&&"\r"!==i){if(t.length<l){const e="Block scalars with more-indented leading empty lines must use an explicit indentation indicator";s(c+t.length,"MISSING_CHAR",e)}if(0===o.indent&&(l=t.length),d=m,0===l&&!e.atRoot){s(c,"BAD_INDENT","Block scalar values in collections must be indented")}break}0===o.indent&&t.length>l&&(l=t.length),c+=t.length+i.length+1}for(let m=a.length-1;m>=n;--m)a[m][0].length>l&&(n=m+1);let h="",u="",p=!1;for(let m=0;m<d;++m)h+=a[m][0].slice(l)+"\n";for(let m=d;m<n;++m){let[e,t]=a[m];c+=e.length+t.length+1;const i="\r"===t[t.length-1];if(i&&(t=t.slice(0,-1)),t&&e.length<l){const r=`Block scalar lines must not be less indented than their ${o.indent?"explicit indentation indicator":"first line"}`;s(c-t.length-(i?2:1),"BAD_INDENT",r),e=""}r===xm.BLOCK_LITERAL?(h+=u+e.slice(l)+t,u="\n"):e.length>l||"\t"===t[0]?(" "===u?u="\n":p||"\n"!==u||(u="\n\n"),h+=u+e.slice(l)+t,u="\n",p=!0):""===t?"\n"===u?h+="\n":u="\n":(h+=u+t,u=" ",p=!1)}switch(o.chomp){case"-":break;case"+":for(let e=n;e<a.length;++e)h+="\n"+a[e][0].slice(l);"\n"!==h[h.length-1]&&(h+="\n");break;default:h+="\n"}const g=i+o.length+t.source.length;return{value:h,type:r,comment:o.comment,range:[i,g,g]}}function xv(e,t,s){const{offset:i,type:o,source:r,end:a}=e;let n,l;const c=(e,t,o)=>s(i+e,t,o);switch(o){case"scalar":n=xm.PLAIN,l=function(e,t){let s="";switch(e[0]){case"\t":s="a tab character";break;case",":s="flow indicator character ,";break;case"%":s="directive indicator character %";break;case"|":case">":s=`block scalar indicator ${e[0]}`;break;case"@":case"`":s=`reserved character ${e[0]}`}s&&t(0,"BAD_SCALAR_START",`Plain value cannot start with ${s}`);return _v(e)}(r,c);break;case"single-quoted-scalar":n=xm.QUOTE_SINGLE,l=function(e,t){"'"===e[e.length-1]&&1!==e.length||t(e.length,"MISSING_CHAR","Missing closing 'quote");return _v(e.slice(1,-1)).replace(/''/g,"'")}(r,c);break;case"double-quoted-scalar":n=xm.QUOTE_DOUBLE,l=function(e,t){let s="";for(let i=1;i<e.length-1;++i){const o=e[i];if("\r"!==o||"\n"!==e[i+1])if("\n"===o){const{fold:t,offset:o}=kv(e,i);s+=t,i=o}else if("\\"===o){let o=e[++i];const r=Sv[o];if(r)s+=r;else if("\n"===o)for(o=e[i+1];" "===o||"\t"===o;)o=e[1+ ++i];else if("\r"===o&&"\n"===e[i+1])for(o=e[1+ ++i];" "===o||"\t"===o;)o=e[1+ ++i];else if("x"===o||"u"===o||"U"===o){const r={x:2,u:4,U:8}[o];s+=Cv(e,i+1,r,t),i+=r}else{const o=e.substr(i-1,2);t(i-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${o}`),s+=o}}else if(" "===o||"\t"===o){const t=i;let r=e[i+1];for(;" "===r||"\t"===r;)r=e[1+ ++i];"\n"===r||"\r"===r&&"\n"===e[i+2]||(s+=i>t?e.slice(t,i+1):o)}else s+=o}'"'===e[e.length-1]&&1!==e.length||t(e.length,"MISSING_CHAR",'Missing closing "quote');return s}(r,c);break;default:return s(e,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${o}`),{value:"",type:null,comment:"",range:[i,i+r.length,i+r.length]}}const d=i+r.length,h=fv(a,d,t,s);return{value:l,type:n,comment:h.comment,range:[i,d,h.offset]}}function _v(e){let t,s;try{t=new RegExp("(.*?)(?<![ \t])[ \t]*\r?\n","sy"),s=new RegExp("[ \t]*(.*?)(?:(?<![ \t])[ \t]*)?\r?\n","sy")}catch{t=/(.*?)[ \t]*\r?\n/sy,s=/[ \t]*(.*?)[ \t]*\r?\n/sy}let i=t.exec(e);if(!i)return e;let o=i[1],r=" ",a=t.lastIndex;for(s.lastIndex=a;i=s.exec(e);)""===i[1]?"\n"===r?o+=r:r="\n":(o+=r+i[1],r=" "),a=s.lastIndex;const n=/[ \t]*(.*)/sy;return n.lastIndex=a,i=n.exec(e),o+r+(i?.[1]??"")}function kv(e,t){let s="",i=e[t+1];for(;!(" "!==i&&"\t"!==i&&"\n"!==i&&"\r"!==i||"\r"===i&&"\n"!==e[t+2]);)"\n"===i&&(s+="\n"),i=e[(t+=1)+1];return s||(s=" "),{fold:s,offset:t}}const Sv={0:"\0",a:"",b:"\b",e:"",f:"\f",n:"\n",r:"\r",t:"\t",v:"\v",N:"Â",_:"Â ",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","\t":"\t"};function Cv(e,t,s,i){const o=e.substr(t,s),r=o.length===s&&/^[0-9a-fA-F]+$/.test(o)?parseInt(o,16):NaN;if(isNaN(r)){const o=e.substr(t-2,s+2);return i(t-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${o}`),o}return String.fromCodePoint(r)}function $v(e,t,s,i){const{value:o,type:r,comment:a,range:n}="block-scalar"===t.type?wv(e,t,i):xv(t,e.options.strict,i),l=s?e.directives.tagName(s.source,e=>i(s,"TAG_RESOLVE_FAILED",e)):null;let c,d;c=e.options.stringKeys&&e.atKey?e.schema[Ug]:l?function(e,t,s,i,o){if("!"===s)return e[Ug];const r=[];for(const n of e.tags)if(!n.collection&&n.tag===s){if(!n.default||!n.test)return n;r.push(n)}for(const n of r)if(n.test?.test(t))return n;const a=e.knownTags[s];if(a&&!a.collection)return e.tags.push(Object.assign({},a,{default:!1,test:void 0})),a;return o(i,"TAG_RESOLVE_FAILED",`Unresolved tag: ${s}`,"tag:yaml.org,2002:str"!==s),e[Ug]}(e.schema,o,l,s,i):"scalar"===t.type?function({atKey:e,directives:t,schema:s},i,o,r){const a=s.tags.find(t=>(!0===t.default||e&&"key"===t.default)&&t.test?.test(i))||s[Ug];if(s.compat){const e=s.compat.find(e=>e.default&&e.test?.test(i))??s[Ug];if(a.tag!==e.tag){r(o,"TAG_RESOLVE_FAILED",`Value may be parsed as either ${t.tagString(a.tag)} or ${t.tagString(e.tag)}`,!0)}}return a}(e,o,t,i):e.schema[Ug];try{const r=c.resolve(o,e=>i(s??t,"TAG_RESOLVE_FAILED",e),e.options);d=Gg(r)?r:new xm(r)}catch(h){const e=h instanceof Error?h.message:String(h);i(s??t,"TAG_RESOLVE_FAILED",e),d=new xm(o)}return d.range=n,d.source=o,r&&(d.type=r),l&&(d.tag=l),c.format&&(d.format=c.format),a&&(d.comment=a),d}function Dv(e,t,s){if(t){s??(s=t.length);for(let i=s-1;i>=0;--i){let s=t[i];switch(s.type){case"space":case"comment":case"newline":e-=s.source.length;continue}for(s=t[++i];"space"===s?.type;)e+=s.source.length,s=t[++i];break}}return e}const Ev={composeNode:Mv,composeEmptyNode:Av};function Mv(e,t,s,i){const o=e.atKey,{spaceBefore:r,comment:a,anchor:n,tag:l}=s;let c,d=!0;switch(t.type){case"alias":c=function({options:e},{offset:t,source:s,end:i},o){const r=new bm(s.substring(1));""===r.source&&o(t,"BAD_ALIAS","Alias cannot be an empty string");r.source.endsWith(":")&&o(t+s.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const a=t+s.length,n=fv(i,a,e.strict,o);r.range=[t,a,n.offset],n.comment&&(r.comment=n.comment);return r}(e,t,i),(n||l)&&i(t,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":c=$v(e,t,l,i),n&&(c.anchor=n.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":c=function(e,t,s,i,o){const r=i.tag,a=r?t.directives.tagName(r.source,e=>o(r,"TAG_RESOLVE_FAILED",e)):null;if("block-seq"===s.type){const{anchor:e,newlineAfterProp:t}=i,s=e&&r?e.offset>r.offset?e:r:e??r;s&&(!t||t.offset<s.offset)&&o(s,"MISSING_CHAR","Missing newline after block sequence props")}const n="block-map"===s.type?"map":"block-seq"===s.type?"seq":"{"===s.start.source?"map":"seq";if(!r||!a||"!"===a||a===of.tagName&&"map"===n||a===af.tagName&&"seq"===n)return yv(e,t,s,o,a);let l=t.schema.tags.find(e=>e.tag===a&&e.collection===n);if(!l){const i=t.schema.knownTags[a];if(!i||i.collection!==n)return i?o(r,"BAD_COLLECTION_TYPE",`${i.tag} used for ${n} collection, but expects ${i.collection??"scalar"}`,!0):o(r,"TAG_RESOLVE_FAILED",`Unresolved tag: ${a}`,!0),yv(e,t,s,o,a);t.schema.tags.push(Object.assign({},i,{default:!1})),l=i}const c=yv(e,t,s,o,a,l),d=l.resolve?.(c,e=>o(r,"TAG_RESOLVE_FAILED",e),t.options)??c,h=Yg(d)?d:new xm(d);return h.range=c.range,h.tag=a,l?.format&&(h.format=l.format),h}(Ev,e,t,s,i),n&&(c.anchor=n.source.substring(1));break;default:i(t,"UNEXPECTED_TOKEN","error"===t.type?t.message:`Unsupported token (type: ${t.type})`),c=Av(e,t.offset,void 0,null,s,i),d=!1}if(n&&""===c.anchor&&i(n,"BAD_ALIAS","Anchor cannot be an empty string"),o&&e.options.stringKeys&&(!Gg(c)||"string"!=typeof c.value||c.tag&&"tag:yaml.org,2002:str"!==c.tag)){i(l??t,"NON_STRING_KEY","With stringKeys, all keys must be strings")}return r&&(c.spaceBefore=!0),a&&("scalar"===t.type&&""===t.source?c.comment=a:c.commentBefore=a),e.options.keepSourceTokens&&d&&(c.srcToken=t),c}function Av(e,t,s,i,{spaceBefore:o,comment:r,anchor:a,tag:n,end:l},c){const d=$v(e,{type:"scalar",offset:Dv(t,s,i),indent:-1,source:""},n,c);return a&&(d.anchor=a.source.substring(1),""===d.anchor&&c(a,"BAD_ALIAS","Anchor cannot be an empty string")),o&&(d.spaceBefore=!0),r&&(d.comment=r,d.range[2]=l),d}function Iv(e){if("number"==typeof e)return[e,e+1];if(Array.isArray(e))return 2===e.length?e:[e[0],e[1]];const{offset:t,source:s}=e;return[t,t+("string"==typeof s?s.length:1)]}function Tv(e){let t="",s=!1,i=!1;for(let o=0;o<e.length;++o){const r=e[o];switch(r[0]){case"#":t+=(""===t?"":i?"\n\n":"\n")+(r.substring(1)||" "),s=!0,i=!1;break;case"%":"#"!==e[o+1]?.[0]&&(o+=1),s=!1;break;default:s||(i=!0),s=!1}}return{comment:t,afterEmptyLine:i}}class Pv{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(e,t,s,i)=>{const o=Iv(e);i?this.warnings.push(new cv(o,t,s)):this.errors.push(new lv(o,t,s))},this.directives=new hm({version:e.version||"1.2"}),this.options=e}decorate(e,t){const{comment:s,afterEmptyLine:i}=Tv(this.prelude);if(s){const o=e.contents;if(t)e.comment=e.comment?`${e.comment}\n${s}`:s;else if(i||e.directives.docStart||!o)e.commentBefore=s;else if(Jg(o)&&!o.flow&&o.items.length>0){let e=o.items[0];Kg(e)&&(e=e.key);const t=e.commentBefore;e.commentBefore=t?`${s}\n${t}`:s}else{const e=o.commentBefore;o.commentBefore=e?`${s}\n${e}`:s}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:Tv(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,s=-1){for(const i of e)yield*this.next(i);yield*this.end(t,s)}*next(e){switch(e.type){case"directive":this.directives.add(e.source,(t,s,i)=>{const o=Iv(e);o[0]+=t,this.onError(o,"BAD_DIRECTIVE",s,i)}),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{const t=function(e,t,{offset:s,start:i,value:o,end:r},a){const n=Object.assign({_directives:t},e),l=new rv(void 0,n),c={atKey:!1,atRoot:!0,directives:l.directives,options:l.options,schema:l.schema},d=hv(i,{indicator:"doc-start",next:o??r?.[0],offset:s,onError:a,parentIndent:0,startOnNewline:!0});d.found&&(l.directives.docStart=!0,!o||"block-map"!==o.type&&"block-seq"!==o.type||d.hasNewline||a(d.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),l.contents=o?Mv(c,o,d,a):Av(c,d.end,i,null,d,a);const h=l.contents.range[2],u=fv(r,h,!1,a);return u.comment&&(l.comment=u.comment),l.range=[s,h,u.offset],l}(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{const t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,s=new lv(Iv(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(s):this.doc.errors.push(s);break}case"doc-end":{if(!this.doc){const t="Unexpected doc-end without preceding document";this.errors.push(new lv(Iv(e),"UNEXPECTED_TOKEN",t));break}this.doc.directives.docEnd=!0;const t=fv(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){const e=this.doc.comment;this.doc.comment=e?`${e}\n${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new lv(Iv(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){const e=Object.assign({_directives:this.directives},this.options),s=new rv(void 0,e);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),s.range=[0,t,t],this.decorate(s,!1),yield s}}}function Lv(e,t){if(t)for(const s of t)switch(s.type){case"space":case"comment":e.push(s);break;case"newline":return e.push(s),!0}return!1}function Rv(e,t,s){switch(e.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":e.type=s,e.source=t;break;case"block-scalar":{const i=e.props.slice(1);let o=t.length;"block-scalar-header"===e.props[0].type&&(o-=e.props[0].source.length);for(const e of i)e.offset+=o;delete e.props,Object.assign(e,{type:s,source:t,end:i});break}case"block-map":case"block-seq":{const i={type:"newline",offset:e.offset+t.length,indent:e.indent,source:"\n"};delete e.items,Object.assign(e,{type:s,source:t,end:[i]});break}default:{const i="indent"in e?e.indent:-1,o="end"in e&&Array.isArray(e.end)?e.end.filter(e=>"space"===e.type||"comment"===e.type||"newline"===e.type):[];for(const t of Object.keys(e))"type"!==t&&"offset"!==t&&delete e[t];Object.assign(e,{type:s,indent:i,source:t,end:o})}}}function Ov(e){switch(e.type){case"block-scalar":{let t="";for(const s of e.props)t+=Ov(s);return t+e.source}case"block-map":case"block-seq":{let t="";for(const s of e.items)t+=Nv(s);return t}case"flow-collection":{let t=e.start.source;for(const s of e.items)t+=Nv(s);for(const s of e.end)t+=s.source;return t}case"document":{let t=Nv(e);if(e.end)for(const s of e.end)t+=s.source;return t}default:{let t=e.source;if("end"in e&&e.end)for(const s of e.end)t+=s.source;return t}}}function Nv({start:e,key:t,sep:s,value:i}){let o="";for(const r of e)o+=r.source;if(t&&(o+=Ov(t)),s)for(const r of s)o+=r.source;return i&&(o+=Ov(i)),o}const Bv=Symbol("break visit"),Fv=Symbol("skip children"),zv=Symbol("remove item");function Uv(e,t){"type"in e&&"document"===e.type&&(e={start:e.start,value:e.value}),Vv(Object.freeze([]),e,t)}function Vv(e,t,s){let i=s(t,e);if("symbol"==typeof i)return i;for(const o of["key","value"]){const r=t[o];if(r&&"items"in r){for(let t=0;t<r.items.length;++t){const i=Vv(Object.freeze(e.concat([[o,t]])),r.items[t],s);if("number"==typeof i)t=i-1;else{if(i===Bv)return Bv;i===zv&&(r.items.splice(t,1),t-=1)}}"function"==typeof i&&"key"===o&&(i=i(t,e))}}return"function"==typeof i?i(t,e):i}Uv.BREAK=Bv,Uv.SKIP=Fv,Uv.REMOVE=zv,Uv.itemAtPath=(e,t)=>{let s=e;for(const[i,o]of t){const e=s?.[i];if(!e||!("items"in e))return;s=e.items[o]}return s},Uv.parentCollection=(e,t)=>{const s=Uv.itemAtPath(e,t.slice(0,-1)),i=t[t.length-1][0],o=s?.[i];if(o&&"items"in o)return o;throw new Error("Parent collection not found")};const jv="\ufeff",Hv="",Wv="",qv="";function Kv(e){switch(e){case jv:return"byte-order-mark";case Hv:return"doc-mode";case Wv:return"flow-error-end";case qv:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case"\n":case"\r\n":return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(e[0]){case" ":case"\t":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}const Gv=/* @__PURE__ */Object.freeze(/* @__PURE__ */Object.defineProperty({__proto__:null,BOM:jv,DOCUMENT:Hv,FLOW_END:Wv,SCALAR:qv,createScalarToken:function(e,t){const{implicitKey:s=!1,indent:i,inFlow:o=!1,offset:r=-1,type:a="PLAIN"}=t,n=Um({type:a,value:e},{implicitKey:s,indent:i>0?" ".repeat(i):"",inFlow:o,options:{blockQuote:!0,lineWidth:-1}}),l=t.end??[{type:"newline",offset:-1,indent:i,source:"\n"}];switch(n[0]){case"|":case">":{const e=n.indexOf("\n"),t=n.substring(0,e),s=n.substring(e+1)+"\n",o=[{type:"block-scalar-header",offset:r,indent:i,source:t}];return Lv(o,l)||o.push({type:"newline",offset:-1,indent:i,source:"\n"}),{type:"block-scalar",offset:r,indent:i,props:o,source:s}}case'"':return{type:"double-quoted-scalar",offset:r,indent:i,source:n,end:l};case"'":return{type:"single-quoted-scalar",offset:r,indent:i,source:n,end:l};default:return{type:"scalar",offset:r,indent:i,source:n,end:l}}},isCollection:e=>!!e&&"items"in e,isScalar:e=>!!e&&("scalar"===e.type||"single-quoted-scalar"===e.type||"double-quoted-scalar"===e.type||"block-scalar"===e.type),prettyToken:function(e){switch(e){case jv:return"<BOM>";case Hv:return"<DOC>";case Wv:return"<FLOW_END>";case qv:return"<SCALAR>";default:return JSON.stringify(e)}},resolveAsScalar:function(e,t=!0,s){if(e){const i=(e,t,i)=>{const o="number"==typeof e?e:Array.isArray(e)?e[0]:e.offset;if(!s)throw new lv([o,o+1],t,i);s(o,t,i)};switch(e.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return xv(e,t,i);case"block-scalar":return wv({options:{strict:t}},e,i)}}return null},setScalarValue:function(e,t,s={}){let{afterKey:i=!1,implicitKey:o=!1,inFlow:r=!1,type:a}=s,n="indent"in e?e.indent:null;if(i&&"number"==typeof n&&(n+=2),!a)switch(e.type){case"single-quoted-scalar":a="QUOTE_SINGLE";break;case"double-quoted-scalar":a="QUOTE_DOUBLE";break;case"block-scalar":{const t=e.props[0];if("block-scalar-header"!==t.type)throw new Error("Invalid block scalar header");a=">"===t.source[0]?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:a="PLAIN"}const l=Um({type:a,value:t},{implicitKey:o||null===n,indent:null!==n&&n>0?" ".repeat(n):"",inFlow:r,options:{blockQuote:!0,lineWidth:-1}});switch(l[0]){case"|":case">":!function(e,t){const s=t.indexOf("\n"),i=t.substring(0,s),o=t.substring(s+1)+"\n";if("block-scalar"===e.type){const t=e.props[0];if("block-scalar-header"!==t.type)throw new Error("Invalid block scalar header");t.source=i,e.source=o}else{const{offset:t}=e,s="indent"in e?e.indent:-1,r=[{type:"block-scalar-header",offset:t,indent:s,source:i}];Lv(r,"end"in e?e.end:void 0)||r.push({type:"newline",offset:-1,indent:s,source:"\n"});for(const i of Object.keys(e))"type"!==i&&"offset"!==i&&delete e[i];Object.assign(e,{type:"block-scalar",indent:s,props:r,source:o})}}(e,l);break;case'"':Rv(e,l,"double-quoted-scalar");break;case"'":Rv(e,l,"single-quoted-scalar");break;default:Rv(e,l,"scalar")}},stringify:e=>"type"in e?Ov(e):Nv(e),tokenType:Kv,visit:Uv},Symbol.toStringTag,{value:"Module"}));function Qv(e){switch(e){case void 0:case" ":case"\n":case"\r":case"\t":return!0;default:return!1}}const Jv=new Set("0123456789ABCDEFabcdef"),Yv=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),Xv=new Set(",[]{}"),Zv=new Set(" ,[]{}\n\r\t"),eb=e=>!e||Zv.has(e);class tb{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){if(e){if("string"!=typeof e)throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null}this.atEnd=!t;let s=this.next??"stream";for(;s&&(t||this.hasChars(1));)s=yield*this.parseNext(s)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;" "===t||"\t"===t;)t=this.buffer[++e];return!t||"#"===t||"\n"===t||"\r"===t&&"\n"===this.buffer[e+1]}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let s=0;for(;" "===t;)t=this.buffer[++s+e];if("\r"===t){const t=this.buffer[s+e+1];if("\n"===t||!t&&!this.atEnd)return e+s+1}return"\n"===t||s>=this.indentNext||!t&&!this.atEnd?e+s:-1}if("-"===t||"."===t){const t=this.buffer.substr(e,3);if(("---"===t||"..."===t)&&Qv(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return("number"!=typeof e||-1!==e&&e<this.pos)&&(e=this.buffer.indexOf("\n",this.pos),this.lineEndPos=e),-1===e?this.atEnd?this.buffer.substring(this.pos):null:("\r"===this.buffer[e-1]&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(null===e)return this.setNext("stream");if(e[0]===jv&&(yield*this.pushCount(1),e=e.substring(1)),"%"===e[0]){let t=e.length,s=e.indexOf("#");for(;-1!==s;){const i=e[s-1];if(" "===i||"\t"===i){t=s-1;break}s=e.indexOf("#",s+1)}for(;;){const s=e[t-1];if(" "!==s&&"\t"!==s)break;t-=1}const i=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-i),this.pushNewline(),"stream"}if(this.atLineEnd()){const t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield Hv,yield*this.parseLineStart()}*parseLineStart(){const e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if("-"===e||"."===e){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const e=this.peek(3);if(("---"===e||"..."===e)&&Qv(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,"---"===e?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!Qv(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if(("-"===e||"?"===e||":"===e)&&Qv(t)){const e=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=e,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const e=this.getLine();if(null===e)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(eb),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=(yield*this.parseBlockScalarHeader()),t+=(yield*this.pushSpaces(!0)),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,s=-1;do{e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=s=t):t=0,t+=(yield*this.pushSpaces(!0))}while(e+t>0);const i=this.getLine();if(null===i)return this.setNext("flow");if(-1!==s&&s<this.indentNext&&"#"!==i[0]||0===s&&(i.startsWith("---")||i.startsWith("..."))&&Qv(i[3])){if(!(s===this.indentNext-1&&1===this.flowLevel&&("]"===i[0]||"}"===i[0])))return this.flowLevel=0,yield Wv,yield*this.parseLineStart()}let o=0;for(;","===i[o];)o+=(yield*this.pushCount(1)),o+=(yield*this.pushSpaces(!0)),this.flowKey=!1;switch(o+=(yield*this.pushIndicators()),i[o]){case void 0:return"flow";case"#":return yield*this.pushCount(i.length-o),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(eb),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const e=this.charAt(1);if(this.flowKey||Qv(e)||","===e)return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const e=this.charAt(0);let t=this.buffer.indexOf(e,this.pos+1);if("'"===e)for(;-1!==t&&"'"===this.buffer[t+1];)t=this.buffer.indexOf("'",t+2);else for(;-1!==t;){let e=0;for(;"\\"===this.buffer[t-1-e];)e+=1;if(e%2==0)break;t=this.buffer.indexOf('"',t+1)}const s=this.buffer.substring(0,t);let i=s.indexOf("\n",this.pos);if(-1!==i){for(;-1!==i;){const e=this.continueScalar(i+1);if(-1===e)break;i=s.indexOf("\n",e)}-1!==i&&(t=i-("\r"===s[i-1]?2:1))}if(-1===t){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){const t=this.buffer[++e];if("+"===t)this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if("-"!==t)break}return yield*this.pushUntil(e=>Qv(e)||"#"===e)}*parseBlockScalar(){let e,t=this.pos-1,s=0;e:for(let o=this.pos;e=this.buffer[o];++o)switch(e){case" ":s+=1;break;case"\n":t=o,s=0;break;case"\r":{const e=this.buffer[o+1];if(!e&&!this.atEnd)return this.setNext("block-scalar");if("\n"===e)break}default:break e}if(!e&&!this.atEnd)return this.setNext("block-scalar");if(s>=this.indentNext){-1===this.blockScalarIndent?this.indentNext=s:this.indentNext=this.blockScalarIndent+(0===this.indentNext?1:this.indentNext);do{const e=this.continueScalar(t+1);if(-1===e)break;t=this.buffer.indexOf("\n",e)}while(-1!==t);if(-1===t){if(!this.atEnd)return this.setNext("block-scalar");t=this.buffer.length}}let i=t+1;for(e=this.buffer[i];" "===e;)e=this.buffer[++i];if("\t"===e){for(;"\t"===e||" "===e||"\r"===e||"\n"===e;)e=this.buffer[++i];t=i-1}else if(!this.blockScalarKeep)for(;;){let e=t-1,i=this.buffer[e];"\r"===i&&(i=this.buffer[--e]);const o=e;for(;" "===i;)i=this.buffer[--e];if(!("\n"===i&&e>=this.pos&&e+1+s>o))break;t=e}return yield qv,yield*this.pushToIndex(t+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const e=this.flowLevel>0;let t,s=this.pos-1,i=this.pos-1;for(;t=this.buffer[++i];)if(":"===t){const t=this.buffer[i+1];if(Qv(t)||e&&Xv.has(t))break;s=i}else if(Qv(t)){let o=this.buffer[i+1];if("\r"===t&&("\n"===o?(i+=1,t="\n",o=this.buffer[i+1]):s=i),"#"===o||e&&Xv.has(o))break;if("\n"===t){const e=this.continueScalar(i+1);if(-1===e)break;i=Math.max(i,e-2)}}else{if(e&&Xv.has(t))break;s=i}return t||this.atEnd?(yield qv,yield*this.pushToIndex(s+1,!0),e?"flow":"doc"):this.setNext("plain-scalar")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){const s=this.buffer.slice(this.pos,e);return s?(yield s,this.pos+=s.length,s.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(eb))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const e=this.flowLevel>0,t=this.charAt(1);if(Qv(t)||e&&Xv.has(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if("<"===this.charAt(1)){let e=this.pos+2,t=this.buffer[e];for(;!Qv(t)&&">"!==t;)t=this.buffer[++e];return yield*this.pushToIndex(">"===t?e+1:e,!1)}{let e=this.pos+1,t=this.buffer[e];for(;t;)if(Yv.has(t))t=this.buffer[++e];else{if("%"!==t||!Jv.has(this.buffer[e+1])||!Jv.has(this.buffer[e+2]))break;t=this.buffer[e+=3]}return yield*this.pushToIndex(e,!1)}}*pushNewline(){const e=this.buffer[this.pos];return"\n"===e?yield*this.pushCount(1):"\r"===e&&"\n"===this.charAt(1)?yield*this.pushCount(2):0}*pushSpaces(e){let t,s=this.pos-1;do{t=this.buffer[++s]}while(" "===t||e&&"\t"===t);const i=s-this.pos;return i>0&&(yield this.buffer.substr(this.pos,i),this.pos=s),i}*pushUntil(e){let t=this.pos,s=this.buffer[t];for(;!e(s);)s=this.buffer[++t];return yield*this.pushToIndex(t,!1)}}class sb{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,s=this.lineStarts.length;for(;t<s;){const i=t+s>>1;this.lineStarts[i]<e?t=i+1:s=i}if(this.lineStarts[t]===e)return{line:t+1,col:1};if(0===t)return{line:0,col:e};return{line:t,col:e-this.lineStarts[t-1]+1}}}}function ib(e,t){for(let s=0;s<e.length;++s)if(e[s].type===t)return!0;return!1}function ob(e){for(let t=0;t<e.length;++t)switch(e[t].type){case"space":case"comment":case"newline":break;default:return t}return-1}function rb(e){switch(e?.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function ab(e){switch(e.type){case"document":return e.start;case"block-map":{const t=e.items[e.items.length-1];return t.sep??t.start}case"block-seq":return e.items[e.items.length-1].start;default:return[]}}function nb(e){if(0===e.length)return[];let t=e.length;e:for(;--t>=0;)switch(e[t].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;"space"===e[++t]?.type;);return e.splice(t,e.length)}function lb(e){if("flow-seq-start"===e.start.type)for(const t of e.items)!t.sep||t.value||ib(t.start,"explicit-key-ind")||ib(t.sep,"map-value-ind")||(t.key&&(t.value=t.key),delete t.key,rb(t.value)?t.value.end?Array.prototype.push.apply(t.value.end,t.sep):t.value.end=t.sep:Array.prototype.push.apply(t.start,t.sep),delete t.sep)}class cb{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new tb,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&0===this.offset&&this.onNewLine(0);for(const s of this.lexer.lex(e,t))yield*this.next(s);t||(yield*this.end())}*next(e){if(this.source=e,this.atScalar)return this.atScalar=!1,yield*this.step(),void(this.offset+=e.length);const t=Kv(e);if(t)if("scalar"===t)this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&" "===e[0]&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{const t=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:t,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const e=this.peek(1);if("doc-end"!==this.type||e&&"doc-end"===e.type){if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}else{for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source})}}peek(e){return this.stack[this.stack.length-e]}*pop(e){const t=e??this.stack.pop();if(t)if(0===this.stack.length)yield t;else{const e=this.peek(1);switch("block-scalar"===t.type?t.indent="indent"in e?e.indent:0:"flow-collection"===t.type&&"document"===e.type&&(t.indent=0),"flow-collection"===t.type&&lb(t),e.type){case"document":e.value=t;break;case"block-scalar":e.props.push(t);break;case"block-map":{const s=e.items[e.items.length-1];if(s.value)return e.items.push({start:[],key:t,sep:[]}),void(this.onKeyLine=!0);if(!s.sep)return Object.assign(s,{key:t,sep:[]}),void(this.onKeyLine=!s.explicitKey);s.value=t;break}case"block-seq":{const s=e.items[e.items.length-1];s.value?e.items.push({start:[],value:t}):s.value=t;break}case"flow-collection":{const s=e.items[e.items.length-1];return void(!s||s.value?e.items.push({start:[],key:t,sep:[]}):s.sep?s.value=t:Object.assign(s,{key:t,sep:[]}))}default:yield*this.pop(),yield*this.pop(t)}if(!("document"!==e.type&&"block-map"!==e.type&&"block-seq"!==e.type||"block-map"!==t.type&&"block-seq"!==t.type)){const s=t.items[t.items.length-1];s&&!s.sep&&!s.value&&s.start.length>0&&-1===ob(s.start)&&(0===t.indent||s.start.every(e=>"comment"!==e.type||e.indent<t.indent))&&("document"===e.type?e.end=s.start:e.items.push({start:s.start}),t.items.splice(-1,1))}}else{const e="Tried to pop an empty stack";yield{type:"error",offset:this.offset,source:"",message:e}}}*stream(){switch(this.type){case"directive-line":return void(yield{type:"directive",offset:this.offset,source:this.source});case"byte-order-mark":case"space":case"comment":case"newline":return void(yield this.sourceToken);case"doc-mode":case"doc-start":{const e={type:"document",offset:this.offset,start:[]};return"doc-start"===this.type&&e.start.push(this.sourceToken),void this.stack.push(e)}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":return void(-1!==ob(e.start)?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken));case"anchor":case"tag":case"space":case"comment":case"newline":return void e.start.push(this.sourceToken)}const t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if("map-value-ind"===this.type){const t=nb(ab(this.peek(2)));let s;e.end?(s=e.end,s.push(this.sourceToken),delete e.end):s=[this.sourceToken];const i={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:t,key:e,sep:s}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=i}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":return void e.props.push(this.sourceToken);case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let e=this.source.indexOf("\n")+1;for(;0!==e;)this.onNewLine(this.offset+e),e=this.source.indexOf("\n",e)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){const t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){const s="end"in t.value?t.value.end:void 0,i=Array.isArray(s)?s[s.length-1]:void 0;"comment"===i?.type?s?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){const s=e.items[e.items.length-2],i=s?.value?.end;if(Array.isArray(i))return Array.prototype.push.apply(i,t.start),i.push(this.sourceToken),void e.items.pop()}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){const s=!this.onKeyLine&&this.indent===e.indent,i=s&&(t.sep||t.explicitKey)&&"seq-item-ind"!==this.type;let o=[];if(i&&t.sep&&!t.value){const s=[];for(let i=0;i<t.sep.length;++i){const o=t.sep[i];switch(o.type){case"newline":s.push(i);break;case"space":break;case"comment":o.indent>e.indent&&(s.length=0);break;default:s.length=0}}s.length>=2&&(o=t.sep.splice(s[1]))}switch(this.type){case"anchor":case"tag":return void(i||t.value?(o.push(this.sourceToken),e.items.push({start:o}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken));case"explicit-key-ind":return t.sep||t.explicitKey?i||t.value?(o.push(this.sourceToken),e.items.push({start:o,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}):(t.start.push(this.sourceToken),t.explicitKey=!0),void(this.onKeyLine=!0);case"map-value-ind":if(t.explicitKey)if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(ib(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]});else if(rb(t.key)&&!ib(t.sep,"newline")){const e=nb(t.start),s=t.key,i=t.sep;i.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:e,key:s,sep:i}]})}else o.length>0?t.sep=t.sep.concat(o,this.sourceToken):t.sep.push(this.sourceToken);else if(ib(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{const e=nb(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:e,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||i?e.items.push({start:o,key:null,sep:[this.sourceToken]}):ib(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return void(this.onKeyLine=!0);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const s=this.flowScalar(this.type);return void(i||t.value?(e.items.push({start:o,key:s,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(s):(Object.assign(t,{key:s,sep:[]}),this.onKeyLine=!0))}default:{const i=this.startBlockValue(e);if(i){if("block-seq"===i.type){if(!t.explicitKey&&t.sep&&!ib(t.sep,"newline"))return void(yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source}))}else s&&e.items.push({start:o});return void this.stack.push(i)}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){const t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){const s="end"in t.value?t.value.end:void 0,i=Array.isArray(s)?s[s.length-1]:void 0;"comment"===i?.type?s?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){const s=e.items[e.items.length-2],i=s?.value?.end;if(Array.isArray(i))return Array.prototype.push.apply(i,t.start),i.push(this.sourceToken),void e.items.pop()}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;return void t.start.push(this.sourceToken);case"seq-item-ind":if(this.indent!==e.indent)break;return void(t.value||ib(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken))}if(this.indent>e.indent){const t=this.startBlockValue(e);if(t)return void this.stack.push(t)}yield*this.pop(),yield*this.step()}*flowCollection(e){const t=e.items[e.items.length-1];if("flow-error-end"===this.type){let e;do{yield*this.pop(),e=this.peek(1)}while(e&&"flow-collection"===e.type)}else if(0===e.end.length){switch(this.type){case"comma":case"explicit-key-ind":return void(!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken));case"map-value-ind":return void(!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]}));case"space":case"comment":case"newline":case"anchor":case"tag":return void(!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken));case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const s=this.flowScalar(this.type);return void(!t||t.value?e.items.push({start:[],key:s,sep:[]}):t.sep?this.stack.push(s):Object.assign(t,{key:s,sep:[]}))}case"flow-map-end":case"flow-seq-end":return void e.end.push(this.sourceToken)}const s=this.startBlockValue(e);s?this.stack.push(s):(yield*this.pop(),yield*this.step())}else{const t=this.peek(2);if("block-map"===t.type&&("map-value-ind"===this.type&&t.indent===e.indent||"newline"===this.type&&!t.items[t.items.length-1].sep))yield*this.pop(),yield*this.step();else if("map-value-ind"===this.type&&"flow-collection"!==t.type){const s=nb(ab(t));lb(e);const i=e.end.splice(1,e.end.length);i.push(this.sourceToken);const o={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:s,key:e,sep:i}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=o}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let e=this.source.indexOf("\n")+1;for(;0!==e;)this.onNewLine(this.offset+e),e=this.source.indexOf("\n",e)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const t=nb(ab(e));return t.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:t,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const t=nb(ab(e));return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:t,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return"comment"===this.type&&(!(this.indent<=t)&&e.every(e=>"newline"===e.type||"space"===e.type))}*documentEnd(e){"doc-mode"!==this.type&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],"newline"===this.type&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],"newline"===this.type&&(yield*this.pop())}}}function db(e){const t=!1!==e.prettyErrors;return{lineCounter:e.lineCounter||t&&new sb||null,prettyErrors:t}}function hb(e,t={}){const{lineCounter:s,prettyErrors:i}=db(t),o=new cb(s?.addNewLine),r=new Pv(t),a=Array.from(r.compose(o.parse(e)));if(i&&s)for(const n of a)n.errors.forEach(dv(e,s)),n.warnings.forEach(dv(e,s));return a.length>0?a:Object.assign([],{empty:!0},r.streamInfo())}function ub(e,t={}){const{lineCounter:s,prettyErrors:i}=db(t),o=new cb(s?.addNewLine),r=new Pv(t);let a=null;for(const n of r.compose(o.parse(e),!0,e.length))if(a){if("silent"!==a.options.logLevel){a.errors.push(new lv(n.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}}else a=n;return i&&s&&(a.errors.forEach(dv(e,s)),a.warnings.forEach(dv(e,s))),a}function pb(e,t,s){let i;"function"==typeof t?i=t:void 0===s&&t&&"object"==typeof t&&(s=t);const o=ub(e,s);if(!o)return null;if(o.warnings.forEach(e=>Hm(o.options.logLevel,e)),o.errors.length>0){if("silent"!==o.options.logLevel)throw o.errors[0];o.errors=[]}return o.toJS(Object.assign({reviver:i},s))}function gb(e,t,s){let i=null;if("function"==typeof t||Array.isArray(t)?i=t:void 0===s&&t&&(s=t),"string"==typeof s&&(s=s.length),"number"==typeof s){const e=Math.round(s);s=e<1?void 0:e>8?{indent:8}:{indent:e}}if(void 0===e){const{keepUndefined:e}=s??t??{};if(!e)return}return Wg(e)&&!i?e.toString(s):new rv(e,i,s).toString(s)}const mb=/* @__PURE__ */Object.freeze(/* @__PURE__ */Object.defineProperty({__proto__:null,Alias:bm,CST:Gv,Composer:Pv,Document:rv,Lexer:tb,LineCounter:sb,Pair:Ym,Parser:cb,Scalar:xm,Schema:ov,YAMLError:nv,YAMLMap:of,YAMLParseError:lv,YAMLSeq:af,YAMLWarning:cv,isAlias:Hg,isCollection:Jg,isDocument:Wg,isMap:qg,isNode:Yg,isPair:Kg,isScalar:Gg,isSeq:Qg,parse:pb,parseAllDocuments:hb,parseDocument:ub,stringify:gb,visit:sm,visitAsync:om},Symbol.toStringTag,{value:"Module"}));var fb=Object.defineProperty,vb=Object.getOwnPropertyDescriptor,bb=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?vb(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&fb(t,s,r),r};let yb=class extends me{constructor(){super(...arguments),this.show=!1,this.title="Create Resource",this.value="",this.loading=!1,this.error="",this.format="yaml",this.submitLabel="Create",this.validationMessage="",this.validationStatus="",this.templates={deployment:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: my-deployment\n  namespace: default\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: my-app\n  template:\n    metadata:\n      labels:\n        app: my-app\n    spec:\n      containers:\n      - name: my-container\n        image: nginx:latest\n        ports:\n        - containerPort: 80",service:"apiVersion: v1\nkind: Service\nmetadata:\n  name: my-service\n  namespace: default\nspec:\n  selector:\n    app: my-app\n  ports:\n  - protocol: TCP\n    port: 80\n    targetPort: 80\n  type: ClusterIP",configmap:"apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: my-config\n  namespace: default\ndata:\n  config.yaml: |\n    key1: value1\n    key2: value2",secret:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: my-secret\n  namespace: default\ntype: Opaque\ndata:\n  username: YWRtaW4=\n  password: cGFzc3dvcmQ="}}render(){return J`
      <div class="drawer" part="drawer">
        <div class="drawer-header" part="header">
          <h2 class="header-title">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M10 2a1 1 0 011 1v6h6a1 1 0 110 2h-6v6a1 1 0 11-2 0v-6H3a1 1 0 110-2h6V3a1 1 0 011-1z"/>
            </svg>
            ${this.title}
          </h2>
          <button class="close-button" @click=${this.handleClose} aria-label="Close">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>

        <div class="format-toggle">
          <div class="format-left">
            <button
              class="format-button ${"yaml"===this.format?"active":""}"
              @click=${()=>this.setFormat("yaml")}
            >
              YAML
            </button>
            <button
              class="format-button ${"json"===this.format?"active":""}"
              @click=${()=>this.setFormat("json")}
            >
              JSON
            </button>
          </div>
          <div class="format-hint ${this.format}">
            ${this.format.toUpperCase()} format detected
          </div>
        </div>

        <div class="content" part="content">
          <div class="editor-container">
            <textarea
              class="editor"
              part="editor"
              .value=${this.value}
              @input=${this.handleInput}
              placeholder=${this.getPlaceholder()}
              spellcheck="false"
            ></textarea>
            
            ${this.validationMessage?J`
              <div class="validation-message ${this.validationStatus}">
                <svg class="validation-icon" viewBox="0 0 16 16" fill="currentColor">
                  ${"error"===this.validationStatus?J`
                    <path d="M8 1a7 7 0 100 14A7 7 0 008 1zm-1 10V6h2v5H7zm0 2v-1h2v1H7z"/>
                  `:J`
                    <path d="M8 1a7 7 0 100 14A7 7 0 008 1zm3.5 4.5L7 10 4.5 7.5l1-1L7 8l3.5-3.5 1 1z"/>
                  `}
                </svg>
                <span>${this.validationMessage}</span>
              </div>
            `:""}
          </div>

          <div class="templates">
            <div class="templates-title">Quick Templates:</div>
            <div class="template-buttons">
              <button class="template-button" @click=${()=>this.loadTemplate("deployment")}>
                Deployment
              </button>
              <button class="template-button" @click=${()=>this.loadTemplate("service")}>
                Service
              </button>
              <button class="template-button" @click=${()=>this.loadTemplate("configmap")}>
                ConfigMap
              </button>
              <button class="template-button" @click=${()=>this.loadTemplate("secret")}>
                Secret
              </button>
            </div>
          </div>
        </div>

        <div class="controls" part="controls">
          <button
            class="control-button cancel"
            @click=${this.handleClose}
            ?disabled=${this.loading}
          >
            Cancel
          </button>
          <button
            class="control-button create"
            @click=${this.handleCreate}
            ?disabled=${this.loading||!this.value.trim()||"error"===this.validationStatus}
          >
            ${this.loading?"Processing...":this.submitLabel}
          </button>
        </div>
      </div>
    `}getPlaceholder(){return"yaml"===this.format?"# Enter your Kubernetes resource definition in YAML format\n# Example:\n# apiVersion: v1\n# kind: Pod\n# metadata:\n#   name: my-pod\n# spec:\n#   containers:\n#   - name: my-container\n#     image: nginx":'{\n  "apiVersion": "v1",\n  "kind": "Pod",\n  "metadata": {\n    "name": "my-pod"\n  },\n  "spec": {\n    "containers": [{\n      "name": "my-container",\n      "image": "nginx"\n    }]\n  }\n}'}handleInput(e){const t=e.target;this.value=t.value;const s=this.detectFormat(this.value);this.format=s,this.validateResource()}setFormat(e){this.format=e,this.value.trim()&&this.convertFormat()}detectFormat(e){const t=e.trim();if(!t)return this.format;if(t.startsWith("{")||t.startsWith("["))try{return JSON.parse(t),"json"}catch{return"yaml"}return"yaml"}convertFormat(){try{if("json"===this.format){const e=mb.parse(this.value);this.value=JSON.stringify(e,null,2),this.validationMessage="",this.validationStatus=""}else{const e=JSON.parse(this.value);this.value=mb.stringify(e),this.validationMessage="",this.validationStatus=""}this.validateResource()}catch(e){this.validationMessage="Failed to convert format",this.validationStatus="error"}}validateResource(){if(!this.value.trim())return this.validationMessage="",void(this.validationStatus="");try{if("json"===this.format){const e=JSON.parse(this.value);this.validateResourceStructure(e)}else{const e=mb.parse(this.value);this.validateResourceStructure(e)}}catch(e){this.validationMessage=e.message||"Invalid format",this.validationStatus="error"}}validateResourceStructure(e){if(!e.apiVersion)throw new Error("Missing required field: apiVersion");if(!e.kind)throw new Error("Missing required field: kind");if(!e.metadata)throw new Error("Missing required field: metadata");if(!e.metadata.name)throw new Error("Missing required field: metadata.name");this.validationMessage=`Valid ${e.kind} resource`,this.validationStatus="success"}loadTemplate(e){this.value=this.templates[e],this.format="yaml",this.validateResource()}handleClose(){this.show=!1,this.dispatchEvent(new CustomEvent("close",{bubbles:!0,composed:!0}))}handleCreate(){if(!this.value.trim()||"error"===this.validationStatus)return;let e;try{e="json"===this.format?JSON.parse(this.value):{yaml:this.value},this.dispatchEvent(new CustomEvent("create",{detail:{resource:e,format:this.format},bubbles:!0,composed:!0}))}catch(t){this.validationMessage="Failed to parse resource",this.validationStatus="error"}}};yb.styles=g`
    :host {
      display: block;
      position: fixed;
      top: 0;
      right: 0;
      width: 700px;
      height: 100vh;
      z-index: 1000;
      /* Prevent overlay from intercepting clicks when hidden */
      pointer-events: none;
    }

    :host([show]) {
      pointer-events: auto;
    }

.drawer {
      width: 100%;
      height: 100%;
      background: var(--vscode-editor-background, var(--vscode-bg-light));
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      border-left: 1px solid var(--vscode-border);
    }

    :host([show]) .drawer {
      transform: translateX(0);
    }

.drawer-header {
      padding: 20px;
      background: var(--vscode-bg-lighter, #2c2f3a);
      border-bottom: 1px solid var(--vscode-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .header-title {
      font-size: 18px;
      font-weight: 500;
      color: var(--vscode-foreground);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .close-button {
      background: none;
      border: none;
      color: var(--close-color, #999);
      cursor: pointer;
      padding: 8px;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .close-button:hover {
      background: var(--close-hover-bg, rgba(255, 255, 255, 0.1));
      color: var(--close-hover-color, #e0e0e0);
    }

.format-toggle {
      padding: 12px 20px;
      background: var(--vscode-bg-lighter, #2c2f3a);
      border-bottom: 1px solid var(--vscode-border);
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .format-left {
      display: inline-flex;
      gap: 8px;
      align-items: center;
    }

    .format-hint {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border: 1px solid transparent;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
    }

    .format-hint.yaml {
      background: rgba(137, 209, 133, 0.08);
      border-color: #89d185;
      color: #89d185;
    }

    .format-hint.json {
      background: rgba(55, 148, 255, 0.08);
      border-color: #3794ff;
      color: #3794ff;
    }

.format-button {
      padding: 8px 16px;
      background: var(--button-bg, var(--vscode-bg-lighter, #3a3d4a));
      color: var(--button-color, var(--vscode-foreground, #e0e0e0));
      border: 1px solid var(--button-border, var(--vscode-widget-border, #4a4d5a));
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

.format-button:hover {
      background: var(--button-hover-bg, #4a4d5a);
      border-color: var(--button-hover-border, #5a5d6a);
    }

.format-button.active {
      background: var(--vscode-button-background, #0e639c);
      border-color: var(--vscode-button-border, transparent);
      color: var(--vscode-button-foreground, #ffffff);
    }

    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .editor-container {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

.editor {
      width: 100%;
      min-height: 400px;
      padding: 16px;
      background: var(--vscode-editor-background, #1e1e1e);
      color: var(--vscode-editor-foreground, #d4d4d4);
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.6;
      resize: vertical;
      outline: none;
    }

.editor:focus {
      border-color: var(--vscode-focusBorder, #007acc);
    }

    .editor::placeholder {
      color: var(--editor-placeholder, #666);
    }

    .validation-message {
      margin-top: 12px;
      padding: 12px;
      border-radius: 4px;
      font-size: 14px;
      display: flex;
      align-items: flex-start;
      gap: 8px;
    }

    .validation-message.error {
      background: var(--error-bg, rgba(244, 67, 54, 0.1));
      color: var(--error-color, #f44336);
      border: 1px solid var(--error-border, rgba(244, 67, 54, 0.3));
    }

    .validation-message.success {
      background: var(--success-bg, rgba(76, 175, 80, 0.1));
      color: var(--success-color, #4caf50);
      border: 1px solid var(--success-border, rgba(76, 175, 80, 0.3));
    }

    .validation-icon {
      flex-shrink: 0;
      width: 16px;
      height: 16px;
    }

    .templates {
      padding: 0 20px 20px;
    }

    .templates-title {
      font-size: 14px;
      color: var(--templates-title-color, #999);
      margin-bottom: 8px;
    }

    .template-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .template-button {
      padding: 6px 12px;
      background: var(--template-bg, #3a3d4a);
      color: var(--template-color, #e0e0e0);
      border: 1px solid var(--template-border, #4a4d5a);
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }

    .template-button:hover {
      background: var(--template-hover-bg, #4a4d5a);
      border-color: var(--template-hover-border, #5a5d6a);
    }

.controls {
      padding: 20px;
      background: var(--vscode-bg-lighter, #2c2f3a);
      border-top: 1px solid var(--vscode-border);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      flex-shrink: 0;
    }

    .control-button {
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      border: 1px solid transparent;
    }

.control-button.cancel {
      background: var(--vscode-button-secondaryBackground, #3a3d4a);
      color: var(--vscode-button-secondaryForeground, #e0e0e0);
      border-color: var(--vscode-button-border, #4a4d5a);
    }

.control-button.cancel:hover {
      background: var(--vscode-button-secondaryHoverBackground, #4a4d5a);
      border-color: var(--vscode-button-border, #5a5d6a);
    }

.control-button.create {
      background: var(--vscode-button-background, #0e639c);
      color: var(--vscode-button-foreground, #ffffff);
      border-color: var(--vscode-button-border, transparent);
    }

.control-button.create:hover {
      background: var(--vscode-button-hoverBackground, #1177bb);
      border-color: var(--vscode-button-border, transparent);
    }

    .control-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Scrollbar styling */
    .editor-container::-webkit-scrollbar {
      width: 8px;
    }

.editor-container::-webkit-scrollbar-track {
      background: var(--scrollbar-track, var(--vscode-editor-background, #1e1e1e));
    }

.editor-container::-webkit-scrollbar-thumb {
      background: var(--scrollbar-thumb, var(--vscode-scrollbarSlider-background, #4a4d5a));
      border-radius: 4px;
    }

    .editor-container::-webkit-scrollbar-thumb:hover {
      background: var(--scrollbar-thumb-hover, #5a5d6a);
    }
  `,bb([we({type:Boolean,reflect:!0})],yb.prototype,"show",2),bb([we({type:String})],yb.prototype,"title",2),bb([we({type:String})],yb.prototype,"value",2),bb([we({type:Boolean})],yb.prototype,"loading",2),bb([we({type:String})],yb.prototype,"error",2),bb([we({type:String})],yb.prototype,"format",2),bb([we({type:String})],yb.prototype,"submitLabel",2),bb([xe()],yb.prototype,"validationMessage",2),bb([xe()],yb.prototype,"validationStatus",2),yb=bb([ve("create-resource-drawer")],yb);var wb=Object.defineProperty,xb=Object.getOwnPropertyDescriptor,_b=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?xb(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&wb(t,s,r),r};let kb=class extends me{constructor(){super(...arguments),this.workloads=[],this.namespaces=[],this.selectedNamespace="default",this.searchQuery="",this.loading=!1,this.error=null,this.activeTab="pods",this.showDetails=!1,this.selectedItem=null,this.loadingDetails=!1,this.detailsData=null,this.showDeleteModal=!1,this.itemToDelete=null,this.isDeleting=!1,this.showCreateDrawer=!1,this.createResourceValue="",this.createDrawerTitle="Create Resource",this.isCreating=!1,this.showLogsDrawer=!1,this.logsData="",this.logsLoading=!1,this.logsError="",this.logsPodName="",this.logsNamespace="",this.resourceFormat="yaml",this.isEditMode=!1,this.editingResource=null,this.showRestartModal=!1,this.showRollbackModal=!1,this.showSetImageModal=!1,this.workloadToRestart=null,this.workloadToRollback=null,this.workloadForSetImage=null,this.containerImages=[],this.isPerformingAction=!1,this.showTerminalModal=!1,this.terminalPod="",this.terminalNamespace="",this.terminalContainer="",this.k8sEventsLive=!1,this.unsubscribeK8sEvents=null,this.k8sPollingTimer=null,this.k8sRefetchTimer=null,this.k8sDropNotified=!1,this.isSwitchingNamespace=!1,this.k8sHasConnectedOnce=!1,this.tabs=[{id:"pods",label:"Pods"},{id:"deployments",label:"Deployments"},{id:"statefulsets",label:"StatefulSets"},{id:"daemonsets",label:"DaemonSets"},{id:"jobs",label:"Jobs"},{id:"cronjobs",label:"CronJobs"}]}getColumns(){const e=[{key:"name",label:"Name",type:"link"},{key:"type",label:"Type"},{key:"namespace",label:"Namespace"},{key:"status",label:"Status",type:"status"}];return"cronjobs"===this.activeTab?e.push({key:"replicas",label:"Schedule"}):"jobs"===this.activeTab?e.push({key:"replicas",label:"Completions"}):e.push({key:"replicas",label:"Replicas"}),e.push({key:"age",label:"Age"}),e}getActions(e){const t=[{label:"View Details",action:"view"}];return"status"in e&&"Pod"===e.type&&(t.push({label:"View Logs",action:"logs"}),t.push({label:"Terminal",action:"terminal"}),t.push({label:"Set Image",action:"set-image"})),"Deployment"!==e.type&&"StatefulSet"!==e.type&&"DaemonSet"!==e.type||t.push({label:"Restart",action:"restart"},{label:"Rollback",action:"rollback"},{label:"Set Image",action:"set-image"}),t.push({label:"Edit",action:"edit"},{label:"Delete",action:"delete",danger:!0}),t}getFilteredData(){let e=this.workloads;return this.searchQuery&&(e=e.filter(e=>JSON.stringify(e).toLowerCase().includes(this.searchQuery.toLowerCase()))),e}getResourceType(){return{pods:"Pod",deployments:"Deployment",statefulsets:"StatefulSet",daemonsets:"DaemonSet",jobs:"Job",cronjobs:"CronJob"}[this.activeTab]||"Pod"}async handleTabChange(e){this.activeTab=e.detail.tabId,await this.fetchData()}handleSearchChange(e){this.searchQuery=e.detail.value}async handleNamespaceChange(e){this.isSwitchingNamespace=!0,this.stopK8sEventStream(),this.selectedNamespace=e.detail.namespace;try{await this.fetchData()}finally{this.startK8sEventStream(),this.isSwitchingNamespace=!1}}handleCellClick(e){const t=e.detail.item;this.viewDetails(t)}handleAction(e){const{action:t,item:s}=e.detail;switch(t){case"view":this.viewDetails(s);break;case"logs":this.viewLogs(s);break;case"terminal":this.openTerminal(s);break;case"edit":this.editItem(s);break;case"delete":this.deleteItem(s);break;case"restart":this.restartWorkload(s);break;case"rollback":this.rollbackWorkload(s);break;case"set-image":this.setWorkloadImage(s)}}async viewDetails(e){this.selectedItem=e,this.showDetails=!0,this.loadingDetails=!0;try{const t=this.getResourceType();this.detailsData=await Lp.getResourceDetails(t,e.name,e.namespace)}catch(t){console.error("Failed to fetch details:",t),this.detailsData=null}finally{this.loadingDetails=!1}}async viewLogs(e){if("Pod"===e.type){this.logsPodName=e.name,this.logsNamespace=e.namespace,this.showLogsDrawer=!0,this.logsLoading=!0,this.logsError="";try{const t=await Lp.getPodLogs(e.name,e.namespace);this.logsData=t}catch(t){console.error("Failed to fetch pod logs:",t),this.logsError=t.message||"Failed to fetch logs"}finally{this.logsLoading=!1}}}async editItem(e){this.editingResource=e,this.isEditMode=!0,this.createDrawerTitle=`Edit ${this.getResourceType()}`,this.resourceFormat="yaml",this.showCreateDrawer=!0,this.isCreating=!0;try{const t=this.getResourceType(),s=await Lp.getResourceRaw(t,e.name,e.namespace,"yaml");this.createResourceValue=s,this.isCreating=!1}catch(t){console.error("Failed to fetch resource for editing:",t),this.isCreating=!1,this.showCreateDrawer=!1;const e=this.shadowRoot?.querySelector("notification-container");e&&"function"==typeof e.addNotification&&e.addNotification({type:"error",message:`Failed to fetch resource: ${t.message||"Unknown error"}`})}}deleteItem(e){const t=this.getResourceType();this.itemToDelete={type:t,name:e.name,namespace:e.namespace},this.showDeleteModal=!0}async handleConfirmDelete(){if(this.itemToDelete){this.isDeleting=!0;try{await Lp.deleteResource(this.itemToDelete.type,this.itemToDelete.name,this.itemToDelete.namespace),await this.fetchData(),this.showDeleteModal=!1,this.itemToDelete=null}catch(e){console.error("Failed to delete resource:",e)}finally{this.isDeleting=!1}}}handleCancelDelete(){this.showDeleteModal=!1,this.itemToDelete=null}handleCreate(){this.isEditMode=!1,this.editingResource=null,this.resourceFormat="yaml";const e="All Namespaces"===this.selectedNamespace?"default":this.selectedNamespace;switch((this.activeTab||"").toLowerCase()){case"pods":this.createDrawerTitle="Create Pod",this.createResourceValue=`apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod\n  namespace: ${e}\nspec:\n  containers:\n  - name: nginx\n    image: nginx:latest\n    ports:\n    - containerPort: 80`;break;case"deployments":this.createDrawerTitle="Create Deployment",this.createResourceValue=`apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: my-deployment\n  namespace: ${e}\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: my-app\n  template:\n    metadata:\n      labels:\n        app: my-app\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:latest\n        ports:\n        - containerPort: 80`;break;case"statefulsets":this.createDrawerTitle="Create StatefulSet",this.createResourceValue=`apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: my-statefulset\n  namespace: ${e}\nspec:\n  serviceName: my-service\n  replicas: 3\n  selector:\n    matchLabels:\n      app: my-app\n  template:\n    metadata:\n      labels:\n        app: my-app\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:latest\n        ports:\n        - containerPort: 80`;break;case"daemonsets":this.createDrawerTitle="Create DaemonSet",this.createResourceValue=`apiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: my-daemonset\n  namespace: ${e}\nspec:\n  selector:\n    matchLabels:\n      app: my-app\n  template:\n    metadata:\n      labels:\n        app: my-app\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:latest`;break;case"jobs":this.createDrawerTitle="Create Job",this.createResourceValue=`apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: my-job\n  namespace: ${e}\nspec:\n  template:\n    spec:\n      containers:\n      - name: hello\n        image: busybox\n        command: ['sh', '-c', 'echo "Hello, Kubernetes!" && sleep 30']\n      restartPolicy: Never\n  backoffLimit: 4`;break;case"cronjobs":this.createDrawerTitle="Create CronJob",this.createResourceValue=`apiVersion: batch/v1\nkind: CronJob\nmetadata:\n  name: my-cronjob\n  namespace: ${e}\nspec:\n  schedule: "*/5 * * * *"\n  jobTemplate:\n    spec:\n      template:\n        spec:\n          containers:\n          - name: hello\n            image: busybox\n            command: ['sh', '-c', 'date; echo Hello from the Kubernetes cluster']\n          restartPolicy: OnFailure`;break;default:const t=this.shadowRoot?.querySelector("notification-container");return void(t&&"function"==typeof t.addNotification&&t.addNotification({type:"info",message:`Create is not yet available for ${this.activeTab}.`}))}this.showCreateDrawer=!0}async handleCreateResource(e){const{resource:t,format:s}=e.detail;let i="";try{if(i="json"===s?JSON.stringify(t):t.yaml,this.isCreating=!0,this.isEditMode&&this.editingResource){const e=this.getResourceType();await Lp.updateResource(e,this.editingResource.name,this.editingResource.namespace,i,s)}else await Lp.createResource(i,s);await this.fetchData(),this.showCreateDrawer=!1,this.createResourceValue="",this.isEditMode=!1,this.editingResource=null;const e=this.shadowRoot?.querySelector("notification-container");e&&"function"==typeof e.addNotification&&e.addNotification({type:"success",message:this.isEditMode?"Resource updated successfully":"Resource created successfully"})}catch(o){const e=this.shadowRoot?.querySelector("notification-container");e&&"function"==typeof e.addNotification&&e.addNotification({type:"error",message:`Failed to ${this.isEditMode?"update":"create"} resource: ${o?.message||"Unknown error"}`})}finally{this.isCreating=!1}}handleDetailsClose(){this.showDetails=!1,this.selectedItem=null,this.detailsData=null}handleLogsClose(){this.showLogsDrawer=!1,this.logsData="",this.logsError=""}restartWorkload(e){this.workloadToRestart=e,this.showRestartModal=!0,this.updateComplete.then(()=>{const t=this.shadowRoot?.querySelector("#restart-modal");t&&(t.modalTitle=`Restart ${e.type}`,t.message=`Are you sure you want to restart this ${e.type?.toLowerCase()}? All pods will be recreated.`,t.confirmLabel="Restart",t.confirmButtonClass="confirm",t.requestUpdate())})}async handleConfirmRestart(){if(this.workloadToRestart){this.isPerformingAction=!0;try{"Deployment"===this.workloadToRestart.type?await Lp.restartDeployment(this.workloadToRestart.namespace,this.workloadToRestart.name):"StatefulSet"===this.workloadToRestart.type?await Lp.restartStatefulSet(this.workloadToRestart.namespace,this.workloadToRestart.name):"DaemonSet"===this.workloadToRestart.type&&await Lp.restartDaemonSet(this.workloadToRestart.namespace,this.workloadToRestart.name),await this.fetchData();const e=this.workloadToRestart.name,t=this.workloadToRestart.type;this.showRestartModal=!1,this.workloadToRestart=null;const s=this.shadowRoot?.querySelector("notification-container");s&&"function"==typeof s.addNotification&&s.addNotification({type:"success",message:`${t} ${e} restarted successfully`})}catch(e){console.error("Failed to restart workload:",e);const t=this.shadowRoot?.querySelector("notification-container");t&&"function"==typeof t.addNotification&&t.addNotification({type:"error",message:`Failed to restart ${this.workloadToRestart?.type?.toLowerCase()||"workload"}: ${e.message||"Unknown error"}`})}finally{this.isPerformingAction=!1}}}handleCancelRestart(){this.showRestartModal=!1,this.workloadToRestart=null,this.requestUpdate()}rollbackWorkload(e){this.workloadToRollback=e,this.showRollbackModal=!0,this.updateComplete.then(()=>{const t=this.shadowRoot?.querySelector("#rollback-modal");t&&(t.modalTitle=`Rollback ${e.type}`,t.message=`Are you sure you want to rollback this ${e.type?.toLowerCase()} to the previous revision?`,t.confirmLabel="Rollback",t.confirmButtonClass="confirm",t.requestUpdate())})}async handleConfirmRollback(){if(this.workloadToRollback){this.isPerformingAction=!0;try{"Deployment"===this.workloadToRollback.type?await Lp.rollbackDeployment(this.workloadToRollback.namespace,this.workloadToRollback.name):"StatefulSet"===this.workloadToRollback.type?await Lp.rollbackStatefulSet(this.workloadToRollback.namespace,this.workloadToRollback.name):"DaemonSet"===this.workloadToRollback.type&&await Lp.rollbackDaemonSet(this.workloadToRollback.namespace,this.workloadToRollback.name),await this.fetchData();const e=this.workloadToRollback.name,t=this.workloadToRollback.type;this.showRollbackModal=!1,this.workloadToRollback=null;const s=this.shadowRoot?.querySelector("notification-container");s&&"function"==typeof s.addNotification&&s.addNotification({type:"success",message:`${t} ${e} rolled back successfully`})}catch(e){console.error("Failed to rollback workload:",e);const t=this.shadowRoot?.querySelector("notification-container");t&&"function"==typeof t.addNotification&&t.addNotification({type:"error",message:`Failed to rollback ${this.workloadToRollback?.type?.toLowerCase()||"workload"}: ${e.message||"Unknown error"}`})}finally{this.isPerformingAction=!1}}}handleCancelRollback(){this.showRollbackModal=!1,this.workloadToRollback=null,this.requestUpdate()}async setWorkloadImage(e){console.log("Setting workload image for:",e),this.workloadForSetImage=e;try{let t=[];"Pod"===e.type?t=await Lp.getPodContainers(e.namespace,e.name):"Deployment"===e.type?t=await Lp.getDeploymentContainers(e.namespace,e.name):"StatefulSet"===e.type?t=await Lp.getStatefulSetContainers(e.namespace,e.name):"DaemonSet"===e.type&&(t=await Lp.getDaemonSetContainers(e.namespace,e.name)),console.log("Fetched containers:",t),this.containerImages=t,this.showSetImageModal=!0,console.log("Modal should be visible now, showSetImageModal:",this.showSetImageModal)}catch(t){console.error("Failed to fetch workload containers:",t);const s=this.shadowRoot?.querySelector("notification-container");s&&"function"==typeof s.addNotification&&s.addNotification({type:"error",message:`Failed to fetch ${e.type?.toLowerCase()} containers: ${t.message||"Unknown error"}`})}}async handleConfirmSetImage(e){if(!this.workloadForSetImage)return;const{images:t}=e.detail;this.isPerformingAction=!0;try{"Pod"===this.workloadForSetImage.type?await Lp.setPodImages(this.workloadForSetImage.namespace,this.workloadForSetImage.name,t):"Deployment"===this.workloadForSetImage.type?await Lp.setDeploymentImages(this.workloadForSetImage.namespace,this.workloadForSetImage.name,t):"StatefulSet"===this.workloadForSetImage.type?await Lp.setStatefulSetImages(this.workloadForSetImage.namespace,this.workloadForSetImage.name,t):"DaemonSet"===this.workloadForSetImage.type&&await Lp.setDaemonSetImages(this.workloadForSetImage.namespace,this.workloadForSetImage.name,t),await this.fetchData();const e=this.workloadForSetImage?.type||"Workload",s=this.shadowRoot?.querySelector("notification-container");s&&"function"==typeof s.addNotification&&s.addNotification({type:"success",message:`${e} images updated successfully`}),this.showSetImageModal=!1,this.workloadForSetImage=null,this.containerImages=[]}catch(s){console.error("Failed to set workload images:",s);const e=this.shadowRoot?.querySelector("notification-container");e&&"function"==typeof e.addNotification&&e.addNotification({type:"error",message:`Failed to update ${this.workloadForSetImage?.type?.toLowerCase()||"workload"} images: ${s.message||"Unknown error"}`})}finally{this.isPerformingAction=!1}}handleCancelSetImage(){this.showSetImageModal=!1,this.workloadForSetImage=null,this.containerImages=[]}async handleLogsRefresh(){if(this.logsPodName&&this.logsNamespace){this.logsLoading=!0,this.logsError="";try{const e=await Lp.getPodLogs(this.logsPodName,this.logsNamespace);this.logsData=e}catch(e){console.error("Failed to refresh pod logs:",e),this.logsError=e.message||"Failed to refresh logs"}finally{this.logsLoading=!1}}}async fetchData(){this.loading=!0,this.error=null;try{this.namespaces=await Lp.getNamespaces();const e="All Namespaces"===this.selectedNamespace?void 0:this.selectedNamespace;let t=[];switch(this.activeTab){case"pods":t=(await Lp.getPods(e)).map(e=>({...e,type:"Pod"}));break;case"deployments":t=(await Lp.getDeployments(e)).map(e=>({...e,type:"Deployment",replicas:e.ready}));break;case"statefulsets":t=(await Lp.getStatefulSets(e)).map(e=>({...e,type:"StatefulSet",replicas:e.ready}));break;case"daemonsets":t=(await Lp.getDaemonSets(e)).map(e=>({...e,type:"DaemonSet",replicas:`${e.ready}/${e.desired}`}));break;case"jobs":t=(await Lp.getJobs(e)).map(e=>({...e,type:"Job",replicas:e.completions}));break;case"cronjobs":t=(await Lp.getCronJobs(e)).map(e=>({...e,type:"CronJob",replicas:e.schedule}))}this.workloads=t}catch(e){console.error("Failed to fetch workloads:",e),this.error=e.message||"Failed to fetch workloads"}finally{this.loading=!1}}showToast(e,t="info"){const s=this.shadowRoot?.querySelector("notification-container");s&&"function"==typeof s.addNotification&&s.addNotification({type:t,message:e})}startK8sEventStream(){this.unsubscribeK8sEvents||(this.unsubscribeK8sEvents=hc({channel:"All Namespaces"===this.selectedNamespace?"k8s-events":"k8s-events:"+this.selectedNamespace,routeId:"kubernetes:k8s-events",onEvent:e=>this.handleK8sEvent(e),onConnectionChange:e=>this.handleK8sEventsConnectionChange(e)}))}stopK8sEventStream(){this.unsubscribeK8sEvents&&(this.unsubscribeK8sEvents(),this.unsubscribeK8sEvents=null),this.k8sPollingTimer&&(window.clearInterval(this.k8sPollingTimer),this.k8sPollingTimer=null),this.k8sRefetchTimer&&(window.clearTimeout(this.k8sRefetchTimer),this.k8sRefetchTimer=null),this.k8sEventsLive=!1,this.k8sDropNotified=!1}handleK8sEventsConnectionChange(e){if(this.k8sEventsLive=e,!e)return!this.k8sHasConnectedOnce||this.k8sDropNotified||this.isSwitchingNamespace||(this.showToast("Live Kubernetes updates disconnected â falling back to polling","warning"),this.k8sDropNotified=!0),void this.ensureK8sPolling();this.k8sHasConnectedOnce=!0,this.k8sDropNotified=!1,this.k8sPollingTimer&&(window.clearInterval(this.k8sPollingTimer),this.k8sPollingTimer=null),this.scheduleK8sRefetch("reconnected")}ensureK8sPolling(){this.k8sPollingTimer||(this.k8sPollingTimer=window.setInterval(()=>{this.fetchData()},3e4))}scheduleK8sRefetch(e){this.k8sRefetchTimer||(this.k8sRefetchTimer=window.setTimeout(async()=>{this.k8sRefetchTimer=null;try{await this.fetchData()}catch{}},700))}handleK8sEvent(e){if(!e||"k8s-pod"!==e.kind)return;if("pods"!==this.activeTab)return;const t=String(e.action||""),s=String(e.name||""),i=String(e.namespace||"");s&&i&&("All Namespaces"!==this.selectedNamespace&&i!==this.selectedNamespace||("DELETED"!==t?this.scheduleK8sRefetch(t):this.workloads=this.workloads.filter(e=>!("Pod"===e.type&&e.name===s&&e.namespace===i))))}openTerminal(e){"Pod"===e.type&&(this.terminalPod=e.name,this.terminalNamespace=e.namespace,this.terminalContainer="",this.showTerminalModal=!0)}connectedCallback(){super.connectedCallback(),this.startK8sEventStream(),this.fetchData()}disconnectedCallback(){super.disconnectedCallback(),this.stopK8sEventStream()}render(){return J`
      <div class="container">
        <tab-group
          .tabs="${this.tabs}"
          .activeTab="${this.activeTab}"
          @tab-change="${this.handleTabChange}"
        ></tab-group>

        <div class="header">
          <namespace-dropdown
            .namespaces="${this.namespaces.map(e=>({name:e.name}))}"
            .selectedNamespace="${this.selectedNamespace}"
            @namespace-change="${this.handleNamespaceChange}"
            .loading="${this.loading}"
            .includeAllOption="${!0}"
          ></namespace-dropdown>
          
          <search-input
            .value="${this.searchQuery}"
            placeholder="Search workloads..."
            @search-change="${this.handleSearchChange}"
          ></search-input>
          
          <div class="controls">
            <span class="live-indicator ${this.k8sEventsLive?"on":"off"}" title="${this.k8sEventsLive?"Live updates connected":"Live updates disconnected"}">
              <span class="dot"></span>
              Live
            </span>
            <button class="btn-create" @click="${this.handleCreate}">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              Create
            </button>
          </div>
        </div>

        <div class="content">
          ${this.loading?J`
            <loading-state message="Loading workloads..."></loading-state>
          `:this.error?J`
            <empty-state 
              message="${this.error}" 
              icon="â ï¸"
            ></empty-state>
          `:J`
            <resource-table
              .columns="${this.getColumns()}"
              .data="${this.getFilteredData()}"
              .getActions="${e=>this.getActions(e)}"
              emptyMessage="No ${this.activeTab} found"
              @cell-click="${this.handleCellClick}"
              @action="${this.handleAction}"
            ></resource-table>
          `}
        </div>

        <detail-drawer
          .show="${this.showDetails}"
          .loading="${this.loadingDetails}"
          title="${this.selectedItem?.type} Details"
          @close="${this.handleDetailsClose}"
        >
          ${this.detailsData?J`
            <resource-detail-view .resource="${this.detailsData}"></resource-detail-view>
          `:""}
        </detail-drawer>

        ${Pp("delete-modal",J`
          <delete-modal
            id="delete-modal"
            .show="${this.showDeleteModal}"
            .item="${this.itemToDelete}"
            .loading="${this.isDeleting}"
            @confirm-delete="${this.handleConfirmDelete}"
            @cancel-delete="${this.handleCancelDelete}"
          ></delete-modal>
        `)}

        <!-- Restart Confirmation Modal -->
        ${Pp("restart-modal",J`
          <delete-modal
            id="restart-modal"
            .show="${this.showRestartModal}"
          .item="${this.workloadToRestart?{type:this.workloadToRestart.type||"Workload",name:this.workloadToRestart.name,namespace:this.workloadToRestart.namespace}:null}"
          .loading="${this.isPerformingAction}"
          .confirmLabel="Restart"
          .confirmButtonClass="confirm"
          .modalTitle="${this.workloadToRestart?`Restart ${this.workloadToRestart.type}`:"Restart"}"
          .message="${this.workloadToRestart?`Are you sure you want to restart this ${this.workloadToRestart.type?.toLowerCase()}? All pods will be recreated.`:""}"
          @confirm-delete="${this.handleConfirmRestart}"
          @cancel-delete="${this.handleCancelRestart}"
          ></delete-modal>
        `)}

        <!-- Rollback Confirmation Modal -->
        ${Pp("rollback-modal",J`
          <delete-modal
            id="rollback-modal"
            .show="${this.showRollbackModal}"
          .item="${this.workloadToRollback?{type:this.workloadToRollback.type||"Workload",name:this.workloadToRollback.name,namespace:this.workloadToRollback.namespace}:null}"
          .loading="${this.isPerformingAction}"
          .confirmLabel="Rollback"
          .confirmButtonClass="confirm"
          .modalTitle="${this.workloadToRollback?`Rollback ${this.workloadToRollback.type}`:"Rollback"}"
          .message="${this.workloadToRollback?`Are you sure you want to rollback this ${this.workloadToRollback.type?.toLowerCase()} to the previous revision?`:""}"
          @confirm-delete="${this.handleConfirmRollback}"
          @cancel-delete="${this.handleCancelRollback}"
          ></delete-modal>
        `)}

        <!-- Set Image Modal -->
        <set-image-modal
          .show="${this.showSetImageModal}"
          .loading="${this.isPerformingAction}"
          .deploymentName="${this.workloadForSetImage?.name||""}"
          .namespace="${this.workloadForSetImage?.namespace||""}"
          .containers="${this.containerImages}"
          @confirm-set-image="${this.handleConfirmSetImage}"
          @cancel-set-image="${this.handleCancelSetImage}"
        ></set-image-modal>
        <create-resource-drawer
          .show="${this.showCreateDrawer}"
          ?show="${this.showCreateDrawer}"
          .title="${this.createDrawerTitle}"
          .value="${this.createResourceValue}"
          .submitLabel="${this.isEditMode?"Update":"Apply"}"
          .loading="${this.isCreating}"
          .format="${this.resourceFormat}"
          @close="${()=>{this.showCreateDrawer=!1,this.isEditMode=!1,this.editingResource=null,this.resourceFormat="yaml"}}"
          @create="${this.handleCreateResource}"
        ></create-resource-drawer>

        <logs-drawer
          .show="${this.showLogsDrawer}"
          title="Pod Logs"
          .subtitle="${this.logsPodName} (${this.logsNamespace})"
          .logs="${this.logsData}"
          .loading="${this.logsLoading}"
          .error="${this.logsError}"
          @close="${this.handleLogsClose}"
          @refresh="${this.handleLogsRefresh}"
        ></logs-drawer>

        
        <terminal-modal
            .show="${this.showTerminalModal}"
            .pod="${this.terminalPod}"
            .namespace="${this.terminalNamespace}"
            .container="${this.terminalContainer}"
            @close="${()=>{this.showTerminalModal=!1}}"
        ></terminal-modal>

        <notification-container></notification-container>
      </div>
    `}};kb.styles=g`
    :host {
      display: block;
      height: 100%;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 1rem;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    search-input {
      flex: 1;
    }

    .content {
      flex: 1;
      overflow-y: auto;
    }

    .btn-create {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-create:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .live-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--vscode-border);
      font-size: 11px;
      color: var(--vscode-descriptionForeground);
      user-select: none;
    }

    .live-indicator .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(204, 204, 204, 0.5);
    }

    .live-indicator.on {
      border-color: rgba(137, 209, 133, 0.6);
      color: rgba(137, 209, 133, 1);
    }

    .live-indicator.on .dot {
      background: rgba(137, 209, 133, 1);
    }

    .live-indicator.off {
      opacity: 0.75;
    }

    namespace-dropdown {
      --dropdown-bg: var(--vscode-dropdown-background, #3c3c3c);
      --dropdown-color: var(--vscode-dropdown-foreground, #cccccc);
      --dropdown-border: var(--vscode-dropdown-border, #3c3c3c);
      --dropdown-hover-bg: var(--vscode-dropdown-hoverBackground, #2a2a2a);
      --menu-bg: var(--vscode-dropdown-background, #3c3c3c);
      --menu-border: var(--vscode-dropdown-border, #3c3c3c);
      --input-bg: var(--vscode-input-background, #3c3c3c);
      --input-color: var(--vscode-input-foreground, #cccccc);
      --input-border: var(--vscode-input-border, #3c3c3c);
      --option-hover-bg: var(--vscode-list-hoverBackground, #2a2a2a);
      --option-selected-bg: var(--vscode-list-activeSelectionBackground, #094771);
    }
  `,_b([we({type:Array})],kb.prototype,"workloads",2),_b([we({type:Array})],kb.prototype,"namespaces",2),_b([we({type:String})],kb.prototype,"selectedNamespace",2),_b([we({type:String})],kb.prototype,"searchQuery",2),_b([we({type:Boolean})],kb.prototype,"loading",2),_b([we({type:String})],kb.prototype,"error",2),_b([xe()],kb.prototype,"activeTab",2),_b([xe()],kb.prototype,"showDetails",2),_b([xe()],kb.prototype,"selectedItem",2),_b([xe()],kb.prototype,"loadingDetails",2),_b([xe()],kb.prototype,"detailsData",2),_b([xe()],kb.prototype,"showDeleteModal",2),_b([xe()],kb.prototype,"itemToDelete",2),_b([xe()],kb.prototype,"isDeleting",2),_b([xe()],kb.prototype,"showCreateDrawer",2),_b([xe()],kb.prototype,"createResourceValue",2),_b([xe()],kb.prototype,"createDrawerTitle",2),_b([xe()],kb.prototype,"isCreating",2),_b([xe()],kb.prototype,"showLogsDrawer",2),_b([xe()],kb.prototype,"logsData",2),_b([xe()],kb.prototype,"logsLoading",2),_b([xe()],kb.prototype,"logsError",2),_b([xe()],kb.prototype,"logsPodName",2),_b([xe()],kb.prototype,"logsNamespace",2),_b([xe()],kb.prototype,"resourceFormat",2),_b([xe()],kb.prototype,"isEditMode",2),_b([xe()],kb.prototype,"editingResource",2),_b([xe()],kb.prototype,"showRestartModal",2),_b([xe()],kb.prototype,"showRollbackModal",2),_b([xe()],kb.prototype,"showSetImageModal",2),_b([xe()],kb.prototype,"workloadToRestart",2),_b([xe()],kb.prototype,"workloadToRollback",2),_b([xe()],kb.prototype,"workloadForSetImage",2),_b([xe()],kb.prototype,"containerImages",2),_b([xe()],kb.prototype,"isPerformingAction",2),_b([xe()],kb.prototype,"showTerminalModal",2),_b([xe()],kb.prototype,"terminalPod",2),_b([xe()],kb.prototype,"terminalNamespace",2),_b([xe()],kb.prototype,"terminalContainer",2),_b([xe()],kb.prototype,"k8sEventsLive",2),kb=_b([ve("kubernetes-workloads")],kb);var Sb=Object.defineProperty,Cb=Object.getOwnPropertyDescriptor,$b=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Cb(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Sb(t,s,r),r};let Db=class extends me{constructor(){super(...arguments),this.resources=[],this.namespaces=[],this.selectedNamespace="All Namespaces",this.searchQuery="",this.loading=!1,this.error=null,this.activeTab="services",this.showDetails=!1,this.selectedItem=null,this.loadingDetails=!1,this.detailsData=null,this.showDeleteModal=!1,this.itemToDelete=null,this.isDeleting=!1,this.showCreateDrawer=!1,this.createResourceValue="",this.createDrawerTitle="Create Resource",this.isCreating=!1,this.resourceFormat="yaml",this.isEditMode=!1,this.editingResource=null,this.tabs=[{id:"services",label:"Services"},{id:"ingresses",label:"Ingresses"},{id:"ingressclasses",label:"IngressClasses"},{id:"networkpolicies",label:"NetworkPolicies"}]}getColumns(){return"services"===this.activeTab?[{key:"name",label:"Name",type:"link"},{key:"namespace",label:"Namespace"},{key:"type",label:"Type"},{key:"clusterIP",label:"Cluster IP"},{key:"ports",label:"Ports"},{key:"age",label:"Age"}]:"ingresses"===this.activeTab?[{key:"name",label:"Name",type:"link"},{key:"namespace",label:"Namespace"},{key:"class",label:"Class"},{key:"hosts",label:"Hosts"},{key:"address",label:"Address"},{key:"age",label:"Age"}]:"ingressclasses"===this.activeTab?[{key:"name",label:"Name",type:"link"},{key:"controller",label:"Controller"},{key:"parameters",label:"Parameters"},{key:"age",label:"Age"}]:[{key:"name",label:"Name",type:"link"},{key:"namespace",label:"Namespace"},{key:"podSelector",label:"Pod Selector"},{key:"policyTypes",label:"Policy Types"},{key:"age",label:"Age"}]}getActions(e){return[{label:"View Details",action:"view"},{label:"Edit",action:"edit"},{label:"Delete",action:"delete",danger:!0}]}getFilteredData(){let e=this.resources;return"ingressclasses"===this.activeTab&&(e=e.map(e=>{const t=e;return{...t,parameters:t.parameters?`${t.parameters.kind||"-"}/${t.parameters.name||"-"}`:"-"}})),"networkpolicies"===this.activeTab&&(e=e.map(e=>{const t=e;return{...t,podSelector:t.podSelector&&Object.keys(t.podSelector).length>0?Object.entries(t.podSelector).map(([e,t])=>`${e}=${t}`).join(", "):"All Pods",policyTypes:t.policyTypes?t.policyTypes.join(", "):"-"}})),this.searchQuery&&(e=e.filter(e=>JSON.stringify(e).toLowerCase().includes(this.searchQuery.toLowerCase()))),e}getResourceType(){return"services"===this.activeTab?"Service":"ingresses"===this.activeTab?"Ingress":"ingressclasses"===this.activeTab?"IngressClass":"NetworkPolicy"}async handleTabChange(e){this.activeTab=e.detail.tabId,await this.fetchData()}handleSearchChange(e){this.searchQuery=e.detail.value}async handleNamespaceChange(e){this.selectedNamespace=e.detail.namespace,await this.fetchData()}handleCellClick(e){const t=e.detail.item;this.viewDetails(t)}handleAction(e){const{action:t,item:s}=e.detail;switch(t){case"view":this.viewDetails(s);break;case"edit":this.editItem(s);break;case"delete":this.deleteItem(s)}}async viewDetails(e){this.selectedItem=e,this.showDetails=!0,this.loadingDetails=!0;try{const t=this.getResourceType(),s="namespace"in e?e.namespace:void 0;this.detailsData=await Lp.getResourceDetails(t,e.name,s)}catch(t){console.error("Failed to fetch details:",t),this.detailsData=null}finally{this.loadingDetails=!1}}async editItem(e){this.editingResource=e,this.isEditMode=!0,this.createDrawerTitle=`Edit ${this.getResourceType()}`,this.resourceFormat="yaml",this.showCreateDrawer=!0,this.isCreating=!0;try{const t=this.getResourceType(),s="namespace"in e?e.namespace:void 0,i=await Lp.getResourceRaw(t,e.name,s,"yaml");this.createResourceValue=i,this.isCreating=!1}catch(t){console.error("Failed to fetch resource for editing:",t),this.isCreating=!1,this.showCreateDrawer=!1;const e=this.shadowRoot?.querySelector("notification-container");e&&"function"==typeof e.addNotification&&e.addNotification({type:"error",message:`Failed to fetch resource: ${t.message||"Unknown error"}`})}}deleteItem(e){const t=this.getResourceType(),s="namespace"in e?e.namespace:void 0;this.itemToDelete={type:t,name:e.name,namespace:s},this.showDeleteModal=!0}async handleConfirmDelete(){if(this.itemToDelete){this.isDeleting=!0;try{await Lp.deleteResource(this.itemToDelete.type,this.itemToDelete.name,this.itemToDelete.namespace),await this.fetchData(),this.showDeleteModal=!1,this.itemToDelete=null}catch(e){console.error("Failed to delete resource:",e)}finally{this.isDeleting=!1}}}handleCancelDelete(){this.showDeleteModal=!1,this.itemToDelete=null}handleCreate(){this.isEditMode=!1,this.editingResource=null,this.resourceFormat="yaml";const e="All Namespaces"===this.selectedNamespace?"default":this.selectedNamespace;"services"===this.activeTab?(this.createDrawerTitle="Create Service",this.createResourceValue=`apiVersion: v1\nkind: Service\nmetadata:\n  name: my-service\n  namespace: ${e}\nspec:\n  selector:\n    app: my-app\n  ports:\n    - protocol: TCP\n      port: 80\n      targetPort: 8080\n  type: ClusterIP`,this.showCreateDrawer=!0):"ingresses"===this.activeTab?(this.createDrawerTitle="Create Ingress",this.createResourceValue=`apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: my-ingress\n  namespace: ${e}\nspec:\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: my-service\n                port:\n                  number: 80`,this.showCreateDrawer=!0):"ingressclasses"===this.activeTab?(this.createDrawerTitle="Create IngressClass",this.createResourceValue='apiVersion: networking.k8s.io/v1\nkind: IngressClass\nmetadata:\n  name: my-ingressclass\n  annotations:\n    ingressclass.kubernetes.io/is-default-class: "false"\nspec:\n  controller: example.com/ingress-controller',this.showCreateDrawer=!0):(this.createDrawerTitle="Create NetworkPolicy",this.createResourceValue=`apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: my-network-policy\n  namespace: ${e}\nspec:\n  podSelector:\n    matchLabels:\n      app: my-app\n  policyTypes:\n    - Ingress\n    - Egress\n  ingress:\n    - from:\n        - podSelector:\n            matchLabels:\n              app: allowed-app\n      ports:\n        - protocol: TCP\n          port: 80\n  egress:\n    - to:\n        - podSelector:\n            matchLabels:\n              app: database\n      ports:\n        - protocol: TCP\n          port: 5432`,this.showCreateDrawer=!0)}async handleCreateResource(e){const{resource:t,format:s}=e.detail;let i="";try{if(i="json"===s?JSON.stringify(t):t.yaml,this.isCreating=!0,this.isEditMode&&this.editingResource){const e=this.getResourceType(),t="namespace"in this.editingResource?this.editingResource.namespace:void 0;await Lp.updateResource(e,this.editingResource.name,t,i,s)}else await Lp.createResource(i,s);await this.fetchData(),this.showCreateDrawer=!1,this.createResourceValue="",this.isEditMode=!1,this.editingResource=null;const e=this.shadowRoot?.querySelector("notification-container");if(e&&"function"==typeof e.addNotification){const t=this.getResourceType();e.addNotification({type:"success",message:this.isEditMode?`${t} updated successfully`:`${t} created successfully`})}}catch(o){const e=this.shadowRoot?.querySelector("notification-container");e&&"function"==typeof e.addNotification&&e.addNotification({type:"error",message:`Failed to ${this.isEditMode?"update":"create"} resource: ${o?.message||"Unknown error"}`})}finally{this.isCreating=!1}}handleDetailsClose(){this.showDetails=!1,this.selectedItem=null,this.detailsData=null}async fetchData(){this.loading=!0,this.error=null;try{0===this.namespaces.length&&(this.namespaces=await Lp.getNamespaces());const e="All Namespaces"===this.selectedNamespace?void 0:this.selectedNamespace;if("services"===this.activeTab){const t=await Lp.getServices(e);this.resources=t}else if("ingresses"===this.activeTab){const t=await Lp.getIngresses(e);this.resources=t}else if("ingressclasses"===this.activeTab){const e=await Lp.getIngressClasses();this.resources=e}else{const t=await Lp.getNetworkPolicies(e);this.resources=t}}catch(e){console.error("Failed to fetch network resources:",e),this.error=e.message||"Failed to fetch network resources"}finally{this.loading=!1}}connectedCallback(){super.connectedCallback(),this.fetchData()}render(){return J`
      <div class="container">
        <tab-group
          .tabs="${this.tabs}"
          .activeTab="${this.activeTab}"
          @tab-change="${this.handleTabChange}"
        ></tab-group>

        <div class="header">
          ${"ingressclasses"!==this.activeTab?J`
            <namespace-dropdown
              .namespaces="${this.namespaces.map(e=>({name:e.name}))}"
              .selectedNamespace="${this.selectedNamespace}"
              @namespace-change="${this.handleNamespaceChange}"
              .loading="${this.loading}"
              .includeAllOption="${!0}"
            ></namespace-dropdown>
          `:""}
          
          <search-input
            .value="${this.searchQuery}"
            placeholder="Search network resources..."
            @search-change="${this.handleSearchChange}"
          ></search-input>
          
          <div class="controls">
            <button class="btn-create" @click="${this.handleCreate}">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              Create
            </button>
          </div>
        </div>

        <div class="content">
          ${this.loading?J`
            <loading-state message="Loading network resources..."></loading-state>
          `:this.error?J`
            <empty-state 
              message="${this.error}" 
              icon="â ï¸"
            ></empty-state>
          `:J`
            <resource-table
              .columns="${this.getColumns()}"
              .data="${this.getFilteredData()}"
              .getActions="${e=>this.getActions(e)}"
              emptyMessage="No ${this.activeTab} found"
              @cell-click="${this.handleCellClick}"
              @action="${this.handleAction}"
            ></resource-table>
          `}
        </div>

        <detail-drawer
          .show="${this.showDetails}"
          .loading="${this.loadingDetails}"
          title="${this.selectedItem?.name||""} Details"
          @close="${this.handleDetailsClose}"
        >
          ${this.detailsData?J`
            <resource-detail-view .resource="${this.detailsData}"></resource-detail-view>
          `:""}
        </detail-drawer>
        <delete-modal
          .show="${this.showDeleteModal}"
          .item="${this.itemToDelete}"
          .loading="${this.isDeleting}"
          @confirm-delete="${this.handleConfirmDelete}"
          @cancel-delete="${this.handleCancelDelete}"
        ></delete-modal>

        <create-resource-drawer
          .show="${this.showCreateDrawer}"
          ?show="${this.showCreateDrawer}"
          .title="${this.createDrawerTitle}"
          .value="${this.createResourceValue}"
          .submitLabel="${this.isEditMode?"Update":"Apply"}"
          .loading="${this.isCreating}"
          .format="${this.resourceFormat}"
          @close="${()=>{this.showCreateDrawer=!1,this.isEditMode=!1,this.editingResource=null,this.resourceFormat="yaml"}}"
          @create="${this.handleCreateResource}"
        ></create-resource-drawer>

        <notification-container></notification-container>
      </div>
    `}};Db.styles=g`
    :host {
      display: block;
      height: 100%;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 1rem;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    search-input {
      flex: 1;
    }

    .content {
      flex: 1;
      overflow-y: auto;
    }

    .btn-create {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-create:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    namespace-dropdown {
      --dropdown-bg: var(--vscode-dropdown-background, #3c3c3c);
      --dropdown-color: var(--vscode-dropdown-foreground, #cccccc);
      --dropdown-border: var(--vscode-dropdown-border, #3c3c3c);
      --dropdown-hover-bg: var(--vscode-dropdown-hoverBackground, #2a2a2a);
      --menu-bg: var(--vscode-dropdown-background, #3c3c3c);
      --menu-border: var(--vscode-dropdown-border, #3c3c3c);
      --input-bg: var(--vscode-input-background, #3c3c3c);
      --input-color: var(--vscode-input-foreground, #cccccc);
      --input-border: var(--vscode-input-border, #3c3c3c);
      --option-hover-bg: var(--vscode-list-hoverBackground, #2a2a2a);
      --option-selected-bg: var(--vscode-list-activeSelectionBackground, #094771);
    }
  `,$b([we({type:Array})],Db.prototype,"resources",2),$b([we({type:Array})],Db.prototype,"namespaces",2),$b([we({type:String})],Db.prototype,"selectedNamespace",2),$b([we({type:String})],Db.prototype,"searchQuery",2),$b([we({type:Boolean})],Db.prototype,"loading",2),$b([we({type:String})],Db.prototype,"error",2),$b([xe()],Db.prototype,"activeTab",2),$b([xe()],Db.prototype,"showDetails",2),$b([xe()],Db.prototype,"selectedItem",2),$b([xe()],Db.prototype,"loadingDetails",2),$b([xe()],Db.prototype,"detailsData",2),$b([xe()],Db.prototype,"showDeleteModal",2),$b([xe()],Db.prototype,"itemToDelete",2),$b([xe()],Db.prototype,"isDeleting",2),$b([xe()],Db.prototype,"showCreateDrawer",2),$b([xe()],Db.prototype,"createResourceValue",2),$b([xe()],Db.prototype,"createDrawerTitle",2),$b([xe()],Db.prototype,"isCreating",2),$b([xe()],Db.prototype,"resourceFormat",2),$b([xe()],Db.prototype,"isEditMode",2),$b([xe()],Db.prototype,"editingResource",2),Db=$b([ve("kubernetes-networks")],Db);var Eb=Object.defineProperty,Mb=Object.getOwnPropertyDescriptor,Ab=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Mb(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Eb(t,s,r),r};let Ib=class extends me{constructor(){super(...arguments),this.resources=[],this.namespaces=[],this.selectedNamespace="All Namespaces",this.searchQuery="",this.loading=!1,this.error=null,this.activeTab="pvs",this.showDetails=!1,this.selectedItem=null,this.loadingDetails=!1,this.detailsData=null,this.showDeleteModal=!1,this.itemToDelete=null,this.isDeleting=!1,this.showCreateDrawer=!1,this.createResourceValue="",this.createDrawerTitle="Create Resource",this.isCreating=!1,this.resourceFormat="yaml",this.isEditMode=!1,this.editingResource=null,this.tabs=[{id:"pvs",label:"Persistent Volumes"},{id:"pvcs",label:"Persistent Volume Claims"}]}getColumns(){return"pvs"===this.activeTab?[{key:"name",label:"Name",type:"link"},{key:"capacity",label:"Capacity"},{key:"accessModes",label:"Access Modes"},{key:"reclaimPolicy",label:"Reclaim Policy"},{key:"status",label:"Status",type:"custom"},{key:"claim",label:"Claim"},{key:"storageClass",label:"Storage Class"},{key:"age",label:"Age"}]:[{key:"name",label:"Name",type:"link"},{key:"namespace",label:"Namespace"},{key:"status",label:"Status",type:"custom"},{key:"volume",label:"Volume"},{key:"capacity",label:"Capacity"},{key:"accessModes",label:"Access Modes"},{key:"storageClass",label:"Storage Class"},{key:"age",label:"Age"}]}getActions(e){return[{label:"View Details",action:"view"},{label:"Edit",action:"edit"},{label:"Delete",action:"delete",danger:!0}]}getFilteredData(){let e=this.resources;return this.searchQuery&&(e=e.filter(e=>JSON.stringify(e).toLowerCase().includes(this.searchQuery.toLowerCase()))),e}getResourceType(){return"pvs"===this.activeTab?"PersistentVolume":"PersistentVolumeClaim"}async handleTabChange(e){this.activeTab=e.detail.tabId,await this.fetchData()}handleSearchChange(e){this.searchQuery=e.detail.value}async handleNamespaceChange(e){this.selectedNamespace=e.detail.namespace,await this.fetchData()}handleCellClick(e){const{column:t,item:s}=e.detail;"link"===t.type&&this.viewDetails(s)}getStatusClass(e){return{Bound:"bound",Available:"available",Released:"released",Pending:"pending",Failed:"failed"}[e]||"unknown"}handleAction(e){const{action:t,item:s}=e.detail;switch(t){case"view":this.viewDetails(s);break;case"edit":this.editItem(s);break;case"delete":this.deleteItem(s)}}async viewDetails(e){this.selectedItem=e,this.showDetails=!0,this.loadingDetails=!0;try{const t=this.getResourceType(),s="namespace"in e?e.namespace:void 0;this.detailsData=await Lp.getResourceDetails(t,e.name,s)}catch(t){console.error("Failed to fetch details:",t),this.detailsData=null}finally{this.loadingDetails=!1}}async editItem(e){this.editingResource=e,this.isEditMode=!0,this.createDrawerTitle=`Edit ${this.getResourceType()}`,this.resourceFormat="yaml",this.showCreateDrawer=!0,this.isCreating=!0;try{const t=this.getResourceType(),s="namespace"in e?e.namespace:void 0,i=await Lp.getResourceRaw(t,e.name,s,"yaml");this.createResourceValue=i,this.isCreating=!1}catch(t){console.error("Failed to fetch resource for editing:",t),this.isCreating=!1,this.showCreateDrawer=!1;const e=this.shadowRoot?.querySelector("notification-container");e&&"function"==typeof e.addNotification&&e.addNotification({type:"error",message:`Failed to fetch resource: ${t.message||"Unknown error"}`})}}deleteItem(e){const t=this.getResourceType(),s="namespace"in e?e.namespace:void 0;this.itemToDelete={type:t,name:e.name,namespace:s||""},this.showDeleteModal=!0}async handleConfirmDelete(){if(this.itemToDelete){this.isDeleting=!0;try{const e=this.itemToDelete.namespace||void 0;await Lp.deleteResource(this.itemToDelete.type,this.itemToDelete.name,e),await this.fetchData(),this.showDeleteModal=!1,this.itemToDelete=null}catch(e){console.error("Failed to delete resource:",e)}finally{this.isDeleting=!1}}}handleCancelDelete(){this.showDeleteModal=!1,this.itemToDelete=null}handleCreate(){this.isEditMode=!1,this.editingResource=null,this.resourceFormat="yaml";const e="All Namespaces"===this.selectedNamespace?"default":this.selectedNamespace;"pvs"===this.activeTab?(this.createDrawerTitle="Create PersistentVolume",this.createResourceValue="apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: my-pv\nspec:\n  capacity:\n    storage: 10Gi\n  accessModes:\n    - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: standard\n  hostPath:\n    path: /mnt/data"):(this.createDrawerTitle="Create PersistentVolumeClaim",this.createResourceValue=`apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: my-pvc\n  namespace: ${e}\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 5Gi\n  storageClassName: standard`),this.showCreateDrawer=!0}async handleCreateResource(e){const{resource:t,format:s}=e.detail;let i="";try{if(i="json"===s?JSON.stringify(t):t.yaml,this.isCreating=!0,this.isEditMode&&this.editingResource){const e=this.getResourceType(),t="namespace"in this.editingResource?this.editingResource.namespace:void 0;await Lp.updateResource(e,this.editingResource.name,t,i,s)}else await Lp.createResource(i,s);await this.fetchData(),this.showCreateDrawer=!1,this.createResourceValue="",this.isEditMode=!1,this.editingResource=null;const e=this.shadowRoot?.querySelector("notification-container");if(e&&"function"==typeof e.addNotification){const t=this.getResourceType();e.addNotification({type:"success",message:this.isEditMode?`${t} updated successfully`:`${t} created successfully`})}}catch(o){const e=this.shadowRoot?.querySelector("notification-container");e&&"function"==typeof e.addNotification&&e.addNotification({type:"error",message:`Failed to ${this.isEditMode?"update":"create"} resource: ${o?.message||"Unknown error"}`})}finally{this.isCreating=!1}}handleDetailsClose(){this.showDetails=!1,this.selectedItem=null,this.detailsData=null}async fetchData(){this.loading=!0,this.error=null;try{if(0===this.namespaces.length&&(this.namespaces=await Lp.getNamespaces()),"pvs"===this.activeTab){const e=await Lp.getPersistentVolumes();this.resources=e}else{const e="All Namespaces"===this.selectedNamespace?void 0:this.selectedNamespace,t=await Lp.getPersistentVolumeClaims(e);this.resources=t}}catch(e){console.error("Failed to fetch storage resources:",e),this.error=e.message||"Failed to fetch storage resources"}finally{this.loading=!1}}connectedCallback(){super.connectedCallback(),this.fetchData()}render(){const e="pvcs"===this.activeTab;return J`
      <div class="container">
        <tab-group
          .tabs="${this.tabs}"
          .activeTab="${this.activeTab}"
          @tab-change="${this.handleTabChange}"
        ></tab-group>

        <div class="header">
          ${e?J`
            <namespace-dropdown
              .namespaces="${this.namespaces.map(e=>({name:e.name}))}"
              .selectedNamespace="${this.selectedNamespace}"
              @namespace-change="${this.handleNamespaceChange}"
              .loading="${this.loading}"
              .includeAllOption="${!0}"
            ></namespace-dropdown>
          `:""}
          
          <search-input
            .value="${this.searchQuery}"
            placeholder="Search storage resources..."
            @search-change="${this.handleSearchChange}"
          ></search-input>
          
          <div class="controls">
            <button class="btn-create" @click="${this.handleCreate}">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              Create
            </button>
          </div>
        </div>

        <div class="content">
          ${this.loading?J`
            <loading-state message="Loading storage resources..."></loading-state>
          `:this.error?J`
            <empty-state 
              message="${this.error}" 
              icon="â ï¸"
            ></empty-state>
          `:J`
            <resource-table
              .columns="${this.getColumns()}"
              .data="${this.getFilteredData()}"
              .getActions="${e=>this.getActions(e)}"
              .customRenderers="${{status:e=>J`
                  <span class="status-badge ${this.getStatusClass(e)}">${e}</span>
                `}}"
              emptyMessage="No ${"pvs"===this.activeTab?"persistent volumes":"persistent volume claims"} found"
              @cell-click="${this.handleCellClick}"
              @action="${this.handleAction}"
            ></resource-table>
          `}
        </div>

        <detail-drawer
          .show="${this.showDetails}"
          .loading="${this.loadingDetails}"
          title="${this.selectedItem?.name||""} Details"
          @close="${this.handleDetailsClose}"
        >
          ${this.detailsData?J`
            <resource-detail-view .resource="${this.detailsData}"></resource-detail-view>
          `:""}
        </detail-drawer>

        <delete-modal
          .show="${this.showDeleteModal}"
          .item="${this.itemToDelete}"
          .loading="${this.isDeleting}"
          @confirm-delete="${this.handleConfirmDelete}"
          @cancel-delete="${this.handleCancelDelete}"
        ></delete-modal>

        <create-resource-drawer
          .show="${this.showCreateDrawer}"
          ?show="${this.showCreateDrawer}"
          .title="${this.createDrawerTitle}"
          .value="${this.createResourceValue}"
          .submitLabel="${this.isEditMode?"Update":"Apply"}"
          .loading="${this.isCreating}"
          .format="${this.resourceFormat}"
          @close="${()=>{this.showCreateDrawer=!1,this.isEditMode=!1,this.editingResource=null,this.resourceFormat="yaml"}}"
          @create="${this.handleCreateResource}"
        ></create-resource-drawer>

        <notification-container></notification-container>
      </div>
    `}};Ib.styles=g`
    :host {
      display: block;
      height: 100%;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 1rem;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    search-input {
      flex: 1;
    }

    .content {
      flex: 1;
      overflow-y: auto;
    }

    .btn-create {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-create:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    namespace-dropdown {
      --dropdown-bg: var(--vscode-dropdown-background, #3c3c3c);
      --dropdown-color: var(--vscode-dropdown-foreground, #cccccc);
      --dropdown-border: var(--vscode-dropdown-border, #3c3c3c);
      --dropdown-hover-bg: var(--vscode-dropdown-hoverBackground, #2a2a2a);
      --menu-bg: var(--vscode-dropdown-background, #3c3c3c);
      --menu-border: var(--vscode-dropdown-border, #3c3c3c);
      --input-bg: var(--vscode-input-background, #3c3c3c);
      --input-color: var(--vscode-input-foreground, #cccccc);
      --input-border: var(--vscode-input-border, #3c3c3c);
      --option-hover-bg: var(--vscode-list-hoverBackground, #2a2a2a);
      --option-selected-bg: var(--vscode-list-activeSelectionBackground, #094771);
    }

    .status-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-badge.bound {
      background: var(--vscode-testing-iconPassed, #73c991);
      color: var(--vscode-editor-background, #1e1e1e);
    }

    .status-badge.available {
      background: var(--vscode-testing-iconPassed, #73c991);
      color: var(--vscode-editor-background, #1e1e1e);
    }

    .status-badge.released {
      background: var(--vscode-testing-iconQueued, #cca700);
      color: var(--vscode-editor-background, #1e1e1e);
    }

    .status-badge.pending {
      background: var(--vscode-testing-iconQueued, #cca700);
      color: var(--vscode-editor-background, #1e1e1e);
    }

    .status-badge.failed {
      background: var(--vscode-testing-iconFailed, #f14c4c);
      color: var(--vscode-editor-background, #1e1e1e);
    }
  `,Ab([we({type:Array})],Ib.prototype,"resources",2),Ab([we({type:Array})],Ib.prototype,"namespaces",2),Ab([we({type:String})],Ib.prototype,"selectedNamespace",2),Ab([we({type:String})],Ib.prototype,"searchQuery",2),Ab([we({type:Boolean})],Ib.prototype,"loading",2),Ab([we({type:String})],Ib.prototype,"error",2),Ab([xe()],Ib.prototype,"activeTab",2),Ab([xe()],Ib.prototype,"showDetails",2),Ab([xe()],Ib.prototype,"selectedItem",2),Ab([xe()],Ib.prototype,"loadingDetails",2),Ab([xe()],Ib.prototype,"detailsData",2),Ab([xe()],Ib.prototype,"showDeleteModal",2),Ab([xe()],Ib.prototype,"itemToDelete",2),Ab([xe()],Ib.prototype,"isDeleting",2),Ab([xe()],Ib.prototype,"showCreateDrawer",2),Ab([xe()],Ib.prototype,"createResourceValue",2),Ab([xe()],Ib.prototype,"createDrawerTitle",2),Ab([xe()],Ib.prototype,"isCreating",2),Ab([xe()],Ib.prototype,"resourceFormat",2),Ab([xe()],Ib.prototype,"isEditMode",2),Ab([xe()],Ib.prototype,"editingResource",2),Ib=Ab([ve("kubernetes-storage")],Ib);var Tb=Object.defineProperty,Pb=Object.getOwnPropertyDescriptor,Lb=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Pb(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Tb(t,s,r),r};let Rb=class extends me{constructor(){super(...arguments),this.resources=[],this.namespaces=[],this.selectedNamespace="All Namespaces",this.searchQuery="",this.loading=!1,this.error=null,this.activeTab="configmaps",this.showDetails=!1,this.selectedItem=null,this.loadingDetails=!1,this.detailsData=null,this.showDeleteModal=!1,this.itemToDelete=null,this.isDeleting=!1,this.showCreateDrawer=!1,this.createResourceValue="",this.createDrawerTitle="Create Resource",this.isCreating=!1,this.resourceFormat="yaml",this.isEditMode=!1,this.editingResource=null,this.tabs=[{id:"configmaps",label:"ConfigMaps"},{id:"secrets",label:"Secrets"}]}getColumns(){return"configmaps"===this.activeTab?[{key:"name",label:"Name",type:"link"},{key:"namespace",label:"Namespace"},{key:"data",label:"Data Items"},{key:"age",label:"Age"}]:[{key:"name",label:"Name",type:"link"},{key:"namespace",label:"Namespace"},{key:"type",label:"Type",type:"custom"},{key:"data",label:"Data Items"},{key:"age",label:"Age"}]}getActions(e){return[{label:"View Details",action:"view"},{label:"Edit",action:"edit"},{label:"Delete",action:"delete",danger:!0}]}getFilteredData(){let e=this.resources;return this.searchQuery&&(e=e.filter(e=>JSON.stringify(e).toLowerCase().includes(this.searchQuery.toLowerCase()))),e}getResourceType(){return"configmaps"===this.activeTab?"ConfigMap":"Secret"}async handleTabChange(e){this.activeTab=e.detail.tabId,await this.fetchData()}handleSearchChange(e){this.searchQuery=e.detail.value}async handleNamespaceChange(e){this.selectedNamespace=e.detail.namespace,await this.fetchData()}handleCellClick(e){const{column:t,item:s}=e.detail;"link"===t.type&&this.viewDetails(s)}getSecretTypeClass(e){return e.includes("tls")?"tls":e.includes("docker")?"dockercfg":"Opaque"===e?"opaque":""}getSecretTypeLabel(e){return{Opaque:"Opaque","kubernetes.io/service-account-token":"Service Account","kubernetes.io/dockercfg":"Docker Config","kubernetes.io/dockerconfigjson":"Docker Config JSON","kubernetes.io/basic-auth":"Basic Auth","kubernetes.io/ssh-auth":"SSH Auth","kubernetes.io/tls":"TLS"}[e]||e}handleAction(e){const{action:t,item:s}=e.detail;switch(t){case"view":this.viewDetails(s);break;case"edit":this.editItem(s);break;case"delete":this.deleteItem(s)}}async viewDetails(e){this.selectedItem=e,this.showDetails=!0,this.loadingDetails=!0;try{const t=this.getResourceType();this.detailsData=await Lp.getResourceDetails(t,e.name,e.namespace)}catch(t){console.error("Failed to fetch details:",t),this.detailsData=null}finally{this.loadingDetails=!1}}async editItem(e){this.editingResource=e,this.isEditMode=!0,this.createDrawerTitle=`Edit ${this.getResourceType()}`,this.resourceFormat="yaml",this.showCreateDrawer=!0,this.isCreating=!0;try{const t=this.getResourceType(),s=await Lp.getResourceRaw(t,e.name,e.namespace,"yaml");this.createResourceValue=s,this.isCreating=!1}catch(t){console.error("Failed to fetch resource for editing:",t),this.isCreating=!1,this.showCreateDrawer=!1;const e=this.shadowRoot?.querySelector("notification-container");e&&"function"==typeof e.addNotification&&e.addNotification({type:"error",message:`Failed to fetch resource: ${t.message||"Unknown error"}`})}}deleteItem(e){const t=this.getResourceType();this.itemToDelete={type:t,name:e.name,namespace:e.namespace},this.showDeleteModal=!0}async handleConfirmDelete(){if(this.itemToDelete){this.isDeleting=!0;try{await Lp.deleteResource(this.itemToDelete.type,this.itemToDelete.name,this.itemToDelete.namespace),await this.fetchData(),this.showDeleteModal=!1,this.itemToDelete=null}catch(e){console.error("Failed to delete resource:",e)}finally{this.isDeleting=!1}}}handleCancelDelete(){this.showDeleteModal=!1,this.itemToDelete=null}handleCreate(){this.isEditMode=!1,this.editingResource=null,this.resourceFormat="yaml";const e="All Namespaces"===this.selectedNamespace?"default":this.selectedNamespace;"configmaps"===this.activeTab?(this.createDrawerTitle="Create ConfigMap",this.createResourceValue=`apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: my-config\n  namespace: ${e}\ndata:\n  config.yaml: |\n    server:\n      port: 8080\n      host: localhost\n    database:\n      host: db.example.com\n      port: 5432\n  app.properties: |\n    app.name=MyApp\n    app.version=1.0.0\n    debug=true`):(this.createDrawerTitle="Create Secret",this.createResourceValue=`apiVersion: v1\nkind: Secret\nmetadata:\n  name: my-secret\n  namespace: ${e}\ntype: Opaque\ndata:\n  # Note: Values must be base64 encoded\n  # Example: echo -n 'admin' | base64\n  username: YWRtaW4=\n  password: cGFzc3dvcmQ=`),this.showCreateDrawer=!0}async handleCreateResource(e){const{resource:t,format:s}=e.detail;let i="";try{if(i="json"===s?JSON.stringify(t):t.yaml,this.isCreating=!0,this.isEditMode&&this.editingResource){const e=this.getResourceType();await Lp.updateResource(e,this.editingResource.name,this.editingResource.namespace,i,s)}else await Lp.createResource(i,s);await this.fetchData(),this.showCreateDrawer=!1,this.createResourceValue="",this.isEditMode=!1,this.editingResource=null;const e=this.shadowRoot?.querySelector("notification-container");if(e&&"function"==typeof e.addNotification){const t=this.getResourceType();e.addNotification({type:"success",message:this.isEditMode?`${t} updated successfully`:`${t} created successfully`})}}catch(o){const e=this.shadowRoot?.querySelector("notification-container");e&&"function"==typeof e.addNotification&&e.addNotification({type:"error",message:`Failed to ${this.isEditMode?"update":"create"} resource: ${o?.message||"Unknown error"}`})}finally{this.isCreating=!1}}handleDetailsClose(){this.showDetails=!1,this.selectedItem=null,this.detailsData=null}async fetchData(){this.loading=!0,this.error=null;try{0===this.namespaces.length&&(this.namespaces=await Lp.getNamespaces());const e="All Namespaces"===this.selectedNamespace?void 0:this.selectedNamespace;if("configmaps"===this.activeTab){const t=await Lp.getConfigMaps(e);this.resources=t}else{const t=await Lp.getSecrets(e);this.resources=t}}catch(e){console.error("Failed to fetch configuration resources:",e),this.error=e.message||"Failed to fetch configuration resources"}finally{this.loading=!1}}connectedCallback(){super.connectedCallback(),this.fetchData()}render(){return J`
      <div class="container">
        <tab-group
          .tabs="${this.tabs}"
          .activeTab="${this.activeTab}"
          @tab-change="${this.handleTabChange}"
        ></tab-group>

        <div class="header">
          <namespace-dropdown
            .namespaces="${this.namespaces.map(e=>({name:e.name}))}"
            .selectedNamespace="${this.selectedNamespace}"
            @namespace-change="${this.handleNamespaceChange}"
            .loading="${this.loading}"
            .includeAllOption="${!0}"
          ></namespace-dropdown>
          
          <search-input
            .value="${this.searchQuery}"
            placeholder="Search configurations..."
            @search-change="${this.handleSearchChange}"
          ></search-input>
          
          <div class="controls">
            <button class="btn-create" @click="${this.handleCreate}">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              Create
            </button>
          </div>
        </div>

        <div class="content">
          ${this.loading?J`
            <loading-state message="Loading configurations..."></loading-state>
          `:this.error?J`
            <empty-state 
              message="${this.error}" 
              icon="â ï¸"
            ></empty-state>
          `:J`
            <resource-table
              .columns="${this.getColumns()}"
              .data="${this.getFilteredData()}"
              .getActions="${e=>this.getActions(e)}"
              .customRenderers="${"secrets"===this.activeTab?{type:e=>J`
                  <span class="type-badge ${this.getSecretTypeClass(e)}">
                    ${this.getSecretTypeLabel(e)}
                  </span>
                `}:{}}"
              emptyMessage="No ${this.activeTab} found"
              @cell-click="${this.handleCellClick}"
              @action="${this.handleAction}"
            ></resource-table>
          `}
        </div>

        <detail-drawer
          .show="${this.showDetails}"
          .loading="${this.loadingDetails}"
          title="${this.selectedItem?.name||""} Details"
          @close="${this.handleDetailsClose}"
        >
          ${this.detailsData?J`
            <resource-detail-view .resource="${this.detailsData}"></resource-detail-view>
          `:""}
        </detail-drawer>

        <delete-modal
          .show="${this.showDeleteModal}"
          .item="${this.itemToDelete}"
          .loading="${this.isDeleting}"
          @confirm-delete="${this.handleConfirmDelete}"
          @cancel-delete="${this.handleCancelDelete}"
        ></delete-modal>

        <create-resource-drawer
          .show="${this.showCreateDrawer}"
          ?show="${this.showCreateDrawer}"
          .title="${this.createDrawerTitle}"
          .value="${this.createResourceValue}"
          .submitLabel="${this.isEditMode?"Update":"Apply"}"
          .loading="${this.isCreating}"
          .format="${this.resourceFormat}"
          @close="${()=>{this.showCreateDrawer=!1,this.isEditMode=!1,this.editingResource=null,this.resourceFormat="yaml"}}"
          @create="${this.handleCreateResource}"
        ></create-resource-drawer>

        <notification-container></notification-container>
      </div>
    `}};Rb.styles=g`
    :host {
      display: block;
      height: 100%;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 1rem;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    search-input {
      flex: 1;
    }

    .content {
      flex: 1;
      overflow-y: auto;
    }

    .btn-create {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-create:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    namespace-dropdown {
      --dropdown-bg: var(--vscode-dropdown-background, #3c3c3c);
      --dropdown-color: var(--vscode-dropdown-foreground, #cccccc);
      --dropdown-border: var(--vscode-dropdown-border, #3c3c3c);
      --dropdown-hover-bg: var(--vscode-dropdown-hoverBackground, #2a2a2a);
      --menu-bg: var(--vscode-dropdown-background, #3c3c3c);
      --menu-border: var(--vscode-dropdown-border, #3c3c3c);
      --input-bg: var(--vscode-input-background, #3c3c3c);
      --input-color: var(--vscode-input-foreground, #cccccc);
      --input-border: var(--vscode-input-border, #3c3c3c);
      --option-hover-bg: var(--vscode-list-hoverBackground, #2a2a2a);
      --option-selected-bg: var(--vscode-list-activeSelectionBackground, #094771);
    }

    .type-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
      background: var(--vscode-badge-background, #007acc);
      color: var(--vscode-badge-foreground, white);
    }

    .type-badge.opaque {
      background: var(--vscode-testing-iconQueued, #cca700);
    }

    .type-badge.tls {
      background: var(--vscode-testing-iconPassed, #73c991);
      color: var(--vscode-editor-background, #1e1e1e);
    }

    .type-badge.dockercfg {
      background: var(--vscode-terminalCommandDecoration-defaultBackground, #40679e);
    }

    .detail-content {
      padding: 1rem;
    }

    .detail-section {
      margin-bottom: 1.5rem;
    }

    .detail-section h3 {
      margin: 0 0 0.5rem 0;
      font-size: 14px;
      font-weight: 600;
      color: var(--vscode-foreground, #cccccc);
    }

    .detail-item {
      margin-bottom: 0.5rem;
      font-size: 13px;
    }

    .detail-key {
      font-weight: 500;
      color: var(--vscode-textLink-foreground, #3794ff);
    }

    .detail-value {
      color: var(--vscode-foreground, #cccccc);
      font-family: var(--vscode-editor-font-family, monospace);
      white-space: pre-wrap;
      word-break: break-all;
    }

    .secret-value {
      color: var(--vscode-textPreformat-foreground, #d7ba7d);
      font-style: italic;
    }

    .data-grid {
      display: grid;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .data-item {
      padding: 0.5rem;
      background: var(--vscode-editor-background, #1e1e1e);
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
    }
  `,Lb([we({type:Array})],Rb.prototype,"resources",2),Lb([we({type:Array})],Rb.prototype,"namespaces",2),Lb([we({type:String})],Rb.prototype,"selectedNamespace",2),Lb([we({type:String})],Rb.prototype,"searchQuery",2),Lb([we({type:Boolean})],Rb.prototype,"loading",2),Lb([we({type:String})],Rb.prototype,"error",2),Lb([xe()],Rb.prototype,"activeTab",2),Lb([xe()],Rb.prototype,"showDetails",2),Lb([xe()],Rb.prototype,"selectedItem",2),Lb([xe()],Rb.prototype,"loadingDetails",2),Lb([xe()],Rb.prototype,"detailsData",2),Lb([xe()],Rb.prototype,"showDeleteModal",2),Lb([xe()],Rb.prototype,"itemToDelete",2),Lb([xe()],Rb.prototype,"isDeleting",2),Lb([xe()],Rb.prototype,"showCreateDrawer",2),Lb([xe()],Rb.prototype,"createResourceValue",2),Lb([xe()],Rb.prototype,"createDrawerTitle",2),Lb([xe()],Rb.prototype,"isCreating",2),Lb([xe()],Rb.prototype,"resourceFormat",2),Lb([xe()],Rb.prototype,"isEditMode",2),Lb([xe()],Rb.prototype,"editingResource",2),Rb=Lb([ve("kubernetes-configurations")],Rb);var Ob=Object.defineProperty,Nb=Object.getOwnPropertyDescriptor,Bb=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Nb(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Ob(t,s,r),r};let Fb=class extends me{constructor(){super(...arguments),this.releases=[],this.namespaces=[],this.selectedNamespace="all",this.searchQuery="",this.loading=!1,this.error=null,this.activeTab="releases",this.showDetails=!1,this.selectedItem=null,this.loadingDetails=!1,this.detailsData=null,this.showDeleteModal=!1,this.itemToDelete=null,this.isDeleting=!1,this.tabs=[{id:"releases",label:"Helm Releases"},{id:"repositories",label:"Repositories"}]}getColumns(){return"releases"===this.activeTab?[{key:"name",label:"Name",type:"link"},{key:"namespace",label:"Namespace"},{key:"revision",label:"Revision",type:"custom"},{key:"updated",label:"Updated"},{key:"status",label:"Status",type:"custom"},{key:"chart",label:"Chart",type:"custom"},{key:"appVersion",label:"App Version"}]:[{key:"name",label:"Repository Name"},{key:"url",label:"URL"},{key:"type",label:"Type"}]}getActions(e){return[{label:"View Details",action:"view"},{label:"View Values",action:"values"},{label:"Upgrade",action:"upgrade"},{label:"Rollback",action:"rollback"},{label:"Uninstall",action:"delete",danger:!0}]}getFilteredData(){let e=this.releases;return"all"!==this.selectedNamespace&&(e=e.filter(e=>e.namespace===this.selectedNamespace)),this.searchQuery&&(e=e.filter(e=>JSON.stringify(e).toLowerCase().includes(this.searchQuery.toLowerCase()))),e}async handleTabChange(e){this.activeTab=e.detail.tabId,await this.fetchData()}handleSearchChange(e){this.searchQuery=e.detail.value}async handleNamespaceChange(e){const t=e.target;this.selectedNamespace=t.value,await this.fetchData()}handleCellClick(e){const{column:t,item:s}=e.detail;"link"===t.type&&this.viewDetails(s)}getStatusClass(e){const t=e.toLowerCase();return"deployed"===t?"status-deployed":"failed"===t?"status-failed":"pending"===t||"pending-install"===t||"pending-upgrade"===t?"status-pending":"superseded"===t?"status-superseded":""}handleAction(e){const{action:t,item:s}=e.detail;switch(t){case"view":this.viewDetails(s);break;case"values":this.viewValues(s);break;case"upgrade":this.upgradeRelease(s);break;case"rollback":this.rollbackRelease(s);break;case"delete":this.deleteRelease(s)}}async viewDetails(e){this.selectedItem=e,this.showDetails=!0,this.loadingDetails=!0;try{this.detailsData=await Lp.getResourceDetails("Release",e.name,e.namespace)}catch(t){console.error("Failed to fetch release details:",t),this.detailsData=null}finally{this.loadingDetails=!1}}viewValues(e){console.log("View values:",e)}upgradeRelease(e){console.log("Upgrade release:",e)}rollbackRelease(e){console.log("Rollback release:",e)}deleteRelease(e){this.itemToDelete={type:"Helm Release",name:e.name,namespace:e.namespace},this.showDeleteModal=!0}async handleConfirmDelete(){if(this.itemToDelete){this.isDeleting=!0;try{await Lp.deleteResource("Release",this.itemToDelete.name,this.itemToDelete.namespace),await this.fetchData(),this.showDeleteModal=!1,this.itemToDelete=null}catch(e){console.error("Failed to uninstall release:",e)}finally{this.isDeleting=!1}}}handleCancelDelete(){this.showDeleteModal=!1,this.itemToDelete=null}handleInstall(){console.log("Install new chart")}handleDetailsClose(){this.showDetails=!1,this.selectedItem=null,this.detailsData=null}async fetchData(){this.loading=!0,this.error=null;try{if(0===this.namespaces.length&&(this.namespaces=await Lp.getNamespaces()),"releases"===this.activeTab){const e="all"===this.selectedNamespace?void 0:this.selectedNamespace,t=await Lp.getHelmReleases(e);this.releases=t}else this.releases=[]}catch(e){console.error("Failed to fetch Helm resources:",e),this.error=e.message||"Failed to fetch Helm resources"}finally{this.loading=!1}}renderDetailContent(){if(!this.detailsData&&!this.selectedItem)return J``;const e=this.selectedItem;return e?J`
      <div class="detail-content">
        <div class="detail-section">
          <h3>Release Information</h3>
          <div class="detail-item">
            <span class="detail-key">Name:</span> ${e.name}
          </div>
          <div class="detail-item">
            <span class="detail-key">Namespace:</span> ${e.namespace}
          </div>
          <div class="detail-item">
            <span class="detail-key">Status:</span> 
            <span class="${this.getStatusClass(e.status)}">${e.status}</span>
          </div>
          <div class="detail-item">
            <span class="detail-key">Revision:</span> 
            <span class="revision-badge">${e.revision}</span>
          </div>
          <div class="detail-item">
            <span class="detail-key">Last Updated:</span> ${e.updated}
          </div>
        </div>

        <div class="detail-section">
          <h3>Chart Information</h3>
          <div class="detail-item">
            <span class="detail-key">Chart:</span> 
            <span class="chart-badge">${e.chart}</span>
          </div>
          <div class="detail-item">
            <span class="detail-key">App Version:</span> ${e.appVersion||"N/A"}
          </div>
        </div>

        ${this.detailsData?J`
          ${this.detailsData.metadata?.notes?J`
            <div class="detail-section">
              <h3>Release Notes</h3>
              <div class="notes-content">
                ${this.detailsData.metadata.notes}
              </div>
            </div>
          `:""}

          ${this.detailsData.spec?.values?J`
            <div class="detail-section">
              <h3>Values</h3>
              <div class="values-content">
                ${JSON.stringify(this.detailsData.spec.values,null,2)}
              </div>
            </div>
          `:""}
        `:""}
      </div>
    `:J``}connectedCallback(){super.connectedCallback(),this.fetchData()}render(){return J`
      <div class="container">
        <tab-group
          .tabs="${this.tabs}"
          .activeTab="${this.activeTab}"
          @tab-change="${this.handleTabChange}"
        ></tab-group>

        <div class="header">
          <search-input
            .value="${this.searchQuery}"
            placeholder="Search Helm releases..."
            @search-change="${this.handleSearchChange}"
          ></search-input>
          
          <div class="controls">
            <div class="namespace-selector">
              <label for="namespace-select">Namespace:</label>
              <select id="namespace-select" @change="${this.handleNamespaceChange}" .value="${this.selectedNamespace}">
                <option value="all">All namespaces</option>
                ${this.namespaces.map(e=>J`
                  <option value="${e.name}">${e.name}</option>
                `)}
              </select>
            </div>
            
            <button class="btn-install" @click="${this.handleInstall}">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              Install Chart
            </button>
          </div>
        </div>

        <div class="content">
          ${this.loading?J`
            <loading-state message="Loading Helm releases..."></loading-state>
          `:this.error?J`
            <empty-state 
              message="${this.error}" 
              icon="â ï¸"
            ></empty-state>
          `:J`
            <resource-table
              .columns="${this.getColumns()}"
              .data="${this.getFilteredData()}"
              .getActions="${e=>this.getActions(e)}"
              .customRenderers="${{status:e=>J`
                    <span class="${this.getStatusClass(e)}">${e}</span>
                  `,chart:e=>J`
                    <span class="chart-badge">${e}</span>
                  `,revision:e=>J`
                    <span class="revision-badge">${e}</span>
                  `}}"
              emptyMessage="No ${this.activeTab} found"
              @cell-click="${this.handleCellClick}"
              @action="${this.handleAction}"
            ></resource-table>
          `}
        </div>

        <detail-drawer
          .show="${this.showDetails}"
          .loading="${this.loadingDetails}"
          title="${this.selectedItem?.name||""} Details"
          @close="${this.handleDetailsClose}"
        >
          ${this.renderDetailContent()}
        </detail-drawer>

        <delete-modal
          .show="${this.showDeleteModal}"
          .item="${this.itemToDelete}"
          .loading="${this.isDeleting}"
          @confirm-delete="${this.handleConfirmDelete}"
          @cancel-delete="${this.handleCancelDelete}"
        ></delete-modal>
      </div>
    `}};Fb.styles=g`
    :host {
      display: block;
      height: 100%;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 1rem;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .content {
      flex: 1;
      overflow-y: auto;
    }

    .btn-install {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-install:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .namespace-selector {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .namespace-selector label {
      font-size: 13px;
      color: var(--vscode-foreground, #cccccc);
    }

    .namespace-selector select {
      padding: 6px 10px;
      background: var(--vscode-dropdown-background, #3c3c3c);
      color: var(--vscode-dropdown-foreground, #cccccc);
      border-bottom: 1px solid var(--vscode-border);
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
    }

    .namespace-selector select:hover {
      background: var(--vscode-dropdown-hoverBackground, #2a2a2a);
    }

    .detail-content {
      padding: 1rem;
    }

    .detail-section {
      margin-bottom: 1.5rem;
    }

    .detail-section h3 {
      margin: 0 0 0.5rem 0;
      font-size: 14px;
      font-weight: 600;
      color: var(--vscode-foreground, #cccccc);
    }

    .detail-item {
      margin-bottom: 0.5rem;
      font-size: 13px;
    }

    .detail-key {
      font-weight: 500;
      color: var(--vscode-textLink-foreground, #3794ff);
    }

    .detail-value {
      color: var(--vscode-foreground, #cccccc);
      font-family: var(--vscode-editor-font-family, monospace);
      white-space: pre-wrap;
      word-break: break-all;
    }

    .status-deployed {
      color: var(--vscode-testing-iconPassed, #73c991);
    }

    .status-failed {
      color: var(--vscode-testing-iconFailed, #f14c4c);
    }

    .status-pending {
      color: var(--vscode-testing-iconQueued, #cca700);
    }

    .status-superseded {
      color: var(--vscode-descriptionForeground, #cccccc80);
    }

    .chart-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
      background: var(--vscode-badge-background, #007acc);
      color: var(--vscode-badge-foreground, white);
    }

    .revision-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
      background: var(--vscode-textPreformat-background, #ffffff1a);
      color: var(--vscode-textPreformat-foreground, #d7ba7d);
    }

    .values-content {
      background: var(--vscode-editor-background, #1e1e1e);
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      padding: 1rem;
      font-family: var(--vscode-editor-font-family, monospace);
      font-size: 12px;
      white-space: pre-wrap;
      overflow-x: auto;
      max-height: 400px;
      overflow-y: auto;
    }

    .notes-content {
      background: var(--vscode-textBlockQuote-background, #7f7f7f1a);
      border-left: 4px solid var(--vscode-textBlockQuote-border, #007acc);
      padding: 0.5rem 1rem;
      margin: 0.5rem 0;
      font-size: 13px;
      white-space: pre-wrap;
    }
  `,Bb([we({type:Array})],Fb.prototype,"releases",2),Bb([we({type:Array})],Fb.prototype,"namespaces",2),Bb([we({type:String})],Fb.prototype,"selectedNamespace",2),Bb([we({type:String})],Fb.prototype,"searchQuery",2),Bb([we({type:Boolean})],Fb.prototype,"loading",2),Bb([we({type:String})],Fb.prototype,"error",2),Bb([xe()],Fb.prototype,"activeTab",2),Bb([xe()],Fb.prototype,"showDetails",2),Bb([xe()],Fb.prototype,"selectedItem",2),Bb([xe()],Fb.prototype,"loadingDetails",2),Bb([xe()],Fb.prototype,"detailsData",2),Bb([xe()],Fb.prototype,"showDeleteModal",2),Bb([xe()],Fb.prototype,"itemToDelete",2),Bb([xe()],Fb.prototype,"isDeleting",2),Fb=Bb([ve("kubernetes-helm")],Fb);var zb=Object.defineProperty,Ub=Object.getOwnPropertyDescriptor,Vb=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Ub(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&zb(t,s,r),r};let jb=class extends me{constructor(){super(...arguments),this.nodes=[],this.searchQuery="",this.loading=!1,this.error=null,this.showDetails=!1,this.selectedNode=null,this.loadingDetails=!1,this.nodeDetails=null,this.showConfirmModal=!1,this.confirmAction=null,this.nodeForAction=null}connectedCallback(){super.connectedCallback(),this.fetchNodes()}render(){return J`
      <div class="container">
        <div class="header">
          <search-input
            .value=${this.searchQuery}
            placeholder="Search nodes..."
            @search-change=${this.handleSearchChange}
          ></search-input>

          <span class="resource-count">
            ${this.getFilteredNodes().length} nodes
          </span>
        </div>

        <div class="content">
          ${this.loading?J`
            <loading-state message="Loading nodes..."></loading-state>
          `:this.error?J`
            <empty-state
              message="Error: ${this.error}"
              icon="error"
            ></empty-state>
          `:this.renderContent()}
        </div>

        <detail-drawer
          .show=${this.showDetails}
          .title=${this.selectedNode?.name||"Node Details"}
          .width="800px"
          @close=${()=>this.showDetails=!1}
        >
          ${this.renderNodeDetail()}
        </detail-drawer>

        <delete-modal
          .show=${this.showConfirmModal}
          .item=${this.nodeForAction?{type:"Node",name:this.nodeForAction.name}:null}
          modal-title="${this.getConfirmModalConfig()?.title||"Confirm Action"}"
          message="${this.getConfirmModalConfig()?.message||""}"
          confirm-label="${this.getConfirmModalConfig()?.confirmLabel||"Confirm"}"
          confirm-button-class="${this.getConfirmModalConfig()?.confirmButtonClass||"primary"}"
          @confirm-delete=${this.handleConfirmAction}
          @cancel-delete=${this.handleCancelAction}
        ></delete-modal>

        <notification-container></notification-container>
      </div>
    `}renderContent(){const e=this.getFilteredNodes();return 0===e.length?J`
        <empty-state
          message="No nodes found"
          icon="servers"
        ></empty-state>
      `:J`
      <resource-table
        .columns=${this.getColumns()}
        .data=${e}
        .getActions=${e=>this.getNodeActions(e)}
        @cell-click=${this.handleCellClick}
        @action=${this.handleAction}
      ></resource-table>
    `}getColumns(){return[{key:"name",label:"Name",type:"link"},{key:"status",label:"Status",type:"status"},{key:"roles",label:"Roles"},{key:"age",label:"Age"},{key:"version",label:"Version"},{key:"os",label:"OS"},{key:"containerRuntime",label:"Container Runtime"}]}getFilteredNodes(){if(!this.searchQuery)return this.nodes;const e=this.searchQuery.toLowerCase();return this.nodes.filter(t=>t.name.toLowerCase().includes(e)||t.status.toLowerCase().includes(e)||t.roles.toLowerCase().includes(e)||t.version.toLowerCase().includes(e)||t.os.toLowerCase().includes(e))}getNodeActions(e){const t=[{label:"View Details",action:"view"}],s=this.nodeDetails?.spec?.unschedulable;return s?t.push({label:"Uncordon",action:"uncordon"}):t.push({label:"Cordon",action:"cordon"}),t.push({label:"Drain",action:"drain",danger:!0}),t}async fetchNodes(){this.loading=!0,this.error=null;try{this.nodes=await Lp.getNodes()}catch(e){console.error("Failed to fetch nodes:",e),this.error=e instanceof Error?e.message:"Failed to load nodes",this.showNotification("Failed to load nodes","error")}finally{this.loading=!1}}async fetchNodeDetails(e){this.loadingDetails=!0;try{const t=await Lp.getNodeDetails(e);this.nodeDetails=t.node||t}catch(t){console.error("Failed to fetch node details:",t),this.showNotification("Failed to load node details","error")}finally{this.loadingDetails=!1}}handleSearchChange(e){this.searchQuery=e.detail.value}async handleCellClick(e){const{column:t,item:s}=e.detail;"name"===t.key&&await this.viewNodeDetails(s)}async handleAction(e){const{action:t,item:s}=e.detail;switch(t){case"view":await this.viewNodeDetails(s);break;case"cordon":this.showCordonConfirmation(s);break;case"uncordon":await this.uncordonNode(s);break;case"drain":this.showDrainConfirmation(s)}}async viewNodeDetails(e){this.selectedNode=e,this.showDetails=!0,await this.fetchNodeDetails(e.name)}async cordonNode(e){try{await pc.patch(`/kubernetes/nodes/${e.name}/cordon`,{}),this.showNotification(`Node ${e.name} cordoned successfully`,"success"),await this.fetchNodes()}catch(t){console.error("Failed to cordon node:",t),this.showNotification(`Failed to cordon node ${e.name}`,"error")}}async uncordonNode(e){try{await pc.patch(`/kubernetes/nodes/${e.name}/uncordon`,{}),this.showNotification(`Node ${e.name} uncordoned successfully`,"success"),await this.fetchNodes()}catch(t){console.error("Failed to uncordon node:",t),this.showNotification(`Failed to uncordon node ${e.name}`,"error")}}async drainNode(e){try{await pc.post(`/kubernetes/nodes/${e.name}/drain`,{gracePeriodSeconds:30,timeout:300,ignoreDaemonSets:!0,deleteEmptyDirData:!1}),this.showNotification(`Node ${e.name} drained successfully`,"success"),await this.fetchNodes()}catch(t){console.error("Failed to drain node:",t),this.showNotification(`Failed to drain node ${e.name}`,"error")}}renderNodeDetail(){return this.selectedNode?this.loadingDetails?J`
        <div class="detail-content">
          <loading-state message="Loading node details..."></loading-state>
        </div>
      `:J`
      <div class="detail-content">
        ${this.renderNodeInfo()}
        ${this.renderSystemInfo()}
        ${this.renderResourceMetrics()}
        ${this.renderConditions()}
        ${this.renderTaints()}
        ${this.renderRawData()}
      </div>
    `:J``}renderNodeInfo(){if(!this.selectedNode||!this.nodeDetails)return J``;const e=this.nodeDetails.metadata||{};return J`
      <h3>Node Information</h3>
      <div class="detail-item">
        <span class="label">Name</span>
        <span class="value">${this.selectedNode.name}</span>
      </div>
      <div class="detail-item">
        <span class="label">Status</span>
        <span class="value">${this.selectedNode.status}</span>
      </div>
      <div class="detail-item">
        <span class="label">Roles</span>
        <span class="value">${this.selectedNode.roles}</span>
      </div>
      <div class="detail-item">
        <span class="label">Created</span>
        <span class="value">${new Date(e.creationTimestamp).toLocaleString()}</span>
      </div>
      <div class="detail-item">
        <span class="label">UID</span>
        <span class="value">${e.uid}</span>
      </div>
      <div class="detail-item">
        <span class="label">Pod CIDR</span>
        <span class="value">${this.nodeDetails.spec?.podCIDR||"N/A"}</span>
      </div>
      <div class="detail-item">
        <span class="label">Provider ID</span>
        <span class="value">${this.nodeDetails.spec?.providerID||"N/A"}</span>
      </div>
    `}renderSystemInfo(){if(!this.selectedNode||!this.nodeDetails)return J``;const e=this.nodeDetails.status?.nodeInfo||{};return J`
      <h3>System Information</h3>
      <div class="detail-item">
        <span class="label">Kubernetes Version</span>
        <span class="value">${e.kubeletVersion||"N/A"}</span>
      </div>
      <div class="detail-item">
        <span class="label">OS</span>
        <span class="value">${e.operatingSystem} (${e.osImage})</span>
      </div>
      <div class="detail-item">
        <span class="label">Architecture</span>
        <span class="value">${e.architecture}</span>
      </div>
      <div class="detail-item">
        <span class="label">Kernel Version</span>
        <span class="value">${e.kernelVersion}</span>
      </div>
      <div class="detail-item">
        <span class="label">Container Runtime</span>
        <span class="value">${e.containerRuntimeVersion}</span>
      </div>
      <div class="detail-item">
        <span class="label">Boot ID</span>
        <span class="value">${e.bootID}</span>
      </div>
    `}renderResourceMetrics(){if(!this.nodeDetails)return J``;const e=this.nodeDetails.status?.capacity||{},t=this.nodeDetails.status?.allocatable||{};return J`
      <h3>Resources</h3>
      <div class="resource-metrics">
        <div class="metric-item">
          <div class="metric-label">CPU</div>
          <div class="metric-value">${e.cpu||"N/A"}</div>
          <div class="metric-usage">Allocatable: ${t.cpu||"N/A"}</div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Memory</div>
          <div class="metric-value">${this.formatMemory(e.memory)}</div>
          <div class="metric-usage">Allocatable: ${this.formatMemory(t.memory)}</div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Pods</div>
          <div class="metric-value">${e.pods||"N/A"}</div>
          <div class="metric-usage">Allocatable: ${t.pods||"N/A"}</div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Ephemeral Storage</div>
          <div class="metric-value">${this.formatMemory(e["ephemeral-storage"])}</div>
          <div class="metric-usage">Allocatable: ${this.formatMemory(t["ephemeral-storage"])}</div>
        </div>
      </div>
    `}renderConditions(){if(!this.nodeDetails)return J``;const e=this.nodeDetails.status?.conditions||[];return J`
      <h3>Conditions</h3>
      <div class="conditions-grid">
        ${e.map(e=>J`
          <div class="condition-item">
            <div class="condition-status ${e.status.toLowerCase()}"></div>
            <div class="condition-info">
              <div class="condition-type">${e.type}</div>
              <div class="condition-message">${e.message||e.reason||"No message"}</div>
            </div>
          </div>
        `)}
      </div>
    `}renderTaints(){if(!this.nodeDetails)return J``;const e=this.nodeDetails.spec?.taints||[];return 0===e.length?J``:J`
      <h3>Taints</h3>
      <div class="taints-list">
        ${e.map(e=>J`
          <div class="taint-item">
            <span>${e.key}${e.value?`=${e.value}`:""}</span>
            <span class="taint-effect">${e.effect}</span>
          </div>
        `)}
      </div>
    `}renderRawData(){if(!this.nodeDetails)return J``;const e={...this.nodeDetails};return e.metadata?.managedFields&&(e.metadata={...e.metadata},delete e.metadata.managedFields),J`
      <div class="detail-section">
        <details>
          <summary>View raw resource data</summary>
          <pre class="raw-data">${JSON.stringify(e,null,2)}</pre>
        </details>
      </div>
    `}formatMemory(e){if(!e)return"N/A";const t=e.match(/(\d+)Ki/);if(t&&t[1]){return`${(parseInt(t[1])/1024/1024).toFixed(2)} GB`}return e}showCordonConfirmation(e){this.nodeForAction=e,this.confirmAction="cordon",this.showConfirmModal=!0}showDrainConfirmation(e){this.nodeForAction=e,this.confirmAction="drain",this.showConfirmModal=!0}async handleConfirmAction(){this.nodeForAction&&this.confirmAction&&("cordon"===this.confirmAction?await this.cordonNode(this.nodeForAction):"drain"===this.confirmAction&&await this.drainNode(this.nodeForAction),this.handleCancelAction())}handleCancelAction(){this.showConfirmModal=!1,this.confirmAction=null,this.nodeForAction=null}getConfirmModalConfig(){return this.nodeForAction?"cordon"===this.confirmAction?{title:"Confirm Cordon Node",message:`Are you sure you want to cordon node "${this.nodeForAction.name}"? This will mark the node as unschedulable and prevent new pods from being scheduled on it.`,confirmLabel:"Cordon",confirmButtonClass:"primary"}:"drain"===this.confirmAction?{title:"Confirm Drain Node",message:`Are you sure you want to drain node "${this.nodeForAction.name}"? This will evict all pods from the node and mark it as unschedulable. This action may cause service disruption.`,confirmLabel:"Drain",confirmButtonClass:"delete"}:null:null}showNotification(e,t="info"){const s=new CustomEvent("show-notification",{detail:{message:e,type:t},bubbles:!0,composed:!0});this.dispatchEvent(s)}};function Hb(e,t){if(!e||!t)return;const s=t.startsWith(".")?t.substring(1):t;if(!s.includes("["))return Wb(e,s);const i=s.match(/^(.*?)\[?\??\((@\.[\w]+)==['"]?(.*?)['"]?\)\]\.?(.*)$/);if(i){const[,t,s,o,r]=i;if(!s)return;let a=t?Wb(e,t):e;if(!Array.isArray(a))return;const n=s.substring(2),l=a.filter(e=>{const t=Wb(e,n);return t===o||String(t)===String(o)});return r&&l.length>0?Wb(l[0],r):l.length>0?l[0]:void 0}const o=s.match(/^(.*?)\[(\d+)\]\.?(.*)$/);if(o){const[,t,s,i]=o;if(!s)return;let r=t?Wb(e,t):e;if(!Array.isArray(r))return;const a=r[parseInt(s,10)];if(!a)return;return i?Wb(a,i):a}return Wb(e,s)}function Wb(e,t){if(!t)return e;const s=t.split(".");let i=e;for(const o of s){if(null==i)return;i=i[o]}return i}function qb(e,t){if(null==e)return"-";switch(t){case"date":try{const t=new Date(e),s=(/* @__PURE__ */new Date).getTime()-t.getTime(),i=Math.floor(s/1e3),o=Math.floor(i/60),r=Math.floor(o/60),a=Math.floor(r/24);return a>0?`${a}d ${r%24}h`:r>0?`${r}h ${o%60}m`:o>0?`${o}m`:`${i}s`}catch{return String(e)}case"integer":case"number":return String(e);case"boolean":return e?"True":"False";default:return String(e)}}jb.styles=g`
    :host {
      display: block;
      height: 100%;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 1rem;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .content {
      flex: 1;
      overflow-y: auto;
    }

    .filters {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .resource-count {
      font-size: 13px;
      color: var(--vscode-descriptionForeground, #cccccc80);
      margin-left: auto;
    }

    /* Raw Data Section */
    .raw-data {
      background: var(--vscode-editor-background, #1e1e1e);
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      padding: 1rem;
      font-family: var(--vscode-editor-font-family, 'Courier New', monospace);
      font-size: 12px;
      color: var(--vscode-editor-foreground, #d4d4d4);
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    details {
      margin-top: 1rem;
    }

    details summary {
      cursor: pointer;
      font-weight: 600;
      color: var(--vscode-textLink-foreground, #3794ff);
      padding: 0.5rem 0;
      user-select: none;
    }

    details summary:hover {
      color: var(--vscode-textLink-activeForeground, #4daafc);
    }

    /* Detail styles */
    .detail-content {
      padding: 1rem;
    }

    .detail-section {
      margin-bottom: 1.5rem;
    }

    .detail-section h3 {
      margin: 0 0 0.5rem 0;
      font-size: 14px;
      font-weight: 600;
      color: var(--vscode-foreground, #cccccc);
    }

    .detail-item {
      margin-bottom: 0.5rem;
      font-size: 13px;
    }

    .detail-key {
      font-weight: 500;
      color: var(--vscode-textLink-foreground, #3794ff);
    }

    .detail-value {
      color: var(--vscode-foreground, #cccccc);
      font-family: var(--vscode-editor-font-family, monospace);
      white-space: pre-wrap;
      word-break: break-all;
    }

    .condition-item {
      background: var(--vscode-editor-background, #1e1e1e);
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .condition-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .condition-type {
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
    }

    .condition-status {
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #cccccc80);
    }

    .taint-item {
      display: inline-block;
      background: var(--vscode-textBlockQuote-background, #7f7f7f1a);
      border-radius: 4px;
      padding: 4px 8px;
      margin: 2px;
      font-size: 11px;
    }

    .role-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
      background: var(--vscode-badge-background, #007acc);
      color: var(--vscode-badge-foreground, white);
      margin-right: 4px;
    }

    .addresses-grid {
      display: grid;
      gap: 0.5rem;
    }

    .address-item {
      padding: 0.5rem;
      background: var(--vscode-editor-background, #1e1e1e);
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
    }

  `,Vb([we({type:Array})],jb.prototype,"nodes",2),Vb([we({type:String})],jb.prototype,"searchQuery",2),Vb([we({type:Boolean})],jb.prototype,"loading",2),Vb([we({type:String})],jb.prototype,"error",2),Vb([xe()],jb.prototype,"showDetails",2),Vb([xe()],jb.prototype,"selectedNode",2),Vb([xe()],jb.prototype,"loadingDetails",2),Vb([xe()],jb.prototype,"nodeDetails",2),Vb([xe()],jb.prototype,"showConfirmModal",2),Vb([xe()],jb.prototype,"confirmAction",2),Vb([xe()],jb.prototype,"nodeForAction",2),jb=Vb([ve("kubernetes-nodes")],jb);var Kb=Object.defineProperty,Gb=Object.getOwnPropertyDescriptor,Qb=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Gb(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Kb(t,s,r),r};let Jb=class extends me{constructor(){super(...arguments),this.show=!1,this.crdName="",this.crdKind="",this.crdGroup="",this.crdVersion="",this.crdScope="Namespaced",this.loading=!1,this.width="80%",this.crdDefinition=null,this.searchQuery="",this.selectedNamespace="All Namespaces",this.instances=[],this.showInstanceDetails=!1,this.selectedInstance=null,this.instanceDetailsData=null,this.loadingDetails=!1,this.error=null,this.showEditDrawer=!1,this.editResourceContent="",this.editResourceFormat="yaml",this.loadingEdit=!1,this.deleting=!1,this.showCreateDrawer=!1,this.createResourceValue="",this.createResourceFormat="yaml",this.isCreating=!1,this.showDeleteModal=!1,this.deleteItem=null,this.handleKeyDown=e=>{"Escape"===e.key&&this.show&&(this.showInstanceDetails?this.handleInstanceDetailsClose():this.handleClose())}}async fetchInstances(){this.loading=!0,this.error=null;try{const e=await Lp.getCRDInstances(this.crdName);let t=[];if(Array.isArray(e))t=e;else if(e&&"object"==typeof e){const s=e;t=Array.isArray(s.items)?s.items:Array.isArray(s.instances)?s.instances:Array.isArray(s.resources)?s.resources:[]}this.instances=t.map(e=>{const s={name:e.metadata?.name||e.name||"",namespace:e.metadata?.namespace||e.namespace,apiVersion:e.apiVersion||`${this.crdGroup}/${this.crdVersion}`,kind:e.kind||this.crdKind,status:e.status?.phase||e.status?.state||"Unknown",age:this.calculateAge(e.metadata?.creationTimestamp||e.creationTimestamp),labels:e.metadata?.labels||e.labels||{},annotations:e.metadata?.annotations||e.annotations||{}},i=this.getAdditionalPrinterColumns();if(i&&i.length>0)for(const t of i){if("Age"===t.name||"AGE"===t.name)continue;const i=Hb(e,t.jsonPath);s[`_dynamic_${t.name}`]=qb(i,t.type||"string")}return e.metadata?.name&&e.metadata.name===t[0]?.metadata?.name&&(console.log("[CRD Debug] Processing first instance:",e.metadata.name),console.log("[CRD Debug] Item structure:",e),console.log("[CRD Debug] Printer columns:",i),i?.forEach(t=>{const s=Hb(e,t.jsonPath);console.log(`[CRD Debug] Column "${t.name}" jsonPath="${t.jsonPath}" value=`,s)})),s})}catch(e){this.error=`Failed to fetch instances: ${e?.message||"Unknown error"}`,this.instances=[]}finally{this.loading=!1}}async fetchInstanceDetails(e){this.loadingDetails=!0;try{const t="Namespaced"===this.crdScope,s=await Lp.getCRDInstanceDetails(this.crdName,e.name,t?e.namespace:void 0);this.instanceDetailsData=s?.object?s.object:s}catch(t){console.error("Failed to fetch instance details:",t),this.instanceDetailsData={apiVersion:e.apiVersion,kind:e.kind,metadata:{name:e.name,namespace:e.namespace,labels:e.labels,annotations:e.annotations},error:`Failed to fetch details: ${t?.message||"Unknown error"}`}}finally{this.loadingDetails=!1}}calculateAge(e){if(!e)return"Unknown";const t=new Date(e),s=(/* @__PURE__ */new Date).getTime()-t.getTime(),i=Math.floor(s/1e3),o=Math.floor(i/60),r=Math.floor(o/60),a=Math.floor(r/24);return a>0?`${a}d ${r%24}h`:r>0?`${r}h ${o%60}m`:o>0?`${o}m ${i%60}s`:`${i}s`}getAdditionalPrinterColumns(){if(!this.crdDefinition||!this.crdDefinition.spec||!this.crdDefinition.spec.versions)return null;const e=this.crdDefinition.spec.versions.find(e=>e.name===this.crdVersion);return e&&e.additionalPrinterColumns?e.additionalPrinterColumns.filter(e=>void 0===e.priority||0===e.priority):null}getColumns(){const e=[{key:"name",label:"Name",type:"link"}];"Namespaced"===this.crdScope&&e.push({key:"namespace",label:"Namespace"});const t=this.getAdditionalPrinterColumns();if(t&&t.length>0)for(const s of t)"Age"!==s.name&&"AGE"!==s.name&&e.push({key:`_dynamic_${s.name}`,label:s.name});else e.push({key:"status",label:"Status"});return e.push({key:"age",label:"Age"}),e}getActions(e){return[{label:"View Details",action:"view"},{label:"Edit",action:"edit"},{label:"Delete",action:"delete",danger:!0}]}getFilteredInstances(){let e=this.instances;return"Namespaced"===this.crdScope&&"All Namespaces"!==this.selectedNamespace&&(e=e.filter(e=>e.namespace===this.selectedNamespace)),this.searchQuery&&(e=e.filter(e=>e.name.toLowerCase().includes(this.searchQuery.toLowerCase())||e.namespace?.toLowerCase()?.includes(this.searchQuery.toLowerCase())||!1)),e}handleSearchChange(e){this.searchQuery=e.detail.value}handleNamespaceChange(e){this.selectedNamespace=e.detail.namespace}handleCellClick(e){const t=e.detail.item;this.viewInstanceDetails(t)}async handleAction(e){const{action:t,item:s}=e.detail;switch(t){case"view":await this.viewInstanceDetails(s);break;case"edit":await this.editInstance(s);break;case"delete":this.showDeleteConfirmation(s)}}showDeleteConfirmation(e){this.deleteItem={type:this.crdKind,name:e.name,namespace:e.namespace},this.showDeleteModal=!0}async handleConfirmDelete(e){const{item:t}=e.detail,s=this.instances.find(e=>e.name===t.name&&(!t.namespace||e.namespace===t.namespace));if(s){this.deleting=!0;try{const e="Namespaced"===this.crdScope;await Lp.deleteCRDInstance(this.crdName,s.name,e?s.namespace:void 0),this.showDeleteModal=!1,this.deleteItem=null,await this.fetchInstances(),this.dispatchEvent(new CustomEvent("notification",{detail:{type:"success",message:`Successfully deleted ${s.name}`},bubbles:!0,composed:!0}))}catch(i){console.error("Failed to delete instance:",i),this.dispatchEvent(new CustomEvent("notification",{detail:{type:"error",message:`Failed to delete instance: ${i?.message||"Unknown error"}`},bubbles:!0,composed:!0}))}finally{this.deleting=!1}}else console.error("Instance not found for deletion")}handleCancelDelete(){this.showDeleteModal=!1,this.deleteItem=null,this.deleting=!1}async viewInstanceDetails(e){this.selectedInstance=e,this.showInstanceDetails=!0,await this.fetchInstanceDetails(e)}openCreateDrawer(){this.createResourceFormat="yaml",this.showCreateDrawer=!0;const e={apiVersion:`${this.crdGroup}/${this.crdVersion}`,kind:this.crdKind,metadata:{name:"example-name",..."Namespaced"===this.crdScope&&{namespace:"default"}},spec:{}};try{this.createResourceValue=mb.stringify(e)}catch(t){console.error("Failed to generate template:",t),this.createResourceValue=JSON.stringify(e,null,2),this.createResourceFormat="json"}}async handleCreateResource(e){const{resource:t,format:s}=e.detail;let i="";try{i="json"===s?JSON.stringify(t):t.yaml,this.isCreating=!0;let e=`/kubernetes/customresourcedefinitions/${this.crdName}/instances`;if("Namespaced"===this.crdScope){const o="json"===s?t:mb.parse(i);e=`${e}/${o?.metadata?.namespace||"default"}`}else e=`${e}/-`;await pc.postResource(e,i,"json"===s?"application/json":"application/yaml");const o=this.shadowRoot?.querySelector("notification-container");o&&"function"==typeof o.addNotification&&o.addNotification({type:"success",message:`${this.crdKind} created successfully`}),await this.fetchInstances(),this.showCreateDrawer=!1,this.createResourceValue=""}catch(o){const e=this.shadowRoot?.querySelector("notification-container");e&&"function"==typeof e.addNotification&&e.addNotification({type:"error",message:`Failed to create ${this.crdKind}: ${o?.message||"Unknown error"}`})}finally{this.isCreating=!1}}async editInstance(e){this.selectedInstance=e,this.loadingEdit=!0,this.showEditDrawer=!0;try{const s="Namespaced"===this.crdScope,i=await Lp.getCRDInstanceDetails(this.crdName,e.name,s?e.namespace:void 0),o={...i?.object?i.object:i};o.metadata?.managedFields&&(o.metadata={...o.metadata},delete o.metadata.managedFields);try{this.editResourceContent=mb.stringify(o),this.editResourceFormat="yaml"}catch(t){this.editResourceContent=JSON.stringify(o,null,2),this.editResourceFormat="json"}}catch(s){console.error("Failed to fetch resource for editing:",s),this.showEditDrawer=!1,this.dispatchEvent(new CustomEvent("notification",{detail:{type:"error",message:`Failed to load resource: ${s?.message||"Unknown error"}`},bubbles:!0,composed:!0}))}finally{this.loadingEdit=!1}}handleEditDrawerClose(e){e&&e.stopPropagation(),this.showEditDrawer=!1,this.selectedInstance=null,this.editResourceContent="",this.loadingEdit=!1}async handleUpdateResource(e){const{resource:t,format:s}=e.detail;if(this.selectedInstance)try{const e="Namespaced"===this.crdScope;let i;i="json"===s?"string"==typeof t?t:JSON.stringify(t):t.yaml||t;const o=e?`/kubernetes/customresourcedefinitions/${this.crdName}/instances/${this.selectedInstance.namespace}/${this.selectedInstance.name}`:`/kubernetes/customresourcedefinitions/${this.crdName}/instances/-/${this.selectedInstance.name}`;await pc.putResource(o,i,"json"===s?"application/json":"application/yaml"),this.handleEditDrawerClose(),await this.fetchInstances(),this.dispatchEvent(new CustomEvent("notification",{detail:{type:"success",message:`Successfully updated ${this.selectedInstance.name}`},bubbles:!0,composed:!0}))}catch(i){console.error("Failed to update resource:",i),this.dispatchEvent(new CustomEvent("notification",{detail:{type:"error",message:`Failed to update resource: ${i?.message||"Unknown error"}`},bubbles:!0,composed:!0}))}else console.error("No instance selected for update")}handleInstanceDetailsClose(e){e&&e.stopPropagation(),this.showInstanceDetails=!1,this.selectedInstance=null,this.instanceDetailsData=null}handleClose(){this.dispatchEvent(new CustomEvent("close"))}connectedCallback(){super.connectedCallback(),document.addEventListener("keydown",this.handleKeyDown)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("keydown",this.handleKeyDown)}updated(e){super.updated(e),e.has("show")&&this.show&&!e.get("show")&&(this.fetchInstances(),this.searchQuery="",this.selectedNamespace="All Namespaces",this.error=null),e.has("width")&&this.style.setProperty("--drawer-width",this.width)}render(){const e=this.getFilteredInstances(),t=this.instances.length,s=new Set(this.instances.map(e=>e.namespace).filter(Boolean)),i=Array.from(s).sort(),o=this.instances.filter(e=>"Ready"===e.status).length,r=this.instances.filter(e=>"Progressing"===e.status).length,a=this.instances.filter(e=>"Error"===e.status).length;return J`
      <div class="header">
        <div class="title-section">
          <h2 class="title">
            ${this.crdKind} Instances
            <span class="kind-badge">${this.crdGroup}/${this.crdVersion}</span>
          </h2>
          <div class="subtitle">
            Viewing instances of ${this.crdName}
          </div>
        </div>
        <button class="close-button" @click="${this.handleClose}">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="controls">
        ${"Namespaced"===this.crdScope?J`
          <namespace-dropdown
            .namespaces="${i.map(e=>({name:e}))}"
            .selectedNamespace="${this.selectedNamespace}"
            @namespace-change="${this.handleNamespaceChange}"
            .loading="${this.loading}"
            .includeAllOption="${!0}"
          ></namespace-dropdown>
        `:""}
        
        <search-input
          .value="${this.searchQuery}"
          placeholder="Search instances..."
          @search-change="${this.handleSearchChange}"
        ></search-input>
            <button 
              class="btn-create" 
              @click="${this.openCreateDrawer}"
              title="Create CRD Instance"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              Create CRD Instance
            </button>
      </div>

      <div class="content">
        ${this.error?J`
          <div style="padding: 1rem; color: var(--vscode-errorForeground, #f48771); background: var(--vscode-inputValidation-errorBackground, #5a1d1d); border-radius: 4px; margin-bottom: 1rem;">
            ${this.error}
          </div>
        `:""}
        
        ${this.error?"":J`
          <div class="stats">
            <div class="stat">
              <div class="stat-label">Total Instances</div>
              <div class="stat-value">${t}</div>
            </div>
            <div class="stat">
              <div class="stat-label">Ready</div>
              <div class="stat-value" style="color: var(--vscode-testing-iconPassed, #73c991)">
                ${o}
              </div>
            </div>
            <div class="stat">
              <div class="stat-label">Progressing</div>
              <div class="stat-value" style="color: var(--vscode-testing-iconQueued, #cca700)">
                ${r}
              </div>
            </div>
            <div class="stat">
              <div class="stat-label">Error</div>
              <div class="stat-value" style="color: var(--vscode-testing-iconFailed, #f14c4c)">
                ${a}
              </div>
            </div>
          </div>
        `}

        ${this.loading?J`
          <loading-state message="Loading instances..."></loading-state>
        `:this.error?"":0===e.length?J`
          <empty-state 
            message="${this.searchQuery||"All Namespaces"!==this.selectedNamespace?"No instances found matching your filters":`No ${this.crdKind} instances found`}"
            icon="ð¦"
          ></empty-state>
        `:J`
          <div class="table-wrapper">
            <resource-table
              .columns=${this.getColumns()}
              .data=${e}
              .getActions=${e=>this.getActions(e)}
              .customRenderers=${{status:e=>{const t=e?.toLowerCase()||"unknown";return J`
                    <span class="status-badge ${t}">
                      ${e||"Unknown"}
                    </span>
                  `}}}
              @cell-click=${this.handleCellClick}
              @action=${this.handleAction}
            ></resource-table>
          </div>
        `}
      </div>

      <detail-drawer
        .show=${this.showInstanceDetails}
        .title=${`${this.selectedInstance?.name||""} Details`}
        @close=${e=>this.handleInstanceDetailsClose(e)}
      >
        ${this.loadingDetails?J`
          <loading-state message="Loading instance details..."></loading-state>
        `:this.instanceDetailsData?J`
          <resource-detail-view .resource=${this.instanceDetailsData}></resource-detail-view>
        `:""}
      </detail-drawer>

      <create-resource-drawer
        .show=${this.showEditDrawer}
        .title=${`Edit ${this.selectedInstance?.name||"Resource"}`}
        .value=${this.editResourceContent}
        .format=${this.editResourceFormat}
        .submitLabel=${"Update"}
        .loading=${this.loadingEdit}
        @close=${e=>this.handleEditDrawerClose(e)}
        @create=${this.handleUpdateResource}
      ></create-resource-drawer>


        <create-resource-drawer
          .show="${this.showCreateDrawer}"
          .title="Create CRD Instance"
          .value="${this.createResourceValue}"
          .format="${this.createResourceFormat}"
          .submitLabel=${"Apply"}
          .loading="${this.isCreating}"
          @close="${()=>{this.showCreateDrawer=!1}}"
          @create="${this.handleCreateResource}"
        ></create-resource-drawer>

      <delete-modal
        .show=${this.showDeleteModal}
        .item=${this.deleteItem}
        .loading=${this.deleting}
        @confirm-delete=${this.handleConfirmDelete}
        @cancel-delete=${this.handleCancelDelete}
      ></delete-modal>
    `}};Jb.styles=g`
    :host {
      display: block;
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: var(--drawer-width, 60%);
      background: var(--vscode-editor-background);
      border-left: 1px solid var(--vscode-border);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      overflow: visible;
    }

    :host([show]) {
      transform: translateX(0);
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      border-bottom: 1px solid var(--vscode-border);
      background: var(--vscode-editor-background);
    }

    .btn-create {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-create:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }

    .btn-create svg {
      width: 14px;
      height: 14px;
    }

    .title-section {
      flex: 1;
    }

    .title {
      font-size: 1.2rem;
      font-weight: 600;
      margin: 0;
      color: var(--vscode-foreground);
    }

    .subtitle {
      font-size: 0.9rem;
      color: var(--vscode-descriptionForeground, #8e8e8e);
      margin-top: 0.25rem;
    }

    .kind-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
      background: var(--vscode-badge-background, #007acc);
      color: var(--vscode-badge-foreground, white);
      margin-left: 0.5rem;
    }

    .close-button {
      background: none;
      border: none;
      color: var(--vscode-foreground, #cccccc);
      cursor: pointer;
      padding: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .close-button:hover {
      color: var(--vscode-button-hoverBackground, #005a9e);
    }

    .controls {
      padding: 1rem;
      display: flex;
      gap: 1rem;
      align-items: center;
      border-bottom: 1px solid var(--vscode-border);
    }

    search-input {
      flex: 1;
    }

    .content {
      flex: 1;
      overflow-y: auto;
      overflow-x: visible;
      padding: 1rem;
      position: relative;
    }
    
    /* Fix for action dropdown visibility */
    .table-wrapper {
      position: relative;
      min-height: 100px;
    }
    
    /* Ensure dropdowns from resource-table are visible */
    resource-table {
      position: static !important;
    }

    .stats {
      display: flex;
      gap: 2rem;
      padding: 1rem;
      background: var(--vscode-editorWidget-background);
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      margin-bottom: 1rem;
    }

    .stat {
      display: flex;
      flex-direction: column;
    }

    .stat-label {
      font-size: 0.8rem;
      color: var(--vscode-descriptionForeground, #8e8e8e);
      margin-bottom: 0.25rem;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--vscode-foreground, #cccccc);
    }

    .status-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
    }

    .status-badge.ready {
      background: var(--vscode-testing-iconPassed, #73c991);
      color: var(--vscode-editor-background);
    }

    .status-badge.progressing {
      background: var(--vscode-testing-iconQueued, #cca700);
      color: var(--vscode-editor-background);
    }

    .status-badge.error {
      background: var(--vscode-testing-iconFailed, #f14c4c);
      color: white;
    }

    .status-badge.unknown {
      background: var(--vscode-descriptionForeground, #8e8e8e);
      color: white;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 999;
    }

    :host([show]) ~ .overlay,
    .overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }
  `,Qb([we({type:Boolean,reflect:!0})],Jb.prototype,"show",2),Qb([we({type:String})],Jb.prototype,"crdName",2),Qb([we({type:String})],Jb.prototype,"crdKind",2),Qb([we({type:String})],Jb.prototype,"crdGroup",2),Qb([we({type:String})],Jb.prototype,"crdVersion",2),Qb([we({type:String})],Jb.prototype,"crdScope",2),Qb([we({type:Boolean})],Jb.prototype,"loading",2),Qb([we({type:String})],Jb.prototype,"width",2),Qb([we({type:Object})],Jb.prototype,"crdDefinition",2),Qb([xe()],Jb.prototype,"searchQuery",2),Qb([xe()],Jb.prototype,"selectedNamespace",2),Qb([xe()],Jb.prototype,"instances",2),Qb([xe()],Jb.prototype,"showInstanceDetails",2),Qb([xe()],Jb.prototype,"selectedInstance",2),Qb([xe()],Jb.prototype,"instanceDetailsData",2),Qb([xe()],Jb.prototype,"loadingDetails",2),Qb([xe()],Jb.prototype,"error",2),Qb([xe()],Jb.prototype,"showEditDrawer",2),Qb([xe()],Jb.prototype,"editResourceContent",2),Qb([xe()],Jb.prototype,"editResourceFormat",2),Qb([xe()],Jb.prototype,"loadingEdit",2),Qb([xe()],Jb.prototype,"deleting",2),Qb([xe()],Jb.prototype,"showCreateDrawer",2),Qb([xe()],Jb.prototype,"createResourceValue",2),Qb([xe()],Jb.prototype,"createResourceFormat",2),Qb([xe()],Jb.prototype,"isCreating",2),Qb([xe()],Jb.prototype,"showDeleteModal",2),Qb([xe()],Jb.prototype,"deleteItem",2),Jb=Qb([ve("crd-instances-drawer")],Jb);var Yb=Object.defineProperty,Xb=Object.getOwnPropertyDescriptor,Zb=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Xb(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Yb(t,s,r),r};let ey=class extends me{constructor(){super(...arguments),this.resources=[],this.searchQuery="",this.loading=!1,this.error=null,this.showDetails=!1,this.selectedItem=null,this.loadingDetails=!1,this.detailsData=null,this.showDeleteModal=!1,this.itemToDelete=null,this.isDeleting=!1,this.showCreateDrawer=!1,this.createResourceValue="",this.isCreating=!1,this.isEditMode=!1,this.editingResource=null,this.resourceFormat="yaml",this.showInstancesDrawer=!1,this.selectedCRDForInstances=null}getColumns(){return[{key:"name",label:"Name",type:"link"},{key:"group",label:"Group"},{key:"version",label:"Version"},{key:"kind",label:"Kind"},{key:"age",label:"Age"}]}getActions(e){return[{label:"View Details",action:"view"},{label:"View Instances",action:"instances"},{label:"Edit",action:"edit"},{label:"Delete",action:"delete",danger:!0}]}getFilteredData(){let e=this.resources;return this.searchQuery&&(e=e.filter(e=>JSON.stringify(e).toLowerCase().includes(this.searchQuery.toLowerCase()))),e}handleSearchChange(e){this.searchQuery=e.detail.value}handleCellClick(e){const t=e.detail.item;this.viewInstances(t)}handleAction(e){const{action:t,item:s}=e.detail;switch(t){case"view":this.viewDetails(s);break;case"instances":this.viewInstances(s);break;case"edit":this.editItem(s);break;case"delete":this.deleteItem(s)}}async editItem(e){this.editingResource=e,this.isEditMode=!0,this.resourceFormat="yaml",this.showCreateDrawer=!0,this.isCreating=!0;try{const t=await Lp.getResourceRaw("CustomResourceDefinition",e.name,void 0,"json"),s=JSON.parse(t);let i=s;s.data?.crd_detail?i=s.data.crd_detail:s.data?.crd?i=s.data.crd:s.data?.resource?i=s.data.resource:s.crd_detail?i=s.crd_detail:s.crd?i=s.crd:s.resource&&(i=s.resource),i.metadata?.managedFields&&(i=JSON.parse(JSON.stringify(i)),delete i.metadata.managedFields);const o=await import("./index-Cy0ZAiDr.js");this.createResourceValue=o.stringify(i),this.isCreating=!1}catch(t){console.error("Failed to fetch CRD for editing:",t),this.isCreating=!1,this.showCreateDrawer=!1;const e=this.shadowRoot?.querySelector("notification-container");e&&"function"==typeof e.addNotification&&e.addNotification({type:"error",message:`Failed to fetch CRD: ${t.message||"Unknown error"}`})}}async viewDetails(e){this.selectedItem=e,this.showDetails=!0,this.loadingDetails=!0;try{const t=await Lp.getResourceDetails("crd",e.name);let s=t;t?.data?.crd_detail?s=t.data.crd_detail:t?.crd_detail?s=t.crd_detail:t?.crd?s=t.crd:t?.resource&&(s=t.resource),s?.metadata?.managedFields&&delete s.metadata.managedFields,this.detailsData=s}catch(t){console.error("Failed to fetch CRD details:",t),this.detailsData=null}finally{this.loadingDetails=!1}}async viewInstances(e){this.selectedCRDForInstances=e;try{const t=await Lp.getCRDDetails(e.name);this.selectedCRDForInstances={...e,_fullDefinition:t}}catch(t){console.error("Failed to fetch full CRD definition:",t)}this.showInstancesDrawer=!0}deleteItem(e){this.itemToDelete={type:"CustomResourceDefinition",name:e.name,namespace:void 0},this.showDeleteModal=!0}async handleConfirmDelete(){if(this.itemToDelete){this.isDeleting=!0;try{await Lp.deleteResource("crd",this.itemToDelete.name),await this.fetchData(),this.showDeleteModal=!1,this.itemToDelete=null;const e=this.shadowRoot?.querySelector("notification-container");e&&"function"==typeof e.addNotification&&e.addNotification({type:"success",message:"CRD deleted successfully"})}catch(e){console.error("Failed to delete CRD:",e);const t=this.shadowRoot?.querySelector("notification-container");t&&"function"==typeof t.addNotification&&t.addNotification({type:"error",message:"Failed to delete CRD"})}finally{this.isDeleting=!1}}}handleCancelDelete(){this.showDeleteModal=!1,this.itemToDelete=null}handleCreate(){this.isEditMode=!1,this.editingResource=null,this.resourceFormat="yaml",this.createResourceValue="apiVersion: apiextensions.k8s.io/v1\nkind: CustomResourceDefinition\nmetadata:\n  name: crontabs.example.com\nspec:\n  group: example.com\n  versions:\n  - name: v1\n    served: true\n    storage: true\n    schema:\n      openAPIV3Schema:\n        type: object\n        properties:\n          spec:\n            type: object\n            properties:\n              cronSpec:\n                type: string\n              image:\n                type: string\n              replicas:\n                type: integer\n  scope: Namespaced\n  names:\n    plural: crontabs\n    singular: crontab\n    kind: CronTab\n    shortNames:\n    - ct",this.showCreateDrawer=!0}async handleCreateResource(e){const{resource:t,format:s}=e.detail;let i="";try{if(i="json"===s?JSON.stringify(t):t.yaml,this.isCreating=!0,this.isEditMode&&this.editingResource){await Lp.updateResource("CustomResourceDefinition",this.editingResource.name,void 0,i,s);const e=this.shadowRoot?.querySelector("notification-container");e&&"function"==typeof e.addNotification&&e.addNotification({type:"success",message:"CRD updated successfully"})}else{await Lp.createResource(i,s);const e=this.shadowRoot?.querySelector("notification-container");e&&"function"==typeof e.addNotification&&e.addNotification({type:"success",message:"CRD created successfully"})}await this.fetchData(),this.showCreateDrawer=!1,this.createResourceValue="",this.isEditMode=!1,this.editingResource=null}catch(o){const e=this.shadowRoot?.querySelector("notification-container");if(e&&"function"==typeof e.addNotification){const t=this.isEditMode?"update":"create";e.addNotification({type:"error",message:`Failed to ${t} CRD: ${o?.message||"Unknown error"}`})}}finally{this.isCreating=!1}}handleDetailsClose(){this.showDetails=!1,this.selectedItem=null,this.detailsData=null}handleInstancesDrawerClose(){this.showInstancesDrawer=!1,this.selectedCRDForInstances=null}async fetchData(){this.loading=!0,this.error=null;try{const e=await Lp.getCRDs();this.resources=e}catch(e){console.error("Failed to fetch CRDs:",e),this.error=e.message||"Failed to fetch Custom Resource Definitions"}finally{this.loading=!1}}connectedCallback(){super.connectedCallback(),this.fetchData()}render(){return J`
      <div class="container">
        <div class="header">
          <search-input
            .value="${this.searchQuery}"
            placeholder="Search CRDs..."
            @search-change="${this.handleSearchChange}"
          ></search-input>
          
          <div class="controls">
            <button class="btn-create" @click="${this.handleCreate}">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              Create CRD
            </button>
          </div>
        </div>

        <div class="content">
          ${this.loading?J`
            <loading-state message="Loading Custom Resource Definitions..."></loading-state>
          `:this.error?J`
            <empty-state 
              message="${this.error}" 
              icon="â ï¸"
            ></empty-state>
          `:J`
            <resource-table
              .columns="${this.getColumns()}"
              .data="${this.getFilteredData()}"
              .getActions="${e=>this.getActions(e)}"
              emptyMessage="No Custom Resource Definitions found"
              @cell-click="${this.handleCellClick}"
              @action="${this.handleAction}"
            ></resource-table>
          `}
        </div>

        <detail-drawer
          .show="${this.showDetails}"
          .loading="${this.loadingDetails}"
          title="${this.selectedItem?.name||""} Details"
          @close="${this.handleDetailsClose}"
        >
          ${this.detailsData?J`
            <resource-detail-view .resource="${this.detailsData}"></resource-detail-view>
          `:""}
        </detail-drawer>

        <delete-modal
          .show="${this.showDeleteModal}"
          .item="${this.itemToDelete}"
          .loading="${this.isDeleting}"
          @confirm-delete="${this.handleConfirmDelete}"
          @cancel-delete="${this.handleCancelDelete}"
        ></delete-modal>

        <create-resource-drawer
          .show="${this.showCreateDrawer}"
          .title="${this.isEditMode?"Edit CRD":"Create CRD"}"
          .value="${this.createResourceValue}"
          .format="${this.resourceFormat}"
          .submitLabel="Apply"
          .loading="${this.isCreating}"
          @close="${()=>{this.showCreateDrawer=!1}}"
          @create="${this.handleCreateResource}"
        ></create-resource-drawer>

        <notification-container></notification-container>
      </div>

      <crd-instances-drawer
        .show="${this.showInstancesDrawer}"
        .crdName="${this.selectedCRDForInstances?.name||""}"
        .crdKind="${this.selectedCRDForInstances?.kind||""}"
        .crdGroup="${this.selectedCRDForInstances?.group||""}"
        .crdVersion="${this.selectedCRDForInstances?.version||""}"
        .crdScope="${this.selectedCRDForInstances?.scope||"Namespaced"}"
        .crdDefinition="${this.selectedCRDForInstances?._fullDefinition}"
        @close="${this.handleInstancesDrawerClose}"
      ></crd-instances-drawer>
    `}};ey.styles=g`
    :host {
      display: block;
      height: 100%;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 1rem;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    search-input {
      flex: 1;
    }

    .content {
      flex: 1;
      overflow-y: auto;
    }

    .btn-create {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-create:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
  `,Zb([we({type:Array})],ey.prototype,"resources",2),Zb([we({type:String})],ey.prototype,"searchQuery",2),Zb([we({type:Boolean})],ey.prototype,"loading",2),Zb([we({type:String})],ey.prototype,"error",2),Zb([xe()],ey.prototype,"showDetails",2),Zb([xe()],ey.prototype,"selectedItem",2),Zb([xe()],ey.prototype,"loadingDetails",2),Zb([xe()],ey.prototype,"detailsData",2),Zb([xe()],ey.prototype,"showDeleteModal",2),Zb([xe()],ey.prototype,"itemToDelete",2),Zb([xe()],ey.prototype,"isDeleting",2),Zb([xe()],ey.prototype,"showCreateDrawer",2),Zb([xe()],ey.prototype,"createResourceValue",2),Zb([xe()],ey.prototype,"isCreating",2),Zb([xe()],ey.prototype,"isEditMode",2),Zb([xe()],ey.prototype,"editingResource",2),Zb([xe()],ey.prototype,"resourceFormat",2),Zb([xe()],ey.prototype,"showInstancesDrawer",2),Zb([xe()],ey.prototype,"selectedCRDForInstances",2),ey=Zb([ve("kubernetes-crds")],ey);var ty=Object.defineProperty,sy=Object.getOwnPropertyDescriptor,iy=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?sy(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&ty(t,s,r),r};let oy=class extends me{constructor(){super(...arguments),this.subRoute=null,this.activeView="workloads"}connectedCallback(){super.connectedCallback(),this.updateActiveView()}updated(e){super.updated(e),e.has("subRoute")&&this.updateActiveView()}updateActiveView(){if(this.subRoute){["workloads","networks","storage","configurations","helm","nodes","crds"].includes(this.subRoute)&&(this.activeView=this.subRoute)}else{const e=window.location.pathname;if(e.includes("/kubernetes/")){const t=e.split("/kubernetes/")[1]?.split("/")[0];t&&["workloads","networks","storage","configurations","helm","nodes","crds"].includes(t)&&(this.activeView=t)}}}render(){return J`
      <div class="kubernetes-container">
        <div class="view-container">
          ${this.renderActiveView()}
        </div>
      </div>
    `}renderActiveView(){switch(this.activeView){case"workloads":return J`<kubernetes-workloads></kubernetes-workloads>`;case"networks":return J`<kubernetes-networks></kubernetes-networks>`;case"storage":return J`<kubernetes-storage></kubernetes-storage>`;case"configurations":return J`<kubernetes-configurations></kubernetes-configurations>`;case"helm":return J`<kubernetes-helm></kubernetes-helm>`;case"nodes":return J`<kubernetes-nodes></kubernetes-nodes>`;case"crds":return J`<kubernetes-crds></kubernetes-crds>`;default:return J`
          <div class="error-message">
            <h2>Invalid Kubernetes View</h2>
            <p>The requested view "${this.activeView}" is not available.</p>
          </div>
        `}}};oy.styles=g`
    :host {
      display: block;
      height: 100%;
      width: 100%;
    }

    .kubernetes-container {
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .view-container {
      flex: 1;
      overflow: hidden;
    }

    .error-message {
      text-align: center;
      padding: 40px;
      color: var(--text-secondary);
    }
  `,iy([we({type:String})],oy.prototype,"subRoute",2),iy([we({type:String})],oy.prototype,"activeView",2),oy=iy([ve("kubernetes-tab")],oy);var ry=Object.defineProperty,ay=Object.getOwnPropertyDescriptor,ny=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?ay(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&ry(t,s,r),r};let ly=class extends me{constructor(){super(...arguments),this.options=[],this.selectedValue="",this.label="Filter",this.showIcon=!0,this.showCounts=!1,this.showStatusIndicators=!1,this.isOpen=!1,this.handleClickOutside=e=>{this.contains(e.target)||this.closeDropdown()}}render(){const e=this.options.find(e=>e.value===this.selectedValue),t=e?.label||this.label;return J`
      <div class="dropdown" part="dropdown">
        <button
          class="dropdown-toggle ${this.isOpen?"open":""}"
          part="toggle"
          @click=${this.toggleDropdown}
          aria-expanded=${this.isOpen}
          aria-haspopup="listbox"
        >
          <span class="dropdown-label">
            ${this.showIcon?J`
              <svg class="filter-icon" viewBox="0 0 16 16" fill="currentColor">
                <path d="M6 10.5a.5.5 0 01.5-.5h3a.5.5 0 010 1h-3a.5.5 0 01-.5-.5zm-2-3a.5.5 0 01.5-.5h7a.5.5 0 010 1h-7a.5.5 0 01-.5-.5zm-2-3a.5.5 0 01.5-.5h11a.5.5 0 010 1h-11a.5.5 0 01-.5-.5z"/>
              </svg>
            `:""}
            ${t}
          </span>
          <svg class="dropdown-icon" viewBox="0 0 16 16" fill="currentColor">
            <path d="M4 6l4 4 4-4z"/>
          </svg>
        </button>

        ${this.isOpen?J`
          <div class="dropdown-menu" part="menu" @click=${e=>e.stopPropagation()}>
            ${this.options.map(e=>J`
              <div
                class="filter-option ${this.selectedValue===e.value?"selected":""}"
                part="option ${this.selectedValue===e.value?"option-selected":""}"
                @click=${()=>this.selectOption(e.value)}
                role="option"
                aria-selected=${this.selectedValue===e.value}
              >
                ${this.showStatusIndicators?J`
                  <span class="status-indicator ${e.value}"></span>
                `:e.icon?J`
                  <span class="option-icon">${e.icon}</span>
                `:""}
                <span>${e.label}</span>
                ${this.showCounts&&void 0!==e.count?J`
                  <span class="option-count">${e.count}</span>
                `:""}
              </div>
            `)}
          </div>
        `:""}
      </div>
    `}toggleDropdown(e){e.stopPropagation(),this.isOpen=!this.isOpen,this.isOpen?setTimeout(()=>{document.addEventListener("click",this.handleClickOutside)},0):document.removeEventListener("click",this.handleClickOutside)}closeDropdown(){this.isOpen=!1,document.removeEventListener("click",this.handleClickOutside)}selectOption(e){this.selectedValue!==e&&(this.selectedValue=e,this.dispatchEvent(new CustomEvent("filter-change",{detail:{value:e},bubbles:!0,composed:!0}))),this.closeDropdown()}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("click",this.handleClickOutside)}};ly.styles=g`
    :host {
      display: inline-block;
      position: relative;
    }

    .dropdown {
      position: relative;
    }

    .dropdown-toggle {
      background: var(--vscode-button-secondaryBackground, var(--vscode-bg-lighter, #eff1f3));
      color: var(--vscode-button-secondaryForeground, var(--vscode-foreground, #3b3b3b));
      border: 1px solid var(--vscode-button-border, var(--vscode-border, #cecece));
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 120px;
      font-size: 13px;
      transition: all 0.2s;
    }

    .dropdown-toggle:hover {
      background: var(--vscode-button-secondaryHoverBackground, var(--vscode-bg, #e5e5e5));
    }

    .dropdown-toggle.open {
      background: var(--vscode-button-secondaryBackground, var(--vscode-bg-lighter, #eff1f3));
      color: var(--vscode-button-secondaryForeground, var(--vscode-foreground, #3b3b3b));
      border-color: var(--vscode-focusBorder, #007acc);
    }

    .dropdown-label {
      flex: 1;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .filter-icon {
      width: 14px;
      height: 14px;
      opacity: 0.8;
    }

    .dropdown-icon {
      transition: transform 0.2s;
      width: 12px;
      height: 12px;
    }

    .dropdown-toggle.open .dropdown-icon {
      transform: rotate(180deg);
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 4px;
      background: var(--vscode-dropdown-background, var(--vscode-editor-background, #ffffff));
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
      z-index: 1000;
      min-width: 150px;
      max-height: 300px;
      overflow-y: auto;
    }

    .filter-option {
      padding: 8px 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background-color 0.2s;
      font-size: 13px;
      color: var(--vscode-foreground);
      white-space: nowrap;
    }

    .filter-option:hover {
      background: var(--vscode-list-hoverBackground, rgba(0, 0, 0, 0.04));
    }

    .filter-option.selected {
      background: var(--vscode-list-activeSelectionBackground, #007acc);
      color: var(--vscode-list-activeSelectionForeground, #ffffff);
    }

    .option-icon {
      width: 14px;
      height: 14px;
      flex-shrink: 0;
    }

    .option-count {
      margin-left: auto;
      font-size: 11px;
      opacity: 0.7;
      background: var(--vscode-badge-background, #4d4d4d);
      color: var(--vscode-badge-foreground, #ffffff);
      padding: 2px 6px;
      border-radius: 10px;
    }

    /* Status-specific styling */
    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .status-indicator.all {
      background: #888;
    }

    .status-indicator.running {
      background: #1e88e5;
    }

    .status-indicator.successful {
      background: #43a047;
    }

    .status-indicator.failed {
      background: #e53935;
    }

    .status-indicator.canceled {
      background: #757575;
    }

    .status-indicator.pending {
      background: #ffa726;
    }

    /* Scrollbar styling */
    .dropdown-menu::-webkit-scrollbar {
      width: 6px;
    }

    .dropdown-menu::-webkit-scrollbar-track {
      background: transparent;
    }

    .dropdown-menu::-webkit-scrollbar-thumb {
      background: var(--vscode-scrollbarSlider-background, #424242);
      border-radius: 3px;
    }

    .dropdown-menu::-webkit-scrollbar-thumb:hover {
      background: var(--vscode-scrollbarSlider-hoverBackground, #4e4e4e);
    }
  `,ny([we({type:Array})],ly.prototype,"options",2),ny([we({type:String})],ly.prototype,"selectedValue",2),ny([we({type:String})],ly.prototype,"label",2),ny([we({type:Boolean})],ly.prototype,"showIcon",2),ny([we({type:Boolean})],ly.prototype,"showCounts",2),ny([we({type:Boolean})],ly.prototype,"showStatusIndicators",2),ny([xe()],ly.prototype,"isOpen",2),ly=ny([ve("filter-dropdown")],ly);var cy=/* @__PURE__ */(e=>(e.CREATED="created",e.UPDATED="updated",e.DELETED="deleted",e.BATCH_UPDATED="batch_updated",e.ERROR="error",e.LOADING_START="loading_start",e.LOADING_END="loading_end",e))(cy||{});function dy(e){const{name:t,initialData:s=[],idField:i="id",persistent:o=!1,persistKey:r,debug:a=!1}=e,n=/* @__PURE__ */new Map;s.forEach(e=>{n.set(String(e[i]),e)});const l=((e,t)=>o&&r?rc(`${r}.${e}`,t,{encode:JSON.stringify,decode:JSON.parse}):Be(t))(`${t}.items`,n),c=Be(!1),d=Be(null),h=Be([]),u=Be(null),p=Be(null),g=/* @__PURE__ */new Map,m=e=>{a&&console.log(`[${t}] Event:`,e);const s=g.get(e.type);s&&s.forEach(t=>t(e))},f=ze([l,h],(e,t)=>((e,t)=>0===t.length?e:e.filter(e=>t.every(t=>{const s=e[t.field],i=t.value;switch(t.operator){case"eq":return s===i;case"neq":return s!==i;case"gt":return s>i;case"lt":return s<i;case"gte":return s>=i;case"lte":return s<=i;case"contains":return String(s).toLowerCase().includes(String(i).toLowerCase());case"in":return Array.isArray(i)&&i.includes(s);default:return!0}})))(Array.from(e.values()),t)),v=ze([f,u],(t,s)=>((t,s)=>s?[...t].sort((t,i)=>{const o=t[s.field],r=i[s.field];return e.comparator?e.comparator(t,i)*("desc"===s.direction?-1:1):o<r?"asc"===s.direction?-1:1:o>r?"asc"===s.direction?1:-1:0}):t)(t,s)),b=ze([v,p],(e,t)=>((e,t)=>{if(!t)return e;const s=(t.page-1)*t.pageSize,i=s+t.pageSize;return e.slice(s,i)})(e,t)),y=ze(l,e=>e.size),w=ze(y,e=>0===e),x=ze([l,c,d,h,u,p],(e,t,s,i,o,r)=>({items:e,loading:t,error:s,filters:i,sort:o,pagination:r,lastFetch:Date.now(),stale:!1})),_=e=>l.get().get(e),k=e=>l.get().has(e),S=t=>!e.validate||e.validate(t),C=async e=>{try{c.set(!0);const t=S(e);if(!0!==t)throw t;const s=e[i]||Bd(),o={...e,[i]:s},r=new Map(l.get());return r.set(String(s),o),l.set(r),m({type:cy.CREATED,payload:o,timestamp:Date.now()}),{success:!0,data:o}}catch(t){const e={code:"CREATE_ERROR",message:t instanceof Error?t.message:"Failed to create item",timestamp:Date.now()};return d.set(e),m({type:cy.ERROR,payload:e,timestamp:Date.now()}),{success:!1,error:e}}finally{c.set(!1)}},$=async(e,t)=>{try{c.set(!0);const s=_(e);if(!s)throw new Error(`Item with id ${e} not found`);const i={...s,...t},o=S(i);if(!0!==o)throw o;const r=new Map(l.get());return r.set(e,i),l.set(r),m({type:cy.UPDATED,payload:i,timestamp:Date.now()}),{success:!0,data:i}}catch(s){const e={code:"UPDATE_ERROR",message:s instanceof Error?s.message:"Failed to update item",timestamp:Date.now()};return d.set(e),m({type:cy.ERROR,payload:e,timestamp:Date.now()}),{success:!1,error:e}}finally{c.set(!1)}},D=async e=>{try{if(c.set(!0),!k(e))throw new Error(`Item with id ${e} not found`);const t=new Map(l.get()),s=t.get(e);return t.delete(e),l.set(t),m({type:cy.DELETED,payload:s,timestamp:Date.now()}),{success:!0,data:!0}}catch(t){const e={code:"DELETE_ERROR",message:t instanceof Error?t.message:"Failed to delete item",timestamp:Date.now()};return d.set(e),m({type:cy.ERROR,payload:e,timestamp:Date.now()}),{success:!1,error:e}}finally{c.set(!1)}},E=async e=>{e?.filters&&h.set(e.filters),e?.sort&&u.set(e.sort),e?.pagination&&p.set(e.pagination)},M=()=>{l.set(/* @__PURE__ */new Map),d.set(null),h.set([]),u.set(null),p.set(null)};return{$items:l,$loading:c,$error:d,$filters:h,$sort:u,$pagination:p,$filteredItems:f,$sortedItems:v,$paginatedItems:b,$count:y,$isEmpty:w,$state:x,create:C,read:async e=>{try{const t=_(e);if(!t)throw new Error(`Item with id ${e} not found`);return{success:!0,data:t}}catch(t){return{success:!1,error:{code:"READ_ERROR",message:t instanceof Error?t.message:"Failed to read item",timestamp:Date.now()}}}},update:$,delete:D,createMany:async e=>{const t=[],s=[];for(const i of e){const e=await C(i);e.success&&e.data?t.push(e.data):e.error&&s.push({item:i,error:e.error})}return{succeeded:t,failed:s}},updateMany:async e=>{const t=[],s=[];for(const{id:i,data:o}of e){const e=await $(i,o);if(e.success&&e.data)t.push(e.data);else if(e.error){const t=_(i);t&&s.push({item:t,error:e.error})}}return m({type:cy.BATCH_UPDATED,payload:t,timestamp:Date.now()}),{succeeded:t,failed:s}},deleteMany:async e=>{const t=[],s=[];for(const i of e){const e=await D(i);e.success?t.push(i):e.error&&s.push({item:i,error:e.error})}return{succeeded:t,failed:s}},fetch:E,refresh:async()=>{await E()},clear:M,setFilters:e=>{h.set(e)},addFilter:e=>{const t=[...h.get(),e];h.set(t)},removeFilter:e=>{const t=h.get().filter(t=>t.field!==e);h.set(t)},clearFilters:()=>{h.set([])},setSort:e=>{u.set(e)},setPagination:e=>{p.set(e)},optimisticUpdate:(e,t)=>{const s=_(e),i={...s,...t},o=new Map(l.get());return o.set(e,i),l.set(o),{id:e,previousValue:s,newValue:i,rollback:()=>{const t=new Map(l.get());t.set(e,s),l.set(t)}}},rollback:e=>{e.rollback()},getById:_,exists:k,validate:S,on:(e,t)=>(g.has(e)||g.set(e,/* @__PURE__ */new Set),g.get(e).add(t),()=>{const s=g.get(e);s&&s.delete(t)}),emit:m,destroy:()=>{M(),g.clear()}}}function hy(e,t){return 503===e&&!!t&&"error"===t.status&&!!t.error&&"VIRTUALIZATION_DISABLED"===t.error.code}class uy extends Error{constructor(e,t,s){super(e),this.name="VirtualizationDisabledError",this.details=t,this.status=s}}const py={VM_NOT_FOUND:"Virtual machine not found. It may have been deleted.",VM_RUNNING:"This operation requires the VM to be stopped.",VM_NOT_RUNNING:"This operation requires the VM to be running.",VM_BUSY:"The virtual machine is currently busy. Please try again later.",VM_LOCKED:"The virtual machine is locked by another operation.",CREATE_VM_FAILED:"Failed to create virtual machine.",UPDATE_VM_FAILED:"Failed to update virtual machine.",DELETE_VM_FAILED:"Failed to delete virtual machine.",INVALID_VM_CONFIG:"Invalid virtual machine configuration.",INVALID_VM_NAME:"Invalid virtual machine name.",VM_NAME_EXISTS:"A virtual machine with this name already exists.",VM_DISK_IN_USE:"Disk is in use by another VM.",DISK_NOT_FOUND:"Disk not found.",DISK_ATTACH_FAILED:"Failed to attach disk to VM.",DISK_DETACH_FAILED:"Failed to detach disk from VM.",DISK_RESIZE_FAILED:"Failed to resize disk.",SNAPSHOT_NOT_SUPPORTED:"Snapshots are not supported for this VM configuration.",SNAPSHOT_CREATE_FAILED:"Failed to create snapshot.",SNAPSHOT_DELETE_FAILED:"Failed to delete snapshot.",SNAPSHOT_REVERT_FAILED:"Failed to revert to snapshot.",SNAPSHOT_NOT_FOUND:"Snapshot not found.",INVALID_DISK_FORMAT:"Invalid disk format for this operation.",MIXED_DISK_FORMATS:"Mixed disk formats detected. External snapshot may be required.",BACKUP_CREATE_FAILED:"Failed to create backup.",BACKUP_DELETE_FAILED:"Failed to delete backup.",BACKUP_RESTORE_FAILED:"Failed to restore from backup.",BACKUP_NOT_FOUND:"Backup not found.",MIGRATION_FAILED:"Migration failed.",MIGRATION_CANCELLED:"Migration was cancelled.",MIGRATION_IN_PROGRESS:"A migration is already in progress.",INVALID_DESTINATION:"Invalid migration destination.",DESTINATION_UNREACHABLE:"Migration destination is unreachable.",CONSOLE_NOT_AVAILABLE:"Console is not available for this VM.",CONSOLE_CONNECTION_FAILED:"Failed to connect to console.",VNC_NOT_AVAILABLE:"VNC console is not available.",SPICE_NOT_AVAILABLE:"SPICE console is not available.",CLONE_FAILED:"Failed to clone virtual machine.",CLONE_DISK_FAILED:"Failed to clone disk.",HOTPLUG_FAILED:"Hotplug operation failed.",HOTPLUG_NOT_SUPPORTED:"Hotplug is not supported for this resource.",CPU_HOTPLUG_FAILED:"Failed to add CPU.",MEMORY_HOTPLUG_FAILED:"Failed to add memory.",STORAGE_POOL_NOT_FOUND:"Storage pool not found.",VOLUME_NOT_FOUND:"Volume not found.",VOLUME_IN_USE:"Volume is currently in use.",INSUFFICIENT_STORAGE:"Insufficient storage space.",NETWORK_NOT_FOUND:"Network not found.",NETWORK_ATTACH_FAILED:"Failed to attach network interface.",NETWORK_DETACH_FAILED:"Failed to detach network interface.",INVALID_REQUEST:"Invalid request. Please check your input.",UNAUTHORIZED:"You are not authorized to perform this action.",FORBIDDEN:"Access denied.",INTERNAL_ERROR:"An internal error occurred. Please try again.",TIMEOUT:"Operation timed out. Please try again.",NETWORK_ERROR:"Network error. Please check your connection.",AUTH_ERROR:"Authentication error. Please log in again.",API_ERROR:"API error occurred.",VIRTUALIZATION_DISABLED:"Virtualization is disabled on this host.",LIBVIRT_NOT_AVAILABLE:"Libvirt is not available on this host."};function gy(e){if(!e)return"An unexpected error occurred.";const t=e.code||e.error?.code||e.data?.code||("string"==typeof e?e:null);if(t&&py[t])return py[t];const s=e.message||e.error?.message||e.data?.message||e.details||e.error?.details;return s&&"string"==typeof s?s:"An unexpected error occurred."}const my="/virtualization";class fy extends Error{constructor(e,t,s){super(t),this.code=e,this.details=s,this.name="VirtualizationAPIError",this.userMessage=gy({code:e,message:t})}}function vy(){const e=localStorage.getItem("jwt_token")||localStorage.getItem("auth_token");if(!e)throw new fy("AUTH_ERROR","No authentication token found");return e}async function by(t,s={}){const i=vy(),o={...s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`,...s.headers}};try{const s=e(`${my}${t}`),i=await fetch(s,o),r=i.status;if(!i.ok){const e=await i.json().catch(()=>({status:"error",error:{code:"API_ERROR",message:i.statusText}}));if(hy(r,e))throw Ay.set(!1),Iy.set(e.error?.details||e.error?.message||"Virtualization is disabled on this host."),new uy(e.error?.message||"Virtualization is disabled on this host.",e.error?.details,r);const t=e;if("error"===t.status&&t.error)throw new fy(t.error.code||"API_ERROR",t.error.message||`Request failed: ${r}`,t.error.details);throw new fy(t.code||"API_ERROR",t.message||`Request failed: ${r}`,t.details)}return 204===i.status?(!0!==Ay.get()&&(Ay.set(!0),Iy.set(null)),{}):(!0!==Ay.get()&&(Ay.set(!0),Iy.set(null)),await i.json())}catch(r){if(r instanceof fy||r instanceof uy)throw r;throw new fy("NETWORK_ERROR",r instanceof Error?r.message:"Network request failed")}}const yy=new class{async listVMs(e){const t=new URLSearchParams;e?.page&&t.append("page",e.page.toString()),e?.pageSize&&t.append("pageSize",e.pageSize.toString()),e?.filter&&t.append("filter",e.filter),e?.sort&&t.append("sort",e.sort);const s=t.toString();return by("/computes"+(s?`?${s}`:""))}async getVM(e){return by(`/computes/${e}`)}async createVM(e){return by("/computes",{method:"POST",body:JSON.stringify(e)})}async createVMEnhanced(e){return by("/computes",{method:"POST",body:JSON.stringify(e)})}async updateVM(e,t){return by(`/computes/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteVM(e,t=!1){return by(`/computes/${e}${t?"?force=true":""}`,{method:"DELETE"})}async cloneVM(e,t){return by(`/computes/${e}/clone`,{method:"POST",body:JSON.stringify({name:t})})}async startVM(e){return by(`/computes/${e}/start`,{method:"POST"})}async stopVM(e,t=!1){return by(`/computes/${e}/stop`,{method:"POST",body:JSON.stringify({force:t})})}async restartVM(e,t=!1){return by(`/computes/${e}/restart`,{method:"POST",body:JSON.stringify({force:t})})}async pauseVM(e){return by(`/computes/${e}/pause`,{method:"POST"})}async resumeVM(e){return by(`/computes/${e}/resume`,{method:"POST"})}async resetVM(e){return by(`/computes/${e}/reset`,{method:"POST"})}async executeVMAction(e,t){return by(`/computes/${e}/action`,{method:"POST",body:JSON.stringify(t)})}async getConsoleInfo(e){return by(`/computes/${e}/console`)}async createConsoleSession(e){return by(`/computes/${e}/console/session`,{method:"POST"})}async listTemplates(){return by("/computes/templates")}async getTemplate(e){return by(`/computes/templates/${e}`)}async createFromTemplate(e,t){return by("/computes/from-template",{method:"POST",body:JSON.stringify({templateId:e,...t})})}async createTemplate(e,t,s){return by(`/computes/${e}/template`,{method:"POST",body:JSON.stringify({name:t,description:s})})}async listSnapshots(e){return by(`/computes/${e}/snapshots`)}async createSnapshot(e,t,s){return by(`/computes/${e}/snapshots`,{method:"POST",body:JSON.stringify({name:t,description:s})})}async revertToSnapshot(e,t){return by(`/computes/${e}/snapshots/${t}/revert`,{method:"POST"})}async deleteSnapshot(e,t){return by(`/computes/${e}/snapshots/${t}`,{method:"DELETE"})}async listBackups(e){const t=await by(`/computes/${e}/backups`);return this.normalizeBackups(t)}async listAllBackups(e){const t=new URLSearchParams;e?.search&&t.set("q",e.search),e?.status&&t.set("status",e.status),e?.type&&t.set("type",e.type);const s=t.toString()?`?${t.toString()}`:"",i=await by(`/computes/backups${s}`);return this.normalizeBackups(i)}async createBackup(e,t){const s=await by(`/computes/${e}/backups`,{method:"POST",body:JSON.stringify(t)}),i=this.normalizeBackups(s),[o]=i;if(!o)throw new fy("INVALID_RESPONSE","Backup response missing backup data");return o}async importBackup(e){const t=await by("/computes/backups/import",{method:"POST",body:JSON.stringify(e)}),s=this.normalizeBackups(t),[i]=s;return i||t}async restoreBackup(e){return by("/computes/restore",{method:"POST",body:JSON.stringify(e)})}async deleteBackup(e){const t=await by(`/computes/backups/${e}`,{method:"DELETE"});if(t&&"object"==typeof t&&"error"===t?.status)throw new fy(t.error?.code||"BACKUP_DELETE_FAILED",t.error?.message||"Failed to delete backup",t.error?.details)}getBackupDownloadUrl(t){const s=vy(),i=e(`${my}/computes/backups/${t}/download`),o=i.includes("?")?"&":"?";return`${i}${o}token=${encodeURIComponent(s)}`}async downloadBackup(t){const s=vy(),i=e(`${my}/computes/backups/${t}/download`),o=await fetch(i,{method:"GET",headers:{Authorization:`Bearer ${s}`}});if(!o.ok){const e=await o.json().catch(()=>null),t=e?.error?.code||`HTTP_${o.status}`,s=e?.error?.message||o.statusText||"Failed to download backup";throw new fy(t,s,e?.error?.details)}return o.blob()}async initiateBackupUpload(t){const s={};t.filename&&(s.filename=btoa(t.filename)),t.vm_name&&(s.vm_name=btoa(t.vm_name)),t.vm_uuid&&(s.vm_uuid=btoa(t.vm_uuid)),t.backup_type&&(s.backup_type=btoa(t.backup_type)),t.compression&&(s.compression=btoa(t.compression)),t.encryption&&(s.encryption=btoa(t.encryption)),t.description&&(s.description=btoa(t.description)),void 0!==t.retention_days&&(s.retention_days=btoa(t.retention_days.toString())),t.destination_path&&(s.destination_path=btoa(t.destination_path));const i=Object.entries(s).map(([e,t])=>`${e} ${t}`).join(","),o=vy(),r=e("/virtualization/computes/backups/upload"),a=await fetch(r,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Upload-Length":t.size.toString(),"Upload-Metadata":i,"Tus-Resumable":"1.0.0"}});if(!a.ok){const e=await a.json().catch(()=>({code:"API_ERROR",message:a.statusText}));throw new fy(e.code||"API_ERROR",e.message||`Request failed: ${a.status}`,e.details)}const n=a.headers.get("Location"),l=await a.json();console.log("[TUS Backup] Session created:",{location:n,responseData:l,originalUrl:r});let c=n||l.upload_url;if(c&&!c.startsWith("http")){const e=c.startsWith("/api/")?c:`/api/v1/virtualization/computes/backups/upload/${l.upload_id}`;c=r.substring(0,r.indexOf("/api/"))+e}return console.log("[TUS Backup] Final upload URL:",c),{uploadUrl:c,uploadId:l.upload_id}}async completeBackupUpload(e){const t=await by(`/computes/backups/upload/${e}/complete`,{method:"POST"});return t?.data?.backup?t.data.backup:t?.backup?t.backup:t}async getBackupUploadProgress(e){return by(`/computes/backups/upload/${e}`)}normalizeBackups(e){return e?Array.isArray(e)?e:e.data?.backups?e.data.backups:e.backups?e.backups:e.data?.backup?[e.data.backup]:e.backup?[e.backup]:e.data?.backups?.items?e.data.backups.items:[]:[]}async listStoragePools(){return by("/storages/pools")}async getStoragePool(e){return by(`/storages/pools/${e}`)}async createStoragePool(e){return by("/storages/pools",{method:"POST",body:JSON.stringify(e)})}async deleteStoragePool(e,t=!1){return by(`/storages/pools/${e}${t?"?delete_volumes=true":""}`,{method:"DELETE"})}async updateStoragePool(e,t){return by(`/storages/pools/${e}`,{method:"PUT",body:JSON.stringify(t)})}async startStoragePool(e){return by(`/storages/pools/${e}/start`,{method:"POST"})}async stopStoragePool(e){return by(`/storages/pools/${e}/stop`,{method:"POST"})}async setStoragePoolAutostart(e,t){return by(`/storages/pools/${e}/autostart`,{method:"PUT",body:JSON.stringify({autostart:t})})}async refreshStoragePool(e){return by(`/storages/pools/${e}/refresh`,{method:"POST"})}async listVolumes(e){const t=await by(`/storages/pools/${e}/volumes`);return"success"===t.status&&t.data?{volumes:t.data.volumes||[],count:t.data.count||0}:{volumes:[],count:0}}async getVolume(e,t){const s=await by(`/storages/pools/${e}/volumes/${t}`);if("success"===s.status&&s.data?.volume)return s.data.volume;throw new fy("INVALID_RESPONSE","Invalid response format from getVolume")}async createVolume(e,t){const s=await by(`/storages/pools/${e}/volumes`,{method:"POST",body:JSON.stringify(t)});if("success"===s.status&&s.data)return s.data;throw new fy("INVALID_RESPONSE","Invalid response format from createVolume")}async resizeVolume(e,t,s){const i=await by(`/storages/pools/${e}/volumes/${t}/resize`,{method:"POST",body:JSON.stringify({capacity:s})});if("success"===i.status&&i.data)return i.data;throw new fy("INVALID_RESPONSE","Invalid response format from resizeVolume")}async cloneVolume(e,t,s){const i=await by(`/storages/pools/${e}/volumes/${t}/clone`,{method:"POST",body:JSON.stringify(s)});if("success"===i.status&&i.data)return i.data;throw new fy("INVALID_RESPONSE","Invalid response format from cloneVolume")}async deleteVolume(e,t,s=!1){const i=s?"?force=true":"",o=await by(`/storages/pools/${e}/volumes/${t}${i}`,{method:"DELETE"});if(o&&"object"==typeof o&&"status"in o&&"error"===o.status){const e=o.error||{};throw new fy(e.code||"API_ERROR",e.message||"Failed to delete volume",e.details)}}async listISOs(){return by("/isos")}async getISO(e){return by(`/isos/${e}`)}async initiateISOUpload(t){const s={};t.filename&&(s.filename=btoa(t.filename)),t.os_type&&(s.os_type=btoa(t.os_type)),t.os_variant&&(s.os_variant=btoa(t.os_variant)),t.description&&(s.description=btoa(t.description)),t.architecture&&(s.architecture=btoa(t.architecture)),t.pool_name&&(s.pool_name=btoa(t.pool_name));const i=Object.entries(s).map(([e,t])=>`${e} ${t}`).join(","),o=vy(),r=e("/virtualization/isos/upload"),a=await fetch(r,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Upload-Length":t.size.toString(),"Upload-Metadata":i,"Tus-Resumable":"1.0.0"}});if(!a.ok){const e=await a.json().catch(()=>({code:"API_ERROR",message:a.statusText}));throw new fy(e.code||"API_ERROR",e.message||`Request failed: ${a.status}`,e.details)}const n=a.headers.get("Location"),l=await a.json();console.log("[TUS] Session created:",{location:n,responseData:l,originalUrl:r});let c=n||l.upload_url;if(c&&!c.startsWith("http")){const e=c.startsWith("/api/")?c:`/api/v1/virtualization/isos/upload/${l.upload_id}`;c=r.substring(0,r.indexOf("/api/"))+e}return console.log("[TUS] Final upload URL:",c),{uploadUrl:c,uploadId:l.upload_id}}async completeISOUpload(e){return by(`/isos/upload/${e}/complete`,{method:"POST"})}async getISOUploadProgress(e){return by(`/isos/upload/${e}/progress`)}async deleteISO(e){return by(`/isos/${e}`,{method:"DELETE"})}async listOSVariants(e){const t=new URLSearchParams;e?.q&&t.append("q",e.q),e?.family&&t.append("family",e.family),"number"==typeof e?.limit&&t.append("limit",e.limit.toString());const s=t.toString(),i=await by("/os-variants"+(s?`?${s}`:""));if("success"===i.status&&i.data){const e=i.data.variants||[];return{variants:e,count:i.data.count??e.length}}const o=i;return o?.data?.variants&&Array.isArray(o.data.variants)?{variants:o.data.variants,count:o.data.count??o.data.variants.length}:o?.variants&&Array.isArray(o.variants)?{variants:o.variants,count:o.count??o.variants.length}:{variants:[],count:0}}async listNetworks(){const e=await by("/networks");if("success"===e.status&&e.data)return{networks:e.data.networks||[],count:e.data.count??(e.data.networks?.length||0)};const t=e;return Array.isArray(t)?{networks:t,count:t.length}:t.networks&&Array.isArray(t.networks)?{networks:t.networks,count:t.count||t.networks.length}:{networks:[],count:0}}async getNetwork(e){const t=await by(`/networks/${e}`);if(t&&"object"==typeof t){if("success"===t.status){if(t.data?.network)return t.data.network;if(t.data&&!Array.isArray(t.data))return t.data}if(!("status"in t))return t}throw new fy("INVALID_RESPONSE","Invalid response format from getNetwork")}async createNetwork(e){const t=await by("/networks",{method:"POST",body:JSON.stringify(e)});if("success"===t.status&&t.data?.network)return t.data.network;throw new fy("INVALID_RESPONSE","Invalid response format from createNetwork")}async updateNetwork(e,t){const s=await by(`/networks/${e}`,{method:"PUT",body:JSON.stringify(t)});if("success"===s.status&&s.data?.network)return s.data.network;throw new fy("INVALID_RESPONSE","Invalid response format from updateNetwork")}async getNetworkDHCPLeases(e){const t=await by(`/networks/${e}/dhcp-leases`);if("success"===t.status&&t.data)return{network_name:t.data.network_name||e,leases:t.data.leases||[],count:t.data.count??(t.data.leases?.length||0)};throw new fy("INVALID_RESPONSE","Invalid response format from getNetworkDHCPLeases")}async getNetworkPorts(e){const t=await by(`/networks/${e}/ports`);if("success"===t.status&&t.data)return{network_name:t.data.network_name||e,ports:t.data.ports||[],count:t.data.count??(t.data.ports?.length||0)};throw new fy("INVALID_RESPONSE","Invalid response format from getNetworkPorts")}async deleteNetwork(e){await by(`/networks/${e}`,{method:"DELETE"})}async startNetwork(e){return by(`/networks/${e}/start`,{method:"POST"})}async stopNetwork(e){return by(`/networks/${e}/stop`,{method:"POST"})}async getVMMetrics(e,t="1h"){return by(`/computes/${e}/metrics?duration=${t}`)}async getHostResources(){return by("/host/resources")}getMetricsWebSocketUrl(e){const t=vy();return`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}${my}/computes/${e}/metrics/ws?token=${t}`}async attachDisk(e,t){return by(`/computes/${e}/disks/attach`,{method:"POST",body:JSON.stringify(t)})}async detachDisk(e,t){return by(`/computes/${e}/disks/${t}/detach`,{method:"POST"})}async resizeDisk(e,t,s){return by(`/computes/${e}/disks/${t}/resize`,{method:"POST",body:JSON.stringify({size:s})})}async migrateVM(e,t,s=!0){return by(`/computes/${e}/migrate`,{method:"POST",body:JSON.stringify({targetHost:t,live:s})})}async getMigrationStatus(e){return by(`/computes/${e}/migrate/status`)}async getSnapshots(e){return by(`/computes/${e}/snapshots`)}async createSnapshotTyped(e,t){return by(`/computes/${e}/snapshots`,{method:"POST",body:JSON.stringify(t)})}async revertSnapshot(e,t){return by(`/computes/${e}/snapshots/${t}/revert`,{method:"POST"})}async deleteSnapshotTyped(e,t){return by(`/computes/${e}/snapshots/${t}`,{method:"DELETE"})}async getSnapshotCapabilities(e){return by(`/computes/${e}/snapshots/capabilities`)}async getBackups(e){return this.listBackups(e)}async createBackupTyped(e,t){return this.createBackup(e,t)}async cloneVMTyped(e,t){return by(`/computes/${e}/clone`,{method:"POST",body:JSON.stringify(t)})}async hotplug(e,t){return by(`/computes/${e}/hotplug`,{method:"POST",body:JSON.stringify(t)})}async hotunplug(e,t){return by(`/computes/${e}/hotunplug`,{method:"POST",body:JSON.stringify(t)})}async migrateVMTyped(e,t){return by(`/computes/${e}/migrate`,{method:"POST",body:JSON.stringify(t)})}async getMigrationStatusTyped(e){return by(`/computes/${e}/migrate/status`)}async cancelMigration(e){return by(`/computes/${e}/migrate/cancel`,{method:"POST"})}async getConsoles(e){return by(`/computes/${e}/consoles`)}async connectConsole(e,t){return by(`/computes/${e}/consoles/${t}/connect`,{method:"POST"})}async getVMMetricsEnhanced(e,t="1h"){return by(`/computes/${e}/metrics?duration=${t}&enhanced=true`)}},wy=yy,xy=e=>{const t=e.backup_id??e.id;return{...e,backup_id:t,id:t??e.id,vm_uuid:e.vm_uuid||e.vm_id||e.vm_uuid,vm_id:e.vm_id||e.vm_uuid}},_y=e=>(e.backup_id??e.id)||null,ky=Be([]),Sy=Be(!1),Cy=Be(null),$y=Be({isUploading:!1,uploadProgress:0,uploadId:null,error:null});ze(ky,e=>{const t=/* @__PURE__ */new Map;return e.forEach(e=>{const s=e.vm_uuid||e.vm_id||"unknown";t.has(s)||t.set(s,[]),t.get(s)?.push(e)}),t});function Dy(e){e instanceof fy?Cy.set(e.userMessage||e.message):Cy.set(gy(e))}function Ey(e){const t=/* @__PURE__ */new Map;ky.get().forEach(e=>{const s=_y(e);s&&t.set(s,e)}),e.forEach(e=>{const s=xy(e),i=_y(s);i&&t.set(i,s)}),ky.set(Array.from(t.values()))}const My={fetchGlobal:async function(e){Sy.set(!0),Cy.set(null);try{Ey(await wy.listAllBackups(e)||[])}catch(t){throw console.error("Failed to fetch global backups",t),Dy(t),t}finally{Sy.set(!1)}},fetchForVm:async function(e){if(e){Sy.set(!0),Cy.set(null);try{!function(e,t){const s=t.map(xy),i=ky.get().filter(t=>(t.vm_uuid||t.vm_id)!==e);ky.set([...i,...s])}(e,await wy.listBackups(e)||[])}catch(t){throw console.error("Failed to fetch VM backups",t),Dy(t),t}finally{Sy.set(!1)}}},create:async function(e,t){Cy.set(null);const s=await wy.createBackup(e,t);return Ey([s]),s},import:async function(e){Cy.set(null);const t=await wy.importBackup(e);return Ey([t]),t},restore:async function(e){return Cy.set(null),wy.restoreBackup(e)},delete:async function(e){Cy.set(null),await wy.deleteBackup(e);const t=ky.get().filter(t=>_y(t)!==e);ky.set(t)},setUploadState:e=>{$y.set({...$y.get(),...e})},resetUploadState:()=>{$y.set({isUploading:!1,uploadProgress:0,uploadId:null,error:null})}},Ay=Be(null),Iy=Be(null),Ty="/virtualization";async function Py(t,s={}){const i=localStorage.getItem("jwt_token")||localStorage.getItem("auth_token"),o=e(`${Ty}${t}`),r=await fetch(o,{...s,headers:{"Content-Type":"application/json",Authorization:i?`Bearer ${i}`:"",...s.headers}}),a=r.status;if(!r.ok){const e=await r.json().catch(()=>({message:r.statusText})),t=e=>e&&"object"==typeof e&&"error"in e;if(hy(a,t(e)?e:null)){Ay.set(!1);const s=t(e)?e:null;throw Iy.set(s?.error?.details||s?.error?.message||"Virtualization is disabled on this host."),new uy(s?.error?.message||"Virtualization is disabled on this host.",s?.error?.details,a)}if(t(e)&&"error"===e.status&&e.error){const t=e.error,s=new Error(t.message||t.details||`Request failed: ${a}`);throw s.code=t.code,s.details=t.details,s.status=a,s}const s=e.message;throw new Error(s||`Request failed: ${a}`)}if(!0!==Ay.get()&&(Ay.set(!0),Iy.set(null)),204===r.status)return{};const n=await r.json();return"success"===n.status&&void 0!==n.data?t.includes("/isos")&&n.data.isos?n.data.isos:(t.includes("/virtualmachines")||t.includes("/computes"))&&n.data.vms?n.data.vms:t.includes("/pools")&&n.data.pools?n.data.pools:t.includes("/networks")&&n.data.networks?n.data.networks:t.includes("/templates")&&n.data.templates?n.data.templates:n.data.vm||n.data.iso||n.data.pool||n.data.network||n.data.template?n.data.vm||n.data.iso||n.data.pool||n.data.network||n.data.template:n.data:n}const Ly=dy({name:"virtualization-vms",idField:"id",endpoint:e(`${Ty}/computes`),persistent:!0,persistKey:"vapor.virtualization.vms",debug:!1,transform:e=>({...e,state:e.state?.toLowerCase()||"unknown",memory:Number(e.memory),vcpus:Number(e.vcpus),disk_size:Number(e.disk_size)}),validate:e=>e.name?!e.memory||e.memory<512?{code:"INVALID_MEMORY",message:"Memory must be at least 512MB",timestamp:Date.now()}:!(!e.vcpus||e.vcpus<1)||{code:"INVALID_VCPUS",message:"At least 1 vCPU required",timestamp:Date.now()}:{code:"INVALID_VM",message:"VM name is required",timestamp:Date.now()},comparator:(e,t)=>e.name.localeCompare(t.name)});function Ry(e){return{id:e.uuid||e.id,name:e.name,state:(t=e.state,{shutoff:"stopped",running:"running",paused:"paused",suspended:"suspended",pmsuspended:"suspended",crashed:"stopped",dying:"stopped"}[t.toLowerCase()]||"unknown"),memory:Math.floor((e.memory||0)/1024),vcpus:e.vcpus||e.max_vcpus||0,disk_size:0,os_type:e.os?.type||"hvm",os_variant:e.os?.machine||void 0,created_at:e.created_at,updated_at:e.updated_at,graphics:e.graphics,disks:e.disks,network_interfaces:e.networks,metadata:{architecture:e.os?.architecture||"x86_64",autostart:String(e.autostart||!1),persistent:String(e.persistent||!0),max_memory:String(e.max_memory||e.memory),max_vcpus:String(e.max_vcpus||e.vcpus)}};var t}const Oy={...Ly,async fetch(){try{Ly.$loading.set(!0),Ly.$error.set(null);const e=await Py("/computes");let t=[];e&&"object"==typeof e&&(e.data&&e.data.vms&&Array.isArray(e.data.vms)?t=e.data.vms.map(Ry):e.vms&&Array.isArray(e.vms)?t=e.vms.map(Ry):Array.isArray(e)?t=e.map(Ry):console.warn("Unexpected VM list response format:",e));const s=/* @__PURE__ */new Map;t.forEach(e=>{s.set(e.id,e)}),Ly.$items.set(s),Ly.emit({type:cy.BATCH_UPDATED,payload:t,timestamp:Date.now()}),console.log(`Fetched ${t.length} VMs from /computes endpoint`)}catch(e){const t={code:"FETCH_ERROR",message:gy(e),timestamp:Date.now()};throw Ly.$error.set(t),Ly.emit({type:cy.ERROR,payload:t,timestamp:Date.now()}),e}finally{Ly.$loading.set(!1)}},getById:Ly.getById.bind(Ly),update:Ly.update.bind(Ly),delete:Ly.delete.bind(Ly),clear:Ly.clear.bind(Ly),emit:Ly.emit.bind(Ly),$items:Ly.$items,$loading:Ly.$loading,$error:Ly.$error},Ny=dy({name:"virtualization-storage-pools",idField:"name",endpoint:e(`${Ty}/storages/pools`),persistent:!1,debug:!1,transform:e=>({...e,id:e.name})}),By={...Ny,async fetch(){try{Ny.$loading.set(!0),Ny.$error.set(null);const e=await Py("/storages/pools"),t=/* @__PURE__ */new Map;e.forEach(e=>{const s=(i=e,{...i,id:i.name});var i;t.set(e.name,s)}),Ny.$items.set(t),Ny.emit({type:cy.BATCH_UPDATED,payload:Array.from(t.values()),timestamp:Date.now()})}catch(e){const t={code:"FETCH_ERROR",message:gy(e),timestamp:Date.now()};throw Ny.$error.set(t),Ny.emit({type:cy.ERROR,payload:t,timestamp:Date.now()}),e}finally{Ny.$loading.set(!1)}}},Fy=dy({name:"virtualization-isos",idField:"id",endpoint:e(`${Ty}/isos`),persistent:!0,persistKey:"vapor.virtualization.isos",debug:!1});function zy(e){return{id:e.image_id||e.id,name:e.filename||e.name,path:e.path,size:e.size_bytes||e.size||0,os_type:e.os_type,os_variant:e.os_variant||e.os_version,architecture:e.architecture||e.arch||e.metadata?.architecture,uploaded_at:e.created_at||e.uploaded_at,checksum:e.checksum,storage_pool:e.storage_pool||e.pool_name||e.metadata?.pool_name||"default"}}const Uy={...Fy,async fetch(){try{Fy.$loading.set(!0),Fy.$error.set(null);const e=await Py("/isos");let t=[];Array.isArray(e)?t=e.map(zy):e&&"object"==typeof e&&(e.data&&e.data.isos&&Array.isArray(e.data.isos)?t=e.data.isos.map(zy):e.data&&Array.isArray(e.data)?t=e.data.map(zy):e.isos&&Array.isArray(e.isos)?t=e.isos.map(zy):console.warn("Unexpected ISO list response format:",e));const s=/* @__PURE__ */new Map;t.forEach(e=>{s.set(e.id,e)}),Fy.$items.set(s),Fy.emit({type:cy.BATCH_UPDATED,payload:t,timestamp:Date.now()})}catch(e){const t={code:"FETCH_ERROR",message:gy(e),timestamp:Date.now()};throw Fy.$error.set(t),Fy.emit({type:cy.ERROR,payload:t,timestamp:Date.now()}),e}finally{Fy.$loading.set(!1)}}},Vy=dy({name:"virtualization-templates",idField:"id",endpoint:e(`${Ty}/computes/templates`),persistent:!0,persistKey:"vapor.virtualization.templates",debug:!1});function jy(e){return{id:String(e.id??e.uuid??""),name:e.name||"",description:e.description||void 0,os_type:e.os_type||"other",os_variant:e.os_variant||void 0,min_memory:Number(e.min_memory??0),recommended_memory:void 0!==e.recommended_memory&&null!==e.recommended_memory?Number(e.recommended_memory):void 0,min_vcpus:Number(e.min_vcpus??0),recommended_vcpus:void 0!==e.recommended_vcpus&&null!==e.recommended_vcpus?Number(e.recommended_vcpus):void 0,min_disk:Number(e.min_disk??0),recommended_disk:void 0!==e.recommended_disk&&null!==e.recommended_disk?Number(e.recommended_disk):void 0,disk_format:e.disk_format||void 0,network_model:e.network_model||void 0,graphics_type:e.graphics_type||void 0,cloud_init:Boolean(e.cloud_init),uefi_boot:Boolean(e.uefi_boot),secure_boot:Boolean(e.secure_boot),tpm:Boolean(e.tpm),default_user:e.default_user||void 0,metadata:e.metadata||void 0,created_at:e.created_at,updated_at:e.updated_at||e.created_at}}const Hy={...Vy,async fetch(){try{Vy.$loading.set(!0),Vy.$error.set(null);const e=await Py("/computes/templates");let t=[];e&&"object"==typeof e&&(e.data&&e.data.templates&&Array.isArray(e.data.templates)?t=e.data.templates.map(jy):e.templates&&Array.isArray(e.templates)?t=e.templates.map(jy):Array.isArray(e)?t=e.map(jy):console.warn("Unexpected template list response format:",e));const s=/* @__PURE__ */new Map;t.forEach(e=>{s.set(e.id,e)}),Vy.$items.set(s),Vy.emit({type:cy.BATCH_UPDATED,payload:t,timestamp:Date.now()}),console.log(`Fetched ${t.length} templates from /computes/templates endpoint`)}catch(e){const t={code:"FETCH_ERROR",message:gy(e),timestamp:Date.now()};throw Vy.$error.set(t),Vy.emit({type:cy.ERROR,payload:t,timestamp:Date.now()}),e}finally{Vy.$loading.set(!1)}},getById:Vy.getById.bind(Vy),update:Vy.update.bind(Vy),delete:Vy.delete.bind(Vy),clear:Vy.clear.bind(Vy),emit:Vy.emit.bind(Vy),$items:Vy.$items,$loading:Vy.$loading,$error:Vy.$error},Wy=dy({name:"virtualization-networks",idField:"name",endpoint:e(`${Ty}/networks`),persistent:!1,debug:!1,transform:e=>({...e,id:e.name})});function qy(e){return{id:e.name,name:e.name,uuid:e.uuid,type:e.type||"nat",state:e.state||"inactive",autostart:e.autostart||!1,bridge:e.bridge,ip:e.ip||e.ip_range?.address,netmask:e.netmask||e.ip_range?.netmask,dhcp:e.dhcp,forward:e.forward}}const Ky={...Wy,async fetch(){try{Wy.$loading.set(!0),Wy.$error.set(null);const e=await Py("/networks");let t=[];e&&"object"==typeof e&&("success"===e.status&&e.data&&Array.isArray(e.data.networks)?t=e.data.networks.map(qy):Array.isArray(e)?t=e.map(qy):e.data&&Array.isArray(e.data)?t=e.data.map(qy):e.networks&&Array.isArray(e.networks)?t=e.networks.map(qy):console.warn("Unexpected network list response format:",e));const s=/* @__PURE__ */new Map;t.forEach(e=>{s.set(e.name,e)}),Wy.$items.set(s),Wy.emit({type:cy.BATCH_UPDATED,payload:t,timestamp:Date.now()}),console.log(`Fetched ${t.length} networks from /networks endpoint`)}catch(e){const t={code:"FETCH_ERROR",message:gy(e),timestamp:Date.now()};throw Wy.$error.set(t),Wy.emit({type:cy.ERROR,payload:t,timestamp:Date.now()}),e}finally{Wy.$loading.set(!1)}},getById:Wy.getById.bind(Wy),update:Wy.update.bind(Wy),delete:Wy.delete.bind(Wy),clear:Wy.clear.bind(Wy),emit:Wy.emit.bind(Wy),$items:Wy.$items,$loading:Wy.$loading,$error:Wy.$error},Gy=dy({name:"virtualization-volumes",idField:"id",endpoint:e(`${Ty}/volumes`),persistent:!1,debug:!1,transform:e=>({...e,id:e.id||`${e.pool_name}:${e.name}`})});function Qy(e){return{id:e.id||`${e.pool_name}:${e.name}`,name:e.name,type:e.type,capacity:e.capacity||0,allocation:e.allocation||0,path:e.path,format:e.format,created_at:e.created_at,pool_name:e.pool_name,used_percent:e.capacity>0?Math.round(e.allocation/e.capacity*100):0,status:"available"}}const Jy={...Gy,async fetch(){try{Gy.$loading.set(!0),Gy.$error.set(null);const e=await Py("/volumes");let t=[];e&&"object"==typeof e&&("success"===e.status&&e.data&&Array.isArray(e.data)||e.data&&Array.isArray(e.data)?t=e.data.map(Qy):Array.isArray(e)?t=e.map(Qy):e.volumes&&Array.isArray(e.volumes)?t=e.volumes.map(Qy):console.warn("Unexpected volume list response format:",e));const s=/* @__PURE__ */new Map;t.forEach(e=>{s.set(e.id,e)}),Gy.$items.set(s),Gy.emit({type:cy.BATCH_UPDATED,payload:t,timestamp:Date.now()}),console.log(`Fetched ${t.length} volumes from /volumes endpoint`)}catch(e){const t={code:"FETCH_ERROR",message:gy(e),timestamp:Date.now()};throw Gy.$error.set(t),Gy.emit({type:cy.ERROR,payload:t,timestamp:Date.now()}),e}finally{Gy.$loading.set(!1)}},getById:Gy.getById.bind(Gy),update:Gy.update.bind(Gy),delete:Gy.delete.bind(Gy),clear:Gy.clear.bind(Gy),emit:Gy.emit.bind(Gy),$items:Gy.$items,$loading:Gy.$loading,$error:Gy.$error},Yy=Be(null),Xy=Be({isOpen:!1,currentStep:1,openId:0,formData:{},errors:{}}),Zy=Be({isUploading:!1,uploadProgress:0,uploadId:null,error:null});Ue({});const ew=Be("all"),tw=Be(""),sw=Be({}),iw=Be("all"),ow=Be(""),rw=Be(null),aw=Be({}),nw=Be("all"),lw=Be(""),cw=Be(null),dw=Be({}),hw=Be(""),uw=Be(null),pw=Be({}),gw=Be(""),mw=Be(null),fw=Be({}),vw=Be("all");ze([Yy,Oy.$items],(e,t)=>e&&t?t instanceof Map?t.get(e)||null:"object"==typeof t&&t[e]||null:null),ze([Oy.$items],e=>{const t={running:[],stopped:[],paused:[],suspended:[],unknown:[]};if(!e)return t;let s;if(e instanceof Map)s=Array.from(e.values());else{if("object"!=typeof e)return t;s=Object.values(e)}return s.forEach(e=>{const s=e.state||"unknown";t[s]?t[s].push(e):t.unknown?.push(e)}),t});const bw=ze([Oy.$items,tw,sw,ew],(e,t,s,i)=>{if(!e)return[];let o;if(e instanceof Map)o=Array.from(e.values());else{if("object"!=typeof e)return[];o=Object.values(e)}if("all"!==i&&"templates"!==i&&(o=o.filter(e=>e.state===i)),t){const e=t.toLowerCase();o=o.filter(t=>t.name.toLowerCase().includes(e)||t.os_type?.toLowerCase().includes(e)||t.state.toLowerCase().includes(e))}return s?.state&&s.state.length>0&&(o=o.filter(e=>s.state.includes(e.state))),s?.os_type&&s.os_type.length>0&&(o=o.filter(e=>s.os_type.includes(e.os_type))),o});ze([Oy.$items],e=>{if(!e)return{totalVMs:0,runningVMs:0,stoppedVMs:0,pausedVMs:0,totalMemory:0,totalVCPUs:0,totalDiskSize:0};let t;if(e instanceof Map)t=Array.from(e.values());else{if("object"!=typeof e)return{totalVMs:0,runningVMs:0,stoppedVMs:0,pausedVMs:0,totalMemory:0,totalVCPUs:0,totalDiskSize:0};t=Object.values(e)}return{totalVMs:t.length,runningVMs:t.filter(e=>"running"===e.state).length,stoppedVMs:t.filter(e=>"stopped"===e.state).length,pausedVMs:t.filter(e=>"paused"===e.state).length,totalMemory:t.reduce((e,t)=>e+(t.memory||0),0),totalVCPUs:t.reduce((e,t)=>e+(t.vcpus||0),0),totalDiskSize:t.reduce((e,t)=>e+(t.disk_size||0),0)}});const yw=ze([By.$items],e=>{if(!e)return[];let t;if(e instanceof Map)t=Array.from(e.values());else{if("object"!=typeof e)return[];t=Object.values(e)}return t.filter(e=>("active"===e.state||"running"===e.state)&&e.available>1073741824)}),ww=ze([rw,By.$items],(e,t)=>e&&t?t instanceof Map?t.get(e)||null:"object"==typeof t&&t[e]||null:null),xw=ze([By.$items,ow,aw,iw],(e,t,s,i)=>{if(!e)return[];let o;if(e instanceof Map)o=Array.from(e.values());else{if("object"!=typeof e)return[];o=Object.values(e)}if("all"!==i)switch(i){case"active":o=o.filter(e=>"running"===e.state||"active"===e.state);break;case"inactive":o=o.filter(e=>"inactive"===e.state);break;case"local":o=o.filter(e=>["dir","fs","logical","disk"].includes(e.type));break;case"network":o=o.filter(e=>["iscsi","nfs","gluster","ceph","rbd"].includes(e.type))}if(t){const e=t.toLowerCase();o=o.filter(t=>t.name.toLowerCase().includes(e)||t.type.toLowerCase().includes(e)||t.path?.toLowerCase().includes(e)||t.state.toLowerCase().includes(e))}return s?.state&&s.state.length>0&&(o=o.filter(e=>s.state.includes(e.state))),s?.type&&s.type.length>0&&(o=o.filter(e=>s.type.includes(e.type))),o});ze([By.$items],e=>{if(!e)return{totalPools:0,activePools:0,inactivePools:0,totalCapacity:0,totalAllocated:0,totalAvailable:0,localPools:0,networkPools:0};let t;if(e instanceof Map)t=Array.from(e.values());else{if("object"!=typeof e)return{totalPools:0,activePools:0,inactivePools:0,totalCapacity:0,totalAllocated:0,totalAvailable:0,localPools:0,networkPools:0};t=Object.values(e)}const s=["dir","fs","logical","disk"],i=["iscsi","nfs","gluster","ceph","rbd"];return{totalPools:t.length,activePools:t.filter(e=>"running"===e.state||"active"===e.state).length,inactivePools:t.filter(e=>"inactive"===e.state).length,totalCapacity:t.reduce((e,t)=>e+(t.capacity||0),0),totalAllocated:t.reduce((e,t)=>e+(t.allocation||0),0),totalAvailable:t.reduce((e,t)=>e+(t.available||0),0),localPools:t.filter(e=>s.includes(e.type)).length,networkPools:t.filter(e=>i.includes(e.type)).length}});const _w=ze([Uy.$items],e=>{if(!e)return[];let t;if(e instanceof Map)t=Array.from(e.values());else{if("object"!=typeof e)return[];t=Object.values(e)}return t.sort((e,t)=>e.name.localeCompare(t.name))});ze([cw,Ky.$items],(e,t)=>e&&t?t instanceof Map?t.get(e)||null:"object"==typeof t&&t[e]||null:null),ze([Ky.$items,lw,dw,nw],(e,t,s,i)=>{if(!e)return[];let o;if(e instanceof Map)o=Array.from(e.values());else{if("object"!=typeof e)return[];o=Object.values(e)}if("all"!==i)switch(i){case"active":case"inactive":o=o.filter(e=>e.state===i);break;case"persistent":o=o.filter(e=>!0===e.persistent);break;case"autostart":o=o.filter(e=>!0===e.autostart)}if(t){const e=t.toLowerCase();o=o.filter(t=>t.name.toLowerCase().includes(e)||t.bridge?.toLowerCase().includes(e)||t.uuid?.toLowerCase().includes(e)||t.ip?.toLowerCase().includes(e))}return s?.state&&s.state.length>0&&(o=o.filter(e=>s.state.includes(e.state))),o}),ze([Ky.$items],e=>{if(!e)return{totalNetworks:0,activeNetworks:0,inactiveNetworks:0,persistentNetworks:0,autostartNetworks:0};let t;if(e instanceof Map)t=Array.from(e.values());else{if("object"!=typeof e)return{totalNetworks:0,activeNetworks:0,inactiveNetworks:0,persistentNetworks:0,autostartNetworks:0};t=Object.values(e)}return{totalNetworks:t.length,activeNetworks:t.filter(e=>"active"===e.state).length,inactiveNetworks:t.filter(e=>"inactive"===e.state).length,persistentNetworks:t.filter(e=>!0===e.persistent).length,autostartNetworks:t.filter(e=>!0===e.autostart).length}}),ze([uw,Uy.$items],(e,t)=>e&&t?t instanceof Map?t.get(e)||null:"object"==typeof t&&t[e]||null:null),ze([Uy.$items,hw,pw],(e,t,s)=>{if(!e)return[];let i;if(e instanceof Map)i=Array.from(e.values());else{if("object"!=typeof e)return[];i=Object.values(e)}if(t){const e=t.toLowerCase();i=i.filter(t=>t.name.toLowerCase().includes(e)||t.os_type?.toLowerCase().includes(e)||t.os_variant?.toLowerCase().includes(e))}return s?.os_type&&s.os_type.length>0&&(i=i.filter(e=>s.os_type.includes(e.os_type||""))),s?.storage_pool&&s.storage_pool.length>0&&(i=i.filter(e=>s.storage_pool.includes(e.storage_pool||""))),i.sort((e,t)=>e.name.localeCompare(t.name))}),ze([Uy.$items],e=>{if(!e)return{totalISOs:0,totalSize:0,osTypes:[],storagePools:[]};let t;if(e instanceof Map)t=Array.from(e.values());else{if("object"!=typeof e)return{totalISOs:0,totalSize:0,osTypes:[],storagePools:[]};t=Object.values(e)}const s=/* @__PURE__ */new Set,i=/* @__PURE__ */new Set;let o=0;return t.forEach(e=>{o+=e.size||0,e.os_type&&s.add(e.os_type),e.storage_pool&&i.add(e.storage_pool)}),{totalISOs:t.length,totalSize:o,osTypes:Array.from(s).sort(),storagePools:Array.from(i).sort()}}),ze([mw,Jy.$items],(e,t)=>e&&t?t instanceof Map?t.get(e)||null:"object"==typeof t&&t[e]||null:null);const kw=ze([Jy.$items,gw,fw,vw],(e,t,s,i)=>{if(!e)return[];let o;if(e instanceof Map)o=Array.from(e.values());else{if("object"!=typeof e)return[];o=Object.values(e)}if("all"!==i)switch(i){case"disk-images":o=o.filter(e=>"file"===e.type&&["qcow2","raw","vmdk"].includes(e.format));break;case"iso-files":o=o.filter(e=>"file"===e.type&&"iso"===e.format);break;case"directories":o=o.filter(e=>"dir"===e.type)}if(t){const e=t.toLowerCase();o=o.filter(t=>t.name.toLowerCase().includes(e)||t.path.toLowerCase().includes(e)||t.pool_name.toLowerCase().includes(e)||t.format.toLowerCase().includes(e))}return s?.format&&s.format.length>0&&(o=o.filter(e=>s.format.includes(e.format))),s?.pool_name&&s.pool_name.length>0&&(o=o.filter(e=>s.pool_name.includes(e.pool_name))),s?.type&&s.type.length>0&&(o=o.filter(e=>s.type.includes(e.type))),o.sort((e,t)=>e.name.localeCompare(t.name))}),Sw=ze([Jy.$items],e=>{if(!e)return{totalVolumes:0,totalCapacity:0,totalAllocation:0,diskImages:0,isoFiles:0,directories:0,pools:[]};let t;if(e instanceof Map)t=Array.from(e.values());else{if("object"!=typeof e)return{totalVolumes:0,totalCapacity:0,totalAllocation:0,diskImages:0,isoFiles:0,directories:0,pools:[]};t=Object.values(e)}const s=/* @__PURE__ */new Set;let i=0,o=0,r=0,a=0,n=0;return t.forEach(e=>{i+=e.capacity||0,o+=e.allocation||0,s.add(e.pool_name),"file"===e.type&&["qcow2","raw","vmdk"].includes(e.format)?r++:"file"===e.type&&"iso"===e.format?a++:"dir"===e.type&&n++}),{totalVolumes:t.length,totalCapacity:i,totalAllocation:o,diskImages:r,isoFiles:a,directories:n,pools:Array.from(s).sort()}});i(()=>{const e={};try{const t=Oy.$items.get();e.virt_vms=t instanceof Map?t.size:t?Object.keys(t).length:0}catch{}try{const t=By.$items.get();e.virt_storage_pools=t instanceof Map?t.size:t?Object.keys(t).length:0}catch{}try{const t=Uy.$items.get();e.virt_isos=t instanceof Map?t.size:t?Object.keys(t).length:0}catch{}try{const t=Hy.$items.get();e.virt_templates=t instanceof Map?t.size:t?Object.keys(t).length:0}catch{}try{const t=Ky.$items.get();e.virt_networks=t instanceof Map?t.size:t?Object.keys(t).length:0}catch{}try{const t=Jy.$items.get();e.virt_volumes=t instanceof Map?t.size:t?Object.keys(t).length:0}catch{}return e});const Cw={async fetchAll(){r("virt_vm_fetchAll"),await Oy.fetch()},updateLocalState(e,t){const s=Oy.$items.get();let i;if(s instanceof Map)i=new Map(s);else{if(!s||"object"!=typeof s)return;i=new Map(Object.entries(s))}const o=i.get(e);o&&(i.set(e,{...o,state:t}),Oy.$items.set(i))},async create(e){const t=await Py("/computes",{method:"POST",body:JSON.stringify(e)}),s=new Map(Oy.$items.get());return s.set(t.id,t),Oy.$items.set(s),Yy.set(t.id),{success:!0,data:t}},async createFromTemplate(e,t){const s=Number(e);if(!Number.isFinite(s))throw new Error("Invalid template ID");const i=await Py("/computes/from-template",{method:"POST",body:JSON.stringify({template_id:s,...t})}),o=new Map(Oy.$items.get());return o.set(i.id,i),Oy.$items.set(o),Yy.set(i.id),i},async executeAction(e,t,s=!1){await Py(`/computes/${e}/action`,{method:"POST",body:JSON.stringify({action:t,force:s})})},async start(e){await this.executeAction(e,"start");Oy.getById(e)&&await Oy.update(e,{state:"running"})},async stop(e,t=!1){await this.executeAction(e,"stop",t);Oy.getById(e)&&await Oy.update(e,{state:"stopped"})},async restart(e,t=!1){await this.executeAction(e,"restart",t)},async pause(e){await this.executeAction(e,"pause");Oy.getById(e)&&await Oy.update(e,{state:"paused"})},async resume(e){await this.executeAction(e,"resume");Oy.getById(e)&&await Oy.update(e,{state:"running"})},async delete(e){await Py(`/computes/${e}`,{method:"DELETE"}),await Oy.delete(e),Yy.get()===e&&Yy.set(null)},getConsoleInfo:async e=>Py(`/computes/${e}/console`),async update(e,t){const s=await Py(`/computes/${e}`,{method:"PUT",body:JSON.stringify(t)}),i=new Map(Oy.$items.get());return i.set(s.id,s),Oy.$items.set(i),{success:!0,data:s}},selectVM(e){Yy.set(e)}},$w={async fetchAll(){r("virt_template_fetchAll"),await Hy.fetch()},async create(e){const t=jy(await Py("/computes/templates",{method:"POST",body:JSON.stringify(e)})),s=Hy.$items.get(),i=s instanceof Map?new Map(s):s&&"object"==typeof s?new Map(Object.entries(s)):/* @__PURE__ */new Map;return i.set(t.id,t),Hy.$items.set(i),Hy.emit({type:cy.CREATED,payload:t,timestamp:Date.now()}),t},async update(e,t){const s=jy(await Py(`/computes/templates/${encodeURIComponent(e)}`,{method:"PUT",body:JSON.stringify(t)})),i=Hy.$items.get(),o=i instanceof Map?new Map(i):i&&"object"==typeof i?new Map(Object.entries(i)):/* @__PURE__ */new Map;return o.set(s.id,s),Hy.$items.set(o),Hy.emit({type:cy.UPDATED,payload:s,timestamp:Date.now()}),s},async delete(e){await Py(`/computes/templates/${encodeURIComponent(e)}`,{method:"DELETE"});const t=Hy.$items.get(),s=t instanceof Map?new Map(t):t&&"object"==typeof t?new Map(Object.entries(t)):/* @__PURE__ */new Map,i=s.get(e);s.delete(e),Hy.$items.set(s),Hy.emit({type:cy.DELETED,payload:i,timestamp:Date.now()})},async createFromVM(e,t,s){const i=jy(await Py(`/computes/${encodeURIComponent(e)}/template`,{method:"POST",body:JSON.stringify({name:t,description:s})})),o=Hy.$items.get(),r=o instanceof Map?new Map(o):o&&"object"==typeof o?new Map(Object.entries(o)):/* @__PURE__ */new Map;return r.set(i.id,i),Hy.$items.set(r),Hy.emit({type:cy.CREATED,payload:i,timestamp:Date.now()}),i}},Dw={openWizard(){Xy.set({isOpen:!0,currentStep:1,openId:Date.now(),formData:{memory:2048,vcpus:2,storage:{default_pool:"default",disks:[{action:"create",size:20,format:"qcow2",storage_pool:"default"}]}},errors:{},editMode:!1,editingVmId:void 0,templateMode:!1,templateContext:void 0})},openWizardFromTemplate(e){const t=e.recommended_memory??e.min_memory,s=e.recommended_vcpus??e.min_vcpus;Xy.set({isOpen:!0,currentStep:1,openId:Date.now(),formData:{name:`${e.name}-vm`,memory:t,vcpus:s,metadata:e.metadata},errors:{},editMode:!1,editingVmId:void 0,templateMode:!0,templateContext:e})},openWizardForEdit(e){const t=Jy.$items.get(),s=e.disks?.map(e=>{const s=(e=>{if(e&&t)if(t instanceof Map){for(const s of t.values())if(s&&"object"==typeof s&&s.path===e)return s.pool_name}else if("object"==typeof t)for(const s of Object.values(t))if(s&&"object"==typeof s&&s.path===e)return s.pool_name})(e.path);return{action:"attach",path:e.path,format:"vmdk"===e.format?"qcow2":e.format,size:e.size,bus:e.bus,storage_pool:s}})||[{action:"create",size:20,format:"qcow2",storage_pool:"default"}],i=s[0]?.storage_pool||"default",o=e.network_interfaces?.[0]?{type:e.network_interfaces[0].type,source:e.network_interfaces[0].source,model:e.network_interfaces[0].model,mac:e.network_interfaces[0].mac}:void 0,r={name:e.name,memory:e.memory,vcpus:e.vcpus,storage:{default_pool:i,disks:s},network:o,graphics:e.graphics,metadata:e.metadata};Xy.set({isOpen:!0,currentStep:1,openId:Date.now(),formData:r,errors:{},editMode:!0,editingVmId:e.id,templateMode:!1,templateContext:void 0})},openEnhancedWizardForEdit(e,t){Xy.set({isOpen:!0,currentStep:1,openId:Date.now(),formData:t,errors:{},editMode:!0,editingVmId:e,templateMode:!1,templateContext:void 0})},closeWizard(){Xy.set({isOpen:!1,currentStep:1,openId:Date.now(),formData:{},errors:{},editMode:!1,editingVmId:void 0,templateMode:!1,templateContext:void 0})},nextStep(){const e=Xy.get();e.currentStep<4&&Xy.set({...e,currentStep:e.currentStep+1})},previousStep(){const e=Xy.get();e.currentStep>1&&Xy.set({...e,currentStep:e.currentStep-1})},updateFormData(e){const t=Xy.get();Xy.set({...t,formData:{...t.formData,...e}})},setError(e,t){const s=Xy.get();Xy.set({...s,errors:{...s.errors,[e]:t}})},clearErrors(){const e=Xy.get();Xy.set({...e,errors:{}})},validateStep(e){const{formData:t}=Xy.get();switch(e){case 1:return!!(t.name&&t.memory&&t.vcpus);case 2:return!(!t.storage?.default_pool||!t.storage?.disks?.length);case 3:case 4:return!0;default:return!1}}},Ew={async fetchAll(){r("virt_storagePool_fetchAll"),await By.fetch()},async refresh(e){e&&await Py(`/storages/pools/${e}/refresh`,{method:"POST"}),await By.fetch()},async start(e){await Py(`/storages/pools/${e}/start`,{method:"POST"});By.getById(e)&&await By.update(e,{state:"running"})},async stop(e){await Py(`/storages/pools/${e}/stop`,{method:"POST"});By.getById(e)&&await By.update(e,{state:"inactive"})},async delete(e,t=!1){const s=t?"?delete_volumes=true":"";await Py(`/storages/pools/${e}${s}`,{method:"DELETE"}),await By.delete(e),rw.get()===e&&rw.set(null)},async create(e){const t=await Py("/storages/pools",{method:"POST",body:JSON.stringify(e)}),s=new Map(By.$items.get());return s.set(t.name,t),By.$items.set(s),rw.set(t.name),{success:!0,data:t}},async update(e,t){const s=await Py(`/storages/pools/${e}`,{method:"PUT",body:JSON.stringify(t)}),i=new Map(By.$items.get());return i.set(s.name,s),By.$items.set(i),{success:!0,data:s}},selectPool(e){rw.set(e)},setSearchQuery(e){ow.set(e)},setActiveTab(e){iw.set(e)},setFilters(e){aw.set(e)}},Mw={async fetchAll(){r("virt_volume_fetchAll"),await Jy.fetch()},async delete(e){const[t,s]=e.includes(":")?(()=>{const t=e.split(":");return[t[0]||null,t[1]||null]})():[null,null];t&&s?await Py(`/storages/pools/${t}/volumes/${s}`,{method:"DELETE"}):await Py(`/volumes/${e}`,{method:"DELETE"}),await Jy.delete(e),mw.get()===e&&mw.set(null)},selectVolume(e){mw.set(e)},setSearchQuery(e){gw.set(e)},setActiveTab(e){vw.set(e)},setFilters(e){fw.set(e)}},Aw={async fetchPools(){await By.fetch()},async fetchISOs(){await Uy.fetch()},uploadISO:async(e,t)=>(Zy.set({isUploading:!0,uploadProgress:0,uploadId:Bd(),error:null}),new Promise(e=>{const t=setInterval(()=>{const s=Zy.get(),i=Math.min(s.uploadProgress+10,100);Zy.set({...s,uploadProgress:i}),i>=100&&(clearInterval(t),Zy.set({isUploading:!1,uploadProgress:0,uploadId:null,error:null}),e({success:!0}))},500)})),async deleteISO(e){await Py(`/isos/${e}`,{method:"DELETE"}),await Uy.delete(e)}};const Iw={async list(e){const t=await Py(`/computes/${e}/snapshots`);return Array.isArray(t?.snapshots)?t.snapshots:[]},create:async(e,t)=>Py(`/computes/${e}/snapshots`,{method:"POST",body:JSON.stringify(t)}),async getCapabilities(e){const t=await Py(`/computes/${e}/snapshots/capabilities`);return t?.capabilities??null},async getDetail(e,t){const s=encodeURIComponent(t),i=await Py(`/computes/${e}/snapshots/${s}`);return i?.snapshot??null},async revert(e,t,s){const i=void 0!==s?{flags:s}:void 0;return Py(`/computes/${e}/snapshots/${encodeURIComponent(t)}/revert`,{method:"POST",body:i?JSON.stringify(i):void 0})},async delete(e,t){const s=encodeURIComponent(t);await Py(`/computes/${e}/snapshots/${s}`,{method:"DELETE"})}},Tw={async getAvailable(e){const t=await Py(`/computes/${e}/consoles`);return"success"===t.status&&t.data?t.data:{available:[],consoles:{}}},async getVNC(e){const t=await Py(`/computes/${e}/console/vnc`);if(t&&t.token)return t;throw new Error("Failed to get VNC console info")},async getSPICE(e){const t=await Py(`/computes/${e}/console/spice`);if(t&&t.token)return t;throw new Error("Failed to get SPICE console info")},getVNCWebSocketUrl:(e,t)=>`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}/api/v1/virtualization/computes/${e}/console/vnc/ws?token=${encodeURIComponent(t)}`,getSPICEWebSocketUrl:(e,t)=>`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}/api/v1/virtualization/computes/${e}/console/spice/ws?token=${encodeURIComponent(t)}`};var Pw=Object.defineProperty,Lw=Object.getOwnPropertyDescriptor,Rw=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Lw(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Pw(t,s,r),r};let Ow=class extends me{constructor(){super(...arguments),this.vmId="",this.vmName="",this.show=!1,this.isConnecting=!0,this.isWSConnected=!1,this.error=null,this.connectionStatus="Connecting...",this.scaleViewport=!0,this.showVirtualKeyboard=!1,this.availableConsoles=[],this.selectedConsoleType="vnc",this.vncIframe=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectTimeout=null,this.handleResize=()=>{},this.handleSendCAD=()=>{this.vncIframe?.contentWindow&&this.vncIframe.contentWindow.postMessage({type:"sendCAD"},"*")},this.handleToggleScale=()=>{this.scaleViewport=!this.scaleViewport,this.vncIframe?.contentWindow&&this.vncIframe.contentWindow.postMessage({type:"toggleScale"},"*")},this.handleFullscreen=async()=>{try{const t=await this.fetchConsoleToken();if(!t)throw new Error("Failed to obtain console access token");const s=`${e("").replace(/^http/,"ws")}virtualization/computes/${this.vmId}/console/vnc/ws?token=${encodeURIComponent(t.token)}`,i=`/vnc-console.html?url=${encodeURIComponent(s)}&fullscreen=true&vmName=${encodeURIComponent(this.vmName||this.vmId)}`;window.open(i,"_blank")}catch(t){console.error("Failed to open fullscreen console:",t),this.error=t instanceof Error?t.message:"Failed to open fullscreen console"}},this.handleToggleKeyboard=()=>{this.showVirtualKeyboard=!this.showVirtualKeyboard,this.vncIframe?.contentWindow&&this.vncIframe.contentWindow.postMessage({type:"toggleKeyboard",show:this.showVirtualKeyboard},"*")},this.handleReconnect=()=>{this.reconnectAttempts=0,this.error=null,this.connectVNC()},this.handleClose=()=>{this.cleanup(),this.show=!1,this.dispatchEvent(new CustomEvent("close"))}}connectedCallback(){super.connectedCallback(),this.show&&this.vmId&&setTimeout(()=>this.initConsole(),100)}disconnectedCallback(){super.disconnectedCallback(),this.cleanup()}updated(e){e.has("show")&&(this.show&&this.vmId?setTimeout(()=>this.initConsole(),100):this.show||this.cleanup())}async fetchAvailableConsoles(){try{const e=await Tw.getAvailable(this.vmId);this.availableConsoles=e.available||["vnc"],e.preferred&&this.availableConsoles.includes(e.preferred)?this.selectedConsoleType=e.preferred:this.availableConsoles.length>0&&(this.selectedConsoleType=this.availableConsoles[0]||"vnc")}catch(e){console.warn("Could not fetch available consoles, defaulting to VNC:",e),this.availableConsoles=["vnc"],this.selectedConsoleType="vnc"}}async initConsole(){if(!this.vncIframe){await this.fetchAvailableConsoles();try{await this.connectVNC()}catch(e){console.error("Failed to initialize console:",e),this.error=e instanceof Error?e.message:"Failed to initialize console",this.isConnecting=!1}}}async connectVNC(){if(!this.vmId)return this.error="No VM ID provided",void(this.isConnecting=!1);try{this.connectionStatus="Requesting console access...",this.isConnecting=!0,this.error=null;const t=await this.fetchConsoleToken();if(!t)throw new Error("Failed to obtain console access token");this.connectionStatus="Loading VNC console...";const s=`${e("").replace(/^http/,"ws")}virtualization/computes/${this.vmId}/console/vnc/ws?token=${encodeURIComponent(t.token)}`;console.log("Connecting to VM VNC via iframe:",s.replace(t.token,"[REDACTED]")),this.vncIframe=document.createElement("iframe"),this.vncIframe.className="vnc-iframe",this.vncIframe.src=`/vnc-console.html?url=${encodeURIComponent(s)}`;const i=e=>{"vnc-ready"===e.data.type&&(console.log("VNC iframe ready"),this.isConnecting=!1,this.isWSConnected=!0,this.connectionStatus="Connected",this.reconnectAttempts=0)};window.addEventListener("message",i);const o=this.shadowRoot?.querySelector(".vnc-container");o&&o.appendChild(this.vncIframe),setTimeout(()=>{this.isConnecting&&(this.error="Failed to load VNC console",this.isConnecting=!1)},1e4)}catch(t){console.error("Failed to connect to VNC:",t),this.error=t instanceof Error?t.message:"Failed to connect to VNC",this.isConnecting=!1,this.isWSConnected=!1,this.connectionStatus="Failed to connect"}}async fetchConsoleToken(){try{const t=o.getAuthHeaders();if(!t.Authorization)throw new Error("No authentication token available");const s=e(`/virtualization/computes/${this.vmId}/console/vnc`);console.log("Fetching console token from:",s);const i=await fetch(s,{method:"GET",headers:{...t,"Content-Type":"application/json"}});if(!i.ok){const e=await i.text();throw console.error("Failed to fetch console token:",i.status,e),new Error(`Failed to get console access: ${i.statusText}`)}const r=await i.json();if(console.log("Console token response:",{...r,data:{...r.data,token:"[REDACTED]"}}),"success"===r.status&&r.data)return r.data;throw new Error("Invalid console token response")}catch(t){throw console.error("Error fetching console token:",t),t}}cleanup(){this.vncIframe?.contentWindow&&this.vncIframe.contentWindow.postMessage({type:"disconnect"},"*"),this.vncIframe&&(this.vncIframe.remove(),this.vncIframe=null),window.removeEventListener("resize",this.handleResize),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.isConnecting=!1,this.isWSConnected=!1,this.error=null,this.connectionStatus="Disconnected",this.reconnectAttempts=0}render(){return J`
      <div class="console-overlay">
        <div class="console-window">
          <div class="console-header">
            <div class="console-title">
              <span class="console-icon">ð»</span>
              <span>Console (${this.selectedConsoleType.toUpperCase()}) - <span class="vm-name">${this.vmName||this.vmId}</span></span>
            </div>
            
            <div class="connection-status">
              <span class="status-indicator ${this.isWSConnected?"connected":this.error?"error":""}"></span>
              <span>${this.connectionStatus}</span>
            </div>

            <div class="console-actions">
              <button 
                class="action-btn" 
                @click=${this.handleSendCAD}
                ?disabled=${!this.isWSConnected}
                title="Send Ctrl+Alt+Del"
              >
                â¨ï¸ Ctrl+Alt+Del
              </button>
              <button 
                class="action-btn" 
                @click=${this.handleToggleKeyboard}
                title="${this.showVirtualKeyboard?"Hide Virtual Keyboard":"Show Virtual Keyboard"}"
              >
                ${this.showVirtualKeyboard?"â¨ï¸ Hide Keyboard":"â¨ï¸ Show Keyboard"}
              </button>
              <button 
                class="action-btn" 
                @click=${this.handleToggleScale}
                title="${this.scaleViewport?"Disable Fit":"Fit to Window"}"
              >
                ${this.scaleViewport?"ð§© Unfit":"ð§© Fit"}
              </button>
              <button 
                class="action-btn" 
                @click=${this.handleFullscreen}
                title="Open in New Tab (Fullscreen)"
              >
                ð¥ï¸ Fullscreen
              </button>
              <button class="close-btn" @click=${this.handleClose} title="Close">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2"/>
                </svg>
              </button>
            </div>
          </div>

          <div class="console-body">
            <div class="vnc-container">
              <!-- iframe will be injected here -->
            </div>
            
            ${this.isConnecting?J`
              <div class="loading-overlay">
                <div class="spinner"></div>
                <div class="loading-text">${this.connectionStatus}</div>
              </div>
            `:""}

            ${this.error?J`
              <div class="error-overlay">
                <div class="error-icon">â ï¸</div>
                <div class="error-message">${this.error}</div>
                ${this.reconnectAttempts<this.maxReconnectAttempts?J`
                  <button class="retry-btn" @click=${this.handleReconnect}>
                    ð Retry Connection
                  </button>
                `:""}
              </div>
            `:""}
          </div>

          <div class="console-footer">
            <div class="keyboard-shortcuts">
              <div class="shortcut">
                <span class="key">Click</span>
                <span>Focus console for keyboard input</span>
              </div>
              <div class="shortcut">
                <span class="key">â</span> / <span class="key">Ctrl</span>
                <span>may be captured by guest</span>
              </div>
            </div>
            <div>
              noVNC client ready
            </div>
          </div>
        </div>
      </div>
    `}};Ow.styles=g`
    :host {
      display: block;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 2000;
      pointer-events: none;
    }

    :host([show]) {
      pointer-events: auto;
    }

    .console-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
    }

    :host([show]) .console-overlay {
      display: flex;
      animation: fadeIn 0.2s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .console-window {
      width: 90%;
      height: 90%;
      max-width: 1200px;
      max-height: 800px;
      background: var(--vscode-editor-background, #1e1e1e);
      border: 1px solid var(--vscode-border, #454545);
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      animation: slideUp 0.3s ease-out;
    }

    @keyframes slideUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .console-header {
      padding: 12px 16px;
      background: var(--vscode-titlebar, #252526);
      border-bottom: 1px solid var(--vscode-border, #454545);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .console-title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 14px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
    }

    .console-icon {
      font-size: 18px;
    }

    .vm-name {
      color: var(--vscode-info, #3794ff);
    }

    .connection-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--vscode-text-dim, #8b8b8b);
    }

    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--vscode-warning, #cca700);
    }

    .status-indicator.connected {
      background: var(--vscode-success, #89d185);
      animation: pulse 2s infinite;
    }

    .status-indicator.error {
      background: var(--vscode-error, #f48771);
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.6;
      }
    }

    .console-actions {
      display: flex;
      gap: 8px;
    }

    .action-btn {
      padding: 4px 8px;
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border: 1px solid var(--vscode-button-border, #5a5a5a);
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .action-btn:hover {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
    }

    .action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .close-btn {
      padding: 4px;
      background: transparent;
      border: none;
      color: var(--vscode-foreground, #cccccc);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .close-btn:hover {
      background: var(--vscode-list-hoverBackground, rgba(90, 93, 94, 0.31));
    }

    .console-body {
      flex: 1;
      background: #000;
      position: relative;
      overflow: hidden;
    }

    .vnc-iframe {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      height: 100%;
      border: none;
      background: #000;
    }

    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 16px;
      z-index: 10;
    }

    .spinner {
      width: 32px;
      height: 32px;
      border: 3px solid var(--vscode-border, #454545);
      border-top-color: var(--vscode-focusBorder, #007acc);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .loading-text {
      color: var(--vscode-foreground, #cccccc);
      font-size: 14px;
    }

    .error-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 16px;
      z-index: 10;
      padding: 20px;
    }

    .error-icon {
      font-size: 48px;
      opacity: 0.8;
    }

    .error-message {
      color: var(--vscode-error, #f48771);
      font-size: 14px;
      text-align: center;
      max-width: 400px;
    }

    .retry-btn {
      padding: 8px 16px;
      background: var(--vscode-button-background, #0e639c);
      color: var(--vscode-button-foreground, #ffffff);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
    }

    .retry-btn:hover {
      background: var(--vscode-button-hoverBackground, #1177bb);
    }

    .console-footer {
      padding: 8px 16px;
      background: var(--vscode-titlebar, #252526);
      border-top: 1px solid var(--vscode-border, #454545);
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #8b8b8b);
      flex-shrink: 0;
    }

    .keyboard-shortcuts {
      display: flex;
      gap: 16px;
    }

    .shortcut {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .key {
      padding: 2px 6px;
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      border: 1px solid var(--vscode-button-border, #5a5a5a);
      border-radius: 3px;
      font-family: monospace;
      font-size: 11px;
    }

    /* noVNC canvas will be injected into .vnc-canvas-wrapper */
    .vnc-canvas-wrapper canvas {
      width: 100% !important;
      height: 100% !important;
      image-rendering: pixelated;
      outline: none;
      display: block;
    }
  `,Rw([we({type:String})],Ow.prototype,"vmId",2),Rw([we({type:String})],Ow.prototype,"vmName",2),Rw([we({type:Boolean,reflect:!0})],Ow.prototype,"show",2),Rw([xe()],Ow.prototype,"isConnecting",2),Rw([xe()],Ow.prototype,"isWSConnected",2),Rw([xe()],Ow.prototype,"error",2),Rw([xe()],Ow.prototype,"connectionStatus",2),Rw([xe()],Ow.prototype,"scaleViewport",2),Rw([xe()],Ow.prototype,"showVirtualKeyboard",2),Rw([xe()],Ow.prototype,"availableConsoles",2),Rw([xe()],Ow.prototype,"selectedConsoleType",2),Ow=Rw([ve("vm-console")],Ow);var Nw=Object.defineProperty,Bw=Object.getOwnPropertyDescriptor,Fw=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Bw(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Nw(t,s,r),r};let zw=class extends me{constructor(){super(...arguments),this.vm=null,this.backups=[],this.isLoading=!1,this.error=null,this.toast=null,this.showCreateModal=!1,this.showRestoreModal=!1,this.restoreTarget=null,this.restoreNewName="",this.restoreOverwrite=!1,this.restoreKey="",this.isCreating=!1,this.isRestoring=!1,this.showDeleteModal=!1,this.deleteTarget=null,this.isDeleting=!1,this.missingFiles=/* @__PURE__ */new Set,this.pollingHandle=null,this.createForm={backup_type:"full",destination_path:"",compression:"none",encryption:"none",include_memory:!1,retention_days:7,description:""}}connectedCallback(){super.connectedCallback(),this.backupWatcher=ky.subscribe(()=>this.syncFromStore())}disconnectedCallback(){super.disconnectedCallback(),this.backupWatcher?.(),this.clearPolling()}updated(e){e.has("vm")&&(this.createForm.destination_path=this.defaultDestination(),this.loadBackups())}defaultDestination(){return`/var/lib/libvirt/vapor-backups/${this.vm?.name||this.vm?.id||"vm"}`}syncFromStore(){if(!this.vm)return void(this.backups=[]);const e=(t=this.vm.id,ze(ky,e=>e.filter(e=>(e.vm_uuid||e.vm_id)===t))).get();var t;this.backups=[...e].sort((e,t)=>(t.started_at||t.created_at||"").localeCompare(e.started_at||e.created_at||"")),this.configurePolling()}async loadBackups(){if(this.vm){this.isLoading=!0,this.error=null;try{await My.fetchForVm(this.vm.id),this.syncFromStore()}catch(e){this.error="BACKUPS_NOT_AVAILABLE"===e?.code?"Backups are not available on this host.":e?.message||"Failed to load backups"}finally{this.isLoading=!1}}}configurePolling(){this.clearPolling();this.backups.some(e=>["running","pending"].includes((e.status||"").toLowerCase()))&&(this.pollingHandle=window.setInterval(()=>this.loadBackups(),5e3))}clearPolling(){this.pollingHandle&&(window.clearInterval(this.pollingHandle),this.pollingHandle=null)}async handleCreate(){if(this.vm){this.isCreating=!0;try{const e={...this.createForm};e.destination_path||delete e.destination_path,"none"===e.encryption&&delete e.encryption_key,await My.create(this.vm.id,e),this.toast={text:"Backup started",type:"success"},this.showCreateModal=!1,this.loadBackups()}catch(e){this.toast={text:e?.message||"Failed to create backup",type:"error"}}finally{this.isCreating=!1}}}getActions(e){const t=e.backup_id,s=this.isRestoring||this.isDeleting,i=!!t&&this.missingFiles.has(t);return[{label:"Restore",action:"restore",icon:"ð",disabled:this.isRestoring},{label:"Download",action:"download",icon:"â¬ï¸",disabled:i},{label:"Delete",action:"delete",icon:"ðï¸",danger:!0,disabled:s}]}handleAction(e,t){switch(e.detail.action){case"restore":this.openRestore(t);break;case"download":this.handleDownload(t);break;case"delete":this.handleDelete(t)}}handleDelete(e){this.deleteTarget=e,this.showDeleteModal=!0}async cancelDelete(){this.showDeleteModal=!1}async confirmDelete(){if(!this.deleteTarget?.backup_id)return;this.isDeleting=!0;const e=this.deleteTarget.backup_id;try{await My.delete(e),this.toast={text:"Backup deleted",type:"success"},this.showDeleteModal=!1,this.loadBackups()}catch(t){this.toast={text:t?.message||"Failed to delete backup",type:"error"}}finally{this.isDeleting=!1}}openRestore(e){this.restoreTarget=e,this.restoreNewName=`${e.vm_name||e.vm_uuid||"vm"}-restored`,this.restoreOverwrite=!1,this.restoreKey="",this.showRestoreModal=!0}async confirmRestore(){if(this.restoreTarget){this.isRestoring=!0;try{await My.restore({backup_id:this.restoreTarget.backup_id,overwrite:this.restoreOverwrite,new_vm_name:this.restoreOverwrite?void 0:this.restoreNewName||`${this.restoreTarget.vm_name||"vm"}-restored`,decryption_key:this.restoreKey||void 0}),this.toast={text:"Restore started",type:"success"},this.showRestoreModal=!1}catch(e){this.toast={text:e?.message||"Failed to restore backup",type:"error"}}finally{this.isRestoring=!1}}}handleDownload(e){if(e.backup_id)try{const t=yy.getBackupDownloadUrl(e.backup_id),s=document.createElement("a");s.href=t,s.download=`${e.vm_name||e.vm_uuid||"vm"}-${e.backup_id}.qcow2`,document.body.appendChild(s),s.click(),document.body.removeChild(s),this.toast={text:"Download started",type:"info"}}catch(t){console.error("[Download] Error generating link:",t),this.toast={text:t?.message||"Failed to start download",type:"error"}}}formatDate(e){if(!e)return"â";const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()}formatSize(e){if(!e)return"â";const t=["B","KB","MB","GB","TB"];let s=e,i=0;for(;s>=1024&&i<t.length-1;)s/=1024,i++;return`${s.toFixed(1)} ${t[i]}`}renderStatus(e){const t=(e||"unknown").toLowerCase();return J`<span class="chip"><span class="status-dot ${"running"===t||"pending"===t?"status-pending":"completed"===t?"status-completed":"failed"===t?"status-failed":"status-running"}"></span>${e||"unknown"}</span>`}renderTable(){return this.isLoading?J`<div class="empty-state">Loading backups...</div>`:this.error?J`<div class="error-box">${this.error}</div>`:this.backups.length?J`
      <table class="table">
        <thead>
          <tr>
            <th>Status</th>
            <th>Type</th>
            <th>Created</th>
            <th>Size</th>
            <th>Destination</th>
            <th>Retention</th>
            <th>Memory</th>
            <th>Encryption</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          ${this.backups.map(e=>J`
              <tr>
                <td>${this.renderStatus(e.status)}</td>
                <td>${e.type}</td>
                <td>${this.formatDate(e.started_at||e.created_at)}</td>
                <td>${this.formatSize(e.size_bytes||e.size)}</td>
                <td class="small">${e.destination_path||"â"}</td>
                <td>${e.retention_days??"â"}</td>
                <td>${e.include_memory?"Yes":"No"}</td>
                <td>${e.encryption&&"none"!==e.encryption?e.encryption:"None"}</td>
                <td>
                  <div style="display:flex; justify-content:flex-end;">
                    <action-dropdown
                      .actions=${this.getActions(e)}
                      .menuId=${`menu-${e.backup_id}`}
                      @action-click=${t=>this.handleAction(t,e)}
                    ></action-dropdown>
                  </div>
                  ${this.missingFiles.has(e.backup_id||"")?J`<div class="small" style="color:#fbbf24;">File missing on disk</div>`:""}
                  ${e.error_message?J`<div class="small" style="color:#fca5a5;">${e.error_message}</div>`:""}
                </td>
              </tr>
            `)}
        </tbody>
      </table>
    `:J`<div class="empty-state">No backups yet. Create one to get started.</div>`}render(){return J`
      <div class="section">
        <div class="section-header">
          <h3 class="section-title">Backups</h3>
          <div class="section-actions">
            <button class="btn" @click=${()=>this.loadBackups()} ?disabled=${this.isLoading}>Refresh</button>
            <button class="btn primary" @click=${()=>this.showCreateModal=!0} ?disabled=${this.isLoading}>Create backup</button>
          </div>
        </div>
        ${this.toast?J`<div class="toast ${this.toast.type}">${this.toast.text}</div>`:""}
        ${this.renderTable()}
      </div>

      ${this.renderCreateModal()}
      ${this.renderRestoreModal()}
      ${this.renderDeleteModal()}
    `}renderCreateModal(){return J`
      <modal-dialog
        .center=${!0}
        .open=${this.showCreateModal}
        .title=${"Create backup"}
        size="medium"
        @modal-close=${()=>this.showCreateModal=!1}
      >
        <div class="form-group">
          <label>Type</label>
          <select
            .value=${this.createForm.backup_type}
            @change=${e=>this.createForm.backup_type=e.target.value}
          >
            <option value="full">Full</option>
            <option value="incremental">Incremental</option>
            <option value="differential">Differential</option>
          </select>
        </div>
        <div class="form-group">
          <label>Destination path</label>
          <input
            type="text"
            .value=${this.createForm.destination_path||""}
            placeholder=${this.defaultDestination()}
            @input=${e=>this.createForm.destination_path=e.target.value}
          />
          <div class="form-hint">Default: ${this.defaultDestination()}</div>
        </div>
        <div class="form-group">
          <label>Compression</label>
          <select
            .value=${this.createForm.compression}
            @change=${e=>this.createForm.compression=e.target.value}
          >
            <option value="none">None</option>
            <option value="gzip">gzip</option>
            <option value="zstd">zstd</option>
            <option value="xz">xz</option>
          </select>
        </div>
        <div class="form-group">
          <label>Encryption</label>
          <select
            .value=${this.createForm.encryption}
            @change=${e=>this.createForm.encryption=e.target.value}
          >
            <option value="none">None</option>
            <option value="aes-256">AES-256</option>
            <option value="aes-128">AES-128</option>
          </select>
        </div>
        ${this.createForm.encryption&&"none"!==this.createForm.encryption?J`<div class="form-group">
              <label>Encryption key</label>
              <input
                type="password"
                .value=${this.createForm.encryption_key||""}
                @input=${e=>this.createForm.encryption_key=e.target.value}
              />
            </div>`:""}
        <div class="form-group checkbox">
          <input
            type="checkbox"
            .checked=${this.createForm.include_memory||!1}
            @change=${e=>this.createForm.include_memory=e.target.checked}
          />
          <div>
            <label>Include memory</label>
            <div class="form-hint">Capture RAM state if supported.</div>
          </div>
        </div>
        <div class="form-group">
          <label>Retention days</label>
          <input
            type="number"
            min="1"
            .value=${String(this.createForm.retention_days??"")}
            @input=${e=>this.createForm.retention_days=Number(e.target.value)}
          />
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea
            rows="2"
            .value=${this.createForm.description||""}
            @input=${e=>this.createForm.description=e.target.value}
          ></textarea>
        </div>
        <div slot="footer" style="display:flex; justify-content:flex-end; gap:8px;">
          <button class="btn" @click=${()=>this.showCreateModal=!1} ?disabled=${this.isCreating}>Cancel</button>
          <button class="btn primary" @click=${()=>this.handleCreate()} ?disabled=${this.isCreating}>
            ${this.isCreating?"Creatingâ¦":"Create backup"}
          </button>
        </div>
      </modal-dialog>
    `}renderDeleteModal(){return this.deleteTarget?J`
      <modal-dialog
        .center=${!0}
        .open=${this.showDeleteModal}
        .title=${"Delete Backup"}
        size="medium"
        @modal-close=${this.cancelDelete}
      >
        <p style="margin: 0 0 16px 0; line-height: 1.5;">
          Are you sure you want to delete this backup? This action cannot be undone.
        </p>

        <div style="background: var(--vscode-input-background, #3c3c3c); border: 1px solid var(--vscode-widget-border, #454545); border-radius: 6px; padding: 12px; margin: 16px 0;">
          <div style="display: flex; justify-content: space-between; padding: 6px 0;">
            <span style="color: var(--vscode-descriptionForeground, #9ca3af); font-size: 13px;">VM:</span>
            <span style="color: var(--vscode-foreground, #cccccc); font-size: 13px; font-weight: 500;">${this.deleteTarget.vm_name}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 6px 0;">
            <span style="color: var(--vscode-descriptionForeground, #9ca3af); font-size: 13px;">Backup ID:</span>
            <span style="color: var(--vscode-foreground, #cccccc); font-size: 13px; font-weight: 500; font-family: monospace;">${this.deleteTarget.backup_id}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 6px 0;">
            <span style="color: var(--vscode-descriptionForeground, #9ca3af); font-size: 13px;">Type:</span>
            <span style="color: var(--vscode-foreground, #cccccc); font-size: 13px; font-weight: 500;">${this.deleteTarget.type}</span>
          </div>
        </div>

        <div style="display: flex; gap: 12px; background: rgba(234, 179, 8, 0.1); border: 1px solid rgba(234, 179, 8, 0.3); border-radius: 6px; padding: 12px; margin-top: 16px;">
          <span style="font-size: 20px; flex-shrink: 0;">â ï¸</span>
          <div>
            <strong>Warning:</strong> Deleting a backup is permanent and cannot be undone.
          </div>
        </div>

        <div slot="footer" style="display: flex; justify-content: flex-end; gap: 8px;">
          <button class="btn" @click=${()=>this.cancelDelete()} ?disabled=${this.isDeleting}>
            Cancel
          </button>
          <button class="btn danger" @click=${()=>this.confirmDelete()} ?disabled=${this.isDeleting}>
            ${this.isDeleting?"Deletingâ¦":"Delete"}
          </button>
        </div>
      </modal-dialog>
    `:J``}renderRestoreModal(){return this.restoreTarget?J`
      <modal-dialog
        .center=${!0}
        .open=${this.showRestoreModal}
        .title=${"Restore backup"}
        size="medium"
        @modal-close=${()=>this.showRestoreModal=!1}
      >
        <div class="form-group">
          <label>New VM name</label>
          <input
            type="text"
            .value=${this.restoreNewName}
            @input=${e=>this.restoreNewName=e.target.value}
            ?disabled=${this.restoreOverwrite}
          />
          <div class="form-hint">Leave blank and enable overwrite to restore into existing VM.</div>
        </div>
        <div class="checkbox-group">
          <input
            type="checkbox"
            .checked=${this.restoreOverwrite}
            @change=${e=>this.restoreOverwrite=e.target.checked}
          />
          <div>
            <div>Overwrite existing VM</div>
            <div class="form-hint">Unchecked creates a new VM named above.</div>
          </div>
        </div>
        ${this.restoreTarget.encryption&&"none"!==this.restoreTarget.encryption?J`<div class="form-group">
              <label>Decryption key</label>
              <input
                type="password"
                .value=${this.restoreKey}
                @input=${e=>this.restoreKey=e.target.value}
              />
            </div>`:""}
        <div slot="footer" style="display:flex; justify-content:flex-end; gap:8px;">
          <button class="btn" @click=${()=>this.showRestoreModal=!1} ?disabled=${this.isRestoring}>Cancel</button>
          <button class="btn primary" @click=${()=>this.confirmRestore()} ?disabled=${this.isRestoring}>
            ${this.isRestoring?"Restoringâ¦":"Restore"}
          </button>
        </div>
      </modal-dialog>
    `:J``}};zw.styles=g`
    :host {
      display: block;
    }
    .section {
      border: 1px solid var(--vscode-border);
      border-radius: 12px;
      padding: 16px;
      background: var(--vscode-editor-background, #1e1e1e);
    }
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .section-title { font-size: 16px; margin: 0; }
    .section-actions { display: flex; gap: 8px; }
    .btn {
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid var(--vscode-button-border, #5a5a5a);
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      cursor: pointer;
      font-size: 13px;
    }
    .btn:hover { filter: brightness(1.05); }
    .btn.primary {
      background: var(--vscode-button-background, #0e639c);
      border-color: var(--vscode-button-border, #5a5a5a);
      color: var(--vscode-button-foreground, #ffffff);
    }
    .btn.danger {
      background: #a4262c;
      border-color: #a4262c;
      color: #ffffff;
    }
    .btn[disabled] { opacity: 0.6; cursor: not-allowed; }
    .table { width: 100%; border-collapse: collapse; }
    .table th, .table td { padding: 10px; border-bottom: 1px solid var(--vscode-border); text-align: left; font-size: 13px; }
    .table th { color: var(--vscode-descriptionForeground, #9ca3af); font-weight: 600; }
    .badge { padding: 2px 8px; border-radius: 999px; font-size: 12px; background: #1f2937; color: #e5e7eb; }
    .badge.success { background: #14532d; }
    .badge.error { background: #7f1d1d; }
    .badge.warning { background: #92400e; }
    .status-dot { display: inline-block; width: 8px; height: 8px; border-radius: 999px; margin-right: 6px; }
    .status-running { background: #22c55e; }
    .status-pending { background: #eab308; }
    .status-failed { background: #ef4444; }
    .status-completed { background: #10b981; }
    .empty-state { text-align: center; padding: 24px 0; color: var(--vscode-descriptionForeground, #9ca3af); }
    .error-box { border: 1px solid #7f1d1d; background: #1f0f0f; color: #fecdd3; padding: 12px; border-radius: 8px; margin-bottom: 12px; }
    .toast { margin-bottom: 10px; padding: 10px; border-radius: 8px; }
    .toast.success { background: #0f172a; color: #bbf7d0; border: 1px solid #14532d; }
    .toast.error { background: #1f0f0f; color: #fecdd3; border: 1px solid #7f1d1d; }

    /* Form controls aligned with snapshot modals */
    .form-group { margin-bottom: 14px; width: 100%; box-sizing: border-box; }
    .form-group.checkbox { display: flex; align-items: flex-start; gap: 12px; }
    .form-group.checkbox input[type="checkbox"] { width: auto; margin-top: 2px; }
    .form-group label { display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: var(--vscode-foreground, #cccccc); }
    .form-hint { margin-top: 6px; font-size: 12px; color: var(--vscode-descriptionForeground, #8b8b8b); }
    .form-error { margin-top: 6px; color: var(--vscode-errorForeground, #f48771); font-size: 12px; }
    input, select, textarea { width: 100%; padding: 8px 12px; background: var(--vscode-input-background, #3c3c3c); color: var(--vscode-input-foreground, #cccccc); border: 1px solid var(--vscode-input-border, #858585); border-radius: 4px; font-size: 13px; font-family: inherit; transition: all 0.2s; box-sizing: border-box; }
    input:focus, select:focus, textarea:focus { outline: none; border-color: var(--vscode-focusBorder, #007acc); box-shadow: 0 0 0 1px var(--vscode-focusBorder, #007acc); }
    .checkbox-group { display: flex; flex-direction: row; gap: 10px; align-items: center; margin-bottom: 10px; }
    .checkbox-group input[type="checkbox"] { width: auto; flex-shrink: 0; }
    .chip { display: inline-flex; align-items: center; gap: 6px; padding: 4px 8px; border-radius: 999px; background: #1f2937; color: #e5e7eb; font-size: 12px; }
    .small { font-size: 12px; color: #9ca3af; }

    /* Modal overlay styles */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      z-index: 9999;
      align-items: center;
      justify-content: center;
    }
    .modal-overlay.show {
      display: flex;
      animation: fadeIn 0.2s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .modal {
      background: var(--vscode-editor-background, #1e1e1e);
      border: 1px solid var(--vscode-border);
      border-radius: 8px;
      min-width: 400px;
      max-width: 600px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }
    .modal-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 20px;
      border-bottom: 1px solid var(--vscode-border);
    }
    .modal-icon { font-size: 24px; }
    .modal-title {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
      color: var(--vscode-foreground, #cccccc);
    }
    .modal-body { padding: 20px; }
    .modal-message {
      margin: 0 0 16px 0;
      color: var(--vscode-foreground, #cccccc);
      line-height: 1.5;
    }
    .vm-info-box {
      background: var(--vscode-input-background, #3c3c3c);
      border: 1px solid var(--vscode-border);
      border-radius: 6px;
      padding: 12px;
      margin: 16px 0;
    }
    .vm-info-row {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
    }
    .vm-info-label {
      color: var(--vscode-descriptionForeground, #9ca3af);
      font-size: 13px;
    }
    .vm-info-value {
      color: var(--vscode-foreground, #cccccc);
      font-size: 13px;
      font-weight: 500;
    }
    .vm-info-value.monospace {
      font-family: monospace;
      font-size: 12px;
    }
    .warning-box {
      display: flex;
      gap: 12px;
      background: rgba(234, 179, 8, 0.1);
      border: 1px solid rgba(234, 179, 8, 0.3);
      border-radius: 6px;
      padding: 12px;
      margin-top: 16px;
    }
    .warning-icon { font-size: 20px; flex-shrink: 0; }
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      padding: 16px 20px;
      border-top: 1px solid var(--vscode-border);
    }
    .modal-btn {
      padding: 8px 16px;
      border-radius: 4px;
      border: 1px solid var(--vscode-button-border, #5a5a5a);
      font-size: 13px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .modal-btn.cancel {
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-foreground, #ffffff);
    }
    .modal-btn.delete {
      background: #a4262c;
      border-color: #a4262c;
      color: #ffffff;
    }
    .modal-btn:hover:not(:disabled) { filter: brightness(1.1); }
    .modal-btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .spinner-small {
      width: 14px;
      height: 14px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }


  `,Fw([we({type:Object})],zw.prototype,"vm",2),Fw([xe()],zw.prototype,"backups",2),Fw([xe()],zw.prototype,"isLoading",2),Fw([xe()],zw.prototype,"error",2),Fw([xe()],zw.prototype,"toast",2),Fw([xe()],zw.prototype,"showCreateModal",2),Fw([xe()],zw.prototype,"showRestoreModal",2),Fw([xe()],zw.prototype,"restoreTarget",2),Fw([xe()],zw.prototype,"restoreNewName",2),Fw([xe()],zw.prototype,"restoreOverwrite",2),Fw([xe()],zw.prototype,"restoreKey",2),Fw([xe()],zw.prototype,"isCreating",2),Fw([xe()],zw.prototype,"isRestoring",2),Fw([xe()],zw.prototype,"showDeleteModal",2),Fw([xe()],zw.prototype,"deleteTarget",2),Fw([xe()],zw.prototype,"isDeleting",2),Fw([xe()],zw.prototype,"missingFiles",2),zw=Fw([ve("vm-backups-tab")],zw);var Uw=Object.defineProperty,Vw=Object.getOwnPropertyDescriptor,jw=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Vw(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Uw(t,s,r),r};let Hw=class extends me{constructor(){super(...arguments),this.show=!1,this.vm=null,this.activeTab="overview",this.isLoading=!1,this.metrics=null,this.disks=[],this.networkInterfaces=[],this.vmDetails=null,this.isPowerActionLoading=!1,this.showDeleteModal=!1,this.showCloneModal=!1,this.isCloning=!1,this.cloneName="",this.cloneStoragePool="",this.clonePools=[],this.isLoadingClonePools=!1,this.clonePoolsError=null,this.isDeleting=!1,this.isLoadingMetrics=!1,this.showConsole=!1,this.snapshots=[],this.snapshotsLoadedForVmId=null,this.isLoadingSnapshots=!1,this.showCreateSnapshotModal=!1,this.snapshotName="",this.snapshotDescription="",this.createIncludeMemory=!1,this.createQuiesce=!1,this.isCreatingSnapshot=!1,this.snapshotCapabilities=null,this.showSnapshotDetailModal=!1,this.isLoadingSnapshotDetail=!1,this.selectedSnapshot=null,this.snapshotDetail=null,this.showSnapshotActionModal=!1,this.snapshotActionMode="delete",this.snapshotActionName="",this.snapshotRevertFlags=1,this.isSnapshotActionLoading=!1,this.showStopDropdown=!1,this.metricsRefreshInterval=null,this.handleKeyDown=e=>{if(this.show&&"Escape"===e.key){if(this.showConsole)return void(this.showConsole=!1);if(this.showSnapshotActionModal)return void this.cancelSnapshotAction();if(this.showSnapshotDetailModal)return void this.closeSnapshotDetailModal();if(this.showCreateSnapshotModal)return void(this.showCreateSnapshotModal=!1);if(this.showDeleteModal)return void this.cancelDelete();this.handleClose()}},this.closeStopDropdown=()=>{this.showStopDropdown=!1,document.removeEventListener("click",this.closeStopDropdown)},this.handleConsoleClose=()=>{this.showConsole=!1}}connectedCallback(){super.connectedCallback(),this.vm&&this.loadVMDetails(),document.addEventListener("keydown",this.handleKeyDown)}disconnectedCallback(){super.disconnectedCallback(),this.stopMetricsRefresh(),document.removeEventListener("keydown",this.handleKeyDown)}updated(e){if(e.has("vm")){const t=e.get("vm");!this.vm||t&&t.id===this.vm.id||(this.loadVMDetails(),this.snapshots=[],this.snapshotCapabilities=null,this.snapshotsLoadedForVmId=null,this.showCreateSnapshotModal=!1,this.showSnapshotDetailModal=!1,this.selectedSnapshot=null,this.snapshotDetail=null,this.snapshotName="",this.snapshotDescription="",this.createIncludeMemory=!1,this.createQuiesce=!1,"snapshots"===this.activeTab&&this.show&&this.ensureSnapshotsLoaded())}e.has("activeTab")&&("metrics"===this.activeTab?this.startMetricsRefresh():this.stopMetricsRefresh(),"snapshots"===this.activeTab&&this.show&&this.ensureSnapshotsLoaded()),e.has("show")&&(this.show?"metrics"===this.activeTab&&this.startMetricsRefresh():this.stopMetricsRefresh(),this.show&&"snapshots"===this.activeTab&&this.ensureSnapshotsLoaded())}startMetricsRefresh(){"running"!==(this.vm?.state||this.vmDetails?.state)||this.metricsRefreshInterval||(this.vm&&(console.log("Starting metrics refresh for VM:",this.vm.id),this.fetchVMMetrics(this.vm.id)),this.metricsRefreshInterval=setInterval(()=>{this.vm&&"metrics"===this.activeTab&&this.show&&(console.log("Refreshing metrics for VM:",this.vm.id),this.fetchVMMetrics(this.vm.id))},5e3))}stopMetricsRefresh(){this.metricsRefreshInterval&&(console.log("Stopping metrics refresh"),clearInterval(this.metricsRefreshInterval),this.metricsRefreshInterval=null)}async loadVMDetails(){if(this.vm){this.isLoading=!0;try{const e=await this.fetchVMEnhancedDetails(this.vm.id);e&&(this.vmDetails=e,this.vm&&e.state&&(this.vm={...this.vm,state:e.state}),e.storage?.disks&&e.storage.disks.length>0?this.disks=e.storage.disks.map((e,t)=>({name:e.target||`disk${t}`,path:e.path||e.source_path||"Unknown",size:e.size||0,used:0,format:e.format||"raw",bus:e.bus||"virtio",readonly:e.readonly||!1,device:e.device||"disk"})):this.disks=[],e.networks&&e.networks.length>0?this.networkInterfaces=e.networks.map((e,t)=>({name:e.target?.dev||e.alias||`eth${t}`,type:e.type,source:e.source.network||e.source.bridge||e.source.dev||"Unknown",model:e.model.type||"virtio",mac:e.mac,ip:e.ip,state:"up",rx_bytes:0,tx_bytes:0})):this.networkInterfaces=[],"running"===this.vm.state||"running"===this.vmDetails?.state?await this.fetchVMMetrics(this.vm.id):this.metrics=null)}catch(e){console.error("Failed to load VM details:",e)}finally{this.isLoading=!1}}}async fetchVMMetrics(t){if(this.isLoadingMetrics)console.log("Already loading metrics, skipping...");else{this.isLoadingMetrics=!0;try{const s=o.getAuthHeaders();if(!s.Authorization)throw new Error("No authentication token found");const i=e(`/virtualization/computes/${t}/metrics`);console.log("Fetching VM metrics from:",i);const r=await fetch(i,{method:"GET",headers:{...s,"Content-Type":"application/json"}});if(!r.ok)return console.error(`Failed to fetch VM metrics: ${r.statusText}`),void(this.metrics=null);const a=await r.json();console.log("VM metrics response:",a),"success"===a.status&&a.data?(this.metrics=a.data,console.log("Metrics updated:",this.metrics)):(this.metrics=null,console.warn("No metrics data in response"))}catch(s){console.error("Error fetching VM metrics:",s),this.metrics=null}finally{this.isLoadingMetrics=!1}}}async fetchVMEnhancedDetails(t){try{const s=o.getAuthHeaders();if(!s.Authorization)throw new Error("No authentication token found");const i=e(`/virtualization/computes/${t}`),r=await fetch(i,{method:"GET",headers:{...s,"Content-Type":"application/json"}});if(!r.ok)throw new Error(`Failed to fetch VM details: ${r.statusText}`);const a=await r.json();if("success"===a.status&&a.data){if(a.data.vms&&Array.isArray(a.data.vms)&&a.data.vms.length>0)return a.data.vms[0];if(a.data.uuid)return a.data}return null}catch(s){throw console.error("Error fetching VM enhanced details:",s),s}}handleClose(){this.show=!1,this.dispatchEvent(new CustomEvent("close"))}toggleStopDropdown(e){e.stopPropagation(),this.showStopDropdown=!this.showStopDropdown,this.showStopDropdown&&setTimeout(()=>{document.addEventListener("click",this.closeStopDropdown)},0)}async handleStopAction(e){this.closeStopDropdown(),await this.handlePowerAction("stop",e)}renderStopButton(){return J`
      <div class="split-button-container">
        <button 
          class="split-button-main" 
          @click=${()=>this.handleStopAction(!1)}
          ?disabled=${this.isPowerActionLoading}
        >
          ${this.isPowerActionLoading?J`<span class="spinner-small"></span>`:"â¹ï¸"} Stop
        </button>
        <button 
          class="split-button-toggle"
          @click=${e=>this.toggleStopDropdown(e)}
          ?disabled=${this.isPowerActionLoading}
        >
          â¼
        </button>
        ${this.showStopDropdown?J`
          <div class="split-button-dropdown">
            <button @click=${()=>this.handleStopAction(!1)} ?disabled=${this.isPowerActionLoading}>
              â¹ï¸ Stop (Graceful)
            </button>
            <button class="danger" @click=${()=>this.handleStopAction(!0)} ?disabled=${this.isPowerActionLoading}>
              â¡ Force Stop
            </button>
          </div>
        `:""}
      </div>
    `}getExpectedStateAfterAction(e){switch(e){case"start":case"resume":case"restart":return"running";case"stop":return"stopped";case"pause":return"paused";default:return this.vm?.state||this.vmDetails?.state||"unknown"}}async handlePowerAction(e,t=!1){if(this.vm&&!this.isPowerActionLoading){this.isPowerActionLoading=!0;try{if(await this.executePowerAction(this.vm.id,e,t)){const t=this.getExpectedStateAfterAction(e);this.vmDetails&&(this.vmDetails={...this.vmDetails,state:t}),this.vm&&(this.vm={...this.vm,state:t}),this.requestUpdate(),this.dispatchEvent(new CustomEvent("power-action",{detail:{action:e,vm:this.vm,success:!0}})),this.showNotification(`${e.charAt(0).toUpperCase()+e.slice(1)} action initiated for ${this.vm?.name||"VM"}`,"success")}}catch(s){console.error(`Failed to execute power action ${e}:`,s);const t=s instanceof Error?s.message:`Failed to ${e} VM due to an unknown error`;this.showNotification(t,"error")}finally{this.isPowerActionLoading=!1}}}buildPowerActionErrorMessage(e,t,s){const i=`Failed to ${e} VM`,o=t?.error,r=o?.code||t?.code,a=o?.message||t?.message,n=o?.details||t?.details;let l;if("string"==typeof n){const e=n.match(/Message='(.+)'/);l=e?.[1]||n}const c=[];a&&c.push(a),l&&l!==a&&c.push(l),!c.length&&s&&c.push(s);let d=c.join(": ");return d||(d="Unknown error"),r?`${i}: [${r}] ${d}`:`${i}: ${d}`}async executePowerAction(t,s,i=!1){try{const r=o.getAuthHeaders();if(!r.Authorization)throw new Error("No authentication token found");const a=e(`/virtualization/computes/${t}/action`),n=await fetch(a,{method:"POST",headers:{...r,"Content-Type":"application/json"},body:JSON.stringify({action:s,force:i})});let l=null;try{l=await n.json()}catch{l=null}const c=l&&"object"==typeof l&&"status"in l&&"success"!==l.status;if(!n.ok||c){const e=this.buildPowerActionErrorMessage(s,l,n.statusText);throw new Error(e)}return!l||"object"!=typeof l||!("status"in l)||"success"===l.status}catch(r){throw r}}showNotification(e,t="info"){this.dispatchEvent(new CustomEvent("show-notification",{detail:{message:e,type:t},bubbles:!0,composed:!0}))}handleConsoleConnect(){"running"===(this.vm?.state||this.vmDetails?.state)?this.showConsole=!0:this.showNotification("Console is only available when VM is running","warning")}openCloneModal(){this.handleCloneVM()}handleCloneVM(){this.vm&&(this.cloneName=`${this.vm.name}-clone`,this.cloneStoragePool="",this.showCloneModal=!0,this.loadClonePools())}async loadClonePools(){this.isLoadingClonePools=!0,this.clonePoolsError=null,this.clonePools=[];try{const t=o.getToken();if(!t)throw new Error("Not authenticated");const s=e("/virtualization/storages/pools?state=all&page_size=100"),i=await fetch(s,{method:"GET",headers:{Authorization:`Bearer ${t}`}});let r=null;try{r=await i.json()}catch{r=null}const a=r&&"object"==typeof r&&"status"in r&&"success"!==r.status;if(!i.ok||a){const e=r?.error?.details||r?.error?.message||i.statusText||"Failed to load storage pools";throw new Error(e)}const n=r?.data?.pools??r?.pools;if(!Array.isArray(n))throw new Error("Invalid storage pools response");const l=n.map(e=>({name:"string"==typeof e?.name?e.name:"",state:"string"==typeof e?.state?e.state:void 0,type:"string"==typeof e?.type?e.type:void 0})).filter(e=>e.name);l.sort((e,t)=>e.name.localeCompare(t.name)),this.clonePools=l}catch(t){console.error("Failed to load storage pools:",t),this.clonePoolsError=t?.message||"Failed to load storage pools"}finally{this.isLoadingClonePools=!1}}async confirmCloneVM(){if(!this.vm||this.isCloning)return;const t=this.cloneName.trim();if(t){this.isCloning=!0;try{const s=e(`/virtualization/computes/${encodeURIComponent(this.vm.id)}/clone`),i=o.getToken();if(!i)throw new Error("Not authenticated");const r={name:t,full_clone:!0,snapshots:!1},a=this.cloneStoragePool.trim();a&&(r.storage_pool=a);const n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(r)});let l=null;try{l=await n.json()}catch{l=null}const c=l&&"object"==typeof l&&"status"in l&&"success"!==l.status;if(!n.ok||c){const e=l?.error?.details||l?.error?.message||("string"==typeof l?.message?l.message:null)||n.statusText||"Clone failed";throw new Error(e)}this.showNotification(`VM cloned as "${t}"`,"success"),this.showCloneModal=!1,this.dispatchEvent(new CustomEvent("vm-cloned",{detail:{source:this.vm,cloned:l?.data??null},bubbles:!0,composed:!0}))}catch(s){console.error("Failed to clone VM:",s),this.showNotification(s?.message||"Failed to clone VM","error")}finally{this.isCloning=!1}}else this.showNotification("Clone name is required","error")}renderCloneModal(){return this.showCloneModal?J`
      <modal-dialog
        .open=${this.showCloneModal}
        .title=${"Clone Virtual Machine"}
        size="medium"
        @modal-close=${()=>{this.isCloning||(this.showCloneModal=!1)}}
      >
        <div class="form-group">
          <label for="clone-name">New VM Name <span class="required">*</span></label>
          <input
            id="clone-name"
            type="text"
            .value=${this.cloneName}
            @input=${e=>this.cloneName=e.target.value}
            placeholder="e.g. my-vm-clone"
            ?disabled=${this.isCloning}
          />
          <div class="form-hint">A full clone will be created (linked clone is not supported yet).</div>
        </div>

        <div class="form-group">
          <label for="clone-pool">Target Storage Pool (optional)</label>
          <select
            id="clone-pool"
            .value=${this.cloneStoragePool}
            @change=${e=>this.cloneStoragePool=e.target.value}
            ?disabled=${this.isCloning||this.isLoadingClonePools}
          >
            <option value="">Keep source disk pools</option>
            ${this.clonePools.map(e=>J`<option value=${e.name}>${e.name}${e.state?" ("+e.state+")":""}</option>`)}
          </select>
          ${this.isLoadingClonePools?J`<div class="form-hint">Loading storage poolsâ¦</div>`:this.clonePoolsError?J`<div class="form-error">${this.clonePoolsError}</div>`:J`<div class="form-hint">If empty, Vapor will try to clone each disk into its original pool.</div>`}
        </div>

        <div slot="footer" style="display:flex; justify-content:flex-end; gap:8px;">
          <button
            class="btn btn-secondary"
            @click=${()=>this.showCloneModal=!1}
            ?disabled=${this.isCloning}
          >
            Cancel
          </button>
          <button
            class="btn btn-primary"
            @click=${this.confirmCloneVM}
            ?disabled=${this.isCloning||!this.cloneName.trim()}
          >
            ${this.isCloning?"Cloningâ¦":"Clone VM"}
          </button>
        </div>
      </modal-dialog>
    `:J``}handleSnapshot(){this.activeTab="snapshots",this.ensureSnapshotsLoaded(),this.openSnapshotModal()}openSnapshotModal(){const e=this.vm?.state||this.vmDetails?.state,t="running"===e?.toLowerCase(),s=this.snapshotCapabilities?.supports_snapshots??!1,i=this.snapshotCapabilities?.supports_memory??!1,o=this.snapshotCapabilities?.supports_internal??!1,r=t&&s&&i&&o;this.createIncludeMemory=r,this.showCreateSnapshotModal=!0}handleDeleteVM(){"running"!==(this.vm?.state||this.vmDetails?.state)?this.showDeleteModal=!0:this.showNotification("Cannot delete a running VM. Please stop it first.","error")}cancelDelete(){this.showDeleteModal=!1,this.isDeleting=!1}async confirmDelete(){if(this.vm&&!this.isDeleting){this.isDeleting=!0;try{await this.executeDeleteVM(this.vm.id)&&(this.showNotification(`VM "${this.vm.name}" has been deleted successfully`,"success"),this.showDeleteModal=!1,this.dispatchEvent(new CustomEvent("vm-deleted",{detail:{vm:this.vm},bubbles:!0,composed:!0})),setTimeout(()=>{this.handleClose()},1e3))}catch(e){console.error("Failed to delete VM:",e),this.showNotification(`Failed to delete VM: ${e instanceof Error?e.message:"Unknown error"}`,"error")}finally{this.isDeleting=!1}}}async executeDeleteVM(t){try{const s=o.getAuthHeaders();if(!s.Authorization)throw new Error("No authentication token found");const i=e(`/virtualization/computes/${t}`),r=await fetch(i,{method:"DELETE",headers:{...s,"Content-Type":"application/json"}});if(!r.ok){const e=await r.json().catch(()=>null);throw new Error(e?.message||e?.error||`Failed to delete VM: ${r.statusText}`)}return"success"===(await r.json().catch(()=>({status:"success"}))).status||r.ok}catch(s){throw console.error("Error deleting VM:",s),s}}formatBytes(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,t)).toFixed(1)} ${["B","KB","MB","GB","TB"][t]}`}formatMemory(e){return e>=1048576?`${(e/1048576).toFixed(1)} GB`:e>=1024?`${(e/1024).toFixed(0)} MB`:`${e} KB`}getProgressClass(e){return e>80?"high":e>50?"medium":"low"}renderOverviewTab(){if(!this.vm)return J``;const e=this.vmDetails||this.vm,t=this.vmDetails?.os||{type:void 0,architecture:void 0,machine:void 0};return J`
      <div class="section">
        <h3 class="section-title">System Information</h3>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">VM UUID</span>
            <span class="info-value monospace">${this.vmDetails?.uuid||this.vm.id}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Name</span>
            <span class="info-value">${e.name}</span>
          </div>
          <div class="info-item">
            <span class="info-label">State</span>
            <span class="info-value">${this.vm.state||this.vmDetails?.state}</span>
          </div>
          <div class="info-item">
            <span class="info-label">OS Type</span>
            <span class="info-value">${t.type||this.vm.os_type||"hvm"}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Architecture</span>
            <span class="info-value">${t.architecture||this.vm.metadata?.architecture||"x86_64"}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Machine Type</span>
            <span class="info-value">${t.machine||"Default"}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Persistent</span>
            <span class="info-value">${this.vmDetails?.persistent?"Yes":"No"}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Autostart</span>
            <span class="info-value">${this.vmDetails?.autostart?"Enabled":"Disabled"}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Created</span>
            <span class="info-value">${new Date(this.vmDetails?.created_at||this.vm.created_at||Date.now()).toLocaleString()}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Last Updated</span>
            <span class="info-value">${new Date(this.vmDetails?.updated_at||this.vm.updated_at||Date.now()).toLocaleString()}</span>
          </div>
        </div>
      </div>

      <div class="section">
        <h3 class="section-title">Resource Allocation</h3>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Current Memory</span>
            <span class="info-value">${this.formatMemory(this.vmDetails?.memory||this.vm.memory)}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Max Memory</span>
            <span class="info-value">${this.formatMemory(this.vmDetails?.max_memory||this.vm.memory)}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Current vCPUs</span>
            <span class="info-value">${this.vmDetails?.vcpus||this.vm.vcpus} cores</span>
          </div>
          <div class="info-item">
            <span class="info-label">Max vCPUs</span>
            <span class="info-value">${(this.vmDetails?.max_vcpus||0)>0?this.vmDetails?.max_vcpus:this.vmDetails?.vcpus||this.vm.vcpus} cores</span>
          </div>
          ${this.vm.disk_size?J`
            <div class="info-item">
              <span class="info-label">Total Disk Size</span>
              <span class="info-value">${this.formatBytes(1024*this.vm.disk_size*1024*1024)}</span>
            </div>
          `:""}
        </div>
      </div>

      ${this.vm.graphics&&Array.isArray(this.vm.graphics)?J`
        <div class="section">
          <h3 class="section-title">Graphics Configuration</h3>
          <div class="info-grid">
            ${this.vm.graphics.map(e=>J`
              <div class="info-item">
                <span class="info-label">Type</span>
                <span class="info-value">${e.type?.toUpperCase()}</span>
              </div>
              ${e.port?J`
                <div class="info-item">
                  <span class="info-label">Port</span>
                  <span class="info-value">${e.port}</span>
                </div>
              `:""}
              ${e.listen?J`
                <div class="info-item">
                  <span class="info-label">Listen Address</span>
                  <span class="info-value monospace">${e.listen}</span>
                </div>
              `:""}
            `)}
          </div>
        </div>
      `:""}
    `}renderMetricsTab(){const e=this.vmDetails?.state||this.vm?.state,t=e?e.charAt(0).toUpperCase()+e.slice(1):"Unknown";if("running"!==e)return J`
        <div class="empty-state">
          <div class="empty-state-icon">ð</div>
          <div class="empty-state-message">
            Metrics are only available when the VM is running.
            <br>
            Current state: ${t}
          </div>
        </div>
      `;if(!this.metrics&&this.isLoadingMetrics)return J`
        <div class="loading">
          <div class="spinner"></div>
          Loading metrics...
        </div>
      `;if(!this.metrics)return J`
        <div class="empty-state">
          <div class="empty-state-icon">â ï¸</div>
          <div class="empty-state-message">
            Unable to load metrics. Please ensure the VM is running and try refreshing.
          </div>
        </div>
      `;const s=this.vmDetails?.memory||this.vm?.memory||0,i=1024*s*1024,o=i>0?this.metrics.memory_used/i*100:0;return console.log("Memory calculation:",{memory_used_bytes:this.metrics.memory_used,memory_used_formatted:this.formatBytes(this.metrics.memory_used),vm_memory_mb:s,vm_memory_bytes:i,vm_memory_formatted:this.formatMemory(1024*s),usage_percent:o,api_memory_usage_field:this.metrics.memory_usage}),J`
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-header">
            <span class="metric-title">CPU Usage</span>
            <span class="metric-icon">ð»</span>
          </div>
          <div>
            <span class="metric-value">${this.metrics.cpu_usage.toFixed(1)}</span>
            <span class="metric-unit">%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill ${this.getProgressClass(this.metrics.cpu_usage)}" 
                 style="width: ${Math.min(this.metrics.cpu_usage,100)}%"></div>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <span class="metric-title">Memory Usage</span>
            <span class="metric-icon">ð§ </span>
          </div>
          <div>
            <span class="metric-value">${o.toFixed(1)}</span>
            <span class="metric-unit">%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill ${this.getProgressClass(o)}" 
                 style="width: ${Math.min(o,100)}%"></div>
          </div>
          <div style="font-size: 11px; color: var(--vscode-descriptionForeground, #8b8b8b); margin-top: 4px;">
            ${this.formatBytes(this.metrics.memory_used)} of ${this.formatMemory(1024*s)} used
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <span class="metric-title">Disk Read</span>
            <span class="metric-icon">ð</span>
          </div>
          <div>
            <span class="metric-value">${this.formatBytes(this.metrics.disk_read)}</span>
          </div>
          <div style="font-size: 11px; color: var(--vscode-descriptionForeground, #8b8b8b); margin-top: 4px;">
            Total bytes read
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <span class="metric-title">Disk Write</span>
            <span class="metric-icon">âï¸</span>
          </div>
          <div>
            <span class="metric-value">${this.formatBytes(this.metrics.disk_write)}</span>
          </div>
          <div style="font-size: 11px; color: var(--vscode-descriptionForeground, #8b8b8b); margin-top: 4px;">
            Total bytes written
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <span class="metric-title">Network RX</span>
            <span class="metric-icon">ð¥</span>
          </div>
          <div>
            <span class="metric-value">${this.formatBytes(this.metrics.network_rx)}</span>
          </div>
          <div style="font-size: 11px; color: var(--vscode-descriptionForeground, #8b8b8b); margin-top: 4px;">
            Total received
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <span class="metric-title">Network TX</span>
            <span class="metric-icon">ð¤</span>
          </div>
          <div>
            <span class="metric-value">${this.formatBytes(this.metrics.network_tx)}</span>
          </div>
          <div style="font-size: 11px; color: var(--vscode-descriptionForeground, #8b8b8b); margin-top: 4px;">
            Total transmitted
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <span class="metric-title">CPU Time</span>
            <span class="metric-icon">â±ï¸</span>
          </div>
          <div>
            <span class="metric-value">${(this.metrics.cpu_time/1e9).toFixed(1)}</span>
            <span class="metric-unit">s</span>
          </div>
          <div style="font-size: 11px; color: var(--vscode-descriptionForeground, #8b8b8b); margin-top: 4px;">
            Total CPU time used
          </div>
        </div>
      </div>

      <div class="section">
        <h3 class="section-title">Performance History</h3>
        <div class="empty-state">
          <div class="empty-state-icon">ð</div>
          <div class="empty-state-message">Performance graphs will be available in a future update</div>
        </div>
      </div>
    `}renderStorageTab(){const e=this.disks&&this.disks.length>0;return J`
      <div class="section">
        <h3 class="section-title">Storage Devices</h3>
        ${e?J`
          <table class="data-table">
            <thead>
              <tr>
                <th>Target</th>
                <th>Type</th>
                <th>Path</th>
                <th>Format</th>
                <th>Bus</th>
                <th>Size</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              ${this.disks.map(e=>J`
                <tr>
                  <td><span class="monospace">${e.name}</span></td>
                  <td>
                    <span class="badge ${"cdrom"===e.device?"warning":""}">
                      ${e.device?.toUpperCase()||"DISK"}
                    </span>
                  </td>
                  <td>
                    <span class="monospace" style="font-size: 11px; word-break: break-all;">
                      ${e.path}
                    </span>
                  </td>
                  <td>${e.format.toUpperCase()}</td>
                  <td>${e.bus.toUpperCase()}</td>
                  <td>${e.size>0?this.formatBytes(e.size):"N/A"}</td>
                  <td>
                    <span class="badge ${e.readonly?"warning":"success"}">
                      ${e.readonly?"Read-Only":"Read/Write"}
                    </span>
                  </td>
                </tr>
              `)}
            </tbody>
          </table>
        `:J`
          <div class="empty-state">
            <div class="empty-state-icon">ð¾</div>
            <div class="empty-state-message">No storage devices attached</div>
          </div>
        `}
      </div>
      
      ${this.vmDetails?.storage?J`
        <div class="section">
          <h3 class="section-title">Storage Configuration</h3>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Default Pool</span>
              <span class="info-value">${this.vmDetails.storage.default_pool}</span>
            </div>
            ${this.vmDetails.storage.boot_iso?J`
              <div class="info-item">
                <span class="info-label">Boot ISO</span>
                <span class="info-value monospace">${this.vmDetails.storage.boot_iso}</span>
              </div>
            `:""}
          </div>
        </div>
      `:""}

      ${this.vm?.disks?J`
        <div class="section">
          <h3 class="section-title">Disk Configuration</h3>
          <div class="info-grid">
            ${this.vm.disks.map(e=>J`
              <div class="info-item">
                <span class="info-label">Target: ${e.target}</span>
                <span class="info-value monospace">${e.source?.file||e.source?.dev||"N/A"}</span>
              </div>
            `)}
          </div>
        </div>
      `:""}
    `}renderNetworkTab(){return J`
      <div class="section">
        <h3 class="section-title">Network Interfaces</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th>Interface</th>
              <th>Type</th>
              <th>Source</th>
              <th>Model</th>
              <th>MAC Address</th>
              <th>IP Address</th>
              <th>State</th>
              <th>Traffic</th>
            </tr>
          </thead>
          <tbody>
            ${this.networkInterfaces.map(e=>J`
              <tr>
                <td><span class="monospace">${e.name}</span></td>
                <td>${e.type}</td>
                <td>${e.source}</td>
                <td>${e.model.toUpperCase()}</td>
                <td><span class="monospace">${e.mac}</span></td>
                <td><span class="monospace">${e.ip||"N/A"}</span></td>
                <td>
                  <span class="badge ${"up"===e.state?"success":"error"}">
                    ${e.state.toUpperCase()}
                  </span>
                </td>
                <td>
                  â ${this.formatBytes(e.rx_bytes)} / â ${this.formatBytes(e.tx_bytes)}
                </td>
              </tr>
            `)}
          </tbody>
        </table>
      </div>

      ${this.vm?.network_interfaces?J`
        <div class="section">
          <h3 class="section-title">Network Configuration</h3>
          <div class="info-grid">
            ${this.vm.network_interfaces.map(e=>J`
              <div class="info-item">
                <span class="info-label">Type: ${e.type}</span>
                <span class="info-value">${e.source?.network||e.source?.bridge||"N/A"}</span>
              </div>
            `)}
          </div>
        </div>
      `:""}
    `}ensureSnapshotsLoaded(){this.vm&&(this.isLoadingSnapshots||this.snapshotsLoadedForVmId!==this.vm.id&&this.loadSnapshots())}async loadSnapshots(){if(this.vm){this.isLoadingSnapshots=!0;try{const[e,t]=await Promise.all([Iw.list(this.vm.id),Iw.getCapabilities(this.vm.id)]);this.snapshots=e,this.snapshotCapabilities=t,this.snapshotsLoadedForVmId=this.vm.id}catch(e){console.error("Failed to load snapshots:",e),this.snapshots=[],this.snapshotCapabilities=null,this.showNotification(e?.message||"Failed to load snapshots","error")}finally{this.isLoadingSnapshots=!1}}}getSnapshotNameError(e){const t=e.trim();return t?t.length>64?"Snapshot name must be 64 characters or less.":/^[A-Za-z0-9._-]+$/.test(t)?null:"Use only letters, numbers, dot (.), underscore (_), or hyphen (-).":"Snapshot name is required."}async handleCreateSnapshot(){if(!this.vm)return;const e=this.getSnapshotNameError(this.snapshotName);if(e)return void this.showNotification(e,"error");const t=this.snapshotCapabilities?.supports_snapshots;if(!1===t)return void this.showNotification("Snapshots are not supported for this VM/host.","warning");const s=!!this.snapshotCapabilities?.supports_memory&&this.createIncludeMemory;this.isCreatingSnapshot=!0;try{const e=await Iw.create(this.vm.id,{name:this.snapshotName.trim(),description:this.snapshotDescription.trim()||void 0,include_memory:s,quiesce:this.createQuiesce});this.showCreateSnapshotModal=!1,this.snapshotName="",this.snapshotDescription="",this.createIncludeMemory=!1,this.createQuiesce=!1,this.snapshotsLoadedForVmId=null,await this.loadSnapshots();const t=e?.warnings;t?.length?this.showNotification(`Snapshot created with warnings: ${t[0]}${t.length>1?` (+${t.length-1} more)`:""}`,"warning"):this.showNotification("Snapshot created successfully","success")}catch(i){this.showNotification(i?.message||"Failed to create snapshot","error")}finally{this.isCreatingSnapshot=!1}}openSnapshotDetail(e){this.selectedSnapshot=e,this.snapshotDetail=null,this.showSnapshotDetailModal=!0,this.loadSnapshotDetail(e.name)}closeSnapshotDetailModal(){this.showSnapshotDetailModal=!1,this.isLoadingSnapshotDetail=!1,this.selectedSnapshot=null,this.snapshotDetail=null}requestSnapshotAction(e,t){this.snapshotActionMode=e,this.snapshotActionName=t,this.snapshotRevertFlags=1,this.showSnapshotActionModal=!0,this.isSnapshotActionLoading=!1}cancelSnapshotAction(){this.showSnapshotActionModal=!1,this.isSnapshotActionLoading=!1,this.snapshotActionName=""}async confirmSnapshotAction(){if(!this.vm)return;if(!this.snapshotActionName)return;if(this.isSnapshotActionLoading)return;this.isSnapshotActionLoading=!0;const e=this.snapshotActionName,t=this.snapshotActionMode;try{"revert"===t?(await Iw.revert(this.vm.id,e,this.snapshotRevertFlags),this.showNotification(`Reverted to snapshot "${e}"`,"success"),await this.loadVMDetails(),this.vm&&this.dispatchEvent(new CustomEvent("power-action",{detail:{action:"revert",vm:this.vm,success:!0},bubbles:!0,composed:!0}))):(await Iw.delete(this.vm.id,e),this.snapshotsLoadedForVmId=null,await this.loadSnapshots(),this.selectedSnapshot?.name===e&&this.closeSnapshotDetailModal(),this.showNotification(`Snapshot "${e}" deleted`,"success")),this.showSnapshotActionModal=!1,this.snapshotActionName=""}catch(s){this.showNotification(s?.message||`Failed to ${t} snapshot`,"error")}finally{this.isSnapshotActionLoading=!1}}renderSnapshotActionModal(){if(!this.showSnapshotActionModal)return J``;const e=this.snapshotActionMode,t=this.snapshotActionName,s="delete"===e?"Delete":"Revert";return J`
      <div class="modal-overlay show">
        <div class="modal" @click=${e=>e.stopPropagation()}>
          <div class="modal-header">
            <span class="modal-icon">${"delete"===e?"ðï¸":"â©ï¸"}</span>
            <h3 class="modal-title">${"delete"===e?"Delete Snapshot":"Revert to Snapshot"}</h3>
          </div>

          <div class="modal-body">
            <p class="modal-message">
              ${"delete"===e?J`Are you sure you want to delete this snapshot? This action cannot be undone.`:J`Are you sure you want to revert to this snapshot? This will discard all changes since the snapshot was taken.`}
            </p>

            <div class="vm-info-box">
              <div class="vm-info-row">
                <span class="vm-info-label">VM:</span>
                <span class="vm-info-value">${this.vm?.name}</span>
              </div>
              <div class="vm-info-row">
                <span class="vm-info-label">Snapshot:</span>
                <span class="vm-info-value monospace">${t}</span>
              </div>
            </div>

            <div class="warning-box">
              <span class="warning-icon">â ï¸</span>
              <div>
                <strong>Warning:</strong>
                ${"delete"===e?J`Deleting a snapshot is permanent.`:J`Reverting will overwrite the current VM state.`}
              </div>
            </div>

            ${"revert"===e?J`
                  <div class="form-group" style="margin-top: 16px;">
                    <label for="revert-behavior">Revert Behavior</label>
                    <select
                      id="revert-behavior"
                      .value=${String(this.snapshotRevertFlags)}
                      @change=${e=>this.snapshotRevertFlags=Number(e.target.value)}
                      ?disabled=${this.isSnapshotActionLoading}
                    >
                      <option value="1">Keep running (default) - Running VMs stay running</option>
                      <option value="0">Default libvirt behavior - May restart the VM</option>
                      <option value="2">Paused - VM paused after revert</option>
                    </select>
                    <div class="form-hint">
                      Choose how the VM should behave after reverting to the snapshot.
                    </div>
                  </div>
                `:""}
          </div>

          <div class="modal-footer">
            <button
              class="modal-btn cancel"
              @click=${this.cancelSnapshotAction}
              ?disabled=${this.isSnapshotActionLoading}
            >
              Cancel
            </button>
            <button
              class="modal-btn ${"delete"===e?"delete":"primary"}"
              @click=${this.confirmSnapshotAction}
              ?disabled=${this.isSnapshotActionLoading}
            >
              ${this.isSnapshotActionLoading?J`<span class="spinner-small"></span> ${"delete"===e?"Deletingâ¦":"Revertingâ¦"}`:J`${s}`}
            </button>
          </div>
        </div>
      </div>
    `}async loadSnapshotDetail(e){if(this.vm){this.isLoadingSnapshotDetail=!0;try{const t=await Iw.getDetail(this.vm.id,e);this.snapshotDetail=t}catch(t){console.error("Failed to load snapshot detail:",t),this.showNotification(t?.message||"Failed to load snapshot detail","error")}finally{this.isLoadingSnapshotDetail=!1}}}async handleRevertSnapshot(e){this.requestSnapshotAction("revert",e)}async handleDeleteSnapshot(e){this.requestSnapshotAction("delete",e)}formatSnapshotDate(e){if(!e)return"Unknown";try{return new Date(e).toLocaleString()}catch{return e}}renderCreateSnapshotModal(){if(!this.showCreateSnapshotModal)return J``;const e=this.getSnapshotNameError(this.snapshotName),t=this.snapshotCapabilities?.supports_snapshots,s=this.snapshotCapabilities?.supports_memory;return J`
      <modal-dialog
        .open=${this.showCreateSnapshotModal}
        .title=${"Create Snapshot"}
        size="medium"
        @modal-close=${()=>this.showCreateSnapshotModal=!1}
      >
        ${!1===t?J`<div class="warning-box"><strong>Snapshots are not supported on this VM/host.</strong></div>`:""}

        <div class="form-group">
          <label for="snapshot-name">Snapshot Name <span class="required">*</span></label>
          <input
            type="text"
            id="snapshot-name"
            .value=${this.snapshotName}
            @input=${e=>this.snapshotName=e.target.value}
            placeholder="e.g. before-upgrade"
            ?disabled=${this.isCreatingSnapshot}
          />
          ${e?J`<div class="form-error">${e}</div>`:J`<div class="form-hint">Allowed: letters, numbers, . _ -</div>`}
        </div>

        <div class="form-group">
          <label for="snapshot-desc">Description (optional)</label>
          <textarea
            id="snapshot-desc"
            .value=${this.snapshotDescription}
            @input=${e=>this.snapshotDescription=e.target.value}
            placeholder="What is this snapshot for?"
            rows="3"
            ?disabled=${this.isCreatingSnapshot}
          ></textarea>
        </div>

        <div class="checkbox-group">
          <input
            type="checkbox"
            .checked=${this.createIncludeMemory}
            @change=${e=>this.createIncludeMemory=e.target.checked}
            ?disabled=${this.isCreatingSnapshot||!1===s}
          />
          <div>
            <div style="display:flex; gap:8px; align-items:center;">
              <span>Include memory</span>
              ${!1===s?J`<span class="badge warning">Unsupported</span>`:""}
            </div>
            <div class="form-hint">Includes the VM RAM state in the snapshot when supported.</div>
          </div>
        </div>

        <div class="checkbox-group">
          <input
            type="checkbox"
            .checked=${this.createQuiesce}
            @change=${e=>this.createQuiesce=e.target.checked}
            ?disabled=${this.isCreatingSnapshot}
          />
          <div>
            <div>Quiesce filesystem</div>
            <div class="form-hint">May require the QEMU guest agent inside the VM.</div>
          </div>
        </div>

        ${this.snapshotCapabilities?.warnings?.length?J`
              <div class="warning-box">
                <strong>Warnings</strong>
                <ul>
                  ${this.snapshotCapabilities.warnings.map(e=>J`<li>${e}</li>`)}
                </ul>
              </div>
            `:""}

        ${this.snapshotCapabilities?.recommendations?.length?J`
              <div class="info-box">
                <strong>Recommendations</strong>
                <ul>
                  ${this.snapshotCapabilities.recommendations.map(e=>J`<li>${e}</li>`)}
                </ul>
              </div>
            `:""}

        <div slot="footer" style="display:flex; justify-content:flex-end; gap:8px;">
          <button
            class="btn btn-secondary"
            @click=${()=>this.showCreateSnapshotModal=!1}
            ?disabled=${this.isCreatingSnapshot}
          >
            Cancel
          </button>
          <button
            class="btn btn-primary"
            @click=${this.handleCreateSnapshot}
            ?disabled=${this.isCreatingSnapshot||!!e||!1===t}
          >
            ${this.isCreatingSnapshot?"Creatingâ¦":"Create Snapshot"}
          </button>
        </div>
      </modal-dialog>
    `}renderSnapshotDetailModal(){if(!this.showSnapshotDetailModal)return J``;const e=this.selectedSnapshot,t=this.snapshotDetail,s=t&&e?{...e,...t}:t||e;return J`
      <modal-dialog
        .open=${this.showSnapshotDetailModal}
        .title=${"Snapshot Details"}
        size="medium"
        @modal-close=${this.closeSnapshotDetailModal}
      >
        ${this.isLoadingSnapshotDetail?J`
              <div class="loading-state">
                <span class="spinner"></span>
                <span>Loading snapshot details...</span>
              </div>
            `:""}

        ${s?J`
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">Name</span>
                  <span class="info-value monospace">${s.name}</span>
                </div>

                <div class="info-item">
                  <span class="info-label">Created</span>
                  <span class="info-value">${this.formatSnapshotDate(s.created_at||s.creation_time||"")}</span>
                </div>

                ${s.type?J`
                      <div class="info-item">
                        <span class="info-label">Type</span>
                        <span class="info-value">${s.type}</span>
                      </div>
                    `:""}

                ${"boolean"==typeof s.memory?J`
                      <div class="info-item">
                        <span class="info-label">Memory</span>
                        <span class="info-value">${s.memory?"Included":"Not included"}</span>
                      </div>
                    `:""}

                ${s.parent?J`
                      <div class="info-item">
                        <span class="info-label">Parent</span>
                        <span class="info-value monospace">${s.parent}</span>
                      </div>
                    `:""}

                ${s.disk_formats?.length?J`
                      <div class="info-item">
                        <span class="info-label">Disk formats</span>
                        <span class="info-value">${s.disk_formats.join(", ")}</span>
                      </div>
                    `:""}

                ${s.description?J`
                      <div class="info-item" style="grid-column: 1 / -1;">
                        <span class="info-label">Description</span>
                        <span class="info-value">${s.description}</span>
                      </div>
                    `:""}
              </div>

              ${s.warnings?.length?J`
                    <div class="warning-box" style="margin-top: 12px;">
                      <strong>Warnings</strong>
                      <ul>
                        ${s.warnings.map(e=>J`<li>${e}</li>`)}
                      </ul>
                    </div>
                  `:""}
            `:J`<div class="empty-state-message">No snapshot selected</div>`}

        <div slot="footer" style="display:flex; justify-content:flex-end; gap:8px;">
          <button class="btn btn-secondary" @click=${this.closeSnapshotDetailModal}>Close</button>
          ${s?J`
                <button
                  class="btn btn-secondary"
                  @click=${()=>this.handleRevertSnapshot(s.name)}
                  ?disabled=${this.isLoadingSnapshotDetail}
                >
                  â©ï¸ Revert
                </button>
                <button
                  class="btn btn-danger"
                  @click=${()=>this.handleDeleteSnapshot(s.name)}
                  ?disabled=${this.isLoadingSnapshotDetail}
                >
                  ðï¸ Delete
                </button>
              `:""}
        </div>
      </modal-dialog>
    `}renderSnapshotsTab(){const e=this.snapshotCapabilities?.supports_snapshots;return J`
      <div class="section">
        <div class="section-header">
          <h3 class="section-title">Snapshots</h3>
          <div class="section-actions">
            <button
              class="btn btn-secondary btn-sm"
              @click=${()=>{this.snapshotsLoadedForVmId=null,this.loadSnapshots()}}
              ?disabled=${this.isLoadingSnapshots||!this.vm}
              title="Refresh"
            >
              â» Refresh
            </button>
            <button
              class="btn btn-primary btn-sm"
              @click=${this.openSnapshotModal}
              ?disabled=${this.isLoadingSnapshots||!1===e}
            >
              + Create Snapshot
            </button>
          </div>
        </div>

        ${this.isLoadingSnapshots?J`
              <div class="loading-state">
                <span class="spinner"></span>
                <span>Loading snapshots...</span>
              </div>
            `:!1===e?J`
                <div class="empty-state">
                  <div class="empty-state-icon">ð¸</div>
                  <div class="empty-state-message">Snapshots are not supported</div>
                  <div class="empty-state-hint">This host/VM does not support libvirt snapshots.</div>
                </div>
              `:0===this.snapshots.length?J`
                  <div class="empty-state">
                    <div class="empty-state-icon">ð¸</div>
                    <div class="empty-state-message">No snapshots available</div>
                    <div class="empty-state-hint">Create a snapshot to save the current state of this VM</div>
                  </div>
                `:J`
                  <div class="snapshot-list">
                    ${this.snapshots.map(e=>J`
                        <div class="snapshot-item" @click=${()=>this.openSnapshotDetail(e)}>
                          <div class="snapshot-info">
                            <div class="snapshot-name">
                              ${e.name}
                              ${e.warnings?.length?J`<span class="badge warning">Warnings</span>`:""}
                              ${e.type?J`<span class="badge">${e.type}</span>`:""}
                              ${e.memory?J`<span class="badge success">Memory</span>`:""}
                            </div>
                            <div class="snapshot-meta">
                              ${e.description?J`<span class="snapshot-desc">${e.description}</span>`:""}
                              <span class="snapshot-date">Created: ${this.formatSnapshotDate(e.created_at||e.creation_time||"")}</span>
                              ${e.parent?J`<span class="snapshot-parent">Parent: ${e.parent}</span>`:""}
                              ${e.disk_formats?.length?J`<span class="snapshot-disks">Disks: ${e.disk_formats.join(", ")}</span>`:""}
                            </div>
                          </div>
                          <div class="snapshot-actions">
                            <button
                              class="btn btn-sm btn-secondary"
                              @click=${t=>{t.stopPropagation(),this.handleRevertSnapshot(e.name)}}
                              title="Revert to this snapshot"
                            >
                              â©ï¸ Revert
                            </button>
                            <button
                              class="btn btn-sm btn-danger"
                              @click=${t=>{t.stopPropagation(),this.handleDeleteSnapshot(e.name)}}
                              title="Delete this snapshot"
                            >
                              ðï¸ Delete
                            </button>
                          </div>
                        </div>
                      `)}
                  </div>
                `}
      </div>
    `}render(){if(!this.vm)return J``;const e=(this.vm.state||this.vmDetails?.state||"unknown").toLowerCase().replace("shutoff","stopped"),t=e,s=e.charAt(0).toUpperCase()+e.slice(1),i="running"===e,o="paused"===e;return J`
      <div class="drawer">
        <div class="drawer-header">
          <div class="header-content">
            <div class="vm-icon">ð¥ï¸</div>
            <div class="vm-info">
              <h2 class="vm-name">${this.vm.name}</h2>
              <div class="vm-meta">
                <span class="power-state ${t}">
                  <span class="power-state-indicator"></span>
                  ${s}
                </span>
                <span>${this.vm.memory} MB RAM</span>
                <span>${this.vm.vcpus} vCPUs</span>
                <span>${this.vm.os_type}</span>
              </div>
            </div>
          </div>
          <button class="close-btn" @click=${this.handleClose} aria-label="Close">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>

        <div class="quick-actions">
          ${i?J`
            ${this.renderStopButton()}
            <button 
              class="action-btn" 
              @click=${()=>this.handlePowerAction("restart")}
              ?disabled=${this.isPowerActionLoading}
            >
              ${this.isPowerActionLoading?J`<span class="spinner-small"></span>`:"ð"} Restart
            </button>
            <button 
              class="action-btn" 
              @click=${()=>this.handlePowerAction("pause")}
              ?disabled=${this.isPowerActionLoading}
            >
              ${this.isPowerActionLoading?J`<span class="spinner-small"></span>`:"â¸ï¸"} Pause
            </button>
          `:o?J`
            <button 
              class="action-btn primary" 
              @click=${()=>this.handlePowerAction("resume")}
              ?disabled=${this.isPowerActionLoading}
            >
              ${this.isPowerActionLoading?J`<span class="spinner-small"></span>`:"â¶ï¸"} Resume
            </button>
            <button 
              class="action-btn" 
              @click=${()=>this.handlePowerAction("stop")}
              ?disabled=${this.isPowerActionLoading}
            >
              ${this.isPowerActionLoading?J`<span class="spinner-small"></span>`:"â¹ï¸"} Stop
            </button>
          `:J`
            <button 
              class="action-btn primary" 
              @click=${()=>this.handlePowerAction("start")}
              ?disabled=${this.isPowerActionLoading}
            >
              ${this.isPowerActionLoading?J`<span class="spinner-small"></span>`:"â¶ï¸"} Start
            </button>
          `}
          <button 
            class="action-btn" 
            @click=${this.handleConsoleConnect}
            ?disabled=${!i}
          >
            ð» Console
          </button>
          <button 
            class="action-btn" 
            @click=${()=>this.handleCloneVM()}
            ?disabled=${this.isPowerActionLoading}
          >
            ð Clone
          </button>
          <button 
            class="action-btn" 
            @click=${()=>this.handleSnapshot()}
            ?disabled=${this.isPowerActionLoading}
          >
            ð¸ Snapshot
          </button>
          <button 
            class="action-btn danger" 
            @click=${()=>this.handleDeleteVM()}
            ?disabled=${this.isPowerActionLoading}
          >
            ðï¸ Delete
          </button>
        </div>

        <div class="tabs">
          <button class="tab ${"overview"===this.activeTab?"active":""}" 
                  @click=${()=>this.activeTab="overview"}>
            Overview
          </button>
          <button class="tab ${"metrics"===this.activeTab?"active":""}" 
                  @click=${()=>this.activeTab="metrics"}>
            Metrics
          </button>
          <button class="tab ${"storage"===this.activeTab?"active":""}" 
                  @click=${()=>this.activeTab="storage"}>
            Storage
          </button>
          <button class="tab ${"network"===this.activeTab?"active":""}" 
                  @click=${()=>this.activeTab="network"}>
            Network
          </button>
          <button class="tab ${"snapshots"===this.activeTab?"active":""}" 
                  @click=${()=>this.activeTab="snapshots"}>
            Snapshots
          </button>
          <button class="tab ${"backups"===this.activeTab?"active":""}" 
                  @click=${()=>this.activeTab="backups"}>
            Backups
          </button>
        </div>

        <div class="drawer-content">
          ${this.isLoading?J`
            <div class="loading">
              <div class="spinner"></div>
              Loading VM details...
            </div>
          `:J`
            ${"overview"===this.activeTab?this.renderOverviewTab():"metrics"===this.activeTab?this.renderMetricsTab():"storage"===this.activeTab?this.renderStorageTab():"network"===this.activeTab?this.renderNetworkTab():"snapshots"===this.activeTab?this.renderSnapshotsTab():"backups"===this.activeTab?J`<vm-backups-tab .vm=${this.vm}></vm-backups-tab>`:J``}
          `}
        </div>
      </div>
      
      ${this.renderCreateSnapshotModal()}
      ${this.renderSnapshotDetailModal()}
      ${this.renderSnapshotActionModal()}
      ${this.renderCloneModal()}

      <!-- Delete Confirmation Modal -->
      <div class="modal-overlay ${this.showDeleteModal?"show":""}">
        <div class="modal">
          <div class="modal-header">
            <span class="modal-icon">â ï¸</span>
            <h3 class="modal-title">Delete Virtual Machine</h3>
          </div>
          
          <div class="modal-body">
            <p class="modal-message">
              Are you sure you want to permanently delete this virtual machine?
            </p>
            
            <div class="vm-info-box">
              <div class="vm-info-row">
                <span class="vm-info-label">Name:</span>
                <span class="vm-info-value">${this.vm.name}</span>
              </div>
              <div class="vm-info-row">
                <span class="vm-info-label">UUID:</span>
                <span class="vm-info-value" style="font-family: monospace; font-size: 12px;">
                  ${this.vmDetails?.uuid||this.vm.id}
                </span>
              </div>
              <div class="vm-info-row">
                <span class="vm-info-label">State:</span>
                <span class="vm-info-value">${s}</span>
              </div>
              <div class="vm-info-row">
                <span class="vm-info-label">Resources:</span>
                <span class="vm-info-value">
                  ${this.formatMemory(this.vmDetails?.memory||this.vm.memory)} RAM, 
                  ${this.vmDetails?.vcpus||this.vm.vcpus} vCPUs
                </span>
              </div>
            </div>
            
            <div class="warning-box">
              <span class="warning-icon">â ï¸</span>
              <div>
                <strong>Warning:</strong> This action cannot be undone. All data associated with this VM, 
                including disks and snapshots, will be permanently deleted.
              </div>
            </div>
          </div>
          
          <div class="modal-footer">
            <button 
              class="modal-btn cancel" 
              @click=${this.cancelDelete}
              ?disabled=${this.isDeleting}
            >
              Cancel
            </button>
            <button 
              class="modal-btn delete" 
              @click=${this.confirmDelete}
              ?disabled=${this.isDeleting}
            >
              ${this.isDeleting?J`
                <span class="spinner-small"></span>
                Deleting...
              `:J`
                ðï¸ Delete VM
              `}
            </button>
          </div>
        </div>
      </div>
      
      <!-- VM Console -->
      ${this.showConsole&&this.vm?J`
        <vm-console
          .vmId=${this.vm.id}
          .vmName=${this.vm.name}
          .show=${this.showConsole}
          @close=${this.handleConsoleClose}
        ></vm-console>
      `:""}
    `}};Hw.styles=g`
    :host {
      display: block;
      position: fixed;
      top: 0;
      right: 0;
      width: 60%;
      height: 100vh;
      z-index: 1000;
      pointer-events: none;
    }

    :host([show]) {
      pointer-events: auto;
    }

    .drawer {
      width: 100%;
      height: 100%;
      background: var(--vscode-editor-background, #1e1e1e);
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      transform: translateX(100%);
      transition: transform 0.3s ease-out;
      border-left: 1px solid var(--vscode-border);
    }

    :host([show]) .drawer {
      transform: translateX(0);
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0.8;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0.8;
      }
    }

    :host(:not([show])) .drawer {
      animation: slideOut 0.3s ease-in;
    }

    @media (max-width: 1200px) {
      :host {
        width: 80%;
      }
    }

    @media (max-width: 768px) {
      :host {
        width: 100%;
      }
    }

    .drawer-header {
      padding: 20px 24px;
      background: var(--vscode-bg-lighter, #2d2d30);
      border-bottom: 1px solid var(--vscode-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }

    .header-content {
      display: flex;
      align-items: center;
      gap: 16px;
      flex: 1;
    }

    .vm-icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      border-radius: 8px;
      font-size: 20px;
    }

    .vm-info {
      flex: 1;
    }

    .vm-name {
      font-size: 18px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
      margin: 0 0 4px 0;
    }

    .vm-meta {
      display: flex;
      gap: 16px;
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #8b8b8b);
    }

    .close-btn {
      background: transparent;
      border: none;
      color: var(--vscode-foreground, #cccccc);
      cursor: pointer;
      padding: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .close-btn:hover {
      background: var(--vscode-toolbar-hoverBackground, rgba(90, 93, 94, 0.31));
      color: var(--vscode-icon-foreground, #c5c5c5);
    }

    /* Power State Badge */
    .power-state {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .power-state.running {
      background: var(--vscode-charts-green, #89d185);
      color: var(--vscode-editor-background, #1e1e1e);
    }

    .power-state.stopped {
      background: var(--vscode-charts-red, #f48771);
      color: var(--vscode-editor-background, #1e1e1e);
    }

    .power-state.paused {
      background: var(--vscode-charts-yellow, #cca700);
      color: var(--vscode-editor-background, #1e1e1e);
    }

    .power-state.suspended {
      background: var(--vscode-charts-orange, #ce9178);
      color: var(--vscode-editor-background, #1e1e1e);
    }

    .power-state-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: currentColor;
      animation: pulse 2s infinite;
    }

    .power-state.running .power-state-indicator {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 0;
      padding: 0 24px;
      background: var(--vscode-editor-background, #1e1e1e);
      border-bottom: 1px solid var(--vscode-border);
      flex-shrink: 0;
    }

    .tab {
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: var(--vscode-foreground, #cccccc);
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
      position: relative;
    }

    .tab:hover {
      background: var(--vscode-toolbar-hoverBackground, rgba(90, 93, 94, 0.1));
    }

    .tab.active {
      color: var(--vscode-textLink-foreground, #3794ff);
      border-bottom-color: var(--vscode-focusBorder, #007acc);
    }

    /* Content Area */
    .drawer-content {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }

    /* Quick Actions Bar */
    .quick-actions {
      padding: 16px 24px;
      background: var(--vscode-bg-lighter, #2d2d30);
      border-bottom: 1px solid var(--vscode-border);
      display: flex;
      gap: 12px;
      flex-shrink: 0;
    }

    .action-btn {
      padding: 8px 16px;
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border: 1px solid var(--vscode-button-border, #5a5a5a);
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .action-btn:hover:not(:disabled) {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
    }

    .action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .action-btn.primary {
      background: var(--vscode-button-background, #0e639c);
      color: var(--vscode-button-foreground, #ffffff);
      border-color: var(--vscode-button-background, #0e639c);
    }

    .action-btn.primary:hover:not(:disabled) {
      background: var(--vscode-button-hoverBackground, #1177bb);
      border-color: var(--vscode-button-hoverBackground, #1177bb);
    }

    .action-btn.danger {
      background: var(--vscode-inputValidation-errorBackground, #5a1d1d);
      color: var(--vscode-inputValidation-errorForeground, #f48771);
      border-color: var(--vscode-inputValidation-errorBorder, #be1100);
    }

    .action-btn.danger:hover:not(:disabled) {
      background: var(--vscode-inputValidation-errorBorder, #be1100);
    }

    /* Split Button for Stop action */
    .split-button-container {
      position: relative;
      display: inline-flex;
    }

    .split-button-main {
      padding: 8px 12px;
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border: 1px solid var(--vscode-button-border, #5a5a5a);
      border-radius: 4px 0 0 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
      border-right: none;
    }

    .split-button-main:hover:not(:disabled) {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
    }

    .split-button-main:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .split-button-toggle {
      padding: 8px 6px;
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border: 1px solid var(--vscode-button-border, #5a5a5a);
      border-radius: 0 4px 4px 0;
      cursor: pointer;
      font-size: 10px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
    }

    .split-button-toggle:hover:not(:disabled) {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
    }

    .split-button-toggle:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .split-button-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 4px;
      background: var(--vscode-menu-background, var(--vscode-editorWidget-background, #252526));
      border: 1px solid var(--vscode-menu-border, #464647);
      border-radius: 4px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
      min-width: 140px;
      z-index: 1000;
      overflow: hidden;
    }

    .split-button-dropdown button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 8px 12px;
      border: none;
      background: none;
      color: var(--vscode-foreground, #cccccc);
      cursor: pointer;
      font-size: 13px;
      transition: background 0.15s;
    }

    .split-button-dropdown button:hover:not(:disabled) {
      background: var(--vscode-list-hoverBackground, rgba(90, 93, 94, 0.31));
    }

    .split-button-dropdown button.danger {
      color: var(--vscode-inputValidation-errorForeground, #f48771);
    }

    .split-button-dropdown button.danger:hover:not(:disabled) {
      background: var(--vscode-inputValidation-errorBackground, rgba(255, 0, 0, 0.1));
    }

    .split-button-dropdown button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }


    /* Sections */
    .section {
      margin-bottom: 32px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--vscode-foreground, #cccccc);
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--vscode-border);
    }

    /* Info Grid */
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .info-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .info-label {
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #8b8b8b);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .info-value {
      font-size: 14px;
      color: var(--vscode-foreground, #cccccc);
      font-weight: 400;
    }

    .info-value.monospace {
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 13px;
    }

    /* Metrics Cards */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .metric-card {
      background: var(--vscode-bg-lighter, #2d2d30);
      border: 1px solid var(--vscode-border);
      border-radius: 6px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .metric-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .metric-title {
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #8b8b8b);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .metric-icon {
      font-size: 16px;
      opacity: 0.6;
    }

    .metric-value {
      font-size: 24px;
      font-weight: 600;
      color: var(--vscode-foreground, #cccccc);
    }

    .metric-unit {
      font-size: 14px;
      font-weight: 400;
      color: var(--vscode-descriptionForeground, #8b8b8b);
      margin-left: 4px;
    }

    .metric-change {
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .metric-change.positive {
      color: var(--vscode-charts-green, #89d185);
    }

    .metric-change.negative {
      color: var(--vscode-charts-red, #f48771);
    }

    /* Progress Bars */
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--vscode-progressBar-background, #1e1e1e);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 8px;
    }

    .progress-fill {
      height: 100%;
      background: var(--vscode-progressBar-foreground, #0e639c);
      transition: width 0.3s ease;
      border-radius: 4px;
    }

    .progress-fill.high {
      background: var(--vscode-charts-red, #f48771);
    }

    .progress-fill.medium {
      background: var(--vscode-charts-yellow, #cca700);
    }

    .progress-fill.low {
      background: var(--vscode-charts-green, #89d185);
    }

    /* Tables */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .data-table th {
      text-align: left;
      padding: 8px 12px;
      background: var(--vscode-bg-lighter, #2d2d30);
      color: var(--vscode-foreground, #cccccc);
      font-weight: 600;
      border-bottom: 1px solid var(--vscode-border);
    }

    .data-table td {
      padding: 10px 12px;
      color: var(--vscode-foreground, #cccccc);
      border-bottom: 1px solid var(--vscode-border);
    }

    .data-table tr:hover {
      background: var(--vscode-list-hoverBackground, rgba(90, 93, 94, 0.1));
    }

    /* Badges */
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 3px;
      font-size: 11px;
      font-weight: 500;
      background: var(--vscode-badge-background, #4d4d4d);
      color: var(--vscode-badge-foreground, #ffffff);
    }

    .badge.success {
      background: var(--vscode-charts-green, #89d185);
      color: var(--vscode-editor-background, #1e1e1e);
    }

    .badge.warning {
      background: var(--vscode-charts-yellow, #cca700);
      color: var(--vscode-editor-background, #1e1e1e);
    }

    .badge.error {
      background: var(--vscode-charts-red, #f48771);
      color: var(--vscode-editor-background, #1e1e1e);
    }

    /* Loading State */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      color: var(--vscode-descriptionForeground, #8b8b8b);
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 2px solid var(--vscode-widget-border, #454545);
      border-top-color: var(--vscode-focusBorder, #007acc);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 12px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    
    /* Small spinner for buttons */
    .spinner-small {
      display: inline-block;
      width: 12px;
      height: 12px;
      border: 2px solid var(--vscode-widget-border, #454545);
      border-top-color: var(--vscode-foreground, #cccccc);
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }

    /* Empty State */
    .empty-state {
      padding: 60px 20px;
      text-align: center;
      color: var(--vscode-descriptionForeground, #8b8b8b);
    }

    .empty-state-icon {
      font-size: 48px;
      opacity: 0.5;
      margin-bottom: 16px;
    }

    .empty-state-message {
      font-size: 14px;
    }

    /* Console Preview */
    .console-preview {
      background: #000;
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      padding: 16px;
      min-height: 200px;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 12px;
      color: #00ff00;
      position: relative;
    }

    .console-connect-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      padding: 4px 12px;
      background: var(--vscode-button-background, #0e639c);
      color: var(--vscode-button-foreground, #ffffff);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }

    .console-connect-btn:hover {
      background: var(--vscode-button-hoverBackground, #1177bb);
    }
    
    /* Delete Confirmation Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      align-items: flex-start;
      justify-content: center;
      padding-top: 80px;
    }
    
    .modal-overlay.show {
      display: flex;
      animation: fadeIn 0.2s ease-out;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    
    .modal {
      background: var(--vscode-editor-background, #1e1e1e);
      border: 1px solid var(--vscode-border);
      border-radius: 8px;
      padding: 24px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.2s ease-out;
    }
    
    @keyframes slideUp {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    .modal-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .modal-icon {
      font-size: 24px;
    }
    
    .modal-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--vscode-foreground, #cccccc);
      margin: 0;
    }
    
    .modal-body {
      margin-bottom: 24px;
    }
    
    .modal-message {
      color: var(--vscode-foreground, #cccccc);
      line-height: 1.5;
      margin-bottom: 16px;
    }
    
    .warning-box {
      background: var(--vscode-inputValidation-warningBackground, #5a5012);
      border: 1px solid var(--vscode-inputValidation-warningBorder, #b89500);
      border-radius: 4px;
      padding: 12px;
      color: var(--vscode-inputValidation-warningForeground, #cca700);
      font-size: 13px;
      display: flex;
      align-items: start;
      gap: 8px;
    }
    
    .warning-icon {
      flex-shrink: 0;
      margin-top: 2px;
    }
    
    .vm-info-box {
      background: var(--vscode-bg-lighter, #2d2d30);
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      padding: 12px;
      margin: 16px 0;
    }
    
    .vm-info-row {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
      font-size: 13px;
    }
    
    .vm-info-label {
      color: var(--vscode-descriptionForeground, #8b8b8b);
    }
    
    .vm-info-value {
      color: var(--vscode-foreground, #cccccc);
      font-weight: 500;
    }
    
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }
    
    .modal-btn {
      padding: 8px 16px;
      border-radius: 4px;
      border: 1px solid;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    
    .modal-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .modal-btn.cancel {
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border-color: var(--vscode-button-border, #5a5a5a);
    }
    
    .modal-btn.cancel:hover:not(:disabled) {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
    }
    
    .modal-btn.delete {
      background: var(--vscode-inputValidation-errorBackground, #5a1d1d);
      color: var(--vscode-inputValidation-errorForeground, #f48771);
      border-color: var(--vscode-inputValidation-errorBorder, #be1100);
    }
    
    .modal-btn.delete:hover:not(:disabled) {
      background: var(--vscode-inputValidation-errorBorder, #be1100);
    }

    .modal-btn.primary {
      background: var(--vscode-button-background, #0e639c);
      color: var(--vscode-button-foreground, #ffffff);
      border-color: var(--vscode-button-background, #0e639c);
    }

    .modal-btn.primary:hover:not(:disabled) {
      background: var(--vscode-button-hoverBackground, #1177bb);
      border-color: var(--vscode-button-hoverBackground, #1177bb);
    }

    /* Snapshot styles */
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .btn-sm {
      padding: 4px 12px;
      font-size: 12px;
    }

    .btn-danger {
      background: var(--vscode-inputValidation-errorBackground, rgba(190, 17, 0, 0.2));
      border-color: var(--vscode-inputValidation-errorBorder, #be1100);
      color: var(--vscode-inputValidation-errorForeground, #ff6b6b);
    }

    .btn-danger:hover:not(:disabled) {
      background: var(--vscode-inputValidation-errorBorder, #be1100);
      color: white;
    }

    .snapshot-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .snapshot-item {
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: var(--vscode-editor-background, #1e1e1e);
      border: 1px solid var(--vscode-border);
      border-radius: 6px;
    }

    .snapshot-item:hover {
      border-color: var(--vscode-focusBorder, #007fd4);
    }

    .snapshot-info {
      flex: 1;
    }

    .snapshot-name {
      font-weight: 600;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .snapshot-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #858585);
    }

    .snapshot-desc {
      font-style: italic;
    }

    .snapshot-actions {
      display: flex;
      gap: 8px;
    }

    .loading-state {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 24px;
      color: var(--vscode-descriptionForeground, #858585);
    }

    .empty-state-hint {
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #858585);
      margin-top: 8px;
    }

    .warning-box {
      background: var(--vscode-inputValidation-warningBackground, rgba(255, 204, 0, 0.1));
      border: 1px solid var(--vscode-inputValidation-warningBorder, #cca700);
      border-radius: 4px;
      padding: 12px;
      margin-top: 12px;
      font-size: 13px;
    }

    .warning-box ul {
      margin: 8px 0 0 0;
      padding-left: 20px;
    }

    .warning-box li {
      margin: 4px 0;
    }

    .section-actions {
      display: inline-flex;
      gap: 8px;
      align-items: center;
    }

    /* Generic buttons used in snapshot UI */
    .btn {
      padding: 8px 16px;
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border: 1px solid var(--vscode-button-border, #5a5a5a);
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn:hover:not(:disabled) {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-primary {
      background: var(--vscode-button-background, #0e639c);
      color: var(--vscode-button-foreground, #ffffff);
      border-color: var(--vscode-button-background, #0e639c);
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--vscode-button-hoverBackground, #1177bb);
      border-color: var(--vscode-button-hoverBackground, #1177bb);
    }

    .btn-secondary {
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border-color: var(--vscode-button-border, #5a5a5a);
    }

    /* Form controls (snapshot modals) */
    .form-group {
      margin-bottom: 20px;
      width: 100%;
      box-sizing: border-box;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 13px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
    }

    .required {
      color: var(--vscode-errorForeground, #f48771);
    }

    input,
    select,
    textarea {
      width: 100%;
      max-width: 100%;
      padding: 8px 12px;
      background: var(--vscode-input-background, #3c3c3c);
      color: var(--vscode-input-foreground, #cccccc);
      border: 1px solid var(--vscode-input-border, #858585);
      border-radius: 4px;
      font-size: 13px;
      font-family: inherit;
      transition: all 0.2s;
      box-sizing: border-box;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--vscode-focusBorder, #007acc);
      box-shadow: 0 0 0 1px var(--vscode-focusBorder, #007acc);
    }

    .form-hint {
      margin-top: 6px;
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #8b8b8b);
    }

    .form-error {
      margin-top: 6px;
      font-size: 12px;
      color: var(--vscode-inputValidation-errorForeground, #f48771);
    }

    .checkbox-group {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 12px;
    }

    input[type="checkbox"] {
      width: auto;
      margin: 2px 0 0 0;
    }

    .info-box {
      background: var(--vscode-editor-inactiveSelectionBackground, rgba(37, 37, 38, 0.9));
      border: 1px solid var(--vscode-widget-border, #454545);
      border-radius: 4px;
      padding: 12px;
      margin-top: 12px;
      font-size: 13px;
      color: var(--vscode-foreground, #cccccc);
    }

    .info-box ul {
      margin: 8px 0 0 0;
      padding-left: 20px;
    }

    .info-box li {
      margin: 4px 0;
    }

  `,jw([we({type:Boolean,reflect:!0})],Hw.prototype,"show",2),jw([we({type:Object})],Hw.prototype,"vm",2),jw([xe()],Hw.prototype,"activeTab",2),jw([xe()],Hw.prototype,"isLoading",2),jw([xe()],Hw.prototype,"metrics",2),jw([xe()],Hw.prototype,"disks",2),jw([xe()],Hw.prototype,"networkInterfaces",2),jw([xe()],Hw.prototype,"vmDetails",2),jw([xe()],Hw.prototype,"isPowerActionLoading",2),jw([xe()],Hw.prototype,"showDeleteModal",2),jw([xe()],Hw.prototype,"showCloneModal",2),jw([xe()],Hw.prototype,"isCloning",2),jw([xe()],Hw.prototype,"cloneName",2),jw([xe()],Hw.prototype,"cloneStoragePool",2),jw([xe()],Hw.prototype,"clonePools",2),jw([xe()],Hw.prototype,"isLoadingClonePools",2),jw([xe()],Hw.prototype,"clonePoolsError",2),jw([xe()],Hw.prototype,"isDeleting",2),jw([xe()],Hw.prototype,"isLoadingMetrics",2),jw([xe()],Hw.prototype,"showConsole",2),jw([xe()],Hw.prototype,"snapshots",2),jw([xe()],Hw.prototype,"snapshotsLoadedForVmId",2),jw([xe()],Hw.prototype,"isLoadingSnapshots",2),jw([xe()],Hw.prototype,"showCreateSnapshotModal",2),jw([xe()],Hw.prototype,"snapshotName",2),jw([xe()],Hw.prototype,"snapshotDescription",2),jw([xe()],Hw.prototype,"createIncludeMemory",2),jw([xe()],Hw.prototype,"createQuiesce",2),jw([xe()],Hw.prototype,"isCreatingSnapshot",2),jw([xe()],Hw.prototype,"snapshotCapabilities",2),jw([xe()],Hw.prototype,"showSnapshotDetailModal",2),jw([xe()],Hw.prototype,"isLoadingSnapshotDetail",2),jw([xe()],Hw.prototype,"selectedSnapshot",2),jw([xe()],Hw.prototype,"snapshotDetail",2),jw([xe()],Hw.prototype,"showSnapshotActionModal",2),jw([xe()],Hw.prototype,"snapshotActionMode",2),jw([xe()],Hw.prototype,"snapshotActionName",2),jw([xe()],Hw.prototype,"snapshotRevertFlags",2),jw([xe()],Hw.prototype,"isSnapshotActionLoading",2),jw([xe()],Hw.prototype,"showStopDropdown",2),Hw=jw([ve("vm-detail-drawer")],Hw);var Ww=Object.defineProperty,qw=Object.getOwnPropertyDescriptor,Kw=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?qw(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Ww(t,s,r),r};let Gw=class extends me{constructor(){super(...arguments),this.wizardController=new Zl.StoreController(this,Xy),this.storagePoolsController=new Zl.StoreController(this,yw),this.isosController=new Zl.StoreController(this,_w),this.isCreating=!1,this.validationErrors={},this.showAdvancedOptions=!1}connectedCallback(){super.connectedCallback(),this.loadData()}async loadData(){try{await Promise.all([By.fetch(),Uy.fetch()])}catch(e){console.error("Failed to load data for VM wizard:",e)}}handleClose(){this.isCreating||Dw.closeWizard()}handlePrevious(){Dw.previousStep()}handleNext(){const e=this.wizardController.value;this.validateStep(e.currentStep)&&Dw.nextStep()}validateStep(e){const t=this.wizardController.value,{formData:s}=t,i={};switch(e){case 1:s.name?/^[a-zA-Z0-9-_]+$/.test(s.name)||(i.name="VM name can only contain letters, numbers, hyphens, and underscores"):i.name="VM name is required",(!s.memory||s.memory<512)&&(i.memory="Memory must be at least 512 MB"),(!s.vcpus||s.vcpus<1)&&(i.vcpus="At least 1 vCPU is required");break;case 2:s.storage?.default_pool||(i.storage_pool="Storage pool is required"),s.storage?.disks?.length||(i.disks="At least one disk is required")}return this.validationErrors=i,0===Object.keys(i).length}async handleCreate(){const e=this.wizardController.value;if(this.validateAllSteps()){this.isCreating=!0;try{(await Cw.create(e.formData)).success?(this.showNotification("Virtual machine created successfully","success"),Dw.closeWizard()):this.showNotification("Failed to create virtual machine","error")}catch(t){console.error("Failed to create VM:",t),this.showNotification(t instanceof Error?t.message:"Failed to create virtual machine","error")}finally{this.isCreating=!1}}}validateAllSteps(){for(let e=1;e<=3;e++)if(!this.validateStep(e))return!1;return!0}updateFormData(e,t){const s=this.wizardController.value,i={};if(e.includes(".")){const[o,r]=e.split(".");o&&r&&(i[o]={...s.formData[o],[r]:t})}else i[e]=t;if(Dw.updateFormData(i),this.validationErrors[e]){const t={...this.validationErrors};delete t[e],this.validationErrors=t}}addDisk(){const e=this.wizardController.value,t=e.formData.storage?.disks||[];Dw.updateFormData({storage:{...e.formData.storage,disks:[...t,{action:"create",size:20,format:"qcow2",bus:"virtio"}],default_pool:e.formData.storage?.default_pool||"",boot_iso:e.formData.storage?.boot_iso}})}removeDisk(e){const t=this.wizardController.value,s=t.formData.storage?.disks||[];Dw.updateFormData({storage:{...t.formData.storage,disks:s.filter((t,s)=>s!==e),default_pool:t.formData.storage?.default_pool||"",boot_iso:t.formData.storage?.boot_iso}})}updateDisk(e,t,s){const i=this.wizardController.value,o=[...i.formData.storage?.disks||[]];o[e]={...o[e],[t]:s},Dw.updateFormData({storage:{...i.formData.storage,disks:o,default_pool:i.formData.storage?.default_pool||"",boot_iso:i.formData.storage?.boot_iso}})}showNotification(e,t="info"){this.dispatchEvent(new CustomEvent("show-notification",{detail:{message:e,type:t},bubbles:!0,composed:!0}))}renderBasicConfig(){const e=this.wizardController.value,{formData:t}=e;return J`
      <div>
        <div class="form-group ${this.validationErrors.name?"error":""}">
          <label>
            VM Name <span class="required">*</span>
          </label>
          <input
            type="text"
            placeholder="my-virtual-machine"
            .value=${t.name||""}
            @input=${e=>this.updateFormData("name",e.target.value)}
          />
          ${this.validationErrors.name?J`
            <div class="error-message">${this.validationErrors.name}</div>
          `:J`
            <div class="help-text">
              Alphanumeric characters, hyphens, and underscores only
            </div>
          `}
        </div>

        <div class="form-group">
          <label>Description</label>
          <textarea
            rows="3"
            placeholder="Optional description for this virtual machine"
            .value=${t.description||""}
            @input=${e=>this.updateFormData("description",e.target.value)}
          ></textarea>
        </div>

        <div class="grid-2">
          <div class="form-group ${this.validationErrors.memory?"error":""}">
            <label>
              Memory <span class="required">*</span>
            </label>
            <div class="memory-input-group">
              <input
                type="number"
                min="512"
                max="32768"
                step="512"
                placeholder="2048"
                .value=${String(t.memory||2048)}
                @input=${e=>this.updateFormData("memory",Number(e.target.value))}
              />
              <span class="memory-unit">MB</span>
            </div>
            ${this.validationErrors.memory?J`
              <div class="error-message">${this.validationErrors.memory}</div>
            `:J`
              <div class="help-text">Minimum 512 MB, Maximum 32768 MB</div>
            `}
          </div>

          <div class="form-group ${this.validationErrors.vcpus?"error":""}">
            <label>
              vCPUs <span class="required">*</span>
            </label>
            <select
              .value=${String(t.vcpus||2)}
              @change=${e=>this.updateFormData("vcpus",Number(e.target.value))}
            >
              ${[1,2,4,6,8,12,16,24,32].map(e=>J`
                <option value=${e}>${e}</option>
              `)}
            </select>
            ${this.validationErrors.vcpus?J`
              <div class="error-message">${this.validationErrors.vcpus}</div>
            `:""}
          </div>
        </div>

        <div class="form-group">
          <label>Operating System Type</label>
          <select
            .value=${t.os_type||"linux"}
            @change=${e=>this.updateFormData("os_type",e.target.value)}
          >
            <option value="linux">Linux</option>
            <option value="windows">Windows</option>
            <option value="freebsd">FreeBSD</option>
            <option value="other">Other</option>
          </select>
        </div>
      </div>
    `}renderStorageConfig(){const e=this.wizardController.value,{formData:t}=e,s=this.storagePoolsController.value,i=this.isosController.value,o=t.storage?.disks||[];return J`
      <div>
        <div class="form-group ${this.validationErrors.storage_pool?"error":""}">
          <label>
            Storage Pool <span class="required">*</span>
          </label>
          <select
            .value=${t.storage?.default_pool||""}
            @change=${e=>this.updateFormData("storage.default_pool",e.target.value)}
          >
            <option value="">Select a storage pool</option>
            ${s.map(e=>J`
              <option value=${e.name}>
                ${e.name} (${this.formatBytes(e.available)} available)
              </option>
            `)}
          </select>
          ${this.validationErrors.storage_pool?J`
            <div class="error-message">${this.validationErrors.storage_pool}</div>
          `:""}
        </div>

        <div class="form-group">
          <label>Boot ISO (Optional)</label>
          <select
            .value=${t.storage?.boot_iso||""}
            @change=${e=>this.updateFormData("storage.boot_iso",e.target.value)}
          >
            <option value="">No ISO (network boot or existing disk)</option>
            ${i.map(e=>J`
              <option value=${e.id}>
                ${e.name} (${this.formatBytes(e.size)})
              </option>
            `)}
          </select>
          <div class="help-text">
            Select an ISO image to boot from during installation
          </div>
        </div>

        <div class="form-group ${this.validationErrors.disks?"error":""}">
          <label>
            Disks <span class="required">*</span>
          </label>
          <div class="disk-list">
            ${0===o.length?J`
              <div class="help-text">No disks configured. Add at least one disk.</div>
            `:o.map((e,t)=>J`
              <div class="disk-item">
                <div class="disk-info">
                  <div>
                    <strong>Disk ${t+1}</strong>
                    ${"create"===e.action?`(New ${e.format||"qcow2"})`:""}
                  </div>
                  <div>
                    Size: 
                    <input
                      type="number"
                      min="1"
                      max="1000"
                      style="width: 80px; padding: 4px 8px; margin: 0 4px;"
                      .value=${String(e.size||20)}
                      @input=${e=>this.updateDisk(t,"size",Number(e.target.value))}
                    /> GB
                  </div>
                  <div>
                    Format: 
                    <select
                      style="width: 100px; padding: 4px 8px; margin: 0 4px;"
                      .value=${e.format||"qcow2"}
                      @change=${e=>this.updateDisk(t,"format",e.target.value)}
                    >
                      <option value="qcow2">QCOW2</option>
                      <option value="raw">RAW</option>
                    </select>
                  </div>
                </div>
                <button 
                  class="btn-remove" 
                  @click=${()=>this.removeDisk(t)}
                >
                  Remove
                </button>
              </div>
            `)}
          </div>
          ${this.validationErrors.disks?J`
            <div class="error-message">${this.validationErrors.disks}</div>
          `:""}
          <button class="btn-add" @click=${this.addDisk}>
            + Add Disk
          </button>
        </div>
      </div>
    `}renderNetworkConfig(){const e=this.wizardController.value,{formData:t}=e,s=t.network||{type:"network"},i=s.type,o="nat"===i?"network":i||"network";return J`
      <div>
        <div class="form-group">
          <label>Network Type</label>
          <select
            .value=${o}
            @change=${e=>{const t=e.target.value;this.updateFormData("network",{...s,type:t})}}
          >
            <option value="network">Network (Default / NAT)</option>
            <option value="bridge">Bridge</option>
            <option value="user">User Mode</option>
            <option value="direct">Direct (Macvtap)</option>
          </select>
          <div class="help-text">
            Network attaches to a libvirt network (commonly 'default', often NAT'd). Bridge connects directly to a host bridge.
          </div>
        </div>

        ${"bridge"===o?J`
          <div class="form-group">
            <label>Bridge Interface</label>
            <input
              type="text"
              placeholder="br0"
              .value=${s.source||""}
              @input=${e=>this.updateFormData("network",{...s,source:e.target.value})}
            />
            <div class="help-text">
              Name of the bridge interface to connect to
            </div>
          </div>
        `:""}

        <div class="advanced-toggle" @click=${()=>this.showAdvancedOptions=!this.showAdvancedOptions}>
          <span>${this.showAdvancedOptions?"â¼":"â¶"}</span>
          <span>Advanced Network Options</span>
        </div>

        ${this.showAdvancedOptions?J`
          <div class="advanced-options">
            <div class="form-group">
              <label>Network Model</label>
              <select
                .value=${s.model||"virtio"}
                @change=${e=>this.updateFormData("network",{...s,model:e.target.value})}
              >
                <option value="virtio">VirtIO (Recommended)</option>
                <option value="e1000">Intel E1000</option>
                <option value="rtl8139">Realtek RTL8139</option>
              </select>
            </div>

            <div class="form-group">
              <label>MAC Address (Optional)</label>
              <input
                type="text"
                placeholder="52:54:00:xx:xx:xx (auto-generated if empty)"
                .value=${s.mac||""}
                @input=${e=>this.updateFormData("network",{...s,mac:e.target.value})}
              />
              <div class="help-text">
                Leave empty to auto-generate a MAC address
              </div>
            </div>
          </div>
        `:""}

        <div class="form-group" style="margin-top: 24px;">
          <label>Graphics</label>
          <select
            .value=${t.graphics?.type||"vnc"}
            @change=${e=>{const t=e.target.value;this.updateFormData("graphics",{type:t})}}
          >
            <option value="vnc">VNC</option>
            <option value="spice">SPICE</option>
            <option value="none">None (Headless)</option>
          </select>
          <div class="help-text">
            VNC or SPICE for remote desktop access
          </div>
        </div>
      </div>
    `}renderReview(){const e=this.wizardController.value,{formData:t}=e,s=this.storagePoolsController.value.find(e=>e.name===t.storage?.default_pool);return J`
      <div>
        <div class="review-section">
          <h3>Basic Configuration</h3>
          <div class="review-grid">
            <div class="review-label">Name:</div>
            <div class="review-value">${t.name||"Not set"}</div>
            
            <div class="review-label">Description:</div>
            <div class="review-value">${t.description||"None"}</div>
            
            <div class="review-label">Memory:</div>
            <div class="review-value">${this.formatMemory(t.memory||0)}</div>
            
            <div class="review-label">vCPUs:</div>
            <div class="review-value">${t.vcpus||0}</div>
            
            <div class="review-label">OS Type:</div>
            <div class="review-value">${t.os_type||"linux"}</div>
          </div>
        </div>

        <div class="review-section">
          <h3>Storage Configuration</h3>
          <div class="review-grid">
            <div class="review-label">Storage Pool:</div>
            <div class="review-value">
              ${s?`${s.name} (${this.formatBytes(s.available)} available)`:"Not selected"}
            </div>
            
            <div class="review-label">Boot ISO:</div>
            <div class="review-value">
              ${t.storage?.boot_iso||"None (network boot or existing disk)"}
            </div>
            
            <div class="review-label">Disks:</div>
            <div class="review-value">
              ${t.storage?.disks?.map((e,t)=>J`
                <div>Disk ${t+1}: ${e.size}GB ${e.format}</div>
              `)||"No disks configured"}
            </div>
          </div>
        </div>

        <div class="review-section">
          <h3>Network Configuration</h3>
          <div class="review-grid">
            <div class="review-label">Network Type:</div>
            <div class="review-value">${t.network?.type||"NAT"}</div>
            
            ${t.network?.source?J`
              <div class="review-label">Bridge:</div>
              <div class="review-value">${t.network.source}</div>
            `:""}
            
            <div class="review-label">Network Model:</div>
            <div class="review-value">${t.network?.model||"virtio"}</div>
            
            <div class="review-label">Graphics:</div>
            <div class="review-value">${t.graphics?.type||"VNC"}</div>
          </div>
        </div>

        ${this.isCreating?J`
          <loading-state message="Creating virtual machine..."></loading-state>
        `:""}
      </div>
    `}formatMemory(e){return e>=1024?`${(e/1024).toFixed(1)} GB`:`${e} MB`}formatBytes(e){const t=["B","KB","MB","GB","TB"];let s=e,i=0;for(;s>=1024&&i<t.length-1;)s/=1024,i++;return`${s.toFixed(1)} ${t[i]}`}render(){const e=this.wizardController.value;if(e.isOpen?this.setAttribute("show",""):this.removeAttribute("show"),!e.isOpen)return J``;return J`
      <div class="drawer" part="drawer">
        <div class="drawer-header" part="header">
          <h2 class="header-title">
            <span class="wizard-icon">ð¥ï¸</span>
            Create Virtual Machine
          </h2>
          <button 
            class="close-button" 
            @click=${this.handleClose}
            ?disabled=${this.isCreating}
            aria-label="Close"
          >
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>

        <div class="wizard-steps">
          ${[{number:1,label:"Basic Configuration"},{number:2,label:"Storage"},{number:3,label:"Network"},{number:4,label:"Review & Create"}].map(t=>J`
            <div class="step ${e.currentStep===t.number?"active":""} ${e.currentStep>t.number?"completed":""}">
              <div class="step-number">
                ${e.currentStep>t.number?"â":t.number}
              </div>
              <span>${t.label}</span>
            </div>
          `)}
        </div>

        <div class="content" part="content">
          <div class="wizard-body">
            ${1===e.currentStep?this.renderBasicConfig():2===e.currentStep?this.renderStorageConfig():3===e.currentStep?this.renderNetworkConfig():4===e.currentStep?this.renderReview():J`<div>Invalid step</div>`}
          </div>
        </div>

        <div class="controls" part="controls">
          <button class="btn-ghost" @click=${this.handleClose}>
            Cancel
          </button>
          
          <div class="button-group">
            <button 
              class="btn-secondary" 
              @click=${this.handlePrevious}
              ?disabled=${1===e.currentStep}
            >
              Previous
            </button>
            
            ${e.currentStep<4?J`
              <button 
                class="btn-primary" 
                @click=${this.handleNext}
              >
                Next
              </button>
            `:J`
              <button 
                class="btn-primary" 
                @click=${this.handleCreate}
                ?disabled=${this.isCreating}
              >
                ${this.isCreating?"Creating...":"Create VM"}
              </button>
            `}
          </div>
        </div>
      </div>
    `}};Gw.styles=g`
    :host {
      display: block;
      position: fixed;
      top: 0;
      right: 0;
      width: 800px;
      height: 100vh;
      z-index: 1000;
      pointer-events: none;
    }

    :host([show]) {
      pointer-events: auto;
    }

    .drawer {
      width: 100%;
      height: 100%;
      background: var(--vscode-editor-background, var(--surface-0, #1e1e1e));
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      border-left: 1px solid var(--vscode-widget-border, var(--vscode-panel-border, #454545));
    }

    :host([show]) .drawer {
      transform: translateX(0);
    }

    .drawer-header {
      padding: 20px;
      background: var(--vscode-bg-lighter, #2c2f3a);
      border-bottom: 1px solid var(--vscode-widget-border, var(--vscode-panel-border, #454545));
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .header-title {
      font-size: 18px;
      font-weight: 500;
      color: var(--title-color, #e0e0e0);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .wizard-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .wizard-steps {
      display: flex;
      gap: 16px;
      padding: 16px 20px;
      border-bottom: 1px solid var(--vscode-widget-border, var(--vscode-panel-border, #454545));
      background: var(--vscode-bg-lighter, #2c2f3a);
      flex-shrink: 0;
      overflow-x: auto;
    }

    .wizard-steps::-webkit-scrollbar {
      height: 4px;
    }

    .wizard-steps::-webkit-scrollbar-track {
      background: transparent;
    }

    .wizard-steps::-webkit-scrollbar-thumb {
      background: var(--vscode-scrollbarSlider-background, #4a4d5a);
      border-radius: 2px;
    }

    .step {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--vscode-descriptionForeground);
      font-size: 13px;
    }

    .step.active {
      color: var(--vscode-foreground);
      font-weight: 500;
    }

    .step.completed {
      color: var(--vscode-charts-green);
    }

    .step-number {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--vscode-button-secondaryBackground);
      border: 2px solid var(--vscode-button-border);
      font-size: 12px;
      font-weight: 600;
    }

    .step.active .step-number {
      background: var(--vscode-button-background);
      color: var(--vscode-button-foreground);
      border-color: var(--vscode-button-background);
    }

    .step.completed .step-number {
      background: var(--vscode-charts-green);
      color: white;
      border-color: var(--vscode-charts-green);
    }

    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .wizard-body {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
      background: var(--vscode-editor-background, var(--surface-0, #1e1e1e));
    }

    .wizard-body::-webkit-scrollbar {
      width: 8px;
    }

    .wizard-body::-webkit-scrollbar-track {
      background: var(--scrollbar-track, var(--vscode-editor-background, #1e1e1e));
    }

    .wizard-body::-webkit-scrollbar-thumb {
      background: var(--scrollbar-thumb, var(--vscode-scrollbarSlider-background, #4a4d5a));
      border-radius: 4px;
    }

    .wizard-body::-webkit-scrollbar-thumb:hover {
      background: var(--scrollbar-thumb-hover, #5a5d6a);
    }

    .controls {
      padding: 20px;
      border-top: 1px solid var(--vscode-widget-border, var(--vscode-panel-border, #454545));
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      background: var(--vscode-bg-lighter, #2c2f3a);
      flex-shrink: 0;
    }

    .button-group {
      display: flex;
      gap: 8px;
    }

    button {
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
      font-family: inherit;
    }

    button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    button:focus-visible {
      outline: 2px solid var(--vscode-focusBorder, #007acc);
      outline-offset: 2px;
    }

    .btn-primary {
      background: var(--vscode-button-background, #0e639c);
      color: var(--vscode-button-foreground, #ffffff);
      border: 1px solid var(--vscode-button-background, #0e639c);
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--vscode-button-hoverBackground, #1177bb);
      border-color: var(--vscode-button-hoverBackground, #1177bb);
    }


    .btn-secondary {
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border: 1px solid var(--vscode-button-border, #5a5a5a);
    }

    .btn-secondary:hover:not(:disabled) {
      background: var(--vscode-button-secondaryHoverBackground, #484848);
      border-color: var(--vscode-focusBorder, #007acc);
    }

    .btn-ghost {
      background: transparent;
      color: var(--vscode-foreground);
    }

    .btn-ghost:hover {
      background: var(--vscode-toolbar-hoverBackground);
    }

    .form-group {
      margin-bottom: 20px;
      width: 100%;
      box-sizing: border-box;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 13px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
    }

    .form-group label.required::after {
      content: ' *';
      color: var(--vscode-errorForeground, #f48771);
    }

    .required {
      color: var(--vscode-errorForeground, #f48771);
    }

    input,
    select,
    textarea {
      width: 100%;
      max-width: 100%;
      padding: 8px 12px;
      background: var(--vscode-input-background, #3c3c3c);
      color: var(--vscode-input-foreground, #cccccc);
      border: 1px solid var(--vscode-input-border, #858585);
      border-radius: 4px;
      font-size: 13px;
      font-family: inherit;
      transition: all 0.2s;
      box-sizing: border-box;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--vscode-focusBorder, #007acc);
      box-shadow: 0 0 0 1px var(--vscode-focusBorder, #007acc);
    }

    input:hover,
    select:hover,
    textarea:hover {
      border-color: var(--vscode-focusBorder, #007acc);
    }

    input::placeholder {
      color: var(--vscode-input-placeholderForeground, #8b8b8b);
    }

    /* Style select dropdown arrow */
    select {
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23cccccc' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 8px center;
      background-size: 16px;
      padding-right: 32px;
    }

    select option {
      background: var(--vscode-dropdown-background, #3c3c3c);
      color: var(--vscode-dropdown-foreground, #cccccc);
    }

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      opacity: 1;
      height: 30px;
    }

    .error input,
    .error select,
    .error textarea {
      border-color: var(--vscode-inputValidation-errorBorder);
    }

    .error-message {
      margin-top: 6px;
      font-size: 12px;
      color: var(--vscode-errorForeground, #f48771);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .error-message::before {
      content: 'â ';
      font-size: 14px;
    }

    .help-text {
      margin-top: 6px;
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #8b8b8b);
      line-height: 1.4;
    }

    .input-group {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .input-addon {
      padding: 8px 12px;
      background: var(--vscode-button-secondaryBackground);
      border: 1px solid var(--vscode-input-border);
      border-radius: 4px;
      font-size: 13px;
      white-space: nowrap;
    }

    .memory-input-group {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .memory-input-group input[type="number"] {
      flex: 1;
    }

    .memory-unit {
      padding: 8px 12px;
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      border: 1px solid var(--vscode-input-border, #858585);
      border-radius: 4px;
      font-size: 13px;
      color: var(--vscode-descriptionForeground, #8b8b8b);
      white-space: nowrap;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .disk-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .disk-item {
      padding: 12px;
      background: var(--vscode-editor-inactiveSelectionBackground, #2a2a2a);
      border: 1px solid var(--vscode-editorWidget-border, #464647);
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s;
    }

    .disk-item:hover {
      background: var(--vscode-list-hoverBackground, #2a2d2e);
      border-color: var(--vscode-focusBorder, #007acc);
    }

    .disk-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .btn-remove {
      padding: 4px 8px;
      background: var(--vscode-inputValidation-errorBackground);
      color: var(--vscode-inputValidation-errorForeground);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }

    .btn-add {
      padding: 8px 12px;
      background: transparent;
      color: var(--vscode-textLink-foreground, #3794ff);
      border: 1px dashed var(--vscode-textLink-foreground, #3794ff);
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-add:hover {
      background: var(--vscode-textLink-foreground, #3794ff);
      color: white;
      border-style: solid;
    }

    .btn-add::before {
      content: '+';
      font-size: 16px;
      font-weight: bold;
    }

    .review-section {
      margin-bottom: 24px;
    }

    .review-section h3 {
      margin: 0 0 12px 0;
      font-size: 14px;
      font-weight: 500;
      color: var(--vscode-foreground);
    }

    .review-grid {
      display: grid;
      grid-template-columns: 150px 1fr;
      gap: 8px;
      font-size: 13px;
    }

    .review-label {
      color: var(--vscode-descriptionForeground);
    }

    .review-value {
      color: var(--vscode-foreground);
      font-weight: 500;
    }

    .advanced-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      user-select: none;
      color: var(--vscode-textLink-foreground);
      font-size: 13px;
      margin-bottom: 16px;
    }

    .advanced-toggle:hover {
      color: var(--vscode-textLink-activeForeground);
    }

    .advanced-options {
      padding: 16px;
      background: var(--vscode-editor-inactiveSelectionBackground);
      border: 1px solid var(--vscode-editorWidget-border);
      border-radius: 4px;
      margin-top: 16px;
    }

    .close-button {
      background: none;
      border: none;
      color: var(--close-color, #999);
      cursor: pointer;
      padding: 8px;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .close-button:hover {
      background: var(--close-hover-bg, rgba(255, 255, 255, 0.1));
      color: var(--close-hover-color, #e0e0e0);
    }
  `,Kw([xe()],Gw.prototype,"isCreating",2),Kw([xe()],Gw.prototype,"validationErrors",2),Kw([xe()],Gw.prototype,"showAdvancedOptions",2),Gw=Kw([ve("create-vm-wizard")],Gw);var Qw=Object.defineProperty,Jw=Object.getOwnPropertyDescriptor,Yw=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Jw(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Qw(t,s,r),r};let Xw=class extends me{constructor(){super(...arguments),this.value="",this.family="",this.placeholder="e.g. ubuntu22.04",this.disabled=!1,this.limit=2e3,this.loaded=!1,this.loading=!1,this.error=null,this.open=!1,this.variants=[],this.highlightIndex=-1}updated(e){e.has("family")&&(this.loaded=!1,this.loading=!1,this.error=null,this.variants=[],this.highlightIndex=-1,this.open&&this.ensureLoaded())}async ensureLoaded(){if(!(this.loaded||this.loading||this.disabled)){this.loading=!0,this.error=null;try{const{variants:e}=await yy.listOSVariants({family:this.family||void 0,limit:this.limit});this.variants=e,this.loaded=!0}catch(e){this.error="Suggestions unavailable",this.loaded=!0,this.variants=[]}finally{this.loading=!1}}}get filteredVariants(){const e=(this.value||"").trim().toLowerCase(),t=this.variants||[];if(!e)return t.slice(0,20);const s=t=>{const s=(t.short_id||"").toLowerCase(),i=(t.name||"").toLowerCase();return s==e?0:i==e?1:s.startsWith(e)?2:i.startsWith(e)?3:s.includes(e)?4:i.includes(e)?5:6},i=t.filter(t=>[t.short_id,t.name,t.version,t.family,t.distro,t.vendor,t.id].filter(Boolean).map(e=>String(e).toLowerCase()).some(t=>t.includes(e)));return i.sort((e,t)=>s(e)-s(t)),i.slice(0,20)}dispatchChange(){this.dispatchEvent(new CustomEvent("os-variant-change",{detail:{value:this.value},bubbles:!0,composed:!0}))}handleFocus(){this.open=!0,this.ensureLoaded()}handleBlur(){window.setTimeout(()=>{this.open=!1,this.highlightIndex=-1},150)}handleInput(e){const t=e.target;this.value=t.value,this.open=!0,this.highlightIndex=-1,this.dispatchChange(),this.ensureLoaded()}handleKeydown(e){if(!this.open)return;const t=this.filteredVariants;if("Escape"===e.key)return this.open=!1,void(this.highlightIndex=-1);if(t.length){if("ArrowDown"===e.key)return e.preventDefault(),void(this.highlightIndex=Math.min(this.highlightIndex+1,t.length-1));if("ArrowUp"===e.key)return e.preventDefault(),void(this.highlightIndex=Math.max(this.highlightIndex-1,0));if("Enter"===e.key&&this.highlightIndex>=0&&this.highlightIndex<t.length){e.preventDefault();const s=t[this.highlightIndex];s&&this.selectVariant(s)}}}selectVariant(e){this.value=e.short_id,this.dispatchChange(),this.open=!1,this.highlightIndex=-1;const t=this.renderRoot?.querySelector("input");t?.focus()}render(){const e=this.filteredVariants,t=this.open&&!this.disabled&&(this.loading||e.length>0||!!this.error);return J`
      <div class="wrapper">
        <input
          class="input"
          type="text"
          .value=${this.value}
          placeholder=${this.placeholder}
          ?disabled=${this.disabled}
          @focus=${this.handleFocus}
          @blur=${this.handleBlur}
          @input=${this.handleInput}
          @keydown=${this.handleKeydown}
        />

        ${t?J`
              <div class="dropdown" role="listbox">
                ${this.loading?J`<div class="status">Loading suggestionsâ¦</div>`:this.error?J`<div class="status">${this.error}</div>`:e.map((e,t)=>{const s=`${e.name||e.short_id} (${e.short_id})`,i=[e.vendor,e.distro,e.version,e.family].filter(Boolean),o=i.length?i.join(" Â· "):"";return J`
                          <div
                            class="row ${t===this.highlightIndex?"highlight":""}"
                            role="option"
                            @mousedown=${e=>{e.preventDefault()}}
                            @click=${()=>this.selectVariant(e)}
                          >
                            <div class="primary">${s}</div>
                            ${o?J`<div class="secondary">${o}</div>`:X}
                          </div>
                        `})}
              </div>
            `:X}
      </div>
    `}};Xw.styles=g`
    :host {
      display: block;
    }

    .wrapper {
      position: relative;
    }

    .input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid var(--vscode-input-border, #858585);
      border-radius: 4px;
      background: var(--vscode-input-background, #3c3c3c);
      color: var(--vscode-input-foreground, #cccccc);
      font-size: 13px;
      font-family: inherit;
      transition: all 0.2s;
      outline: none;
      box-sizing: border-box;
    }

    .input:focus {
      outline: none;
      border-color: var(--vscode-focusBorder, #007acc);
      box-shadow: 0 0 0 1px var(--vscode-focusBorder, #007acc);
    }

    .input:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .input::placeholder {
      color: var(--vscode-input-placeholderForeground, rgba(204, 204, 204, 0.6));
    }

    .dropdown {
      position: absolute;
      top: calc(100% + 4px);
      left: 0;
      right: 0;
      background: var(--vscode-editorWidget-background, var(--vscode-editor-background, #1e1e1e));
      border: 1px solid var(--vscode-input-border, #858585);
      border-radius: 4px;
      max-height: 260px;
      overflow: auto;
      z-index: 1000;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
    }

    .row {
      padding: 8px 10px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .row:hover,
    .row.highlight {
      background: var(--vscode-list-hoverBackground, rgba(255, 255, 255, 0.08));
    }

    .primary {
      font-size: 13px;
      color: var(--vscode-foreground, #e0e0e0);
      line-height: 1.2;
    }

    .secondary {
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #b5b5b5);
      line-height: 1.2;
    }

    .status {
      padding: 8px 10px;
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #b5b5b5);
    }
  `,Yw([we({type:String})],Xw.prototype,"value",2),Yw([we({type:String})],Xw.prototype,"family",2),Yw([we({type:String})],Xw.prototype,"placeholder",2),Yw([we({type:Boolean})],Xw.prototype,"disabled",2),Yw([we({type:Number})],Xw.prototype,"limit",2),Yw([xe()],Xw.prototype,"loaded",2),Yw([xe()],Xw.prototype,"loading",2),Yw([xe()],Xw.prototype,"error",2),Yw([xe()],Xw.prototype,"open",2),Yw([xe()],Xw.prototype,"variants",2),Yw([xe()],Xw.prototype,"highlightIndex",2),Xw=Yw([ve("os-variant-autocomplete")],Xw);var Zw=Object.defineProperty,ex=Object.getOwnPropertyDescriptor,tx=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?ex(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Zw(t,s,r),r};let sx=class extends me{constructor(){super(...arguments),this.wizardController=new Zl.StoreController(this,Xy),this.storagePoolsController=new Zl.StoreController(this,yw),this.isosController=new Zl.StoreController(this,_w),this.networksController=new Zl.StoreController(this,Ky.$items),this.bridgesController=new Zl.StoreController(this,od),this.volumesController=new Zl.StoreController(this,kw),this.isCreating=!1,this.showAddDeviceMenu=!1,this.showDeviceModal=!1,this.deviceModalMode="disk",this.deviceDraft=null,this.editingDiskIndex=null,this.showNetworkModal=!1,this.networkDraft=null,this.editingNetworkIndex=null,this.showGraphicsModal=!1,this.graphicsDraft=null,this.editingGraphicsIndex=null,this.showPCIModal=!1,this.pciDraft=null,this.editingPCIDeviceIndex=null,this.pciHostSelection="",this.validationErrors={},this.expandedSections=/* @__PURE__ */new Set(["basic","storage","network"]),this.currentStep=1,this.availablePCIDevices=[],this.isLoadingPCIDevices=!1,this.editMode=!1,this.editingVmId=null,this.templateMode=!1,this.templateContext=null,this.templateDiskSizeGB=null,this.showCloseConfirmation=!1,this.formData=this.buildDefaultFormData(),this.lastInitializedOpenId=null}connectedCallback(){super.connectedCallback(),this.loadData()}async loadData(){try{await Promise.all([By.fetch(),Uy.fetch(),Hy.fetch(),Ky.fetch(),Mw.fetchAll(),Sd(),this.loadPCIDevices()])}catch(e){console.error("Failed to load data for VM wizard:",e)}}async loadPCIDevices(){this.isLoadingPCIDevices=!0;try{const t=localStorage.getItem("jwt_token")||localStorage.getItem("auth_token")||localStorage.getItem("token"),s=await fetch(e("/virtualization/computes/pci-devices"),{headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""}});if(s.ok){const e=await s.json();"success"===e.status&&e.data?.devices?this.availablePCIDevices=e.data.devices:e.devices?this.availablePCIDevices=e.devices:Array.isArray(e)?this.availablePCIDevices=e:(this.availablePCIDevices=[],console.warn("Unexpected PCI devices response format:",e))}else{const e=await s.json().catch(()=>({message:s.statusText}));console.error("Failed to fetch PCI devices:",e.message||s.statusText),this.availablePCIDevices=[]}}catch(t){console.error("Failed to load PCI devices:",t),this.availablePCIDevices=[]}finally{this.isLoadingPCIDevices=!1}}toggleSection(e){this.expandedSections.has(e)?this.expandedSections.delete(e):this.expandedSections.add(e),this.requestUpdate()}handleClose(){this.isCreating||(this.showCloseConfirmation=!0)}handleConfirmClose(){this.showCloseConfirmation=!1,this.resetFormData(),Dw.closeWizard()}handleCancelClose(){this.showCloseConfirmation=!1}buildDefaultFormData(){return{name:this.generateDefaultVmName(),memory:2048,vcpus:2,os_type:"linux",architecture:"x86_64",storage:{disks:[]},networks:[{type:"network",source:"default",model:"virtio"}],graphics:[{type:"vnc",autoport:!0,listen:"0.0.0.0"}]}}resetFormData(){this.formData=this.buildDefaultFormData(),this.currentStep=1,this.validationErrors={},this.editMode=!1,this.editingVmId=null,this.templateMode=!1,this.templateContext=null,this.templateDiskSizeGB=null,this.lastInitializedOpenId=null}goToStep(e){this.currentStep=e}handlePrevious(){this.currentStep>1&&this.currentStep--}handleNext(){this.validateStep(this.currentStep)&&this.currentStep<6&&this.currentStep++}validateStep(e){const t={};switch(e){case 1:this.formData.name||(t.name="VM name is required");{const e=this.templateMode?this.templateContext:null,s=e?.min_memory??512,i=e?.min_vcpus??1;(!this.formData.memory||this.formData.memory<s)&&(t.memory=e?`Memory must be at least ${s} MB (template min)`:"Memory must be at least 512 MB"),(!this.formData.vcpus||this.formData.vcpus<i)&&(t.vcpus=e?`At least ${i} vCPU is required (template min)`:"At least 1 vCPU is required")}break;case 2:{if(this.templateMode&&this.templateContext){const e=this.templateDiskSizeGB;if(null==e||!Number.isFinite(e)||e<=0){t.disk_size="Disk size is required";break}e<this.templateContext.min_disk&&(t.disk_size=`Disk must be >= template min (${this.templateContext.min_disk} GB)`);break}const e=this.formData.storage?.disks||[];if(0===e.length){t.storage_pool="At least one disk is required";break}e.some(e=>!e.storage_pool)&&(t.storage_pool="Storage pool is required for all disks");for(const s of e){if("create"===s.action&&(!s.size||s.size<=0)){t.storage_pool="Disk size is required for created disks";break}if("attach"===s.action&&!s.path){t.storage_pool="Source volume is required for attached disks";break}if(!("clone"!==s.action||s.storage_pool&&s.clone_from)){t.storage_pool="Source volume is required for cloned disks";break}}break}}return this.validationErrors=t,0===Object.keys(t).length}buildRequestPayload(){const e=(this.formData.storage?.disks||[]).map(e=>({action:e.action,size:e.size,format:"vmdk"===e.format?"qcow2":e.format,storage_pool:e.storage_pool,path:e.path,source:e.clone_from,bus:e.bus,cache:e.cache,target:e.target,readonly:e.readonly,boot_order:e.boot_order,device:e.device||"disk"})),t={name:this.formData.name,memory:this.formData.memory,vcpus:this.formData.vcpus,storage:{disks:e},os_type:this.formData.os_type,os_variant:this.formData.os_variant,architecture:this.formData.architecture,uefi:this.formData.uefi,secure_boot:this.formData.secure_boot,tpm:this.formData.tpm,autostart:this.formData.autostart,metadata:this.formData.metadata};return this.formData.networks&&this.formData.networks.length>0&&(t.networks=this.formData.networks),this.formData.graphics&&this.formData.graphics.length>0&&(t.graphics=this.formData.graphics),this.formData.pci_devices&&this.formData.pci_devices.length>0&&(t.pci_devices=this.formData.pci_devices),this.formData.cloud_init&&(t.cloud_init=this.formData.cloud_init),t}toggleAddDeviceMenu(){this.showAddDeviceMenu=!this.showAddDeviceMenu}openAddDiskModal(){this.showAddDeviceMenu=!1,this.editingDiskIndex=null,this.deviceModalMode="disk";const e=this.formData.storage?.disks?.[0]?.storage_pool||"default";this.deviceDraft={action:"create",size:20,format:"qcow2",storage_pool:e,bus:"virtio",device:"disk",readonly:!1},this.showDeviceModal=!0}openAddIsoModal(){this.showAddDeviceMenu=!1,this.editingDiskIndex=null,this.deviceModalMode="iso";const e=this.formData.storage?.disks?.[0]?.storage_pool||"default";this.deviceDraft={action:"attach",storage_pool:e,bus:"ide",device:"cdrom",readonly:!0,boot_order:1},this.showDeviceModal=!0}openEditDiskModal(e){const t=this.formData.storage?.disks?.[e];t&&(this.showAddDeviceMenu=!1,this.editingDiskIndex=e,this.deviceModalMode="cdrom"===t.device?"iso":"disk",this.deviceDraft={...t},this.showDeviceModal=!0)}handleDeviceModalClose(){this.showDeviceModal=!1,this.deviceDraft=null,this.editingDiskIndex=null}handleDeviceModalSave(){if(!this.deviceDraft)return;const e=this.deviceDraft;if(e.storage_pool){if("disk"===this.deviceModalMode){const t=e.action||"create";if("create"===t){if(!e.size||e.size<=0)return void this.showNotification("Disk size must be greater than 0","error")}else if("clone"===t){if(!e.clone_from)return void this.showNotification("Source volume is required for clone","error")}else if("attach"===t&&!e.path)return void this.showNotification("Source volume is required for attach","error");e.action=t,e.device="disk"}else{if(!e.path)return void this.showNotification("ISO image is required","error");e.action="attach",e.device="cdrom",e.readonly=!0,(!e.boot_order||e.boot_order<=0)&&(e.boot_order=1)}this.formData.storage||(this.formData.storage={disks:[]}),this.formData.storage.disks||(this.formData.storage.disks=[]),null!==this.editingDiskIndex?this.formData.storage.disks[this.editingDiskIndex]={...e}:this.formData.storage.disks.push({...e}),this.showDeviceModal=!1,this.deviceDraft=null,this.editingDiskIndex=null,this.requestUpdate()}else this.showNotification("Storage pool is required","error")}renderDeviceModal(){if(!this.showDeviceModal||!this.deviceDraft)return null;const e=this.storagePoolsController.value||[],t=this.isosController.value||[],s=this.deviceDraft;return J`
      <modal-dialog
        .open=${this.showDeviceModal}
        .title=${"iso"===this.deviceModalMode?null!==this.editingDiskIndex?"Edit ISO/CD-ROM":"Add ISO/CD-ROM":null!==this.editingDiskIndex?"Edit Disk":"Add Disk"}
        size="medium"
        @modal-close=${this.handleDeviceModalClose}
      >
        ${"disk"===this.deviceModalMode?J`
          <div class="form-group">
            <label>Action</label>
            <select
              .value=${s.action||"create"}
              @change=${e=>{s.action=e.target.value,"create"===s.action?(s.clone_from="",s.path=""):"clone"===s.action?s.path="":"attach"===s.action&&(s.clone_from=""),this.requestUpdate()}}
            >
              <option value="create">Create New</option>
              <option value="clone">Clone From</option>
              <option value="attach">Attach Existing</option>
            </select>
          </div>

          <div class="form-group">
            <label>Storage Pool <span class="required">*</span></label>
            <select
              .value=${s.storage_pool||""}
              @change=${e=>{s.storage_pool=e.target.value,s.clone_from="",s.path="",this.requestUpdate()}}
            >
              <option value="">Select a storage pool</option>
              ${e.map(e=>J`
                <option value=${e.name}>${e.name}</option>
              `)}
            </select>
          </div>

          ${"create"===s.action?J`
            <div class="grid-3">
              <div class="form-group">
                <label>Size (GB)</label>
                <input
                  type="number"
                  min="1"
                  .value=${String(s.size||20)}
                  @input=${e=>{s.size=Number(e.target.value),this.requestUpdate()}}
                />
              </div>

              <div class="form-group">
                <label>Format</label>
                <select
                  .value=${s.format||"qcow2"}
                  @change=${e=>{s.format=e.target.value,this.requestUpdate()}}
                >
                  <option value="qcow2">QCOW2</option>
                  <option value="raw">RAW</option>
                  <option value="vmdk">VMDK</option>
                  <option value="vdi">VDI</option>
                </select>
              </div>

              <div class="form-group">
                <label>Bus</label>
                <select
                  .value=${s.bus||"virtio"}
                  @change=${e=>{s.bus=e.target.value,this.requestUpdate()}}
                >
                  <option value="virtio">VirtIO</option>
                  <option value="scsi">SCSI</option>
                  <option value="ide">IDE</option>
                  <option value="sata">SATA</option>
                </select>
              </div>
            </div>
          `:"clone"===s.action?J`
            <div class="form-group">
              <label>Source volume</label>
              <select
                .value=${s.clone_from||""}
                @change=${e=>{s.clone_from=e.target.value,this.requestUpdate()}}
                ?disabled=${!s.storage_pool}
              >
                <option value="">${s.storage_pool?"Select volume to clone...":"Select pool first..."}</option>
                ${this.getVolumesForPool(s.storage_pool||"").map(e=>J`
                  <option value="${e.path}" ?selected=${s.clone_from===e.path}>
                    ${e.name} (${this.formatVolumeSize(e.capacity)}, ${e.format})
                  </option>
                `)}
              </select>
            </div>
          `:J`
            <div class="form-group">
              <label>Source volume</label>
              <select
                .value=${s.path||""}
                @change=${e=>{s.path=e.target.value,this.requestUpdate()}}
                ?disabled=${!s.storage_pool}
              >
                <option value="">${s.storage_pool?"Select volume to attach...":"Select pool first..."}</option>
                ${this.getVolumesForPool(s.storage_pool||"").map(e=>J`
                  <option value="${e.path}" ?selected=${s.path===e.path}>
                    ${e.name} (${this.formatVolumeSize(e.capacity)}, ${e.format})
                  </option>
                `)}
              </select>
            </div>
          `}

          <div class="grid-3">
            <div class="form-group">
              <label>Target (optional)</label>
              <input
                type="text"
                placeholder="e.g. vda"
                .value=${s.target||""}
                @input=${e=>{s.target=e.target.value,this.requestUpdate()}}
              />
            </div>

            <div class="form-group">
              <label>Boot order (optional)</label>
              <input
                type="number"
                min="1"
                .value=${String(s.boot_order||"")}
                @input=${e=>{const t=e.target.value;s.boot_order=t?Number(t):void 0,this.requestUpdate()}}
              />
            </div>

            <div class="form-group">
              <label>&nbsp;</label>
              <div class="checkbox-group">
                <input
                  type="checkbox"
                  id="disk-readonly"
                  ?checked=${s.readonly}
                  @change=${e=>{s.readonly=e.target.checked,this.requestUpdate()}}
                />
                <label for="disk-readonly">Read-only</label>
              </div>
            </div>
          </div>
        `:J`
          <div class="form-group">
            <label>ISO image <span class="required">*</span></label>
            <select
              .value=${s.path||""}
              @change=${e=>{const i=e.target.value,o=(t||[]).find(e=>e.path===i);o?(s.path=o.path,s.storage_pool=o.storage_pool||s.storage_pool||"default"):s.path="",this.requestUpdate()}}
            >
              <option value="">Select ISO image...</option>
              ${t.map(e=>J`
                <option value=${e.path}>
                  ${e.name} (${this.formatVolumeSize(e.size)})
                </option>
              `)}
            </select>
          </div>

          <div class="grid-3">
            <div class="form-group">
              <label>Bus</label>
              <select
                .value=${s.bus||"ide"}
                @change=${e=>{s.bus=e.target.value,this.requestUpdate()}}
              >
                <option value="ide">IDE</option>
                <option value="virtio">VirtIO</option>
                <option value="scsi">SCSI</option>
                <option value="sata">SATA</option>
              </select>
            </div>

            <div class="form-group">
              <label>Boot order</label>
              <input
                type="number"
                min="1"
                .value=${String(s.boot_order||1)}
                @input=${e=>{const t=e.target.value;s.boot_order=t?Number(t):1,this.requestUpdate()}}
              />
            </div>
          </div>
        `}

        <div slot="footer" style="display: flex; justify-content: flex-end; gap: 8px;">
          <button class="btn-secondary" @click=${this.handleDeviceModalClose}>Cancel</button>
          <button class="btn-primary" @click=${this.handleDeviceModalSave}>${null!==this.editingDiskIndex?"Save":"Add"}</button>
        </div>
      </modal-dialog>
    `}renderNetworkModal(){if(!this.showNetworkModal||!this.networkDraft)return null;const e=this.networksController.value,t=e instanceof Map?Array.from(e.values()):Array.isArray(e)?e:[],s=Array.from(this.bridgesController.value||[]).filter(e=>"bridge"===e.type),i=this.networkDraft;return J`
      <modal-dialog
        .open=${this.showNetworkModal}
        .title=${null!==this.editingNetworkIndex?"Edit Network Interface":"Add Network Interface"}
        size="medium"
        @modal-close=${this.handleNetworkModalClose}
      >
        <div class="grid-3">
          <div class="form-group">
            <label>Type</label>
            <select
              .value=${i.type}
              @change=${e=>{i.type=e.target.value,"network"===i.type?i.source="default":i.source="",this.requestUpdate()}}
            >
              <option value="network">Network</option>
              <option value="bridge">Bridge</option>
              <option value="direct">Direct (Macvtap)</option>
              <option value="user">User Mode</option>
            </select>
          </div>

          <div class="form-group">
            <label>Source ${"user"===i.type?"":J`<span class="required">*</span>`}</label>
            ${"network"===i.type?J`
              <select
                .value=${i.source||"default"}
                @change=${e=>{i.source=e.target.value,this.requestUpdate()}}
              >
                <option value="default">default</option>
                ${t.filter(e=>"default"!==e.name).map(e=>J`
                    <option value=${e.name}>
                      ${e.name} ${"active"===e.state?"(Active)":"(Inactive)"}
                    </option>
                  `)}
              </select>
            `:"bridge"===i.type?J`
              <select
                .value=${i.source||""}
                @change=${e=>{i.source=e.target.value,this.requestUpdate()}}
              >
                <option value="">Select a bridge</option>
                ${s.map(e=>J`
                  <option value=${e.name}>
                    ${e.name} ${"up"===e.state?"(Up)":"(Down)"}
                  </option>
                `)}
              </select>
            `:"direct"===i.type?J`
              <input
                type="text"
                placeholder="Interface (e.g. eth0)"
                .value=${i.source||""}
                @input=${e=>{i.source=e.target.value,this.requestUpdate()}}
              />
            `:J`
              <input
                type="text"
                placeholder="(not required)"
                .value=${i.source||""}
                @input=${e=>{i.source=e.target.value,this.requestUpdate()}}
              />
            `}
          </div>

          <div class="form-group">
            <label>Model</label>
            <select
              .value=${i.model||"virtio"}
              @change=${e=>{i.model=e.target.value,this.requestUpdate()}}
            >
              <option value="virtio">VirtIO</option>
              <option value="e1000">Intel E1000</option>
              <option value="rtl8139">Realtek RTL8139</option>
              <option value="vmxnet3">VMware vmxnet3</option>
            </select>
          </div>
        </div>

        <div class="form-group" style="margin-top: 12px;">
          <label>MAC Address (optional)</label>
          <input
            type="text"
            placeholder="52:54:00:xx:xx:xx (auto-generated if empty)"
            .value=${i.mac||""}
            @input=${e=>{i.mac=e.target.value,this.requestUpdate()}}
          />
          <div class="help-text">Leave empty to auto-generate a MAC address</div>
        </div>

        <div slot="footer" style="display: flex; justify-content: flex-end; gap: 8px;">
          <button class="btn-secondary" @click=${this.handleNetworkModalClose}>Cancel</button>
          <button class="btn-primary" @click=${this.handleNetworkModalSave}>${null!==this.editingNetworkIndex?"Save":"Add"}</button>
        </div>
      </modal-dialog>
    `}renderGraphicsModal(){if(!this.showGraphicsModal||!this.graphicsDraft)return null;const e=this.graphicsDraft;return J`
      <modal-dialog
        .open=${this.showGraphicsModal}
        .title=${null!==this.editingGraphicsIndex?"Edit Graphics":"Add Graphics"}
        size="medium"
        @modal-close=${this.handleGraphicsModalClose}
      >
        <div class="grid-3">
          <div class="form-group">
            <label>Type</label>
            <select
              .value=${e.type}
              @change=${t=>{e.type=t.target.value,"vnc"!==e.type&&"spice"!==e.type||(e.listen=e.listen||"0.0.0.0",void 0===e.autoport&&(e.autoport=!0)),this.requestUpdate()}}
            >
              <option value="vnc">VNC</option>
              <option value="spice">SPICE</option>
              <option value="egl-headless">EGL Headless</option>
              <option value="none">None</option>
            </select>
          </div>

          ${"none"!==e.type&&"egl-headless"!==e.type?J`
            <div class="form-group">
              <label>Port (optional)</label>
              <input
                type="number"
                placeholder="(auto if empty)"
                .value=${String(e.port||"")}
                @input=${t=>{const s=t.target.value;e.port=s?Number(s):void 0,this.requestUpdate()}}
              />
            </div>

            <div class="form-group">
              <label>Listen</label>
              <input
                type="text"
                placeholder="0.0.0.0"
                .value=${e.listen||"0.0.0.0"}
                @input=${t=>{e.listen=t.target.value,this.requestUpdate()}}
              />
            </div>
          `:""}
        </div>

        ${"none"!==e.type&&"egl-headless"!==e.type?J`
          <div class="grid-2" style="margin-top: 12px;">
            <input
              type="password"
              placeholder="Password (optional)"
              .value=${e.password||""}
              @input=${t=>{e.password=t.target.value,this.requestUpdate()}}
            />

            <div class="checkbox-group">
              <input
                type="checkbox"
                id="graphics-autoport"
                ?checked=${!!e.autoport}
                @change=${t=>{e.autoport=t.target.checked,this.requestUpdate()}}
              />
              <label for="graphics-autoport">Auto-assign port</label>
            </div>
          </div>
        `:""}

        <div slot="footer" style="display: flex; justify-content: flex-end; gap: 8px;">
          <button class="btn-secondary" @click=${this.handleGraphicsModalClose}>Cancel</button>
          <button class="btn-primary" @click=${this.handleGraphicsModalSave}>${null!==this.editingGraphicsIndex?"Save":"Add"}</button>
        </div>
      </modal-dialog>
    `}renderPCIDeviceModal(){if(!this.showPCIModal||!this.pciDraft)return null;const e=this.pciDraft,t=this.availablePCIDevices.find(t=>t.pci_address===e.host_address);return J`
      <modal-dialog
        .open=${this.showPCIModal}
        .title=${null!==this.editingPCIDeviceIndex?"Edit PCI Device":"Add PCI Device"}
        size="medium"
        @modal-close=${this.handlePCIDeviceModalClose}
      >
        <div class="grid-2">
          <div class="form-group">
            <label>Host PCI Address <span class="required">*</span></label>
            ${this.availablePCIDevices.length>0?J`
              <select
                .value=${this.pciHostSelection}
                @change=${t=>{const s=t.target.value;this.pciHostSelection=s,e.host_address="custom"===s?"":s,this.requestUpdate()}}
              >
                <option value="">Select a PCI device</option>
                ${this.availablePCIDevices.map(t=>J`
                    <option
                      value=${t.pci_address}
                      ?disabled=${!t.is_available&&t.pci_address!==e.host_address}
                    >
                      ${t.pci_address} - ${t.product_name||"Unknown"}
                      (${t.vendor_name||"Unknown"})
                      ${t.device_type?`[${String(t.device_type).toUpperCase()}]`:""}
                      ${t.is_available?"":t.assigned_to_vm?`(Assigned to: ${t.assigned_to_vm})`:"(In Use)"}
                    </option>
                  `)}
                <option value="custom">Enter custom address...</option>
              </select>

              ${"custom"===this.pciHostSelection?J`
                <input
                  type="text"
                  placeholder="0000:01:00.0"
                  style="margin-top: 8px;"
                  .value=${e.host_address||""}
                  @input=${t=>{e.host_address=t.target.value,this.requestUpdate()}}
                />
              `:""}
            `:J`
              <input
                type="text"
                placeholder="0000:01:00.0"
                .value=${e.host_address||""}
                @input=${t=>{e.host_address=t.target.value,this.requestUpdate()}}
              />
            `}

            <div class="help-text">
              PCI address on the host (e.g., 0000:01:00.0)
              ${t?J`<br><strong>IOMMU Group:</strong> ${t.iommu_group||"Unknown"}`:""}
            </div>
          </div>

          <div class="form-group">
            <label>Guest PCI Address (Optional)</label>
            <input
              type="text"
              placeholder="0000:05:00.0 (auto if empty)"
              .value=${e.guest_address||""}
              @input=${t=>{e.guest_address=t.target.value,this.requestUpdate()}}
            />
            <div class="help-text">PCI address in the guest VM</div>
          </div>
        </div>

        <div class="form-group">
          <label>ROM File (Optional)</label>
          <input
            type="text"
            placeholder="/usr/share/vgabios/nvidia.rom"
            .value=${e.rom_file||""}
            @input=${t=>{e.rom_file=t.target.value,this.requestUpdate()}}
          />
          <div class="help-text">Path to option ROM file (required for some GPUs to work properly)</div>
        </div>

        <div class="grid-2" style="margin-top: 12px;">
          <div class="checkbox-group">
            <input
              type="checkbox"
              id="pci-multifunction"
              ?checked=${!!e.multifunction}
              @change=${t=>{e.multifunction=t.target.checked,this.requestUpdate()}}
            />
            <label for="pci-multifunction">Multi-function device</label>
            <div class="help-text" style="margin-left: 24px;">Enable for devices with multiple functions (e.g., GPU with audio)</div>
          </div>

          <div class="checkbox-group">
            <input
              type="checkbox"
              id="pci-primary-gpu"
              ?checked=${!!e.primary_gpu}
              @change=${t=>{e.primary_gpu=t.target.checked,this.requestUpdate()}}
            />
            <label for="pci-primary-gpu">Primary GPU</label>
            <div class="help-text" style="margin-left: 24px;">Set as the primary display adapter</div>
          </div>
        </div>

        ${t&&"gpu"===t.device_type?J`
          <div class="help-text" style="margin-top: 12px; padding: 8px; background: var(--vscode-inputValidation-infoBackground); border-radius: 4px;">
            <strong>GPU Passthrough Tips:</strong>
            <ul style="margin: 4px 0; padding-left: 20px;">
              <li>Ensure the GPU is not being used by the host (blacklist driver or use vfio-pci)</li>
              <li>Consider passing through the audio device (usually at .1 address) as well</li>
              <li>You may need a ROM file for certain NVIDIA GPUs</li>
              <li>Enable "Primary GPU" if this will be the main display</li>
            </ul>
          </div>
        `:""}

        <div slot="footer" style="display: flex; justify-content: flex-end; gap: 8px;">
          <button class="btn-secondary" @click=${this.handlePCIDeviceModalClose}>Cancel</button>
          <button class="btn-primary" @click=${this.handlePCIDeviceModalSave}>${null!==this.editingPCIDeviceIndex?"Save":"Add"}</button>
        </div>
      </modal-dialog>
    `}async handleCreate(){for(let e=1;e<=5;e++)if(!this.validateStep(e))return void(this.currentStep=e);this.isCreating=!0;try{if(this.templateMode){const e=this.templateContext;if(!e)throw new Error("No template selected");const t=(this.formData.name||"").trim(),s=this.formData.memory,i=this.formData.vcpus,o=this.templateDiskSizeGB??void 0,r=this.formData.networks?.[0],a=this.formData.graphics?.[0],n=this.formData.cloud_init,l=this.formData.metadata,c=await Cw.createFromTemplate(e.id,{name:t,memory:s,vcpus:i,disk_size:o,network:r,graphics:a,cloud_init:n,metadata:l});return this.showNotification(`VM "${c.name}" created from template "${e.name}"`,"success"),this.dispatchEvent(new CustomEvent("vm-created",{detail:{vm:c,template:e},bubbles:!0,composed:!0})),Dw.closeWizard(),void(await Cw.fetchAll())}const t=localStorage.getItem("jwt_token")||localStorage.getItem("auth_token")||localStorage.getItem("token"),s=this.buildRequestPayload(),i=this.editMode&&this.editingVmId?e(`/virtualization/computes/${this.editingVmId}`):e("/virtualization/computes"),o=this.editMode&&this.editingVmId?"PUT":"POST",r=await fetch(i,{method:o,headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify(s)});if(!r.ok){const e=await r.json().catch(()=>null);throw e&&"error"===e.status&&e.error?new Error(e.error.message||e.error.details||"VM operation failed"):e&&e.message?new Error(e.message):new Error(`Failed to ${this.editMode?"update":"create"} virtual machine`)}this.showNotification(`Virtual machine ${this.editMode?"updated":"created"} successfully`,"success"),Dw.closeWizard(),await Cw.fetchAll()}catch(t){console.error(`Failed to ${this.editMode?"update":"create"} VM:`,t),this.showNotification(t instanceof Error?t.message:`Failed to ${this.editMode?"update":"create"} virtual machine`,"error")}finally{this.isCreating=!1}}updateFormData(e,t){const s=e.split(".");let i=this.formData;for(let r=0;r<s.length-1;r++){const e=s[r];e&&!i[e]&&(i[e]={}),e&&(i=i[e])}const o=s[s.length-1];o&&(i[o]=t),this.requestUpdate()}removeDisk(e){this.formData.storage?.disks&&(this.formData.storage.disks.splice(e,1),this.requestUpdate())}openAddNetworkModal(){this.templateMode&&(this.formData.networks?.length||0)>=1?this.showNotification("Only one network interface is supported in template mode","error"):(this.editingNetworkIndex=null,this.networkDraft={type:"network",source:"default",model:"virtio",mac:""},this.showNetworkModal=!0)}openEditNetworkModal(e){const t=this.formData.networks?.[e];t&&(this.editingNetworkIndex=e,this.networkDraft={type:t.type||"network",source:t.source||"",model:t.model||"virtio",mac:t.mac||""},this.showNetworkModal=!0)}handleNetworkModalClose(){this.showNetworkModal=!1,this.editingNetworkIndex=null,this.networkDraft=null}handleNetworkModalSave(){if(!this.networkDraft)return;const e={type:this.networkDraft.type,source:(this.networkDraft.source||"").trim()||void 0,model:this.networkDraft.model||"virtio",mac:(this.networkDraft.mac||"").trim()||void 0};"network"!==e.type&&"bridge"!==e.type&&"direct"!==e.type||e.source?(this.formData.networks||(this.formData.networks=[]),null!==this.editingNetworkIndex?this.formData.networks[this.editingNetworkIndex]=e:this.templateMode&&this.formData.networks.length>=1?this.formData.networks[0]=e:this.formData.networks.push(e),this.showNetworkModal=!1,this.networkDraft=null,this.editingNetworkIndex=null,this.requestUpdate()):this.showNotification("Network source is required","error")}removeNetwork(e){this.formData.networks&&(this.formData.networks.splice(e,1),this.requestUpdate())}openAddGraphicsModal(){this.templateMode&&(this.formData.graphics?.length||0)>=1?this.showNotification("Only one graphics device is supported in template mode","error"):(this.editingGraphicsIndex=null,this.graphicsDraft={type:"vnc",autoport:!0,listen:"0.0.0.0",port:void 0,password:""},this.showGraphicsModal=!0)}openEditGraphicsModal(e){const t=this.formData.graphics?.[e];t&&(this.editingGraphicsIndex=e,this.graphicsDraft={...t},this.showGraphicsModal=!0)}handleGraphicsModalClose(){this.showGraphicsModal=!1,this.graphicsDraft=null,this.editingGraphicsIndex=null}handleGraphicsModalSave(){if(!this.graphicsDraft)return;const e=this.graphicsDraft,t=e.type||"vnc";let s={type:t};if("none"!==t&&"egl-headless"!==t){const i=(e.listen||"").trim()||"0.0.0.0",o=!!e.autoport;s={type:t,listen:i,autoport:o,port:e.port?Number(e.port):void 0,password:(e.password||"").trim()||void 0},o&&(s.port=void 0)}this.formData.graphics||(this.formData.graphics=[]),null!==this.editingGraphicsIndex?this.formData.graphics[this.editingGraphicsIndex]=s:this.templateMode&&this.formData.graphics.length>=1?this.formData.graphics[0]=s:this.formData.graphics.push(s),this.showGraphicsModal=!1,this.graphicsDraft=null,this.editingGraphicsIndex=null,this.requestUpdate()}removeGraphics(e){this.formData.graphics&&(this.formData.graphics.splice(e,1),this.requestUpdate())}openAddPCIDeviceModal(){this.editingPCIDeviceIndex=null,this.pciHostSelection="",this.pciDraft={host_address:"",guest_address:"",rom_file:"",multifunction:!1,primary_gpu:!1},this.showPCIModal=!0}openEditPCIDeviceModal(e){const t=this.formData.pci_devices?.[e];if(!t)return;this.editingPCIDeviceIndex=e,this.pciDraft={...t};const s=t.host_address||"",i=this.availablePCIDevices.find(e=>e.pci_address===s);this.pciHostSelection=i?s:s?"custom":"",this.showPCIModal=!0}handlePCIDeviceModalClose(){this.showPCIModal=!1,this.pciDraft=null,this.editingPCIDeviceIndex=null,this.pciHostSelection=""}handlePCIDeviceModalSave(){if(!this.pciDraft)return;const e=(this.pciDraft.host_address||"").trim();if(!e)return void this.showNotification("Host PCI address is required","error");const t={host_address:e,guest_address:(this.pciDraft.guest_address||"").trim()||void 0,rom_file:(this.pciDraft.rom_file||"").trim()||void 0,multifunction:!!this.pciDraft.multifunction,primary_gpu:!!this.pciDraft.primary_gpu};this.formData.pci_devices||(this.formData.pci_devices=[]),t.primary_gpu&&this.formData.pci_devices.forEach((e,t)=>{null!==this.editingPCIDeviceIndex&&t==this.editingPCIDeviceIndex||(e.primary_gpu=!1)}),null!==this.editingPCIDeviceIndex?this.formData.pci_devices[this.editingPCIDeviceIndex]=t:this.formData.pci_devices.push(t),this.showPCIModal=!1,this.pciDraft=null,this.editingPCIDeviceIndex=null,this.pciHostSelection="",this.requestUpdate()}removePCIDevice(e){this.formData.pci_devices&&(this.formData.pci_devices.splice(e,1),this.requestUpdate())}showNotification(e,t="info"){this.dispatchEvent(new CustomEvent("show-notification",{detail:{message:e,type:t},bubbles:!0,composed:!0}))}getVolumesForPool(e){const t=this.volumesController.value||[];return e?t.filter(t=>t.pool_name===e):t}formatVolumeSize(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB","TB"][t]}generateDefaultVmName(){return`vm-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,6)}`.toLowerCase().replace(/[^a-z0-9-]/g,"")}renderBasicConfig(){const e=this.templateMode?this.templateContext:null,t=e?`Min: ${e.min_memory} MB, ${e.min_vcpus} vCPU, ${e.min_disk} GB`:"",s=e?`Recommended: ${e.recommended_memory??"-"} MB, ${e.recommended_vcpus??"-"} vCPU, ${e.recommended_disk??"-"} GB`:"";return J`
      <div class="section ${this.expandedSections.has("basic")?"expanded":""}">
        <div class="section-header" @click=${()=>this.toggleSection("basic")}>
          <div class="section-title">
            <span class="section-toggle">â¶</span>
            <span>Basic Configuration</span>
            <span class="badge">Required</span>
          </div>
        </div>
        <div class="section-content">
          ${e?J`
            <div
              style="margin-bottom: 12px; padding: 10px; border-radius: 6px; background: var(--vscode-inputValidation-infoBackground); border: 1px solid var(--vscode-inputValidation-infoBorder);"
            >
              <div style="font-weight: 600; margin-bottom: 4px;">Creating VM from template: ${e.name}</div>
              <div class="help-text">Only name, memory/vCPU, disk size, network, graphics, and cloud-init can be changed here. Other fields are controlled by the template.</div>
              <div class="help-text" style="margin-top: 6px;">${t}</div>
              <div class="help-text">${s}</div>
            </div>
          `:""}

          <div class="form-group">
            <label>VM Name <span class="required">*</span></label>
            <input
              type="text"
              placeholder="my-virtual-machine"
              .value=${this.formData.name||""}
              @input=${e=>this.updateFormData("name",e.target.value)}
            />
            ${this.validationErrors.name?J`
              <div class="error-message">${this.validationErrors.name}</div>
            `:J`
              <div class="help-text">Alphanumeric characters, hyphens, and underscores only</div>
            `}
          </div>

          <div class="grid-2">
            <div class="form-group">
              <label>Memory <span class="required">*</span></label>
              <div class="input-with-unit">
                <input
                  type="number"
                  min=${e?String(e.min_memory):"512"}
                  max="524288"
                  step="512"
                  .value=${String(this.formData.memory||2048)}
                  @input=${e=>this.updateFormData("memory",Number(e.target.value))}
                />
                <span class="unit">MB</span>
              </div>
              ${this.validationErrors.memory?J`
                <div class="error-message">${this.validationErrors.memory}</div>
              `:""}
            </div>

            <div class="form-group">
              <label>vCPUs <span class="required">*</span></label>
              <input
                type="number"
                min="1"
                max="128"
                .value=${String(this.formData.vcpus||2)}
                @input=${e=>this.updateFormData("vcpus",Number(e.target.value))}
              />
              ${this.validationErrors.vcpus?J`
                <div class="error-message">${this.validationErrors.vcpus}</div>
              `:""}
            </div>
          </div>

          <div class="grid-3">
            <div class="form-group">
              <label>OS Type</label>
              <select
                .value=${this.formData.os_type||"linux"}
                ?disabled=${this.templateMode}
                @change=${e=>this.updateFormData("os_type",e.target.value)}
              >
                <option value="linux">Linux</option>
                <option value="windows">Windows</option>
                <option value="freebsd">FreeBSD</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div class="form-group">
              <label>OS Variant</label>
              <os-variant-autocomplete
                .value=${this.formData.os_variant||""}
                .family=${this.formData.os_type||"linux"}
                placeholder="ubuntu22.04"
                ?disabled=${this.templateMode}
                @os-variant-change=${e=>this.updateFormData("os_variant",e.detail.value)}
              ></os-variant-autocomplete>
              <div class="help-text">e.g., ubuntu22.04, win11, rhel9</div>
            </div>

            <div class="form-group">
              <label>Architecture</label>
              <select
                .value=${this.formData.architecture||"x86_64"}
                ?disabled=${this.templateMode}
                @change=${e=>this.updateFormData("architecture",e.target.value)}
              >
                <option value="x86_64">x86_64</option>
                <option value="aarch64">ARM64</option>
                <option value="ppc64le">PowerPC</option>
                <option value="s390x">s390x</option>
              </select>
            </div>
          </div>

          <div class="grid-3">
            <div class="checkbox-group">
              <input
                type="checkbox"
                id="uefi"
                ?checked=${this.formData.uefi}
                ?disabled=${this.templateMode}
                @change=${e=>this.updateFormData("uefi",e.target.checked)}
              />
              <label for="uefi">Enable UEFI</label>
            </div>

            <div class="checkbox-group">
              <input
                type="checkbox"
                id="secure_boot"
                ?checked=${this.formData.secure_boot}
                ?disabled=${this.templateMode}
                @change=${e=>this.updateFormData("secure_boot",e.target.checked)}
              />
              <label for="secure_boot">Secure Boot</label>
            </div>

            <div class="checkbox-group">
              <input
                type="checkbox"
                id="tpm"
                ?checked=${this.formData.tpm}
                ?disabled=${this.templateMode}
                @change=${e=>this.updateFormData("tpm",e.target.checked)}
              />
              <label for="tpm">Enable TPM</label>
            </div>
          </div>

          <div class="checkbox-group">
            <input
              type="checkbox"
              id="autostart"
              ?checked=${this.formData.autostart}
                ?disabled=${this.templateMode}
              @change=${e=>this.updateFormData("autostart",e.target.checked)}
            />
            <label for="autostart">Autostart VM with host</label>
          </div>

          
        </div>
      </div>
    `}renderStorageConfig(){if(this.templateMode&&this.templateContext){const e=this.templateContext,t=e.recommended_disk??e.min_disk,s=this.templateDiskSizeGB??t;return J`
        <div class="section ${this.expandedSections.has("storage")?"expanded":""}">
          <div class="section-header" @click=${()=>this.toggleSection("storage")}>
            <div class="section-title">
              <span class="section-toggle">â¶</span>
              <span>Storage Configuration</span>
              <span class="badge">Required</span>
            </div>
          </div>
          <div class="section-content">
            <div class="form-group">
              <label>Disk Size (GB) <span class="required">*</span></label>
              ${this.validationErrors.disk_size?J`
                <div class="error-message">${this.validationErrors.disk_size}</div>
              `:""}

              <input
                type="number"
                min=${String(e.min_disk)}
                step="1"
                .value=${String(s)}
                @input=${e=>{const t=Number(e.target.value);this.templateDiskSizeGB=Number.isFinite(t)?t:null}}
              />
              <div class="help-text" style="margin-top: 6px;">
                Template min: ${e.min_disk} GB â¢ Recommended: ${e.recommended_disk??"-"} GB
              </div>
              <div class="help-text">
                Storage devices are derived from the template. In template mode, you can only override the disk size.
              </div>
            </div>
          </div>
        </div>
      `}return J`
      <div class="section ${this.expandedSections.has("storage")?"expanded":""}">
        <div class="section-header" @click=${()=>this.toggleSection("storage")}>
          <div class="section-title">
            <span class="section-toggle">â¶</span>
            <span>Storage Configuration</span>
            <span class="badge">Required</span>
          </div>
        </div>
        <div class="section-content">
          <div class="form-group">
            <label>Disks</label>
            ${this.validationErrors.storage_pool?J`
              <div class="error-message">${this.validationErrors.storage_pool}</div>
            `:""}

            ${this.formData.storage?.disks?.length?J`
              <div class="storage-table-wrapper">
                <table class="storage-table">
                  <thead>
                    <tr>
                      <th>Target</th>
                      <th>Type</th>
                      <th>Source</th>
                      <th>Format</th>
                      <th>Bus</th>
                      <th>Size</th>
                      <th>Status</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    ${this.formData.storage.disks.map((e,t)=>J`
                      <tr>
                        <td><span class="monospace">${e.target||"Auto"}</span></td>
                        <td>
                          <span class="storage-badge ${"cdrom"===e.device?"warning":""}">
                            ${(e.device||"disk").toUpperCase()}
                          </span>
                        </td>
                        <td>
                          <span class="monospace storage-path">
                            ${e.path||("create"===e.action?"New disk":"clone"===e.action&&e.clone_from||"-")}
                          </span>
                        </td>
                        <td>${(e.format||"qcow2").toUpperCase()}</td>
                        <td>${(e.bus||"virtio").toUpperCase()}</td>
                        <td>${"create"===e.action&&e.size?`${e.size} GB`:"N/A"}</td>
                        <td>
                          <span class="storage-badge ${e.readonly?"warning":"success"}">
                            ${e.readonly?"Read-Only":"Read/Write"}
                          </span>
                        </td>
                        <td>
                          <button
                            class="btn-icon-ghost"
                            title="Edit device"
                            @click=${()=>this.openEditDiskModal(t)}
                          >
                            â
                          </button>
                          <button
                            class="btn-remove btn-icon"
                            title="Remove device"
                            @click=${()=>this.removeDisk(t)}
                          >
                            â
                          </button>
                        </td>
                      </tr>
                    `)}
                  </tbody>
                </table>
              </div>
            `:J`<div class="help-text">No devices configured</div>`}

            <div class="btn-add-dropdown">
              <button class="btn-add" @click=${this.toggleAddDeviceMenu}>
                + Add Device
              </button>
              ${this.showAddDeviceMenu?J`
                <div class="btn-add-menu">
                  <button class="btn-add-menu-item" @click=${this.openAddDiskModal}>
                    Add Disk
                  </button>
                  <button class="btn-add-menu-item" @click=${this.openAddIsoModal}>
                    Add ISO/CD-ROM
                  </button>
                </div>
              `:null}
            </div>
            
          </div>
        </div>
      </div>
    `}renderNetworkConfig(){const e=this.networksController.value,t=e instanceof Map?Array.from(e.values()):Array.isArray(e)?e:[],s=Array.from(this.bridgesController.value||[]).filter(e=>"bridge"===e.type);return J`
      <div class="section ${this.expandedSections.has("network")?"expanded":""}">
        <div class="section-header" @click=${()=>this.toggleSection("network")}>
          <div class="section-title">
            <span class="section-toggle">â¶</span>
            <span>Network Configuration</span>
          </div>
        </div>
        <div class="section-content">
          <div class="form-group">
            <label>Network Interfaces</label>

            ${this.formData.networks?.length?J`
              <div class="storage-table-wrapper">
                <table class="storage-table">
                  <thead>
                    <tr>
                      <th>Type</th>
                      <th>Source</th>
                      <th>Model</th>
                      <th>MAC</th>
                      <th>Status</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    ${this.formData.networks.map((e,i)=>{const o=(e=>{if("network"===e.type){const s=t.find(t=>t.name===(e.source||""));return s?"active"===s.state?{label:"Active",className:"success"}:{label:"Inactive",className:"warning"}:{label:"Unknown",className:"warning"}}if("bridge"===e.type){const t=s.find(t=>t.name===(e.source||""));return t?"up"===t.state?{label:"Up",className:"success"}:{label:"Down",className:"warning"}:{label:"Unknown",className:"warning"}}return"user"===e.type?{label:"User Mode",className:"success"}:{label:"N/A",className:""}})(e);return J`
                        <tr>
                          <td>
                            <span class="storage-badge">${(e.type||"network").toUpperCase()}</span>
                          </td>
                          <td>
                            <span class="monospace storage-path">${e.source||"-"}</span>
                          </td>
                          <td>${(e.model||"virtio").toUpperCase()}</td>
                          <td><span class="monospace">${e.mac||"-"}</span></td>
                          <td>
                            <span class="storage-badge ${o.className}">${o.label}</span>
                          </td>
                          <td>
                            <button
                              class="btn-icon-ghost"
                              title="Edit device"
                              @click=${()=>this.openEditNetworkModal(i)}
                            >
                              â
                            </button>
                            <button
                              class="btn-remove btn-icon"
                              title="Remove device"
                              @click=${()=>this.removeNetwork(i)}
                            >
                              â
                            </button>
                          </td>
                        </tr>
                      `})}
                  </tbody>
                </table>
              </div>
            `:J`<div class="help-text">No devices configured</div>`}

            <div class="btn-add-dropdown">
              <button class="btn-add" @click=${this.openAddNetworkModal} ?disabled=${this.templateMode&&(this.formData.networks?.length||0)>=1}>
                + Add Device
              </button>
            </div>
          </div>

          <div class="form-group">
            <label>Graphics</label>

            ${this.formData.graphics?.length?J`
              <div class="storage-table-wrapper">
                <table class="storage-table">
                  <thead>
                    <tr>
                      <th>Type</th>
                      <th>Listen</th>
                      <th>Port</th>
                      <th>Auto Port</th>
                      <th>Password</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    ${this.formData.graphics.map((e,t)=>{const s="none"===e.type||"egl-headless"===e.type?"-":e.autoport?"Auto":e.port?String(e.port):"-",i="none"===e.type||"egl-headless"===e.type?"-":e.autoport?"Yes":"No",o="none"===e.type||"egl-headless"===e.type?"-":e.password?"Set":"None";return J`
                        <tr>
                          <td><span class="storage-badge">${(e.type||"vnc").toUpperCase()}</span></td>
                          <td><span class="monospace">${e.listen||"-"}</span></td>
                          <td><span class="monospace">${s}</span></td>
                          <td>
                            <span class="storage-badge ${"Yes"===i?"success":""}">${i}</span>
                          </td>
                          <td>
                            <span class="storage-badge ${"Set"===o?"warning":""}">${o}</span>
                          </td>
                          <td>
                            <button
                              class="btn-icon-ghost"
                              title="Edit device"
                              @click=${()=>this.openEditGraphicsModal(t)}
                            >
                              â
                            </button>
                            <button
                              class="btn-remove btn-icon"
                              title="Remove device"
                              @click=${()=>this.removeGraphics(t)}
                            >
                              â
                            </button>
                          </td>
                        </tr>
                      `})}
                  </tbody>
                </table>
              </div>
            `:J`<div class="help-text">No devices configured</div>`}

            <div class="btn-add-dropdown">
              <button class="btn-add" @click=${this.openAddGraphicsModal} ?disabled=${this.templateMode&&(this.formData.graphics?.length||0)>=1}>
                + Add Device
              </button>
            </div>
          </div>
        </div>
      </div>
    `}renderAdvancedConfig(){if(this.templateMode)return J`
        <div class="section ${this.expandedSections.has("advanced")?"expanded":""}">
          <div class="section-header" @click=${()=>this.toggleSection("advanced")}>
            <div class="section-title">
              <span class="section-toggle">â¶</span>
              <span>Advanced Configuration</span>
            </div>
          </div>
          <div class="section-content">
            <div
              class="help-text"
              style="padding: 10px; border-radius: 6px; background: var(--vscode-inputValidation-infoBackground); border: 1px solid var(--vscode-inputValidation-infoBorder);"
            >
              Advanced options are controlled by the template and are not editable in template mode.
            </div>
          </div>
        </div>
      `;const e=e=>this.availablePCIDevices.find(t=>t.pci_address===e);return J`
      <div class="section ${this.expandedSections.has("advanced")?"expanded":""}">
        <div class="section-header" @click=${()=>this.toggleSection("advanced")}>
          <div class="section-title">
            <span class="section-toggle">â¶</span>
            <span>Advanced Configuration</span>
          </div>
        </div>
        <div class="section-content">
          <div class="form-group">
            <label>PCI Device Passthrough</label>
            <div class="help-text">Configure PCI devices (GPUs, network cards, USB controllers) to pass through to the VM</div>

            ${this.isLoadingPCIDevices?J`
              <div class="list-container">
                <div class="help-text">Loading available PCI devices...</div>
              </div>
            `:J`
              ${this.formData.pci_devices?.length?J`
                <div class="storage-table-wrapper">
                  <table class="storage-table">
                    <thead>
                      <tr>
                        <th>Host</th>
                        <th>Device</th>
                        <th>Type</th>
                        <th>IOMMU</th>
                        <th>Flags</th>
                        <th>Guest</th>
                        <th>ROM</th>
                        <th>Status</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody>
                      ${this.formData.pci_devices.map((t,s)=>{const i=e(t.host_address),o=i?.device_type?String(i.device_type).toUpperCase():"-",r=i?i.is_available?{label:"Available",cls:"success"}:{label:"In Use",cls:"warning"}:{label:"Unknown",cls:"warning"},a=[];return t.primary_gpu&&a.push("Primary GPU"),t.multifunction&&a.push("Multi"),J`
                          <tr>
                            <td><span class="monospace">${t.host_address}</span></td>
                            <td>
                              <span class="monospace storage-path">
                                ${i?`${i.product_name||"Unknown"} (${i.vendor_name||"Unknown"})`:"-"}
                              </span>
                            </td>
                            <td><span class="storage-badge">${o}</span></td>
                            <td>${i?.iommu_group||"-"}</td>
                            <td>
                              ${a.length?a.map(e=>J`<span class="storage-badge warning" style="margin-right: 6px;">${e}</span>`):J`-`}
                            </td>
                            <td><span class="monospace">${t.guest_address||"-"}</span></td>
                            <td><span class="monospace storage-path">${t.rom_file||"-"}</span></td>
                            <td><span class="storage-badge ${r.cls}">${r.label}</span></td>
                            <td>
                              <button
                                class="btn-icon-ghost"
                                title="Edit device"
                                @click=${()=>this.openEditPCIDeviceModal(s)}
                              >
                                â
                              </button>
                              <button
                                class="btn-remove btn-icon"
                                title="Remove device"
                                @click=${()=>this.removePCIDevice(s)}
                              >
                                â
                              </button>
                            </td>
                          </tr>
                        `})}
                    </tbody>
                  </table>
                </div>
              `:J`<div class="help-text">No devices configured</div>`}

              <div class="btn-add-dropdown">
                <button class="btn-add" @click=${this.openAddPCIDeviceModal}>
                  + Add Device
                </button>
              </div>

              ${this.availablePCIDevices.length>0?J`
                <div class="help-text" style="margin-top: 12px;">
                  <strong>Available Devices:</strong> ${this.availablePCIDevices.filter(e=>e.is_available).length} of ${this.availablePCIDevices.length} devices available for passthrough
                </div>
              `:""}
            `}

            <div class="help-text" style="margin-top: 12px; padding: 12px; background: var(--vscode-inputValidation-warningBackground); border-radius: 4px;">
              <strong>â ï¸ Important:</strong> PCI passthrough requires:
              <ul style="margin: 4px 0; padding-left: 20px;">
                <li>IOMMU support enabled in BIOS (Intel VT-d or AMD-Vi)</li>
                <li>IOMMU enabled in kernel parameters (intel_iommu=on or amd_iommu=on)</li>
                <li>Devices must be in separate IOMMU groups or ACS override may be needed</li>
                <li>Host driver must be unbound from the device (use vfio-pci driver)</li>
              </ul>
            </div>
          </div>


        </div>
      </div>
    `}renderCloudInitConfig(){return J`
      <div class="section ${this.expandedSections.has("cloudinit")?"expanded":""}">
        <div class="section-header" @click=${()=>this.toggleSection("cloudinit")}>
          <div class="section-title">
            <span class="section-toggle">â¶</span>
            <span>Cloud-Init Configuration</span>
          </div>
        </div>
        <div class="section-content">
          <div class="tabs">
            <button class="tab active" data-tab="userdata">User Data</button>
            <button class="tab" data-tab="metadata">Meta Data</button>
            <button class="tab" data-tab="networkdata">Network Data</button>
            <button class="tab" data-tab="users">Users</button>
            <button class="tab" data-tab="packages">Packages</button>
          </div>

          <div class="tab-content active" data-content="userdata">
            <div class="form-group">
              <label>User Data (cloud-config)</label>
              <textarea
                class="code-editor"
                rows="15"
                placeholder="#cloud-config&#10;hostname: my-vm&#10;..."
                .value=${this.formData.cloud_init?.user_data||""}
                @input=${e=>{this.formData.cloud_init||(this.formData.cloud_init={}),this.formData.cloud_init.user_data=e.target.value,this.requestUpdate()}}
              ></textarea>
            </div>
          </div>

          <div class="tab-content" data-content="metadata">
            <div class="form-group">
              <label>Meta Data</label>
              <textarea
                class="code-editor"
                rows="10"
                placeholder="instance-id: i-123456&#10;local-hostname: my-vm&#10;..."
                .value=${this.formData.cloud_init?.meta_data||""}
                @input=${e=>{this.formData.cloud_init||(this.formData.cloud_init={}),this.formData.cloud_init.meta_data=e.target.value,this.requestUpdate()}}
              ></textarea>
            </div>
          </div>

          <div class="tab-content" data-content="networkdata">
            <div class="form-group">
              <label>Network Data</label>
              <textarea
                class="code-editor"
                rows="10"
                placeholder="version: 2&#10;ethernets:&#10;  eth0:&#10;    dhcp4: true"
                .value=${this.formData.cloud_init?.network_data||""}
                @input=${e=>{this.formData.cloud_init||(this.formData.cloud_init={}),this.formData.cloud_init.network_data=e.target.value,this.requestUpdate()}}
              ></textarea>
            </div>
          </div>

          <div class="tab-content" data-content="users">
            <div class="form-group">
              <label>SSH Keys</label>
              <textarea
                rows="5"
                placeholder="One SSH public key per line"
                .value=${this.formData.cloud_init?.ssh_keys?.join("\n")||""}
                @input=${e=>{this.formData.cloud_init||(this.formData.cloud_init={});const t=e.target.value;this.formData.cloud_init.ssh_keys=t?t.split("\n").filter(e=>e.trim()):[],this.requestUpdate()}}
              ></textarea>
            </div>
          </div>

          <div class="tab-content" data-content="packages">
            <div class="form-group">
              <label>Packages to Install</label>
              <textarea
                rows="5"
                placeholder="One package name per line"
                .value=${this.formData.cloud_init?.packages?.join("\n")||""}
                @input=${e=>{this.formData.cloud_init||(this.formData.cloud_init={});const t=e.target.value;this.formData.cloud_init.packages=t?t.split("\n").filter(e=>e.trim()):[],this.requestUpdate()}}
              ></textarea>
            </div>
          </div>
        </div>
      </div>
    `}renderReview(){const e=this.formData.storage?.disks||[],t=this.formData.networks||[],s=this.formData.graphics||[],i=this.formData.pci_devices||[],o=this.formData.cloud_init,r=!!o&&Object.keys(o).some(e=>o[e]&&(!Array.isArray(o[e])||o[e].length));return J`
      <div class="section expanded">
        <div class="section-header">
          <div class="section-title">
            <span>Review Configuration</span>
          </div>
        </div>
        <div class="section-content">
          <div class="tabs">
            <button class="tab active" data-tab="gui">Summary</button>
            <button class="tab" data-tab="json">JSON</button>
          </div>

          <div class="tab-content active" data-content="gui">
            <div class="form-group">
              <label>Basic</label>
              <div class="list-container">
                <div class="grid-2">
                  <div>
                    <div class="help-text">Name</div>
                    <div class="monospace">${this.formData.name||"-"}</div>
                  </div>
                  <div>
                    <div class="help-text">Architecture</div>
                    <div>${this.formData.architecture||"-"}</div>
                  </div>
                </div>

                <div class="grid-2" style="margin-top: 12px;">
                  <div>
                    <div class="help-text">Memory</div>
                    <div>${this.formData.memory||0} MB</div>
                  </div>
                  <div>
                    <div class="help-text">vCPUs</div>
                    <div>${this.formData.vcpus||0}</div>
                  </div>
                </div>

                <div class="grid-2" style="margin-top: 12px;">
                  <div>
                    <div class="help-text">OS Type</div>
                    <div>${this.formData.os_type||"-"}</div>
                  </div>
                  <div>
                    <div class="help-text">OS Variant</div>
                    <div>${this.formData.os_variant||"-"}</div>
                  </div>
                </div>

                <div style="margin-top: 12px;">
                  <span class="storage-badge ${this.formData.uefi?"success":""}" style="margin-right: 6px;">UEFI: ${this.formData.uefi?"On":"Off"}</span>
                  <span class="storage-badge ${this.formData.secure_boot?"success":""}" style="margin-right: 6px;">Secure Boot: ${this.formData.secure_boot?"On":"Off"}</span>
                  <span class="storage-badge ${this.formData.tpm?"success":""}" style="margin-right: 6px;">TPM: ${this.formData.tpm?"On":"Off"}</span>
                  <span class="storage-badge ${this.formData.autostart?"success":""}">Autostart: ${this.formData.autostart?"On":"Off"}</span>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label>Storage</label>
              ${e.length?J`
                <div class="storage-table-wrapper">
                  <table class="storage-table">
                    <thead>
                      <tr>
                        <th>Target</th>
                        <th>Type</th>
                        <th>Source</th>
                        <th>Format</th>
                        <th>Bus</th>
                        <th>Size</th>
                        <th>Status</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${e.map(e=>J`
                        <tr>
                          <td><span class="monospace">${e.target||"Auto"}</span></td>
                          <td><span class="storage-badge ${"cdrom"===e.device?"warning":""}">${(e.device||"disk").toUpperCase()}</span></td>
                          <td><span class="monospace storage-path">${e.path||("create"===e.action?"New disk":"clone"===e.action&&e.clone_from||"-")}</span></td>
                          <td>${(e.format||"qcow2").toUpperCase()}</td>
                          <td>${(e.bus||"virtio").toUpperCase()}</td>
                          <td>${"create"===e.action&&e.size?`${e.size} GB`:"N/A"}</td>
                          <td><span class="storage-badge ${e.readonly?"warning":"success"}">${e.readonly?"Read-Only":"Read/Write"}</span></td>
                        </tr>
                      `)}
                    </tbody>
                  </table>
                </div>
              `:J`<div class="help-text">No disks configured</div>`}
            </div>

            <div class="form-group">
              <label>Network Interfaces</label>
              ${t.length?J`
                <div class="storage-table-wrapper">
                  <table class="storage-table">
                    <thead>
                      <tr>
                        <th>Type</th>
                        <th>Source</th>
                        <th>Model</th>
                        <th>MAC</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${t.map(e=>J`
                        <tr>
                          <td><span class="storage-badge">${(e.type||"network").toUpperCase()}</span></td>
                          <td><span class="monospace storage-path">${e.source||"-"}</span></td>
                          <td>${(e.model||"virtio").toUpperCase()}</td>
                          <td><span class="monospace">${e.mac||"-"}</span></td>
                        </tr>
                      `)}
                    </tbody>
                  </table>
                </div>
              `:J`<div class="help-text">No network interfaces configured</div>`}
            </div>

            <div class="form-group">
              <label>Graphics</label>
              ${s.length?J`
                <div class="storage-table-wrapper">
                  <table class="storage-table">
                    <thead>
                      <tr>
                        <th>Type</th>
                        <th>Listen</th>
                        <th>Port</th>
                        <th>Auto Port</th>
                        <th>Password</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${s.map(e=>{const t="none"===e.type||"egl-headless"===e.type?"-":e.autoport?"Auto":e.port?String(e.port):"-",s="none"===e.type||"egl-headless"===e.type?"-":e.autoport?"Yes":"No",i="none"===e.type||"egl-headless"===e.type?"-":e.password?"Set":"None";return J`
                          <tr>
                            <td><span class="storage-badge">${(e.type||"vnc").toUpperCase()}</span></td>
                            <td><span class="monospace">${e.listen||"-"}</span></td>
                            <td><span class="monospace">${t}</span></td>
                            <td>${s}</td>
                            <td>${i}</td>
                          </tr>
                        `})}
                    </tbody>
                  </table>
                </div>
              `:J`<div class="help-text">No graphics configured</div>`}
            </div>

            <div class="form-group">
              <label>PCI Devices</label>
              ${i.length?J`
                <div class="storage-table-wrapper">
                  <table class="storage-table">
                    <thead>
                      <tr>
                        <th>Host</th>
                        <th>Guest</th>
                        <th>ROM</th>
                        <th>Flags</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${i.map(e=>{const t=[];return e.primary_gpu&&t.push("Primary GPU"),e.multifunction&&t.push("Multi"),J`
                          <tr>
                            <td><span class="monospace">${e.host_address}</span></td>
                            <td><span class="monospace">${e.guest_address||"-"}</span></td>
                            <td><span class="monospace storage-path">${e.rom_file||"-"}</span></td>
                            <td>${t.length?t.join(", "):"-"}</td>
                          </tr>
                        `})}
                    </tbody>
                  </table>
                </div>
              `:J`<div class="help-text">No PCI devices configured</div>`}
            </div>

            <div class="form-group">
              <label>Cloud-Init</label>
              <div class="list-container">
                <div style="margin-bottom: 8px;">
                  <span class="storage-badge ${r?"success":""}">${r?"Enabled":"Not configured"}</span>
                </div>
                <div class="grid-2">
                  <div>
                    <div class="help-text">Users</div>
                    <div>${o?.users?.length||0}</div>
                  </div>
                  <div>
                    <div class="help-text">Packages</div>
                    <div>${o?.packages?.length||0}</div>
                  </div>
                </div>
                <div class="grid-2" style="margin-top: 12px;">
                  <div>
                    <div class="help-text">SSH Keys</div>
                    <div>${o?.ssh_keys?.length||0}</div>
                  </div>
                  <div>
                    <div class="help-text">Raw user-data</div>
                    <div>${o?.user_data?"Yes":"No"}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="tab-content" data-content="json">
            <div class="form-group">
              <label>Configuration JSON</label>
              <textarea
                class="code-editor"
                rows="20"
                readonly
                .value=${JSON.stringify(this.formData,null,2)}
              ></textarea>
            </div>
          </div>
        </div>
      </div>
    `}render(){const e=this.wizardController.value,t=e.openId??0;if(t!==this.lastInitializedOpenId){this.lastInitializedOpenId=t,this.currentStep=1,this.validationErrors={},this.editMode=!!e.editMode,this.editingVmId=e.editingVmId||null,this.templateMode=!!e.templateMode,this.templateContext=e.templateContext||null;const s=this.buildDefaultFormData();if(this.editMode&&e.formData&&Object.keys(e.formData).length>0){const t=e.formData;this.formData={...s,...t,networks:t.network?[{type:t.network.type,source:t.network.source,model:t.network.model,mac:t.network.mac}]:s.networks,graphics:t.graphics?[t.graphics]:s.graphics},this.templateDiskSizeGB=null}else if(this.templateMode&&this.templateContext){const t=this.templateContext,i=e.formData||{},o=t.network_model||"virtio",r=t.graphics_type||"vnc";this.formData={...s,...i,os_type:t.os_type||s.os_type,os_variant:t.os_variant||s.os_variant,uefi:!!t.uefi_boot,secure_boot:!!t.secure_boot,tpm:!!t.tpm,networks:[{type:"network",source:s.networks?.[0]?.source||"default",model:o}],graphics:[{type:r,autoport:!0,listen:"0.0.0.0"}]},this.templateDiskSizeGB=t.recommended_disk??t.min_disk}else this.formData={...s,...e.formData||{}},this.templateDiskSizeGB=null}if(e.isOpen?this.setAttribute("show",""):this.removeAttribute("show"),!e.isOpen)return J``;return setTimeout(()=>{const e=this.shadowRoot?.querySelectorAll(".tab"),t=this.shadowRoot?.querySelectorAll(".tab-content");e?.forEach(s=>{s.addEventListener("click",s=>{const i=s.currentTarget,o=i.dataset.tab;e.forEach(e=>e.classList.remove("active")),t?.forEach(e=>e.classList.remove("active")),i.classList.add("active"),this.shadowRoot?.querySelector(`[data-content="${o}"]`)?.classList.add("active")})})},0),J`
      <div class="drawer">
        <div class="drawer-header">
          <h2 class="header-title">
            <span>ð¥ï¸</span>
            ${this.editMode?"Edit":this.templateMode?"Create from Template":"Create"} Virtual Machine (Enhanced)
          </h2>
          <button 
            class="close-button" 
            @click=${this.handleClose}
            ?disabled=${this.isCreating}
            aria-label="Close"
          >
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>

        <div class="wizard-steps">
          ${[{number:1,label:"Basic"},{number:2,label:"Storage"},{number:3,label:"Network"},{number:4,label:"Advanced"},{number:5,label:"Cloud-Init"},{number:6,label:"Review"}].map(e=>J`
            <div 
              class="step ${this.currentStep===e.number?"active":""} ${this.currentStep>e.number?"completed":""}"
              @click=${()=>this.goToStep(e.number)}
            >
              <div class="step-number">
                ${this.currentStep>e.number?"â":e.number}
              </div>
              <span>${e.label}</span>
            </div>
          `)}
        </div>

        <div class="content">
          <div class="wizard-body">
            ${1===this.currentStep?this.renderBasicConfig():2===this.currentStep?this.renderStorageConfig():3===this.currentStep?this.renderNetworkConfig():4===this.currentStep?this.renderAdvancedConfig():5===this.currentStep?this.renderCloudInitConfig():6===this.currentStep?this.renderReview():J`<div>Invalid step</div>`}
          </div>
        </div>

        <div class="controls">
          <button class="btn-ghost" @click=${this.handleClose}>
            Cancel
          </button>
          
          <div style="display: flex; gap: 8px;">
            <button 
              class="btn-secondary" 
              @click=${this.handlePrevious}
              ?disabled=${1===this.currentStep}
            >
              Previous
            </button>
            
            ${this.currentStep<6?J`
              <button 
                class="btn-primary" 
                @click=${this.handleNext}
              >
                Next
              </button>
            `:J`
              <button 
                class="btn-primary" 
                @click=${this.handleCreate}
                ?disabled=${this.isCreating}
              >
                ${this.isCreating?this.editMode?"Updating...":"Creating...":this.editMode?"Update VM":"Create VM"}
              </button>
            `}
          </div>
        </div>
      </div>

      ${this.renderDeviceModal()}

      ${this.renderNetworkModal()}

      ${this.renderGraphicsModal()}

      ${this.renderPCIDeviceModal()}

      ${this.showCloseConfirmation?J`
        <delete-modal
          .show=${this.showCloseConfirmation}
          .item=${{type:"Form",name:this.formData.name||"Unsaved VM"}}
          modal-title="Discard Changes?"
          message="Are you sure you want to close? All unsaved changes will be lost."
          confirm-label="Discard"
          confirm-button-class="delete"
          @confirm-delete=${this.handleConfirmClose}
          @cancel-delete=${this.handleCancelClose}
        ></delete-modal>
      `:""}
    `}};sx.styles=g`
    :host {
      display: block;
      position: fixed;
      top: 0;
      right: 0;
      width: 900px;
      height: 100vh;
      z-index: 1000;
      pointer-events: none;
    }

    :host([show]) {
      pointer-events: auto;
    }

    .drawer {
      width: 100%;
      height: 100%;
      background: var(--vscode-editor-background, #1e1e1e);
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      transform: translateX(100%);
      transition: transform 0.3s ease-out;
      border-left: 1px solid var(--vscode-border);
    }

    :host([show]) .drawer {
      transform: translateX(0);
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0.8;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0.8;
      }
    }

    :host(:not([show])) .drawer {
      animation: slideOut 0.3s ease-in;
    }

    @media (max-width: 1200px) {
      :host {
        width: 75%;
      }
    }

    @media (max-width: 768px) {
      :host {
        width: 100%;
      }
    }

    .drawer-header {
      padding: 20px;
      background: var(--vscode-bg-lighter, #2c2f3a);
      border-bottom: 1px solid var(--vscode-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .header-title {
      font-size: 18px;
      font-weight: 500;
      color: var(--vscode-foreground);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .wizard-steps {
      display: flex;
      gap: 16px;
      padding: 16px 20px;
      border-bottom: 1px solid var(--vscode-border);
      background: var(--vscode-bg-lighter, #2c2f3a);
      flex-shrink: 0;
      overflow-x: auto;
    }

    .step {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--vscode-descriptionForeground);
      font-size: 13px;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .step:hover {
      background: var(--vscode-toolbar-hoverBackground);
    }

    .step.active {
      color: var(--vscode-foreground);
      font-weight: 500;
      background: var(--vscode-list-activeSelectionBackground);
    }

    .step.completed {
      color: var(--vscode-charts-green);
    }

    .step-number {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--vscode-button-secondaryBackground);
      border: 2px solid var(--vscode-button-border);
      font-size: 12px;
      font-weight: 600;
    }

    .step.active .step-number {
      background: var(--vscode-button-background);
      color: var(--vscode-button-foreground);
      border-color: var(--vscode-button-background);
    }

    .step.completed .step-number {
      background: var(--vscode-charts-green);
      color: white;
      border-color: var(--vscode-charts-green);
    }

    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .wizard-body {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
      background: var(--vscode-editor-background);
    }

    .controls {
      padding: 20px;
      border-top: 1px solid var(--vscode-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      background: var(--vscode-bg-lighter, #2c2f3a);
      flex-shrink: 0;
    }

    /* Collapsible sections */
    .section {
      margin-bottom: 24px;
      border: 1px solid var(--vscode-border);
      border-radius: 6px;
      overflow: visible;
    }

    .section-header {
      padding: 12px 16px;
      background: var(--vscode-editor-inactiveSelectionBackground);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      user-select: none;
      transition: background 0.2s;
    }

    .section-header:hover {
      background: var(--vscode-list-hoverBackground);
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
      color: var(--vscode-foreground);
    }

    .section-toggle {
      transition: transform 0.2s;
    }

    .section.expanded .section-toggle {
      transform: rotate(90deg);
    }

    .section-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .section.expanded .section-content {
      max-height: none;
      padding: 16px;
      overflow: visible;
    }

    /* Form elements */
    .form-group {
      margin-bottom: 20px;
      width: 100%;
      box-sizing: border-box;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 13px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
    }

    .required {
      color: var(--vscode-errorForeground, #f48771);
    }

    input,
    select,
    textarea {
      width: 100%;
      max-width: 100%;
      padding: 8px 12px;
      background: var(--vscode-input-background, #3c3c3c);
      color: var(--vscode-input-foreground, #cccccc);
      border: 1px solid var(--vscode-input-border, #858585);
      border-radius: 4px;
      font-size: 13px;
      font-family: inherit;
      transition: all 0.2s;
      box-sizing: border-box;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--vscode-focusBorder, #007acc);
      box-shadow: 0 0 0 1px var(--vscode-focusBorder, #007acc);
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    input[type="checkbox"] {
      width: auto;
      margin: 0;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .grid-3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }

    /* Lists */
    .list-container {
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      padding: 12px;
      margin-bottom: 16px;
      background: var(--vscode-bg-lighter, #2d2d30);
    }

    .list-item {
      padding: 12px;
      background: var(--vscode-editor-background);
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: start;
    }

    .list-item-content {
      flex: 1;
    }

    .list-item-actions {
      display: flex;
      gap: 8px;
    }

    .storage-table-wrapper {
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      margin-bottom: 16px;
      background: transparent;
      overflow-x: auto;
    }

    .storage-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .storage-table th {
      text-align: left;
      padding: 8px 12px;
      background: var(--vscode-bg-lighter, #2d2d30);
      color: var(--vscode-foreground);
      font-weight: 600;
      border-bottom: 1px solid var(--vscode-border);
    }

    .storage-table td {
      padding: 8px 12px;
      color: var(--vscode-foreground, #cccccc);
      border-bottom: 1px solid var(--vscode-border);
      vertical-align: middle;
      white-space: nowrap;
    }

    .storage-table tr:hover {
      background: var(--vscode-list-hoverBackground, rgba(90, 93, 94, 0.1));
    }

    .storage-path {
      font-size: 11px;
      word-break: break-all;
      white-space: normal;
    }

    .storage-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 3px;
      font-size: 11px;
      font-weight: 500;
      background: var(--vscode-badge-background, #4d4d4d);
      color: var(--vscode-badge-foreground, #ffffff);
    }

    .storage-badge.success {
      background: var(--vscode-charts-green, #89d185);
      color: var(--vscode-editor-background, #1e1e1e);
    }

    .storage-badge.warning {
      background: var(--vscode-charts-yellow, #cca700);
      color: var(--vscode-editor-background, #1e1e1e);
    }

    .btn-icon {
      padding: 4px 8px;
      font-size: 12px;
    }

    .btn-icon-ghost {
      padding: 4px 8px;
      font-size: 12px;
      margin-right: 6px;
      background: transparent;
      color: var(--vscode-foreground, #cccccc);
      border: 1px solid var(--vscode-widget-border, #454545);
    }

    .btn-icon-ghost:hover:not(:disabled) {
      background: var(--vscode-list-hoverBackground, rgba(90, 93, 94, 0.1));
    }

    .monospace {
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
    }

    /* Buttons */
    button {
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
      font-family: inherit;
    }

    button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .btn-primary {
      background: var(--vscode-button-background, #0e639c);
      color: var(--vscode-button-foreground, #ffffff);
      border: 1px solid var(--vscode-button-background, #0e639c);
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--vscode-button-hoverBackground, #1177bb);
      border-color: var(--vscode-button-hoverBackground, #1177bb);
    }

    .btn-secondary {
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border: 1px solid var(--vscode-button-border, #5a5a5a);
    }

    .btn-ghost {
      background: transparent;
      color: var(--vscode-foreground);
    }

    .btn-add {
      background: transparent;
      color: var(--vscode-textLink-foreground, #3794ff);
      border: 1px dashed var(--vscode-textLink-foreground, #3794ff);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-add:hover {
      background: var(--vscode-textLink-foreground, #3794ff);
      color: white;
      border-style: solid;
    }

    .btn-add-dropdown {
      position: relative;
      display: inline-block;
    }

    .btn-add-menu {
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 4px;
      background: var(--vscode-editor-background, #1e1e1e);
      border: 1px solid var(--vscode-dropdown-border, #3c3c3c);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      z-index: 10;
      min-width: 160px;
    }

    .btn-add-menu-item {
      width: 100%;
      padding: 6px 10px;
      background: transparent;
      border: none;
      color: inherit;
      text-align: left;
      cursor: pointer;
      font-size: 12px;
    }

    .btn-add-menu-item:hover {
      background: var(--vscode-list-hoverBackground, #2a2d2e);
    }

    .btn-remove {
      padding: 4px 8px;
      background: var(--vscode-inputValidation-errorBackground);
      color: var(--vscode-inputValidation-errorForeground);
      border: none;
      font-size: 12px;
    }

    .close-button {
      background: none;
      border: none;
      color: var(--close-color, #999);
      cursor: pointer;
      padding: 8px;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .close-button:hover {
      background: var(--close-hover-bg, rgba(255, 255, 255, 0.1));
      color: var(--close-hover-color, #e0e0e0);
    }

    .help-text {
      margin-top: 6px;
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #8b8b8b);
      line-height: 1.4;
    }

    .error-message {
      margin-top: 6px;
      font-size: 12px;
      color: var(--vscode-errorForeground, #f48771);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    /* Code editor */
    .code-editor {
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 12px;
      line-height: 1.5;
      min-height: 200px;
      background: var(--vscode-editor-background);
      border: 1px solid var(--vscode-widget-border);
      border-radius: 4px;
      padding: 12px;
    }

    /* Tabs for sub-sections */
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      border-bottom: 1px solid var(--vscode-widget-border);
    }

    .tab {
      padding: 8px 16px;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: var(--vscode-foreground);
      cursor: pointer;
      transition: all 0.2s;
    }

    .tab:hover {
      background: var(--vscode-toolbar-hoverBackground);
    }

    .tab.active {
      border-bottom-color: var(--vscode-focusBorder);
      color: var(--vscode-textLink-foreground);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Badge */
    .badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 11px;
      font-weight: 500;
      background: var(--vscode-badge-background);
      color: var(--vscode-badge-foreground);
    }

    .input-with-unit {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .input-with-unit input {
      flex: 1;
    }

    .unit {
      padding: 8px 12px;
      background: var(--vscode-button-secondaryBackground);
      border: 1px solid var(--vscode-input-border);
      border-radius: 4px;
      font-size: 13px;
      color: var(--vscode-descriptionForeground);
      white-space: nowrap;
    }
  `,tx([xe()],sx.prototype,"isCreating",2),tx([xe()],sx.prototype,"showAddDeviceMenu",2),tx([xe()],sx.prototype,"showDeviceModal",2),tx([xe()],sx.prototype,"deviceModalMode",2),tx([xe()],sx.prototype,"deviceDraft",2),tx([xe()],sx.prototype,"editingDiskIndex",2),tx([xe()],sx.prototype,"showNetworkModal",2),tx([xe()],sx.prototype,"networkDraft",2),tx([xe()],sx.prototype,"editingNetworkIndex",2),tx([xe()],sx.prototype,"showGraphicsModal",2),tx([xe()],sx.prototype,"graphicsDraft",2),tx([xe()],sx.prototype,"editingGraphicsIndex",2),tx([xe()],sx.prototype,"showPCIModal",2),tx([xe()],sx.prototype,"pciDraft",2),tx([xe()],sx.prototype,"editingPCIDeviceIndex",2),tx([xe()],sx.prototype,"pciHostSelection",2),tx([xe()],sx.prototype,"validationErrors",2),tx([xe()],sx.prototype,"expandedSections",2),tx([xe()],sx.prototype,"currentStep",2),tx([xe()],sx.prototype,"availablePCIDevices",2),tx([xe()],sx.prototype,"isLoadingPCIDevices",2),tx([xe()],sx.prototype,"editMode",2),tx([xe()],sx.prototype,"editingVmId",2),tx([xe()],sx.prototype,"templateMode",2),tx([xe()],sx.prototype,"templateContext",2),tx([xe()],sx.prototype,"templateDiskSizeGB",2),tx([xe()],sx.prototype,"showCloseConfirmation",2),tx([xe()],sx.prototype,"formData",2),sx=tx([ve("create-vm-wizard-enhanced")],sx);var ix=Object.defineProperty,ox=Object.getOwnPropertyDescriptor,rx=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?ox(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&ix(t,s,r),r};let ax=class extends me{constructor(){super(...arguments),this.notificationContainer=null,this.handleShowNotification=e=>{const t=e.detail||{},s=t.message??"",i=t.type??"info",o=t.duration;this.notificationContainer&&"function"==typeof this.notificationContainer.addNotification&&s&&(this.notificationContainer.addNotification({message:s,type:i,duration:o}),e.stopPropagation())},this.vmStoreController=new Zl.StoreController(this,Oy.$items),this.virtualizationEnabledController=new Zl.StoreController(this,Ay),this.virtualizationDisabledMessageController=new Zl.StoreController(this,Iy),this.filteredVMsController=new Zl.StoreController(this,bw),this.searchQueryController=new Zl.StoreController(this,tw),this.showDeleteModal=!1,this.vmToDelete=null,this.isDeleting=!1,this.showDetailsDrawer=!1,this.useEnhancedWizard=!0,this.activeMainTab="vms",this.stateFilter="all",this.templates=[],this.selectedVMForDetails=null,this.vmEventsLive=!1,this.unsubscribeVmEvents=null,this.vmPollingTimer=null,this.vmRefetchTimer=null,this.vmStaleCheckTimer=null,this.vmLastEventAt=0,this.vmDropNotified=!1,this.vmHasConnectedOnce=!1,this.showTemplateDrawer=!1,this.templateDrawerMode="create",this.editingTemplateId=null,this.isSavingTemplate=!1,this.templateForm={name:"",description:"",os_type:"linux",os_variant:"",min_memory:"1024",recommended_memory:"",min_vcpus:"1",recommended_vcpus:"",min_disk:"10",recommended_disk:"",disk_format:"",network_model:"",graphics_type:"",cloud_init:!1,uefi_boot:!1,secure_boot:!1,tpm:!1,default_user:"",metadata_json:""},this.templateFormErrors={},this.showTemplateDeleteModal=!1,this.templateToDelete=null,this.isDeletingTemplate=!1,this.showCreateTemplateFromVmModal=!1,this.vmForTemplateCreation=null,this.templateFromVmName="",this.templateFromVmDescription="",this.isCreatingTemplateFromVm=!1,this.tabs=[{id:"vms",label:"Virtual Machines"},{id:"templates",label:"Templates"}]}mapEnhancedVmToFormData(e){const t=Array.isArray(e.storage?.disks)?e.storage.disks.map(e=>({action:"attach",size:e.size,format:"vmdk"===e.format?"qcow2":e.format,storage_pool:e.storage_pool,path:e.source_path||e.path,bus:e.bus,device:e.device,target:e.target,readonly:!!e.readonly})):[],s=Array.isArray(e.networks)&&e.networks.length>0?e.networks[0]:void 0,i=s?{type:s.type,source:s.source&&(s.source.network||s.source.bridge||s.source.dev)||s.source||"",model:s.model&&s.model.type||s.model||"virtio",mac:s.mac}:void 0,o=Array.isArray(e.graphics)&&e.graphics.length>0?e.graphics[0]:void 0,r=o?{type:o.type,port:o.port,password:o.password,autoport:o.autoport??!0,listen:o.listen||"0.0.0.0"}:void 0;return{name:e.name,memory:e.memory,vcpus:e.vcpus,storage:{default_pool:e.storage?.default_pool||"",boot_iso:e.storage?.boot_iso,disks:t},os_type:e.os_type,architecture:e.architecture,uefi:e.uefi,secure_boot:e.secure_boot,tpm:e.tpm,autostart:e.autostart,network:i,graphics:r,metadata:e.metadata}}async connectedCallback(){super.connectedCallback(),await this.initializeData(),this.startVmEventStream()}disconnectedCallback(){super.disconnectedCallback(),this.stopVmEventStream()}firstUpdated(e){this.notificationContainer=this.renderRoot.querySelector("notification-container"),this.addEventListener("show-notification",this.handleShowNotification)}async initializeData(){try{await async function(){try{await Promise.all([Oy.fetch(),By.fetch(),Uy.fetch(),Hy.fetch(),Ky.fetch(),Jy.fetch()])}catch(e){console.error("Failed to initialize virtualization stores:",e)}}(),Hy.$items.subscribe(e=>{if(e)if(e instanceof Map){const t=[];e.forEach(e=>{e&&"object"==typeof e&&t.push(e)}),this.templates=t}else if(Array.isArray(e))this.templates=e.filter(e=>e&&"object"==typeof e);else if("object"==typeof e&&null!==e){const t=Object.values(e);this.templates=t.filter(e=>null!==e&&"object"==typeof e)}})}catch(e){console.error("Failed to initialize virtualization stores:",e),e instanceof uy||this.showNotification("Failed to load virtual machines","error")}}getColumns(){return"templates"===this.activeMainTab?[{key:"name",label:"Name",type:"link"},{key:"os",label:"OS"},{key:"memory",label:"Memory (MB)"},{key:"vcpus",label:"vCPUs"},{key:"disk",label:"Disk (GB)"},{key:"flags",label:"Flags"},{key:"updated",label:"Updated"}]:[{key:"name",label:"Name",type:"link"},{key:"state",label:"State",type:"status"},{key:"vcpus",label:"vCPUs"},{key:"memory",label:"Memory (MB)"},{key:"disk_size",label:"Disk (GB)"},{key:"os_type",label:"Operating System"},{key:"created_at",label:"Created"}]}formatMemory(e){return e>=1024?`${(e/1024).toFixed(1)} GB`:`${e} MB`}formatDiskSize(e){return e>=1024?`${(e/1024).toFixed(1)} TB`:`${e} GB`}renderStateCell(e){return J`
      <span class="state-badge ${e}">
        ${e}
      </span>
    `}getActions(e){const t=[{label:"View Details",action:"view",icon:"â¹ï¸"}],s=e.state?.toLowerCase();switch(s){case"running":t.push({label:"Console",action:"console",icon:"ð»"},{label:"Stop",action:"stop",icon:"â¹ï¸"},{label:"Pause",action:"pause",icon:"â¸ï¸"},{label:"Restart",action:"restart",icon:"ð"});break;case"stopped":case"shutoff":case"stop":t.push({label:"Start",action:"start",icon:"â¶ï¸"},{label:"Edit",action:"edit",icon:"âï¸"},{label:"Clone",action:"clone",icon:"ð"}),t.push({label:"Delete",action:"delete",icon:"ðï¸",danger:!0});break;case"paused":t.push({label:"Resume",action:"resume",icon:"â¶ï¸"},{label:"Stop",action:"stop",icon:"â¹ï¸"});break;case"suspended":t.push({label:"Resume",action:"resume",icon:"â¶ï¸"})}return t.push({label:"Snapshot",action:"snapshot",icon:"ð¸"},{label:"Create Template",action:"create-template",icon:"ð"}),t}async handleTabChange(e){const t=e.detail.tabId;this.activeMainTab=t,"templates"===t?await $w.fetchAll():await Cw.fetchAll()}handleStateFilterChange(e){this.stateFilter=e.detail.value,"all"===this.stateFilter?sw.set({}):sw.set({state:[this.stateFilter]})}handleSearchChange(e){tw.set(e.detail.value)}handleCellClick(e){const{column:t,item:s}=e.detail;"name"===t.key&&("vms"!==this.activeMainTab?this.openEditTemplateDrawer(s):this.showVMDetails(s))}async handleAction(e){const{action:t,item:s}=e.detail;if("templates"===this.activeMainTab)return void(await this.handleTemplateAction(t,s));const i=s;try{switch(t){case"view":this.showVMDetails(i);break;case"console":await this.openConsole(i);break;case"start":await Cw.start(i.id),this.showNotification(`Starting VM: ${i.name}`,"success");break;case"stop":await Cw.stop(i.id),this.showNotification(`Stopping VM: ${i.name}`,"success");break;case"pause":await Cw.pause(i.id),this.showNotification(`Pausing VM: ${i.name}`,"success");break;case"resume":await Cw.resume(i.id),this.showNotification(`Resuming VM: ${i.name}`,"success");break;case"restart":await Cw.restart(i.id),this.showNotification(`Restarting VM: ${i.name}`,"success");break;case"edit":await this.editVM(i);break;case"clone":await this.cloneVM(i);break;case"snapshot":await this.createSnapshot(i);break;case"create-template":this.openCreateTemplateFromVmModal(i);break;case"delete":this.confirmDeleteVM(i)}}catch(o){console.error(`Failed to execute action ${t}:`,o),this.showNotification(`Failed to ${t} VM: ${o instanceof Error?o.message:"Unknown error"}`,"error")}}showVMDetails(e){this.selectedVMForDetails=e,this.showDetailsDrawer=!0}async openConsole(e){try{const t=await Tw.getVNC(e.id);if(!t||!t.token)throw new Error("Failed to obtain console access token");const s=Tw.getVNCWebSocketUrl(e.id,t.token),i=`/vnc-console.html?url=${encodeURIComponent(s)}&fullscreen=true&vmName=${encodeURIComponent(e.name||e.id)}`;window.open(i,"_blank")}catch(t){console.error("Failed to open console:",t),this.showNotification("Failed to open console","error")}}async editVM(e){try{const t=await yy.getVM(e.id),s=t?.data||t;if(s&&"object"==typeof s){const t=this.mapEnhancedVmToFormData(s);return void Dw.openEnhancedWizardForEdit(e.id,t)}}catch(t){console.error("Failed to load VM details for edit, falling back to basic data:",t)}Dw.openWizardForEdit(e)}async cloneVM(e){this.selectedVMForDetails=e,this.showDetailsDrawer=!0,await this.updateComplete;const t=this.renderRoot.querySelector("vm-detail-drawer");t&&"function"==typeof t.openCloneModal?t.openCloneModal():this.showNotification("Unable to open clone dialog","error")}async createSnapshot(e){console.log("Create snapshot for:",e.name),this.showNotification("Snapshot functionality coming soon","info")}confirmDeleteVM(e){const t=e.state?.toLowerCase();"running"!==t?(this.vmToDelete=e,this.showDeleteModal=!0,this.requestUpdate()):this.showNotification("Cannot delete a running VM. Please stop it first.","error")}async handleDelete(){if(this.vmToDelete){this.isDeleting=!0;try{await Cw.delete(this.vmToDelete.id),this.showNotification(`VM "${this.vmToDelete.name}" deleted successfully`,"success"),this.showDeleteModal=!1,this.vmToDelete=null}catch(e){console.error("Failed to delete VM:",e),this.showNotification(`Failed to delete VM: ${e instanceof Error?e.message:"Unknown error"}`,"error")}finally{this.isDeleting=!1}}}handleCreateNew(){"templates"!==this.activeMainTab?Dw.openWizard():this.openCreateTemplateDrawer()}async handleRefresh(){try{"templates"===this.activeMainTab?(await $w.fetchAll(),this.showNotification("Templates refreshed","success")):(await Cw.fetchAll(),this.showNotification("VMs refreshed","success"))}catch(e){e instanceof uy||this.showNotification(`Failed to refresh ${this.activeMainTab}`,"error")}}showNotification(e,t="info"){this.dispatchEvent(new CustomEvent("show-notification",{detail:{message:e,type:t},bubbles:!0,composed:!0}))}startVmEventStream(){this.unsubscribeVmEvents||(this.unsubscribeVmEvents=hc({channel:"vm-events",routeId:"virtualization:vm-events",onEvent:e=>this.handleVmEvent(e),onConnectionChange:e=>this.handleVmEventsConnectionChange(e)}),this.vmLastEventAt=Date.now(),this.vmStaleCheckTimer&&window.clearInterval(this.vmStaleCheckTimer),this.vmStaleCheckTimer=window.setInterval(()=>{if(!this.vmEventsLive)return;if(!this.virtualizationEnabledController.value)return;Date.now()-(this.vmLastEventAt||0)>6e4&&this.scheduleVmRefetch("stale")},15e3))}stopVmEventStream(){this.unsubscribeVmEvents&&(this.unsubscribeVmEvents(),this.unsubscribeVmEvents=null),this.vmPollingTimer&&(window.clearInterval(this.vmPollingTimer),this.vmPollingTimer=null),this.vmRefetchTimer&&(window.clearTimeout(this.vmRefetchTimer),this.vmRefetchTimer=null),this.vmStaleCheckTimer&&(window.clearInterval(this.vmStaleCheckTimer),this.vmStaleCheckTimer=null),this.vmEventsLive=!1,this.vmDropNotified=!1}handleVmEventsConnectionChange(e){if(this.vmEventsLive=e,!e)return this.vmHasConnectedOnce&&!this.vmDropNotified&&(this.showNotification("Live VM updates disconnected â falling back to polling","warning"),this.vmDropNotified=!0),void this.ensureVmPolling();this.vmHasConnectedOnce=!0,this.vmDropNotified=!1,this.vmPollingTimer&&(window.clearInterval(this.vmPollingTimer),this.vmPollingTimer=null),this.scheduleVmRefetch("reconnected")}ensureVmPolling(){this.vmPollingTimer||(this.vmPollingTimer=window.setInterval(()=>{this.virtualizationEnabledController.value&&"vms"===this.activeMainTab&&Cw.fetchAll()},3e4))}scheduleVmRefetch(e){this.vmRefetchTimer||(this.vmRefetchTimer=window.setTimeout(async()=>{if(this.vmRefetchTimer=null,this.virtualizationEnabledController.value&&"vms"===this.activeMainTab)try{await Cw.fetchAll(),this.vmLastEventAt=Date.now()}catch(U_){}},800))}mapVmLifecycleEventToState(e){switch(e){case 2:case 4:return"running";case 3:return"paused";case 7:return"suspended";case 0:case 5:case 6:case 8:case 1:return"stopped";default:return"unknown"}}vmExists(e){const t=Oy.$items.get();return t instanceof Map?t.has(e):!(!t||"object"!=typeof t)&&e in t}handleVmEvent(e){if(!e||"vm"!==e.kind)return;if(!e.id)return;this.vmLastEventAt=Date.now();const t=String(e.id),s=this.mapVmLifecycleEventToState(Number(e.event));this.vmExists(t)?(Cw.updateLocalState(t,s),this.selectedVMForDetails?.id===t&&(this.selectedVMForDetails={...this.selectedVMForDetails,state:s}),1===Number(e.event)&&this.scheduleVmRefetch("vm-undefined")):this.scheduleVmRefetch("vm-missing")}async handleVMPowerAction(e){const{action:t,vm:s,success:i}=e.detail;if(i)return this.selectedVMForDetails&&s&&(this.selectedVMForDetails={...s}),void(s?.id&&s?.state&&Cw.updateLocalState(s.id,s.state));try{switch(t){case"start":await Cw.start(s.id),this.showNotification(`Starting VM: ${s.name}`,"success");break;case"stop":await Cw.stop(s.id),this.showNotification(`Stopping VM: ${s.name}`,"success");break;case"restart":await Cw.restart(s.id),this.showNotification(`Restarting VM: ${s.name}`,"success");break;case"pause":await Cw.pause(s.id),this.showNotification(`Pausing VM: ${s.name}`,"success");break;case"resume":await Cw.resume(s.id),this.showNotification(`Resuming VM: ${s.name}`,"success");break;case"clone":await this.cloneVM(s);break;case"snapshot":await this.createSnapshot(s);break;case"delete":this.confirmDeleteVM(s);break;default:console.warn(`Unknown VM action: ${t}`)}await Cw.fetchAll()}catch(o){console.error(`Failed to execute VM action ${t}:`,o),this.showNotification(`Failed to ${t} VM: ${o instanceof Error?o.message:"Unknown error"}`,"error")}}async handleVMConsoleConnect(e){const{vm:t}=e.detail;await this.openConsole(t)}async handleVMCloned(e){try{const t=e.detail?.cloned?.name;if(await Cw.fetchAll(),t){const e=Oy.$items.get();let s=[];e instanceof Map?s=Array.from(e.values()):Array.isArray(e)?s=e:e&&"object"==typeof e&&(s=Object.values(e));const i=s.find(e=>e?.name===t);i&&this.showVMDetails(i)}}catch(t){console.error("Failed to refresh VMs after clone:",t)}}async handleWizardVmCreated(e){const t=e.detail?.vm;if(t){this.activeMainTab="vms";try{await Cw.fetchAll()}catch{}this.showVMDetails(t)}}getTemplateActions(e){return[{label:"Create VM",action:"create-vm",icon:"ð¥ï¸"},{label:"Edit",action:"edit",icon:"âï¸"},{label:"Delete",action:"delete",icon:"ðï¸",danger:!0}]}renderTemplateFlags(e){const t=[{label:"Cloud-Init",on:e.cloud_init},{label:"UEFI",on:e.uefi_boot},{label:"Secure Boot",on:e.secure_boot},{label:"TPM",on:e.tpm}];return J`
      <div class="flag-badges">
        ${t.map(e=>J`
          <span class="flag-badge ${e.on?"on":"off"}">
            ${e.on?"â":"â"} ${e.label}
          </span>
        `)}
      </div>
    `}async handleTemplateAction(e,t){switch(e){case"create-vm":Dw.openWizardFromTemplate(t);break;case"view":case"edit":this.openEditTemplateDrawer(t);break;case"delete":this.confirmDeleteTemplate(t);break;default:console.warn(`Unknown template action: ${e}`)}}openCreateTemplateDrawer(){this.templateDrawerMode="create",this.editingTemplateId=null,this.templateFormErrors={},this.templateForm={name:"",description:"",os_type:"linux",os_variant:"",min_memory:"1024",recommended_memory:"",min_vcpus:"1",recommended_vcpus:"",min_disk:"10",recommended_disk:"",disk_format:"",network_model:"",graphics_type:"",cloud_init:!1,uefi_boot:!1,secure_boot:!1,tpm:!1,default_user:"",metadata_json:""},this.showTemplateDrawer=!0}openEditTemplateDrawer(e){this.templateDrawerMode="edit",this.editingTemplateId=e.id,this.templateFormErrors={},this.templateForm={name:e.name||"",description:e.description||"",os_type:e.os_type||"linux",os_variant:e.os_variant||"",min_memory:String(e.min_memory??""),recommended_memory:void 0!==e.recommended_memory&&null!==e.recommended_memory?String(e.recommended_memory):"",min_vcpus:String(e.min_vcpus??""),recommended_vcpus:void 0!==e.recommended_vcpus&&null!==e.recommended_vcpus?String(e.recommended_vcpus):"",min_disk:String(e.min_disk??""),recommended_disk:void 0!==e.recommended_disk&&null!==e.recommended_disk?String(e.recommended_disk):"",disk_format:e.disk_format||"",network_model:e.network_model||"",graphics_type:e.graphics_type||"",cloud_init:!!e.cloud_init,uefi_boot:!!e.uefi_boot,secure_boot:!!e.secure_boot,tpm:!!e.tpm,default_user:e.default_user||"",metadata_json:e.metadata?JSON.stringify(e.metadata,null,2):""},this.showTemplateDrawer=!0}closeTemplateDrawer(){this.showTemplateDrawer=!1,this.templateFormErrors={}}async saveTemplate(){const e={},t=this.templateForm.name.trim();"create"!==this.templateDrawerMode||t||(e.name="Name is required");const s=Number(this.templateForm.min_memory);(!Number.isFinite(s)||s<=0)&&(e.min_memory="Min memory must be a positive number");const i=Number(this.templateForm.min_vcpus);(!Number.isFinite(i)||i<=0)&&(e.min_vcpus="Min vCPUs must be a positive number");const o=Number(this.templateForm.min_disk);(!Number.isFinite(o)||o<=0)&&(e.min_disk="Min disk must be a positive number");const r=e=>{const t=e.trim();if(!t)return;const s=Number(t);return Number.isFinite(s)?s:void 0},a=r(this.templateForm.recommended_memory);void 0!==a&&Number.isFinite(s)&&a<s&&(e.recommended_memory="Recommended memory must be >= min memory");const n=r(this.templateForm.recommended_vcpus);void 0!==n&&Number.isFinite(i)&&n<i&&(e.recommended_vcpus="Recommended vCPUs must be >= min vCPUs");const l=r(this.templateForm.recommended_disk);let c;void 0!==l&&Number.isFinite(o)&&l<o&&(e.recommended_disk="Recommended disk must be >= min disk");const d=this.templateForm.metadata_json.trim();if(d)try{const t=JSON.parse(d);if(!t||"object"!=typeof t||Array.isArray(t))e.metadata_json="Metadata must be a JSON object (key/value)";else{const s={};for(const[i,o]of Object.entries(t))if(null!=o){if("string"!=typeof o&&"number"!=typeof o&&"boolean"!=typeof o){e.metadata_json="Metadata values must be strings/numbers/booleans";break}s[String(i)]=String(o)}e.metadata_json||(c=s)}}catch{e.metadata_json="Metadata must be valid JSON"}if(Object.keys(e).length>0)return void(this.templateFormErrors=e);const h={description:this.templateForm.description.trim()||void 0,os_type:this.templateForm.os_type,os_variant:this.templateForm.os_variant.trim()||void 0,min_memory:s,recommended_memory:a,min_vcpus:i,recommended_vcpus:n,min_disk:o,recommended_disk:l,disk_format:this.templateForm.disk_format||void 0,network_model:this.templateForm.network_model||void 0,graphics_type:this.templateForm.graphics_type||void 0,cloud_init:this.templateForm.cloud_init,uefi_boot:this.templateForm.uefi_boot,secure_boot:this.templateForm.secure_boot,tpm:this.templateForm.tpm,default_user:this.templateForm.default_user.trim()||void 0,metadata:c};this.isSavingTemplate=!0;try{if("create"===this.templateDrawerMode){const e=await $w.create({name:this.templateForm.name.trim(),...h});this.showNotification(`Template "${e.name}" created`,"success")}else if(this.editingTemplateId){const e=await $w.update(this.editingTemplateId,h);this.showNotification(`Template "${e.name}" updated`,"success")}this.closeTemplateDrawer()}catch(u){const e=u,t=e?.code?` (${e.code})`:"",s=e?.details?` - ${e.details}`:"";this.showNotification(`Failed to save template: ${e instanceof Error?e.message:"Unknown error"}${s}${t}`,"error")}finally{this.isSavingTemplate=!1}}confirmDeleteTemplate(e){this.templateToDelete=e,this.showTemplateDeleteModal=!0,this.requestUpdate()}async handleDeleteTemplate(){if(this.templateToDelete){this.isDeletingTemplate=!0;try{await $w.delete(this.templateToDelete.id),this.showNotification(`Template "${this.templateToDelete.name}" deleted successfully`,"success"),this.showTemplateDeleteModal=!1,this.templateToDelete=null}catch(e){const t=e,s=t?.code?` (${t.code})`:"",i=t?.details?` - ${t.details}`:"";this.showNotification(`Failed to delete template: ${t instanceof Error?t.message:"Unknown error"}${i}${s}`,"error")}finally{this.isDeletingTemplate=!1}}}openCreateTemplateFromVmModal(e){this.vmForTemplateCreation=e,this.templateFromVmName=`${e.name}-template`,this.templateFromVmDescription="",this.showCreateTemplateFromVmModal=!0}closeCreateTemplateFromVmModal(){this.showCreateTemplateFromVmModal=!1,this.vmForTemplateCreation=null,this.templateFromVmName="",this.templateFromVmDescription="",this.isCreatingTemplateFromVm=!1}async submitCreateTemplateFromVm(){if(!this.vmForTemplateCreation)return;const e=this.templateFromVmName.trim();if(e){this.isCreatingTemplateFromVm=!0;try{const t=await $w.createFromVM(this.vmForTemplateCreation.id,e,this.templateFromVmDescription.trim()||void 0);this.showNotification(`Template "${t.name}" created from VM "${this.vmForTemplateCreation.name}"`,"success"),this.activeMainTab="templates",this.closeCreateTemplateFromVmModal()}catch(t){const e=t,s=e?.code?` (${e.code})`:"",i=e?.details?` - ${e.details}`:"";this.showNotification(`Failed to create template: ${e instanceof Error?e.message:"Unknown error"}${i}${s}`,"error"),this.isCreatingTemplateFromVm=!1}}else this.showNotification("Template name is required","error")}renderCreateTemplateFromVmModal(){return J`
      <modal-dialog
        .open=${this.showCreateTemplateFromVmModal}
        .title=${this.vmForTemplateCreation?`Create Template from ${this.vmForTemplateCreation.name}`:"Create Template from VM"}
        size="small"
        @modal-close=${this.closeCreateTemplateFromVmModal}
      >
        <div class="form-group">
          <label>Template Name</label>
          <input
            type="text"
            .value=${this.templateFromVmName}
            @input=${e=>{this.templateFromVmName=e.target.value}}
          />
        </div>
        <div class="form-group">
          <label>Description (optional)</label>
          <input
            type="text"
            .value=${this.templateFromVmDescription}
            @input=${e=>{this.templateFromVmDescription=e.target.value}}
          />
        </div>

        <div slot="footer" class="modal-footer-actions">
          <button class="btn btn-secondary" @click=${this.closeCreateTemplateFromVmModal}>
            Cancel
          </button>
          <button
            class="btn btn-primary"
            @click=${this.submitCreateTemplateFromVm}
            ?disabled=${this.isCreatingTemplateFromVm||!this.templateFromVmName.trim()}
          >
            ${this.isCreatingTemplateFromVm?"Creatingâ¦":"Create Template"}
          </button>
        </div>
      </modal-dialog>
    `}renderTemplateDrawer(){if(!this.showTemplateDrawer)return J``;const e="edit"===this.templateDrawerMode;return J`
      <div class="drawer-overlay" @click=${this.closeTemplateDrawer}></div>
      <div class="drawer">
        <div class="drawer-header">
          <h2 class="drawer-title">${e?"Edit Template":"Create Template"}</h2>
          <button class="drawer-close" @click=${this.closeTemplateDrawer} aria-label="Close">â</button>
        </div>

        <div class="drawer-content">
          <div class="form-group">
            <label>Name${e?"":" *"}</label>
            <input
              type="text"
              .value=${this.templateForm.name}
              ?disabled=${e}
              @input=${e=>{this.templateForm={...this.templateForm,name:e.target.value}}}
            />
            ${this.templateFormErrors.name?J`<div class="error-text">${this.templateFormErrors.name}</div>`:""}
            ${e?J`<div class="help-text">Template name cannot be changed.</div>`:""}
          </div>

          <div class="form-group">
            <label>Description</label>
            <input
              type="text"
              .value=${this.templateForm.description}
              @input=${e=>{this.templateForm={...this.templateForm,description:e.target.value}}}
            />
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label>OS Type *</label>
              <select
                .value=${this.templateForm.os_type}
                @change=${e=>{this.templateForm={...this.templateForm,os_type:e.target.value}}}
              >
                <option value="linux">linux</option>
                <option value="windows">windows</option>
                <option value="bsd">bsd</option>
                <option value="other">other</option>
                <option value="hvm">hvm</option>
              </select>
            </div>

            <div class="form-group">
              <label>OS Variant</label>
              <os-variant-autocomplete
                .value=${this.templateForm.os_variant}
                .family=${this.templateForm.os_type}
                placeholder="ubuntu22.04"
                @os-variant-change=${e=>{this.templateForm={...this.templateForm,os_variant:e.detail.value}}}
              ></os-variant-autocomplete>
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label>Min Memory (MB) *</label>
              <input
                type="number"
                min="1"
                .value=${this.templateForm.min_memory}
                @input=${e=>{this.templateForm={...this.templateForm,min_memory:e.target.value}}}
              />
              ${this.templateFormErrors.min_memory?J`<div class="error-text">${this.templateFormErrors.min_memory}</div>`:""}
            </div>

            <div class="form-group">
              <label>Recommended Memory (MB)</label>
              <input
                type="number"
                min="1"
                .value=${this.templateForm.recommended_memory}
                @input=${e=>{this.templateForm={...this.templateForm,recommended_memory:e.target.value}}}
              />
              ${this.templateFormErrors.recommended_memory?J`<div class="error-text">${this.templateFormErrors.recommended_memory}</div>`:""}
            </div>

            <div class="form-group">
              <label>Min vCPUs *</label>
              <input
                type="number"
                min="1"
                .value=${this.templateForm.min_vcpus}
                @input=${e=>{this.templateForm={...this.templateForm,min_vcpus:e.target.value}}}
              />
              ${this.templateFormErrors.min_vcpus?J`<div class="error-text">${this.templateFormErrors.min_vcpus}</div>`:""}
            </div>

            <div class="form-group">
              <label>Recommended vCPUs</label>
              <input
                type="number"
                min="1"
                .value=${this.templateForm.recommended_vcpus}
                @input=${e=>{this.templateForm={...this.templateForm,recommended_vcpus:e.target.value}}}
              />
              ${this.templateFormErrors.recommended_vcpus?J`<div class="error-text">${this.templateFormErrors.recommended_vcpus}</div>`:""}
            </div>

            <div class="form-group">
              <label>Min Disk (GB) *</label>
              <input
                type="number"
                min="1"
                .value=${this.templateForm.min_disk}
                @input=${e=>{this.templateForm={...this.templateForm,min_disk:e.target.value}}}
              />
              ${this.templateFormErrors.min_disk?J`<div class="error-text">${this.templateFormErrors.min_disk}</div>`:""}
            </div>

            <div class="form-group">
              <label>Recommended Disk (GB)</label>
              <input
                type="number"
                min="1"
                .value=${this.templateForm.recommended_disk}
                @input=${e=>{this.templateForm={...this.templateForm,recommended_disk:e.target.value}}}
              />
              ${this.templateFormErrors.recommended_disk?J`<div class="error-text">${this.templateFormErrors.recommended_disk}</div>`:""}
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label>Disk Format</label>
              <select
                .value=${this.templateForm.disk_format}
                @change=${e=>{this.templateForm={...this.templateForm,disk_format:e.target.value}}}
              >
                <option value="">Default</option>
                <option value="qcow2">qcow2</option>
                <option value="raw">raw</option>
                <option value="vmdk">vmdk</option>
                <option value="qed">qed</option>
                <option value="vdi">vdi</option>
              </select>
            </div>

            <div class="form-group">
              <label>Network Model</label>
              <select
                .value=${this.templateForm.network_model}
                @change=${e=>{this.templateForm={...this.templateForm,network_model:e.target.value}}}
              >
                <option value="">Default</option>
                <option value="virtio">virtio</option>
                <option value="e1000">e1000</option>
                <option value="rtl8139">rtl8139</option>
              </select>
            </div>

            <div class="form-group">
              <label>Graphics Type</label>
              <select
                .value=${this.templateForm.graphics_type}
                @change=${e=>{this.templateForm={...this.templateForm,graphics_type:e.target.value}}}
              >
                <option value="">Default</option>
                <option value="vnc">vnc</option>
                <option value="spice">spice</option>
                <option value="none">none</option>
                <option value="egl-headless">egl-headless</option>
              </select>
            </div>

            <div class="form-group">
              <label>Default User</label>
              <input
                type="text"
                .value=${this.templateForm.default_user}
                @input=${e=>{this.templateForm={...this.templateForm,default_user:e.target.value}}}
              />
            </div>
          </div>

          <div class="toggle-row">
            <label class="toggle">
              <input
                type="checkbox"
                .checked=${this.templateForm.cloud_init}
                @change=${e=>{this.templateForm={...this.templateForm,cloud_init:e.target.checked}}}
              />
              Cloud-Init
            </label>
            <label class="toggle">
              <input
                type="checkbox"
                .checked=${this.templateForm.uefi_boot}
                @change=${e=>{this.templateForm={...this.templateForm,uefi_boot:e.target.checked}}}
              />
              UEFI Boot
            </label>
            <label class="toggle">
              <input
                type="checkbox"
                .checked=${this.templateForm.secure_boot}
                @change=${e=>{this.templateForm={...this.templateForm,secure_boot:e.target.checked}}}
              />
              Secure Boot
            </label>
            <label class="toggle">
              <input
                type="checkbox"
                .checked=${this.templateForm.tpm}
                @change=${e=>{this.templateForm={...this.templateForm,tpm:e.target.checked}}}
              />
              TPM
            </label>
          </div>

          <div class="form-group">
            <label>Metadata (JSON)</label>
            <textarea
              .value=${this.templateForm.metadata_json}
              placeholder="{\n  \"key\": \"value\"\n}"
              @input=${e=>{this.templateForm={...this.templateForm,metadata_json:e.target.value}}}
            ></textarea>
            ${this.templateFormErrors.metadata_json?J`<div class="error-text">${this.templateFormErrors.metadata_json}</div>`:""}
            <div class="help-text">Must be a JSON object with scalar values (strings/numbers/booleans).</div>
          </div>
        </div>

        <div class="drawer-footer">
          <button class="btn btn-secondary" @click=${this.closeTemplateDrawer} ?disabled=${this.isSavingTemplate}>
            Cancel
          </button>
          <button
            class="btn btn-primary"
            @click=${this.saveTemplate}
            ?disabled=${this.isSavingTemplate}
          >
            ${this.isSavingTemplate?"Savingâ¦":e?"Save Changes":"Create Template"}
          </button>
        </div>
      </div>
    `}renderVirtualizationDisabledBanner(e){return J`
      <div class="virtualization-disabled-banner">
        <h2>Virtualization is disabled on this host</h2>
        <p>Virtualization features are currently unavailable because libvirt is not installed or not running.\
 To enable VM management, install and start libvirt on this machine, then reload this page.</p>
        ${e?J`<p>${e}</p>`:""}
      </div>
    `}render(){if(!1===this.virtualizationEnabledController.value){const e=this.virtualizationDisabledMessageController.value;return J`
        <div class="container">
          ${this.renderVirtualizationDisabledBanner(e)}
        </div>
      `}const e=this.vmStoreController.value,t=this.filteredVMsController.value||[],s=Array.isArray(e)?e:e instanceof Map?[...e.values()]:"object"==typeof e&&e?Object.values(e):[],i={totalVMs:s.length,runningVMs:s.filter(e=>"running"===e.state).length,stoppedVMs:s.filter(e=>"stopped"===e.state).length,pausedVMs:s.filter(e=>"paused"===e.state).length,totalMemory:s.reduce((e,t)=>e+(t.memory||0),0),totalVCPUs:s.reduce((e,t)=>e+(t.vcpus||0),0),totalDiskSize:s.reduce((e,t)=>e+(t.disk_size||0),0)},o=this.searchQueryController.value,r="templates"===this.activeMainTab?Hy.$loading.get():Oy.$loading.get(),a="templates"===this.activeMainTab?Hy.$error.get():Oy.$error.get();let n=t;"all"!==this.stateFilter&&(n=t.filter(e=>e.state===this.stateFilter));const l=(o||"").toLowerCase().trim(),c=l?this.templates.filter(e=>`${e.name} ${e.description||""} ${e.os_type} ${e.os_variant||""}`.toLowerCase().includes(l)):this.templates,d=(e,t)=>null!=t?`${e} / ${t}`:`${e}`,h="templates"===this.activeMainTab?c.map(e=>({...e,os:e.os_variant?`${e.os_type} / ${e.os_variant}`:e.os_type,memory:d(e.min_memory,e.recommended_memory),vcpus:d(e.min_vcpus,e.recommended_vcpus),disk:d(e.min_disk,e.recommended_disk),flags:e,updated:new Date(e.updated_at||e.created_at).toLocaleDateString()})):n.map(e=>({...e,state_rendered:this.renderStateCell(e.state),memory_formatted:this.formatMemory(e.memory),disk_formatted:this.formatDiskSize(e.disk_size),created_formatted:new Date(e.created_at).toLocaleDateString()}));return J`
      <div class="container">

        <!-- Stats Bar -->
        <div class="stats-bar">
          <div class="stat-widget">
            <div class="stat-widget-header">
              <span class="stat-icon total">ð¥ï¸</span>
              <span class="stat-label">Total VMs</span>
            </div>
            <div class="stat-value">${i.totalVMs}</div>
            <div class="stat-subtitle">virtual machines</div>
          </div>
          
          <div class="stat-widget">
            <div class="stat-widget-header">
              <span class="stat-icon running">â¶ï¸</span>
              <span class="stat-label">Running</span>
            </div>
            <div class="stat-value running">${i.runningVMs}</div>
            <div class="stat-subtitle">${Math.round(i.runningVMs/i.totalVMs*100)||0}% active</div>
          </div>
          
          <div class="stat-widget">
            <div class="stat-widget-header">
              <span class="stat-icon stopped">â¹ï¸</span>
              <span class="stat-label">Stopped</span>
            </div>
            <div class="stat-value stopped">${i.stoppedVMs}</div>
            <div class="stat-subtitle">${Math.round(i.stoppedVMs/i.totalVMs*100)||0}% inactive</div>
          </div>
          
          <div class="stat-widget">
            <div class="stat-widget-header">
              <span class="stat-icon memory">ð§ </span>
              <span class="stat-label">Total Memory</span>
            </div>
            <div class="stat-value">${this.formatMemory(i.totalMemory)}</div>
            <div class="stat-subtitle">allocated RAM</div>
          </div>
          
          <div class="stat-widget">
            <div class="stat-widget-header">
              <span class="stat-icon cpu">â¡</span>
              <span class="stat-label">Total vCPUs</span>
            </div>
            <div class="stat-value">${i.totalVCPUs}</div>
            <div class="stat-subtitle">processing cores</div>
          </div>
          
          <div class="stat-widget">
            <div class="stat-widget-header">
              <span class="stat-icon storage">ð¾</span>
              <span class="stat-label">Total Storage</span>
            </div>
            <div class="stat-value">${this.formatDiskSize(i.totalDiskSize)}</div>
            <div class="stat-subtitle">disk space</div>
          </div>
        </div>

        <!-- Tabs -->
        <tab-group
          .tabs=${this.tabs}
          .activeTab=${this.activeMainTab}
          @tab-change=${this.handleTabChange}
        ></tab-group>

        <!-- Controls -->
        <div class="controls">
          <div class="filters-section">
            ${"vms"===this.activeMainTab?J`
              <filter-dropdown
                .options=${[{value:"all",label:"All States"},{value:"running",label:"Running"},{value:"stopped",label:"Stopped"},{value:"paused",label:"Paused"},{value:"suspended",label:"Suspended"}]}
                .selectedValue=${this.stateFilter}
                .label=${"Filter by State"}
                .showStatusIndicators=${!0}
                @filter-change=${this.handleStateFilterChange}
              ></filter-dropdown>
            `:""}
            <search-input
              .placeholder=${"vms"===this.activeMainTab?"Search virtual machines...":"Search templates..."}
              .value=${o}
              @search-change=${this.handleSearchChange}
            ></search-input>
          </div>
          <div class="actions-section">
            ${"vms"===this.activeMainTab?J`
              <span class="live-indicator ${this.vmEventsLive?"on":"off"}" title="${this.vmEventsLive?"Live updates connected":"Live updates disconnected"}">
                <span class="dot"></span>
                Live
              </span>
            `:""}
            <button class="btn-refresh" @click=${this.handleRefresh} title="Refresh">
              ð
            </button>
            <button class="btn-create" @click=${this.handleCreateNew}>
              <span>+ New ${"templates"===this.activeMainTab?"Template":"VM"}</span>
            </button>
          </div>
        </div>

        <!-- Content -->
        <div class="content">
          ${r?J`
            <loading-state message="Loading ${"templates"===this.activeMainTab?"templates":"virtual machines"}..."></loading-state>
          `:a?J`
            <empty-state
              icon="â"
              title="Error loading ${"templates"===this.activeMainTab?"templates":"virtual machines"}"
              description=${a.message}
            ></empty-state>
          `:0===h.length?J`
            <empty-state
              icon="ð¥ï¸"
              title="No ${"templates"===this.activeMainTab?"templates":"virtual machines"} found"
              description=${o?`No ${"templates"===this.activeMainTab?"templates":"VMs"} match your search criteria`:"templates"===this.activeMainTab?"No templates available":"Create your first virtual machine to get started"}
            ></empty-state>
          `:J`
            <resource-table
              .columns=${this.getColumns()}
              .data=${h}
              .getActions=${e=>"templates"===this.activeMainTab?this.getTemplateActions(e):this.getActions(e)}
              .customRenderers=${"templates"===this.activeMainTab?{flags:e=>this.renderTemplateFlags(e)}:{}}
              @cell-click=${this.handleCellClick}
              @action=${this.handleAction}
            ></resource-table>
          `}
        </div>

        <!-- VM Details Drawer -->
        <vm-detail-drawer
          ?show=${this.showDetailsDrawer}
          .vm=${this.selectedVMForDetails}
          @close=${()=>{this.showDetailsDrawer=!1,this.selectedVMForDetails=null}}
          @power-action=${this.handleVMPowerAction}
          @console-connect=${this.handleVMConsoleConnect}
          @vm-cloned=${this.handleVMCloned}
        ></vm-detail-drawer>

        <!-- Delete Confirmation Modal -->
        <delete-modal
          .show=${this.showDeleteModal}
          .item=${this.vmToDelete?{name:this.vmToDelete.name,type:"Virtual Machine"}:null}
          .loading=${this.isDeleting}
          @confirm-delete=${this.handleDelete}
          @cancel-delete=${()=>{this.showDeleteModal=!1,this.vmToDelete=null,this.requestUpdate()}}
        ></delete-modal>

        <!-- Template Delete Confirmation Modal -->
        <delete-modal
          .show=${this.showTemplateDeleteModal}
          .item=${this.templateToDelete?{name:this.templateToDelete.name,type:"Template"}:null}
          .loading=${this.isDeletingTemplate}
          @confirm-delete=${this.handleDeleteTemplate}
          @cancel-delete=${()=>{this.showTemplateDeleteModal=!1,this.templateToDelete=null,this.requestUpdate()}}
        ></delete-modal>

        ${this.renderTemplateDrawer()}
        ${this.renderCreateTemplateFromVmModal()}

        <!-- VM Creation Wizard -->
        ${this.useEnhancedWizard?J`
          <create-vm-wizard-enhanced @vm-created=${this.handleWizardVmCreated}></create-vm-wizard-enhanced>
        `:J`
          <create-vm-wizard></create-vm-wizard>
        `}

        <!-- Notification Container -->
        <notification-container></notification-container>
      </div>
    `}};ax.styles=g`
    :host {
      display: block;
      height: 100%;
      box-sizing: border-box;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 1rem;
    }



    .stats-bar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin-bottom: 1.5rem;
    }

    .stat-widget {
      display: flex;
      flex-direction: column;
      padding: 14px;
      background: var(--vscode-editor-background);
      border: 1px solid var(--vscode-border);
      border-radius: 8px;
      transition: all 0.2s ease;
      position: relative;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
    }

    .stat-widget:hover {
      border-color: var(--vscode-focusBorder);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      background: rgba(255, 255, 255, 0.02);
    }

    .stat-widget::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      border-radius: 8px 8px 0 0;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .stat-widget:hover::before {
      opacity: 1;
    }

    .stat-widget:nth-child(1)::before {
      background: var(--vscode-charts-blue);
    }

    .stat-widget:nth-child(2)::before {
      background: var(--vscode-charts-green);
    }

    .stat-widget:nth-child(3)::before {
      background: var(--vscode-charts-red);
    }

    .stat-widget:nth-child(4)::before {
      background: var(--vscode-charts-purple);
    }

    .stat-widget:nth-child(5)::before {
      background: var(--vscode-charts-orange);
    }

    .stat-widget:nth-child(6)::before {
      background: var(--vscode-charts-yellow);
    }

    .stat-widget-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .stat-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      font-size: 14px;
    }

    .stat-icon.total {
      color: var(--vscode-charts-blue);
    }

    .stat-icon.running {
      color: var(--vscode-charts-green);
    }

    .stat-icon.stopped {
      color: var(--vscode-charts-red);
    }

    .stat-icon.memory {
      color: var(--vscode-charts-purple);
    }

    .stat-icon.cpu {
      color: var(--vscode-charts-orange);
    }

    .stat-icon.storage {
      color: var(--vscode-charts-yellow);
    }

    .stat-label {
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
      color: var(--vscode-descriptionForeground);
      opacity: 0.8;
    }

    .stat-value {
      font-size: 18px;
      font-weight: 600;
      color: var(--vscode-foreground);
      line-height: 1.2;
    }

    .stat-value.running {
      color: var(--vscode-charts-green);
    }

    .stat-value.stopped {
      color: var(--vscode-charts-red);
    }

    .stat-subtitle {
      font-size: 10px;
      color: var(--vscode-descriptionForeground);
      margin-top: 2px;
      opacity: 0.7;
    }

    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      gap: 1rem;
    }

    .filters-section {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }

    .actions-section {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .live-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--vscode-border);
      font-size: 11px;
      color: var(--vscode-descriptionForeground);
      user-select: none;
    }

    .live-indicator .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(204, 204, 204, 0.5);
    }

    .live-indicator.on {
      border-color: rgba(137, 209, 133, 0.6);
      color: rgba(137, 209, 133, 1);
    }

    .live-indicator.on .dot {
      background: rgba(137, 209, 133, 1);
    }

    .live-indicator.off {
      opacity: 0.75;
    }

    search-input {
      flex: 1;
      max-width: 400px;
    }

    .content {
      flex: 1;
      overflow-y: auto;
    }

    .btn-create {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-create:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }

    .btn-refresh {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px 12px;
      background: transparent;
      color: var(--vscode-foreground);
      border: 1px solid var(--vscode-button-border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
    }

    .btn-refresh:hover {
      background: var(--vscode-button-secondaryHoverBackground);
    }

    .state-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .state-badge.running {
      background: var(--vscode-testing-runAction);
      color: white;
    }

    .state-badge.stopped {
      background: var(--vscode-inputValidation-errorBackground);
      color: var(--vscode-inputValidation-errorForeground);
    }

    .state-badge.paused {
      background: var(--vscode-inputValidation-warningBackground);
      color: var(--vscode-inputValidation-warningForeground);
    }

    .state-badge.suspended {
      background: var(--vscode-badge-background);
      color: var(--vscode-badge-foreground);
    }

    .virtualization-disabled-banner {
      margin-top: 16px;
      padding: 16px 20px;
      border-radius: 8px;
      border: 1px solid var(--vscode-inputValidation-warningBorder, #e2c08d);
      background: var(--vscode-inputValidation-warningBackground, rgba(229, 200, 144, 0.15));
      color: var(--vscode-inputValidation-warningForeground, #e2c08d);
    }

    .virtualization-disabled-banner h2 {
      margin: 0 0 8px 0;
      font-size: 16px;
      font-weight: 500;
    }

    .virtualization-disabled-banner p {
      margin: 0 0 4px 0;
      font-size: 13px;
      color: var(--vscode-descriptionForeground);
    }
    /* Templates drawer + form */
    .drawer-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
    }

    .drawer {
      position: fixed;
      top: 0;
      right: 0;
      width: 520px;
      max-width: calc(100vw - 40px);
      height: 100vh;
      background: var(--vscode-editor-background, var(--vscode-bg-light));
      border-left: 1px solid var(--vscode-border);
      box-shadow: -2px 0 12px rgba(0, 0, 0, 0.25);
      z-index: 1000;
      display: flex;
      flex-direction: column;
    }

    .drawer-header {
      padding: 16px 20px;
      background: var(--vscode-bg-lighter, #2c2f3a);
      border-bottom: 1px solid var(--vscode-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .drawer-title {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
      color: var(--vscode-foreground);
    }

    .drawer-close {
      background: none;
      border: none;
      color: var(--vscode-descriptionForeground);
      cursor: pointer;
      padding: 6px 8px;
      border-radius: 4px;
    }

    .drawer-close:hover {
      background: rgba(255, 255, 255, 0.06);
      color: var(--vscode-foreground);
    }

    .drawer-content {
      padding: 16px 20px;
      overflow: auto;
      flex: 1;
    }

    .drawer-footer {
      padding: 14px 20px;
      border-top: 1px solid var(--vscode-border);
      background: var(--vscode-bg);
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      flex-shrink: 0;
    }

    /* Buttons (match create-vm-wizard-enhanced) */
    .btn {
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
      font-family: inherit;
    }

    .btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .btn-primary {
      background: var(--vscode-button-background, #0e639c);
      color: var(--vscode-button-foreground, #ffffff);
      border: 1px solid var(--vscode-button-background, #0e639c);
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--vscode-button-hoverBackground, #1177bb);
      border-color: var(--vscode-button-hoverBackground, #1177bb);
    }

    .btn-secondary {
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border: 1px solid var(--vscode-button-border, #5a5a5a);
    }

    .btn-secondary:hover:not(:disabled) {
      background: var(--vscode-button-secondaryHoverBackground, rgba(90, 93, 94, 0.25));
    }

    .modal-footer-actions {
      width: 100%;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    /* Form elements (match create-vm-wizard-enhanced) */
    .form-group {
      margin-bottom: 20px;
      width: 100%;
      box-sizing: border-box;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 13px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
    }

    input,
    select,
    textarea {
      width: 100%;
      max-width: 100%;
      padding: 8px 12px;
      background: var(--vscode-input-background, #3c3c3c);
      color: var(--vscode-input-foreground, #cccccc);
      border: 1px solid var(--vscode-input-border, #858585);
      border-radius: 4px;
      font-size: 13px;
      font-family: inherit;
      transition: all 0.2s;
      box-sizing: border-box;
    }

    input::placeholder,
    textarea::placeholder {
      color: var(--vscode-input-placeholderForeground, rgba(204, 204, 204, 0.6));
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--vscode-focusBorder, #007acc);
      box-shadow: 0 0 0 1px var(--vscode-focusBorder, #007acc);
    }

    input:disabled,
    select:disabled,
    textarea:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    input[type="checkbox"] {
      width: auto;
      max-width: none;
      padding: 0;
      border-radius: 0;
      box-shadow: none;
    }

    textarea {
      min-height: 90px;
      resize: vertical;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
    }

    .help-text {
      font-size: 11px;
      color: var(--vscode-descriptionForeground);
      opacity: 0.8;
    }

    .error-text {
      color: var(--vscode-inputValidation-errorForeground, #f48771);
      font-size: 12px;
    }

    .toggle-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 10px 0 6px;
    }

    .toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border: 1px solid var(--vscode-border);
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.02);
    }

    .toggle input {
      width: 14px;
      height: 14px;
    }

    .flag-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .flag-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid var(--vscode-border);
      background: rgba(255, 255, 255, 0.02);
    }

    .flag-badge.on {
      border-color: rgba(137, 209, 133, 0.6);
      color: rgba(137, 209, 133, 1);
    }

    .flag-badge.off {
      opacity: 0.6;
    }

    @media (max-width: 820px) {
      .drawer {
        width: 100%;
        max-width: 100%;
      }
      .form-grid {
        grid-template-columns: 1fr;
      }
      .toggle-row {
        grid-template-columns: 1fr;
      }
    }


  `,rx([xe()],ax.prototype,"showDeleteModal",2),rx([xe()],ax.prototype,"vmToDelete",2),rx([xe()],ax.prototype,"isDeleting",2),rx([xe()],ax.prototype,"showDetailsDrawer",2),rx([xe()],ax.prototype,"useEnhancedWizard",2),rx([xe()],ax.prototype,"activeMainTab",2),rx([xe()],ax.prototype,"stateFilter",2),rx([xe()],ax.prototype,"templates",2),rx([xe()],ax.prototype,"selectedVMForDetails",2),rx([xe()],ax.prototype,"vmEventsLive",2),rx([xe()],ax.prototype,"showTemplateDrawer",2),rx([xe()],ax.prototype,"templateDrawerMode",2),rx([xe()],ax.prototype,"editingTemplateId",2),rx([xe()],ax.prototype,"isSavingTemplate",2),rx([xe()],ax.prototype,"templateForm",2),rx([xe()],ax.prototype,"templateFormErrors",2),rx([xe()],ax.prototype,"showTemplateDeleteModal",2),rx([xe()],ax.prototype,"templateToDelete",2),rx([xe()],ax.prototype,"isDeletingTemplate",2),rx([xe()],ax.prototype,"showCreateTemplateFromVmModal",2),rx([xe()],ax.prototype,"vmForTemplateCreation",2),rx([xe()],ax.prototype,"templateFromVmName",2),rx([xe()],ax.prototype,"templateFromVmDescription",2),rx([xe()],ax.prototype,"isCreatingTemplateFromVm",2),ax=rx([ve("virtualization-vms-enhanced")],ax);var nx=Object.defineProperty,lx=Object.getOwnPropertyDescriptor,cx=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?lx(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&nx(t,s,r),r};let dx=class extends me{constructor(){super(...arguments),this.show=!1,this.loading=!1,this.editMode=!1,this.poolData=null,this.formData={name:"",type:"dir",path:"",source:"",target:"",autostart:!0},this.errors={},this.handleEscape=e=>{"Escape"===e.key&&this.show&&!this.loading&&this.handleClose()}}sanitizePath(e){return e.trim().replace(/[;|&$`]/g,"")}sanitizeName(e){return e.trim().replace(/[^\w-]/g,"")}sanitizeInput(e){return e.trim().replace(/[<>]/g,"")}connectedCallback(){super.connectedCallback(),window.addEventListener("keydown",this.handleEscape)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("keydown",this.handleEscape)}willUpdate(e){e.has("poolData")&&this.poolData&&(this.formData={name:this.poolData.name||"",type:this.poolData.type||"dir",path:this.poolData.path||"",source:"",target:"",autostart:void 0===this.poolData.autostart||this.poolData.autostart},this.errors={}),e.has("show")&&(this.show?setTimeout(()=>{const e=this.shadowRoot?.querySelector("#pool-name");e&&e.focus()},100):setTimeout(()=>{this.show||(this.formData={name:"",type:"dir",path:"",source:"",target:"",autostart:!0},this.errors={})},300))}handleClose(){this.dispatchEvent(new CustomEvent("close",{bubbles:!0,composed:!0}))}validateField(e){let t="";switch(e){case"name":this.formData.name?/^[a-zA-Z0-9_-]+$/.test(this.formData.name)||(t="Name must contain only alphanumeric characters, hyphens, and underscores"):t="Name is required";break;case"path":"dir"!==this.formData.type||this.formData.path?this.formData.path&&!this.formData.path.startsWith("/")&&(t="Path must be an absolute path (start with /)"):t="Path is required for directory pools";break;case"source":"netfs"!==this.formData.type||this.formData.source||(t="Source is required for network file system pools");break;case"target":"netfs"!==this.formData.type||this.formData.target||(t="Target is required for network file system pools")}if(t)return this.errors={...this.errors,[e]:t},!1;{const{[e]:t,...s}=this.errors;return this.errors=s,!0}}validateForm(){const e=["name"];"dir"===this.formData.type?e.push("path"):"netfs"===this.formData.type&&e.push("source","target");let t=!0;return e.forEach(e=>{this.validateField(e)||(t=!1)}),t}handleInputChange(e,t){this.formData={...this.formData,[e]:t},"string"==typeof t&&"type"!==e&&this.validateField(e),this.requestUpdate()}handleTypeChange(e){if(this.formData={...this.formData,type:e},"dir"!==e){const{path:e,...t}=this.errors;this.errors=t}if("netfs"!==e){const{source:e,target:t,...s}=this.errors;this.errors=s}this.requestUpdate()}handleSubmit(e){if(e.preventDefault(),this.loading||!this.validateForm())return;const t={name:this.sanitizeName(this.formData.name),type:this.formData.type,path:this.formData.path?this.sanitizePath(this.formData.path):void 0,source:this.formData.source?this.sanitizeInput(this.formData.source):void 0,target:this.formData.target?this.sanitizePath(this.formData.target):void 0,autostart:this.formData.autostart};this.dispatchEvent(new CustomEvent("save",{detail:{formData:t},bubbles:!0,composed:!0}))}render(){const e=this.editMode;return J`
      <div class="drawer">
        <div class="drawer-header">
          <h2 class="header-title">${this.editMode?"Edit Storage Pool":"Create Storage Pool"}</h2>
          <button class="close-button" @click=${this.handleClose} ?disabled=${this.loading}>Ã</button>
        </div>

        <form class="drawer-content" @submit=${this.handleSubmit}>
          ${this.editMode?J`
            <div class="edit-note">
              <strong>Note:</strong> Currently, only autostart settings can be modified. Pool type and path cannot be changed.
            </div>
          `:""}

          <div class="form-field">
            <label class="form-label" for="pool-name">Name *</label>
            <input
              id="pool-name"
              type="text"
              class="form-input ${this.errors.name?"error":""}"
              .value=${this.formData.name}
              @input=${e=>this.handleInputChange("name",e.target.value)}
              ?disabled=${e||this.loading}
              placeholder="my-storage-pool"
              aria-label="Storage pool name"
              aria-required="true"
              aria-invalid=${this.errors.name?"true":"false"}
              aria-describedby=${this.errors.name?"name-error":void 0}
            />
            ${this.errors.name?J`<span id="name-error" class="form-error" role="alert">${this.errors.name}</span>`:""}
          </div>

          <div class="form-field">
            <label class="form-label" for="pool-type">Type *</label>
            <select
              id="pool-type"
              class="form-select"
              .value=${this.formData.type}
              @change=${e=>this.handleTypeChange(e.target.value)}
              ?disabled=${e||this.loading}
              aria-label="Storage pool type"
              aria-required="true"
            >
              <option value="dir">Directory</option>
              <option value="netfs">Network File System (NFS)</option>
              <option value="logical">Logical Volume (LVM)</option>
            </select>
          </div>

          ${"dir"===this.formData.type?J`
            <div class="form-field">
              <label class="form-label" for="pool-path">Storage Path *</label>
              <input
                id="pool-path"
                type="text"
                class="form-input ${this.errors.path?"error":""}"
                .value=${this.formData.path||""}
                @input=${e=>this.handleInputChange("path",e.target.value)}
                ?disabled=${e||this.loading}
                placeholder="/var/lib/libvirt/images/pool-name"
                aria-label="Storage path"
                aria-required="true"
                aria-invalid=${this.errors.path?"true":"false"}
                aria-describedby=${this.errors.path?"path-error path-hint":"path-hint"}
              />
              ${this.errors.path?J`<span id="path-error" class="form-error" role="alert">${this.errors.path}</span>`:""}
              <span id="path-hint" class="form-hint">Must be an absolute path (e.g., /path/to/storage)</span>
            </div>
          `:""}

          ${"netfs"===this.formData.type?J`
            <div class="form-field">
              <label class="form-label" for="pool-source">NFS Server *</label>
              <input
                id="pool-source"
                type="text"
                class="form-input ${this.errors.source?"error":""}"
                .value=${this.formData.source||""}
                @input=${e=>this.handleInputChange("source",e.target.value)}
                ?disabled=${e||this.loading}
                placeholder="nfs.example.com:/export/path"
                aria-label="NFS server source"
                aria-required="true"
                aria-invalid=${this.errors.source?"true":"false"}
                aria-describedby=${this.errors.source?"source-error":void 0}
              />
              ${this.errors.source?J`<span id="source-error" class="form-error" role="alert">${this.errors.source}</span>`:""}
            </div>

            <div class="form-field">
              <label class="form-label" for="pool-target">Mount Point *</label>
              <input
                id="pool-target"
                type="text"
                class="form-input ${this.errors.target?"error":""}"
                .value=${this.formData.target||""}
                @input=${e=>this.handleInputChange("target",e.target.value)}
                ?disabled=${e||this.loading}
                placeholder="/mnt/nfs-storage"
                aria-label="NFS mount point"
                aria-required="true"
                aria-invalid=${this.errors.target?"true":"false"}
                aria-describedby=${this.errors.target?"target-error":void 0}
              />
              ${this.errors.target?J`<span id="target-error" class="form-error" role="alert">${this.errors.target}</span>`:""}
            </div>
          `:""}

          <div class="form-field">
            <div class="form-checkbox-wrapper">
              <input
                type="checkbox"
                class="form-checkbox"
                .checked=${this.formData.autostart}
                @change=${e=>this.handleInputChange("autostart",e.target.checked)}
                ?disabled=${this.loading}
                id="autostart-checkbox"
              />
              <label class="form-label" for="autostart-checkbox" style="margin: 0;">
                Start pool automatically on boot
              </label>
            </div>
          </div>
        </form>

        <div class="drawer-footer">
          <button
            type="button"
            class="btn btn-cancel"
            @click=${this.handleClose}
            ?disabled=${this.loading}
          >
            Cancel
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            @click=${this.handleSubmit}
            ?disabled=${this.loading}
          >
            ${this.loading?this.editMode?"Updating...":"Creating...":this.editMode?"Update":"Create"}
          </button>
        </div>
      </div>
    `}};dx.styles=g`
    :host {
      display: block;
      position: fixed;
      top: 0;
      right: 0;
      width: 700px;
      height: 100vh;
      z-index: 1000;
      pointer-events: none;
    }

    :host([show]) {
      pointer-events: auto;
    }

    .drawer {
      width: 100%;
      height: 100%;
      background: var(--vscode-editor-background, var(--vscode-bg-light));
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      border-left: 1px solid var(--vscode-border);
    }

    :host([show]) .drawer {
      transform: translateX(0);
    }

    .drawer-header {
      padding: 20px;
      background: var(--vscode-bg-lighter, #252526);
      border-bottom: 1px solid var(--vscode-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .header-title {
      font-size: 18px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
    }

    .close-button {
      background: none;
      border: none;
      color: var(--vscode-foreground, #cccccc);
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 20px;
      transition: background 0.2s;
    }

    .close-button:hover {
      background: var(--vscode-toolbar-hoverBackground, rgba(255, 255, 255, 0.1));
    }

    .drawer-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .form-field {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 6px;
      font-size: 13px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
    }

    .form-input,
    .form-select {
      width: 100%;
      padding: 8px 12px;
      background: var(--vscode-input-background, #3c3c3c);
      border: 1px solid var(--vscode-input-border, #3c3c3c);
      border-radius: 4px;
      color: var(--vscode-input-foreground, #cccccc);
      font-size: 13px;
      font-family: inherit;
      outline: none;
      box-sizing: border-box;
    }

    .form-input:focus,
    .form-select:focus {
      border-color: var(--vscode-focusBorder, #007acc);
    }

    .form-input:disabled,
    .form-select:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .form-input.error {
      border-color: var(--vscode-inputValidation-errorBorder, #f48771);
    }

    .form-hint {
      display: block;
      margin-top: 4px;
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #999999);
    }

    .form-error {
      display: block;
      margin-top: 4px;
      font-size: 12px;
      color: var(--vscode-inputValidation-errorForeground, #f48771);
    }

    .form-checkbox-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-checkbox {
      width: 16px;
      height: 16px;
      cursor: pointer;
    }

    .edit-note {
      padding: 12px;
      margin-bottom: 16px;
      background: var(--vscode-inputValidation-infoBorder, rgba(0, 122, 204, 0.1));
      border: 1px solid var(--vscode-inputValidation-infoBorder, #007acc);
      border-radius: 4px;
      color: var(--vscode-foreground, #cccccc);
      font-size: 13px;
    }

    .drawer-footer {
      padding: 16px 20px;
      background: var(--vscode-bg-lighter, #252526);
      border-top: 1px solid var(--vscode-border);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      flex-shrink: 0;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      border: 1px solid transparent;
      transition: all 0.2s;
    }

    .btn-cancel {
      background: var(--vscode-button-secondaryBackground, #3a3d41);
      color: var(--vscode-button-secondaryForeground, #cccccc);
    }

    .btn-cancel:hover {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
    }

    .btn-primary {
      background: var(--vscode-button-background, #0e639c);
      color: var(--vscode-button-foreground, white);
    }

    .btn-primary:hover {
      background: var(--vscode-button-hoverBackground, #1177bb);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  `,cx([we({type:Boolean,reflect:!0})],dx.prototype,"show",2),cx([we({type:Boolean})],dx.prototype,"loading",2),cx([we({type:Boolean})],dx.prototype,"editMode",2),cx([we({type:Object})],dx.prototype,"poolData",2),cx([xe()],dx.prototype,"formData",2),cx([xe()],dx.prototype,"errors",2),dx=cx([ve("storage-pool-form-drawer")],dx);var hx=Object.defineProperty,ux=Object.getOwnPropertyDescriptor,px=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?ux(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&hx(t,s,r),r};let gx=class extends me{constructor(){super(...arguments),this.storeController=new Zl.StoreController(this,By.$state),this.filteredPoolsController=new Zl.StoreController(this,xw),this.virtualizationEnabledController=new Zl.StoreController(this,Ay),this.virtualizationDisabledMessageController=new Zl.StoreController(this,Iy),this.selectedPoolController=new Zl.StoreController(this,ww),this.activeTabController=new Zl.StoreController(this,iw),this.searchQueryController=new Zl.StoreController(this,ow),this.showDetails=!1,this.showDeleteModal=!1,this.itemToDelete=null,this.isDeleting=!1,this.showFormDrawer=!1,this.showEditDrawer=!1,this.editingPool=null,this.isCreating=!1,this.isUpdating=!1,this.hasVolumes=!1,this.volumeCount=0,this.tabs=[{id:"all",label:"All Pools"},{id:"active",label:"Active"},{id:"inactive",label:"Inactive"},{id:"local",label:"Local Storage"},{id:"network",label:"Network Storage"}]}async connectedCallback(){super.connectedCallback(),await this.loadData()}formatBytes(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB","TB","PB"][t]}calculateUsagePercentage(e,t){return 0===t?0:Math.round(e/t*100)}transformStoragePool(e){return{...e,id:e.name,capacityFormatted:this.formatBytes(e.capacity),allocatedFormatted:this.formatBytes(e.allocation),availableFormatted:this.formatBytes(e.available),usage:this.calculateUsagePercentage(e.allocation,e.capacity)}}async loadData(){try{await Ew.fetchAll()}catch(e){console.error("Error loading storage pools:",e),this.showNotification(`Failed to load storage pools: ${e instanceof Error?e.message:"Unknown error"}`,"error")}}getColumns(){return[{key:"name",label:"Name",type:"link"},{key:"type",label:"Type"},{key:"state",label:"State",type:"status"},{key:"capacityFormatted",label:"Capacity"},{key:"allocatedFormatted",label:"Allocated"},{key:"availableFormatted",label:"Available"},{key:"usage",label:"Usage %"},{key:"path",label:"Path/Target"},{key:"autostart",label:"Autostart"}]}getActions(e){const t=[{label:"View Details",action:"view"},{label:"Browse",action:"browse"}];return"active"===e.state?t.push({label:"Refresh",action:"refresh"},{label:"Stop",action:"stop"}):t.push({label:"Start",action:"start"}),t.push({label:"Edit",action:"edit"},{label:"Delete",action:"delete",danger:!0}),t}getFilteredData(){return(this.filteredPoolsController.value||[]).map(e=>this.transformStoragePool(e))}async handleTabChange(e){Ew.setActiveTab(e.detail.tabId)}handleCellClick(e){const t=e.detail.item;this.viewDetails(t)}handleAction(e){const{action:t,item:s}=e.detail,i=s;switch(t){case"view":this.viewDetails(i);break;case"browse":this.browsePool(i);break;case"refresh":this.refreshPool(i);break;case"start":case"stop":this.changePoolState(i,t);break;case"edit":this.editPool(i);break;case"delete":this.deletePool(i)}}viewDetails(e){Ew.selectPool(e.name),this.showDetails=!0}browsePool(e){console.log("Browsing pool:",e.name)}async refreshPool(e){try{await Ew.refresh(e.name),this.showNotification(`Refreshed pool: ${e.name}`,"success")}catch(t){this.showNotification(`Failed to refresh pool: ${e.name}`,"error")}}async changePoolState(e,t){try{"start"===t?(await Ew.start(e.name),this.showNotification(`Starting pool: ${e.name}`,"success")):"stop"===t&&(await Ew.stop(e.name),this.showNotification(`Stopping pool: ${e.name}`,"success"))}catch(s){this.showNotification(`Failed to ${t} pool: ${s instanceof Error?s.message:"Unknown error"}`,"error")}}editPool(e){this.editingPool=e,this.showEditDrawer=!0}deletePool(e){this.itemToDelete={name:e.name,type:"Storage Pool"},this.hasVolumes=e.volumes&&e.volumes.length>0||!1,this.volumeCount=e.volumes?.length||0,this.showDeleteModal=!0}async handleDelete(e){if(!this.itemToDelete)return;const t=e.detail?.deleteVolumes||!1;this.isDeleting=!0;try{const e=this.getFilteredData().find(e=>e.name===this.itemToDelete?.name);if(e){await yy.deleteStoragePool(e.name,t),this.showNotification(`Storage pool "${e.name}" deleted successfully`,"success");try{await Ew.fetchAll()}catch(s){console.warn("Failed to refresh pool list after delete:",s)}}this.showDeleteModal=!1,this.itemToDelete=null,this.hasVolumes=!1,this.volumeCount=0}catch(i){console.error("Failed to delete storage pool:",i);let e="Unknown error";if(i.message)if(e=i.message,i.message.includes("volume")||"POOL_NOT_EMPTY"===i.code){const t=i.message.match(/contains (\d+) volume/);e=`Cannot delete pool: contains ${t?parseInt(t[1]):this.volumeCount} volume(s). Delete volumes first or check 'Delete all volumes' option.`}else if("NOT_FOUND"===i.code||i.message.includes("not found")){e="Storage pool not found. It may have already been deleted.",this.showDeleteModal=!1,this.itemToDelete=null,this.hasVolumes=!1,this.volumeCount=0;try{await Ew.fetchAll()}catch(s){console.warn("Failed to refresh pool list:",s)}}this.showNotification(`Failed to delete storage pool: ${e}`,"error")}finally{this.isDeleting=!1}}handleCreateNew(){this.editingPool=null,this.showFormDrawer=!0}handleSearchChange(e){Ew.setSearchQuery(e.detail.value)}async handleFormSave(e){const{formData:t}=e.detail;this.isCreating=!0;try{const e={name:t.name,type:t.type,autostart:t.autostart};"dir"===t.type&&t.path?e.path=t.path:"netfs"===t.type&&(e.source=t.source,e.target=t.target),await Ew.create(e),this.showNotification(`Storage pool "${t.name}" created successfully`,"success"),this.showFormDrawer=!1}catch(s){console.error("Failed to create pool:",s);let e="Unknown error";s.message?e=s.message:s.details&&(e=s.details),this.showNotification(`Failed to create storage pool: ${e}`,"error")}finally{this.isCreating=!1}}async handleEditSave(e){if(!this.editingPool)return;const{formData:t}=e.detail;this.isUpdating=!0;try{await Ew.update(this.editingPool.name,{autostart:t.autostart}),this.showNotification(`Storage pool "${this.editingPool.name}" updated successfully`,"success"),this.showEditDrawer=!1,this.editingPool=null}catch(s){console.error("Failed to update pool:",s);let e="Unknown error";s.message&&(e=s.message),this.showNotification(`Failed to update storage pool: ${e}`,"error")}finally{this.isUpdating=!1}}showNotification(e,t="info"){this.dispatchEvent(new CustomEvent("show-notification",{detail:{message:e,type:t},bubbles:!0,composed:!0}))}getUsageClass(e){return e>=90?"usage-danger":e>=75?"usage-warning":""}renderVirtualizationDisabledBanner(e){return J`
      <div class="virtualization-disabled-banner">
        <h2>Virtualization is disabled on this host</h2>
        <p>Virtualization features are currently unavailable because libvirt is not installed or not running.\
 To manage storage pools, install and start libvirt on this machine, then reload this page.</p>
        ${e?J`<p>${e}</p>`:""}
      </div>
    `}render(){if(!1===this.virtualizationEnabledController.value){const e=this.virtualizationDisabledMessageController.value;return J`
        <div class="container">
          ${this.renderVirtualizationDisabledBanner(e)}
        </div>
      `}const e=this.storeController.value,t=this.getFilteredData(),s=this.activeTabController.value,i=this.searchQueryController.value,o=this.selectedPoolController.value;return J`
      <div class="container">

        <tab-group
          .tabs=${this.tabs}
          .activeTab=${s}
          @tab-change=${this.handleTabChange}
        ></tab-group>

        <div class="controls">
          <search-input
            .placeholder=${"Search storage pools..."}
            .value=${i}
            @search-change=${this.handleSearchChange}
          ></search-input>
          <button class="btn-create" @click=${this.handleCreateNew}>
            <span>+ New Pool</span>
          </button>
        </div>

        <div class="content">
          ${e.loading?J`
            <loading-state message="Loading storage pools..."></loading-state>
          `:e.error?J`
            <empty-state
              icon="â"
              title="Error loading storage pools"
              description=${e.error.message}
            ></empty-state>
          `:0===t.length?J`
            <empty-state
              icon="ðï¸"
              title="No storage pools found"
              description=${i?"No pools match your search criteria":"Create your first storage pool to get started"}
            ></empty-state>
          `:J`
            <resource-table
              .columns=${this.getColumns()}
              .data=${t.map(e=>({...e,autostart:e.autostart?"Yes":"No",usage:J`
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <span>${e.usage}%</span>
                    <div class="usage-bar" style="width: 60px;">
                      <div class="usage-fill ${this.getUsageClass(e.usage)}" 
                           style="width: ${e.usage}%"></div>
                    </div>
                  </div>
                `}))}
              .getActions=${e=>this.getActions(e)}
              @cell-click=${this.handleCellClick}
              @action=${this.handleAction}
            ></resource-table>
          `}
        </div>

        ${this.showDetails&&o?J`
          <detail-drawer
            .title=${o.name||"Pool Details"}
            .show=${this.showDetails}
            @close=${()=>{this.showDetails=!1,Ew.selectPool(null)}}
          >
            <div style="padding: 20px;">
              <h3>Storage Pool Information</h3>
              <div style="display: grid; grid-template-columns: 150px 1fr; gap: 12px; margin-bottom: 20px;">
                <strong>Name:</strong> <span>${o.name}</span>
                <strong>Type:</strong> <span>${o.type}</span>
                <strong>State:</strong> <span>${o.state}</span>
                <strong>Path:</strong> <span>${o.path}</span>
                <strong>Capacity:</strong> <span>${this.formatBytes(o.capacity)}</span>
                <strong>Allocated:</strong> <span>${this.formatBytes(o.allocation)}</span>
                <strong>Available:</strong> <span>${this.formatBytes(o.available)}</span>
                <strong>Usage:</strong> <span>${this.calculateUsagePercentage(o.allocation,o.capacity)}%</span>
                <strong>Autostart:</strong> <span>${o.autostart?"Yes":"No"}</span>
              </div>
              ${o.volumes&&o.volumes.length>0?J`
                <h4>Volumes (${o.volumes.length})</h4>
                <div style="max-height: 300px; overflow-y: auto;">
                  <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                      <tr style="border-bottom: 1px solid var(--vscode-widget-border);">
                        <th style="text-align: left; padding: 8px;">Name</th>
                        <th style="text-align: left; padding: 8px;">Type</th>
                        <th style="text-align: left; padding: 8px;">Format</th>
                        <th style="text-align: right; padding: 8px;">Size</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${o.volumes.map(e=>J`
                        <tr style="border-bottom: 1px solid var(--vscode-widget-border);">
                          <td style="padding: 8px;">${e.name}</td>
                          <td style="padding: 8px;">${e.type}</td>
                          <td style="padding: 8px;">${e.format}</td>
                          <td style="text-align: right; padding: 8px;">${this.formatBytes(e.capacity)}</td>
                        </tr>
                      `)}
                    </tbody>
                  </table>
                </div>
              `:""}
            </div>
          </detail-drawer>
        `:""}

        
        
        
        ${this.showDeleteModal?J`
          <delete-modal
            .show=${this.showDeleteModal}
            .item=${this.itemToDelete}
            .loading=${this.isDeleting}
            .hasVolumes=${this.hasVolumes}
            .volumeCount=${this.volumeCount}
            @confirm-delete=${this.handleDelete}
            @cancel-delete=${()=>{this.showDeleteModal=!1,this.itemToDelete=null,this.hasVolumes=!1,this.volumeCount=0}}
          ></delete-modal>
        `:""}

        <storage-pool-form-drawer
          .show=${this.showFormDrawer}
          .loading=${this.isCreating}
          .editMode=${!1}
          .poolData=${null}
          @save=${this.handleFormSave}
          @close=${()=>{this.showFormDrawer=!1}}
        ></storage-pool-form-drawer>

        <storage-pool-form-drawer
          .show=${this.showEditDrawer}
          .loading=${this.isUpdating}
          .editMode=${!0}
          .poolData=${this.editingPool}
          @save=${this.handleEditSave}
          @close=${()=>{this.showEditDrawer=!1,this.editingPool=null}}
        ></storage-pool-form-drawer>
      </div>
    `}};gx.styles=g`
    :host {
      display: block;
      height: 100%;
      box-sizing: border-box;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 1rem;
    }


    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      gap: 1rem;
    }

    search-input {
      flex: 1;
      max-width: 400px;
    }

    .content {
      flex: 1;
      overflow-y: auto;
    }

    .btn-create {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-create:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }


    .usage-bar {
      width: 100%;
      height: 6px;
      background: var(--vscode-progressBar-background);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 4px;
    }

    .usage-fill {
      height: 100%;
      background: var(--vscode-progressBar-foreground);
      transition: width 0.3s ease;
    }

    .usage-warning {
      background: var(--vscode-testing-iconQueued);
    }

    .usage-danger {
      background: var(--vscode-testing-iconFailed);
    }

    .virtualization-disabled-banner {
      margin-top: 16px;
      padding: 16px 20px;
      border-radius: 8px;
      border: 1px solid var(--vscode-inputValidation-warningBorder, #e2c08d);
      background: var(--vscode-inputValidation-warningBackground, rgba(229, 200, 144, 0.15));
      color: var(--vscode-inputValidation-warningForeground, #e2c08d);
    }

    .virtualization-disabled-banner h2 {
      margin: 0 0 8px 0;
      font-size: 16px;
      font-weight: 500;
    }

    .virtualization-disabled-banner p {
      margin: 0 0 4px 0;
      font-size: 13px;
      color: var(--vscode-descriptionForeground);
    }
  `,px([xe()],gx.prototype,"showDetails",2),px([xe()],gx.prototype,"showDeleteModal",2),px([xe()],gx.prototype,"itemToDelete",2),px([xe()],gx.prototype,"isDeleting",2),px([xe()],gx.prototype,"showFormDrawer",2),px([xe()],gx.prototype,"showEditDrawer",2),px([xe()],gx.prototype,"editingPool",2),px([xe()],gx.prototype,"isCreating",2),px([xe()],gx.prototype,"isUpdating",2),px([xe()],gx.prototype,"hasVolumes",2),px([xe()],gx.prototype,"volumeCount",2),gx=px([ve("virtualization-storage-pools")],gx);var mx=Object.defineProperty,fx=Object.getOwnPropertyDescriptor,vx=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?fx(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&mx(t,s,r),r};let bx=class extends me{constructor(){super(...arguments),this.show=!1,this.loading=!1,this.editMode=!1,this.networkData=null,this.formData={name:"",mode:"nat",bridge:"",ipAddress:"",netmask:"",dhcpStart:"",dhcpEnd:"",autostart:!0,hosts:[]},this.errors={},this.isClosing=!1,this.handleEscape=e=>{"Escape"===e.key&&this.show&&!this.loading&&(e.stopPropagation(),this.handleClose())},this.handleClose=()=>{this.loading||this.isClosing||(this.isClosing=!0,setTimeout(()=>{this.isClosing=!1,this.dispatchEvent(new CustomEvent("close",{bubbles:!0,composed:!0}))},250))}}connectedCallback(){super.connectedCallback(),window.addEventListener("keydown",this.handleEscape)}disconnectedCallback(){window.removeEventListener("keydown",this.handleEscape),super.disconnectedCallback()}willUpdate(e){if(e.has("networkData")&&this.networkData){const e=this.networkData;this.formData={name:e.name??"",mode:e.mode??"nat",bridge:e.bridge??"",ipAddress:e.ipAddress??"",netmask:e.netmask??"",dhcpStart:e.dhcpStart??"",dhcpEnd:e.dhcpEnd??"",autostart:e.autostart??!0,hosts:e.hosts??[]},this.errors={}}e.has("show")&&(this.show?requestAnimationFrame(()=>{const e=this.renderRoot.querySelector("#network-name");e?.focus()}):setTimeout(()=>{this.formData={name:"",mode:"nat",bridge:"",ipAddress:"",netmask:"",dhcpStart:"",dhcpEnd:"",autostart:!0,hosts:[]},this.errors={}},300))}validateField(e){const t=this.formData[e];let s="";switch(e){case"name":{const e=String(t||"").trim();e?/^[a-zA-Z0-9_-]+$/.test(e)||(s="Use only letters, numbers, dashes, and underscores"):s="Name is required";break}case"bridge":if("bridge"===this.formData.mode){String(t||"").trim()||(s="Bridge name is required for bridge mode")}}const i={...this.errors};return s?i[e]=s:delete i[e],this.errors=i,!s}validateForm(){const e=["name"];"bridge"===this.formData.mode&&e.push("bridge");let t=!0;for(const a of e)this.validateField(a)||(t=!1);const s=!!this.formData.ipAddress.trim(),i=!!this.formData.netmask.trim();"nat"!==this.formData.mode&&"route"!==this.formData.mode||s&&i||(this.errors={...this.errors,ipAddress:s?this.errors.ipAddress||"":"IP address is required for NAT/Route networks",netmask:i?this.errors.netmask||"":"Netmask is required for NAT/Route networks"},t=!1),(s||i)&&(s&&i||(this.errors={...this.errors,ipAddress:s?this.errors.ipAddress||"":"IP address is required when netmask is set",netmask:i?this.errors.netmask||"":"Netmask is required when IP address is set"},t=!1));const o=!!this.formData.dhcpStart.trim(),r=!!this.formData.dhcpEnd.trim();return(o||r)&&(o&&r||(this.errors={...this.errors,dhcpStart:o?this.errors.dhcpStart||"":"DHCP start is required when end is set",dhcpEnd:r?this.errors.dhcpEnd||"":"DHCP end is required when start is set"},t=!1)),t}handleInputChange(e,t){this.formData={...this.formData,[e]:t},"name"!==e&&"bridge"!==e||this.validateField(e)}handleModeChange(e){if(this.formData={...this.formData,mode:e},"bridge"!==e&&this.errors.bridge){const{bridge:e,...t}=this.errors;this.errors=t}}addHostRow(){this.formData={...this.formData,hosts:[...this.formData.hosts,{mac:"",ip:"",name:""}]}}updateHostRow(e,t,s){const i=this.formData.hosts.map((i,o)=>o===e?{...i,[t]:s}:i);this.formData={...this.formData,hosts:i}}removeHostRow(e){const t=this.formData.hosts.filter((t,s)=>s!==e);this.formData={...this.formData,hosts:t}}handleSubmit(e){if(e.preventDefault(),this.loading)return;if(!this.validateForm())return;const t=this.formData.name.trim(),s={...this.formData,name:t,bridge:this.formData.bridge.trim(),ipAddress:this.formData.ipAddress.trim(),netmask:this.formData.netmask.trim(),dhcpStart:this.formData.dhcpStart.trim(),dhcpEnd:this.formData.dhcpEnd.trim(),hosts:this.formData.hosts.map(e=>({mac:e.mac.trim(),ip:e.ip.trim(),name:e.name.trim()})).filter(e=>e.mac||e.ip||e.name)};this.dispatchEvent(new CustomEvent("save",{detail:{formData:s},bubbles:!0,composed:!0}))}get showDhcpSection(){return!!this.formData.ipAddress.trim()&&!!this.formData.netmask.trim()}render(){return this.show||this.isClosing?J`
      <div class="drawer ${this.isClosing?"closing":""}" role="dialog" aria-modal="true">
        <div class="drawer-header">
          <h2 class="drawer-title">
            ${this.editMode?"Edit Virtual Network":"Create Virtual Network"}
          </h2>
          <button class="close-btn" @click=${this.handleClose} aria-label="Close">
            Ã
          </button>
        </div>
        <div class="drawer-body">
          <form @submit=${this.handleSubmit}>
            <div class="section">
              <h3 class="section-title">General</h3>
              <div class="field">
                <label for="network-name" class="required">Name</label>
                <input
                  id="network-name"
                  class=${this.errors.name?"error":""}
                  type="text"
                  .value=${this.formData.name}
                  ?disabled=${this.loading||this.editMode}
                  @input=${e=>this.handleInputChange("name",e.target.value)}
                />
                ${this.errors.name?J`<div class="error-text">${this.errors.name}</div>`:J`<div class="hint">Use lowercase letters, numbers, dashes, and underscores.</div>`}
              </div>

              <div class="field">
                <label for="network-mode" class="required">Mode</label>
                <select
                  id="network-mode"
                  .value=${this.formData.mode}
                  ?disabled=${this.loading}
                  @change=${e=>this.handleModeChange(e.target.value)}
                >
                  <option value="nat">NAT</option>
                  <option value="route">Route</option>
                  <option value="bridge">Bridge</option>
                  <option value="private">Private</option>
                </select>
              </div>

              ${"bridge"===this.formData.mode?J`<div class="field">
                    <label for="network-bridge" class="required">Host bridge name</label>
                    <input
                      id="network-bridge"
                      class=${this.errors.bridge?"error":""}
                      type="text"
                      .value=${this.formData.bridge}
                      ?disabled=${this.loading}
                      @input=${e=>this.handleInputChange("bridge",e.target.value)}
                    />
                    ${this.errors.bridge?J`<div class="error-text">${this.errors.bridge}</div>`:J`<div class="hint">Existing host bridge to attach this virtual network to (e.g. br0).</div>`}
                  </div>`:null}

              <div class="checkbox-row">
                <input
                  id="network-autostart"
                  type="checkbox"
                  .checked=${this.formData.autostart}
                  ?disabled=${this.loading}
                  @change=${e=>this.handleInputChange("autostart",e.target.checked)}
                />
                <label for="network-autostart">Start network automatically on host boot</label>
              </div>
            </div>

            <div class="section">
              <h3 class="section-title">IP Range</h3>
              <div class="field-row">
                <div class="field">
                  <label for="ip-address">Address</label>
                  <input
                    id="ip-address"
                    class=${this.errors.ipAddress?"error":""}
                    type="text"
                    .value=${this.formData.ipAddress}
                    ?disabled=${this.loading}
                    @input=${e=>this.handleInputChange("ipAddress",e.target.value)}
                  />
                  ${this.errors.ipAddress?J`<div class="error-text">${this.errors.ipAddress}</div>`:J`<div class="hint">Gateway IP, e.g. 192.168.250.1</div>`}
                </div>
                <div class="field">
                  <label for="netmask">Netmask</label>
                  <input
                    id="netmask"
                    class=${this.errors.netmask?"error":""}
                    type="text"
                    .value=${this.formData.netmask}
                    ?disabled=${this.loading}
                    @input=${e=>this.handleInputChange("netmask",e.target.value)}
                  />
                  ${this.errors.netmask?J`<div class="error-text">${this.errors.netmask}</div>`:J`<div class="hint">Netmask, e.g. 255.255.255.0</div>`}
                </div>
              </div>
              <div class="hint">Required for NAT/Route networks. Optional for Bridge/Private.</div>
            </div>

            ${this.showDhcpSection?J`<div class="section">
                  <h3 class="section-title">DHCP (optional)</h3>
                  <div class="field-row">
                    <div class="field">
                      <label for="dhcp-start">Start IP</label>
                      <input
                        id="dhcp-start"
                        class=${this.errors.dhcpStart?"error":""}
                        type="text"
                        .value=${this.formData.dhcpStart}
                        ?disabled=${this.loading}
                        @input=${e=>this.handleInputChange("dhcpStart",e.target.value)}
                      />
                      ${this.errors.dhcpStart?J`<div class="error-text">${this.errors.dhcpStart}</div>`:J`<div class="hint">First IP in DHCP pool.</div>`}
                    </div>
                    <div class="field">
                      <label for="dhcp-end">End IP</label>
                      <input
                        id="dhcp-end"
                        class=${this.errors.dhcpEnd?"error":""}
                        type="text"
                        .value=${this.formData.dhcpEnd}
                        ?disabled=${this.loading}
                        @input=${e=>this.handleInputChange("dhcpEnd",e.target.value)}
                      />
                      ${this.errors.dhcpEnd?J`<div class="error-text">${this.errors.dhcpEnd}</div>`:J`<div class="hint">Last IP in DHCP pool.</div>`}
                    </div>
                  </div>

                  <div class="field">
                    <label>Static DHCP hosts (optional)</label>
                    <table class="hosts-table">
                      <thead>
                        <tr>
                          <th>MAC address</th>
                          <th>IP address</th>
                          <th>Hostname</th>
                          <th></th>
                        </tr>
                      </thead>
                      <tbody>
                        ${this.formData.hosts.map((e,t)=>J`<tr>
                            <td>
                              <input
                                type="text"
                                .value=${e.mac}
                                ?disabled=${this.loading}
                                @input=${e=>this.updateHostRow(t,"mac",e.target.value)}
                              />
                            </td>
                            <td>
                              <input
                                type="text"
                                .value=${e.ip}
                                ?disabled=${this.loading}
                                @input=${e=>this.updateHostRow(t,"ip",e.target.value)}
                              />
                            </td>
                            <td>
                              <input
                                type="text"
                                .value=${e.name}
                                ?disabled=${this.loading}
                                @input=${e=>this.updateHostRow(t,"name",e.target.value)}
                              />
                            </td>
                            <td style="text-align: center;">
                              <button
                                type="button"
                                class="btn btn-ghost btn-danger"
                                ?disabled=${this.loading}
                                @click=${()=>this.removeHostRow(t)}
                              >
                                Remove
                              </button>
                            </td>
                          </tr>`)}
                      </tbody>
                    </table>
                    <button
                      type="button"
                      class="btn btn-ghost"
                      ?disabled=${this.loading}
                      @click=${this.addHostRow}
                    >
                      Add static host
                    </button>
                  </div>
                </div>`:null}
          </form>
        </div>
        <div class="drawer-footer">
          <button
            type="button"
            class="btn btn-secondary"
            @click=${this.handleClose}
            ?disabled=${this.loading}
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            @click=${this.handleSubmit}
            ?disabled=${this.loading}
          >
            ${this.loading?this.editMode?"Updating...":"Creating...":this.editMode?"Update":"Create"}
          </button>
        </div>
      </div>
    `:null}};bx.styles=g`
    :host {
      display: block;
    }

    .drawer {
      position: fixed;
      inset-block: 0;
      inset-inline-end: 0;
      width: 480px;
      max-width: 100%;
      background: var(--vscode-editor-background, var(--vscode-bg-light));
      border-left: 1px solid var(--vscode-border);
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      animation: slideIn 0.25s ease-out;
      z-index: 1001;
    }

    .drawer.closing {
      animation: slideOut 0.25s ease-in;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
      }
      to {
        transform: translateX(0);
      }
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
      }
      to {
        transform: translateX(100%);
      }
    }

    .drawer-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--vscode-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--vscode-editor-background, var(--vscode-bg-light));
    }

    .drawer-title {
      margin: 0;
      font-size: 16px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
    }

    .close-btn {
      background: transparent;
      border: none;
      color: var(--vscode-foreground, #cccccc);
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      font-size: 18px;
      line-height: 1;
    }

    .close-btn:hover {
      background: var(--vscode-toolbar-hoverBackground, rgba(90, 93, 94, 0.31));
    }

    .drawer-body {
      padding: 16px 20px 80px;
      overflow-y: auto;
      flex: 1;
    }

    .drawer-footer {
      padding: 12px 20px;
      border-top: 1px solid var(--vscode-border);
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      background: var(--vscode-editor-background, var(--vscode-bg-light));
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .section {
      border-radius: 4px;
      border: 1px solid var(--vscode-border);
      padding: 12px 12px 8px;
      background: var(--vscode-editorWidget-background, rgba(0, 0, 0, 0.03));
    }

    .section + .section {
      margin-top: 4px;
    }

    .section-title {
      font-size: 13px;
      font-weight: 600;
      margin: 0 0 8px 0;
      color: var(--vscode-foreground, #cccccc);
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 10px;
    }

    .field-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    label {
      font-size: 12px;
      font-weight: 500;
      color: var(--vscode-descriptionForeground, #9d9d9d);
    }

    .required::after {
      content: ' *';
      color: var(--vscode-inputValidation-errorForeground, #f48771);
    }

    input,
    select {
      padding: 6px 8px;
      border-radius: 3px;
      border: 1px solid var(--vscode-input-border, #5a5a5a);
      background: var(--vscode-input-background, #3c3c3c);
      color: var(--vscode-input-foreground, #cccccc);
      font-size: 13px;
      font-family: inherit;
      outline: none;
      box-sizing: border-box;
    }

    input:focus,
    select:focus {
      border-color: var(--vscode-focusBorder, #007acc);
    }

    input:disabled,
    select:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    input.error,
    select.error {
      border-color: var(--vscode-inputValidation-errorBorder, #be1100);
    }

    .error-text {
      color: var(--vscode-inputValidation-errorForeground, #f48771);
      font-size: 11px;
    }

    .hint {
      font-size: 11px;
      color: var(--vscode-descriptionForeground, #9d9d9d);
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
    }

    .hosts-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 12px;
    }

    .hosts-table th,
    .hosts-table td {
      border: 1px solid var(--vscode-border);
      padding: 4px 6px;
    }

    .hosts-table th {
      background: var(--vscode-editor-background, var(--vscode-bg-light));
      font-weight: 500;
      text-align: left;
    }

    .btn {
      padding: 6px 12px;
      border-radius: 4px;
      border: 1px solid transparent;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      font-family: inherit;
    }

    .btn-primary {
      background: var(--vscode-button-background, #0e639c);
      color: var(--vscode-button-foreground, #ffffff);
      border-color: var(--vscode-button-background, #0e639c);
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--vscode-button-hoverBackground, #1177bb);
      border-color: var(--vscode-button-hoverBackground, #1177bb);
    }

    .btn-secondary {
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border-color: var(--vscode-button-border, #5a5a5a);
    }

    .btn-secondary:hover:not(:disabled) {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
    }

    .btn-ghost {
      background: transparent;
      color: var(--vscode-button-foreground, #ffffff);
      border-color: var(--vscode-button-border, #5a5a5a);
      font-size: 11px;
      padding: 4px 8px;
    }

    .btn-ghost:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.05);
    }

    .btn-danger {
      color: var(--vscode-errorForeground, #f48771);
      border-color: rgba(244, 135, 113, 0.4);
      background: rgba(244, 135, 113, 0.08);
    }

    .btn-danger:hover:not(:disabled) {
      background: rgba(244, 135, 113, 0.16);
    }
  `,vx([we({type:Boolean,reflect:!0})],bx.prototype,"show",2),vx([we({type:Boolean})],bx.prototype,"loading",2),vx([we({type:Boolean})],bx.prototype,"editMode",2),vx([we({type:Object})],bx.prototype,"networkData",2),vx([xe()],bx.prototype,"formData",2),vx([xe()],bx.prototype,"errors",2),vx([xe()],bx.prototype,"isClosing",2),bx=vx([ve("network-form-drawer")],bx);const yx=Ue({}),wx={addNotification(e){const t=Bd(),s={...e,id:t,timestamp:Date.now(),duration:e.duration??5e3};return yx.setKey(t,s),s.duration&&s.duration>0&&setTimeout(()=>{this.removeNotification(t)},s.duration),t},removeNotification(e){const t=yx.get();if(t[e]){const s={...t};delete s[e],yx.set(s)}},clearAll(){yx.set({})}};var xx=Object.defineProperty,_x=Object.getOwnPropertyDescriptor,kx=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?_x(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&xx(t,s,r),r};let Sx=class extends me{constructor(){super(...arguments),this.virtualizationEnabledController=new Zl.StoreController(this,Ay),this.virtualizationDisabledMessageController=new Zl.StoreController(this,Iy),this.networks=[],this.searchQuery="",this.loading=!1,this.error=null,this.activeTab="all",this.showDetailDrawer=!1,this.selectedNetwork=null,this.isLoadingDetail=!1,this.isClosingDetailDrawer=!1,this.detailActiveTab="overview",this.dhcpLeases=[],this.dhcpLeasesCount=0,this.dhcpLeasesLoading=!1,this.dhcpLeasesError=null,this.networkPorts=[],this.networkPortsCount=0,this.networkPortsLoading=!1,this.networkPortsError=null,this.showDeleteModal=!1,this.itemToDelete=null,this.isDeleting=!1,this.showCreateDrawer=!1,this.showEditDrawer=!1,this.isCreating=!1,this.isUpdating=!1,this.editingNetworkForm=null,this.editingNetworkName=null,this.tabs=[{id:"all",label:"All Networks"},{id:"active",label:"Active"},{id:"inactive",label:"Inactive"},{id:"persistent",label:"Persistent"},{id:"autostart",label:"Autostart"}]}connectedCallback(){super.connectedCallback(),this.loadData()}async loadData(){this.loading=!0,this.error=null;try{const{networks:e}=await yy.listNetworks();console.log("Networks API response:",e),this.networks=(e||[]).map(e=>({name:e.name||"Unnamed Network",uuid:e.uuid||"",state:e.state,bridge:e.bridge||"",mode:e.mode||"",ip_range:{address:e.ip_range?.address||e.ip||"",netmask:e.ip_range?.netmask||e.netmask||""},autostart:e.autostart||!1,persistent:void 0===e.persistent||e.persistent}))}catch(e){console.error("Failed to load networks:",e),e instanceof uy||(this.error=e instanceof Error?e.message:"Failed to load networks"),this.networks=[]}finally{this.loading=!1}}getColumns(){return[{key:"name",label:"Name",type:"link"},{key:"state",label:"State",type:"status"},{key:"bridge",label:"Bridge"},{key:"mode",label:"Mode"},{key:"ip_address",label:"IP Address"},{key:"netmask",label:"Netmask"},{key:"autostart",label:"Autostart"},{key:"persistent",label:"Persistent"},{key:"uuid",label:"UUID"}]}getActions(e){const t=[{label:"View Details",action:"view"}];return"active"===e.state?(t.push({label:"Stop",action:"stop"}),t.push({label:"Restart",action:"restart"})):t.push({label:"Start",action:"start"}),t.push({label:"Edit",action:"edit"},{label:"Delete",action:"delete",danger:!0}),t}getFilteredData(){let e=this.networks;if("all"!==this.activeTab)switch(this.activeTab){case"active":case"inactive":e=e.filter(e=>e.state===this.activeTab);break;case"persistent":e=e.filter(e=>e.persistent);break;case"autostart":e=e.filter(e=>e.autostart)}if(this.searchQuery){const t=this.searchQuery.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.bridge.toLowerCase().includes(t)||e.uuid.toLowerCase().includes(t)||e.ip_range.address.toLowerCase().includes(t))}return e}async handleTabChange(e){this.activeTab=e.detail.tabId}handleCellClick(e){const{item:t,column:s}=e.detail;"name"===s.key&&this.viewNetworkDetail(t)}handleAction(e){const{action:t,item:s}=e.detail,i=s;switch(t){case"view":this.viewNetworkDetail(i);break;case"dhcp-leases":this.viewDHCPLeases(i);break;case"start":case"stop":case"restart":this.changeNetworkState(i,t);break;case"clone":this.cloneNetwork(i);break;case"edit":this.editNetwork(i);break;case"delete":this.deleteNetwork(i)}}async viewNetworkDetail(e){this.showDetailDrawer=!0,this.isLoadingDetail=!0,this.selectedNetwork=e,this.detailActiveTab="overview",this.dhcpLeases=[],this.dhcpLeasesCount=0,this.dhcpLeasesError=null,this.networkPorts=[],this.networkPortsCount=0,this.networkPortsError=null,console.log("Opening detail drawer for network:",e);try{const t=await yy.getNetwork(e.name);console.log("Detailed network response:",t),this.selectedNetwork={name:t.name||e.name||"Unnamed Network",uuid:t.uuid||e.uuid,state:t.state,bridge:t.bridge||"",mode:t.mode||e.mode||"",ip_range:{address:t.ip_range?.address||t.ip||"",netmask:t.ip_range?.netmask||t.netmask||""},autostart:t.autostart||!1,persistent:void 0===t.persistent||t.persistent,dhcp:t.dhcp,forward:t.forward}}catch(t){if(console.error("Failed to fetch network details:",t),t instanceof uy)return this.error=t.message,void this.closeDetailDrawer();const s=this.mapNetworkErrorToMessage(t,"Failed to load network details");wx.addNotification({type:"error",title:"Failed to load network details",message:s}),"NETWORK_NOT_FOUND"===t?.code&&(this.networks=this.networks.filter(t=>t.name!==e.name),this.closeDetailDrawer())}finally{this.isLoadingDetail=!1}}closeDetailDrawer(){(this.showDetailDrawer||this.selectedNetwork)&&(this.isClosingDetailDrawer=!0,setTimeout(()=>{this.showDetailDrawer=!1,this.selectedNetwork=null,this.isLoadingDetail=!1,this.detailActiveTab="overview",this.dhcpLeases=[],this.dhcpLeasesCount=0,this.dhcpLeasesError=null,this.networkPorts=[],this.networkPortsCount=0,this.networkPortsError=null,this.isClosingDetailDrawer=!1},300))}async setDetailTab(e){this.detailActiveTab=e;const t=this.selectedNetwork?.name;if(t)try{if("dhcp"===e){if(this.dhcpLeasesLoading||this.dhcpLeases.length>0||this.dhcpLeasesError)return;await this.loadDhcpLeases(t)}else if("ports"===e){if(this.networkPortsLoading||this.networkPorts.length>0||this.networkPortsError)return;await this.loadNetworkPorts(t)}}catch(s){console.error("Failed to change detail tab:",s)}}async loadDhcpLeases(e){this.dhcpLeasesLoading=!0,this.dhcpLeasesError=null;try{const t=await yy.getNetworkDHCPLeases(e);this.dhcpLeases=t.leases||[],this.dhcpLeasesCount=t.count??this.dhcpLeases.length}catch(t){if(console.error("Failed to load DHCP leases:",t),t instanceof uy)return this.error=t.message,void this.closeDetailDrawer();const s=this.mapNetworkErrorToMessage(t,"Failed to load DHCP leases"),i=t?.code;"NETWORK_NOT_FOUND"===i?(this.dhcpLeasesError=s,this.networks=this.networks.filter(t=>t.name!==e),this.closeDetailDrawer()):this.dhcpLeasesError=s,wx.addNotification({type:"error",title:"Failed to load DHCP leases",message:s})}finally{this.dhcpLeasesLoading=!1}}async loadNetworkPorts(e){this.networkPortsLoading=!0,this.networkPortsError=null;try{const t=await yy.getNetworkPorts(e);this.networkPorts=t.ports||[],this.networkPortsCount=t.count??this.networkPorts.length}catch(t){if(console.error("Failed to load network ports:",t),t instanceof uy)return this.error=t.message,void this.closeDetailDrawer();const s=this.mapNetworkErrorToMessage(t,"Failed to load network ports"),i=t?.code;"NETWORK_NOT_FOUND"===i?(this.networkPortsError=s,this.networks=this.networks.filter(t=>t.name!==e),this.closeDetailDrawer()):this.networkPortsError=s,wx.addNotification({type:"error",title:"Failed to load network ports",message:s})}finally{this.networkPortsLoading=!1}}async viewDHCPLeases(e){await this.viewNetworkDetail(e),await this.setDetailTab("dhcp")}async changeNetworkState(e,t){try{switch(t){case"start":await yy.startNetwork(e.name);break;case"stop":await yy.stopNetwork(e.name);break;case"restart":await yy.stopNetwork(e.name),await yy.startNetwork(e.name)}await this.loadData();const s="start"===t?"started":"stop"===t?"stopped":"restarted";wx.addNotification({type:"success",title:`Network ${s}`,message:`Virtual network ${e.name} was ${s} successfully`})}catch(s){if(console.error(`Failed to ${t} network:`,s),s instanceof uy)return void(this.error=s.message);const e=this.mapNetworkErrorToMessage(s,`Failed to ${t} network`);wx.addNotification({type:"error",title:`Failed to ${t} network`,message:e})}}cloneNetwork(e){console.log("Cloning network:",e.name)}async editNetwork(e){this.isUpdating=!1,this.editingNetworkName=e.name;try{const t=await yy.getNetwork(e.name),s=t.ip_range||{address:t.ip||"",netmask:t.netmask||""},i=t.dhcp||{},o={name:t.name||e.name,mode:t.mode||"nat",bridge:t.bridge||"",ipAddress:s.address||"",netmask:s.netmask||"",dhcpStart:i.start||"",dhcpEnd:i.end||"",autostart:t.autostart??e.autostart,hosts:Array.isArray(i.hosts)?i.hosts.map(e=>({mac:e.mac||"",ip:e.ip||"",name:e.name||""})):[]};this.editingNetworkForm=o,this.showEditDrawer=!0}catch(t){if(console.error("Failed to load network for editing:",t),t instanceof uy)this.error=t.message;else{const s=this.mapNetworkErrorToMessage(t,"Failed to load network for editing");wx.addNotification({type:"error",title:"Failed to load network for editing",message:s}),"NETWORK_NOT_FOUND"===t?.code&&(this.networks=this.networks.filter(t=>t.name!==e.name))}this.editingNetworkForm=null,this.editingNetworkName=null}}deleteNetwork(e){this.itemToDelete={name:e.name,type:"Virtual Network"},this.showDeleteModal=!0}formatIPRange(e){return e.ip_range.address&&e.ip_range.netmask?`${e.ip_range.address}/${e.ip_range.netmask}`:"Not configured"}async handleDelete(){if(this.itemToDelete){this.isDeleting=!0;try{const e=this.networks.find(e=>e.name===this.itemToDelete?.name);e&&(await yy.deleteNetwork(e.name),await this.loadData(),wx.addNotification({type:"success",title:"Network deleted",message:`Virtual network ${e.name} was deleted successfully`}))}catch(e){if(console.error("Failed to delete network:",e),e instanceof uy)return void(this.error=e.message);const t=this.mapNetworkErrorToMessage(e,"Failed to delete network");wx.addNotification({type:"error",title:"Failed to delete network",message:t})}finally{this.isDeleting=!1,this.showDeleteModal=!1,this.itemToDelete=null}}}handleCreateNew(){this.editingNetworkForm=null,this.editingNetworkName=null,this.showCreateDrawer=!0}handleSearchChange(e){this.searchQuery=e.detail.value}mapNetworkErrorToMessage(e,t){const s=e?.code,i=e instanceof Error?e.message:t;switch(s){case"INVALID_NETWORK_REQUEST":case"INVALID_REQUEST":return"The network configuration is invalid. Please review the form fields.";case"NETWORK_NOT_FOUND":return"The network was not found. It may have been deleted or renamed.";case"CREATE_NETWORK_FAILED":return i||"Failed to create virtual network.";case"UPDATE_NETWORK_FAILED":return i||"Failed to update virtual network.";case"DELETE_NETWORK_FAILED":return i||"Failed to delete virtual network.";default:return i||t}}buildCreatePayload(e){const t={name:e.name.trim(),mode:e.mode,autostart:e.autostart};return"bridge"===e.mode&&e.bridge.trim()&&(t.bridge=e.bridge.trim()),e.ipAddress&&e.netmask&&(t.ip_range={address:e.ipAddress,netmask:e.netmask}),e.dhcpStart&&e.dhcpEnd&&(t.dhcp={start:e.dhcpStart,end:e.dhcpEnd},e.hosts.length>0&&(t.dhcp.hosts=e.hosts.map(e=>({mac:e.mac,ip:e.ip,name:e.name||void 0})))),t}buildUpdatePayload(e){const t={autostart:e.autostart,mode:e.mode};return"bridge"===e.mode&&e.bridge.trim()&&(t.bridge=e.bridge.trim()),e.ipAddress&&e.netmask&&(t.ip_range={address:e.ipAddress,netmask:e.netmask}),e.dhcpStart&&e.dhcpEnd&&(t.dhcp={start:e.dhcpStart,end:e.dhcpEnd},e.hosts.length>0&&(t.dhcp.hosts=e.hosts.map(e=>({mac:e.mac,ip:e.ip,name:e.name||void 0})))),t}async handleCreateSave(e){this.isCreating=!0;try{const t=this.buildCreatePayload(e.detail.formData);await yy.createNetwork(t),await this.loadData(),this.showCreateDrawer=!1,wx.addNotification({type:"success",title:"Network created",message:`Virtual network ${t.name} was created successfully`})}catch(t){if(console.error("Failed to create network:",t),t instanceof uy)return void(this.error=t.message);const e=this.mapNetworkErrorToMessage(t,"Failed to create network");wx.addNotification({type:"error",title:"Failed to create network",message:e})}finally{this.isCreating=!1}}async handleEditSave(e){if(this.editingNetworkName){this.isUpdating=!0;try{const t=this.buildUpdatePayload(e.detail.formData);await yy.updateNetwork(this.editingNetworkName,t),await this.loadData(),this.showEditDrawer=!1,this.editingNetworkForm=null;const s=this.editingNetworkName;this.editingNetworkName=null,wx.addNotification({type:"success",title:"Network updated",message:`Virtual network ${s} was updated successfully`})}catch(t){if(console.error("Failed to update network:",t),t instanceof uy)return void(this.error=t.message);const e=this.mapNetworkErrorToMessage(t,"Failed to update network");wx.addNotification({type:"error",title:"Failed to update network",message:e})}finally{this.isUpdating=!1}}}renderNetworkMode(e){if(!e)return J`<span>-</span>`;return J`<span class="network-type-badge ${"nat"===e?"badge-nat":"bridge"===e?"badge-bridge":"badge-isolated"}">${e||"Default"}</span>`}renderDetailDrawer(){if(!this.selectedNetwork)return"";const e=this.selectedNetwork,t=e;return J`
      <div class="drawer ${this.isClosingDetailDrawer?"closing":""}">
        <div class="drawer-header">
          <h2 class="drawer-title">${e.name}</h2>
          <button class="close-btn" @click=${this.closeDetailDrawer}>â</button>
        </div>
        
        <div class="drawer-content">
          ${this.isLoadingDetail?J`
            <loading-state message="Loading network details..."></loading-state>
          `:J`
            <div class="network-details-content">
              <div class="detail-tabs">
                <button
                  class="detail-tab ${"overview"===this.detailActiveTab?"active":""}"
                  @click=${()=>this.setDetailTab("overview")}
                >
                  Overview
                </button>
                <button
                  class="detail-tab ${"dhcp"===this.detailActiveTab?"active":""}"
                  @click=${()=>this.setDetailTab("dhcp")}
                >
                  DHCP Leases
                </button>
                <button
                  class="detail-tab ${"ports"===this.detailActiveTab?"active":""}"
                  @click=${()=>this.setDetailTab("ports")}
                >
                  Ports
                </button>
              </div>

              ${"overview"===this.detailActiveTab?J`<div class="detail-sections">
                    <!-- Basic Information -->
                    <div class="detail-section">
                      <h3>Basic Information</h3>
                      
                      <div class="detail-item">
                        <strong class="detail-key">Name:</strong>
                        <span class="detail-value">${e.name}</span>
                      </div>
                      
                      <div class="detail-item">
                        <strong class="detail-key">UUID:</strong>
                        <span class="detail-value monospace">${e.uuid||"Not available"}</span>
                      </div>
                      
                      <div class="detail-item">
                        <strong class="detail-key">State:</strong>
                        <span class="detail-value">
                          <span class="badge-inline ${"active"===e.state?"badge-active":"badge-inactive"}">
                            ${"active"===e.state?"â":"â"} ${e.state}
                          </span>
                        </span>
                      </div>
                      
                      <div class="detail-item">
                        <strong class="detail-key">Network Mode:</strong>
                        <span class="detail-value">${this.renderNetworkMode(e.mode)}</span>
                      </div>
                      
                      <div class="detail-item">
                        <strong class="detail-key">Bridge Interface:</strong>
                        <span class="detail-value monospace">${e.bridge||"Not configured"}</span>
                      </div>
                      
                      <div class="detail-item">
                        <strong class="detail-key">Autostart:</strong>
                        <span class="detail-value">
                          <span class="badge-inline ${e.autostart?"badge-enabled":"badge-disabled"}">
                            ${e.autostart?"Enabled":"Disabled"}
                          </span>
                        </span>
                      </div>
                      
                      <div class="detail-item">
                        <strong class="detail-key">Persistent:</strong>
                        <span class="detail-value">
                          <span class="badge-inline ${e.persistent?"badge-enabled":"badge-disabled"}">
                            ${e.persistent?"Yes":"No"}
                          </span>
                        </span>
                      </div>
                    </div>
                    
                    <!-- IP Configuration -->
                    <div class="detail-section">
                      <h3>IP Configuration</h3>
                      
                      <div class="detail-item">
                        <strong class="detail-key">Network Address:</strong>
                        <span class="detail-value monospace">${e.ip_range.address||"Not configured"}</span>
                      </div>
                      
                      <div class="detail-item">
                        <strong class="detail-key">Netmask:</strong>
                        <span class="detail-value monospace">${e.ip_range.netmask||"Not configured"}</span>
                      </div>
                      
                      <div class="detail-item">
                        <strong class="detail-key">CIDR Notation:</strong>
                        <span class="detail-value monospace">${this.formatIPRange(e)}</span>
                      </div>
                      
                      ${e.ip_range.address&&e.ip_range.netmask?J`
                        <div class="detail-item">
                          <strong class="detail-key">Broadcast Address:</strong>
                          <span class="detail-value monospace">${this.calculateBroadcast(e.ip_range.address,e.ip_range.netmask)}</span>
                        </div>
                      `:""}
                    </div>
                    
                    <!-- DHCP Configuration if available -->
                    ${t.dhcp?J`
                      <div class="detail-section">
                        <h3>DHCP Configuration</h3>
                        
                        <div class="detail-item">
                          <strong class="detail-key">DHCP Status:</strong>
                          <span class="detail-value">
                            <span class="badge-inline ${t.dhcp?.enabled?"badge-enabled":"badge-disabled"}">
                              ${t.dhcp?.enabled?"Enabled":"Disabled"}
                            </span>
                          </span>
                        </div>
                        
                        ${t.dhcp?.start&&t.dhcp?.end?J`
                          <div class="detail-item">
                            <strong class="detail-key">DHCP Range:</strong>
                            <span class="detail-value monospace">
                              ${t.dhcp.start} - ${t.dhcp.end}
                            </span>
                          </div>
                          
                          <div class="detail-item">
                            <strong class="detail-key">Pool Size:</strong>
                            <span class="detail-value">
                              ${this.calculatePoolSize(t.dhcp.start,t.dhcp.end)} addresses
                            </span>
                          </div>
                        `:""}
                        
                        ${t.dhcp?.hosts&&t.dhcp.hosts.length>0?J`
                          <div class="detail-item nested">
                            <strong class="detail-key">Static Leases:</strong>
                            <div class="nested-content">
                              <div class="dhcp-hosts-list">
                                ${t.dhcp.hosts.map(e=>J`
                                  <div class="dhcp-host-item">
                                    <span><strong>MAC:</strong> <span class="monospace">${e.mac}</span></span>
                                    <span><strong>IP:</strong> <span class="monospace">${e.ip}</span></span>
                                    ${e.name?J`<span><strong>Name:</strong> ${e.name}</span>`:""}
                                  </div>
                                `)}
                              </div>
                            </div>
                          </div>
                        `:""}
                      </div>
                    `:""}
                    
                    <!-- Network Forwarding if available -->
                    ${t.forward?J`
                      <div class="detail-section">
                        <h3>Network Forwarding</h3>
                        
                        <div class="detail-item">
                          <strong class="detail-key">Forward Mode:</strong>
                          <span class="detail-value">
                            <span class="badge-inline">${t.forward.mode||"Not configured"}</span>
                          </span>
                        </div>
                        
                        ${t.forward.dev?J`
                          <div class="detail-item">
                            <strong class="detail-key">Physical Device:</strong>
                            <span class="detail-value monospace">${t.forward.dev}</span>
                          </div>
                        `:""}
                        
                        ${t.forward.nat?J`
                          <div class="detail-item nested">
                            <strong class="detail-key">NAT Configuration:</strong>
                            <div class="nested-content">
                              ${t.forward.nat.start?J`
                                <div class="detail-item">
                                  <strong class="detail-key">Port Range Start:</strong>
                                  <span class="detail-value">${t.forward.nat.start}</span>
                                </div>
                              `:""}
                              ${t.forward.nat.end?J`
                                <div class="detail-item">
                                  <strong class="detail-key">Port Range End:</strong>
                                  <span class="detail-value">${t.forward.nat.end}</span>
                                </div>
                              `:""}
                            </div>
                          </div>
                        `:""}
                      </div>
                    `:""}
                    
                    <!-- DNS Configuration if available -->
                    ${t.dns?J`
                      <div class="detail-section">
                        <h3>DNS Configuration</h3>
                        
                        ${t.dns.forwarders&&t.dns.forwarders.length>0?J`
                          <div class="detail-item">
                            <strong class="detail-key">DNS Forwarders:</strong>
                            <span class="detail-value">
                              ${t.dns.forwarders.map(e=>J`
                                <span class="monospace">${e}</span>${t.dns.forwarders.indexOf(e)<t.dns.forwarders.length-1?", ":""}
                              `)}
                            </span>
                          </div>
                        `:""}
                        
                        ${t.dns.domain?J`
                          <div class="detail-item">
                            <strong class="detail-key">Domain:</strong>
                            <span class="detail-value monospace">${t.dns.domain}</span>
                          </div>
                        `:""}
                      </div>
                    `:""}
                    
                    <!-- Additional Metadata -->
                    ${t.metadata?J`
                      <div class="detail-section">
                        <h3>Metadata</h3>
                        
                        ${t.metadata.created?J`
                          <div class="detail-item">
                            <strong class="detail-key">Created:</strong>
                            <span class="detail-value">${new Date(t.metadata.created).toLocaleString()}</span>
                          </div>
                        `:""}
                        
                        ${t.metadata.modified?J`
                          <div class="detail-item">
                            <strong class="detail-key">Last Modified:</strong>
                            <span class="detail-value">${new Date(t.metadata.modified).toLocaleString()}</span>
                          </div>
                        `:""}
                      </div>
                    `:""}
                  </div>`:"dhcp"===this.detailActiveTab?this.renderDhcpLeasesTab():this.renderPortsTab()}
            </div>
          `}
        </div>
        
        <div class="drawer-footer">
          ${"active"===e.state?J`
            <button 
              class="btn btn-secondary" 
              @click=${()=>this.changeNetworkState(e,"stop")}
              ?disabled=${this.isLoadingDetail}
            >
              Stop Network
            </button>
          `:J`
            <button 
              class="btn btn-secondary" 
              @click=${()=>this.changeNetworkState(e,"start")}
              ?disabled=${this.isLoadingDetail}
            >
              Start Network
            </button>
          `}
          <button 
            class="btn btn-secondary" 
            @click=${()=>this.editNetwork(e)}
            ?disabled=${this.isLoadingDetail}
          >
            Edit Configuration
          </button>
          <button class="btn btn-primary" @click=${this.closeDetailDrawer}>
            Close
          </button>
        </div>
      </div>
    `}renderDhcpLeasesTab(){return this.dhcpLeasesLoading?J`<loading-state message="Loading DHCP leases..."></loading-state>`:this.dhcpLeasesError?J`<div class="detail-sections">
        <div class="detail-section">
          <h3>DHCP Leases</h3>
          <div class="error-text">${this.dhcpLeasesError}</div>
        </div>
      </div>`:0===this.dhcpLeases.length?J`<div class="detail-sections">
        <div class="detail-section">
          <h3>DHCP Leases</h3>
          <p class="hint">No active DHCP leases for this network.</p>
        </div>
      </div>`:J`<div class="detail-sections">
      <div class="detail-section">
        <h3>DHCP Leases (${this.dhcpLeasesCount})</h3>
        <table class="detail-table">
          <thead>
            <tr>
              <th>Interface</th>
              <th>MAC</th>
              <th>IP Address</th>
              <th>Prefix</th>
              <th>Type</th>
              <th>Hostname</th>
              <th>Expiry</th>
            </tr>
          </thead>
          <tbody>
            ${this.dhcpLeases.map(e=>J`<tr>
              <td>${e.iface||e.interface||"-"}</td>
              <td class="monospace">${e.mac||"-"}</td>
              <td class="monospace">${e.ip_address||e.ip||"-"}</td>
              <td>${e.prefix??"-"}</td>
              <td>${e.type||"-"}</td>
              <td>${e.hostname||"-"}</td>
              <td>${e.expiry_time?new Date(e.expiry_time).toLocaleString():"-"}</td>
            </tr>`)}
          </tbody>
        </table>
      </div>
    </div>`}renderPortsTab(){return this.networkPortsLoading?J`<loading-state message="Loading attached ports..."></loading-state>`:this.networkPortsError?J`<div class="detail-sections">
        <div class="detail-section">
          <h3>Attached Ports</h3>
          <div class="error-text">${this.networkPortsError}</div>
        </div>
      </div>`:0===this.networkPorts.length?J`<div class="detail-sections">
        <div class="detail-section">
          <h3>Attached Ports</h3>
          <p class="hint">No virtual machines are currently attached to this network.</p>
        </div>
      </div>`:J`<div class="detail-sections">
      <div class="detail-section">
        <h3>Attached Ports (${this.networkPortsCount})</h3>
        <table class="detail-table">
          <thead>
            <tr>
              <th>VM Name</th>
              <th>VM UUID</th>
              <th>State</th>
              <th>Interface</th>
              <th>MAC</th>
              <th>Model</th>
              <th>Type</th>
              <th>Target</th>
              <th>IP Address</th>
            </tr>
          </thead>
          <tbody>
            ${this.networkPorts.map(e=>J`<tr>
              <td>${e.vm_name||"-"}</td>
              <td class="monospace">${e.vm_uuid||"-"}</td>
              <td>${e.vm_state||e.state||"-"}</td>
              <td>${e.interface||e.iface||"-"}</td>
              <td class="monospace">${e.mac||"-"}</td>
              <td>${e.model||"-"}</td>
              <td>${e.type||"-"}</td>
              <td>${e.target||"-"}</td>
              <td class="monospace">${e.ip_address||e.ip||"-"}</td>
            </tr>`)}
          </tbody>
        </table>
      </div>
    </div>`}calculateBroadcast(e,t){try{const s=e.split(".").map(Number),i=t.split(".").map(Number);if(4!==s.length||4!==i.length)return"N/A";return s.map((e,t)=>{const s=i[t];return void 0===s?0:e|255&~s}).join(".")}catch{return"N/A"}}calculatePoolSize(e,t){try{const s=e.split(".").reduce((e,t)=>(e<<8)+parseInt(t),0);return t.split(".").reduce((e,t)=>(e<<8)+parseInt(t),0)-s+1}catch{return 0}}renderVirtualizationDisabledBanner(e){return J`
      <div class="virtualization-disabled-banner">
        <h2>Virtualization is disabled on this host</h2>
        <p>Virtualization features are currently unavailable because libvirt is not installed or not running.\
 To manage virtual networks, install and start libvirt on this machine, then reload this page.</p>
        ${e?J`<p>${e}</p>`:""}
      </div>
    `}render(){if(!1===this.virtualizationEnabledController.value){const e=this.virtualizationDisabledMessageController.value;return J`
        <div class="container">
          ${this.renderVirtualizationDisabledBanner(e)}
        </div>
      `}const e=this.getFilteredData();return J`
      <div class="container">

        <tab-group
          .tabs=${this.tabs}
          .activeTab=${this.activeTab}
          @tab-change=${this.handleTabChange}
        ></tab-group>

        <div class="controls">
          <search-input
            .placeholder=${"Search networks..."}
            .value=${this.searchQuery}
            @search-change=${this.handleSearchChange}
          ></search-input>
          <button class="btn-create" @click=${this.handleCreateNew}>
            <span>+ New Network</span>
          </button>
        </div>

        <div class="content">
          ${this.loading?J`
            <loading-state message="Loading virtual networks..."></loading-state>
          `:this.error?J`
            <empty-state
              icon="â"
              title="Error loading networks"
              description=${this.error}
            ></empty-state>
          `:0===e.length?J`
            <empty-state
              icon="ð"
              title="No virtual networks found"
              description=${this.searchQuery?"No networks match your search criteria":0===this.networks.length?"No virtual networks configured. Create your first network to get started.":"No networks match the selected filter"}
            ></empty-state>
          `:J`
            <resource-table
              .columns=${this.getColumns()}
              .data=${e.map(e=>({...e,mode:this.renderNetworkMode(e.mode),ip_address:e.ip_range.address||"Not configured",netmask:e.ip_range.netmask||"Not configured",autostart:e.autostart?"Yes":"No",persistent:e.persistent?"Yes":"No"}))}
              .getActions=${e=>this.getActions(e)}
              @cell-click=${this.handleCellClick}
              @action=${this.handleAction}
            ></resource-table>
          `}
        </div>

        <!-- Detail Drawer -->
        ${this.showDetailDrawer||this.isClosingDetailDrawer?this.renderDetailDrawer():""}

        ${this.showDeleteModal&&this.itemToDelete?J`
          <delete-modal
            .show=${!0}
            .item=${this.itemToDelete}
            .loading=${this.isDeleting}
            @confirm-delete=${this.handleDelete}
            @cancel-delete=${()=>{this.showDeleteModal=!1,this.itemToDelete=null}}
          ></delete-modal>
        `:""}

        <network-form-drawer
          .show=${this.showCreateDrawer}
          .loading=${this.isCreating}
          .editMode=${!1}
          .networkData=${null}
          @save=${this.handleCreateSave}
          @close=${()=>{this.showCreateDrawer=!1}}
        ></network-form-drawer>

        <network-form-drawer
          .show=${this.showEditDrawer}
          .loading=${this.isUpdating}
          .editMode=${!0}
          .networkData=${this.editingNetworkForm}
          @save=${this.handleEditSave}
          @close=${()=>{this.showEditDrawer=!1,this.editingNetworkForm=null,this.editingNetworkName=null}}
        ></network-form-drawer>
      </div>
    `}};Sx.styles=g`
    :host {
      display: block;
      height: 100%;
      box-sizing: border-box;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 1rem;
    }



    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      gap: 1rem;
    }

    search-input {
      flex: 1;
      max-width: 400px;
    }

    .content {
      flex: 1;
      overflow-y: auto;
    }

    .btn-create {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-create:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }


    .network-type-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 3px;
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
    }

    .badge-bridge {
      background: var(--vscode-badge-background);
      color: var(--vscode-badge-foreground);
    }

    .badge-nat {
      background: var(--vscode-testing-iconPassed);
      color: white;
    }

    .badge-isolated {
      background: var(--vscode-testing-iconQueued);
      color: white;
    }

    .badge-host {
      background: var(--vscode-testing-iconFailed);
      color: white;
    }

    /* Detail Drawer Styles - Similar to ISO management */
    .drawer {
      position: fixed;
      top: 0;
      right: 0;
      width: 50%;
      height: 100%;
      background: var(--vscode-editor-background, var(--vscode-bg-light));
      border-left: 1px solid var(--vscode-border);
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      z-index: 1001;
      overflow-y: auto;
      animation: slideIn 0.3s ease-out;
    }

    .drawer.closing {
      animation: slideOut 0.3s ease-in;
    }

    @media (max-width: 1024px) {
      .drawer {
        width: 80%;
      }
    }

    @media (max-width: 768px) {
      .drawer {
        width: 100%;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
      }
      to {
        transform: translateX(0);
      }
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
      }
      to {
        transform: translateX(100%);
      }
    }

    .drawer-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--vscode-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--vscode-editor-background, var(--vscode-bg-light));
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .drawer-title {
      font-size: 18px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
      margin: 0;
    }

    .drawer-content {
      padding: 24px;
      overflow-y: auto;
    }

    .drawer-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--vscode-border);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      background: var(--vscode-editor-background, var(--vscode-bg-light));
      position: sticky;
      bottom: 0;
      z-index: 10;
    }

    .close-btn {
      background: transparent;
      border: none;
      color: var(--vscode-foreground, #cccccc);
      cursor: pointer;
      padding: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      font-size: 20px;
      line-height: 1;
      transition: all 0.2s;
    }

    .close-btn:hover {
      background: var(--vscode-toolbar-hoverBackground, rgba(90, 93, 94, 0.31));
      color: var(--vscode-icon-foreground, #c5c5c5);
    }

    .detail-sections {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .detail-section {
      margin-bottom: 20px;
    }

    .detail-section h3 {
      font-size: 14px;
      font-weight: 600;
      color: var(--vscode-foreground, #cccccc);
      margin: 0 0 12px 0;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--vscode-border);
    }

    .detail-item {
      display: flex;
      align-items: flex-start;
      padding: 8px 0;
      font-size: 13px;
      line-height: 1.5;
    }

    .detail-item:not(:last-child) {
      border-bottom: 1px solid var(--vscode-border);
    }

    .detail-key {
      flex: 0 0 180px;
      color: var(--vscode-descriptionForeground, #9d9d9d);
      font-weight: 500;
    }

    .detail-value {
      flex: 1;
      color: var(--vscode-foreground, #cccccc);
      word-break: break-word;
    }

    .detail-value.monospace {
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 12px;
    }

    .detail-item.nested {
      flex-direction: column;
    }

    .nested-content {
      margin-top: 8px;
      margin-left: 180px;
      padding-left: 12px;
      border-left: 2px solid var(--vscode-border);
    }

    .badge-inline {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 11px;
      font-weight: 500;
      gap: 4px;
    }

    .badge-active {
      background: var(--vscode-testing-runAction, rgba(115, 201, 145, 0.2));
      color: var(--vscode-button-foreground, #ffffff);
      border: 1px solid var(--vscode-testing-runAction, rgba(115, 201, 145, 0.3));
    }

    .badge-inactive {
      background: var(--vscode-inputValidation-errorBackground, rgba(161, 38, 13, 0.2));
      color: var(--vscode-inputValidation-errorForeground, #ff8c66);
      border: 1px solid var(--vscode-inputValidation-errorBorder, rgba(161, 38, 13, 0.3));
    }

    .badge-enabled {
      background: var(--vscode-testing-runAction, rgba(56, 138, 52, 0.2));
      color: var(--vscode-button-foreground, #ffffff);
      border: 1px solid var(--vscode-testing-runAction, rgba(56, 138, 52, 0.3));
    }

    .badge-disabled {
      background: var(--vscode-inputValidation-warningBackground, rgba(161, 38, 13, 0.2));
      color: var(--vscode-inputValidation-warningForeground, #ff8c66);
      border: 1px solid var(--vscode-inputValidation-warningBorder, rgba(161, 38, 13, 0.3));
    }

    .dhcp-hosts-list {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .dhcp-host-item {
      padding: 6px 0;
      display: flex;
      gap: 20px;
      font-size: 12px;
      border-bottom: 1px solid var(--vscode-border);
    }

    .dhcp-host-item:last-child {
      border-bottom: none;
    }

    .detail-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      border-bottom: 1px solid var(--vscode-border);
    }

    .detail-tab {
      padding: 6px 12px;
      border: none;
      background: transparent;
      color: var(--vscode-text-dim, #9d9d9d);
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      border-bottom: 2px solid transparent;
    }

    .detail-tab.active {
      border-bottom-color: var(--vscode-accent, #007acc);
      color: var(--vscode-foreground, #cccccc);
    }

    .detail-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-top: 8px;
    }

    .detail-table th,
    .detail-table td {
      border: 1px solid var(--vscode-border);
      padding: 4px 6px;
      text-align: left;
    }

    .detail-table th {
      background: var(--vscode-editor-background, var(--vscode-bg-light));
      font-weight: 500;
    }

    .dhcp-host-item span {
      flex: 1;
      color: var(--vscode-foreground, #cccccc);
    }

    .dhcp-host-item strong {
      color: var(--vscode-descriptionForeground, #9d9d9d);
      font-weight: 500;
      margin-right: 8px;
    }

    .raw-data {
      background: var(--vscode-editor-background, var(--vscode-bg-light));
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      padding: 12px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 12px;
      overflow-x: auto;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 8px;
    }

    details {
      cursor: pointer;
    }

    details summary {
      padding: 8px 12px;
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border-radius: 4px;
      font-size: 13px;
      font-weight: 500;
      transition: background 0.2s;
      user-select: none;
    }

    details summary:hover {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
    }

    details[open] summary {
      border-radius: 4px 4px 0 0;
      margin-bottom: 0;
    }


    .btn {
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
      font-family: inherit;
    }

    .btn-primary {
      background: var(--vscode-button-background, #0e639c);
      color: var(--vscode-button-foreground, #ffffff);
      border: 1px solid var(--vscode-button-background, #0e639c);
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--vscode-button-hoverBackground, #1177bb);
      border-color: var(--vscode-button-hoverBackground, #1177bb);
    }

    .btn-secondary {
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border: 1px solid var(--vscode-button-border, #5a5a5a);
    }

    .btn-secondary:hover:not(:disabled) {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
      border-color: var(--vscode-button-border, #5a5a5a);
    }

    .btn-secondary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .virtualization-disabled-banner {
      margin-top: 16px;
      padding: 16px 20px;
      border-radius: 8px;
      border: 1px solid var(--vscode-inputValidation-warningBorder, #e2c08d);
      background: var(--vscode-inputValidation-warningBackground, rgba(229, 200, 144, 0.15));
      color: var(--vscode-inputValidation-warningForeground, #e2c08d);
    }

    .virtualization-disabled-banner h2 {
      margin: 0 0 8px 0;
      font-size: 16px;
      font-weight: 500;
    }

    .virtualization-disabled-banner p {
      margin: 0 0 4px 0;
      font-size: 13px;
      color: var(--vscode-descriptionForeground);
    }
  `,kx([xe()],Sx.prototype,"networks",2),kx([xe()],Sx.prototype,"searchQuery",2),kx([xe()],Sx.prototype,"loading",2),kx([xe()],Sx.prototype,"error",2),kx([xe()],Sx.prototype,"activeTab",2),kx([xe()],Sx.prototype,"showDetailDrawer",2),kx([xe()],Sx.prototype,"selectedNetwork",2),kx([xe()],Sx.prototype,"isLoadingDetail",2),kx([xe()],Sx.prototype,"isClosingDetailDrawer",2),kx([xe()],Sx.prototype,"detailActiveTab",2),kx([xe()],Sx.prototype,"dhcpLeases",2),kx([xe()],Sx.prototype,"dhcpLeasesCount",2),kx([xe()],Sx.prototype,"dhcpLeasesLoading",2),kx([xe()],Sx.prototype,"dhcpLeasesError",2),kx([xe()],Sx.prototype,"networkPorts",2),kx([xe()],Sx.prototype,"networkPortsCount",2),kx([xe()],Sx.prototype,"networkPortsLoading",2),kx([xe()],Sx.prototype,"networkPortsError",2),kx([xe()],Sx.prototype,"showDeleteModal",2),kx([xe()],Sx.prototype,"itemToDelete",2),kx([xe()],Sx.prototype,"isDeleting",2),kx([xe()],Sx.prototype,"showCreateDrawer",2),kx([xe()],Sx.prototype,"showEditDrawer",2),kx([xe()],Sx.prototype,"isCreating",2),kx([xe()],Sx.prototype,"isUpdating",2),kx([xe()],Sx.prototype,"editingNetworkForm",2),kx([xe()],Sx.prototype,"editingNetworkName",2),Sx=kx([ve("virtualization-networks")],Sx);var Cx=Object.defineProperty,$x=Object.getOwnPropertyDescriptor,Dx=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?$x(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Cx(t,s,r),r};let Ex=class extends me{constructor(){super(...arguments),this.isoStoreController=new Zl.StoreController(this,Uy.$state),this.availableISOsController=new Zl.StoreController(this,_w),this._uploadStateController=new Zl.StoreController(this,Zy),this.virtualizationEnabledController=new Zl.StoreController(this,Ay),this.virtualizationDisabledMessageController=new Zl.StoreController(this,Iy),this.storagePoolStoreController=new Zl.StoreController(this,By.$items),this.searchQuery="",this.showUploadDrawer=!1,this.isClosingUploadDrawer=!1,this.showDeleteModal=!1,this.showDetailDrawer=!1,this.isClosingDetailDrawer=!1,this.isoToDelete=null,this.selectedISO=null,this.isLoadingDetail=!1,this.isDeleting=!1,this.selectedFile=null,this.uploadMetadata={os_type:"linux",os_variant:"",description:"",pool_name:""},this.currentUpload=null,this.dragOver=!1,this.isPaused=!1,this.uploadUrl=null,this.uploadId=null,this.selectedPoolName=null,this.poolsLoading=!1,this.poolsError=null}async connectedCallback(){super.connectedCallback(),await this.loadData()}async loadData(){try{await Uy.fetch(),await By.fetch()}catch(e){console.error("Failed to load ISOs:",e),e instanceof uy||this.showNotification("Failed to load ISO images","error")}}getColumns(){return[{key:"name",label:"Name",type:"link"},{key:"size_formatted",label:"Size"},{key:"os_type",label:"OS Type"},{key:"os_variant",label:"OS Variant"},{key:"uploaded_at_formatted",label:"Uploaded"},{key:"storage_pool",label:"Storage Pool"}]}getActions(e){return[{label:"View Detail",action:"view-detail"},{label:"Download",action:"download"},{label:"Delete",action:"delete",danger:!0}]}formatFileSize(e){if(null==e||isNaN(e))return"Unknown";if(e<=0)return"0 B";const t=["B","KB","MB","GB","TB"];let s=e,i=0;for(;s>=1024&&i<t.length-1;)s/=1024,i++;return`${s.toFixed(1)} ${t[i]}`}formatDate(e){return new Date(e).toLocaleDateString()}getFilteredISOs(){const e=this.availableISOsController.value;if(!this.searchQuery)return e;const t=this.searchQuery.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(t)||e.os_type?.toLowerCase().includes(t)||e.os_variant?.toLowerCase().includes(t))}handleSearchChange(e){this.searchQuery=e.detail.value}handleAction(e){const{action:t,item:s}=e.detail,i=s;switch(t){case"view-detail":this.viewISODetail(i);break;case"download":this.downloadISO(i);break;case"delete":this.confirmDeleteISO(i)}}handleCellClick(e){const{item:t,column:s}=e.detail;"name"===s.key&&this.viewISODetail(t)}async downloadISO(e){try{const t=localStorage.getItem("jwt_token")||localStorage.getItem("auth_token");if(!t)return void this.showNotification("Authentication required","error");const s=await fetch(`/api/v1/virtualization/isos/${e.id}/download`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!s.ok)throw new Error(`Download failed: ${s.statusText}`);const i=await s.blob(),o=window.URL.createObjectURL(i),r=document.createElement("a");r.href=o,r.download=e.name,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(o),this.showNotification(`Downloading ${e.name}...`,"success")}catch(t){console.error("Failed to download ISO:",t),this.showNotification(`Failed to download ISO: ${t instanceof Error?t.message:"Unknown error"}`,"error")}}async viewISODetail(e){this.showDetailDrawer=!0,this.isLoadingDetail=!0,this.selectedISO=e;try{const t=await yy.getISO(e.id);this.selectedISO={...e,...t,os_variant:t.os_variant||t.os_version||e.os_variant,architecture:t.architecture||t.arch||e.architecture}}catch(t){console.error("Failed to fetch ISO details:",t),this.showNotification(`Failed to load ISO details: ${t instanceof Error?t.message:"Unknown error"}`,"error")}finally{this.isLoadingDetail=!1}}closeDetailDrawer(){this.isClosingDetailDrawer||(this.isClosingDetailDrawer=!0,setTimeout(()=>{this.showDetailDrawer=!1,this.isClosingDetailDrawer=!1,this.selectedISO=null,this.isLoadingDetail=!1},300))}confirmDeleteISO(e){this.isoToDelete=e,this.showDeleteModal=!0,this.requestUpdate()}async handleDelete(){if(this.isoToDelete){this.isDeleting=!0;try{await Aw.deleteISO(this.isoToDelete.id),this.showNotification(`ISO "${this.isoToDelete.name}" deleted successfully`,"success"),this.showDeleteModal=!1,this.isoToDelete=null}catch(e){console.error("Failed to delete ISO:",e),this.showNotification(`Failed to delete ISO: ${e instanceof Error?e.message:"Unknown error"}`,"error")}finally{this.isDeleting=!1}}}async openUploadDrawer(){this.showUploadDrawer=!0,this.selectedFile=null,this.selectedPoolName=null,this.poolsError=null,this.uploadMetadata={os_type:"linux",os_variant:"",description:"",pool_name:""},await this.loadPoolsForUpload()}async loadPoolsForUpload(){this.poolsLoading=!0,this.poolsError=null;try{await By.fetch();const e=this.getAvailablePools();e.find(e=>"default"===e.name)&&(this.selectedPoolName="default",this.uploadMetadata={...this.uploadMetadata,pool_name:"default"})}catch(e){console.error("Failed to load storage pools:",e),this.poolsError=e instanceof Error?e.message:"Failed to load storage pools"}finally{this.poolsLoading=!1}}getAvailablePools(){const e=this.storagePoolStoreController.value;if(!e)return[];let t;if(e instanceof Map)t=Array.from(e.values());else{if("object"!=typeof e)return[];t=Object.values(e)}return t.filter(e=>"running"===e.state||"active"===e.state)}handlePoolChange(e){this.selectedPoolName=e||null,this.uploadMetadata={...this.uploadMetadata,pool_name:e}}closeUploadDrawer(){this.isClosingUploadDrawer||(this.isClosingUploadDrawer=!0,setTimeout(()=>{this.currentUpload&&(this.currentUpload.abort(),this.currentUpload=null,Zy.set({isUploading:!1,uploadProgress:0,uploadId:null,error:null})),this.showUploadDrawer=!1,this.isClosingUploadDrawer=!1,this.selectedFile=null,this.uploadMetadata={os_type:"linux",os_variant:"",description:"",pool_name:""},this.selectedPoolName=null,this.poolsError=null},300))}handleDragOver(e){e.preventDefault(),this.dragOver=!0}handleDragLeave(e){e.preventDefault(),this.dragOver=!1}handleDrop(e){e.preventDefault(),this.dragOver=!1;const t=e.dataTransfer?.files;if(t&&t.length>0){const e=t[0];e&&this.validateFile(e)&&(this.selectedFile=e)}}handleFileSelect(e){const t=e.target.files;if(t&&t.length>0){const e=t[0];e&&this.validateFile(e)&&(this.selectedFile=e)}}validateFile(e){if(!e.name.toLowerCase().endsWith(".iso"))return this.showNotification("Please select an ISO file","error"),!1;return!(e.size>10737418240)||(this.showNotification("File size exceeds 10GB limit","error"),!1)}removeSelectedFile(){this.selectedFile=null}async handleUpload(){if(this.selectedFile)try{if(!this.uploadUrl||!this.uploadId){const{uploadUrl:e,uploadId:t}=await yy.initiateISOUpload({filename:this.selectedFile.name,size:this.selectedFile.size,os_type:this.uploadMetadata.os_type,os_variant:this.uploadMetadata.os_variant,description:this.uploadMetadata.description,pool_name:this.uploadMetadata.pool_name||void 0});this.uploadUrl=e,this.uploadId=t}Zy.set({isUploading:!0,uploadProgress:this.isPaused?Zy.get().uploadProgress:0,uploadId:this.uploadId,error:null}),this.isPaused=!1,this.currentUpload=new Nu(this.selectedFile,{uploadUrl:this.uploadUrl,chunkSize:10485760,metadata:{filename:this.selectedFile.name,filetype:this.selectedFile.type||"application/octet-stream",os_type:this.uploadMetadata.os_type||"",os_variant:this.uploadMetadata.os_variant||"",description:this.uploadMetadata.description||"",pool_name:this.uploadMetadata.pool_name||""},headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")||localStorage.getItem("auth_token")}`,"Tus-Resumable":"1.0.0"},uploadDataDuringCreation:!0,removeFingerprintOnSuccess:!0,retryDelays:[0,1e3,3e3,5e3],onError:e=>{console.error("Upload failed:",e),this.showNotification(`Upload failed: ${e.message}`,"error"),this.currentUpload=null,Zy.set({isUploading:!1,uploadProgress:0,uploadId:null,error:e.message})},onProgress:(e,t)=>{const s=Math.round(e/t*100);Zy.set({...Zy.get(),uploadProgress:s})},onSuccess:async()=>{try{await yy.completeISOUpload(this.uploadId),Zy.set({isUploading:!1,uploadProgress:0,uploadId:null,error:null}),await Uy.fetch(),this.showNotification("ISO uploaded successfully","success"),this.closeUploadDrawer()}catch(e){console.error("Failed to complete upload:",e),this.showNotification("Failed to complete upload","error"),Zy.set({isUploading:!1,uploadProgress:0,uploadId:null,error:e instanceof Error?e.message:"Unknown error"})}}}),this.currentUpload.start()}catch(e){console.error("Failed to initiate upload:",e),this.showNotification(`Failed to initiate upload: ${e instanceof Error?e.message:"Unknown error"}`,"error")}else this.showNotification("Please select a file to upload","error")}pauseUpload(){this.currentUpload&&(this.currentUpload.abort(),this.isPaused=!0,Zy.set({...Zy.get(),isUploading:!1}),this.showNotification("Upload paused - click Resume to continue","info"))}resumeUpload(){this.isPaused&&this.selectedFile&&this.uploadUrl&&(this.isPaused=!1,this.handleUpload(),this.showNotification("Upload resumed","info"))}cancelUpload(){this.currentUpload&&(this.currentUpload.abort(),this.currentUpload=null),Zy.set({isUploading:!1,uploadProgress:0,uploadId:null,error:null}),this.selectedFile=null,this.isPaused=!1,this.uploadUrl=null,this.uploadId=null,this.closeUploadDrawer()}showNotification(e,t="info"){this.dispatchEvent(new CustomEvent("show-notification",{detail:{message:e,type:t},bubbles:!0,composed:!0}))}renderDetailDrawer(){return this.selectedISO?J`
      <div class="drawer ${this.isClosingDetailDrawer?"closing":""}">
        <div class="drawer-header">
          <h2 class="drawer-title">ISO Image Details</h2>
          <button class="close-btn" @click=${this.closeDetailDrawer}>â</button>
        </div>
        
        <div class="drawer-content">
          ${this.isLoadingDetail?J`
            <loading-state message="Loading ISO details..."></loading-state>
          `:J`
            <div class="detail-section">
              <h3>General Information</h3>
              <div class="detail-grid">
                <div class="detail-label">Name:</div>
                <div class="detail-value">${this.selectedISO.name}</div>
                
                <div class="detail-label">Size:</div>
                <div class="detail-value">${this.formatFileSize(this.selectedISO.size)}</div>
                
                <div class="detail-label">OS Type:</div>
                <div class="detail-value">${this.selectedISO.os_type||"Unknown"}</div>
                
                <div class="detail-label">OS Variant:</div>
                <div class="detail-value">${this.selectedISO.os_variant||"Not specified"}</div>
                
                <div class="detail-label">Architecture:</div>
                <div class="detail-value">${this.selectedISO.architecture||"Not specified"}</div>
                
                <div class="detail-label">Storage Pool:</div>
                <div class="detail-value">${this.selectedISO.storage_pool||"default"}</div>
                
                <div class="detail-label">Uploaded:</div>
                <div class="detail-value">${this.formatDate(this.selectedISO.uploaded_at)}</div>
              </div>
            </div>
            
            <div class="detail-section">
              <h3>File Information</h3>
              <div class="detail-grid">
                <div class="detail-label">File Path:</div>
                <div class="detail-value monospace">${this.selectedISO.path}</div>
                
                ${this.selectedISO.checksum?J`
                  <div class="detail-label">Checksum:</div>
                  <div class="detail-value monospace">${this.selectedISO.checksum}</div>
                `:""}
                
                <div class="detail-label">ID:</div>
                <div class="detail-value monospace">${this.selectedISO.id}</div>
              </div>
            </div>
            
            ${this.selectedISO.description?J`
              <div class="detail-section">
                <h3>Description</h3>
                <div class="detail-value">${this.selectedISO.description}</div>
              </div>
            `:""}
          `}
        </div>
        
        <div class="drawer-footer">
          <button 
            class="btn btn-secondary" 
            @click=${()=>this.downloadISO(this.selectedISO)}
            ?disabled=${this.isLoadingDetail}
          >
            Download ISO
          </button>
          <button class="btn btn-primary" @click=${this.closeDetailDrawer}>
            Close
          </button>
        </div>
      </div>
    `:""}renderUploadDrawer(){const e=this._uploadStateController.value,t=e.isUploading||this.isPaused;return J`
      <div class="drawer ${this.isClosingUploadDrawer?"closing":""}">
        <div class="drawer-header">
          <h2 class="drawer-title">Upload ISO Image</h2>
          <button class="close-btn" @click=${this.closeUploadDrawer}>â</button>
        </div>
        
        <div class="drawer-content">
            ${this.selectedFile?J`
              <div class="file-info">
                <div class="file-details">
                  <div class="file-name">${this.selectedFile.name}</div>
                  <div class="file-size">${this.formatFileSize(this.selectedFile.size)}</div>
                </div>
                ${t?"":J`
                  <button class="btn-remove-file" @click=${this.removeSelectedFile}>
                    Remove
                  </button>
                `}
              </div>
            `:J`
              <div 
                class="drop-zone ${this.dragOver?"drag-over":""}"
                @dragover=${this.handleDragOver}
                @dragleave=${this.handleDragLeave}
                @drop=${this.handleDrop}
                @click=${()=>this.shadowRoot?.getElementById("file-input")?.click()}
              >
                <div class="drop-zone-icon">ð</div>
                <div class="drop-zone-text">
                  Drag and drop an ISO file here
                </div>
                <div class="drop-zone-hint">
                  or click to browse
                </div>
              </div>
              
              <input
                type="file"
                id="file-input"
                accept=".iso"
                style="display: none"
                @change=${this.handleFileSelect}
              />
            `}
            
            <div class="form-group">
              <label>Storage Pool (Optional)</label>
              ${this.poolsLoading?J`
                <select disabled>
                  <option>Loading pools...</option>
                </select>
              `:this.poolsError?J`
                <div style="display: flex; flex-direction: column; gap: 8px;">
                  <select disabled>
                    <option>Failed to load pools</option>
                  </select>
                  <div class="help-text" style="color: var(--vscode-inputValidation-warningForeground);">
                    ${this.poolsError}. Upload will use the default pool.
                  </div>
                  <button 
                    type="button" 
                    class="btn btn-secondary" 
                    style="align-self: flex-start; padding: 4px 8px; font-size: 12px;"
                    @click=${()=>this.loadPoolsForUpload()}
                  >
                    Retry
                  </button>
                </div>
              `:J`
                <select
                  .value=${this.selectedPoolName||""}
                  @change=${e=>this.handlePoolChange(e.target.value)}
                  ?disabled=${t}
                >
                  <option value="">-- Use default pool --</option>
                  ${this.getAvailablePools().map(e=>J`
                    <option value="${e.name}" ?selected=${this.selectedPoolName===e.name}>
                      ${e.name} (${e.type})
                    </option>
                  `)}
                </select>
                <div class="help-text">
                  Select a storage pool to store this ISO. If not selected, the default pool will be used.
                </div>
              `}
            </div>
            
            <div class="form-group">
              <label>OS Type</label>
              <select
                .value=${this.uploadMetadata.os_type}
                @change=${e=>this.uploadMetadata.os_type=e.target.value}
                ?disabled=${t}
              >
                <option value="linux">Linux</option>
                <option value="windows">Windows</option>
                <option value="freebsd">FreeBSD</option>
                <option value="other">Other</option>
              </select>
            </div>
            
            <div class="form-group">
              <label>OS Variant (Optional)</label>
              <os-variant-autocomplete
                .value=${this.uploadMetadata.os_variant}
                .family=${this.uploadMetadata.os_type}
                placeholder="e.g. ubuntu22.04"
                ?disabled=${t}
                @os-variant-change=${e=>this.uploadMetadata.os_variant=e.detail.value}
              ></os-variant-autocomplete>
              <div class="help-text">
                Specify the exact OS version or distribution
              </div>
            </div>
            
            <div class="form-group">
              <label>Description (Optional)</label>
              <textarea
                rows="3"
                placeholder="Additional notes about this ISO"
                .value=${this.uploadMetadata.description}
                @input=${e=>this.uploadMetadata.description=e.target.value}
                ?disabled=${t}
              ></textarea>
            </div>
            
            ${e.isUploading||this.isPaused?J`
              <div class="upload-progress">
                <div class="progress-info">
                  <span>${this.isPaused?"Upload Paused":"Uploading..."}</span>
                  <span>${e.uploadProgress}%</span>
                </div>
                <div class="progress-bar-container">
                  <div 
                    class="progress-bar" 
                    style="width: ${e.uploadProgress}%"
                  ></div>
                </div>
                <div class="upload-actions">
                  ${this.isPaused?J`
                    <button class="btn-primary" @click=${this.resumeUpload}>
                      Resume
                    </button>
                  `:J`
                    <button class="btn-secondary" @click=${this.pauseUpload}>
                      Pause
                    </button>
                  `}
                  <button class="btn-danger" @click=${this.cancelUpload}>
                    Cancel
                  </button>
                </div>
              </div>
            `:""}
        </div>
        
        <div class="drawer-footer">
          <button class="btn btn-secondary" @click=${this.closeUploadDrawer}>
            Cancel
          </button>
          ${t?"":J`
            <button 
              class="btn btn-primary" 
              @click=${this.handleUpload}
              ?disabled=${!this.selectedFile}
            >
              Start Upload
            </button>
          `}
        </div>
      </div>
    `}renderVirtualizationDisabledBanner(e){return J`
      <div class="virtualization-disabled-banner">
        <h2>Virtualization is disabled on this host</h2>
        <p>Virtualization features are currently unavailable because libvirt is not installed or not running.\
 ISO image management is disabled until virtualization support is available on this host.</p>
        ${e?J`<p>${e}</p>`:""}
      </div>
    `}render(){if(!1===this.virtualizationEnabledController.value){const e=this.virtualizationDisabledMessageController.value;return J`
        <div class="container">
          ${this.renderVirtualizationDisabledBanner(e)}
        </div>
      `}const e=this.isoStoreController.value,t=this.getFilteredISOs(),s=t.reduce((e,t)=>{const s=t.size||0;return e+(isNaN(s)?0:s)},0),i=t.map(e=>({...e,size_formatted:this.formatFileSize(e.size),uploaded_at_formatted:this.formatDate(e.uploaded_at),storage_pool:e.storage_pool||"default"}));return J`
      <div class="container">
        
        <!-- Stats Bar -->
        <div class="stats-bar">
          <div class="stat-item">
            <span class="stat-label">Total ISOs:</span>
            <span class="stat-value">${t.length}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Total Size:</span>
            <span class="stat-value">${this.formatFileSize(s)}</span>
          </div>
        </div>
        
        <!-- Controls -->
        <div class="controls">
          <div class="filters-section">
            <search-input
              .placeholder=${"Search ISO images..."}
              .value=${this.searchQuery}
              @search-change=${this.handleSearchChange}
            ></search-input>
          </div>
          <button class="btn btn-primary" @click=${this.openUploadDrawer}>
            Upload ISO
          </button>
        </div>
        
        <!-- Content -->
        <div class="content">
          ${e.loading?J`
            <loading-state message="Loading ISO images..."></loading-state>
          `:e.error?J`
            <empty-state
              icon="â"
              title="Error loading ISO images"
              description=${e.error.message}
            ></empty-state>
          `:0===t.length?J`
            <empty-state
              icon="ð"
              title="No ISO images found"
              description=${this.searchQuery?"No ISOs match your search criteria":"Upload your first ISO image to get started"}
            ></empty-state>
          `:J`
            <resource-table
              .columns=${this.getColumns()}
              .data=${i}
              .getActions=${e=>this.getActions(e)}
              @action=${this.handleAction}
              @cell-click=${this.handleCellClick}
            ></resource-table>
          `}
        </div>
        
        <!-- Upload Drawer -->
        ${this.showUploadDrawer||this.isClosingUploadDrawer?this.renderUploadDrawer():""}
        
        <!-- Detail Drawer -->
        ${this.showDetailDrawer||this.isClosingDetailDrawer?this.renderDetailDrawer():""}
        
        <!-- Delete Confirmation Modal -->
        ${this.showDeleteModal&&this.isoToDelete?J`
          <delete-modal
            .show=${!0}
            .item=${{name:this.isoToDelete.name,type:"ISO Image"}}
            .loading=${this.isDeleting}
            @confirm-delete=${this.handleDelete}
            @cancel-delete=${()=>{this.showDeleteModal=!1,this.isoToDelete=null,this.requestUpdate()}}
          ></delete-modal>
        `:""}
        
        <!-- Notification Container -->
        <notification-container></notification-container>
      </div>
    `}};Ex.styles=g`
    :host {
      display: block;
      height: 100%;
      box-sizing: border-box;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 1rem;
    }



    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      gap: 1rem;
    }

    .filters-section {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }

    search-input {
      flex: 1;
      max-width: 400px;
    }

    .content {
      flex: 1;
      overflow-y: auto;
    }

    /* Button styles are defined below in the general button section */

    /* Drawer Styles */
    .drawer {
      position: fixed;
      top: 0;
      right: 0;
      width: 50%;
      height: 100%;
      background: var(--vscode-editor-background, #1e1e1e);
      border-left: 1px solid var(--vscode-border);
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      z-index: 1001;
      overflow-y: auto;
      animation: slideIn 0.3s ease-out;
    }

    @media (max-width: 1024px) {
      .drawer {
        width: 80%;
      }
    }

    @media (max-width: 768px) {
      .drawer {
        width: 100%;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
      }
      to {
        transform: translateX(0);
      }
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
      }
      to {
        transform: translateX(100%);
      }
    }

    .drawer.closing {
      animation: slideOut 0.3s ease-in forwards;
    }

    .drawer-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--vscode-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--vscode-bg-lighter, #252526);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .drawer-title {
      font-size: 18px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
      margin: 0;
    }

    .drawer-content {
      padding: 24px;
      overflow-y: auto;
    }

    .drawer-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--vscode-border);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      background: var(--vscode-bg-lighter, #252526);
      position: sticky;
      bottom: 0;
      z-index: 10;
    }

    .close-btn {
      background: transparent;
      border: none;
      color: var(--vscode-foreground, #cccccc);
      cursor: pointer;
      padding: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      font-size: 20px;
      line-height: 1;
      transition: all 0.2s;
    }

    .close-btn:hover {
      background: var(--vscode-toolbar-hoverBackground, rgba(90, 93, 94, 0.31));
      color: var(--vscode-icon-foreground, #c5c5c5);
    }

    /* Drag and Drop Area */
    .drop-zone {
      border: 2px dashed var(--vscode-input-border, #5a5a5a);
      border-radius: 8px;
      padding: 40px;
      text-align: center;
      transition: all 0.3s;
      cursor: pointer;
      margin-bottom: 20px;
      background: var(--vscode-editor-inactiveSelectionBackground, rgba(37, 37, 38, 0.5));
    }

    .drop-zone:hover {
      border-color: var(--vscode-focusBorder, #007acc);
      background: var(--vscode-list-hoverBackground, rgba(90, 93, 94, 0.1));
    }

    .drop-zone.drag-over {
      border-color: var(--vscode-focusBorder, #007acc);
      background: var(--vscode-editor-selectionBackground, rgba(51, 153, 255, 0.2));
      border-style: solid;
    }

    .drop-zone-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.8;
    }

    .drop-zone-text {
      font-size: 16px;
      color: var(--vscode-foreground, #cccccc);
      margin-bottom: 8px;
      font-weight: 500;
    }

    .drop-zone-hint {
      font-size: 13px;
      color: var(--vscode-descriptionForeground, #8b8b8b);
    }

    .file-info {
      padding: 16px;
      background: var(--vscode-editor-inactiveSelectionBackground);
      border: 1px solid var(--vscode-editorWidget-border);
      border-radius: 4px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .file-details {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .file-name {
      font-weight: 500;
      color: var(--vscode-foreground);
    }

    .file-size {
      font-size: 12px;
      color: var(--vscode-descriptionForeground);
    }

    .btn-remove-file {
      padding: 4px 8px;
      background: var(--vscode-button-secondaryBackground);
      color: var(--vscode-button-secondaryForeground);
      border: 1px solid var(--vscode-button-border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }

    /* Form Styles */
    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 13px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 8px 12px;
      background: var(--vscode-input-background, #3c3c3c);
      color: var(--vscode-input-foreground, #cccccc);
      border: 1px solid var(--vscode-input-border, #5a5a5a);
      border-radius: 4px;
      font-size: 13px;
      font-family: inherit;
      transition: all 0.2s;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--vscode-focusBorder, #007acc);
      box-shadow: 0 0 0 1px var(--vscode-focusBorder, #007acc);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 60px;
    }

    .help-text {
      display: block;
      margin-top: 4px;
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #8b8b8b);
    }

    /* Upload Progress */
    .upload-progress {
      margin-top: 20px;
    }

    .progress-bar-container {
      width: 100%;
      height: 8px;
      background: var(--vscode-progressBar-background, #1e1e1e);
      border-radius: 4px;
      overflow: hidden;
      margin: 12px 0;
      border: 1px solid var(--vscode-input-border, #5a5a5a);
    }

    .progress-bar {
      height: 100%;
      background: var(--vscode-progressBar-foreground, #0e639c);
      background: linear-gradient(90deg, 
        var(--vscode-progressBar-foreground, #0e639c) 0%, 
        var(--vscode-button-hoverBackground, #1177bb) 100%);
      transition: width 0.3s ease;
      box-shadow: 0 0 10px rgba(14, 99, 156, 0.5);
    }

    .progress-info {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--vscode-descriptionForeground);
    }

    .upload-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    /* Buttons */
    button {
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
      font-family: inherit;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
      font-family: inherit;
    }

    .btn-primary {
      background: var(--vscode-button-background, #0e639c);
      color: var(--vscode-button-foreground, #ffffff);
      border: 1px solid var(--vscode-button-background, #0e639c);
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--vscode-button-hoverBackground, #1177bb);
      border-color: var(--vscode-button-hoverBackground, #1177bb);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border: 1px solid var(--vscode-button-border, #5a5a5a);
    }

    .btn-secondary:hover:not(:disabled) {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
      border-color: var(--vscode-button-border, #5a5a5a);
    }

    .btn-secondary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-danger {
      background: var(--vscode-inputValidation-errorBackground, #5a1d1d);
      color: var(--vscode-inputValidation-errorForeground, #f48771);
      border: 1px solid var(--vscode-inputValidation-errorBorder, #be1100);
    }

    .btn-danger:hover:not(:disabled) {
      background: var(--vscode-inputValidation-errorBackground, #5a1d1d);
      opacity: 0.9;
    }

    .btn-danger:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .virtualization-disabled-banner {
      margin-top: 16px;
      padding: 16px 20px;
      border-radius: 8px;
      border: 1px solid var(--vscode-inputValidation-warningBorder, #e2c08d);
      background: var(--vscode-inputValidation-warningBackground, rgba(229, 200, 144, 0.15));
      color: var(--vscode-inputValidation-warningForeground, #e2c08d);
    }

    .virtualization-disabled-banner h2 {
      margin: 0 0 8px 0;
      font-size: 16px;
      font-weight: 500;
    }

    .virtualization-disabled-banner p {
      margin: 0 0 4px 0;
      font-size: 13px;
      color: var(--vscode-descriptionForeground);
    }

    /* Stats Bar */
    .stats-bar {
      display: flex;
      gap: 2rem;
      padding: 12px 16px;
      background: var(--vscode-editor-background);
      border: 1px solid var(--vscode-editorWidget-border);
      border-radius: 4px;
      font-size: 13px;
      margin-bottom: 1rem;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stat-label {
      color: var(--vscode-descriptionForeground);
    }

    .stat-value {
      font-weight: 600;
      color: var(--vscode-foreground);
    }

    /* Detail Drawer Styles */
    .detail-section {
      margin-bottom: 24px;
    }

    .detail-section h3 {
      font-size: 14px;
      font-weight: 600;
      color: var(--vscode-foreground);
      margin: 0 0 12px 0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .detail-grid {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 12px;
    }

    .detail-label {
      font-size: 13px;
      color: var(--vscode-descriptionForeground);
      font-weight: 500;
    }

    .detail-value {
      font-size: 13px;
      color: var(--vscode-foreground);
      word-break: break-word;
    }

    .detail-value.monospace {
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 12px;
    }
  `,Dx([xe()],Ex.prototype,"searchQuery",2),Dx([xe()],Ex.prototype,"showUploadDrawer",2),Dx([xe()],Ex.prototype,"isClosingUploadDrawer",2),Dx([xe()],Ex.prototype,"showDeleteModal",2),Dx([xe()],Ex.prototype,"showDetailDrawer",2),Dx([xe()],Ex.prototype,"isClosingDetailDrawer",2),Dx([xe()],Ex.prototype,"isoToDelete",2),Dx([xe()],Ex.prototype,"selectedISO",2),Dx([xe()],Ex.prototype,"isLoadingDetail",2),Dx([xe()],Ex.prototype,"isDeleting",2),Dx([xe()],Ex.prototype,"selectedFile",2),Dx([xe()],Ex.prototype,"uploadMetadata",2),Dx([xe()],Ex.prototype,"currentUpload",2),Dx([xe()],Ex.prototype,"dragOver",2),Dx([xe()],Ex.prototype,"isPaused",2),Dx([xe()],Ex.prototype,"uploadUrl",2),Dx([xe()],Ex.prototype,"uploadId",2),Dx([xe()],Ex.prototype,"selectedPoolName",2),Dx([xe()],Ex.prototype,"poolsLoading",2),Dx([xe()],Ex.prototype,"poolsError",2),Ex=Dx([ve("iso-management")],Ex);var Mx=Object.defineProperty,Ax=Object.getOwnPropertyDescriptor,Ix=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Ax(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Mx(t,s,r),r};let Tx=class extends me{constructor(){super(...arguments),this.show=!1,this.mode="create",this.formData={name:"",capacity:10,capacityUnit:"GB",allocation:0,allocationUnit:"GB",format:"qcow2"},this.isSubmitting=!1,this.errors=/* @__PURE__ */new Map,this.handleEscape=e=>{"Escape"===e.key&&this.show&&!this.isSubmitting&&this.handleClose()}}connectedCallback(){super.connectedCallback(),window.addEventListener("keydown",this.handleEscape),this.initializeFormFromProps()}disconnectedCallback(){window.removeEventListener("keydown",this.handleEscape),super.disconnectedCallback()}willUpdate(e){(e.has("volume")||e.has("mode")||e.has("pool"))&&this.initializeFormFromProps(),e.has("show")&&(this.show?setTimeout(()=>{const e=this.shadowRoot?.querySelector("#volume-name");e&&e.focus()},100):this.errors.clear())}initializeFormFromProps(){if(this.pool){if("resize"===this.mode&&this.volume)return this.formData={name:this.volume.name,capacity:this.convertBytesToUnit(this.volume.capacity,"GB"),capacityUnit:"GB",allocation:this.convertBytesToUnit(this.volume.allocation||0,"GB"),allocationUnit:"GB",format:this.volume.format||"qcow2"},this.errors.clear(),void this.requestUpdate();this.formData={name:"",capacity:10,capacityUnit:"GB",allocation:0,allocationUnit:"GB",format:"qcow2"},this.errors.clear()}}convertBytesToUnit(e,t){const s="TB"===t?1099511627776:1073741824;return Math.round(e/s*100)/100}convertToBytes(e,t){const s="TB"===t?1099511627776:1073741824;return Math.round(e*s)}formatSize(e){const t=e/1073741824;return t>=1024?`${(t/1024).toFixed(2)} TB`:`${t.toFixed(2)} GB`}validateForm(){this.errors.clear(),"create"===this.mode&&(this.formData.name?/^[a-zA-Z0-9-_]+$/.test(this.formData.name)||this.errors.set("name","Volume name can only contain letters, numbers, hyphens, and underscores"):this.errors.set("name","Volume name is required")),this.formData.capacity<=0&&this.errors.set("capacity","Capacity must be greater than 0"),this.formData.allocation<0&&this.errors.set("allocation","Allocation cannot be negative");const e=this.convertToBytes(this.formData.capacity,this.formData.capacityUnit),t=this.convertToBytes(this.formData.allocation,this.formData.allocationUnit),s=this.volume?.capacity||0;if(t>e&&this.errors.set("allocation","Allocation cannot exceed capacity"),"create"===this.mode)e>this.pool.available&&this.errors.set("capacity",`Capacity exceeds available space (${this.formatSize(this.pool.available)})`);else if("resize"===this.mode){e<=s&&this.errors.set("capacity","New capacity must be greater than current capacity");const t=s+(this.pool.available||0);e>t&&this.errors.set("capacity",`Capacity exceeds available space (${this.formatSize(t)})`)}return this.requestUpdate(),0===this.errors.size}async handleSubmit(){if(this.validateForm()&&this.pool){this.isSubmitting=!0;try{const e=this.convertToBytes(this.formData.capacity,this.formData.capacityUnit),t=this.convertToBytes(this.formData.allocation,this.formData.allocationUnit);if("resize"===this.mode&&this.volume){const t=await yy.resizeVolume(this.pool.name,this.volume.name,e);this.dispatchEvent(new CustomEvent("volume-resized",{detail:{pool:this.pool,volume:t},bubbles:!0,composed:!0}))}else{const s={name:this.formData.name,capacity:e};t>0&&(s.allocation=t),this.formData.format&&(s.format=this.formData.format);const i=await yy.createVolume(this.pool.name,s);this.dispatchEvent(new CustomEvent("volume-created",{detail:{pool:this.pool,volume:i},bubbles:!0,composed:!0}))}this.handleClose()}catch(e){let t="Unknown error";if(e instanceof fy)switch(e.code){case"VOLUME_ALREADY_EXISTS":t="A volume with this name already exists in the pool.";break;case"INVALID_VOLUME_REQUEST":t="string"==typeof e.details?e.details:e.message;break;default:t=e.message}else e instanceof Error&&(t=e.message);const s="resize"===this.mode?"Failed to resize volume":"Failed to create volume";wx.addNotification({type:"error",title:s,message:t})}finally{this.isSubmitting=!1}}}handleClose(){this.dispatchEvent(new CustomEvent("close",{bubbles:!0,composed:!0}))}handleInputChange(e,t){this.formData={...this.formData,[e]:t},this.errors.has(e)&&(this.errors.delete(e),this.requestUpdate())}renderFormatOptions(e){return J`
      <div class="format-options">
        ${[{value:"qcow2",name:"QCOW2",description:"QEMU copy-on-write, supports snapshots"},{value:"raw",name:"Raw",description:"Raw disk image, best performance"},{value:"vmdk",name:"VMDK",description:"VMware disk format"},{value:"qed",name:"QED",description:"QEMU enhanced disk format"},{value:"vdi",name:"VDI",description:"VirtualBox disk format"}].map(t=>{const s=["format-option",this.formData.format===t.value?"selected":"",e?"disabled":""].filter(Boolean).join(" ");return J`
            <div 
              class="${s}"
              @click=${()=>{e||this.handleInputChange("format",t.value)}}
            >
              <div class="format-name">${t.name}</div>
              <div class="format-description">${t.description}</div>
            </div>
          `})}
      </div>
    `}render(){const e="resize"===this.mode,t=e?"Resize Volume":"Create Volume",s=this.pool?.name??"",i=this.pool?.type??"",o=this.pool?this.formatSize(this.pool.available):"",r=e||this.isSubmitting||!this.pool,a=this.isSubmitting||!this.pool,n=e||this.isSubmitting||!this.pool,l=e&&this.volume?this.formatSize(this.volume.capacity):"",c=e&&this.volume&&this.pool?this.formatSize(this.volume.capacity+(this.pool.available||0)):"";return J`
      <div class="drawer">
        <div class="drawer-header">
          <h2 class="header-title drawer-title">${t}</h2>
          <button class="close-button close-btn" @click=${this.handleClose} ?disabled=${this.isSubmitting}>Ã</button>
        </div>

        <div class="drawer-content">
          <div class="form-container">
            <div class="pool-info">
              <div class="info-item">
                <div class="info-label">Pool</div>
                <div class="info-value">${s}</div>
              </div>
              <div class="info-item">
                <div class="info-label">Type</div>
                <div class="info-value">${i}</div>
              </div>
              <div class="info-item">
                <div class="info-label">Available</div>
                <div class="info-value">${o}</div>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label ${e?"":"required"}">Volume Name</label>
              <input
                id="volume-name"
                type="text"
                class="form-input ${this.errors.has("name")?"error":""}"
                placeholder="my-volume"
                .value=${this.formData.name}
                @input=${e=>{this.handleInputChange("name",e.target.value)}}
                ?disabled=${r}
              />
              ${this.errors.has("name")?J`
                <div class="form-error">${this.errors.get("name")}</div>
              `:J`
                <div class="form-hint">
                  Only letters, numbers, hyphens, and underscores allowed
                </div>
              `}
            </div>

            <div class="form-group">
              <label class="form-label required">Capacity</label>
              <div class="input-group">
                <input
                  type="number"
                  class="form-input ${this.errors.has("capacity")?"error":""}"
                  min="1"
                  step="1"
                  .value=${this.formData.capacity}
                  @input=${e=>{this.handleInputChange("capacity",Number(e.target.value))}}
                  ?disabled=${a}
                />
                <select
                  class="form-select unit-select"
                  .value=${this.formData.capacityUnit}
                  @change=${e=>{this.handleInputChange("capacityUnit",e.target.value)}}
                  ?disabled=${a}
                >
                  <option value="GB">GB</option>
                  <option value="TB">TB</option>
                </select>
              </div>
              ${this.errors.has("capacity")?J`
                <div class="form-error">${this.errors.get("capacity")}</div>
              `:e&&l?J`
                <div class="form-hint">
                  Current capacity: ${l}. New capacity must be greater than current and within available space${c?` (max ${c})`:""}.
                </div>
              `:J`
                <div class="form-hint">
                  Maximum size of the volume
                </div>
              `}
            </div>

            <div class="form-group">
              <label class="form-label">Initial Allocation</label>
              <div class="input-group">
                <input
                  type="number"
                  class="form-input ${this.errors.has("allocation")?"error":""}"
                  min="0"
                  step="1"
                  .value=${this.formData.allocation}
                  @input=${e=>{this.handleInputChange("allocation",Number(e.target.value))}}
                  ?disabled=${n}
                />
                <select
                  class="form-select unit-select"
                  .value=${this.formData.allocationUnit}
                  @change=${e=>{this.handleInputChange("allocationUnit",e.target.value)}}
                  ?disabled=${n}
                >
                  <option value="GB">GB</option>
                  <option value="TB">TB</option>
                </select>
              </div>
              ${this.errors.has("allocation")?J`
                <div class="form-error">${this.errors.get("allocation")}</div>
              `:J`
                <div class="form-hint">
                  Initial disk space to allocate (0 for thin provisioning)
                </div>
              `}
            </div>

            <div class="form-group">
              <label class="form-label">Format</label>
              ${this.renderFormatOptions(e)}
            </div>
          </div>
        </div>

        <div class="drawer-footer">
          <button 
            class="btn btn-secondary"
            @click=${this.handleClose}
            ?disabled=${this.isSubmitting}
          >
            Cancel
          </button>
          <button 
            class="btn btn-primary"
            @click=${this.handleSubmit}
            ?disabled=${this.isSubmitting}
          >
            ${this.isSubmitting?"resize"===this.mode?"Resizing...":"Creating...":"resize"===this.mode?"Resize":"Create Volume"}
          </button>
        </div>
      </div>
    `}};Tx.styles=g`
    :host {
      display: block;
      position: fixed;
      top: 0;
      right: 0;
      width: 700px;
      height: 100vh;
      z-index: 1000;
      pointer-events: none;
    }

    :host([show]) {
      pointer-events: auto;
    }

    .drawer {
      width: 100%;
      height: 100%;
      background: var(--vscode-editor-background);
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      border-left: 1px solid var(--vscode-border);
    }

    :host([show]) .drawer {
      transform: translateX(0);
    }

    .drawer-header {
      padding: 20px;
      background: var(--vscode-bg-lighter, #2d2d30);
      border-bottom: 1px solid var(--vscode-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .header-title {
      font-size: 18px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
    }

    /* Alias for consistency with other drawers */
    .drawer-title {
      font-size: 18px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
    }

    .close-button,
    .close-btn {
      background: none;
      border: none;
      color: var(--vscode-foreground, #cccccc);
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 20px;
      transition: background 0.2s;
    }

    .close-button:hover,
    .close-btn:hover {
      background: var(--vscode-toolbar-hoverBackground, rgba(255, 255, 255, 0.1));
    }

    .drawer-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .drawer-footer {
      padding: 16px 20px;
      background: var(--vscode-bg-lighter, #2d2d30);
      border-top: 1px solid var(--vscode-border);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      flex-shrink: 0;
    }

    .form-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      min-width: 0;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 6px;
      font-size: 13px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
    }

    .form-label.required::after {
      content: ' *';
      color: var(--vscode-inputValidation-errorForeground, #f48771);
    }

    .form-input,
    .form-select {
      width: 100%;
      padding: 8px 12px;
      background: var(--vscode-input-background, #3c3c3c);
      border: 1px solid var(--vscode-input-border, #5a5a5a);
      border-radius: 4px;
      color: var(--vscode-input-foreground, #cccccc);
      font-size: 13px;
      font-family: inherit;
      outline: none;
      box-sizing: border-box;
      transition: all 0.2s;
    }

    .form-input:focus,
    .form-select:focus {
      border-color: var(--vscode-focusBorder, #007acc);
      box-shadow: 0 0 0 1px var(--vscode-focusBorder, #007acc);
    }

    .form-input.error,
    .form-select.error {
      border-color: var(--vscode-inputValidation-errorBorder, #f48771);
    }

    .form-input:disabled,
    .form-select:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .input-group {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .input-group .form-input {
      flex: 1;
    }

    .unit-select {
      width: 80px;
    }

    .form-hint {
      display: block;
      margin-top: 4px;
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #999999);
    }

    .error-message {
      display: block;
      margin-top: 4px;
      font-size: 12px;
      color: var(--vscode-inputValidation-errorForeground, #f48771);
    }

    .form-error {
      display: block;
      margin-top: 4px;
      font-size: 12px;
      color: var(--vscode-inputValidation-errorForeground, #f48771);
    }

    .pool-info {
      padding: 12px;
      background: var(--vscode-editor-background);
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }

    .info-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .info-label {
      font-size: 11px;
      color: var(--vscode-descriptionForeground);
      text-transform: uppercase;
      font-weight: 600;
    }

    .info-value {
      font-size: 13px;
      color: var(--vscode-foreground);
      font-weight: 500;
    }

    .format-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }

    .format-option {
      padding: 12px;
      background: var(--vscode-editor-background);
      border: 2px solid var(--vscode-border);
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .format-option:hover {
      border-color: var(--vscode-focusBorder, #007acc);
    }

    .format-option.selected {
      border-color: var(--vscode-textLink-foreground, #3794ff);
      background: var(--vscode-list-activeSelectionBackground, #094771);
      box-shadow: 0 0 0 1px var(--vscode-focusBorder, #007acc);
    }

    .format-option.disabled {
      cursor: default;
      opacity: 0.7;
    }

    .format-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--vscode-foreground);
      margin-bottom: 4px;
    }

    .format-description {
      font-size: 11px;
      color: var(--vscode-descriptionForeground);
    }

    .btn {
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .btn-primary {
      background: var(--vscode-button-background, #0e639c);
      color: var(--vscode-button-foreground, #ffffff);
      border: 1px solid var(--vscode-button-background, #0e639c);
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--vscode-button-hoverBackground, #1177bb);
      border-color: var(--vscode-button-hoverBackground, #1177bb);
    }

    .btn-secondary {
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border: 1px solid var(--vscode-button-border, #5a5a5a);
    }

    .btn-secondary:hover:not(:disabled) {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
      border-color: var(--vscode-button-border, #5a5a5a);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .advanced-section {
      margin-top: 8px;
      padding-top: 16px;
      border-top: 1px solid var(--vscode-border);
    }

    .section-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--vscode-foreground);
      margin-bottom: 12px;
    }
  `,Ix([we({type:Boolean,reflect:!0})],Tx.prototype,"show",2),Ix([we({type:String})],Tx.prototype,"mode",2),Ix([we({type:Object})],Tx.prototype,"pool",2),Ix([we({type:Object})],Tx.prototype,"volume",2),Ix([xe()],Tx.prototype,"formData",2),Ix([xe()],Tx.prototype,"isSubmitting",2),Ix([xe()],Tx.prototype,"errors",2),Tx=Ix([ve("volume-dialog")],Tx);var Px=Object.defineProperty,Lx=Object.getOwnPropertyDescriptor,Rx=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Lx(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Px(t,s,r),r};let Ox=class extends me{constructor(){super(...arguments),this.show=!1,this.poolNames=[],this.newName="",this.targetPool="",this.isCloning=!1,this.errors=/* @__PURE__ */new Map,this.handleEscape=e=>{"Escape"===e.key&&this.show&&!this.isCloning&&this.handleClose()}}connectedCallback(){super.connectedCallback(),window.addEventListener("keydown",this.handleEscape)}disconnectedCallback(){window.removeEventListener("keydown",this.handleEscape),super.disconnectedCallback()}willUpdate(e){e.has("show")&&this.show&&setTimeout(()=>{const e=this.shadowRoot?.querySelector("#clone-name");e&&e.focus()},100),e.has("volume")&&this.volume&&(this.newName=`${this.volume.name}-clone`)}validate(){return this.errors.clear(),this.newName?/^[a-zA-Z0-9-_]+$/.test(this.newName)||this.errors.set("name","Name can only contain letters, numbers, hyphens, and underscores"):this.errors.set("name","New volume name is required"),this.targetPool&&!/^[a-zA-Z0-9-_]+$/.test(this.targetPool)&&this.errors.set("targetPool","Target pool name can only contain letters, numbers, hyphens, and underscores"),this.requestUpdate(),0===this.errors.size}async handleClone(){if(this.pool&&this.volume&&this.validate()){this.isCloning=!0;try{const e={new_name:this.newName},t=this.targetPool.trim();t&&t!==this.pool.name&&(e.target_pool=t);const s=await yy.cloneVolume(this.pool.name,this.volume.name,e);this.dispatchEvent(new CustomEvent("volume-cloned",{detail:{poolName:s.pool_name,volume:s},bubbles:!0,composed:!0})),this.handleClose()}catch(e){let t="Unknown error";if(e instanceof fy)switch(e.code){case"VOLUME_ALREADY_EXISTS":t="A volume with this name already exists in the target pool.";break;case"INVALID_VOLUME_REQUEST":t="string"==typeof e.details?e.details:e.message;break;case"VOLUME_NOT_FOUND":t="Source volume not found. It may have been deleted.";break;default:t=e.message}else e instanceof Error&&(t=e.message);wx.addNotification({type:"error",title:"Failed to clone volume",message:t})}finally{this.isCloning=!1}}}handleClose(){this.dispatchEvent(new CustomEvent("close",{bubbles:!0,composed:!0}))}render(){const e=this.volume?.name??"",t=this.pool?.name??"",s=this.isCloning||!this.pool||!this.volume,i=this.poolNames&&this.poolNames.length?this.poolNames:t?[t]:[],o=this.targetPool||t||(i[0]??"");return J`
      <div class="drawer">
        <div class="drawer-header">
          <h2 class="header-title">Clone Volume</h2>
          <button class="close-button" @click=${this.handleClose} ?disabled=${s}>Ã</button>
        </div>

        <div class="drawer-content">
          <div class="form-container">
            <div class="info-box">
              <div class="info-row">
                <span class="info-label">Source volume</span>
                <span>${e}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Source pool</span>
                <span>${t}</span>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label required" for="clone-name">New volume name</label>
              <input
                id="clone-name"
                type="text"
                class="form-input ${this.errors.has("name")?"error":""}"
                .value=${this.newName}
                @input=${e=>{this.newName=e.target.value}}
                ?disabled=${s}
              />
              ${this.errors.has("name")?J`
                <div class="error-message">${this.errors.get("name")}</div>
              `:J`
                <div class="form-hint">Name of the cloned volume in the target pool.</div>
              `}
            </div>

            <div class="form-group">
              <label class="form-label" for="target-pool">Target pool</label>
              <select
                id="target-pool"
                class="form-select ${this.errors.has("targetPool")?"error":""}"
                .value=${o}
                @change=${e=>{this.targetPool=e.target.value}}
                ?disabled=${s}
              >
                ${i.map(e=>J`<option value=${e}>${e}</option>`)}
              </select>
              ${this.errors.has("targetPool")?J`
                <div class="error-message">${this.errors.get("targetPool")}</div>
              `:J`
                <div class="form-hint">Choose the pool where the cloned volume will be created. The source pool is selected by default.</div>
              `}
            </div>
          </div>
        </div>

        <div class="drawer-footer">
          <button
            class="btn btn-secondary"
            @click=${this.handleClose}
            ?disabled=${s}
          >
            Cancel
          </button>
          <button
            class="btn btn-primary"
            @click=${this.handleClone}
            ?disabled=${s}
          >
            ${this.isCloning?"Cloning...":"Clone Volume"}
          </button>
        </div>
      </div>
    `}};function Nx(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB","PB"][t]}function Bx(e){return("string"==typeof e?new Date(e):e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}Ox.styles=g`
    :host {
      display: block;
      position: fixed;
      top: 0;
      right: 0;
      width: 500px;
      height: 100vh;
      z-index: 1000;
      pointer-events: none;
    }

    :host([show]) {
      pointer-events: auto;
    }

    .drawer {
      width: 100%;
      height: 100%;
      background: var(--vscode-editor-background, var(--vscode-bg-light));
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      border-left: 1px solid var(--vscode-widget-border, var(--vscode-panel-border, #454545));
    }

    :host([show]) .drawer {
      transform: translateX(0);
    }

    .drawer-header {
      padding: 20px;
      background: var(--vscode-sideBar-background, #252526);
      border-bottom: 1px solid var(--vscode-widget-border, #454545);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .header-title {
      font-size: 18px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
    }

    .close-button {
      background: none;
      border: none;
      color: var(--vscode-foreground, #cccccc);
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 20px;
      transition: background 0.2s;
    }

    .close-button:hover {
      background: var(--vscode-toolbar-hoverBackground, rgba(255, 255, 255, 0.1));
    }

    .drawer-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .drawer-footer {
      padding: 16px 20px;
      background: var(--vscode-sideBar-background, #252526);
      border-top: 1px solid var(--vscode-widget-border, #454545);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      flex-shrink: 0;
    }

    .form-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      min-width: 0;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 6px;
      font-size: 13px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
    }

    .form-label.required::after {
      content: ' *';
      color: var(--vscode-inputValidation-errorForeground, #f48771);
    }

    .form-input,
    .form-select {
      width: 100%;
      padding: 8px 12px;
      background: var(--vscode-input-background, #3c3c3c);
      border: 1px solid var(--vscode-input-border, #5a5a5a);
      border-radius: 4px;
      color: var(--vscode-input-foreground, #cccccc);
      font-size: 13px;
      font-family: inherit;
      outline: none;
      box-sizing: border-box;
      transition: all 0.2s;
    }

    .form-input:focus,
    .form-select:focus {
      border-color: var(--vscode-focusBorder, #007acc);
      box-shadow: 0 0 0 1px var(--vscode-focusBorder, #007acc);
    }

    .form-input.error,
    .form-select.error {
      border-color: var(--vscode-inputValidation-errorBorder, #f48771);
    }

    .form-input:disabled,
    .form-select:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .form-hint {
      display: block;
      margin-top: 4px;
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #999999);
    }

    .error-message {
      display: block;
      margin-top: 4px;
      font-size: 12px;
      color: var(--vscode-inputValidation-errorForeground, #f48771);
    }

    .info-box {
      padding: 12px;
      background: var(--vscode-editor-background, #1e1e1e);
      border: 1px solid var(--vscode-editorWidget-border, #454545);
      border-radius: 4px;
      font-size: 13px;
      color: var(--vscode-foreground, #cccccc);
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .info-label {
      color: var(--vscode-descriptionForeground, #999999);
    }

    .btn {
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .btn-primary {
      background: var(--vscode-button-background, #0e639c);
      color: var(--vscode-button-foreground, #ffffff);
      border: 1px solid var(--vscode-button-background, #0e639c);
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--vscode-button-hoverBackground, #1177bb);
      border-color: var(--vscode-button-hoverBackground, #1177bb);
    }

    .btn-secondary {
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border: 1px solid var(--vscode-button-border, #5a5a5a);
    }

    .btn-secondary:hover:not(:disabled) {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
      border-color: var(--vscode-button-border, #5a5a5a);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  `,Rx([we({type:Boolean,reflect:!0})],Ox.prototype,"show",2),Rx([we({type:Object})],Ox.prototype,"pool",2),Rx([we({type:Object})],Ox.prototype,"volume",2),Rx([we({type:Array})],Ox.prototype,"poolNames",2),Rx([xe()],Ox.prototype,"newName",2),Rx([xe()],Ox.prototype,"targetPool",2),Rx([xe()],Ox.prototype,"isCloning",2),Rx([xe()],Ox.prototype,"errors",2),Ox=Rx([ve("volume-clone-dialog")],Ox);var Fx=Object.defineProperty,zx=Object.getOwnPropertyDescriptor,Ux=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?zx(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Fx(t,s,r),r};let Vx=class extends me{constructor(){super(...arguments),this.notificationContainer=null,this.poolFilter="all",this.showDetails=!1,this.selectedVolume=null,this.detailsLoading=!1,this.showVolumeDialog=!1,this.volumeDialogMode="create",this.dialogPool=null,this.dialogVolume=null,this.showCloneDialog=!1,this.clonePool=null,this.cloneVolume=null,this.showDeleteModal=!1,this.deleteItem=null,this.deletingVolume=null,this.isDeleting=!1,this.storeController=new Zl.StoreController(this,Jy.$state),this.filteredVolumesController=new Zl.StoreController(this,kw),this.volumeStatsController=new Zl.StoreController(this,Sw),this.searchQueryController=new Zl.StoreController(this,gw),this.activeTabController=new Zl.StoreController(this,vw),this.virtualizationEnabledController=new Zl.StoreController(this,Ay),this.virtualizationDisabledMessageController=new Zl.StoreController(this,Iy),this.tabs=[{id:"all",label:"All Volumes"},{id:"disk-images",label:"Disk Images"},{id:"iso-files",label:"ISO Files"},{id:"directories",label:"Directories"}],this.handleShowNotification=e=>{const t=e.detail;if(!t)return;const s=this.notificationContainer;s&&"function"==typeof s.addNotification&&s.addNotification({type:t.type,message:t.message,duration:t.duration??("error"===t.type?0:void 0)})}}getColumns(){return[{key:"nameCell",label:"Name",type:"custom"},{key:"formatCell",label:"Format",type:"custom"},{key:"capacityCell",label:"Capacity",type:"custom"},{key:"usageCell",label:"Usage",type:"custom"},{key:"poolCell",label:"Pool",type:"custom"},{key:"createdAtCell",label:"Created",type:"custom"}]}transformVolumeData(e){return e.map(e=>({...e,nameCell:e,formatCell:e,capacityCell:e,usageCell:e,poolCell:e,createdAtCell:e}))}getCustomRenderers(){return{nameCell:e=>{const t="dir"===e.type?"dir":"iso"===e.format?"iso":"disk",s="dir"===e.type?"ð":"iso"===e.format?"ð¿":"ð¾";return J`
          <div class="volume-name">
            <span class="volume-icon ${t}">${s}</span>
            <div class="volume-details">
              <div class="volume-title">${e.name}</div>
            </div>
          </div>
        `},formatCell:e=>J`
        <span class="format-badge ${e.format}">
          ${e.format}
        </span>
      `,capacityCell:e=>J`
        <div class="size-info">
          <div class="size-value">${Nx(e.capacity)}</div>
          <div class="size-usage">${Nx(e.allocation)} used</div>
        </div>
      `,usageCell:e=>J`
        <div>
          <div class="usage-bar">
            <div 
              class="usage-fill ${this.getUsageClass(e.used_percent||0)}"
              style="width: ${e.used_percent||0}%"
            ></div>
          </div>
          <div class="usage-percent">${e.used_percent||0}%</div>
        </div>
      `,poolCell:e=>J`
        <span class="pool-badge">${e.pool_name}</span>
      `,createdAtCell:e=>e.created_at?Bx(e.created_at):"-"}}getActions(e){return[{action:"view",label:"View Details",icon:"ðï¸"},{action:"resize",label:"Resize",icon:"ð"},{action:"clone",label:"Clone",icon:"ð§¬"},{action:"delete",label:"Delete",icon:"ðï¸",danger:!0}]}async connectedCallback(){super.connectedCallback(),await this.loadData()}firstUpdated(e){this.notificationContainer=this.renderRoot.querySelector("notification-container"),this.addEventListener("show-notification",this.handleShowNotification)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("show-notification",this.handleShowNotification)}async loadData(){try{await Promise.all([Mw.fetchAll(),By.fetch().catch(e=>{console.error("Failed to load storage pools for volumes view:",e)})])}catch(e){console.error("Failed to fetch volumes:",e),this.showNotification(`Failed to load volumes: ${e instanceof Error?e.message:"Unknown error"}`,"error")}}showNotification(e,t="info",s){this.dispatchEvent(new CustomEvent("show-notification",{detail:{message:e,type:t,duration:s},bubbles:!0,composed:!0}))}handleSearchChange(e){gw.set(e.detail.value)}handleTabChange(e){const t=e.detail.tabId;Mw.setActiveTab(t)}handlePoolFilterChange(e){this.poolFilter=e.detail.value}handleAction(e){const{action:t,item:s}=e.detail,i=s;switch(t){case"view":this.openDetails(i);break;case"resize":this.openResizeDialog(i);break;case"clone":this.openCloneDialog(i);break;case"delete":this.openDeleteModal(i)}}async handleRefresh(){try{await this.loadData()}catch(e){e instanceof uy||this.showNotification("Failed to refresh volumes","error")}}async openDetails(e){this.detailsLoading=!0;try{const t=await yy.getVolume(e.pool_name,e.name);this.selectedVolume=t,this.showDetails=!0}catch(t){t instanceof uy?this.showNotification("Virtualization is disabled on this host","error"):(t instanceof fy||t instanceof Error)&&this.showNotification(`Failed to load volume details: ${t.message}`,"error")}finally{this.detailsLoading=!1}}getPoolByName(e){const t=By.$items.get();return t?t instanceof Map?t.get(e)||null:"object"==typeof t&&t[e]||null:null}openResizeDialog(e){const t=this.getPoolByName(e.pool_name);t?(this.dialogPool=t,this.dialogVolume=e,this.volumeDialogMode="resize",this.showVolumeDialog=!0):this.showNotification(`Storage pool "${e.pool_name}" not found for this volume`,"error")}openCloneDialog(e){const t=this.getPoolByName(e.pool_name);t?(this.clonePool=t,this.cloneVolume=e,this.showCloneDialog=!0):this.showNotification(`Storage pool "${e.pool_name}" not found for this volume`,"error")}openDeleteModal(e){this.deletingVolume=e,this.deleteItem={type:"Volume",name:e.name},this.showDeleteModal=!0}async handleConfirmDelete(e){if(!this.deletingVolume)return;this.isDeleting=!0;const t=this.deletingVolume;try{await yy.deleteVolume(t.pool_name,t.name,!1),await Mw.fetchAll(),this.showNotification(`Volume "${t.name}" deleted successfully`,"success"),this.showDeleteModal=!1,this.deleteItem=null,this.deletingVolume=null}catch(s){let e="Unknown error",i="";if(s instanceof fy){const t=[s.message,"string"==typeof s.details?s.details:""].map(e=>(e||"").trim()).filter(Boolean);e=t.length?t.join(" â "):s.message,i=s.code?` (${s.code})`:""}else s instanceof Error&&(e=s.message);this.showNotification(`Failed to delete volume "${t.name}": ${e}${i}`,"error",0)}finally{this.isDeleting=!1}}handleCancelDelete(){this.showDeleteModal=!1,this.deleteItem=null,this.deletingVolume=null}handleCreateVolume(){let e=null;if("all"===this.poolFilter){if(e=this.getPoolByName("default"),!e){const t=By.$items.get();if(t instanceof Map){e=t.values().next().value||null}else if(t&&"object"==typeof t){const s=Object.keys(t),i=s.length?s[0]:void 0;e=i?t[i]:null}}if(!e)return void this.showNotification("No storage pools available to create a volume.","error")}else if(e=this.getPoolByName(this.poolFilter),!e)return void this.showNotification(`Storage pool "${this.poolFilter}" not found.`,"error");this.dialogPool=e,this.dialogVolume=null,this.volumeDialogMode="create",this.showVolumeDialog=!0}closeVolumeDialog(){this.showVolumeDialog=!1;const e=this.dialogPool,t=this.dialogVolume;setTimeout(()=>{this.showVolumeDialog||this.dialogPool!==e||this.dialogVolume!==t||(this.dialogPool=null,this.dialogVolume=null)},300)}handleVolumeDialogClose(){this.closeVolumeDialog()}async handleVolumeCreated(e){this.closeVolumeDialog();try{await Mw.fetchAll(),this.showNotification("Volume created successfully","success")}catch(t){t instanceof uy||this.showNotification("Volume was created but failed to refresh list","error")}}async handleVolumeResized(e){this.closeVolumeDialog();try{await Mw.fetchAll(),this.showNotification("Volume resized successfully","success")}catch(t){t instanceof uy||this.showNotification("Volume was resized but failed to refresh list","error")}}closeCloneDialog(){this.showCloneDialog=!1;const e=this.clonePool,t=this.cloneVolume;setTimeout(()=>{this.showCloneDialog||this.clonePool!==e||this.cloneVolume!==t||(this.clonePool=null,this.cloneVolume=null)},300)}handleCloneDialogClose(){this.closeCloneDialog()}async handleVolumeCloned(e){this.closeCloneDialog();try{await Mw.fetchAll(),this.showNotification("Volume cloned successfully","success")}catch(t){t instanceof uy||this.showNotification("Volume was cloned but failed to refresh list","error")}}getUsageClass(e){return e>=90?"high":e>=70?"medium":"low"}renderVirtualizationDisabledBanner(e){return J`
      <div class="virtualization-disabled-banner">
        <h2>Virtualization is disabled on this host</h2>
        <p>Virtualization features are currently unavailable because libvirt is not installed or not running.\
 To manage storage volumes, install and start libvirt on this machine, then reload this page.</p>
        ${e?J`<p>${e}</p>`:""}
      </div>
    `}render(){if(!1===this.virtualizationEnabledController.value){const e=this.virtualizationDisabledMessageController.value;return J`
        <div class="container">
          ${this.renderVirtualizationDisabledBanner(e)}
        </div>
      `}const e=this.storeController.value,t=this.filteredVolumesController.value||[],s=this.volumeStatsController.value||{totalVolumes:0,totalCapacity:0,totalAllocation:0,diskImages:0,isoFiles:0,directories:0,pools:[]},i=this.activeTabController.value||"all",o=this.searchQueryController.value||"",r=[{value:"all",label:"All Pools"},...s.pools.map(e=>({value:e,label:e}))];let a=t;return"all"!==this.poolFilter&&(a=t.filter(e=>e.pool_name===this.poolFilter)),J`
      <div class="container">

        <!-- Stats Bar -->
        <div class="stats-bar">
          <div class="stat-widget">
            <div class="stat-widget-header">
              <span class="stat-icon total">ð</span>
              <span class="stat-label">Total Volumes</span>
            </div>
            <div class="stat-value">${s.totalVolumes}</div>
            <div class="stat-subtitle">active volumes</div>
          </div>
          
          <div class="stat-widget">
            <div class="stat-widget-header">
              <span class="stat-icon capacity">ð¾</span>
              <span class="stat-label">Capacity</span>
            </div>
            <div class="stat-value">${Nx(s.totalCapacity)}</div>
            <div class="stat-subtitle">total space</div>
          </div>
          
          <div class="stat-widget">
            <div class="stat-widget-header">
              <span class="stat-icon allocated">â</span>
              <span class="stat-label">Allocated</span>
            </div>
            <div class="stat-value">${Nx(s.totalAllocation)}</div>
            <div class="stat-subtitle">${Math.round(s.totalAllocation/s.totalCapacity*100)||0}% used</div>
          </div>
          
          <div class="stat-widget">
            <div class="stat-widget-header">
              <span class="stat-icon disk">ð¿</span>
              <span class="stat-label">Disk Images</span>
            </div>
            <div class="stat-value">${s.diskImages}</div>
            <div class="stat-subtitle">qcow2, raw, vmdk</div>
          </div>
          
          <div class="stat-widget">
            <div class="stat-widget-header">
              <span class="stat-icon iso">ð</span>
              <span class="stat-label">ISO Files</span>
            </div>
            <div class="stat-value">${s.isoFiles}</div>
            <div class="stat-subtitle">installation media</div>
          </div>
          
          <div class="stat-widget">
            <div class="stat-widget-header">
              <span class="stat-icon dir">ð</span>
              <span class="stat-label">Directories</span>
            </div>
            <div class="stat-value">${s.directories}</div>
            <div class="stat-subtitle">folder volumes</div>
          </div>
        </div>

        <!-- Tabs -->
        <tab-group
          .tabs=${this.tabs}
          .activeTab=${i}
          @tab-change=${this.handleTabChange}
        ></tab-group>

        <!-- Controls -->
        <div class="controls">
          <div class="filters-section">
            <filter-dropdown
              .options=${r}
              .selectedValue=${this.poolFilter}
              .label=${"Filter by Pool"}
              @filter-change=${this.handlePoolFilterChange}
            ></filter-dropdown>
            <search-input
              .placeholder=${"Search volumes..."}
              .value=${o}
              @search-change=${this.handleSearchChange}
            ></search-input>
          </div>
          <div class="actions-section">
            <button class="btn btn-secondary" @click=${this.handleRefresh} title="Refresh">
              ð
            </button>
            <button
              class="btn btn-primary"
              @click=${this.handleCreateVolume}
              title="Create Volume"
            >
              + Volume
            </button>
          </div>
        </div>

        <!-- Content -->
        <div class="content">
          ${e.loading?J`
            <loading-state message="Loading storage volumes..."></loading-state>
          `:e.error?J`
            <empty-state
              icon="â"
              title="Error loading volumes"
              description=${e.error.message}
            ></empty-state>
          `:0===a.length?J`
            <empty-state
              icon="ð"
              title="No volumes found"
              description=${o?"No volumes match your search criteria":"No storage volumes available"}
            ></empty-state>
          `:J`
            <resource-table
              .columns=${this.getColumns()}
              .data=${this.transformVolumeData(a)}
              .getActions=${e=>this.getActions(e)}
              .customRenderers=${this.getCustomRenderers()}
              @action=${this.handleAction}
            ></resource-table>
          `}
        </div>

        <!-- Notification Container -->
        <notification-container></notification-container>

        ${this.showDetails&&this.selectedVolume?J`
          <detail-drawer
            .title=${`Volume: ${this.selectedVolume.name}`}
            .show=${this.showDetails}
            .loading=${this.detailsLoading}
            @close=${()=>{this.showDetails=!1,this.selectedVolume=null}}
          >
            <div style="padding: 20px;">
              <h3>Volume Information</h3>
              <div style="display: grid; grid-template-columns: 150px 1fr; gap: 12px; margin-bottom: 20px;">
                <strong>Name:</strong> <span>${this.selectedVolume.name}</span>
                <strong>Pool:</strong> <span>${this.selectedVolume.pool_name}</span>
                <strong>Type:</strong> <span>${this.selectedVolume.type}</span>
                <strong>Format:</strong> <span>${this.selectedVolume.format}</span>
                <strong>Capacity:</strong> <span>${Nx(this.selectedVolume.capacity)}</span>
                <strong>Allocation:</strong> <span>${Nx(this.selectedVolume.allocation||0)}</span>
                <strong>Usage:</strong> <span>${this.selectedVolume.used_percent||0}%</span>
                <strong>Path:</strong> <span>${this.selectedVolume.path}</span>
                <strong>Created:</strong> <span>${Bx(this.selectedVolume.created_at)}</span>
              </div>
            </div>
          </detail-drawer>
        `:""}

        ${this.showDeleteModal&&this.deleteItem?J`
          <delete-modal
            .show=${this.showDeleteModal}
            .item=${this.deleteItem}
            .loading=${this.isDeleting}
            @confirm-delete=${this.handleConfirmDelete}
            @cancel-delete=${this.handleCancelDelete}
          ></delete-modal>
        `:""}

        <volume-dialog
          .show=${this.showVolumeDialog}
          .mode=${this.volumeDialogMode}
          .pool=${this.dialogPool}
          .volume=${this.dialogVolume}
          @close=${this.handleVolumeDialogClose}
          @volume-created=${this.handleVolumeCreated}
          @volume-resized=${this.handleVolumeResized}
        ></volume-dialog>

        <volume-clone-dialog
          .show=${this.showCloneDialog}
          .pool=${this.clonePool}
          .volume=${this.cloneVolume}
          .poolNames=${s.pools}
          @close=${this.handleCloneDialogClose}
          @volume-cloned=${this.handleVolumeCloned}
        ></volume-clone-dialog>
      </div>
    `}};Vx.styles=g`
    :host {
      display: block;
      height: 100%;
      box-sizing: border-box;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 1rem;
    }



    /* Stats Bar */
    .stats-bar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin-bottom: 1.5rem;
    }

    .stat-widget {
      display: flex;
      flex-direction: column;
      padding: 14px;
      background: var(--vscode-editor-background);
      border: 1px solid var(--vscode-widget-border, var(--vscode-input-border, var(--vscode-panel-border, #454545)));
      border-radius: 8px;
      transition: all 0.2s ease;
      position: relative;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
    }

    .stat-widget:hover {
      border-color: var(--vscode-focusBorder);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      background: rgba(255, 255, 255, 0.02);
    }

    .stat-widget::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      border-radius: 8px 8px 0 0;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .stat-widget:hover::before {
      opacity: 1;
    }

    .stat-widget:nth-child(1)::before {
      background: var(--vscode-charts-blue);
    }

    .stat-widget:nth-child(2)::before {
      background: var(--vscode-charts-purple);
    }

    .stat-widget:nth-child(3)::before {
      background: var(--vscode-charts-green);
    }

    .stat-widget:nth-child(4)::before {
      background: var(--vscode-charts-orange);
    }

    .stat-widget:nth-child(5)::before {
      background: var(--vscode-charts-yellow);
    }

    .stat-widget:nth-child(6)::before {
      background: var(--vscode-charts-red);
    }

    .stat-widget-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .stat-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      font-size: 14px;
    }

    .stat-icon.total {
      color: var(--vscode-charts-blue);
    }

    .stat-icon.capacity {
      color: var(--vscode-charts-purple);
    }

    .stat-icon.allocated {
      color: var(--vscode-charts-green);
    }

    .stat-icon.disk {
      color: var(--vscode-charts-orange);
    }

    .stat-icon.iso {
      color: var(--vscode-charts-yellow);
    }

    .stat-icon.dir {
      color: var(--vscode-charts-red);
    }

    .stat-label {
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
      color: var(--vscode-descriptionForeground);
      opacity: 0.8;
    }

    .stat-value {
      font-size: 18px;
      font-weight: 600;
      color: var(--vscode-foreground);
      line-height: 1.2;
    }

    .stat-subtitle {
      font-size: 10px;
      color: var(--vscode-descriptionForeground);
      margin-top: 2px;
      opacity: 0.7;
    }

    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      gap: 1rem;
    }

    .filters-section {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }

    .actions-section {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Buttons (aligned with ISO and Pool drawers) */
    .btn {
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
      font-family: inherit;
    }

    .btn-primary {
      background: var(--vscode-button-background, #0e639c);
      color: var(--vscode-button-foreground, #ffffff);
      border: 1px solid var(--vscode-button-background, #0e639c);
    }
    .btn-primary:hover:not(:disabled) {
      background: var(--vscode-button-hoverBackground, #1177bb);
      border-color: var(--vscode-button-hoverBackground, #1177bb);
    }

    .btn-secondary {
      background: var(--vscode-button-secondaryBackground, #3c3c3c);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border: 1px solid var(--vscode-button-border, #5a5a5a);
    }
    .btn-secondary:hover:not(:disabled) {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
      border-color: var(--vscode-button-border, #5a5a5a);
    }

    search-input {
      flex: 1;
      max-width: 400px;
    }

    .content {
      flex: 1;
      overflow-y: auto;
    }

    /* Tab styles */
    .tabs {
      display: flex;
      gap: 0;
      border-bottom: 1px solid var(--vscode-panel-border);
      margin-bottom: 1rem;
    }

    .tab {
      padding: 8px 16px;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: var(--vscode-foreground);
      cursor: pointer;
      font-size: 13px;
      opacity: 0.7;
      transition: all 0.2s;
    }

    .tab:hover {
      opacity: 1;
    }

    .tab.active {
      opacity: 1;
      border-bottom-color: var(--vscode-focusBorder);
      color: var(--vscode-focusBorder);
    }

    /* Table Styles */
    .volumes-table {
      background: var(--vscode-editor-background);
      border: 1px solid var(--vscode-editorWidget-border);
      border-radius: 4px;
      overflow: hidden;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      text-align: left;
      padding: 8px 12px;
      background: var(--vscode-editor-background);
      border-bottom: 1px solid var(--vscode-editorWidget-border);
      font-size: 12px;
      font-weight: 600;
      color: var(--vscode-foreground);
      text-transform: uppercase;
      opacity: 0.7;
    }

    td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--vscode-editorWidget-border);
      font-size: 13px;
      color: var(--vscode-foreground);
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover td {
      background: var(--vscode-list-hoverBackground);
    }

    /* Volume Info */
    .volume-name {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .volume-icon {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      font-size: 14px;
    }

    .volume-icon.disk {
      background: rgba(59, 130, 246, 0.2);
      color: rgb(59, 130, 246);
    }

    .volume-icon.iso {
      background: rgba(168, 85, 247, 0.2);
      color: rgb(168, 85, 247);
    }

    .volume-icon.dir {
      background: rgba(251, 146, 60, 0.2);
      color: rgb(251, 146, 60);
    }

    .volume-details {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .volume-title {
      font-weight: 500;
      color: var(--vscode-foreground);
    }

    .volume-path {
      font-size: 11px;
      color: var(--vscode-descriptionForeground);
      font-family: monospace;
      opacity: 0.8;
    }

    /* Format Badge */
    .format-badge {
      display: inline-flex;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .format-badge.qcow2 {
      background: rgba(59, 130, 246, 0.2);
      color: rgb(59, 130, 246);
    }

    .format-badge.raw {
      background: rgba(34, 197, 94, 0.2);
      color: rgb(34, 197, 94);
    }

    .format-badge.iso {
      background: rgba(168, 85, 247, 0.2);
      color: rgb(168, 85, 247);
    }

    .format-badge.vmdk {
      background: rgba(251, 146, 60, 0.2);
      color: rgb(251, 146, 60);
    }

    .format-badge.dir {
      background: rgba(107, 114, 128, 0.2);
      color: rgb(107, 114, 128);
    }

    /* Size Info */
    .size-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .size-value {
      font-weight: 500;
    }

    .size-usage {
      font-size: 12px;
      color: var(--text-tertiary);
    }

    /* Usage Bar */
    .usage-bar {
      width: 80px;
      height: 4px;
      background: var(--vscode-progressBar-background);
      border-radius: 2px;
      overflow: hidden;
      margin-top: 2px;
    }

    .usage-fill {
      height: 100%;
      background: var(--vscode-progressBar-foreground);
      transition: width 0.3s ease;
    }

    .usage-fill.high {
      background: var(--vscode-inputValidation-errorBackground);
    }

    .usage-fill.medium {
      background: var(--vscode-inputValidation-warningBackground);
    }

    .usage-fill.low {
      background: var(--vscode-progressBar-foreground);
    }

    .usage-percent {
      font-size: 11px;
      color: var(--vscode-descriptionForeground);
      margin-top: 2px;
    }

    /* Pool Badge */
    .pool-badge {
      display: inline-flex;
      padding: 2px 6px;
      background: var(--vscode-badge-background);
      color: var(--vscode-badge-foreground);
      border-radius: 3px;
      font-size: 11px;
    }

    /* Actions */
    .actions {
      display: flex;
      gap: 4px;
    }

    .action-btn {
      padding: 4px 8px;
      background: transparent;
      border: none;
      border-radius: 3px;
      color: var(--vscode-foreground);
      cursor: pointer;
      font-size: 16px;
      opacity: 0.6;
      transition: all 0.2s;
    }

    .action-btn:hover {
      background: var(--vscode-toolbar-hoverBackground);
      opacity: 1;
    }

    .action-btn.danger:hover {
      color: var(--vscode-inputValidation-errorForeground);
      background: var(--vscode-inputValidation-errorBackground);
    }

    /* Loading */
    .loading-container {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 400px;
    }

    /* Empty State */
    .empty-container {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 400px;
    }

    .empty-state {
      text-align: center;
      color: var(--text-secondary);
    }

    .empty-state h3 {
      margin: 16px 0 8px;
      font-size: 18px;
      font-weight: 500;
    }

    .empty-state p {
      margin: 0;
      font-size: 14px;
      color: var(--text-tertiary);
    }

    .spinner {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .btn-refresh {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px 12px;
      background: transparent;
      color: var(--vscode-foreground);
      border: 1px solid var(--vscode-button-border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
    }

    .btn-refresh:hover {
      background: var(--vscode-button-secondaryHoverBackground);
    }

    .virtualization-disabled-banner {
      margin-top: 16px;
      padding: 16px 20px;
      border-radius: 8px;
      border: 1px solid var(--vscode-inputValidation-warningBorder, #e2c08d);
      background: var(--vscode-inputValidation-warningBackground, rgba(229, 200, 144, 0.15));
      color: var(--vscode-inputValidation-warningForeground, #e2c08d);
    }

    .virtualization-disabled-banner h2 {
      margin: 0 0 8px 0;
      font-size: 16px;
      font-weight: 500;
    }

    .virtualization-disabled-banner p {
      margin: 0 0 4px 0;
      font-size: 13px;
      color: var(--vscode-descriptionForeground);
    }
  `,Ux([xe()],Vx.prototype,"poolFilter",2),Ux([xe()],Vx.prototype,"showDetails",2),Ux([xe()],Vx.prototype,"selectedVolume",2),Ux([xe()],Vx.prototype,"detailsLoading",2),Ux([xe()],Vx.prototype,"showVolumeDialog",2),Ux([xe()],Vx.prototype,"volumeDialogMode",2),Ux([xe()],Vx.prototype,"dialogPool",2),Ux([xe()],Vx.prototype,"dialogVolume",2),Ux([xe()],Vx.prototype,"showCloneDialog",2),Ux([xe()],Vx.prototype,"clonePool",2),Ux([xe()],Vx.prototype,"cloneVolume",2),Ux([xe()],Vx.prototype,"showDeleteModal",2),Ux([xe()],Vx.prototype,"deleteItem",2),Ux([xe()],Vx.prototype,"deletingVolume",2),Ux([xe()],Vx.prototype,"isDeleting",2),Vx=Ux([ve("virtualization-volumes")],Vx);var jx=Object.defineProperty,Hx=Object.getOwnPropertyDescriptor,Wx=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Hx(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&jx(t,s,r),r};let qx=class extends me{constructor(){super(...arguments),this.backups=[],this.loading=!1,this.error=null,this.search="",this.status="all",this.type="all",this.toast=null,this.showImportDrawer=!1,this.showCreateDrawer=!1,this.showRestore=!1,this.restoreTarget=null,this.restoreNewName="",this.restoreOverwrite=!1,this.restoreKey="",this.deletingId=null,this.downloadingId=null,this.missingFiles=/* @__PURE__ */new Set,this.showDeleteModal=!1,this.deleteTarget=null,this.showUploadDrawer=!1,this.selectedFile=null,this.uploadUrl=null,this.uploadId=null,this.isPaused=!1,this.currentUpload=null,this.uploadMetadata={vm_name:"",vm_uuid:"",backup_type:"full",compression:"none",encryption:"none",description:"",retention_days:7},this.importForm={path:"",vm_name:"",vm_uuid:"",backup_id:"",type:"full",compression:"none",encryption:"none",retention_days:7,description:""},this.createForm={vm_id:"",backup_type:"full",destination_path:"",compression:"none",encryption:"none",include_memory:!1,retention_days:7,description:""},this.getActions=e=>{const t=e.backup_id||e.id||null,s=!!t&&this.deletingId===t,i=!!t&&this.downloadingId===t,o=s||i,r=!!t&&this.missingFiles.has(t);return[{label:"Restore",action:"restore",disabled:o},{label:i?"Downloadingâ¦":r?"Download (missing)":"Download",action:"download",disabled:o||r},{label:s?"Deletingâ¦":"Delete",action:"delete",danger:!0,disabled:o}]}}connectedCallback(){super.connectedCallback(),this.backupsUnsub=ky.subscribe(()=>this.sync()),this.vmsUnsub=Oy.$items.subscribe(()=>this.requestUpdate()),this.uploadStateUnsub=$y.subscribe(()=>this.requestUpdate()),this.loadVMs(),this.loadBackups()}disconnectedCallback(){super.disconnectedCallback(),this.backupsUnsub?.(),this.vmsUnsub?.(),this.uploadStateUnsub?.()}async loadVMs(){try{await Oy.fetch()}catch(e){console.warn("VM fetch failed",e)}}vmMap(){const e=Oy.$items.get();return e instanceof Map?e:e&&"object"==typeof e?new Map(Object.entries(e)):/* @__PURE__ */new Map}vmExists(e){const t=this.vmMap(),s=e.vm_uuid||e.vm_id;return!!s&&t.has(s)}async loadBackups(){this.loading=!0,this.error=null;try{await My.fetchGlobal({search:this.search.trim()||void 0,status:"all"!==this.status?this.status:void 0,type:"all"!==this.type?this.type:void 0}),this.sync()}catch(e){this.error=e?.message||"Failed to load backups"}finally{this.loading=!1}}sync(){const e=ky.get();this.backups=[...e].sort((e,t)=>(t.started_at||t.created_at||"").localeCompare(e.started_at||e.created_at||""))}filteredBackups(){return this.backups.filter(e=>{if("all"!==this.status&&(e.status||"").toLowerCase()!==this.status)return!1;if("all"!==this.type&&e.type!==this.type)return!1;if(this.search){const t=this.search.toLowerCase();if(!`${e.vm_name||""} ${e.vm_uuid||""} ${e.backup_id||""}`.toLowerCase().includes(t))return!1}return!0})}columns(){return[{key:"vm_display",label:"VM"},{key:"status_display",label:"Status",type:"status"},{key:"type",label:"Type"},{key:"created_display",label:"Created"},{key:"size_display",label:"Size"},{key:"destination_display",label:"Destination"},{key:"encryption_display",label:"Encryption"}]}tableData(){return this.filteredBackups().map(e=>({...e,vm_display:J`${e.vm_name||e.vm_uuid||"â"}${this.vmExists(e)?"":J` <span class="chip warn">VM deleted</span>`}`,status_display:e.status||"unknown",created_display:this.formatDate(e.started_at||e.created_at),size_display:this.formatSize(e.size_bytes||e.size),destination_display:e.destination_path||"â",encryption_display:e.encryption&&"none"!==e.encryption?e.encryption:"None"}))}handleAction(e){const{action:t,item:s}=e.detail,i=s;switch(t){case"restore":this.openRestore(i);break;case"download":this.handleDownload(i);break;case"delete":this.handleDelete(i)}}setToast(e,t="info"){this.toast={text:e,type:t},setTimeout(()=>this.toast=null,3e3)}handleDelete(e){e.backup_id&&(this.deleteTarget=e,this.showDeleteModal=!0)}async confirmDelete(){if(!this.deleteTarget?.backup_id)return;const e=this.deleteTarget.backup_id;this.deletingId=e;try{await My.delete(e),this.setToast("Backup deleted","success"),this.showDeleteModal=!1,await this.updateComplete,this.deleteTarget=null,this.loadBackups()}catch(t){this.setToast(t?.message||"Failed to delete","error")}finally{this.deletingId=null}}handleDownload(e){if(e.backup_id){try{const t=yy.getBackupDownloadUrl(e.backup_id),s=document.createElement("a");s.href=t,s.download=`${e.vm_name||e.vm_uuid||"vm"}-${e.backup_id}.qcow2`,document.body.appendChild(s),s.click(),document.body.removeChild(s),this.setToast("Download started","info")}catch(t){this.setToast(t?.message||"Failed to start download","error")}this.downloadingId=null}}openRestore(e){this.restoreTarget=e,this.restoreNewName=`${e.vm_name||e.vm_uuid||"vm"}-restored`,this.restoreOverwrite=!1,this.restoreKey="",this.showRestore=!0}async confirmRestore(){if(this.restoreTarget)try{await My.restore({backup_id:this.restoreTarget.backup_id,overwrite:this.restoreOverwrite,new_vm_name:this.restoreOverwrite?void 0:this.restoreNewName||`${this.restoreTarget.vm_name||"vm"}-restored`,decryption_key:this.restoreKey||void 0}),this.setToast("Restore started","success"),this.showRestore=!1}catch(e){this.setToast(e?.message||"Restore failed","error")}}async handleImport(){try{await My.import({path:this.importForm.path,vm_name:this.importForm.vm_name,vm_uuid:this.importForm.vm_uuid||void 0,backup_id:this.importForm.backup_id||void 0,type:this.importForm.type,compression:this.importForm.compression,encryption:this.importForm.encryption,retention_days:this.importForm.retention_days,description:this.importForm.description}),this.setToast("Backup imported","success"),this.showImportDrawer=!1,this.loadBackups()}catch(e){this.setToast(e?.message||"Import failed","error")}}openUploadDrawer(){this.showUploadDrawer=!0,this.selectedFile=null,this.uploadUrl=null,this.uploadId=null,this.isPaused=!1,this.uploadMetadata={vm_name:"",vm_uuid:"",backup_type:"full",compression:"none",encryption:"none",description:"",retention_days:7},My.resetUploadState()}closeUploadDrawer(){this.currentUpload&&(this.currentUpload.abort(),this.currentUpload=null),this.showUploadDrawer=!1,this.selectedFile=null,this.uploadUrl=null,this.uploadId=null,My.resetUploadState()}handleFileSelect(e){const t=e.target;if(t.files&&t.files[0]){const e=t.files[0];if(!e.name.toLowerCase().endsWith(".qcow2"))return void this.setToast("Please select a .qcow2 backup file","error");const s=536870912e3;if(e.size>s)return void this.setToast("File size exceeds 500GB limit","error");this.selectedFile=e}}removeSelectedFile(){this.selectedFile=null,this.uploadUrl=null,this.uploadId=null}async handleUpload(){if(this.selectedFile)if(this.uploadMetadata.vm_name.trim())try{if(!this.uploadUrl||!this.uploadId){const{uploadUrl:e,uploadId:t}=await yy.initiateBackupUpload({filename:this.selectedFile.name,size:this.selectedFile.size,vm_name:this.uploadMetadata.vm_name,vm_uuid:this.uploadMetadata.vm_uuid||void 0,backup_type:this.uploadMetadata.backup_type,compression:this.uploadMetadata.compression,encryption:this.uploadMetadata.encryption,description:this.uploadMetadata.description||void 0,retention_days:this.uploadMetadata.retention_days});this.uploadUrl=e,this.uploadId=t}My.setUploadState({isUploading:!0,uploadProgress:this.isPaused?$y.get().uploadProgress:0,uploadId:this.uploadId,error:null}),this.isPaused=!1,this.currentUpload=new Nu(this.selectedFile,{uploadUrl:this.uploadUrl,chunkSize:10485760,metadata:{filename:this.selectedFile.name,filetype:this.selectedFile.type||"application/octet-stream",vm_name:this.uploadMetadata.vm_name},headers:{Authorization:`Bearer ${localStorage.getItem("jwt_token")||localStorage.getItem("auth_token")}`,"Tus-Resumable":"1.0.0"},uploadDataDuringCreation:!0,removeFingerprintOnSuccess:!0,retryDelays:[0,1e3,3e3,5e3],onError:e=>{console.error("Backup upload failed:",e),this.setToast(`Upload failed: ${e.message}`,"error"),this.currentUpload=null,My.setUploadState({isUploading:!1,uploadProgress:0,uploadId:null,error:e.message})},onProgress:(e,t)=>{const s=Math.round(e/t*100);My.setUploadState({...$y.get(),uploadProgress:s})},onSuccess:async()=>{try{await yy.completeBackupUpload(this.uploadId),My.resetUploadState(),await this.loadBackups(),this.setToast("Backup uploaded successfully","success"),this.closeUploadDrawer()}catch(e){console.error("Failed to complete backup upload:",e),this.setToast("Failed to complete upload","error"),My.setUploadState({isUploading:!1,uploadProgress:0,uploadId:null,error:e instanceof Error?e.message:"Unknown error"})}}}),this.currentUpload.start()}catch(e){console.error("Failed to initiate backup upload:",e),this.setToast(`Failed to initiate upload: ${e instanceof Error?e.message:"Unknown error"}`,"error")}else this.setToast("VM name is required","error");else this.setToast("Please select a file to upload","error")}pauseUpload(){this.currentUpload&&(this.currentUpload.abort(),this.isPaused=!0,My.setUploadState({...$y.get(),isUploading:!1}))}resumeUpload(){this.currentUpload&&this.isPaused&&(this.isPaused=!1,My.setUploadState({...$y.get(),isUploading:!0}),this.currentUpload.start())}cancelUpload(){this.currentUpload&&(this.currentUpload.abort(),this.currentUpload=null),this.uploadUrl=null,this.uploadId=null,this.isPaused=!1,My.resetUploadState(),this.setToast("Upload cancelled","info")}async handleCreate(){if(this.createForm.vm_id)try{const e={...this.createForm};delete e.vm_id,await My.create(this.createForm.vm_id,e),this.setToast("Backup started","success"),this.showCreateDrawer=!1,this.loadBackups()}catch(e){this.setToast(e?.message||"Create failed","error")}else this.setToast("Select a VM","error")}formatDate(e){if(!e)return"â";const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()}formatSize(e){if(!e)return"â";const t=["B","KB","MB","GB","TB"];let s=e,i=0;for(;s>=1024&&i<t.length-1;)s/=1024,i++;return`${s.toFixed(1)} ${t[i]}`}renderTable(){const e=this.tableData();if(this.loading)return J`<loading-state message="Loading backups..."></loading-state>`;if(0===e.length)return J`
        <empty-state
          icon="ð¾"
          title="No backups found."
          description="Import an existing backup or create a new one."
        >
          <div slot="actions" style="display:flex; gap:8px; justify-content:center;">
            <button class="btn" @click=${()=>this.openUploadDrawer()}>Upload backup</button>
            <button class="btn" @click=${()=>this.showImportDrawer=!0}>Import backup</button>
            <button class="btn btn-primary" @click=${()=>this.showCreateDrawer=!0}>Create backup</button>
          </div>
        </empty-state>
      `;return J`
      <resource-table
        .columns=${this.columns()}
        .data=${e}
        .getActions=${this.getActions}
        .customRenderers=${{vm_display:e=>e,destination_display:e=>e,encryption_display:e=>e,size_display:e=>e}}
        @action=${e=>this.handleAction(e)}
      ></resource-table>
    `}render(){return J`
      <div class="page">
        <div class="header">
          <h2 class="title">Backups</h2>
          <div class="actions">
            <button class="btn" @click=${()=>this.loadBackups()} ?disabled=${this.loading}>Refresh</button>
            <button class="btn" @click=${()=>this.openUploadDrawer()}>Upload backup</button>
            <button class="btn" @click=${()=>this.showImportDrawer=!0}>Import backup</button>
            <button class="btn btn-primary" @click=${()=>this.showCreateDrawer=!0}>Create backup</button>
          </div>
        </div>

        <div class="controls">
          <div class="filters">
            <select .value=${this.status} @change=${e=>{this.status=e.target.value,this.loadBackups()}}>
              <option value="all">All status</option>
              <option value="pending">Pending</option>
              <option value="running">Running</option>
              <option value="completed">Completed</option>
              <option value="failed">Failed</option>
            </select>
            <select .value=${this.type} @change=${e=>{this.type=e.target.value,this.loadBackups()}}>
              <option value="all">All types</option>
              <option value="full">Full</option>
              <option value="incremental">Incremental</option>
              <option value="differential">Differential</option>
            </select>
          </div>
          <search-input
            .placeholder=${"Search VM name/UUID"}
            .value=${this.search}
            @search-change=${e=>{this.search=e.detail.value,this.loadBackups()}}
          ></search-input>
        </div>

        ${this.toast?J`<div class="toast ${this.toast.type}">${this.toast.text}</div>`:""}
        ${this.error?J`<div class="toast error">${this.error}</div>`:""}

        ${this.renderTable()}
      </div>

      ${this.renderImportDrawer()}
      ${this.renderCreateDrawer()}
      ${this.renderUploadDrawer()}
      ${this.renderRestoreModal()}
      ${this.renderDeleteModal()}
    `}renderImportDrawer(){return J`
      <detail-drawer
        .title=${"Import backup"}
        .show=${this.showImportDrawer}
        @close=${()=>this.showImportDrawer=!1}
      >
        <div class="drawer-content">
          <div class="field">
            <label>Path</label>
            <input type="text" .value=${this.importForm.path} @input=${e=>this.importForm.path=e.target.value} />
          </div>
          <div class="field">
            <label>VM name</label>
            <input type="text" .value=${this.importForm.vm_name} @input=${e=>this.importForm.vm_name=e.target.value} />
          </div>
          <div class="field">
            <label>VM UUID (optional)</label>
            <input type="text" .value=${this.importForm.vm_uuid} @input=${e=>this.importForm.vm_uuid=e.target.value} />
          </div>
          <div class="field">
            <label>Backup ID (optional)</label>
            <input type="text" .value=${this.importForm.backup_id} @input=${e=>this.importForm.backup_id=e.target.value} />
          </div>
          <div class="field">
            <label>Type</label>
            <select .value=${this.importForm.type} @change=${e=>this.importForm.type=e.target.value}>
              <option value="full">Full</option>
              <option value="incremental">Incremental</option>
              <option value="differential">Differential</option>
            </select>
          </div>
          <div class="field">
            <label>Compression</label>
            <select .value=${this.importForm.compression} @change=${e=>this.importForm.compression=e.target.value}>
              <option value="none">None</option>
              <option value="gzip">gzip</option>
              <option value="bzip2">bzip2</option>
              <option value="zstd">zstd</option>
              <option value="xz">xz</option>
            </select>
          </div>
          <div class="field">
            <label>Encryption</label>
            <select .value=${this.importForm.encryption} @change=${e=>this.importForm.encryption=e.target.value}>
              <option value="none">None</option>
              <option value="aes-256">AES-256</option>
              <option value="aes-128">AES-128</option>
            </select>
          </div>
          <div class="field">
            <label>Retention days</label>
            <input type="number" min="1" .value=${String(this.importForm.retention_days)} @input=${e=>this.importForm.retention_days=Number(e.target.value)} />
          </div>
          <div class="field">
            <label>Description</label>
            <textarea .value=${this.importForm.description} @input=${e=>this.importForm.description=e.target.value}></textarea>
          </div>
          <div class="field" style="color: var(--vscode-descriptionForeground, #9ca3af); font-size: 12px;">Import does not move files; path must exist on host.</div>
        </div>
        <div class="drawer-footer">
          <button class="btn" @click=${()=>this.showImportDrawer=!1}>Cancel</button>
          <button class="btn btn-primary" @click=${()=>this.handleImport()}>Import</button>
        </div>
      </detail-drawer>
    `}renderCreateDrawer(){const e=(()=>{const e=Oy.$items.get();return e instanceof Map?Array.from(e.values()):e&&"object"==typeof e?Object.values(e):[]})();return J`
      <detail-drawer
        .title=${"Create backup"}
        .show=${this.showCreateDrawer}
        @close=${()=>this.showCreateDrawer=!1}
      >
        <div class="drawer-content">
          <div class="field">
            <label>Virtual machine</label>
            <select .value=${this.createForm.vm_id||""} @change=${e=>this.createForm.vm_id=e.target.value}>
              <option value="">Select VM</option>
              ${e.map(e=>J`<option value=${e.id}>${e.name||e.id}</option>`)}
            </select>
          </div>
          <div class="field">
            <label>Type</label>
            <select .value=${this.createForm.backup_type} @change=${e=>this.createForm.backup_type=e.target.value}>
              <option value="full">Full</option>
              <option value="incremental">Incremental</option>
              <option value="differential">Differential</option>
            </select>
          </div>
          <div class="field">
            <label>Destination path</label>
            <input type="text" .value=${this.createForm.destination_path||""} @input=${e=>this.createForm.destination_path=e.target.value} />
          </div>
          <div class="field">
            <label>Compression</label>
            <select .value=${this.createForm.compression} @change=${e=>this.createForm.compression=e.target.value}>
              <option value="none">None</option>
              <option value="gzip">gzip</option>
              <option value="bzip2">bzip2</option>
              <option value="zstd">zstd</option>
              <option value="xz">xz</option>
            </select>
          </div>
          <div class="field">
            <label>Encryption</label>
            <select .value=${this.createForm.encryption} @change=${e=>this.createForm.encryption=e.target.value}>
              <option value="none">None</option>
              <option value="aes-256">AES-256</option>
              <option value="aes-128">AES-128</option>
            </select>
          </div>
          <div class="field checkbox">
            <input type="checkbox" .checked=${this.createForm.include_memory||!1} @change=${e=>this.createForm.include_memory=e.target.checked} />
            <label>Include memory</label>
          </div>
          <div class="field">
            <label>Retention days</label>
            <input type="number" min="1" .value=${String(this.createForm.retention_days??"")} @input=${e=>this.createForm.retention_days=Number(e.target.value)} />
          </div>
          <div class="field">
            <label>Description</label>
            <textarea .value=${this.createForm.description||""} @input=${e=>this.createForm.description=e.target.value}></textarea>
          </div>
        </div>
        <div class="drawer-footer">
          <button class="btn" @click=${()=>this.showCreateDrawer=!1}>Cancel</button>
          <button class="btn btn-primary" @click=${()=>this.handleCreate()}>Create</button>
        </div>
      </detail-drawer>
    `}renderUploadDrawer(){const e=$y.get();return J`
      <detail-drawer
        .title=${"Upload backup"}
        .show=${this.showUploadDrawer}
        @close=${()=>this.closeUploadDrawer()}
      >
        <div class="drawer-content">
          <div class="field">
            <label>Backup file (.qcow2)</label>
            <input
              type="file"
              accept=".qcow2"
              @change=${e=>this.handleFileSelect(e)}
              ?disabled=${e.isUploading}
            />
            ${this.selectedFile?J`
              <div style="margin-top: 8px; font-size: 12px; color: var(--vscode-descriptionForeground);">
                Selected: ${this.selectedFile.name} (${this.formatSize(this.selectedFile.size)})
                ${e.isUploading?"":J`
                  <button class="btn" style="margin-left: 8px; padding: 2px 8px; height: auto;" @click=${()=>this.removeSelectedFile()}>Remove</button>
                `}
              </div>
            `:""}
          </div>
          <div class="field">
            <label>VM name *</label>
            <input
              type="text"
              .value=${this.uploadMetadata.vm_name}
              @input=${e=>this.uploadMetadata.vm_name=e.target.value}
              ?disabled=${e.isUploading}
              placeholder="Name of the VM this backup belongs to"
            />
          </div>
          <div class="field">
            <label>VM UUID (optional)</label>
            <input
              type="text"
              .value=${this.uploadMetadata.vm_uuid}
              @input=${e=>this.uploadMetadata.vm_uuid=e.target.value}
              ?disabled=${e.isUploading}
              placeholder="UUID of the VM (if known)"
            />
          </div>
          <div class="field">
            <label>Type</label>
            <select
              .value=${this.uploadMetadata.backup_type}
              @change=${e=>this.uploadMetadata.backup_type=e.target.value}
              ?disabled=${e.isUploading}
            >
              <option value="full">Full</option>
              <option value="incremental">Incremental</option>
              <option value="differential">Differential</option>
            </select>
          </div>
          <div class="field">
            <label>Compression</label>
            <select
              .value=${this.uploadMetadata.compression}
              @change=${e=>this.uploadMetadata.compression=e.target.value}
              ?disabled=${e.isUploading}
            >
              <option value="none">None</option>
              <option value="gzip">gzip</option>
              <option value="bzip2">bzip2</option>
              <option value="zstd">zstd</option>
              <option value="xz">xz</option>
            </select>
          </div>
          <div class="field">
            <label>Encryption</label>
            <select
              .value=${this.uploadMetadata.encryption}
              @change=${e=>this.uploadMetadata.encryption=e.target.value}
              ?disabled=${e.isUploading}
            >
              <option value="none">None</option>
              <option value="aes-256">AES-256</option>
              <option value="aes-128">AES-128</option>
            </select>
          </div>
          <div class="field">
            <label>Retention days</label>
            <input
              type="number"
              min="1"
              .value=${String(this.uploadMetadata.retention_days)}
              @input=${e=>this.uploadMetadata.retention_days=Number(e.target.value)}
              ?disabled=${e.isUploading}
            />
          </div>
          <div class="field">
            <label>Description</label>
            <textarea
              .value=${this.uploadMetadata.description}
              @input=${e=>this.uploadMetadata.description=e.target.value}
              ?disabled=${e.isUploading}
            ></textarea>
          </div>
          ${e.isUploading||this.isPaused?J`
            <div style="margin-top: 16px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span>Upload progress</span>
                <span>${e.uploadProgress}%</span>
              </div>
              <div style="height: 8px; background: var(--vscode-input-background); border-radius: 4px; overflow: hidden;">
                <div style="height: 100%; width: ${e.uploadProgress}%; background: var(--vscode-accent, #007acc); transition: width 0.3s;"></div>
              </div>
              <div style="display: flex; gap: 8px; margin-top: 12px;">
                ${e.isUploading?J`
                  <button class="btn" @click=${()=>this.pauseUpload()}>Pause</button>
                `:J`
                  <button class="btn btn-primary" @click=${()=>this.resumeUpload()}>Resume</button>
                `}
                <button class="btn btn-danger" @click=${()=>this.cancelUpload()}>Cancel</button>
              </div>
            </div>
          `:""}
        </div>
        <div class="drawer-footer">
          <button class="btn" @click=${()=>this.closeUploadDrawer()} ?disabled=${e.isUploading}>Cancel</button>
          <button
            class="btn btn-primary"
            @click=${()=>this.handleUpload()}
            ?disabled=${e.isUploading||!this.selectedFile||!this.uploadMetadata.vm_name.trim()}
          >
            ${e.isUploading?"Uploading...":"Upload"}
          </button>
        </div>
      </detail-drawer>
    `}renderRestoreModal(){if(!this.restoreTarget)return J``;const e=!this.vmExists(this.restoreTarget);return J`
      <modal-dialog
        .open=${this.showRestore}
        .title=${"Restore backup"}
        size="medium"
        @modal-close=${()=>this.showRestore=!1}
      >
        ${e?J`<div class="chip warn">Source VM not found; restore will create a new VM.</div>`:J`<div class="field checkbox">
              <input
                type="checkbox"
                .checked=${this.restoreOverwrite}
                @change=${e=>this.restoreOverwrite=e.target.checked}
              />
              <label>Overwrite existing VM</label>
            </div>`}
        <div class="field">
          <label>New VM name</label>
          <input
            type="text"
            .value=${this.restoreNewName}
            @input=${e=>this.restoreNewName=e.target.value}
            ?disabled=${!e&&this.restoreOverwrite}
          />
        </div>
        ${this.restoreTarget.encryption&&"none"!==this.restoreTarget.encryption?J`<div class="field">
              <label>Decryption key</label>
              <input
                type="password"
                .value=${this.restoreKey}
                @input=${e=>this.restoreKey=e.target.value}
              />
            </div>`:""}
        <div slot="footer" style="display:flex; gap:8px; justify-content:flex-end;">
          <button class="btn" @click=${()=>this.showRestore=!1}>Cancel</button>
          <button class="btn btn-primary" @click=${()=>this.confirmRestore()}>Restore</button>
        </div>
      </modal-dialog>
    `}renderDeleteModal(){return J`
      <modal-dialog
        .open=${this.showDeleteModal}
        .title=${"Delete Backup"}
        size="small"
        @modal-close=${()=>this.showDeleteModal=!1}
      >
        <div style="padding: 8px 0;">
          <p style="margin-top: 0">Are you sure you want to delete this backup?</p>
          ${this.deleteTarget?J`
            <div style="font-family: monospace; background: var(--vscode-textCodeBlock-background, rgba(255,255,255,0.05)); padding: 8px; border-radius: 4px; margin: 12px 0;">
              ${this.deleteTarget.backup_id} 
              ${this.deleteTarget.vm_name?J`<br><span style="opacity:0.7">VM: ${this.deleteTarget.vm_name}</span>`:""}
              ${this.deleteTarget.started_at?J`<br><span style="opacity:0.7">Created: ${this.formatDate(this.deleteTarget.started_at)}</span>`:""}
            </div>
          `:""}
          <p style="margin-bottom: 0; color: var(--vscode-errorForeground, #f48771);">This action cannot be undone.</p>
        </div>
        <div slot="footer" style="display: flex; gap: 8px; justify-content: flex-end;">
          <button class="btn" @click=${()=>this.showDeleteModal=!1} ?disabled=${!!this.deletingId}>Cancel</button>
          <button class="btn btn-danger" @click=${()=>this.confirmDelete()} ?disabled=${!!this.deletingId}>
            ${this.deletingId?"Deleting...":"Delete"}
          </button>
        </div>
      </modal-dialog>
    `}};qx.styles=g`
    :host { display: block; height: 100%; }
    .page { padding: 16px; color: var(--vscode-foreground, #e5e7eb); }
    .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
    .title { font-size: 20px; margin: 0; }
    .controls { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; margin-bottom: 12px; }
    .filters { display: flex; gap: 8px; align-items: center; }
    .filters select { 
      height: 36px; 
      padding: 8px 32px 8px 12px; 
      border-radius: 4px; 
      border: 1px solid var(--vscode-input-border, #3c3c3c); 
      background: var(--vscode-input-background, #3c3c3c); 
      color: var(--vscode-input-foreground, #cccccc); 
      font-size: 13px;
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23cccccc' d='M2 4l4 4 4-4z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
    }
    .filters select:focus { outline: none; border-color: var(--vscode-focusBorder, #007acc); box-shadow: 0 0 0 1px var(--vscode-focusBorder, #007acc); }
    .actions { display: flex; gap: 8px; align-items: center; }
    .btn { height: 36px; padding: 0 16px; border-radius: 4px; border: 1px solid var(--vscode-border, #464647); background: var(--vscode-bg-lighter, #2d2d30); color: var(--vscode-text, #cccccc); cursor: pointer; font-size: 13px; font-weight: 500; display: inline-flex; align-items: center; gap: 6px; transition: all 0.2s; }
    .btn:hover:not([disabled]) { background: var(--surface-3, #3e3e42); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-primary { background: var(--vscode-accent, #007acc); color: #ffffff; border-color: var(--vscode-accent, #007acc); }
    .btn-primary:hover:not([disabled]) { background: var(--vscode-accent-hover, #1a86d9); border-color: var(--vscode-accent-hover, #1a86d9); }
    .btn-danger { background: #a4262c; border-color: #a4262c; color: #ffffff; }
    .btn-danger:hover:not([disabled]) { background: #c42b32; border-color: #c42b32; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px 10px; border-bottom: 1px solid var(--vscode-border); text-align: left; font-size: 13px; }
    th { color: var(--vscode-descriptionForeground, #9ca3af); font-weight: 600; }
    tr:hover td { background: rgba(255,255,255,0.02); }
    .chip { display: inline-flex; align-items: center; gap: 6px; padding: 4px 8px; border-radius: 999px; background: #1f2937; color: #e5e7eb; font-size: 12px; }
    .chip.warn { background: #92400e; }
    .chip.missing { background: #78350f; }
    .empty { text-align: center; padding: 48px 0; color: var(--vscode-descriptionForeground, #9ca3af); }
    dialog, detail-drawer { color: var(--vscode-foreground, #e5e7eb); }
    .field { display: flex; flex-direction: column; gap: 6px; margin-bottom: 14px; }
    .field.checkbox { flex-direction: row; align-items: center; gap: 12px; }
    .field.checkbox input[type="checkbox"] { width: auto; margin: 0; }
    .field label { color: var(--vscode-foreground, #cccccc); font-size: 13px; font-weight: 500; }
    .field input, .field select, .field textarea { width: 100%; padding: 8px 12px; border-radius: 4px; border: 1px solid var(--vscode-input-border, #3c3c3c); background: var(--vscode-input-background, #3c3c3c); color: var(--vscode-input-foreground, #cccccc); font-size: 13px; font-family: inherit; box-sizing: border-box; transition: all 0.2s; }
    .field input:focus, .field select:focus, .field textarea:focus { outline: none; border-color: var(--vscode-focusBorder, #007acc); box-shadow: 0 0 0 1px var(--vscode-focusBorder, #007acc); }
    .field select { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23cccccc' d='M2 4l4 4 4-4z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 36px; }
    .field textarea { resize: vertical; min-height: 60px; }
    .drawer-content { padding: 16px; }
    .drawer-footer { display: flex; gap: 8px; justify-content: flex-end; padding: 12px 16px; border-top: 1px solid var(--vscode-border, #464647); }
    .toast { margin-bottom: 10px; padding: 10px; border-radius: 8px; }
    .toast.success { background: #0f172a; color: #bbf7d0; border: 1px solid #14532d; }
    .toast.error { background: #1f0f0f; color: #fecdd3; border: 1px solid #7f1d1d; }
  `,Wx([xe()],qx.prototype,"backups",2),Wx([xe()],qx.prototype,"loading",2),Wx([xe()],qx.prototype,"error",2),Wx([xe()],qx.prototype,"search",2),Wx([xe()],qx.prototype,"status",2),Wx([xe()],qx.prototype,"type",2),Wx([xe()],qx.prototype,"toast",2),Wx([xe()],qx.prototype,"showImportDrawer",2),Wx([xe()],qx.prototype,"showCreateDrawer",2),Wx([xe()],qx.prototype,"showRestore",2),Wx([xe()],qx.prototype,"restoreTarget",2),Wx([xe()],qx.prototype,"restoreNewName",2),Wx([xe()],qx.prototype,"restoreOverwrite",2),Wx([xe()],qx.prototype,"restoreKey",2),Wx([xe()],qx.prototype,"deletingId",2),Wx([xe()],qx.prototype,"downloadingId",2),Wx([xe()],qx.prototype,"missingFiles",2),Wx([xe()],qx.prototype,"showDeleteModal",2),Wx([xe()],qx.prototype,"deleteTarget",2),Wx([xe()],qx.prototype,"showUploadDrawer",2),Wx([xe()],qx.prototype,"selectedFile",2),Wx([xe()],qx.prototype,"uploadUrl",2),Wx([xe()],qx.prototype,"uploadId",2),Wx([xe()],qx.prototype,"isPaused",2),qx=Wx([ve("virtualization-backups")],qx);var Kx=Object.defineProperty,Gx=Object.getOwnPropertyDescriptor,Qx=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Gx(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Kx(t,s,r),r};let Jx=class extends me{constructor(){super(...arguments),this.subRoute=null,this.activeView="vms"}connectedCallback(){super.connectedCallback(),this.updateActiveView()}updated(e){super.updated(e),e.has("subRoute")&&this.updateActiveView()}updateActiveView(){if(this.subRoute){["vms","storage-pools","networks","iso-images","volumes","backups"].includes(this.subRoute)&&(this.activeView=this.subRoute)}else{const e=window.location.pathname;if(e.includes("/virtualization/")){const t=e.split("/virtualization/")[1]?.split("/")[0];t&&["vms","storage-pools","networks","iso-images","volumes","backups"].includes(t)&&(this.activeView=t)}}}render(){return J`
      <div class="virtualization-container">
        <div class="view-container">
          ${this.renderActiveView()}
        </div>
      </div>
    `}renderActiveView(){switch(this.activeView){case"vms":return J`<virtualization-vms-enhanced></virtualization-vms-enhanced>`;case"storage-pools":return J`<virtualization-storage-pools></virtualization-storage-pools>`;case"networks":return J`<virtualization-networks></virtualization-networks>`;case"iso-images":return J`<iso-management></iso-management>`;case"volumes":return J`<virtualization-volumes></virtualization-volumes>`;case"backups":return J`<virtualization-backups></virtualization-backups>`;default:return J`
          <div class="error-message">
            <h2>Invalid Virtualization View</h2>
            <p>The requested view "${this.activeView}" is not available.</p>
          </div>
        `}}};Jx.styles=g`
    :host {
      display: block;
      height: 100%;
      width: 100%;
    }

    .virtualization-container {
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .view-container {
      flex: 1;
      overflow: hidden;
    }

    .error-message {
      text-align: center;
      padding: 40px;
      color: var(--text-secondary);
    }
  `,Qx([we({type:String})],Jx.prototype,"subRoute",2),Qx([we({type:String})],Jx.prototype,"activeView",2),Jx=Qx([ve("virtualization-tab")],Jx);class Yx{static async listPlaybooks(){return pc.get("/ansible/playbooks")}static async getPlaybook(e){return pc.get(`/ansible/playbooks/${encodeURIComponent(e)}`)}static async uploadPlaybook(e){const t=btoa(e.content);return pc.post("/ansible/playbooks/upload",{...e,content:t})}static async deletePlaybook(e){return pc.delete(`/ansible/playbooks/${encodeURIComponent(e)}`)}static async validatePlaybook(e){return pc.post("/ansible/playbooks/validate",{name:e})}static async runPlaybook(e){return pc.post("/ansible/playbooks/run",e)}static async downloadFromUrl(e,t){return pc.post("/ansible/playbooks/from-url",{url:e,name:t})}static async listTemplates(){return pc.get("/ansible/playbooks/templates")}static async createFromTemplate(e){return pc.post("/ansible/playbooks/from-template",e)}static async syncFromGit(e){return pc.post("/ansible/playbooks/sync-git",e)}static async installFromGalaxy(e){return pc.post("/ansible/playbooks/from-galaxy",e)}static async runAdHoc(e){return pc.post("/ansible/adhoc",e)}static async listExecutions(e,t,s){const i={};return e&&(i.status=e),t&&(i.type=t),s&&(i.limit=s),pc.get("/ansible/executions",i)}static async getExecution(e){return pc.get(`/ansible/executions/${e}`)}static async cancelExecution(e){return pc.delete(`/ansible/executions/${e}`)}static createExecutionStream(e,t,s,i){const o=new gc(`/api/v1/ansible/executions/${e}/stream`);return o.on("message",e=>{try{"string"==typeof e?t({type:"output",content:e,time:Date.now()}):e.type&&(t(e),"complete"===e.type&&i&&i())}catch(o){console.error("Error parsing execution stream message:",o),s&&s(o)}}),s&&o.on("error",e=>s(e)),o.on("close",()=>{i&&i()}),o}static async getDynamicInventory(){return pc.get("/ansible/inventory/dynamic")}static async saveInventory(e){return pc.post("/ansible/inventory",e)}static async getInventory(e){return pc.get(`/ansible/inventory/${encodeURIComponent(e)}`)}static async listSchedules(){return pc.get("/ansible/schedules")}static async createSchedule(e){return pc.post("/ansible/schedules",e)}static async deleteSchedule(e){return pc.delete(`/ansible/schedules/${e}`)}static encodePlaybookContent(e){return btoa(unescape(encodeURIComponent(e)))}static decodePlaybookContent(e){return decodeURIComponent(escape(atob(e)))}static formatDuration(e){if(!e)return"0s";const t=Math.floor(e/3600),s=Math.floor(e%3600/60),i=e%60,o=[];return t>0&&o.push(`${t}h`),s>0&&o.push(`${s}m`),(i>0||0===o.length)&&o.push(`${i}s`),o.join(" ")}static formatHostSummary(e){if(!e)return"No hosts";const t=[];return e.ok>0&&t.push(`${e.ok} ok`),e.changed>0&&t.push(`${e.changed} changed`),e.failed>0&&t.push(`${e.failed} failed`),e.unreachable>0&&t.push(`${e.unreachable} unreachable`),e.skipped>0&&t.push(`${e.skipped} skipped`),t.length>0?t.join(", "):"No tasks"}static parsePlaybookMetadata(e){try{const t=e.split("\n");let s,i,o=0,r=0;for(const e of t){const t=e.trim();t.startsWith("- name:")?(0===r&&(s=t.substring(7).trim().replace(/['"]/g,"")),r++):t.startsWith("hosts:")?i||(i=t.substring(6).trim().replace(/['"]/g,"")):t.startsWith("- name:")&&r>0&&o++}return{name:s,hosts:i,tasks:o,plays:r}}catch(t){return console.error("Error parsing playbook metadata:",t),{}}}}var Xx=Object.defineProperty,Zx=Object.getOwnPropertyDescriptor,e_=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?Zx(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Xx(t,s,r),r};let t_=class extends me{constructor(){super(...arguments),this.open=!1,this.mode="create",this.name="",this.content="",this.loading=!1,this.validating=!1,this.saving=!1}willUpdate(e){e.has("open")&&(this.open?Promise.resolve().then(()=>this.loadPlaybook()):this.reset()),e.has("playbookName")&&this.open&&Promise.resolve().then(()=>this.loadPlaybook())}async loadPlaybook(){if("edit"===this.mode&&this.playbookName){this.loading=!0,this.error=void 0;try{const e=await Yx.getPlaybook(this.playbookName);this.name=e.playbook.name,this.content=e.playbook.content}catch(e){console.error("Failed to load playbook:",e),this.error=e instanceof Error?e.message:"Failed to load playbook"}finally{this.loading=!1}}else"create"===this.mode&&(this.name="",this.content='---\n- name: My Playbook\n  hosts: all\n  become: yes\n  \n  tasks:\n    - name: Example task\n      debug:\n        msg: "Hello from Ansible!"\n')}reset(){this.name="",this.content="",this.validationResult=void 0,this.error=void 0,this.loading=!1,this.validating=!1,this.saving=!1}async validatePlaybook(){if(this.name&&this.content){this.validating=!0,this.error=void 0;try{const e="edit"===this.mode?this.name:`_temp_${Date.now()}.yml`;await Yx.uploadPlaybook({name:e,content:this.content,overwrite:!0});const t=await Yx.validatePlaybook(e);this.validationResult=t,"create"===this.mode&&await Yx.deletePlaybook(e).catch(()=>{})}catch(e){console.error("Validation failed:",e),this.error=e instanceof Error?e.message:"Validation failed"}finally{this.validating=!1}}else this.error="Playbook name and content are required"}async save(){if(this.name&&this.content){this.name.endsWith(".yml")||this.name.endsWith(".yaml")||(this.name+=".yml"),this.saving=!0,this.error=void 0;try{await Yx.uploadPlaybook({name:this.name,content:this.content,overwrite:"edit"===this.mode}),this.dispatchEvent(new CustomEvent("save",{detail:{name:this.name,mode:this.mode}})),this.close()}catch(e){console.error("Save failed:",e),this.error=e instanceof Error?e.message:"Failed to save playbook"}finally{this.saving=!1}}else this.error="Playbook name and content are required"}close(){this.dispatchEvent(new CustomEvent("close")),this.open=!1}handleKeyDown(e){if("Tab"===e.key){e.preventDefault();const t=e.target,s=t.selectionStart,i=t.selectionEnd,o=t.value;t.value=o.substring(0,s)+"  "+o.substring(i),t.selectionStart=t.selectionEnd=s+2,this.content=t.value}}render(){return J`
      <div class="modal">
        <div class="header">
          <div class="title">
            ${"create"===this.mode?"Create New Playbook":"Edit Playbook"}
          </div>
          <button class="close-button" @click=${this.close}>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 8.707l3.646 3.647.708-.707L8.707 8l3.647-3.646-.707-.708L8 7.293 4.354 3.646l-.707.708L7.293 8l-3.647 3.646.708.707L8 8.707z"/>
            </svg>
          </button>
        </div>

        <div class="body">
          ${this.loading?J`
            <div class="loading-text">Loading playbook...</div>
          `:J`
            ${this.error?J`
              <div class="error-message">
                <strong>Error:</strong> ${this.error}
              </div>
            `:""}

            ${"create"===this.mode?J`
              <div class="template-hint">
                ð¡ Tip: Start with the template below or paste your own YAML content. 
                Use Tab for indentation (2 spaces).
              </div>
            `:""}

            <div class="form-group">
              <label class="form-label" for="playbook-name">
                Playbook Name
              </label>
              <input
                id="playbook-name"
                class="form-input"
                type="text"
                .value=${this.name}
                @input=${e=>this.name=e.target.value}
                placeholder="my-playbook.yml"
                ?disabled=${"edit"===this.mode}
              />
            </div>

            <div class="editor-container">
              <div class="editor-label">
                <span>Playbook Content (YAML)</span>
                ${this.validationResult?J`
                  <span class="validation-result ${this.validationResult.valid?"valid":"invalid"}">
                    ${this.validationResult.valid?"â Valid syntax":"â Invalid syntax"}
                  </span>
                `:""}
              </div>
              <textarea
                class="editor"
                .value=${this.content}
                @input=${e=>this.content=e.target.value}
                @keydown=${this.handleKeyDown}
                placeholder="---\n- name: My Playbook\n  hosts: all\n  tasks:\n    - name: Example task\n      debug:\n        msg: 'Hello!'"
                spellcheck="false"
              ></textarea>
              ${this.validationResult&&!this.validationResult.valid&&this.validationResult.errors?J`
                <div class="validation-errors">
                  ${this.validationResult.errors.map(e=>J`
                    <div class="validation-error">â¢ ${e}</div>
                  `)}
                </div>
              `:""}
            </div>
          `}
        </div>

        <div class="footer">
          <div class="footer-info">
            ${this.content?J`
              <span>${this.content.split("\n").length} lines</span>
              <span>${this.content.length} characters</span>
            `:""}
          </div>
          <div class="footer-actions">
            <button 
              class="button secondary" 
              @click=${this.validatePlaybook}
              ?disabled=${this.loading||this.validating||!this.content}
            >
              ${this.validating?"Validating...":"Validate"}
            </button>
            <button 
              class="button" 
              @click=${this.save}
              ?disabled=${this.loading||this.saving||!this.name||!this.content}
            >
              ${this.saving?"Saving...":"create"===this.mode?"Create":"Save"}
            </button>
          </div>
        </div>
      </div>
    `}};t_.styles=g`
    :host {
      display: block;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    :host([open]) {
      opacity: 1;
      pointer-events: auto;
    }

    .modal {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 900px;
      height: 80vh;
      background: var(--vscode-editor-background, #1e1e1e);
      border: 1px solid var(--vscode-panel-border, #2d2d30);
      border-radius: 8px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      display: flex;
      flex-direction: column;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      border-bottom: 1px solid var(--vscode-panel-border, #2d2d30);
      background: var(--vscode-titleBar-activeBackground, #3c3c3c);
    }

    .title {
      font-size: 16px;
      font-weight: 500;
      color: var(--vscode-titleBar-activeForeground, #cccccc);
    }

    .close-button {
      background: none;
      border: none;
      color: var(--vscode-icon-foreground, #c5c5c5);
      cursor: pointer;
      padding: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: background-color 0.2s;
    }

    .close-button:hover {
      background: var(--vscode-toolbar-hoverBackground, rgba(90, 93, 94, 0.31));
    }

    .body {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      padding: 16px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      color: var(--vscode-foreground, #cccccc);
      font-size: 13px;
    }

    .form-input {
      width: 100%;
      padding: 8px 12px;
      background: var(--vscode-input-background, #3c3c3c);
      color: var(--vscode-input-foreground, #cccccc);
      border: 1px solid var(--vscode-input-border, #3c3c3c);
      border-radius: 4px;
      font-size: 13px;
      font-family: var(--vscode-font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
    }

    .form-input:focus {
      outline: none;
      border-color: var(--vscode-focusBorder, #007acc);
    }

    .editor-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .editor-label {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      color: var(--vscode-foreground, #cccccc);
      font-size: 13px;
    }

    .editor {
      flex: 1;
      width: 100%;
      padding: 12px;
      background: var(--vscode-editor-background, #1e1e1e);
      color: var(--vscode-editor-foreground, #d4d4d4);
      border: 1px solid var(--vscode-panel-border, #2d2d30);
      border-radius: 4px;
      font-family: var(--vscode-editor-font-family, 'Courier New', monospace);
      font-size: 13px;
      line-height: 1.6;
      resize: none;
      tab-size: 2;
      overflow: auto;
    }

    .editor:focus {
      outline: none;
      border-color: var(--vscode-focusBorder, #007acc);
    }

    .validation-result {
      margin-top: 8px;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 12px;
    }

    .validation-result.valid {
      background: var(--vscode-inputValidation-infoBackground, rgba(67, 160, 71, 0.1));
      border: 1px solid var(--vscode-inputValidation-infoBorder, #43a047);
      color: var(--vscode-inputValidation-infoForeground, #43a047);
    }

    .validation-result.invalid {
      background: var(--vscode-inputValidation-errorBackground, rgba(244, 135, 113, 0.1));
      border: 1px solid var(--vscode-inputValidation-errorBorder, #f48771);
      color: var(--vscode-errorForeground, #f48771);
    }

    .validation-errors {
      margin-top: 4px;
      font-size: 12px;
    }

    .validation-error {
      margin: 2px 0;
    }

    .footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      border-top: 1px solid var(--vscode-panel-border, #2d2d30);
    }

    .footer-info {
      display: flex;
      align-items: center;
      gap: 16px;
      color: var(--vscode-descriptionForeground, #8b8b8b);
      font-size: 12px;
    }

    .footer-actions {
      display: flex;
      gap: 8px;
    }

    .button {
      padding: 8px 16px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: background-color 0.2s;
    }

    .button:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }

    .button.secondary {
      background: var(--vscode-button-secondaryBackground, #3a3d41);
      color: var(--vscode-button-secondaryForeground, #cccccc);
    }

    .button.secondary:hover {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
    }

    .button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .loading-text {
      color: var(--vscode-descriptionForeground, #8b8b8b);
      font-size: 12px;
    }

    .error-message {
      padding: 8px 12px;
      background: var(--vscode-inputValidation-errorBackground, rgba(244, 135, 113, 0.1));
      border: 1px solid var(--vscode-inputValidation-errorBorder, #f48771);
      color: var(--vscode-errorForeground, #f48771);
      border-radius: 4px;
      margin-bottom: 16px;
      font-size: 13px;
    }

    .template-hint {
      padding: 8px 12px;
      background: var(--vscode-textBlockQuote-background, rgba(127, 127, 127, 0.1));
      border-left: 3px solid var(--vscode-textBlockQuote-border, #007acc);
      margin-bottom: 16px;
      font-size: 12px;
      color: var(--vscode-textBlockQuote-foreground, #cccccc);
    }

    pre {
      margin: 0;
      white-space: pre-wrap;
    }
  `,e_([we({type:Boolean})],t_.prototype,"open",2),e_([we({type:String})],t_.prototype,"playbookName",2),e_([we({type:String})],t_.prototype,"mode",2),e_([xe()],t_.prototype,"name",2),e_([xe()],t_.prototype,"content",2),e_([xe()],t_.prototype,"loading",2),e_([xe()],t_.prototype,"validating",2),e_([xe()],t_.prototype,"saving",2),e_([xe()],t_.prototype,"validationResult",2),e_([xe()],t_.prototype,"error",2),t_=e_([ve("playbook-editor-modal")],t_);var s_=Object.defineProperty,i_=Object.getOwnPropertyDescriptor,o_=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?i_(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&s_(t,s,r),r};let r_=class extends me{constructor(){super(...arguments),this.open=!1,this.playbookName="",this.inventory="localhost",this.limit="",this.tags="",this.skipTags="",this.extraVars="",this.check=!1,this.diff=!1,this.verbose=0,this.become=!1,this.becomeUser="root",this.privateKey="",this.timeout=10,this.forks=5,this.running=!1,this.showAdvanced=!1}updated(e){e.has("open")&&(this.open||this.reset())}reset(){this.inventory="localhost",this.limit="",this.tags="",this.skipTags="",this.extraVars="",this.check=!1,this.diff=!1,this.verbose=0,this.become=!1,this.becomeUser="root",this.privateKey="",this.timeout=10,this.forks=5,this.error=void 0,this.running=!1,this.showAdvanced=!1}async run(){this.running=!0,this.error=void 0;try{let e;if(this.extraVars.trim())try{e=JSON.parse(this.extraVars)}catch{e={};const t=this.extraVars.split("\n");for(const s of t){const t=s.trim();if(t&&t.includes("=")){const[s,...i]=t.split("=");s&&(e[s.trim()]=i.join("=").trim())}}}const t={playbook:this.playbookName,inventory:this.inventory||void 0,limit:this.limit||void 0,tags:this.tags?this.tags.split(",").map(e=>e.trim()):void 0,skip_tags:this.skipTags?this.skipTags.split(",").map(e=>e.trim()):void 0,extra_vars:e,check:this.check,diff:this.diff,verbose:this.verbose,become:this.become,become_user:this.become?this.becomeUser:void 0,private_key:this.privateKey||void 0,timeout:this.timeout,forks:this.forks},s=await Yx.runPlaybook(t);this.dispatchEvent(new CustomEvent("run",{detail:{executionId:s.execution_id,status:s.status,streamUrl:s.stream_url}})),this.close()}catch(e){console.error("Failed to run playbook:",e),this.error=e instanceof Error?e.message:"Failed to run playbook"}finally{this.running=!1}}close(){this.dispatchEvent(new CustomEvent("close")),this.open=!1}render(){return J`
      <div class="modal">
        <div class="header">
          <div class="title">
            Run Playbook: <span class="playbook-name">${this.playbookName}</span>
          </div>
          <button class="close-button" @click=${this.close}>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 8.707l3.646 3.647.708-.707L8.707 8l3.647-3.646-.707-.708L8 7.293 4.354 3.646l-.707.708L7.293 8l-3.647 3.646.708.707L8 8.707z"/>
            </svg>
          </button>
        </div>

        <div class="body">
          ${this.error?J`
            <div class="error-message">
              <strong>Error:</strong> ${this.error}
            </div>
          `:""}

          <div class="section">
            <div class="section-title">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 4v5l3.5 2.1-.6 1L7 9.8V4h1z"/>
                <path d="M8 1a7 7 0 100 14A7 7 0 008 1zm0 1a6 6 0 110 12A6 6 0 018 2z"/>
              </svg>
              Basic Configuration
            </div>

            <div class="form-group">
              <label class="form-label" for="inventory">Inventory</label>
              <input
                id="inventory"
                class="form-input"
                type="text"
                .value=${this.inventory}
                @input=${e=>this.inventory=e.target.value}
                placeholder="localhost, production, or path to inventory file"
              />
              <div class="form-hint">Specify inventory hosts or file</div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="limit">Limit Hosts</label>
                <input
                  id="limit"
                  class="form-input"
                  type="text"
                  .value=${this.limit}
                  @input=${e=>this.limit=e.target.value}
                  placeholder="webservers, host1, *.example.com"
                />
                <div class="form-hint">Pattern to limit execution</div>
              </div>

              <div class="form-group">
                <label class="form-label" for="tags">Tags</label>
                <input
                  id="tags"
                  class="form-input"
                  type="text"
                  .value=${this.tags}
                  @input=${e=>this.tags=e.target.value}
                  placeholder="deploy, config, update"
                />
                <div class="form-hint">Comma-separated tags to run</div>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label" for="extra-vars">Extra Variables</label>
              <textarea
                id="extra-vars"
                class="form-textarea"
                .value=${this.extraVars}
                @input=${e=>this.extraVars=e.target.value}
                placeholder='{"app_version": "1.0.0", "env": "production"}
or
app_version=1.0.0
env=production'
              ></textarea>
              <div class="form-hint">JSON object or key=value pairs</div>
            </div>

            <div class="form-row">
              <label class="form-checkbox">
                <input
                  type="checkbox"
                  .checked=${this.check}
                  @change=${e=>this.check=e.target.checked}
                />
                <span>Check mode (dry run)</span>
              </label>

              <label class="form-checkbox">
                <input
                  type="checkbox"
                  .checked=${this.diff}
                  @change=${e=>this.diff=e.target.checked}
                />
                <span>Show differences</span>
              </label>
            </div>
          </div>

          <button class="toggle-advanced" @click=${()=>this.showAdvanced=!this.showAdvanced}>
            <svg class="chevron ${this.showAdvanced?"expanded":""}" width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
              <path d="M6 4l4 4-4 4z"/>
            </svg>
            Advanced Options
          </button>

          ${this.showAdvanced?J`
            <div class="collapsible">
              <div class="section">
                <div class="section-title">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M14 5H8V3h6v2zm0 3H8v2h6V8zM14 13H8v2h6v-2zM2 7h4v6H2V7z"/>
                  </svg>
                  Advanced Configuration
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label" for="verbose">Verbosity Level</label>
                    <select
                      id="verbose"
                      class="form-select"
                      .value=${String(this.verbose)}
                      @change=${e=>this.verbose=Number(e.target.value)}
                    >
                      <option value="0">Normal</option>
                      <option value="1">Verbose (-v)</option>
                      <option value="2">More Verbose (-vv)</option>
                      <option value="3">Debug (-vvv)</option>
                      <option value="4">Connection Debug (-vvvv)</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label class="form-label" for="forks">Parallel Processes</label>
                    <input
                      id="forks"
                      class="form-input"
                      type="number"
                      min="1"
                      max="100"
                      .value=${String(this.forks)}
                      @input=${e=>this.forks=Number(e.target.value)}
                    />
                  </div>
                </div>

                <div class="form-row">
                  <label class="form-checkbox">
                    <input
                      type="checkbox"
                      .checked=${this.become}
                      @change=${e=>this.become=e.target.checked}
                    />
                    <span>Enable privilege escalation (become)</span>
                  </label>

                  <div class="form-group">
                    <label class="form-label" for="become-user">Become User</label>
                    <input
                      id="become-user"
                      class="form-input"
                      type="text"
                      .value=${this.becomeUser}
                      @input=${e=>this.becomeUser=e.target.value}
                      ?disabled=${!this.become}
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label" for="timeout">Connection Timeout (seconds)</label>
                    <input
                      id="timeout"
                      class="form-input"
                      type="number"
                      min="1"
                      .value=${String(this.timeout)}
                      @input=${e=>this.timeout=Number(e.target.value)}
                    />
                  </div>

                  <div class="form-group">
                    <label class="form-label" for="skip-tags">Skip Tags</label>
                    <input
                      id="skip-tags"
                      class="form-input"
                      type="text"
                      .value=${this.skipTags}
                      @input=${e=>this.skipTags=e.target.value}
                      placeholder="backup, cleanup"
                    />
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label" for="private-key">SSH Private Key Path</label>
                  <input
                    id="private-key"
                    class="form-input"
                    type="text"
                    .value=${this.privateKey}
                    @input=${e=>this.privateKey=e.target.value}
                    placeholder="/home/user/.ssh/id_rsa"
                  />
                  <div class="form-hint">Path to SSH private key file</div>
                </div>
              </div>
            </div>
          `:""}
        </div>

        <div class="footer">
          <div class="footer-info">
            ${this.check?J`<span>ð Check mode enabled</span>`:""}
            ${this.diff?J`<span>ð Diff mode enabled</span>`:""}
          </div>
          <div class="footer-actions">
            <button class="button secondary" @click=${this.close}>
              Cancel
            </button>
            <button 
              class="button" 
              @click=${this.run}
              ?disabled=${this.running}
            >
              ${this.running?"Starting...":"Run Playbook"}
            </button>
          </div>
        </div>
      </div>
    `}};r_.styles=g`
    :host {
      display: block;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    :host([open]) {
      opacity: 1;
      pointer-events: auto;
    }

    .modal {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 700px;
      max-height: 90vh;
      background: var(--vscode-editor-background, #1e1e1e);
      border: 1px solid var(--vscode-panel-border, #2d2d30);
      border-radius: 8px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      display: flex;
      flex-direction: column;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      border-bottom: 1px solid var(--vscode-panel-border, #2d2d30);
      background: var(--vscode-titleBar-activeBackground, #3c3c3c);
    }

    .title {
      font-size: 16px;
      font-weight: 500;
      color: var(--vscode-titleBar-activeForeground, #cccccc);
    }

    .playbook-name {
      font-family: var(--vscode-editor-font-family, 'Courier New', monospace);
      color: var(--vscode-textLink-foreground, #3794ff);
    }

    .close-button {
      background: none;
      border: none;
      color: var(--vscode-icon-foreground, #c5c5c5);
      cursor: pointer;
      padding: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: background-color 0.2s;
    }

    .close-button:hover {
      background: var(--vscode-toolbar-hoverBackground, rgba(90, 93, 94, 0.31));
    }

    .body {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }

    .section {
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      margin-bottom: 6px;
      color: var(--vscode-foreground, #cccccc);
      font-size: 13px;
    }

    .form-hint {
      color: var(--vscode-descriptionForeground, #8b8b8b);
      font-size: 11px;
      margin-top: 4px;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 8px 12px;
      background: var(--vscode-input-background, #3c3c3c);
      color: var(--vscode-input-foreground, #cccccc);
      border: 1px solid var(--vscode-input-border, #3c3c3c);
      border-radius: 4px;
      font-size: 13px;
      font-family: var(--vscode-font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
    }

    .form-textarea {
      min-height: 60px;
      resize: vertical;
      font-family: var(--vscode-editor-font-family, 'Courier New', monospace);
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--vscode-focusBorder, #007acc);
    }

    .form-checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-checkbox input {
      width: 16px;
      height: 16px;
      cursor: pointer;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .error-message {
      padding: 8px 12px;
      background: var(--vscode-inputValidation-errorBackground, rgba(244, 135, 113, 0.1));
      border: 1px solid var(--vscode-inputValidation-errorBorder, #f48771);
      color: var(--vscode-errorForeground, #f48771);
      border-radius: 4px;
      margin-bottom: 16px;
      font-size: 13px;
    }

    .footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      border-top: 1px solid var(--vscode-panel-border, #2d2d30);
    }

    .footer-info {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--vscode-descriptionForeground, #8b8b8b);
      font-size: 12px;
    }

    .footer-actions {
      display: flex;
      gap: 8px;
    }

    .button {
      padding: 8px 16px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: background-color 0.2s;
    }

    .button:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }

    .button.secondary {
      background: var(--vscode-button-secondaryBackground, #3a3d41);
      color: var(--vscode-button-secondaryForeground, #cccccc);
    }

    .button.secondary:hover {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
    }

    .button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .collapsible {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid var(--vscode-panel-border, #2d2d30);
    }

    .toggle-advanced {
      background: none;
      border: none;
      color: var(--vscode-textLink-foreground, #3794ff);
      cursor: pointer;
      font-size: 12px;
      padding: 4px 0;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .toggle-advanced:hover {
      text-decoration: underline;
    }

    .chevron {
      transition: transform 0.2s;
    }

    .chevron.expanded {
      transform: rotate(90deg);
    }
  `,o_([we({type:Boolean})],r_.prototype,"open",2),o_([we({type:String})],r_.prototype,"playbookName",2),o_([xe()],r_.prototype,"inventory",2),o_([xe()],r_.prototype,"limit",2),o_([xe()],r_.prototype,"tags",2),o_([xe()],r_.prototype,"skipTags",2),o_([xe()],r_.prototype,"extraVars",2),o_([xe()],r_.prototype,"check",2),o_([xe()],r_.prototype,"diff",2),o_([xe()],r_.prototype,"verbose",2),o_([xe()],r_.prototype,"become",2),o_([xe()],r_.prototype,"becomeUser",2),o_([xe()],r_.prototype,"privateKey",2),o_([xe()],r_.prototype,"timeout",2),o_([xe()],r_.prototype,"forks",2),o_([xe()],r_.prototype,"running",2),o_([xe()],r_.prototype,"error",2),o_([xe()],r_.prototype,"showAdvanced",2),r_=o_([ve("playbook-run-modal")],r_);var a_=Object.defineProperty,n_=Object.getOwnPropertyDescriptor,l_=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?n_(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&a_(t,s,r),r};let c_=class extends me{constructor(){super(...arguments),this.show=!1,this.importType="upload",this.loading=!1,this.error="",this.templates=[],this.uploadName="",this.uploadOverwrite=!1,this.templateName="",this.templateVariables={},this.gitUrl="",this.gitBranch="main",this.gitPath="",this.gitAuthToken="",this.gitSshKey="",this.gitSyncAsSymlink=!1,this.urlSource="",this.urlName="",this.galaxyType="collection",this.galaxyName="",this.galaxyVersion="",this.galaxyRequirementsFile="",this.galaxyForce=!1}connectedCallback(){super.connectedCallback(),"template"===this.importType&&this.loadTemplates()}async loadTemplates(){try{const e=await Yx.listTemplates();this.templates=e.templates||[]}catch(e){console.error("Failed to load templates:",e),this.error="Failed to load templates"}}handleClose(){this.show=!1,this.error="",this.resetForm(),this.dispatchEvent(new CustomEvent("close",{bubbles:!0,composed:!0}))}resetForm(){this.uploadFile=void 0,this.uploadName="",this.uploadOverwrite=!1,this.templateName="",this.templateVariables={},this.selectedTemplate=void 0,this.gitUrl="",this.gitBranch="main",this.gitPath="",this.gitAuthToken="",this.gitSshKey="",this.gitSyncAsSymlink=!1,this.urlSource="",this.urlName="",this.galaxyType="collection",this.galaxyName="",this.galaxyVersion="",this.galaxyRequirementsFile="",this.galaxyForce=!1}async handleSubmit(){this.loading=!0,this.error="";try{switch(this.importType){case"upload":await this.handleUpload();break;case"template":await this.handleTemplate();break;case"git":await this.handleGit();break;case"url":await this.handleUrl();break;case"galaxy":await this.handleGalaxy()}this.dispatchEvent(new CustomEvent("import-complete",{bubbles:!0,composed:!0,detail:{type:this.importType}})),this.handleClose()}catch(e){console.error("Import failed:",e),this.error=e instanceof Error?e.message:"Import failed"}finally{this.loading=!1}}async handleUpload(){if(!this.uploadFile)throw new Error("Please select a file to upload");const e=await this.uploadFile.text(),t={name:this.uploadName||this.uploadFile.name,content:btoa(e),overwrite:this.uploadOverwrite};await Yx.uploadPlaybook(t)}async handleTemplate(){if(!this.selectedTemplate)throw new Error("Please select a template");if(!this.templateName)throw new Error("Please provide a name for the playbook");const e={template_id:this.selectedTemplate.id,name:this.templateName,variables:this.templateVariables};await Yx.createFromTemplate(e)}async handleGit(){if(!this.gitUrl)throw new Error("Git repository URL is required");const e={url:this.gitUrl,branch:this.gitBranch||void 0,path:this.gitPath||void 0,auth_token:this.gitAuthToken||void 0,ssh_key:this.gitSshKey||void 0,sync_as_symlink:this.gitSyncAsSymlink};await Yx.syncFromGit(e)}async handleUrl(){if(!this.urlSource)throw new Error("URL is required");if(!this.urlName)throw new Error("Playbook name is required");await Yx.downloadFromUrl(this.urlSource,this.urlName)}async handleGalaxy(){if(!this.galaxyName&&!this.galaxyRequirementsFile)throw new Error("Either name or requirements file is required");const e={type:this.galaxyType,name:this.galaxyName||"",version:this.galaxyVersion||void 0,requirements_file:this.galaxyRequirementsFile||void 0,force:this.galaxyForce};await Yx.installFromGalaxy(e)}handleFileSelect(e){const t=e.target;this.uploadFile=t.files?.[0]}renderUploadForm(){return J`
      <div class="info-message">
        Upload a YAML playbook file from your local machine.
      </div>

      <div class="form-group">
        <label class="form-label required">Select File</label>
        <div class="file-input-wrapper">
          <input
            type="file"
            class="file-input"
            id="file-input"
            accept=".yml,.yaml"
            @change=${this.handleFileSelect}
          />
          <label for="file-input" class="file-input-button">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M14 10v3.5a.5.5 0 01-.5.5h-11a.5.5 0 01-.5-.5V10a.5.5 0 00-1 0v3.5A1.5 1.5 0 002.5 15h11a1.5 1.5 0 001.5-1.5V10a.5.5 0 00-1 0z"/>
              <path d="M7.646 1.146a.5.5 0 01.708 0l3 3a.5.5 0 01-.708.708L8.5 2.707V11a.5.5 0 01-1 0V2.707L5.354 4.854a.5.5 0 11-.708-.708l3-3z"/>
            </svg>
            Choose File
          </label>
        </div>
        ${this.uploadFile?J`
          <div class="file-name">Selected: ${this.uploadFile.name}</div>
        `:""}
      </div>

      <div class="form-group">
        <label class="form-label">Playbook Name</label>
        <input
          type="text"
          class="form-input"
          .value=${this.uploadName}
          @input=${e=>this.uploadName=e.target.value}
          placeholder="Leave empty to use original filename"
        />
      </div>

      <div class="form-group">
        <label class="form-checkbox-group">
          <input
            type="checkbox"
            class="form-checkbox"
            .checked=${this.uploadOverwrite}
            @change=${e=>this.uploadOverwrite=e.target.checked}
          />
          <span>Overwrite if exists</span>
        </label>
      </div>
    `}renderTemplateForm(){return J`
      <div class="info-message">
        Create a new playbook from a pre-defined template.
      </div>

      <div class="form-group">
        <label class="form-label required">Select Template</label>
        <div class="template-grid">
          ${this.templates.map(e=>J`
            <div
              class="template-card ${this.selectedTemplate?.id===e.id?"selected":""}"
              @click=${()=>{this.selectedTemplate=e,this.templateVariables={}}}
            >
              <div class="template-name">${e.name}</div>
              <div class="template-description">${e.description}</div>
            </div>
          `)}
        </div>
      </div>

      ${this.selectedTemplate?J`
        <div class="form-group">
          <label class="form-label required">Playbook Name</label>
          <input
            type="text"
            class="form-input"
            .value=${this.templateName}
            @input=${e=>this.templateName=e.target.value}
            placeholder="my-playbook.yml"
          />
        </div>

        ${this.selectedTemplate.variables&&this.selectedTemplate.variables.length>0?J`
          <div class="template-variables">
            <h4>Template Variables</h4>
            ${this.selectedTemplate.variables.map(e=>J`
              <div class="form-group">
                <label class="form-label ${e.required?"required":""}">
                  ${e.description||e.name}
                </label>
                <input
                  type="text"
                  class="form-input"
                  .value=${this.templateVariables[e.name]||e.default||""}
                  @input=${t=>{this.templateVariables={...this.templateVariables,[e.name]:t.target.value}}}
                  placeholder=${e.default||""}
                />
              </div>
            `)}
          </div>
        `:""}
      `:""}
    `}renderGitForm(){return J`
      <div class="info-message">
        Import playbooks from a Git repository.
      </div>

      <div class="form-group">
        <label class="form-label required">Repository URL</label>
        <input
          type="text"
          class="form-input"
          .value=${this.gitUrl}
          @input=${e=>this.gitUrl=e.target.value}
          placeholder="https://github.com/user/repo.git"
        />
      </div>

      <div class="form-group">
        <label class="form-label">Branch</label>
        <input
          type="text"
          class="form-input"
          .value=${this.gitBranch}
          @input=${e=>this.gitBranch=e.target.value}
          placeholder="main"
        />
      </div>

      <div class="form-group">
        <label class="form-label">Path</label>
        <input
          type="text"
          class="form-input"
          .value=${this.gitPath}
          @input=${e=>this.gitPath=e.target.value}
          placeholder="playbooks/ (optional)"
        />
      </div>

      <div class="form-group">
        <label class="form-label">Authentication Token</label>
        <input
          type="password"
          class="form-input"
          .value=${this.gitAuthToken}
          @input=${e=>this.gitAuthToken=e.target.value}
          placeholder="For private repositories"
        />
      </div>

      <div class="form-group">
        <label class="form-label">SSH Private Key</label>
        <textarea
          class="form-textarea"
          .value=${this.gitSshKey}
          @input=${e=>this.gitSshKey=e.target.value}
          placeholder="-----BEGIN OPENSSH PRIVATE KEY-----"
        ></textarea>
      </div>

      <div class="form-group">
        <label class="form-checkbox-group">
          <input
            type="checkbox"
            class="form-checkbox"
            .checked=${this.gitSyncAsSymlink}
            @change=${e=>this.gitSyncAsSymlink=e.target.checked}
          />
          <span>Sync as symlink</span>
        </label>
      </div>
    `}renderUrlForm(){return J`
      <div class="info-message">
        Download a playbook from a URL.
      </div>

      <div class="form-group">
        <label class="form-label required">URL</label>
        <input
          type="text"
          class="form-input"
          .value=${this.urlSource}
          @input=${e=>this.urlSource=e.target.value}
          placeholder="https://example.com/playbook.yml"
        />
      </div>

      <div class="form-group">
        <label class="form-label required">Playbook Name</label>
        <input
          type="text"
          class="form-input"
          .value=${this.urlName}
          @input=${e=>this.urlName=e.target.value}
          placeholder="my-playbook.yml"
        />
      </div>
    `}renderGalaxyForm(){return J`
      <div class="info-message">
        Install roles or collections from Ansible Galaxy.
      </div>

      <div class="form-group">
        <label class="form-label">Type</label>
        <select
          class="form-select"
          .value=${this.galaxyType}
          @change=${e=>this.galaxyType=e.target.value}
        >
          <option value="collection">Collection</option>
          <option value="role">Role</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Name</label>
        <input
          type="text"
          class="form-input"
          .value=${this.galaxyName}
          @input=${e=>this.galaxyName=e.target.value}
          placeholder="community.general"
        />
      </div>

      <div class="form-group">
        <label class="form-label">Version</label>
        <input
          type="text"
          class="form-input"
          .value=${this.galaxyVersion}
          @input=${e=>this.galaxyVersion=e.target.value}
          placeholder="5.0.0 (optional)"
        />
      </div>

      <div class="form-group">
        <label class="form-label">Requirements File</label>
        <input
          type="text"
          class="form-input"
          .value=${this.galaxyRequirementsFile}
          @input=${e=>this.galaxyRequirementsFile=e.target.value}
          placeholder="requirements.yml (optional)"
        />
      </div>

      <div class="form-group">
        <label class="form-checkbox-group">
          <input
            type="checkbox"
            class="form-checkbox"
            .checked=${this.galaxyForce}
            @change=${e=>this.galaxyForce=e.target.checked}
          />
          <span>Force reinstall</span>
        </label>
      </div>
    `}getTitle(){switch(this.importType){case"upload":return"Upload Playbook";case"template":return"Create from Template";case"git":return"Import from Git";case"url":return"Import from URL";case"galaxy":return"Install from Ansible Galaxy";default:return"Import Playbook"}}render(){return J`
      <div class="drawer">
        <div class="drawer-header">
          <h2 class="header-title">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M10 2a1 1 0 011 1v6h6a1 1 0 110 2h-6v6a1 1 0 11-2 0v-6H3a1 1 0 110-2h6V3a1 1 0 011-1z"/>
            </svg>
            ${this.getTitle()}
          </h2>
          <button class="close-button" @click=${this.handleClose} aria-label="Close">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>

        <div class="drawer-content">
          ${this.error?J`
            <div class="error-message">
              <strong>Error:</strong> ${this.error}
            </div>
          `:""}

          ${"upload"===this.importType?this.renderUploadForm():""}
          ${"template"===this.importType?this.renderTemplateForm():""}
          ${"git"===this.importType?this.renderGitForm():""}
          ${"url"===this.importType?this.renderUrlForm():""}
          ${"galaxy"===this.importType?this.renderGalaxyForm():""}
        </div>

        <div class="drawer-footer">
          <button class="btn btn-secondary" @click=${this.handleClose}>
            Cancel
          </button>
          <button 
            class="btn btn-primary" 
            @click=${this.handleSubmit}
            ?disabled=${this.loading}
          >
            ${this.loading?"Importing...":"Import"}
          </button>
        </div>
      </div>
    `}};c_.styles=g`
    :host {
      display: block;
      position: fixed;
      top: 0;
      right: 0;
      width: 600px;
      height: 100vh;
      z-index: 1000;
      pointer-events: none;
    }

    :host([show]) {
      pointer-events: auto;
    }

    .drawer {
      width: 100%;
      height: 100%;
      background: var(--vscode-editor-background, #1e1e1e);
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      border-left: 1px solid var(--vscode-border);
    }

    :host([show]) .drawer {
      transform: translateX(0);
    }

    .drawer-header {
      padding: 20px;
      background: var(--vscode-sideBarSectionHeader-background, #252526);
      border-bottom: 1px solid var(--vscode-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .header-title {
      font-size: 18px;
      font-weight: 500;
      color: var(--vscode-foreground, #cccccc);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .close-button {
      background: none;
      border: none;
      color: var(--vscode-foreground, #cccccc);
      cursor: pointer;
      padding: 8px;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .close-button:hover {
      background: var(--vscode-toolbar-hoverBackground, rgba(90, 93, 94, 0.31));
    }

    .drawer-content {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      color: var(--vscode-foreground, #cccccc);
      font-size: 13px;
      font-weight: 500;
    }

    .form-label.required::after {
      content: ' *';
      color: var(--vscode-errorForeground, #f48771);
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 8px 12px;
      background: var(--vscode-input-background, #3c3c3c);
      color: var(--vscode-input-foreground, #cccccc);
      border: 1px solid var(--vscode-input-border, #3c3c3c);
      border-radius: 4px;
      font-size: 13px;
      font-family: inherit;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--vscode-focusBorder, #007acc);
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-checkbox {
      width: auto;
    }

    .file-input-wrapper {
      position: relative;
      display: inline-block;
      width: 100%;
    }

    .file-input {
      display: none;
    }

    .file-input-button {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      padding: 8px 12px;
      background: var(--vscode-button-secondaryBackground, #3a3a3a);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border: 1px solid var(--vscode-button-border, transparent);
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
    }

    .file-input-button:hover {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
    }

    .file-name {
      margin-top: 8px;
      color: var(--vscode-descriptionForeground, #969696);
      font-size: 12px;
    }

    .template-grid {
      display: grid;
      gap: 12px;
    }

    .template-card {
      padding: 12px;
      background: var(--vscode-editor-background, #1e1e1e);
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .template-card:hover {
      border-color: var(--vscode-focusBorder, #007acc);
      background: var(--vscode-list-hoverBackground, rgba(255, 255, 255, 0.08));
    }

    .template-card.selected {
      border-color: var(--vscode-focusBorder, #007acc);
      background: var(--vscode-list-activeSelectionBackground, #094771);
    }

    .template-name {
      font-weight: 500;
      margin-bottom: 4px;
    }

    .template-description {
      font-size: 12px;
      color: var(--vscode-descriptionForeground, #969696);
    }

    .template-variables {
      margin-top: 20px;
      padding: 16px;
      background: var(--vscode-editor-background, #1e1e1e);
      border: 1px solid var(--vscode-border);
      border-radius: 4px;
    }

    .error-message {
      padding: 12px;
      background: var(--vscode-inputValidation-errorBackground, rgba(244, 67, 54, 0.1));
      border: 1px solid var(--vscode-inputValidation-errorBorder, #f44336);
      border-radius: 4px;
      color: var(--vscode-errorForeground, #f48771);
      margin-bottom: 20px;
    }

    .drawer-footer {
      padding: 20px;
      background: var(--vscode-sideBarSectionHeader-background, #252526);
      border-top: 1px solid var(--vscode-border);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      flex-shrink: 0;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
      border: 1px solid transparent;
    }

    .btn-secondary {
      background: var(--vscode-button-secondaryBackground, #3a3a3a);
      color: var(--vscode-button-secondaryForeground, #cccccc);
      border-color: var(--vscode-button-border, transparent);
    }

    .btn-secondary:hover {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
    }

    .btn-primary {
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border-color: var(--vscode-button-border, transparent);
    }

    .btn-primary:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .info-message {
      padding: 8px 12px;
      background: var(--vscode-editorInfo-background, rgba(33, 150, 243, 0.1));
      border-left: 3px solid var(--vscode-editorInfo-foreground, #2196f3);
      border-radius: 4px;
      color: var(--vscode-foreground, #cccccc);
      font-size: 12px;
      margin-bottom: 16px;
    }
  `,l_([we({type:Boolean,reflect:!0})],c_.prototype,"show",2),l_([we({type:String})],c_.prototype,"importType",2),l_([xe()],c_.prototype,"loading",2),l_([xe()],c_.prototype,"error",2),l_([xe()],c_.prototype,"templates",2),l_([xe()],c_.prototype,"selectedTemplate",2),l_([xe()],c_.prototype,"uploadFile",2),l_([xe()],c_.prototype,"uploadName",2),l_([xe()],c_.prototype,"uploadOverwrite",2),l_([xe()],c_.prototype,"templateName",2),l_([xe()],c_.prototype,"templateVariables",2),l_([xe()],c_.prototype,"gitUrl",2),l_([xe()],c_.prototype,"gitBranch",2),l_([xe()],c_.prototype,"gitPath",2),l_([xe()],c_.prototype,"gitAuthToken",2),l_([xe()],c_.prototype,"gitSshKey",2),l_([xe()],c_.prototype,"gitSyncAsSymlink",2),l_([xe()],c_.prototype,"urlSource",2),l_([xe()],c_.prototype,"urlName",2),l_([xe()],c_.prototype,"galaxyType",2),l_([xe()],c_.prototype,"galaxyName",2),l_([xe()],c_.prototype,"galaxyVersion",2),l_([xe()],c_.prototype,"galaxyRequirementsFile",2),l_([xe()],c_.prototype,"galaxyForce",2),c_=l_([ve("playbook-import-drawer")],c_);var d_=Object.defineProperty,h_=Object.getOwnPropertyDescriptor,u_=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?h_(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&d_(t,s,r),r};let p_=class extends me{constructor(){super(...arguments),this.initialTab="playbooks",this.loading=!1,this.activeTab="playbooks",this.searchQuery="",this.playbooks=[],this.templates=[],this.showEditorModal=!1,this.showRunModal=!1,this.editorMode="create",this.playbookExtended=/* @__PURE__ */new Map,this.showCreateDropdown=!1,this.showImportDrawer=!1,this.importType="upload",this.handleOutsideClick=e=>{e.target.closest(".action-menu")||(this.showCreateDropdown=!1)},this.handleLocationChange=()=>{const e=window.location.pathname;e.includes("/ansible/templates")?this.activeTab="templates":e.includes("/ansible/playbooks")?this.activeTab="playbooks":this.activeTab=this.initialTab||"playbooks"}}connectedCallback(){super.connectedCallback(),this.handleLocationChange(),this.loadData(),document.addEventListener("click",this.handleOutsideClick),window.addEventListener("popstate",this.handleLocationChange)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("click",this.handleOutsideClick),window.removeEventListener("popstate",this.handleLocationChange)}async loadData(){this.loading=!0;try{const[e,t]=await Promise.all([Yx.listPlaybooks().catch(e=>(console.error("Failed to load playbooks:",e),{playbooks:[],count:0})),Yx.listTemplates().catch(e=>(console.error("Failed to load templates:",e),{templates:[]}))]);this.playbooks=e&&"object"==typeof e&&Array.isArray(e.playbooks)?e.playbooks:[],this.templates=t&&"object"==typeof t&&Array.isArray(t.templates)?t.templates:[],this.playbooks.forEach(e=>{this.playbookExtended.set(e.name,{description:`Playbook for ${e.name}`,tags:["ansible","automation"],hosts:"all",status:"Ready"})})}catch(e){console.error("Failed to load data:",e),this.playbooks=[],this.templates=[]}finally{this.loading=!1}}handleTabClick(e,t){e.preventDefault(),this.activeTab=t;const s="templates"===t?"/ansible/templates":"/ansible/playbooks";window.history.pushState({},"",s)}handleSearch(e){this.searchQuery=e.detail.value}get filteredPlaybooks(){if(!this.searchQuery)return this.playbooks;const e=this.searchQuery.toLowerCase();return this.playbooks.filter(t=>t.name.toLowerCase().includes(e)||t.path.toLowerCase().includes(e))}get filteredTemplates(){if(!this.searchQuery)return this.templates;const e=this.searchQuery.toLowerCase();return this.templates.filter(t=>t.name.toLowerCase().includes(e)||t.description.toLowerCase().includes(e)||t.category.toLowerCase().includes(e))}formatDate(e){const t=new Date(e),s=(/* @__PURE__ */new Date).getTime()-t.getTime(),i=Math.floor(s/864e5);return 0===i?"Today":1===i?"Yesterday":i<7?`${i} days ago`:t.toLocaleDateString()}getPlaybooksColumns(){return[{key:"name",label:"Name",type:"link"},{key:"path",label:"Path"},{key:"hosts",label:"Hosts"},{key:"status",label:"Status"},{key:"tags",label:"Tags"},{key:"lastModified",label:"Last Modified"}]}getTemplatesColumns(){return[{key:"name",label:"Name",type:"link"},{key:"type",label:"Type"},{key:"playbook",label:"Playbook"},{key:"inventory",label:"Inventory"},{key:"status",label:"Status"},{key:"lastUsed",label:"Last Used"}]}getPlaybookActions(e){return[{label:"Run",action:"run"},{label:"Edit",action:"edit"},{label:"Validate",action:"validate"},{label:"Download",action:"download"},{label:"Delete",action:"delete",danger:!0}]}getTemplateActions(e){return[{label:"Use Template",action:"use"},{label:"View Details",action:"view"},{label:"Clone",action:"clone"}]}renderPlaybooks(){if(this.loading)return J`<loading-state></loading-state>`;const e=this.filteredPlaybooks;if(0===e.length)return J`
        <empty-state
          .message=${"No playbooks found"}
        ></empty-state>
      `;const t=this.getPlaybooksColumns(),s=e.map(e=>{const t=this.playbookExtended.get(e.name)||{tags:[],hosts:"all",status:"Ready"};return{...e,hosts:t.hosts,status:t.status,tags:t.tags.join(", "),lastModified:this.formatDate(e.modified)}});return J`
      <resource-table
        .columns=${t}
        .data=${s}
        .actions=${this.getPlaybookActions}
        @action=${this.handlePlaybookAction}
      ></resource-table>
    `}renderTemplates(){if(this.loading)return J`<loading-state></loading-state>`;const e=this.filteredTemplates;if(0===e.length)return J`
        <empty-state
          .message=${"No templates found"}
        ></empty-state>
      `;const t=this.getTemplatesColumns(),s=e.map(e=>({...e,type:e.category,playbook:e.name,inventory:"default",status:"Active",lastUsed:this.formatDate(/* @__PURE__ */(new Date).toISOString())}));return J`
      <resource-table
        .columns=${t}
        .data=${s}
        .actions=${this.getTemplateActions}
        @action=${this.handleTemplateAction}
      ></resource-table>
    `}async handlePlaybookAction(e){const{action:t,item:s}=e.detail;switch(t){case"run":this.selectedPlaybook=s.name,this.showRunModal=!0;break;case"edit":this.selectedPlaybook=s.name,this.editorMode="edit",this.showEditorModal=!0;break;case"validate":await this.validatePlaybook(s.name);break;case"download":await this.downloadPlaybook(s.name);break;case"delete":confirm(`Are you sure you want to delete ${s.name}?`)&&await this.deletePlaybook(s.name)}}async handleTemplateAction(e){const{action:t,item:s}=e.detail;switch(t){case"use":console.log("Use template:",s);break;case"view":console.log("View template:",s);break;case"clone":console.log("Clone template:",s)}}async validatePlaybook(e){try{const t=await Yx.validatePlaybook(e);t.valid?alert(`â Playbook ${e} is valid`):alert(`â Validation failed:\n${t.errors?.join("\n")||t.message}`)}catch(t){console.error("Validation failed:",t),alert(`Failed to validate playbook: ${t}`)}}async downloadPlaybook(e){try{const t=await Yx.getPlaybook(e),s=new Blob([t.playbook.content],{type:"text/yaml"}),i=URL.createObjectURL(s),o=document.createElement("a");o.href=i,o.download=e,o.click(),URL.revokeObjectURL(i)}catch(t){console.error("Download failed:",t),alert(`Failed to download playbook: ${t}`)}}async deletePlaybook(e){try{await Yx.deletePlaybook(e),await this.loadData()}catch(t){console.error("Delete failed:",t),alert(`Failed to delete playbook: ${t}`)}}toggleCreateDropdown(e){e.stopPropagation(),this.showCreateDropdown=!this.showCreateDropdown}handleCreateAction(e){switch(this.showCreateDropdown=!1,e){case"create":this.selectedPlaybook=void 0,this.editorMode="create",this.showEditorModal=!0;break;case"upload":this.importType="upload",this.showImportDrawer=!0;break;case"template":this.importType="template",this.showImportDrawer=!0;break;case"git":this.importType="git",this.showImportDrawer=!0;break;case"url":this.importType="url",this.showImportDrawer=!0;break;case"galaxy":this.importType="galaxy",this.showImportDrawer=!0}}handleImportComplete(){this.showImportDrawer=!1,this.loadData()}handleEditorSave(){this.showEditorModal=!1,this.loadData()}handleRunComplete(e){const{executionId:t}=e.detail;window.location.href=`/ansible/executions?id=${t}`}render(){return J`
      <div class="container">
        <h1>${"playbooks"===this.activeTab?"Playbooks":"Templates"}</h1>
        <div class="tab-header">
          <a 
            href="/ansible/playbooks"
            class="tab-button ${"playbooks"===this.activeTab?"active":""}" 
            @click="${e=>this.handleTabClick(e,"playbooks")}"
          >
            Playbooks
          </a>
          <a 
            href="/ansible/templates"
            class="tab-button ${"templates"===this.activeTab?"active":""}" 
            @click="${e=>this.handleTabClick(e,"templates")}"
          >
            Templates
          </a>
        </div>

        <div class="header">
          <search-input
            .placeholder=${"playbooks"===this.activeTab?"Search playbooks...":"Search templates..."}
            @search=${this.handleSearch}
          ></search-input>
          
          ${"playbooks"===this.activeTab?J`
            <div class="action-menu">
              <button class="btn-create" @click=${e=>this.toggleCreateDropdown(e)}>
                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M8 2a1 1 0 011 1v4h4a1 1 0 110 2H9v4a1 1 0 11-2 0V9H3a1 1 0 110-2h4V3a1 1 0 011-1z"/>
                </svg>
                Add Playbook
              </button>
              <div class="action-dropdown ${this.showCreateDropdown?"show":""}">
                <button @click=${()=>this.handleCreateAction("create")}>Create New</button>
                <button @click=${()=>this.handleCreateAction("upload")}>Upload File</button>
                <button @click=${()=>this.handleCreateAction("template")}>From Template</button>
                <button @click=${()=>this.handleCreateAction("git")}>From Git</button>
                <button @click=${()=>this.handleCreateAction("url")}>From URL</button>
                <button @click=${()=>this.handleCreateAction("galaxy")}>From Ansible Galaxy</button>
              </div>
            </div>
          `:J`
            <button class="btn-create">
              <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 2a1 1 0 011 1v4h4a1 1 0 110 2H9v4a1 1 0 11-2 0V9H3a1 1 0 110-2h4V3a1 1 0 011-1z"/>
              </svg>
              Create Job Template
            </button>
          `}
        </div>

        <div class="content">
          ${"playbooks"===this.activeTab?this.renderPlaybooks():this.renderTemplates()}
        </div>
      </div>

      <!-- Import Drawer -->
      <playbook-import-drawer
        .show=${this.showImportDrawer}
        .importType=${this.importType}
        @close=${()=>this.showImportDrawer=!1}
        @import-complete=${this.handleImportComplete}
      ></playbook-import-drawer>

      <!-- Editor Modal -->
      ${this.showEditorModal?J`
        <playbook-editor-modal
          .open=${this.showEditorModal}
          .mode=${this.editorMode}
          .playbook=${this.selectedPlaybook}
          @close=${()=>this.showEditorModal=!1}
          @save=${this.handleEditorSave}
        ></playbook-editor-modal>
      `:""}

      <!-- Run Modal -->
      ${this.showRunModal?J`
        <playbook-run-modal
          .open=${this.showRunModal}
          .playbook=${this.selectedPlaybook}
          @close=${()=>this.showRunModal=!1}
          @run-complete=${this.handleRunComplete}
        ></playbook-run-modal>
      `:""}
    `}};p_.styles=g`
    :host {
      display: block;
      height: 100%;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 1rem;
    }

    h1 {
      margin: 0 0 24px 0;
      font-size: 24px;
      font-weight: 300;
      flex-shrink: 0;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    search-input {
      flex: 1;
    }

    .content {
      flex: 1;
      overflow-y: auto;
    }

    .btn-create {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-create:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .tab-header {
      display: flex;
      border-bottom: 2px solid var(--border-color);
      margin-bottom: 1rem;
    }

    .tab-button {
      padding: 0.75rem 1.5rem;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 0.875rem;
      color: var(--text-secondary);
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-block;
    }

    .tab-button:hover {
      color: var(--text-primary);
    }

    .tab-button.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }

    .action-menu {
      position: relative;
      display: inline-block;
    }

    .action-dropdown {
      position: absolute;
      right: 0;
      top: 100%;
      margin-top: 4px;
      background: var(--vscode-dropdown-background, var(--vscode-editor-background, #1e1e1e));
      border: 1px solid var(--vscode-dropdown-border, var(--vscode-widget-border, #454545));
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      min-width: 180px;
      z-index: 1000;
      display: none;
      /* Ensure solid background */
      backdrop-filter: none;
    }

    .action-dropdown.show {
      display: block;
    }

    .action-dropdown button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 8px 16px;
      border: none;
      background: none;
      color: var(--vscode-foreground);
      cursor: pointer;
      font-size: 13px;
      transition: background-color 0.2s;
    }

    .action-dropdown button:hover {
      background-color: var(--vscode-list-hoverBackground, rgba(255, 255, 255, 0.08));
    }

  `,u_([we({type:String})],p_.prototype,"initialTab",2),u_([xe()],p_.prototype,"loading",2),u_([xe()],p_.prototype,"activeTab",2),u_([xe()],p_.prototype,"searchQuery",2),u_([xe()],p_.prototype,"playbooks",2),u_([xe()],p_.prototype,"templates",2),u_([xe()],p_.prototype,"showEditorModal",2),u_([xe()],p_.prototype,"showRunModal",2),u_([xe()],p_.prototype,"selectedPlaybook",2),u_([xe()],p_.prototype,"editorMode",2),u_([xe()],p_.prototype,"showCreateDropdown",2),u_([xe()],p_.prototype,"showImportDrawer",2),u_([xe()],p_.prototype,"importType",2),p_=u_([ve("ansible-playbooks")],p_);var g_=Object.defineProperty,m_=Object.getOwnPropertyDescriptor,f_=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?m_(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&g_(t,s,r),r};let v_=class extends me{constructor(){super(...arguments),this.loading=!1,this.searchQuery="",this.inventoryItems=[],this.typeFilter="all"}connectedCallback(){super.connectedCallback(),this.loadInventory()}async loadInventory(){this.loading=!0;try{const e=await Yx.getDynamicInventory();this.inventoryItems=this.convertInventoryToItems(e.inventory)}catch(e){console.error("Failed to load inventory:",e),this.inventoryItems=[{id:"1",name:"web-server-01",type:"host",description:"Primary web server",groups:["webservers","production"],variables:{ansible_host:"192.168.1.10",ansible_port:22,ansible_user:"admin"},enabled:!0,lastSync:"2024-01-15T10:30:00Z",source:"manual"},{id:"2",name:"web-server-02",type:"host",description:"Secondary web server",groups:["webservers","production"],variables:{ansible_host:"192.168.1.11",ansible_port:22,ansible_user:"admin"},enabled:!0,lastSync:"2024-01-15T10:30:00Z",source:"manual"},{id:"3",name:"db-server-01",type:"host",description:"Primary database server",groups:["databases","production"],variables:{ansible_host:"192.168.1.20",ansible_port:22,ansible_user:"dbadmin",db_port:5432},enabled:!0,lastSync:"2024-01-15T10:30:00Z",source:"manual"},{id:"4",name:"webservers",type:"group",description:"All web servers",hosts:["web-server-01","web-server-02"],variables:{http_port:80,https_port:443,max_connections:1e3},enabled:!0,source:"manual"},{id:"5",name:"databases",type:"group",description:"All database servers",hosts:["db-server-01"],variables:{backup_schedule:"0 2 * * *",replication_enabled:!0},enabled:!0,source:"manual"},{id:"6",name:"production",type:"group",description:"Production environment",hosts:["web-server-01","web-server-02","db-server-01"],variables:{environment:"production",monitoring_enabled:!0,alert_email:"ops@example.com"},enabled:!0,source:"manual"},{id:"7",name:"dev-server-01",type:"host",description:"Development server",groups:["development"],variables:{ansible_host:"10.0.1.50",ansible_port:22,ansible_user:"developer"},enabled:!1,lastSync:"2024-01-14T15:45:00Z",source:"dynamic"},{id:"8",name:"monitoring-server",type:"host",description:"Monitoring and alerting server",groups:["monitoring","infrastructure"],variables:{ansible_host:"192.168.1.100",prometheus_port:9090,grafana_port:3e3},enabled:!0,lastSync:"2024-01-15T10:30:00Z",source:"scm"}]}finally{this.loading=!1}}convertInventoryToItems(e){const t=[];let s=1;if(e.all?.hosts)for(const i of e.all.hosts){const o=e._meta?.hostvars?.[i]||{};t.push({id:String(s++),name:i,type:"host",description:o.description||"",groups:this.getHostGroups(i,e),variables:o,enabled:!0,lastSync:/* @__PURE__ */(new Date).toISOString(),source:"dynamic"})}for(const[i,o]of Object.entries(e))if("_meta"!==i&&"all"!==i&&"object"==typeof o&&null!==o){const e=o.hosts||[],r=o.vars||{};t.push({id:String(s++),name:i,type:"group",description:r.description||"",hosts:e,variables:r,enabled:!0,lastSync:/* @__PURE__ */(new Date).toISOString(),source:"dynamic"})}return t}getHostGroups(e,t){const s=[];for(const[i,o]of Object.entries(t))if("_meta"!==i&&"all"!==i&&"object"==typeof o&&null!==o){(o.hosts||[]).includes(e)&&s.push(i)}return s}handleSearch(e){this.searchQuery=e.detail.value}handleTypeFilter(e){this.typeFilter=e}get filteredItems(){let e=[...this.inventoryItems];if("all"!==this.typeFilter&&(e=e.filter(e=>e.type===this.typeFilter)),this.searchQuery){const t=this.searchQuery.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.description?.toLowerCase().includes(t)||e.groups&&e.groups.some(e=>e.toLowerCase().includes(t)))}return e}getColumns(){return[{key:"nameDisplay",label:"Name",type:"link"},{key:"typeDisplay",label:"Type",width:"100px"},{key:"groupsDisplay",label:"Groups / Hosts",width:"200px"},{key:"variablesDisplay",label:"Variables",width:"120px"},{key:"sourceDisplay",label:"Source",width:"100px"},{key:"lastSyncDisplay",label:"Last Sync",width:"150px"}]}getInventoryActions(e){return[{action:"edit",label:"Edit",icon:"âï¸"},{action:"duplicate",label:"Duplicate",icon:"ð"},{action:"variables",label:"Manage Variables",icon:"ð§"},{action:"disable",label:e.enabled?"Disable":"Enable",icon:"ð"},{action:"delete",label:"Delete",icon:"ðï¸",danger:!0}]}prepareTableData(){return this.filteredItems.map(e=>({_original:e,nameDisplay:`${e.enabled?"ð¢":"ð´"} ${e.name}`,typeDisplay:`${"host"===e.type?"ð¥ï¸":"ð"} ${e.type}`,groupsDisplay:"host"===e.type&&e.groups?e.groups.join(", "):"group"===e.type&&e.hosts?`${e.hosts.length} hosts`:"-",variablesDisplay:e.variables?`${Object.keys(e.variables).length} vars`:"-",sourceDisplay:e.source?`${"manual"===e.source?"âï¸":"dynamic"===e.source?"ð":"ð"} ${e.source}`:"-",lastSyncDisplay:e.lastSync?new Date(e.lastSync).toLocaleString():"-"}))}handleCellClick(e){const{item:t,column:s}=e.detail;"nameDisplay"===s.key&&t._original&&console.log("View details for:",t._original)}handleAction(e,t){switch(console.log("Action:",e,"Item:",t),e){case"edit":case"duplicate":case"variables":break;case"disable":t.enabled=!t.enabled,this.requestUpdate();break;case"delete":confirm(`Are you sure you want to delete "${t.name}"?`)&&(this.inventoryItems=this.inventoryItems.filter(e=>e.id!==t.id))}}async handleAddHost(){const e=prompt("Enter hostname:");if(!e)return;const t=prompt("Enter host IP address:");if(!t)return;const s={id:String(Date.now()),name:e,type:"host",description:"Manually added host",groups:[],variables:{ansible_host:t,ansible_user:"root"},enabled:!0,lastSync:/* @__PURE__ */(new Date).toISOString(),source:"manual"};this.inventoryItems=[...this.inventoryItems,s],await this.saveInventory()}async handleAddGroup(){const e=prompt("Enter group name:");if(!e)return;const t={id:String(Date.now()),name:e,type:"group",description:"Manually added group",hosts:[],variables:{},enabled:!0,lastSync:/* @__PURE__ */(new Date).toISOString(),source:"manual"};this.inventoryItems=[...this.inventoryItems,t],await this.saveInventory()}async handleSync(){await this.loadInventory()}async saveInventory(){try{const e=this.convertItemsToInventory(this.inventoryItems);await Yx.saveInventory({name:"main",format:"json",content:JSON.stringify(e)}),console.log("Inventory saved successfully")}catch(e){console.error("Failed to save inventory:",e),alert(`Failed to save inventory: ${e}`)}}convertItemsToInventory(e){const t={_meta:{hostvars:{}},all:{hosts:[],children:[]}},s=e.filter(e=>"host"===e.type);for(const o of s)t.all.hosts.push(o.name),o.variables&&(t._meta.hostvars[o.name]=o.variables);const i=e.filter(e=>"group"===e.type);for(const o of i)t[o.name]={hosts:o.hosts||[],vars:o.variables||{}},t.all.children?.push(o.name);return t}render(){return J`
      <div class="container">
        <div class="header">
          <h1>Inventory</h1>
        </div>
        
        <div class="controls">
          <div class="controls-left">
            <search-input
              placeholder="Search inventory..."
              @search=${this.handleSearch}
            ></search-input>
            
            <div class="filter-buttons">
              <button 
                class="filter-btn ${"all"===this.typeFilter?"active":""}"
                @click=${()=>this.handleTypeFilter("all")}
              >
                All
              </button>
              <button 
                class="filter-btn ${"host"===this.typeFilter?"active":""}"
                @click=${()=>this.handleTypeFilter("host")}
              >
                Hosts
              </button>
              <button 
                class="filter-btn ${"group"===this.typeFilter?"active":""}"
                @click=${()=>this.handleTypeFilter("group")}
              >
                Groups
              </button>
            </div>
          </div>
          
          <div class="controls-right">
            <button class="btn-secondary" @click=${this.handleSync}>
              ð Sync
            </button>
            <button class="btn-primary" @click=${this.handleAddHost}>
              â Add Host
            </button>
            <button class="btn-primary" @click=${this.handleAddGroup}>
              ð Add Group
            </button>
          </div>
        </div>
        
        <div class="content">
          ${this.loading?J`
            <loading-state message="Loading inventory..."></loading-state>
          `:0===this.filteredItems.length?J`
            <empty-state
              icon="ð"
              title="No inventory items found"
              description="${this.searchQuery?"Try adjusting your search or filters":"Add hosts or groups to get started"}"
            ></empty-state>
          `:J`
            <resource-table
              .columns=${this.getColumns()}
              .data=${this.prepareTableData()}
              .getActions=${e=>this.getInventoryActions(e._original)}
              @action=${e=>this.handleAction(e.detail.action,e.detail.item._original)}
              @cell-click=${e=>this.handleCellClick(e)}
            ></resource-table>
          `}
        </div>
      </div>
    `}};v_.styles=g`
    :host {
      display: block;
      height: 100%;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 1rem;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--vscode-panel-border);
    }

    h1 {
      margin: 0 0 24px 0;
      font-size: 24px;
      font-weight: 300;
      flex-shrink: 0;
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-top: 1rem;
    }

    .controls-left {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex: 1;
    }

    .controls-right {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-primary:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }

    .btn-secondary {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--vscode-button-secondaryBackground);
      color: var(--vscode-button-secondaryForeground);
      border: 1px solid var(--vscode-button-border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
    }

    .btn-secondary:hover {
      background: var(--vscode-button-secondaryHoverBackground);
    }

    search-input {
      flex: 1;
      max-width: 400px;
    }

    .content {
      flex: 1;
      overflow-y: auto;
    }

    .filter-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .filter-btn {
      padding: 6px 12px;
      background: var(--vscode-button-secondaryBackground);
      color: var(--vscode-button-secondaryForeground);
      border: 1px solid var(--vscode-button-border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
    }

    .filter-btn:hover {
      background: var(--vscode-button-secondaryHoverBackground);
    }

    .filter-btn.active {
      background: var(--vscode-button-background);
      color: var(--vscode-button-foreground);
      border-color: var(--vscode-focusBorder);
    }

    .type-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .type-badge.host {
      background: rgba(30, 136, 229, 0.2);
      color: #1e88e5;
    }

    .type-badge.group {
      background: rgba(156, 39, 176, 0.2);
      color: #9c27b0;
    }

    .variables-count {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      background: var(--vscode-badge-background);
      color: var(--vscode-badge-foreground);
      border-radius: 10px;
      font-size: 11px;
    }

    .groups-list {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .group-tag {
      display: inline-flex;
      padding: 2px 6px;
      background: var(--vscode-textBlockQuote-background);
      border: 1px solid var(--vscode-textBlockQuote-border);
      border-radius: 3px;
      font-size: 11px;
      color: var(--vscode-textBlockQuote-foreground);
    }

    .source-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 11px;
      font-weight: 500;
    }

    .source-badge.manual {
      background: rgba(117, 117, 117, 0.2);
      color: #757575;
    }

    .source-badge.dynamic {
      background: rgba(255, 167, 38, 0.2);
      color: #ffa726;
    }

    .source-badge.scm {
      background: rgba(102, 187, 106, 0.2);
      color: #66bb6a;
    }

    .status-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 4px;
    }

    .status-indicator.enabled {
      background: #4caf50;
    }

    .status-indicator.disabled {
      background: #9e9e9e;
    }
  `,f_([xe()],v_.prototype,"loading",2),f_([xe()],v_.prototype,"searchQuery",2),f_([xe()],v_.prototype,"inventoryItems",2),f_([xe()],v_.prototype,"typeFilter",2),v_=f_([ve("ansible-inventory")],v_);var b_=Object.defineProperty,y_=Object.getOwnPropertyDescriptor,w_=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?y_(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&b_(t,s,r),r};let x_=class extends me{constructor(){super(...arguments),this.open=!1,this.loading=!1,this.streaming=!1,this.output=[]}updated(e){e.has("open")&&(this.open&&this.executionId?this.loadExecution():this.open||this.cleanup()),e.has("executionId")&&this.executionId&&this.open&&this.loadExecution()}async loadExecution(){if(this.executionId){this.loading=!0,this.error=void 0,this.output=[];try{const e=await Yx.getExecution(this.executionId);this.execution=e.execution,"running"===this.execution.status?this.startStreaming():this.execution.output&&(this.output=this.execution.output.split("\n"))}catch(e){console.error("Failed to load execution:",e),this.error=e instanceof Error?e.message:"Failed to load execution"}finally{this.loading=!1}}}startStreaming(){this.executionId&&!this.wsManager&&(this.streaming=!0,this.wsManager=Yx.createExecutionStream(this.executionId,e=>{"output"===e.type&&e.content?(this.output=[...this.output,...e.content.split("\n")],this.requestUpdate(),this.scrollToBottom()):"complete"===e.type?(this.streaming=!1,e.result&&this.execution&&(this.execution.status=e.result.status,this.execution.exit_code=e.result.exit_code)):"error"===e.type&&(this.error=e.error||"Stream error occurred",this.streaming=!1)},e=>{console.error("WebSocket error:",e),this.error=e.message,this.streaming=!1},()=>{this.streaming=!1}),this.wsManager.connect().catch(e=>{console.error("Failed to connect WebSocket:",e),this.error="Failed to connect to output stream",this.streaming=!1}))}scrollToBottom(){requestAnimationFrame(()=>{const e=this.shadowRoot?.querySelector(".output-container");e&&(e.scrollTop=e.scrollHeight)})}cleanup(){this.wsManager&&(this.wsManager.disconnect(),this.wsManager=void 0),this.output=[],this.execution=void 0,this.streaming=!1,this.error=void 0}close(){this.dispatchEvent(new CustomEvent("close")),this.open=!1}async rerun(){this.execution&&this.execution.parameters&&this.dispatchEvent(new CustomEvent("rerun",{detail:{type:this.execution.type,parameters:this.execution.parameters}}))}downloadLog(){if(!this.execution)return;const e=this.output.join("\n")||this.execution.output||"",t=new Blob([e],{type:"text/plain"}),s=URL.createObjectURL(t),i=document.createElement("a");i.href=s,i.download=`ansible-execution-${this.execution.id}.log`,i.click(),URL.revokeObjectURL(s)}getOutputLineClass(e){const t=e.toLowerCase();return e.startsWith("PLAY [")||e.startsWith("PLAY RECAP")?"play":e.startsWith("TASK [")||e.startsWith("GATHERING FACTS")?"task":t.includes("ok:")?"ok":t.includes("changed:")?"changed":t.includes("failed:")||t.includes("fatal:")?"failed":t.includes("skipping:")?"skipped":t.includes("unreachable:")?"unreachable":""}render(){return J`
      <div class="header">
        <div class="title">
          <span>Execution Details</span>
          ${this.streaming?J`
            <span class="streaming-indicator">
              <span class="streaming-dot"></span>
              Live
            </span>
          `:""}
        </div>
        <button class="close-button" @click=${this.close}>
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 8.707l3.646 3.647.708-.707L8.707 8l3.647-3.646-.707-.708L8 7.293 4.354 3.646l-.707.708L7.293 8l-3.647 3.646.708.707L8 8.707z"/>
          </svg>
        </button>
      </div>

      ${this.loading?J`
        <div class="loading-state">
          <loading-state message="Loading execution details..."></loading-state>
        </div>
      `:this.error?J`
        <div class="error-state">
          <strong>Error:</strong> ${this.error}
        </div>
      `:this.execution?J`
        <div class="metadata">
          <div class="metadata-item">
            <span class="metadata-label">ID:</span>
            <span class="metadata-value">${this.execution.id}</span>
          </div>
          <div class="metadata-item">
            <span class="metadata-label">Type:</span>
            <span class="metadata-value">${this.execution.type}</span>
          </div>
          ${this.execution.playbook?J`
            <div class="metadata-item">
              <span class="metadata-label">Playbook:</span>
              <span class="metadata-value">${this.execution.playbook}</span>
            </div>
          `:""}
          ${this.execution.module?J`
            <div class="metadata-item">
              <span class="metadata-label">Module:</span>
              <span class="metadata-value">${this.execution.module}</span>
            </div>
          `:""}
          <div class="metadata-item">
            <span class="metadata-label">Status:</span>
            <span class="status-badge ${this.execution.status}">
              ${this.execution.status}
            </span>
          </div>
          <div class="metadata-item">
            <span class="metadata-label">Started:</span>
            <span class="metadata-value">${new Date(this.execution.started_at).toLocaleString()}</span>
          </div>
          ${this.execution.finished_at?J`
            <div class="metadata-item">
              <span class="metadata-label">Duration:</span>
              <span class="metadata-value">${Yx.formatDuration(this.execution.duration)}</span>
            </div>
          `:""}
          ${this.execution.hosts_summary?J`
            <div class="metadata-item">
              <span class="metadata-label">Hosts:</span>
              <div class="host-summary">
                ${this.execution.hosts_summary.ok>0?J`
                  <span class="host-stat ok">
                    <span class="host-stat-icon"></span>
                    ${this.execution.hosts_summary.ok} ok
                  </span>
                `:""}
                ${this.execution.hosts_summary.changed>0?J`
                  <span class="host-stat changed">
                    <span class="host-stat-icon"></span>
                    ${this.execution.hosts_summary.changed} changed
                  </span>
                `:""}
                ${this.execution.hosts_summary.failed>0?J`
                  <span class="host-stat failed">
                    <span class="host-stat-icon"></span>
                    ${this.execution.hosts_summary.failed} failed
                  </span>
                `:""}
                ${this.execution.hosts_summary.unreachable>0?J`
                  <span class="host-stat unreachable">
                    <span class="host-stat-icon"></span>
                    ${this.execution.hosts_summary.unreachable} unreachable
                  </span>
                `:""}
                ${this.execution.hosts_summary.skipped>0?J`
                  <span class="host-stat skipped">
                    <span class="host-stat-icon"></span>
                    ${this.execution.hosts_summary.skipped} skipped
                  </span>
                `:""}
              </div>
            </div>
          `:""}
        </div>

        <div class="output-container">
          ${this.output.map(e=>J`
            <pre class="output-line ${this.getOutputLineClass(e)}">${e}</pre>
          `)}
        </div>

        <div class="actions">
          <button class="action-button" @click=${this.downloadLog}>
            Download Log
          </button>
          <button 
            class="action-button secondary" 
            @click=${this.rerun}
            ?disabled=${"running"===this.execution.status}
          >
            Re-run
          </button>
        </div>
      `:""}
    `}};x_.styles=g`
    :host {
      display: block;
      position: fixed;
      top: 0;
      right: -600px;
      width: 600px;
      height: 100vh;
      background: var(--vscode-editor-background, #1e1e1e);
      border-left: 1px solid var(--vscode-border);
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.2);
      transition: right 0.3s ease-in-out;
      z-index: 1000;
      display: flex;
      flex-direction: column;
    }

    :host([open]) {
      right: 0;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      border-bottom: 1px solid var(--vscode-border);
      background: var(--vscode-titleBar-activeBackground, #3c3c3c);
      flex-shrink: 0;
    }

    .title {
      font-size: 14px;
      font-weight: 500;
      color: var(--vscode-titleBar-activeForeground, #cccccc);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .close-button {
      background: none;
      border: none;
      color: var(--vscode-icon-foreground, #c5c5c5);
      cursor: pointer;
      padding: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: background-color 0.2s;
    }

    .close-button:hover {
      background: var(--vscode-toolbar-hoverBackground, rgba(90, 93, 94, 0.31));
    }

    .metadata {
      padding: 16px;
      border-bottom: 1px solid var(--vscode-border);
      flex-shrink: 0;
    }

    .metadata-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .metadata-label {
      color: var(--vscode-descriptionForeground, #8b8b8b);
      min-width: 100px;
    }

    .metadata-value {
      color: var(--vscode-foreground, #cccccc);
      font-family: var(--vscode-editor-font-family, 'Courier New', monospace);
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-badge.running {
      background: rgba(30, 136, 229, 0.2);
      color: #1e88e5;
    }

    .status-badge.success {
      background: rgba(67, 160, 71, 0.2);
      color: #43a047;
    }

    .status-badge.failed {
      background: rgba(229, 57, 53, 0.2);
      color: #e53935;
    }

    .status-badge.cancelled {
      background: rgba(117, 117, 117, 0.2);
      color: #757575;
    }

    .output-container {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      background: var(--vscode-terminal-background, #1e1e1e);
      font-family: var(--vscode-editor-font-family, 'Courier New', monospace);
      font-size: 13px;
      line-height: 1.6;
      color: var(--vscode-terminal-foreground, #cccccc);
    }

    .output-line {
      white-space: pre-wrap;
      word-break: break-all;
      margin: 0;
      padding: 2px 0;
    }

    .output-line.task {
      color: var(--vscode-terminal-ansiBrightCyan, #3dd8ff);
      font-weight: bold;
      margin-top: 8px;
    }

    .output-line.play {
      color: var(--vscode-terminal-ansiBrightMagenta, #ff6eff);
      font-weight: bold;
      margin-top: 12px;
      border-top: 1px solid var(--vscode-border);
      padding-top: 8px;
    }

    .output-line.ok {
      color: var(--vscode-terminal-ansiGreen, #00ff00);
    }

    .output-line.changed {
      color: var(--vscode-terminal-ansiYellow, #ffff00);
    }

    .output-line.failed,
    .output-line.fatal {
      color: var(--vscode-terminal-ansiRed, #ff0000);
    }

    .output-line.skipped {
      color: var(--vscode-terminal-ansiCyan, #00ffff);
    }

    .output-line.unreachable {
      color: var(--vscode-terminal-ansiBrightRed, #ff6b6b);
    }

    .streaming-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      background: rgba(30, 136, 229, 0.2);
      color: #1e88e5;
      border-radius: 4px;
      font-size: 12px;
    }

    .streaming-dot {
      width: 6px;
      height: 6px;
      background: currentColor;
      border-radius: 50%;
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.3;
      }
    }

    .actions {
      padding: 16px;
      border-top: 1px solid var(--vscode-border);
      display: flex;
      gap: 8px;
      flex-shrink: 0;
    }

    .action-button {
      padding: 8px 16px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: background-color 0.2s;
    }

    .action-button:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }

    .action-button.secondary {
      background: var(--vscode-button-secondaryBackground, #3a3d41);
      color: var(--vscode-button-secondaryForeground, #cccccc);
    }

    .action-button.secondary:hover {
      background: var(--vscode-button-secondaryHoverBackground, #45494e);
    }

    .action-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .loading-state {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--vscode-descriptionForeground, #8b8b8b);
    }

    .error-state {
      padding: 16px;
      color: var(--vscode-errorForeground, #f48771);
      background: var(--vscode-inputValidation-errorBackground, rgba(244, 135, 113, 0.1));
      border: 1px solid var(--vscode-inputValidation-errorBorder, #f48771);
      border-radius: 4px;
      margin: 16px;
    }

    .host-summary {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    .host-stat {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
    }

    .host-stat-icon {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .host-stat.ok .host-stat-icon {
      background: #43a047;
    }

    .host-stat.changed .host-stat-icon {
      background: #ffa726;
    }

    .host-stat.failed .host-stat-icon {
      background: #e53935;
    }

    .host-stat.unreachable .host-stat-icon {
      background: #ff9800;
    }

    .host-stat.skipped .host-stat-icon {
      background: #9e9e9e;
    }
  `,w_([we({type:String})],x_.prototype,"executionId",2),w_([we({type:Boolean})],x_.prototype,"open",2),w_([xe()],x_.prototype,"execution",2),w_([xe()],x_.prototype,"loading",2),w_([xe()],x_.prototype,"streaming",2),w_([xe()],x_.prototype,"output",2),w_([xe()],x_.prototype,"error",2),x_=w_([ve("ansible-execution-drawer")],x_);var __=Object.defineProperty,k_=Object.getOwnPropertyDescriptor,S_=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?k_(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&__(t,s,r),r};let C_=class extends me{constructor(){super(...arguments),this.loading=!1,this.searchQuery="",this.executions=[],this.statusFilter="all",this.typeFilter="all",this.showExecutionDrawer=!1}connectedCallback(){super.connectedCallback(),this.loadData(),this.startAutoRefresh()}disconnectedCallback(){super.disconnectedCallback(),this.stopAutoRefresh()}startAutoRefresh(){this.refreshInterval=window.setInterval(()=>{this.executions.some(e=>"running"===e.status)&&this.loadData()},5e3)}stopAutoRefresh(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=void 0)}async loadData(){this.loading=!0;try{const e="all"===this.statusFilter?void 0:this.statusFilter,t="all"===this.typeFilter?void 0:this.typeFilter,s=await Yx.listExecutions(e,t,100);this.executions=s.executions||[]}catch(e){console.error("Failed to load executions:",e),this.executions=[{id:"exec-001",type:"playbook",playbook:"deploy-keepalived.yml",status:"success",started_at:"2024-01-15T14:30:00Z",finished_at:"2024-01-15T14:35:42Z",duration:342,hosts_summary:{ok:3,changed:2,unreachable:0,failed:0,skipped:0,rescued:0,ignored:0}}]}finally{this.loading=!1}}handleSearch(e){this.searchQuery=e.detail.value}handleFilterChange(e){this.statusFilter=e.detail.value,this.loadData()}get filteredExecutions(){let e=this.executions;if("all"!==this.statusFilter&&(e=e.filter(e=>e.status===this.statusFilter)),this.searchQuery){const t=this.searchQuery.toLowerCase();e=e.filter(e=>{const s=e.playbook?.toLowerCase().includes(t)||!1,i=e.module?.toLowerCase().includes(t)||!1,o=e.status.toLowerCase().includes(t),r=e.id.toLowerCase().includes(t);return s||i||o||r})}return e}formatDuration(e){return Yx.formatDuration(e)}formatDate(e){if(!e)return"-";const t=new Date(e),s=(/* @__PURE__ */new Date).getTime()-t.getTime(),i=Math.floor(s/36e5);if(0===i){const e=Math.floor(s/6e4);return 0===e?"Just now":`${e} min ago`}return i<24?`${i} hours ago`:t.toLocaleString()}getExecutionColumns(){return[{key:"status",label:"Status",width:"100px"},{key:"id",label:"ID"},{key:"type",label:"Type"},{key:"playbook",label:"Playbook/Module"},{key:"hosts",label:"Hosts"},{key:"started_at",label:"Started"},{key:"duration",label:"Duration"}]}getExecutionActions(e){const t=[{label:"View Output",action:"view"},{label:"Download Log",action:"download"}];return"running"===e.status?t.push({label:"Cancel",action:"cancel",danger:!0}):"failed"!==e.status&&"cancelled"!==e.status||t.push({label:"Re-run",action:"rerun"}),t}renderStatusBadge(e){let t="",s=e;switch(e){case"running":t="â³";break;case"success":t="â",s="successful";break;case"failed":t="â";break;case"cancelled":t="â¹ï¸",s="canceled";break;default:t="â¸ï¸"}return J`
      <span class="status-badge ${s}">
        ${t} ${s.charAt(0).toUpperCase()+s.slice(1)}
      </span>
    `}renderHostStats(e){if(!e.hosts_summary)return J`<span>-</span>`;const t=e.hosts_summary;return J`
      <div class="host-stats">
        ${t.ok>0?J`
          <span class="stat-item">
            <span class="stat-icon success"></span>
            ${t.ok}
          </span>
        `:""}
        ${t.failed>0?J`
          <span class="stat-item">
            <span class="stat-icon failed"></span>
            ${t.failed}
          </span>
        `:""}
        ${t.unreachable>0?J`
          <span class="stat-item">
            <span class="stat-icon unreachable"></span>
            ${t.unreachable}
          </span>
        `:""}
        ${t.skipped>0?J`
          <span class="stat-item">
            <span class="stat-icon skipped"></span>
            ${t.skipped}
          </span>
        `:""}
      </div>
    `}async handleExecutionAction(e){const{action:t,item:s}=e.detail;switch(t){case"view":this.selectedExecutionId=s.id,this.showExecutionDrawer=!0;break;case"download":await this.downloadExecutionLog(s.id);break;case"cancel":confirm("Are you sure you want to cancel this execution?")&&await this.cancelExecution(s.id);break;case"rerun":console.log("Re-run execution:",s)}}async downloadExecutionLog(e){try{const t=(await Yx.getExecution(e)).execution.output||"No output available",s=new Blob([t],{type:"text/plain"}),i=URL.createObjectURL(s),o=document.createElement("a");o.href=i,o.download=`execution-${e}.log`,o.click(),URL.revokeObjectURL(i)}catch(t){console.error("Failed to download log:",t),alert(`Failed to download log: ${t}`)}}async cancelExecution(e){try{await Yx.cancelExecution(e),await this.loadData()}catch(t){console.error("Failed to cancel execution:",t),alert(`Failed to cancel execution: ${t}`)}}handleRefresh(){this.loadData()}handleRunClick(){window.location.href="/ansible/playbooks"}handleDrawerClose(){this.showExecutionDrawer=!1,this.selectedExecutionId=void 0}render(){if(this.loading)return J`<loading-state></loading-state>`;const e=this.getExecutionColumns(),t=this.filteredExecutions.map(e=>({...e,status:this.renderStatusBadge(e.status),playbook:e.playbook||e.module||"-",hosts:this.renderHostStats(e),started_at:this.formatDate(e.started_at),duration:this.formatDuration(e.duration)}));return J`
      <div class="container">
        <div class="header">
          <h1>Job Executions</h1>
        </div>

        <div class="controls">
          <div class="controls-left">
            <filter-dropdown
              .options=${[{value:"all",label:"All"},{value:"running",label:"Running"},{value:"successful",label:"Successful"},{value:"failed",label:"Failed"},{value:"canceled",label:"Canceled"},{value:"pending",label:"Pending"}]}
              .selectedValue=${this.statusFilter}
              .showStatusIndicators=${!0}
              @filter-change=${this.handleFilterChange}
            ></filter-dropdown>
            
            <search-input
              .placeholder=${"Search executions..."}
              @search-change=${this.handleSearch}
            ></search-input>
          </div>

          <div class="controls-right">
            <button class="refresh-btn" @click=${this.handleRefresh}>
              <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                <path d="M13.65 2.35a8 8 0 10.7 11.3l-1.42-1.42a6 6 0 11-.53-8.46L11 5.17V2h3.17l-1.52 1.52a7.92 7.92 0 011 .83z"/>
              </svg>
              Refresh
            </button>
            
            <button class="btn-run" @click=${this.handleRunClick}>
              <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                <path d="M4 2a1 1 0 000 2v8a1 1 0 102 0V4a1 1 0 100-2zM12.441 7.059A1 1 0 0011 8v4a1 1 0 102 0V8a1 1 0 00-1.559-.941l-5.882-3.882A1 1 0 004 4v8a1 1 0 001.559.941l5.882-3.882z"/>
              </svg>
              Run
            </button>
          </div>
        </div>

        <div class="content">
          ${0===t.length?J`
            <empty-state
              .message=${"No executions found"}
            ></empty-state>
          `:J`
            <resource-table
              .columns=${e}
              .data=${t}
              .actions=${this.getExecutionActions.bind(this)}
              @action=${this.handleExecutionAction}
            ></resource-table>
          `}
        </div>
      </div>

      ${this.showExecutionDrawer?J`
        <ansible-execution-drawer
          .executionId=${this.selectedExecutionId}
          .open=${this.showExecutionDrawer}
          @close=${this.handleDrawerClose}
        ></ansible-execution-drawer>
      `:""}
    `}};C_.styles=g`
    :host {
      display: block;
      height: 100%;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%;
      gap: 1rem;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--vscode-panel-border);
    }

    h1 {
      margin: 0 0 24px 0;
      font-size: 24px;
      font-weight: 300;
      flex-shrink: 0;
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-top: 1rem;
    }

    .controls-left {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex: 1;
    }

    .controls-right {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-run {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--vscode-button-background, #007acc);
      color: var(--vscode-button-foreground, white);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-run:hover {
      background: var(--vscode-button-hoverBackground, #005a9e);
    }

    search-input {
      flex: 1;
      max-width: 400px;
    }

    filter-dropdown {
      min-width: 140px;
    }

    .content {
      flex: 1;
      overflow-y: auto;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-badge.running {
      background: rgba(30, 136, 229, 0.2);
      color: #1e88e5;
    }

    .status-badge.successful {
      background: rgba(67, 160, 71, 0.2);
      color: #43a047;
    }

    .status-badge.failed {
      background: rgba(229, 57, 53, 0.2);
      color: #e53935;
    }

    .status-badge.canceled {
      background: rgba(117, 117, 117, 0.2);
      color: #757575;
    }

    .status-badge.pending {
      background: rgba(255, 167, 38, 0.2);
      color: #ffa726;
    }

    .host-stats {
      display: flex;
      gap: 12px;
      font-size: 12px;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .stat-icon {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .stat-icon.success {
      background: #43a047;
    }

    .stat-icon.failed {
      background: #e53935;
    }

    .stat-icon.unreachable {
      background: #ff9800;
    }

    .stat-icon.skipped {
      background: #9e9e9e;
    }

    .refresh-btn {
      padding: 6px 12px;
      background: var(--vscode-button-secondaryBackground);
      color: var(--vscode-button-secondaryForeground);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }

    .refresh-btn:hover {
      background: var(--vscode-button-secondaryHoverBackground);
    }

  `,S_([xe()],C_.prototype,"loading",2),S_([xe()],C_.prototype,"searchQuery",2),S_([xe()],C_.prototype,"executions",2),S_([xe()],C_.prototype,"statusFilter",2),S_([xe()],C_.prototype,"typeFilter",2),S_([xe()],C_.prototype,"showExecutionDrawer",2),S_([xe()],C_.prototype,"selectedExecutionId",2),S_([xe()],C_.prototype,"refreshInterval",2),C_=S_([ve("ansible-executions")],C_);var $_=Object.defineProperty,D_=Object.getOwnPropertyDescriptor,E_=(e,t,s,i)=>{for(var o,r=i>1?void 0:i?D_(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&$_(t,s,r),r};let M_=class extends me{constructor(){super(...arguments),this.subRoute=null,this.activeTab="playbooks",this.handleLocationChange=()=>{this.updateActiveTab()}}connectedCallback(){super.connectedCallback(),this.updateActiveTab(),window.addEventListener("popstate",this.handleLocationChange)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("popstate",this.handleLocationChange)}updated(e){e.has("subRoute")&&this.updateActiveTab()}updateActiveTab(){if(this.subRoute)"inventory"===this.subRoute?this.activeTab="inventory":"executions"===this.subRoute?this.activeTab="executions":"playbooks"===this.subRoute?this.activeTab="playbooks":"templates"===this.subRoute&&(this.activeTab="templates");else{const e=window.location.pathname;e.includes("/ansible/templates")?this.activeTab="templates":e.includes("/ansible/inventory")?this.activeTab="inventory":e.includes("/ansible/executions")?this.activeTab="executions":this.activeTab="playbooks"}}render(){return J`
      <div class="ansible-content">
        <div class="tab-content">
          ${"playbooks"===this.activeTab||"templates"===this.activeTab?J`
            <ansible-playbooks .initialTab=${this.activeTab}></ansible-playbooks>
          `:""}
          ${"inventory"===this.activeTab?J`
            <ansible-inventory></ansible-inventory>
          `:""}
          ${"executions"===this.activeTab?J`
            <ansible-executions></ansible-executions>
          `:""}
        </div>
      </div>
    `}};M_.styles=g`
    :host {
      display: flex;
      flex-direction: column;
      height: 100%;
      overflow: hidden;
    }

    .ansible-content {
      flex: 1;
      overflow: auto;
      display: flex;
      flex-direction: column;
    }

    .tab-content {
      flex: 1;
      overflow: auto;
    }
  `,E_([we({type:String})],M_.prototype,"subRoute",2),E_([xe()],M_.prototype,"activeTab",2),M_=E_([ve("ansible-tab")],M_);const A_=function(e,t={},s={}){let i=s.encode||tc,o=s.decode||tc,r=Ue(),a=r.setKey,n=(t,o)=>{void 0===o?(!1!==s.listen&&ic.perKey&&ic.removeEventListener(e+t,c,d),delete sc[e+t]):(!1!==s.listen&&ic.perKey&&!(t in r.value)&&ic.addEventListener(e+t,c,d),sc[e+t]=i(o))};r.setKey=(e,t)=>{n(e,t),a(e,t)};let l=r.set;function c(t){t.key?t.key.startsWith(e)&&(null===t.newValue?a(t.key.slice(e.length),void 0):a(t.key.slice(e.length),o(t.newValue))):l({})}function d(){let s={...t};for(let t in sc)t.startsWith(e)&&(s[t.slice(e.length)]=o(sc[t]));for(let e in s)r.setKey(e,s[e])}return r.set=function(e){for(let t in e)n(t,e[t]);for(let t in r.value)t in e||n(t,void 0);l(e)},Fe(r,()=>{if(d(),!1!==s.listen)return ic.addEventListener(e,c,d),()=>{ic.removeEventListener(e,c,d);for(let t in r.value)ic.removeEventListener(e+t,c,d)}}),r}("sidebar:expanded",{},{encode:JSON.stringify,decode:JSON.parse}),I_=rc("sidebar:active","dashboard",{encode:JSON.stringify,decode:JSON.parse});function T_(e){I_.set(e)}function P_(){const e=A_.get();return Object.keys(e).filter(t=>e[t])}rc("sidebar:collapsed",!1,{encode:JSON.stringify,decode:JSON.parse});var L_=Object.defineProperty,R_=(e,t,s,i)=>{for(var o,r=void 0,a=e.length-1;a>=0;a--)(o=e[a])&&(r=o(t,s,r)||r);return r&&L_(t,s,r),r};class O_ extends dt{constructor(){super(...arguments),this.collapsed=!1,this.activeItemId="dashboard",this.expandedItemsArray=[],this.translationsLoaded=!1,this.virtualizationEnabledController=new Zl.StoreController(this,Ay),this.storeUnsubscribers=[],this.navigationItems=[{id:"dashboard",label:"nav.dashboard",icon:"dashboard",route:"dashboard"},{id:"network",label:"nav.network",icon:"network",route:"network",children:[{id:"network-interfaces",label:"network.interfaces",icon:"interface",route:"network/interfaces"},{id:"network-bridges",label:"network.bridges",icon:"bridge",route:"network/bridges"},{id:"network-bonds",label:"network.bonds",icon:"bond",route:"network/bonds"},{id:"network-vlans",label:"network.vlans",icon:"vlan",route:"network/vlans"}]},{id:"storage",label:"nav.storage",icon:"storage",route:"storage",children:[{id:"storage-disks",label:"storage.disks.title",icon:"disks",route:"storage/disks"}]},{id:"containers",label:"nav.containers.title",icon:"containers",route:"containers",children:[{id:"containers-cri",label:"nav.containers.cri",icon:"cri",route:"containers/cri"},{id:"containers-docker",label:"nav.containers.docker",icon:"docker",route:"docker"}]},{id:"kubernetes",label:"nav.kubernetes",icon:"kubernetes",route:"kubernetes",children:[{id:"kubernetes-workloads",label:"kubernetes.workloads",icon:"workload",route:"kubernetes/workloads"},{id:"kubernetes-networks",label:"kubernetes.networks",icon:"k8s-networks",route:"kubernetes/networks"},{id:"kubernetes-storage",label:"kubernetes.storages",icon:"k8s-storage",route:"kubernetes/storage"},{id:"kubernetes-configurations",label:"kubernetes.configurations",icon:"configurations",route:"kubernetes/configurations"},{id:"kubernetes-nodes",label:"kubernetes.nodes",icon:"nodes",route:"kubernetes/nodes"},{id:"kubernetes-crds",label:"kubernetes.crds",icon:"crds",route:"kubernetes/crds"}]},{id:"virtualization",label:"nav.virtualization",icon:"virtualization",route:"virtualization",children:[{id:"virtualization-vms",label:"virtualization.vms",icon:"vms",route:"virtualization/vms"},{id:"virtualization-storage-pools",label:"virtualization.storage-pools",icon:"storage-pools",route:"virtualization/storage-pools"},{id:"virtualization-iso-images",label:"virtualization.iso-images",icon:"images",route:"virtualization/iso-images"},{id:"virtualization-networks",label:"virtualization.networks",icon:"virt-networks",route:"virtualization/networks"},{id:"virtualization-volumes",label:"virtualization.volumes",icon:"volumes",route:"virtualization/volumes"},{id:"virtualization-backups",label:"virtualization.backups",icon:"backups",route:"virtualization/backups"}]},{id:"logs",label:"nav.logs",icon:"logs",route:"logs"},{id:"users",label:"nav.users",icon:"users",route:"users"},{id:"terminal",label:"nav.terminal",icon:"terminal",route:"terminal"}],this.handlePopState=()=>{const e=window.location.pathname.slice(1);if(e){const t=this.findNavItemByRoute(e);t&&(this.activeItemId=t.id,this.requestUpdate())}}}static{this.styles=g`
    :host {
      display: flex;
      flex-direction: column;

      height: 100%;
      background-color: var(--vscode-sidebar);
      color: var(--vscode-text);
      border-right: 1px solid var(--vscode-border);
      user-select: none;
    }


    .sidebar-content {
      flex: 1;
      overflow-y: auto;

      overflow-x: hidden;
    }

    .sidebar-footer {
      flex-shrink: 0;
      padding: 12px;
      border-top: 1px solid var(--vscode-border);
      background-color: var(--vscode-sidebar);
      font-size: 11px;
      color: var(--vscode-text-dim);
      text-align: center;
      line-height: 1.4;
    }

    .sidebar-footer-brand {
      font-weight: 600;
      color: var(--vscode-text);
      margin-bottom: 2px;
    }

    .sidebar-footer-copyright {
      opacity: 0.7;
    }

        .tree {
      padding: 20px 0 0 0;
      margin: 0;
      list-style: none;
    }

    .tree-item {
      display: flex;
      align-items: center;
      padding: 6px 12px;
      cursor: pointer;
      position: relative;
      font-size: 13px;
      transition: all 0.15s ease;
      border-left: 3px solid transparent;
    }

    .tree-item:hover {
      background-color: var(--vscode-sidebar-hover);
      border-left-color: var(--vscode-text-dim);
    }

    .tree-item.active {
      background-color: var(--vscode-sidebar-active);
      border-left-color: var(--vscode-sidebar-active-border);
      color: var(--vscode-accent);
    }

    .tree-item.disabled {
      opacity: 0.5;
      cursor: default;
      pointer-events: none;
    }

    .tree-item.active .tree-item-icon {
      color: var(--vscode-accent);
    }

    .tree-item-icon {
      width: 16px;
      height: 16px;
      margin-right: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .tree-item-icon img {
      width: 16px;
      height: 16px;
      filter: brightness(0.9);
    }

    .tree-item:hover .tree-item-icon img {
      filter: brightness(1.1);
    }

    .tree-item.active .tree-item-icon img {
      filter: brightness(1.2) saturate(1.5);
    }

    .tree-item-label {
      flex: 1;
      overflow-y: auto;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .tree-item-arrow {
      width: 16px;
      height: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
    }

    .tree-item-arrow.expanded {
      transform: rotate(90deg);
    }

    .tree-children {
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .tree-children .tree-item {
      padding-left: 28px;
    }

    .tree-children .tree-children .tree-item {
      padding-left: 44px;
    }

    /* Icons */
    .icon-system::before { content: 'ð»'; }
    .icon-dashboard::before { content: 'ð'; }
    .icon-logs::before { content: 'ð'; }
    .icon-terminal::before { content: 'â¨ï¸'; }
    .icon-network::before { content: 'ð'; }
    .icon-interfaces::before { content: 'ð'; }
    .icon-bonding::before { content: 'ð'; }
    .icon-vlans::before { content: 'ð·ï¸'; }
    .icon-storage::before { content: 'ð¾'; }
    .icon-disks::before { content: 'ð¿'; }
    .icon-lvm::before { content: 'ð¦'; }
    .icon-raid::before { content: 'ðï¸'; }
    .icon-containers::before { content: 'ð¦'; }
    .icon-docker::before { content: 'ð³'; }
    .icon-images::before { content: 'ð½'; }
    .icon-kubernetes::before { content: 'â¸ï¸'; }
    .icon-workload::before { content: 'âï¸'; }
    .icon-k8s-networks::before { content: 'ð'; }
    .icon-k8s-storage::before { content: 'ð¾'; }
    .icon-configurations::before { content: 'âï¸'; }
    .icon-nodes::before { content: 'ð¥ï¸'; }
    .icon-crds::before { content: 'ð'; }
    .icon-helm::before { content: 'âµ'; }
    .icon-users::before { content: 'ð¥'; }
    .icon-ansible::before { content: 'ð§'; }
    .icon-playbooks::before { content: 'ð'; }
    .icon-inventory::before { content: 'ð'; }
    .icon-executions::before { content: 'â¶ï¸'; }
    .icon-virtualization::before { content: 'ð¥ï¸'; }
    .icon-vms::before { content: 'ð»'; }
    .icon-storage-pools::before { content: 'ðï¸'; }
    .icon-virt-networks::before { content: 'ð'; }
    .icon-volumes::before { content: 'ð'; }

    :host([collapsed]) .tree-item-label,
    :host([collapsed]) .tree-item-arrow,
    :host([collapsed]) .tree-children {
      display: none;
    }

    :host([collapsed]) .tree-item {
      padding: 8px;
      justify-content: center;
    }

    :host([collapsed]) .tree-item-icon {
      margin-right: 0;
    }

    /* Focus styles for keyboard navigation */
    .tree-item:focus-visible {
      outline: 2px solid var(--vscode-accent);
      outline-offset: -2px;
    }

    /* Subtle animation on icon when hovering */
    .tree-item:hover .tree-item-icon {
      transform: translateX(2px);
      transition: transform 0.15s ease;
    }

    /* Child items styling */
    .tree-children .tree-item {
      font-size: 12px;
      opacity: 0.9;
    }

    .tree-children .tree-item.active {
      opacity: 1;
    }

    /* Masked icon for monochrome SVGs to inherit color */
    .icon-mask {
      width: 16px;
      height: 16px;
      background-color: currentColor;
      -webkit-mask-size: contain;
      mask-size: contain;
      -webkit-mask-repeat: no-repeat;
      mask-repeat: no-repeat;
      -webkit-mask-position: center;
      mask-position: center;
    }
  `}handleItemClick(e,t){if(t.stopPropagation(),e.children)!function(e){const t=A_.get();A_.setKey(e,!t[e])}(e.id);else if(e.route){T_(e.id);const[t,s]=e.route.split("?"),i=s?new URLSearchParams(s):null,o="dashboard"===t?"/":`/${e.route}`;window.history.pushState({route:t,queryParams:i},"",o),this.dispatchEvent(new CustomEvent("navigate",{detail:{route:t,item:e,queryParams:i},bubbles:!0,composed:!0}))}}handleKeyDown(e,t){"Enter"===t.key||" "===t.key?(t.preventDefault(),this.handleItemClick(e,t)):"ArrowRight"===t.key&&e.children?(t.preventDefault(),this.expandedItemsArray.includes(e.id)||(this.expandedItemsArray=[...this.expandedItemsArray,e.id])):"ArrowLeft"===t.key&&e.children&&(t.preventDefault(),this.expandedItemsArray.includes(e.id)&&(this.expandedItemsArray=this.expandedItemsArray.filter(t=>t!==e.id)))}getTranslation(e){if(!s.isInitialized()){const t=e.split(".");return t[t.length-1]||e}return n(e)||e}isVirtualizationItemDisabled(e){const t=!1===this.virtualizationEnabledController.value,s="virtualization"===e.id||e.id.startsWith("virtualization-");return t&&s}renderNavItem(e){const t=e.children&&e.children.length>0,s=(i=e.id,A_.get()[i]||!1);var i;const o=this.isItemActive(e),r=this.isVirtualizationItemDisabled(e);return J`
      <li>
        <div
          class="tree-item ${o?"active":""} ${r?"disabled":""}"
          @click=${t=>!r&&this.handleItemClick(e,t)}
          @keydown=${t=>this.handleKeyDown(e,t)}
          title=${this.collapsed?this.getTranslation(e.label):""}
          tabindex="0"
          role="treeitem"
          aria-expanded=${t?s:void 0}
          aria-selected=${o}
        >
          ${t?J`
            <span class="tree-item-arrow ${s?"expanded":""}">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M6 4l4 4-4 4z"/>
              </svg>
            </span>
          `:J`<span class="tree-item-arrow"></span>`}
          ${e.icon&&["ansible","helm"].includes(e.icon)?J`
          <span class="tree-item-icon">
            <img src="/icons/tech/${e.icon}.svg" alt="${e.label}" width="16" height="16" />
          </span>
        `:e.icon&&["dashboard","network","interface","bridge","bond","vlan","storage","disks","containers","cri","virtualization","vms","storage-pools","images","virt-networks","volumes","backups","logs","users","terminal","kubernetes","docker","workload","k8s-networks","k8s-storage","configurations","nodes","crds"].includes(e.icon)?J`
          <span class="tree-item-icon">
            <div class="icon-mask" style="-webkit-mask-image: url('/icons/tech/${e.icon}.svg'); mask-image: url('/icons/tech/${e.icon}.svg');"></div>
          </span>
        `:J`<span class="tree-item-icon icon-${e.icon}"></span>`}
          <span class="tree-item-label">${this.getTranslation(e.label)}</span>
        </div>
        ${t&&s&&!this.collapsed?J`
          <ul class="tree-children">
            ${e.children.map(e=>this.renderNavItem(e))}
          </ul>
        `:""}
      </li>
    `}async connectedCallback(){super.connectedCallback(),await s.init(),this.translationsLoaded=!0;const e=A_.subscribe(()=>{this.expandedItemsArray=P_(),this.requestUpdate()}),t=I_.subscribe(e=>{this.activeItemId=e,this.requestUpdate()});this.storeUnsubscribers.push(e,t),this.expandedItemsArray=P_(),this.activeItemId=I_.get();const i=window.location.pathname.slice(1);if(i&&""!==i){const e=this.findNavItemByRoute(i);T_(e?e.id:"dashboard")}else T_("dashboard");window.addEventListener("popstate",this.handlePopState)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("popstate",this.handlePopState),this.storeUnsubscribers.forEach(e=>e()),this.storeUnsubscribers=[]}findNavItemByRoute(e){const t=s=>{for(const i of s){if(i.route===e)return i;if(i.route&&e.startsWith(i.route+"/"))return i;if(i.children){const e=t(i.children);if(e)return e}}return null};return t(this.navigationItems)}isItemActive(e){return!(e.children&&e.children.length>0)&&this.activeItemId===e.id}render(){if(!this.translationsLoaded)return J``;const e=/* @__PURE__ */(new Date).getFullYear();return J`
      <div class="sidebar-content">
        <ul class="tree" role="tree">
          ${this.navigationItems.map(e=>this.renderNavItem(e))}
        </ul>
      </div>
      <div class="sidebar-footer">
        <div class="sidebar-footer-brand">Vapor by Awanio</div>
        <div class="sidebar-footer-copyright">Â© ${e} Awanio. All rights reserved.</div>
      </div>
    `}}R_([we({type:Boolean})],O_.prototype,"collapsed"),R_([xe()],O_.prototype,"activeItemId"),R_([xe()],O_.prototype,"expandedItemsArray"),R_([xe()],O_.prototype,"translationsLoaded"),customElements.define("sidebar-tree",O_);var N_=Object.defineProperty,B_=(e,t,s,i)=>{for(var o,r=void 0,a=e.length-1;a>=0;a--)(o=e[a])&&(r=o(t,s,r)||r);return r&&N_(t,s,r),r};class F_ extends me{constructor(){super(...arguments),this.isAuthenticated=!1,this.activeView="dashboard",this.currentTheme=a.getTheme(),this.currentLocale=s.getLocale(),this.languageMenuOpen=!1,this.sidebarCollapsed=!1,this.subRoute=null,this.handlePopstate=e=>{if(e.state&&e.state.route){const[t,...s]=e.state.route.split("/");this.activeView=t,this.subRoute=s.length>0?s.join("/"):null}else{const e=window.location.pathname.slice(1);if(e&&""!==e){const[t,...s]=e.split("/");this.subRoute=s.length>0?s.join("/"):null,this.activeView=t&&this.isValidRoute(t)?t:e}else this.activeView="dashboard",this.subRoute=null}},this.handleAuthLogin=async()=>{this.isAuthenticated=!0;const{reinitializeMetricsAfterLogin:e}=await Promise.resolve().then(()=>Xc);await e()},this.handleAuthLogout=()=>{this.isAuthenticated=!1},this.handleLoginSuccess=async()=>{this.isAuthenticated=!0;const{reinitializeMetricsAfterLogin:e}=await Promise.resolve().then(()=>Xc);await e()},this.handleThemeChange=e=>{this.currentTheme=e.detail.theme},this.handleDocumentClick=e=>{e.target.closest(".language-selector")||(this.languageMenuOpen=!1)}}static{this.styles=g`
    :host {
      display: block;
      height: 100vh;
      background-color: var(--surface-0);
      color: var(--text-primary);
      font-family: var(--font-family);
    }
  
    .app-header {
      background-color: var(--surface-1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      height: 56px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      border-bottom: 1px solid var(--border-color);
    }
    
    .header-title {
      font-size: 1.25rem;
      font-weight: 500;
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .user-info {
      color: var(--text-secondary);
      font-size: 0.875rem;
    }
    
    .logout-button {
      padding: 0.5rem 1rem;
      background: transparent;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .logout-button:hover {
      background: var(--surface-2);
      border-color: var(--primary);
    }

    .theme-toggle {
      padding: 0.5rem;
      background: transparent;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
    }

    .theme-toggle:hover {
      background: var(--surface-2);
      border-color: var(--primary);
    }

    .theme-icon {
      width: 20px;
      height: 20px;
    }

    .language-selector {
      position: relative;
    }

    .language-button {
      padding: 0.5rem 1rem;
      background: transparent;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
    }

    .language-button:hover {
      background: var(--surface-2);
      border-color: var(--primary);
    }

    .language-icon {
      width: 16px;
      height: 16px;
    }

    .language-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 0.25rem;
      background: var(--surface-1);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      min-width: 120px;
      z-index: 1000;
    }

    .language-option {
      padding: 0.5rem 1rem;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
    }

    .language-option:hover {
      background: var(--surface-2);
    }

    .language-option.active {
      background: var(--surface-3);
      color: var(--primary);
    }

    .check-icon {
      width: 14px;
      height: 14px;
      margin-left: auto;
    }

    .app-content {
      display: flex;
      height: calc(100vh - 56px);
    }

    sidebar-tree {
      width: 200px;
      background-color: var(--surface-1);
      transition: width 0.3s ease-in-out;
      border-right: 1px solid var(--border-color);
    }

    sidebar-tree[collapsed] {
      width: 60px;
    }
    
    .sidebar-toggle {
      position: absolute;
      top: 70px;
      left: 200px;
      transform: translateX(-50%);
      z-index: 10;
      padding: 0.25rem;
      background: var(--surface-1);
      border: 1px solid var(--border-color);
      border-radius: 50%;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .sidebar-toggle:hover {
      background: var(--surface-2);
      color: var(--text-primary);
    }
    
    .sidebar-toggle.collapsed {
      left: 60px;
    }
    
    .main {
      flex: 1;
      overflow: auto;
      background-color: var(--surface-0);
      color: var(--text-primary);
      padding: 2rem;
      display: flex;
      flex-direction: column;
    }
    
    .tab-content {
      margin-top: 1rem;
      flex: 1;
      overflow: auto;
    }
  `}connectedCallback(){super.connectedCallback(),this.isAuthenticated=o.isAuthenticated();const e=s.onChange(()=>{this.currentLocale=s.getLocale(),this.requestUpdate()});this._unsubscribeI18n=e;const t=window.location.pathname.slice(1);if(t&&""!==t){const[e,...s]=t.split("/");this.subRoute=s.length>0?s.join("/"):null,e&&this.isValidRoute(e)?this.activeView=e:e&&(this.activeView=t)}else this.activeView="dashboard",window.history.replaceState({route:"dashboard"},"","/");window.addEventListener("popstate",this.handlePopstate),window.addEventListener("auth:login",this.handleAuthLogin),window.addEventListener("auth:logout",this.handleAuthLogout),this.addEventListener("login-success",this.handleLoginSuccess),window.addEventListener("theme-changed",this.handleThemeChange),document.addEventListener("click",this.handleDocumentClick)}disconnectedCallback(){super.disconnectedCallback(),this._unsubscribeI18n&&this._unsubscribeI18n(),window.removeEventListener("popstate",this.handlePopstate),document.removeEventListener("click",this.handleDocumentClick),window.removeEventListener("theme-changed",this.handleThemeChange),window.removeEventListener("auth:login",this.handleAuthLogin),window.removeEventListener("auth:logout",this.handleAuthLogout)}handleLogout(){o.logout()}toggleTheme(){a.toggleTheme()}toggleLanguageMenu(e){e.stopPropagation(),this.languageMenuOpen=!this.languageMenuOpen}async selectLanguage(e){await s.setLocale(e),this.languageMenuOpen=!1}async updated(e){super.updated(e)}render(){if(!this.isAuthenticated)return J`<login-page></login-page>`;if("containers"===this.activeView&&"terminal"===this.subRoute){const e=new URLSearchParams(window.location.search),t=e.get("container")||"",s=e.get("runtime")||"docker",i=e.get("name")||"";return J`
         <container-terminal .containerId="${t}" .containerName="${i}" .runtime="${s}"></container-terminal>
       `}if("kubernetes"===this.activeView&&"terminal"===this.subRoute){const e=new URLSearchParams(window.location.search),t=e.get("pod")||"",s=e.get("namespace")||"",i=e.get("container")||"";return J`
         <pod-terminal .pod="${t}" .namespace="${s}" .container="${i}"></pod-terminal>
       `}return J`
      <!-- App Header -->
      <header class="app-header">
        <div class="header-title">Vapor</div>
        <div class="header-actions">
          <button class="theme-toggle" @click="${this.toggleTheme}" title="${n("app.theme")}">
            ${"dark"===this.currentTheme?J`
              <svg class="theme-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
              </svg>
            `:J`
              <svg class="theme-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
              </svg>
            `}
          </button>
          
          <div class="language-selector">
            <button class="language-button" @click="${this.toggleLanguageMenu}" title="${n("app.language")}">
              <svg class="language-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
              </svg>
              ${this.currentLocale.toUpperCase()}
            </button>
            
            ${this.languageMenuOpen?J`
              <div class="language-dropdown">
                <div class="language-option ${"en"===this.currentLocale?"active":""}" @click="${()=>this.selectLanguage("en")}">
                  English
                  ${"en"===this.currentLocale?J`
                    <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                  `:""}
                </div>
                <div class="language-option ${"id"===this.currentLocale?"active":""}" @click="${()=>this.selectLanguage("id")}">
                  Bahasa Indonesia
                  ${"id"===this.currentLocale?J`
                    <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                  `:""}
                </div>
              </div>
            `:""}
          </div>
          
          <span class="user-info">Logged in</span>
          <button class="logout-button" @click="${this.handleLogout}">${n("app.logout")}</button>
        </div>
      </header>
      <!-- App Content -->
      <div class="app-content">
        <!-- Sidebar -->
        <sidebar-tree 
          ?collapsed="${this.sidebarCollapsed}"
          activeItemId="${this.activeView}"
          @navigate="${this.handleNavigation}"
        ></sidebar-tree>
        
        <button class="sidebar-toggle ${this.sidebarCollapsed?"collapsed":""}" @click="${this.toggleSidebar}">
          ${this.sidebarCollapsed?"âº":"â¹"}
        </button>

        <!-- Main Content -->
        <main class="main">
          <div class="tab-content">
            ${"dashboard"===this.activeView?J`<dashboard-tab-v2></dashboard-tab-v2>`:""}
            ${"network"===this.activeView?J`<network-tab .subRoute=${this.subRoute}></network-tab>`:""}
            ${"storage"===this.activeView?J`<storage-tab .subRoute=${this.subRoute}></storage-tab>`:""}
            ${"containers"===this.activeView?J`<containers-tab></containers-tab>`:""}
            ${"docker"===this.activeView?J`<docker-tab .subRoute=${this.subRoute}></docker-tab>`:""}
            ${"logs"===this.activeView?J`<logs-tab></logs-tab>`:""}
            ${"terminal"===this.activeView?J`<terminal-tab-v2></terminal-tab-v2>`:""}
            ${"users"===this.activeView?J`<users-tab></users-tab>`:""}
            ${"kubernetes"===this.activeView?J`<kubernetes-tab .subRoute=${this.subRoute}></kubernetes-tab>`:""}
            ${"virtualization"===this.activeView?J`<virtualization-tab .subRoute=${this.subRoute}></virtualization-tab>`:""}
            ${"ansible"===this.activeView?J`<ansible-tab .subRoute=${this.subRoute}></ansible-tab>`:""}
            ${this.isValidRoute(this.activeView)?"":J`<div>404 - Page Not Found</div>`}
          </div>
        </main>
      </div>
      </div>
    `}toggleSidebar(){this.sidebarCollapsed=!this.sidebarCollapsed}handleNavigation(e){const t=e.detail.route,[s,...i]=t.split("/");this.activeView=s,this.subRoute=i.length>0?i.join("/"):null}isValidRoute(e){return["dashboard","network","storage","containers","logs","terminal","users","docker","kubernetes","virtualization","ansible"].includes(e)}}B_([xe()],F_.prototype,"isAuthenticated"),B_([xe()],F_.prototype,"activeView"),B_([xe()],F_.prototype,"currentTheme"),B_([xe()],F_.prototype,"currentLocale"),B_([xe()],F_.prototype,"languageMenuOpen"),B_([xe()],F_.prototype,"sidebarCollapsed"),B_([xe()],F_.prototype,"subRoute"),customElements.define("app-root",F_);const z_=/* @__PURE__ */Object.freeze(/* @__PURE__ */Object.defineProperty({__proto__:null,AppRoot:F_},Symbol.toStringTag,{value:"Module"}));export{bm as A,Pv as C,rv as D,tb as L,Ym as P,ov as S,mb as Y,nv as a,lv as b,Gv as c,cv as d,Jg as e,Wg as f,qg as g,Yg as h,Hg as i,Kg as j,Gg as k,Qg as l,xm as m,of as n,af as o,sb as p,cb as q,pb as r,hb as s,ub as t,gb as u,sm as v,om as w,z_ as x};
